// ==UserScript==
// @name         Gemini
// @namespace    Gemini
// @version      1.0.1
// @author
// @match        https://1227719606223765687.discordsays.com/*
// @match        https://magiccircle.gg/r/*
// @match        https://magicgarden.gg/r/*
// @match        https://starweaver.org/r/*
// @resource     ICON  https://imgur.com/a/nf1ZKbp
// @connect      i.imgur.com
// @connect      magicgarden.gg
// @grant        GM_getValue
// @grant        GM_info
// @grant        GM_openInTab
// @grant        GM_registerMenuCommand
// @grant        GM_setValue
// @grant        GM_xmlhttpRequest
// @grant        unsafeWindow
// @inject-into  page
// @run-at       document-start
// ==/UserScript==

(function () {
  'use strict';

  var _documentCurrentScript = typeof document !== 'undefined' ? document.currentScript : null;
  var pS=Object.defineProperty;var fS=(e,t,n)=>t in e?pS(e,t,{enumerable:true,configurable:true,writable:true,value:n}):e[t]=n;var de=(e,t,n)=>fS(e,typeof t!="symbol"?t+"":t,n);function x(e,t=null,...n){const r=document.createElement(e);for(const[o,i]of Object.entries(t||{}))i!=null&&(o==="style"?typeof i=="string"?r.setAttribute("style",i):typeof i=="object"&&Object.assign(r.style,i):o.startsWith("on")&&typeof i=="function"?r[o.toLowerCase()]=i:o in r?r[o]=i:r.setAttribute(o,String(i)));for(const o of n)o==null||o===false||r.appendChild(typeof o=="string"||typeof o=="number"?document.createTextNode(String(o)):o);return r}const nl="https://i.imgur.com/k5WuC32.png",Yg="gemini-loader-style",po="gemini-loader",wv=80;function hS(){if(document.getElementById(Yg))return;const e=document.createElement("style");e.id=Yg,e.textContent=`
    /* ===== Loader Variables ===== */
    #${po} {
      --loader-bg: rgba(10, 12, 18, 0.6);
      --loader-card-bg: rgba(10, 12, 18, 0.82);
      --loader-fg: #e5e7eb;
      --loader-muted: rgba(229, 231, 235, 0.08);
      --loader-soft: rgba(229, 231, 235, 0.05);
      --loader-accent: #60a5fa;
      --loader-border: rgba(148, 163, 184, 0.2);
      --loader-shadow: rgba(0, 0, 0, 0.45);
      --loader-blur: 14px;
      --loader-radius: 18px;
      --loader-pill-from: #6366f1;
      --loader-pill-to: #06b6d4;

      --loader-info: #60a5fa;
      --loader-success: #4ade80;
      --loader-error: #f87171;
    }

    /* ===== Overlay ===== */
    #${po} {
      position: fixed;
      inset: 0;
      z-index: 2147483000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 28px 18px;
      background: var(--loader-bg);
      backdrop-filter: blur(var(--loader-blur));
      -webkit-backdrop-filter: blur(var(--loader-blur));
      color: var(--loader-fg);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Inter, sans-serif;
      -webkit-font-smoothing: antialiased;
    }

    /* ===== Card ===== */
    .gemini-loader__card {
      position: relative;
      z-index: 1;
      width: min(480px, 94vw);
      background: var(--loader-card-bg);
      border: 1px solid var(--loader-border);
      border-radius: var(--loader-radius);
      padding: 20px;
      box-shadow: 0 20px 60px var(--loader-shadow);
      backdrop-filter: blur(var(--loader-blur));
      -webkit-backdrop-filter: blur(var(--loader-blur));
    }

    /* ===== Header ===== */
    .gemini-loader__header {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 16px;
    }

    /* ===== Spinner ===== */
    .gemini-loader__spinner {
      position: relative;
      width: 48px;
      height: 48px;
      border-radius: 50%;
      border: 2px solid var(--loader-muted);
      border-top-color: var(--loader-pill-from);
      border-right-color: var(--loader-pill-to);
      animation: gemini-loader-spin 1s linear infinite;
      box-shadow: 0 0 20px color-mix(in oklab, var(--loader-pill-from) 40%, transparent);
      flex-shrink: 0;
    }

    .gemini-loader__spinner-icon {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 70px;
      height: 70px;
      border-radius: 50%;
      object-fit: cover;
      animation: gemini-loader-spin-reverse 1s linear infinite;
    }

    /* ===== Titles ===== */
    .gemini-loader__titles {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .gemini-loader__title {
      font-size: 17px;
      font-weight: 600;
      color: var(--loader-fg);
    }

    .gemini-loader__subtitle {
      font-size: 13px;
      color: color-mix(in oklab, var(--loader-fg) 70%, transparent);
      line-height: 1.4;
    }

    /* ===== Logs container ===== */
    .gemini-loader__logs {
      background: var(--loader-soft);
      border: 1px solid var(--loader-border);
      border-radius: 12px;
      padding: 10px 12px;
      max-height: 240px;
      overflow: auto;
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-family: ui-monospace, SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
      font-size: 12px;
      color: var(--loader-fg);
    }

    .gemini-loader__logs::-webkit-scrollbar {
      width: 8px;
    }
    .gemini-loader__logs::-webkit-scrollbar-thumb {
      background: var(--loader-muted);
      border-radius: 8px;
    }

    /* ===== Log entry ===== */
    .gemini-loader__log {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      line-height: 1.4;
      word-break: break-word;
    }

    .gemini-loader__dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-top: 4px;
      flex-shrink: 0;
      box-shadow: 0 0 8px currentColor;
    }

    .gemini-loader__log.info { color: color-mix(in oklab, var(--loader-info) 85%, var(--loader-fg)); }
    .gemini-loader__log.info .gemini-loader__dot { background: var(--loader-info); color: var(--loader-info); }

    .gemini-loader__log.success { color: color-mix(in oklab, var(--loader-success) 85%, var(--loader-fg)); }
    .gemini-loader__log.success .gemini-loader__dot { background: var(--loader-success); color: var(--loader-success); }

    .gemini-loader__log.error { color: color-mix(in oklab, var(--loader-error) 85%, var(--loader-fg)); }
    .gemini-loader__log.error .gemini-loader__dot { background: var(--loader-error); color: var(--loader-error); }

    /* ===== Actions (error state) ===== */
    .gemini-loader__actions {
      display: none;
      margin-top: 14px;
      justify-content: flex-end;
    }

    #${po}.gemini-loader--error .gemini-loader__actions {
      display: flex;
    }

    .gemini-loader__button {
      appearance: none;
      border: 1px solid color-mix(in oklab, var(--loader-error) 50%, var(--loader-border));
      background: linear-gradient(
        180deg,
        color-mix(in oklab, var(--loader-error) 25%, transparent) 0%,
        color-mix(in oklab, var(--loader-error) 35%, transparent) 100%
      );
      color: var(--loader-fg);
      padding: 8px 14px;
      border-radius: 10px;
      font-weight: 600;
      font-size: 13px;
      cursor: pointer;
      box-shadow: 0 8px 20px color-mix(in oklab, var(--loader-error) 25%, transparent);
      transition: transform 0.08s ease, box-shadow 0.15s ease, border-color 0.15s ease;
    }

    .gemini-loader__button:hover {
      border-color: var(--loader-error);
      box-shadow: 0 10px 24px color-mix(in oklab, var(--loader-error) 35%, transparent);
    }

    .gemini-loader__button:active {
      transform: scale(0.98);
    }

    /* ===== States ===== */
    #${po}.gemini-loader--closing {
      animation: gemini-loader-fade-out 0.4s ease forwards;
      pointer-events: none;
    }

    #${po}.gemini-loader--error .gemini-loader__spinner {
      animation: none;
      border-color: color-mix(in oklab, var(--loader-error) 30%, var(--loader-muted));
      border-top-color: var(--loader-error);
      border-right-color: var(--loader-error);
      box-shadow: 0 0 20px color-mix(in oklab, var(--loader-error) 40%, transparent);
    }

    /* ===== Animations ===== */
    @keyframes gemini-loader-spin {
      to { transform: rotate(360deg); }
    }

    @keyframes gemini-loader-spin-reverse {
      from { transform: translate(-50%, -50%) rotate(0deg); }
      to { transform: translate(-50%, -50%) rotate(-360deg); }
    }

    @keyframes gemini-loader-fade-out {
      to { opacity: 0; visibility: hidden; }
    }

    /* ===== Responsive ===== */
    @media (max-width: 520px) {
      #${po} { padding: 16px 10px; }
      .gemini-loader__card { padding: 16px; }
      .gemini-loader__header { gap: 12px; }
      .gemini-loader__spinner { width: 42px; height: 42px; }
      .gemini-loader__spinner-icon { width: 56px; height: 56px; }
      .gemini-loader__title { font-size: 16px; }
    }
  `;const t=document.head||document.documentElement||document.body;if(t){t.appendChild(e);return}const n=()=>{(document.head||document.documentElement||document.body)?.appendChild(e);};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n,{once:true}):setTimeout(n,0);}function rl(e,t,n){const r=x("div",{className:`gemini-loader__log ${n}`},x("div",{className:"gemini-loader__dot"}),x("div",{textContent:t}));for(e.appendChild(r);e.childElementCount>wv;)e.firstElementChild?.remove();e.scrollTop=e.scrollHeight;}function gS(){return new Promise(e=>{if(typeof GM_xmlhttpRequest>"u"){e(nl);return}GM_xmlhttpRequest({method:"GET",url:nl,responseType:"blob",onload:t=>{const n=t.response,r=new FileReader;r.onloadend=()=>e(r.result),r.onerror=()=>e(nl),r.readAsDataURL(n);},onerror:()=>e(nl)});})}function mS(e={}){const t=Number.isFinite(e.blurPx)?Math.max(4,Number(e.blurPx)):14;hS();const n=x("div",{className:"gemini-loader__subtitle",textContent:e.subtitle??"Initializing the mod..."}),r=x("div",{className:"gemini-loader__logs"}),o=x("img",{className:"gemini-loader__spinner-icon",alt:"Gemini"}),i=x("div",{className:"gemini-loader__spinner"},o);gS().then(_=>{o.src=_;});const a=x("div",{className:"gemini-loader__card"},x("div",{className:"gemini-loader__header"},i,x("div",{className:"gemini-loader__titles"},x("div",{className:"gemini-loader__title",textContent:e.title??"Gemini is loading"}),n)),r),s=x("div",{id:po},a);(document.body||document.documentElement).appendChild(s);const l=x("div",{className:"gemini-loader__actions"},x("button",{className:"gemini-loader__button",textContent:"Close loader",onclick:()=>s.remove()}));a.appendChild(l),s.style.setProperty("--loader-blur",`${t}px`);const d=_=>{n.textContent=_;},c=new Map,p=(_,C)=>{_.className=`gemini-loader__log ${C}`;};return {log:(_,C="info")=>rl(r,_,C),logStep:(_,C,E="info")=>{const P=String(_||"").trim();if(!P){rl(r,C,E);return}const O=c.get(P);if(O){O.el.lastElementChild&&(O.el.lastElementChild.textContent=C),O.tone!==E&&(p(O.el,E),O.tone=E);return}const F=x("div",{className:`gemini-loader__log ${E}`},x("div",{className:"gemini-loader__dot"}),x("div",{textContent:C}));for(c.set(P,{el:F,tone:E}),r.appendChild(F);r.childElementCount>wv;){const A=r.firstElementChild;if(!A)break;const T=Array.from(c.entries()).find(([,M])=>M.el===A)?.[0];T&&c.delete(T),A.remove();}r.scrollTop=r.scrollHeight;},setSubtitle:d,succeed:(_,C=600)=>{_&&rl(r,_,"success"),s.classList.add("gemini-loader--closing"),setTimeout(()=>s.remove(),C);},fail:(_,C)=>{rl(r,_,"error"),d("Something went wrong. Check the console for details."),s.classList.add("gemini-loader--error"),console.error("[Gemini loader]",_,C);}}}const Jg=150,bS=30;function vS(e,t,n){const r=x("div",{className:"lg-pill",id:"pill"}),o=e.map(S=>{const R=x("button",{className:"lg-tab"},S.label);return R.setAttribute("data-target",S.id),R}),i=x("div",{className:"lg-tabs",id:"lg-tabs-row"},r,...o),a=new Map(e.map(S=>[S.id,true])),s=new Map(o.map((S,R)=>[e[R].id,S]));function l(S){const R=document.createElementNS("http://www.w3.org/2000/svg","svg");R.setAttribute("viewBox","0 0 24 24"),R.setAttribute("fill","none"),R.setAttribute("stroke","currentColor"),R.setAttribute("stroke-width","2"),R.setAttribute("stroke-linecap","round"),R.setAttribute("stroke-linejoin","round");const z=document.createElementNS("http://www.w3.org/2000/svg","polyline");return z.setAttribute("points",S==="left"?"15 18 9 12 15 6":"9 18 15 12 9 6"),R.appendChild(z),R}const d=x("button",{className:"lg-tabs-arrow lg-tabs-arrow-left",ariaLabel:"Scroll left"});d.appendChild(l("left"));const c=x("button",{className:"lg-tabs-arrow lg-tabs-arrow-right",ariaLabel:"Scroll right"});c.appendChild(l("right"));const m=x("div",{className:"lg-tabs-wrapper"},d,i,c);let b=0,g=0,w=false;function _(){const S=i.scrollLeft>0,R=i.scrollLeft<i.scrollWidth-i.clientWidth-1;d.classList.toggle("disabled",!S),c.classList.toggle("disabled",!R);}d.addEventListener("click",()=>{i.scrollBy({left:-Jg,behavior:"smooth"}),setTimeout(_,300);}),c.addEventListener("click",()=>{i.scrollBy({left:Jg,behavior:"smooth"}),setTimeout(_,300);}),i.addEventListener("wheel",S=>{Math.abs(S.deltaY)>Math.abs(S.deltaX)&&(S.preventDefault(),i.scrollLeft+=S.deltaY,_());},{passive:false});let C=0;i.addEventListener("touchstart",S=>{const R=S.touches[0];b=R.clientX,g=R.clientY,w=false,C=i.scrollLeft;},{passive:true}),i.addEventListener("touchmove",S=>{if(w)return;const R=S.touches[0],z=R.clientX-b,j=R.clientY-g;if(Math.abs(j)>Math.abs(z)){w=true;return}Math.abs(z)>bS&&(S.preventDefault(),i.scrollLeft=C-z);},{passive:false}),i.addEventListener("touchend",()=>{_();},{passive:true}),i.addEventListener("scroll",_,{passive:true});function E(S){const R=o.find(z=>z.dataset.target===S)||o[0];R&&requestAnimationFrame(()=>{const z=R.offsetLeft,j=R.offsetWidth;r.style.width=`${j}px`,r.style.transform=`translateX(${z}px)`;const q=i.scrollLeft,U=q,ce=q+i.clientWidth,W=z-12,te=z+j+12;W<U?i.scrollTo({left:W,behavior:"smooth"}):te>ce&&i.scrollTo({left:te-i.clientWidth,behavior:"smooth"}),setTimeout(_,300);});}function P(){for(const[S,R]of a)if(R)return S;return null}function O(S){const R=s.get(S);if(R)if(a.set(S,false),R.style.display="none",T===S){const z=P();z&&M(z);}else A();}function F(S){const R=s.get(S);R&&(a.set(S,true),R.style.display="",A());}function A(){E(T),_();}let T=t||(e[0]?.id??"");function M(S){a.get(S)&&(T=S,o.forEach(R=>R.classList.toggle("active",R.dataset.target===S)),E(S),n(S));}return o.forEach(S=>S.addEventListener("click",()=>M(S.dataset.target))),queueMicrotask(()=>{E(T),_();}),{root:m,activate:M,recalc:A,getActive:()=>T,showTab:F,hideTab:O,isTabVisible:S=>a.get(S)??false,getVisibleTabs:()=>[...a.entries()].filter(([S,R])=>R).map(([S])=>S)}}class Tr{constructor(t){de(this,"id");de(this,"label");de(this,"container",null);de(this,"cleanupFunctions",[]);de(this,"preloadedContent",null);de(this,"preloadPromise",null);this.id=t.id,this.label=t.label;}destroy(){}async preload(){if(this.preloadedContent||this.preloadPromise)return;const t=x("div");this.preloadPromise=(async()=>{const n=this.build(t);n instanceof Promise&&await n,this.preloadedContent=t,this.preloadPromise=null;})(),await this.preloadPromise;}isPreloaded(){return this.preloadedContent!==null}render(t){for(this.unmount();t.firstChild;)t.removeChild(t.firstChild);if(this.container=t,this.preloadedContent){for(;this.preloadedContent.firstChild;)t.appendChild(this.preloadedContent.firstChild);this.preloadedContent=null;}else {const r=this.build(t);r instanceof Promise&&r.catch(o=>{console.error(`[Gemini] Error building section ${this.id}:`,o);});}const n=t.firstElementChild;n&&n.classList.contains("gemini-section")&&n.classList.add("active");}unmount(){const t=this.destroy();t instanceof Promise&&t.catch(n=>{console.error(`[Gemini] Destroy error in section ${this.id}:`,n);}),this.executeCleanup(),this.container=null;}createContainer(t,n){const r=n?`gemini-section ${n}`:"gemini-section";return x("section",{id:t,className:r})}addCleanup(t){this.cleanupFunctions.push(t);}createGrid(t="12px"){const n=x("div");return n.style.display="grid",n.style.gap=t,n}executeCleanup(){for(const t of this.cleanupFunctions)try{t();}catch(n){console.error(`[Gemini] Cleanup error in section ${this.id}:`,n);}this.cleanupFunctions=[];}}class yS{constructor(t,n,r){de(this,"sections");de(this,"activeId",null);de(this,"container");de(this,"theme");this.sections=new Map(t.map(o=>[o.id,o])),this.container=n,this.theme=r;}get ids(){return Array.from(this.sections.keys())}get all(){return Array.from(this.sections.values())}get active(){return this.activeId}activate(t){if(this.activeId!==t){if(!this.sections.has(t))throw new Error(`[Gemini] Unknown section: ${t}`);if(this.activeId&&this.sections.get(this.activeId).unmount(),this.activeId=t,this.sections.get(t).render(this.container),this.theme){const n=this.theme.getCurrentTheme();this.theme.applyTheme(n);}}}}const jr="gemini:",xS={STATE:"hud:state",THEME:"hud:theme"},wS={ALL:"sections",SETTINGS:"sections:settings",TEST:"sections:test",AVATAR_LOADOUTS:"sections:avatar:loadouts"},CS={AUDIO_CUSTOM_SOUNDS:"module:audio:customSounds",AUDIO_NOTIFICATION_SETTINGS:"module:audio:notificationSettings"},SS={MY_PETS_ABILITY_LOGS:"global:myPets:abilityLogs"},ut={AUTO_FAVORITE:"feature:autoFavorite:config",AUTO_FAVORITE_UI:"feature:autoFavorite:ui",JOURNAL_CHECKER:"feature:journalChecker:config",BULK_FAVORITE:"feature:bulkFavorite:config",ACHIEVEMENTS:"feature:achievements:data",TRACKER_STATS:"feature:tracker:stats",ANTI_AFK:"feature:antiAfk:config",CONFIG:"feature:config",PET_TEAM:"feature:petTeam:config",XP_TRACKER:"feature:xpTracker:config",CROP_VALUE_INDICATOR:"feature:cropValueIndicator:config",CROP_SIZE_INDICATOR:"feature:cropSizeIndicator:config",SHOP_NOTIFIER:"feature:shopNotifier:config",WEATHER_NOTIFIER:"feature:weatherNotifier:config",PET_HUNGER_NOTIFIER:"feature:petHungerNotifier:config",ARIES_API:"feature:ariesAPI:config",HARVEST_LOCKER:"feature:harvestLocker:config",EGG_LOCKER:"feature:eggLocker:config",DECOR_LOCKER:"feature:decorLocker:config",MISSING_VARIANTS_INDICATOR:"feature:missingVariantsIndicator:config",JOURNAL:"feature:journal:config"},Dr={ABILITIES_INJECT:"inject:abilitiesInject:config",JOURNAL_HINTS:"inject:journalHints:config",JOURNAL_FILTER_SORT:"inject:journalFilterSort:config",JOURNAL_ALL_TAB:"inject:journalAllTab:config",STORAGE_VALUE_INDICATOR:"inject:storageValueIndicator:config"},kS={AUTO_RELOAD:"dev:auto-reload"},Jt={HUD:xS,SECTION:wS,MODULE:CS,GLOBAL:SS,FEATURE:ut,INJECT:Dr,DEV:kS},xt={STORAGE_CHANGE:"gemini:storage:change",CUSTOM_SOUND_CHANGE:"gemini:custom-sound-change",HARVEST_LOCKER_LOCKS_UPDATED:"gemini:harvestLocker-locks-updated",EGG_LOCKER_LOCKS_UPDATED:"gemini:eggLocker-locks-updated",DECOR_LOCKER_LOCKS_UPDATED:"gemini:decorLocker-locks-updated"};function tt(e,t){try{const n=e.startsWith(jr)?e:jr+e,r=GM_getValue(n);return r==null?t:typeof r=="string"?JSON.parse(r):r}catch(n){return console.error(`[Gemini Storage] Failed to read key "${e}":`,n),t}}function rt(e,t){try{const n=e.startsWith(jr)?e:jr+e,r=e.startsWith(jr)?e.slice(jr.length):e,o=JSON.stringify(t);GM_setValue(n,o),window.dispatchEvent(new CustomEvent("gemini:storage:change",{detail:{key:r,value:t}}));}catch(n){console.error(`[Gemini Storage] Failed to write key "${e}":`,n);}}function _S(e){try{const t=e.startsWith(jr)?e:jr+e;GM_setValue(t,void 0);}catch(t){console.error(`[Gemini Storage] Failed to remove key "${e}":`,t);}}function AS(){try{const e="gemini:",t=[];for(let o=0;o<localStorage.length;o++){const i=localStorage.key(o);i&&i.startsWith(e)&&t.push(i);}for(const o of t)try{const i=localStorage.getItem(o);if(i!==null){const a=JSON.parse(i),s=o.slice(e.length);rt(s,a),console.log(`[Gemini Storage] Migrated key: ${o}`);}}catch(i){console.warn(`[Gemini Storage] Failed to migrate key "${o}":`,i);}const n="gemini.sections",r=GM_getValue(n);r!=null&&(rt("sections",r),GM_setValue(n,void 0),console.log("[Gemini Storage] Migrated: gemini.sections → gemini:sections")),t.length>0&&console.log(`[Gemini Storage] Migration complete. ${t.length} keys migrated from localStorage to GM_* storage.`);}catch(e){console.error("[Gemini Storage] Migration failed:",e);}}const Cv="gemini.sections";function Sv(){const e=tt(Cv,{});return e&&typeof e=="object"&&!Array.isArray(e)?e:{}}function ES(e){rt(Cv,e);}async function TS(e){return Sv()[e]}function IS(e,t){const n=Sv();ES({...n,[e]:t});}function Ci(e,t){return {...e,...t??{}}}async function PS(e){const t=await TS(e.path);let n;e.migrate?n=e.migrate(t):n=t??{},n=Object.assign((d=>JSON.parse(JSON.stringify(d)))(e.defaults),n),e.sanitize&&(n=e.sanitize(n));function o(){IS(e.path,n);}function i(){return n}function a(d){n=e.sanitize?e.sanitize(d):d,o();}function s(d){const p=Object.assign((m=>JSON.parse(JSON.stringify(m)))(n),{});typeof d=="function"?d(p):Object.assign(p,d),n=e.sanitize?e.sanitize(p):p,o();}function l(){o();}return {get:i,set:a,update:s,save:l}}async function Kr(e,t){const{path:n=e,...r}=t;return PS({path:n,...r})}let MS=0;const ol=new Map;function ft(e={},...t){const{id:n,className:r,variant:o="default",padding:i="md",interactive:a=false,expandable:s=false,defaultExpanded:l=true,onExpandChange:d,mediaTop:c,title:p,subtitle:m,badge:b,actions:g,footer:w,divider:_=false,tone:C="neutral",stateKey:E}=e,P=x("div",{className:"card",id:n,tabIndex:a?0:void 0});P.classList.add(`card--${o}`,`card--p-${i}`),a&&P.classList.add("card--interactive"),C!=="neutral"&&P.classList.add(`card--tone-${C}`),r&&P.classList.add(...r.split(" ").filter(Boolean)),s&&P.classList.add("card--expandable");const O=s?E??n??(typeof p=="string"?`title:${p}`:null):null;let F=!s||l;O&&ol.has(O)&&(F=!!ol.get(O));let A=null,T=null,M=null,S=null,R=null;const z=n?`${n}-collapse`:`card-collapse-${++MS}`,j=()=>{if(S!==null&&(cancelAnimationFrame(S),S=null),R){const ne=R;R=null,ne();}},q=(ne,ie)=>{if(!M)return;j();const ee=M;if(ee.setAttribute("aria-hidden",String(!ne)),!ie){ee.classList.remove("card-collapse--animating"),ee.style.display=ne?"":"none",ee.style.height="",ee.style.opacity="";return}if(ee.classList.add("card-collapse--animating"),ee.style.display="",ne){ee.style.height="auto";const B=ee.scrollHeight;if(!B){ee.classList.remove("card-collapse--animating"),ee.style.display="",ee.style.height="",ee.style.opacity="";return}ee.style.height="0px",ee.style.opacity="0",ee.offsetHeight,S=requestAnimationFrame(()=>{S=null,ee.style.height=`${B}px`,ee.style.opacity="1";});}else {const B=ee.scrollHeight;if(!B){ee.classList.remove("card-collapse--animating"),ee.style.display="none",ee.style.height="",ee.style.opacity="";return}ee.style.height=`${B}px`,ee.style.opacity="1",ee.offsetHeight,S=requestAnimationFrame(()=>{S=null,ee.style.height="0px",ee.style.opacity="0";});}const H=()=>{ee.classList.remove("card-collapse--animating"),ee.style.height="",ne||(ee.style.display="none"),ee.style.opacity="";};let K=null;const D=B=>{B.target===ee&&(K!==null&&(clearTimeout(K),K=null),ee.removeEventListener("transitionend",D),ee.removeEventListener("transitioncancel",D),R=null,H());};R=()=>{K!==null&&(clearTimeout(K),K=null),ee.removeEventListener("transitionend",D),ee.removeEventListener("transitioncancel",D),R=null,H();},ee.addEventListener("transitionend",D),ee.addEventListener("transitioncancel",D),K=window.setTimeout(()=>{R?.();},420);};function U(ne){const ie=document.createElementNS("http://www.w3.org/2000/svg","svg");return ie.setAttribute("viewBox","0 0 24 24"),ie.setAttribute("width","16"),ie.setAttribute("height","16"),ie.innerHTML=ne==="up"?'<path d="M7 14l5-5 5 5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>':'<path d="M7 10l5 5 5-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>',ie}function ce(ne,ie=true,ee=true){F=ne,P.classList.toggle("card--collapsed",!F),P.classList.toggle("card--expanded",F),A&&(A.dataset.expanded=String(F),A.setAttribute("aria-expanded",String(F))),T&&(T.setAttribute("aria-expanded",String(F)),T.classList.toggle("card-toggle--collapsed",!F),T.setAttribute("aria-label",F?"Replier le contenu":"Deplier le contenu"),T.replaceChildren(U(F?"up":"down"))),s?q(F,ee):M&&(M.style.display="",M.style.height="",M.style.opacity="",M.setAttribute("aria-hidden","false")),ie&&d&&d(F),O&&ol.set(O,F);}if(c){const ne=x("div",{className:"card-media"});ne.append(c),P.appendChild(ne);}const W=!!(p||m||b||g&&g.length||s);if(W){A=x("div",{className:"card-header"});const ne=x("div",{className:"card-headline",style:"min-width:0;display:flex;flex-direction:column;gap:2px;"});if(p){const H=x("h3",{className:"card-title",style:"margin:0;font-size:15px;font-weight:700;line-height:1.25;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:flex;align-items:center;gap:8px;color:var(--fg);"},p);b&&H.append(typeof b=="string"?x("span",{className:"badge"},b):b),ne.appendChild(H);}if(m){const H=x("div",{className:"card-subtitle",style:"opacity:.85;font-size:12px;color:color-mix(in oklab, var(--fg) 80%, #9ca3af)"},m);ne.appendChild(H);}(ne.childNodes.length||s)&&A.appendChild(ne);const ie=x("div",{className:"card-header-right",style:"display:flex;gap:8px;flex:0 0 auto;align-items:center;"}),ee=x("div",{className:"card-actions",style:"display:flex;gap:8px;flex:0 0 auto;align-items:center;"});g?.forEach(H=>ee.appendChild(H)),ee.childNodes.length&&ie.appendChild(ee),s&&(T=x("button",{className:"card-toggle",type:"button",ariaExpanded:String(F),ariaControls:z,ariaLabel:F?"Replier le contenu":"Deplier le contenu"}),T.textContent=F?"▲":"▼",T.addEventListener("click",H=>{H.preventDefault(),H.stopPropagation(),ce(!F);}),ie.appendChild(T),A.classList.add("card-header--expandable"),A.addEventListener("click",H=>{const K=H.target;K?.closest(".card-actions")||K?.closest(".card-toggle")||ce(!F);})),ie.childNodes.length&&A.appendChild(ie),P.appendChild(A);}M=x("div",{className:"card-collapse",id:z,ariaHidden:s?String(!F):"false"}),P.appendChild(M),_&&W&&M.appendChild(x("div",{className:"card-divider"}));const te=x("div",{className:"card-body"});if(te.append(...t),M.appendChild(te),w){_&&M.appendChild(x("div",{className:"card-divider"}));const ne=x("div",{className:"card-footer"});ne.append(w),M.appendChild(ne);}return T&&T.setAttribute("aria-controls",z),ce(F,false,false),O&&ol.set(O,F),P}let _c=false;const Ac=new Set,Sn=e=>{const t=document.activeElement;for(const n of Ac)if(t&&(t===n||n.contains(t))){e.stopImmediatePropagation(),e.stopPropagation();return}};function LS(){_c||(_c=true,window.addEventListener("keydown",Sn,true),window.addEventListener("keypress",Sn,true),window.addEventListener("keyup",Sn,true),document.addEventListener("keydown",Sn,true),document.addEventListener("keypress",Sn,true),document.addEventListener("keyup",Sn,true));}function RS(){_c&&(Ac.size>0||(_c=false,window.removeEventListener("keydown",Sn,true),window.removeEventListener("keypress",Sn,true),window.removeEventListener("keyup",Sn,true),document.removeEventListener("keydown",Sn,true),document.removeEventListener("keypress",Sn,true),document.removeEventListener("keyup",Sn,true)));}let ho=null;const dp=e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),ho!==null&&(window.clearTimeout(ho),ho=null),document.removeEventListener("click",dp,true);};function OS(){document.addEventListener("click",dp,true),ho!==null&&window.clearTimeout(ho),ho=window.setTimeout(()=>{document.removeEventListener("click",dp,true),ho=null;},500);}function Io(e){const{id:t,value:n=null,options:r,placeholder:o="Select...",size:i="md",disabled:a=false,blockGameKeys:s=true,onChange:l,onOpenChange:d}=e,c=x("div",{className:"select",id:t}),p=x("button",{className:"select-trigger",type:"button"}),m=x("span",{className:"select-value"},o),b=x("span",{className:"select-caret"},"▾");p.append(m,b);const g=x("div",{className:"select-menu",role:"listbox",tabindex:"-1","aria-hidden":"true"});c.classList.add(`select--${i}`);let w=false,_=n,C=null,E=!!a;function P(H){return H==null?o:(e.options||r).find(D=>D.value===H)?.label??o}function O(H){m.textContent=P(H),g.querySelectorAll(".select-option").forEach(K=>{const D=K.dataset.value,B=H!=null&&D===H;K.classList.toggle("selected",B),K.setAttribute("aria-selected",String(B));});}function F(H){g.replaceChildren(),H.forEach(K=>{const D=x("button",{className:"select-option"+(K.disabled?" disabled":""),type:"button",role:"option","data-value":K.value,"aria-selected":String(K.value===_),tabindex:"-1"},K.label);K.value===_&&D.classList.add("selected"),K.disabled||D.addEventListener("pointerdown",B=>{B.preventDefault(),B.stopPropagation(),B.pointerType&&B.pointerType!=="mouse"&&OS(),z(K.value,{notify:true}),S();},{capture:true}),g.appendChild(D);});}function A(){p.setAttribute("aria-expanded",String(w)),g.setAttribute("aria-hidden",String(!w));}function T(){const H=p.getBoundingClientRect();Object.assign(g.style,{minWidth:`${H.width}px`});}function M(){w||E||(w=true,c.classList.add("open"),A(),T(),document.addEventListener("mousedown",W,true),document.addEventListener("scroll",te,true),window.addEventListener("resize",ne),g.focus({preventScroll:true}),s&&(LS(),Ac.add(c),C=()=>{Ac.delete(c),RS();}),d?.(true));}function S(){w&&(w=false,c.classList.remove("open"),A(),document.removeEventListener("mousedown",W,true),document.removeEventListener("scroll",te,true),window.removeEventListener("resize",ne),p.focus({preventScroll:true}),C?.(),C=null,d?.(false));}function R(){w?S():M();}function z(H,K={}){const D=_;_=H,O(_),K.notify!==false&&D!==H&&l?.(H);}function j(){return _}function q(H){const K=Array.from(g.querySelectorAll(".select-option:not(.disabled)"));if(!K.length)return;const D=K.findIndex(Q=>Q.classList.contains("active")),B=K[(D+(H===1?1:K.length-1))%K.length];K.forEach(Q=>Q.classList.remove("active")),B.classList.add("active"),B.focus({preventScroll:true}),B.scrollIntoView({block:"nearest"});}function U(H){(H.key===" "||H.key==="Enter"||H.key==="ArrowDown")&&(H.preventDefault(),M());}function ce(H){if(H.key==="Escape"){H.preventDefault(),S();return}if(H.key==="Enter"||H.key===" "){const K=g.querySelector(".select-option.active")||g.querySelector(".select-option.selected");K&&!K.classList.contains("disabled")&&(H.preventDefault(),z(K.dataset.value,{notify:true}),S());return}if(H.key==="ArrowDown"){H.preventDefault(),q(1);return}if(H.key==="ArrowUp"){H.preventDefault(),q(-1);return}}function W(H){c.contains(H.target)||S();}function te(){w&&T();}function ne(){w&&T();}function ie(H){E=!!H,p.disabled=E,c.classList.toggle("disabled",E),E&&S();}function ee(H){e.options=H,F(H),H.some(K=>K.value===_)||(_=null,O(null));}return c.append(p,g),p.addEventListener("pointerdown",H=>{H.preventDefault(),H.stopPropagation(),R();},{capture:true}),p.addEventListener("keydown",U),g.addEventListener("keydown",ce),F(r),n!=null?(_=n,O(_)):O(null),A(),ie(E),{root:c,open:M,close:S,toggle:R,getValue:j,setValue:z,setOptions:ee,setDisabled:ie,destroy(){document.removeEventListener("mousedown",W,true),document.removeEventListener("scroll",te,true),window.removeEventListener("resize",ne),C?.(),C=null;}}}function Tf(e={}){const{id:t,text:n="",htmlFor:r,tone:o="default",size:i="md",layout:a="inline",variant:s="text",required:l=false,disabled:d=false,tooltip:c,hint:p,icon:m,suffix:b,onClick:g}=e,w=x("div",{className:"lg-label-wrap",id:t}),_=x("label",{className:"lg-label",...r?{htmlFor:r}:{},...c?{title:c}:{}});if(m){const z=typeof m=="string"?x("span",{className:"lg-label-ico"},m):m;z.classList?.add?.("lg-label-ico"),_.appendChild(z);}const C=x("span",{className:"lg-label-text"},n);_.appendChild(C);const E=x("span",{className:"lg-label-req",ariaHidden:"true"}," *");l&&_.appendChild(E);let P=null;if(b!=null){P=typeof b=="string"?document.createTextNode(b):b;const z=x("span",{className:"lg-label-suffix"});z.appendChild(P),_.appendChild(z);}const O=p?x("div",{className:"lg-label-hint"},p):null;w.classList.add(`lg-label--${a}`),w.classList.add(`lg-label--${i}`),s==="title"&&w.classList.add("lg-label--title"),F(o),d&&w.classList.add("is-disabled"),w.appendChild(_),O&&w.appendChild(O),g&&_.addEventListener("click",g);function F(z){w.classList.remove("lg-label--default","lg-label--muted","lg-label--info","lg-label--success","lg-label--warning","lg-label--danger"),w.classList.add(`lg-label--${z}`);}function A(z){C.textContent=z;}function T(z){F(z);}function M(z){z&&!E.isConnected&&_.appendChild(E),!z&&E.isConnected&&E.remove(),z?_.setAttribute("aria-required","true"):_.removeAttribute("aria-required");}function S(z){w.classList.toggle("is-disabled",!!z);}function R(z){!z&&O&&O.isConnected?O.remove():z&&O?O.textContent=z:z&&!O&&w.appendChild(x("div",{className:"lg-label-hint"},z));}return {root:w,labelEl:_,hintEl:O,setText:A,setTone:T,setRequired:M,setDisabled:S,setHint:R}}function ha(e){return e==null?null:typeof e=="string"?document.createTextNode(e):e}function il(e,t){const n=document.createElement("span");n.className=`btn-ico btn-ico--${t}`;const r=ha(e);return r&&n.appendChild(r),n}function FS(){const e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"svg");t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("width","16"),t.setAttribute("height","16"),t.setAttribute("aria-hidden","true"),t.style.marginRight="6px",t.style.display="none",t.style.flexShrink="0";const n=document.createElementNS(e,"circle");n.setAttribute("cx","12"),n.setAttribute("cy","12"),n.setAttribute("r","9"),n.setAttribute("fill","none"),n.setAttribute("stroke","currentColor"),n.setAttribute("stroke-width","3"),n.setAttribute("stroke-linecap","round");const r=document.createElementNS(e,"animate");r.setAttribute("attributeName","stroke-dasharray"),r.setAttribute("values","1,150;90,150;90,150"),r.setAttribute("dur","1.5s"),r.setAttribute("repeatCount","indefinite");const o=document.createElementNS(e,"animateTransform");return o.setAttribute("attributeName","transform"),o.setAttribute("attributeType","XML"),o.setAttribute("type","rotate"),o.setAttribute("from","0 12 12"),o.setAttribute("to","360 12 12"),o.setAttribute("dur","1s"),o.setAttribute("repeatCount","indefinite"),n.appendChild(r),n.appendChild(o),t.appendChild(n),t}function kt(e={}){const{label:t="",id:n,variant:r="default",size:o="md",iconLeft:i,iconRight:a,loading:s=false,tooltip:l,type:d="button",onClick:c,disabled:p=false,fullWidth:m=false}=e,b=x("button",{className:"btn",id:n});b.type=d,r==="primary"&&b.classList.add("primary"),r==="danger"&&b.classList.add("danger"),o==="sm"&&b.classList.add("btn--sm"),l&&(b.title=l),m&&(b.style.width="100%");const g=FS(),w=i?il(i,"left"):null,_=a?il(a,"right"):null,C=document.createElement("span");C.className="btn-label";const E=ha(t);E&&C.appendChild(E),!E&&(w||_)&&b.classList.add("btn--icon"),b.appendChild(g),w&&b.appendChild(w),b.appendChild(C),_&&b.appendChild(_);const P=p||s;b.disabled=P,b.setAttribute("aria-busy",String(!!s)),g.style.display=s?"inline-block":"none",c&&b.addEventListener("click",c);const O=b;return O.setLoading=F=>{b.setAttribute("aria-busy",String(!!F)),g.style.display=F?"inline-block":"none",b.disabled=F||p;},O.setDisabled=F=>{b.disabled=F||b.getAttribute("aria-busy")==="true";},O.setLabel=F=>{C.replaceChildren();const A=ha(F);A&&C.appendChild(A),!A&&(w||_)?b.classList.add("btn--icon"):b.classList.remove("btn--icon");},O.setIconLeft=F=>{if(F==null){w?.remove();return}w?w.replaceChildren(ha(F)):b.insertBefore(il(F,"left"),C);},O.setIconRight=F=>{if(F==null){_?.remove();return}_?_.replaceChildren(ha(F)):b.appendChild(il(F,"right"));},O.setVariant=F=>{b.classList.remove("primary","danger"),F==="primary"&&b.classList.add("primary"),F==="danger"&&b.classList.add("danger");},O}function Xr(e={}){const{id:t,checked:n=false,disabled:r=false,size:o="md",label:i,labelSide:a="right",onChange:s}=e,l=x("div",{className:"lg-switch-wrap"}),d=x("button",{className:`lg-switch lg-switch--${o}`,id:t,type:"button",role:"switch","aria-checked":String(!!n),"aria-disabled":String(!!r),title:i??"Basculer"}),c=x("span",{className:"lg-switch-track"}),p=x("span",{className:"lg-switch-thumb"});d.append(c,p);let m=null;i&&a!=="none"&&(m=x("span",{className:"lg-switch-label"},i)),m&&a==="left"?l.append(m,d):m&&a==="right"?l.append(d,m):l.append(d);let b=!!n,g=!!r;function w(){d.classList.toggle("on",b),d.setAttribute("aria-checked",String(b)),d.disabled=g,d.setAttribute("aria-disabled",String(g));}function _(S=false){g||(b=!b,w(),S||s?.(b));}function C(S){S.preventDefault(),_();}function E(S){g||((S.key===" "||S.key==="Enter")&&(S.preventDefault(),_()),S.key==="ArrowLeft"&&(S.preventDefault(),O(false)),S.key==="ArrowRight"&&(S.preventDefault(),O(true)));}d.addEventListener("click",C),d.addEventListener("keydown",E);function P(){return b}function O(S,R=false){b=!!S,w(),R||s?.(b);}function F(S){g=!!S,w();}function A(S){if(!S){m&&(m.remove(),m=null);return}m?m.textContent=S:(m=x("span",{className:"lg-switch-label"},S),l.append(m));}function T(){d.focus();}function M(){d.removeEventListener("click",C),d.removeEventListener("keydown",E);}return w(),{root:l,button:d,isChecked:P,setChecked:O,setDisabled:F,setLabel:A,focus:T,destroy:M}}let kv=null,If=null;function NS(){return kv}function DS(e){kv=e,If=null;}function _v(){return If}function $S(e){If=e;}function BS(){try{const e=window.visualViewport,t=Math.round((e?.width??window.innerWidth)||0),n=Math.round((e?.height??window.innerHeight)||0);if(t&&n)return t>=n?"landscape":"portrait"}catch{}return "unknown"}function Av(){const e=navigator.userAgent||"",t=navigator.platform||"",n=navigator.userAgentData;if(n&&typeof n.platform=="string"){const o=n.platform.toLowerCase();if(o.includes("windows"))return "windows";if(o.includes("mac"))return "mac";if(o.includes("android"))return "android";if(o.includes("chrome os")||o.includes("cros"))return "chromeos";if(o.includes("linux"))return "linux";if(o.includes("ios"))return "ios"}return /iPhone|iPad|iPod/i.test(e)||t==="MacIntel"&&(navigator.maxTouchPoints??0)>1?"ios":/Android/i.test(e)?"android":/CrOS/i.test(e)?"chromeos":/Win/i.test(e)?"windows":/Mac/i.test(e)?"mac":/Linux/i.test(e)?"linux":"unknown"}function Ev(){const e=navigator.userAgent||"",t=navigator.userAgentData;if(t&&Array.isArray(t.brands)){const n=t.brands.map(a=>String(a.brand||a.brandName||a.brandVersion||a)),r=n.some(a=>/Edge/i.test(a)||/Microsoft Edge/i.test(a)),o=n.some(a=>/Opera/i.test(a)||/OPR/i.test(a)),i=n.some(a=>/Chrome|Chromium/i.test(a));if(r)return "Edge";if(o)return "Opera";if(i)return "Chrome";if(navigator.brave)return "Brave"}return /FxiOS/i.test(e)?"Firefox":/CriOS/i.test(e)?"Chrome":/EdgiOS/i.test(e)?"Edge":/OPiOS|OPR|Opera Mini|Opera/i.test(e)?"Opera":/Edg\//i.test(e)?"Edge":/OPR\//i.test(e)||/Opera/i.test(e)?"Opera":/Firefox/i.test(e)?"Firefox":/Safari/i.test(e)&&!/Chrome|Chromium|Edg|OPR/i.test(e)?"Safari":/Brave/i.test(e)||window.Brave||navigator.brave?"Brave":/Chrome|Chromium/i.test(e)?"Chrome":"Unknown"}function zS(){const e=NS();if(e)return e;const t=navigator.userAgent||"",n=navigator.userAgentData;return n&&typeof n.mobile=="boolean"?n.mobile?"mobile":"desktop":/Android|iPhone|iPad|iPod|Mobile/i.test(t)?"mobile":"desktop"}function jS(e){if(!e)return null;try{return new URL(e).hostname}catch{return null}}function Tv(){try{return window.top!==window.self}catch{return  true}}function GS(){const e=Tv(),t=jS(document.referrer);return e&&!!t&&/(^|\.)discord(app)?\.com$/i.test(t)?"discord":"web"}function rd(){const e=_v();if(e)return e;const t=GS(),n=zS(),r=Av(),o=Ev(),i=Tv(),a=window.screen||{},s=window.visualViewport,l=Math.round(window.innerWidth||document.documentElement.clientWidth||0),d=Math.round(window.innerHeight||document.documentElement.clientHeight||0),c=Math.round(s?.width??l),p=Math.round(s?.height??d),m=Math.round(a.width||0),b=Math.round(a.height||0),g=Math.round(a.availWidth||m),w=Math.round(a.availHeight||b),_=Number.isFinite(window.devicePixelRatio)?window.devicePixelRatio:1,C={surface:t,host:location.hostname,origin:location.origin,isInIframe:i,platform:n,browser:o,os:r,viewportWidth:l,viewportHeight:d,visualViewportWidth:c,visualViewportHeight:p,screenWidth:m,screenHeight:b,availScreenWidth:g,availScreenHeight:w,dpr:_,orientation:BS()};return $S(C),C}function HS(){return rd().surface==="discord"}function US(){return rd().platform==="mobile"}function WS(){rd();}function VS(){return _v()!==null}const Wt={init:WS,isReady:VS,detect:rd,isDiscord:HS,isMobile:US,detectOS:Av,detectBrowser:Ev,setPlatformOverride:DS};let Ec=false;const ga=new Set;function qS(e=document){let t=e.activeElement||null;for(;t&&t.shadowRoot&&t.shadowRoot.activeElement;)t=t.shadowRoot.activeElement;return t}const kn=e=>{const t=qS();if(t){for(const n of ga)if(t===n||n.contains(t)){e.stopImmediatePropagation(),e.stopPropagation();return}}};function XS(){Ec||(Ec=true,window.addEventListener("keydown",kn,true),window.addEventListener("keypress",kn,true),window.addEventListener("keyup",kn,true),document.addEventListener("keydown",kn,true),document.addEventListener("keypress",kn,true),document.addEventListener("keyup",kn,true));}function KS(){Ec&&(Ec=false,window.removeEventListener("keydown",kn,true),window.removeEventListener("keypress",kn,true),window.removeEventListener("keyup",kn,true),document.removeEventListener("keydown",kn,true),document.removeEventListener("keypress",kn,true),document.removeEventListener("keyup",kn,true));}function YS(e){return ga.size===0&&XS(),ga.add(e),()=>{ga.delete(e),ga.size===0&&KS();}}function JS(e,t,n,r){let o;switch(e){case "digits":o="0-9";break;case "alpha":o="\\p{L}";break;case "alphanumeric":o="\\p{L}0-9";break;default:return null}return t&&(o+=" "),n&&(o+="\\-"),r&&(o+="_"),new RegExp(`[^${o}]`,"gu")}function QS(e,t){return t?e.replace(t,""):e}function ZS(e,t=0){if(!t)return e;let n;return((...r)=>{clearTimeout(n),n=setTimeout(()=>e(...r),t);})}function od(e={}){const{id:t,placeholder:n="",value:r="",mode:o="any",allowSpaces:i=false,allowDashes:a=false,allowUnderscore:s=false,maxLength:l,blockGameKeys:d=true,debounceMs:c=0,onChange:p,onEnter:m,label:b}=e,g=x("div",{className:"lg-input-wrap"}),w=x("input",{className:"input",id:t,placeholder:n});if(typeof l=="number"&&l>0&&(w.maxLength=l),r&&(w.value=r),b){const z=x("div",{className:"lg-input-label"},b);g.appendChild(z);}g.appendChild(w);const _=JS(o,i,a,s),C=()=>{const z=w.selectionStart??w.value.length,j=w.value.length,q=QS(w.value,_);if(q!==w.value){w.value=q;const U=j-q.length,ce=Math.max(0,z-U);w.setSelectionRange(ce,ce);}},E=ZS(()=>p?.(w.value),c);w.addEventListener("input",()=>{C(),E();}),w.addEventListener("paste",()=>queueMicrotask(()=>{C(),E();})),w.addEventListener("keydown",z=>{z.key==="Enter"&&m?.(w.value);});const P=d?YS(w):()=>{};function O(){return w.value}function F(z){w.value=z??"",C(),E();}function A(){w.focus();}function T(){w.blur();}function M(z){w.disabled=!!z;}function S(){return document.activeElement===w}function R(){P();}return {root:g,input:w,getValue:O,setValue:F,focus:A,blur:T,setDisabled:M,isFocused:S,destroy:R}}function Nt(e,t,n){return Math.min(n,Math.max(t,e))}function La({h:e,s:t,v:n,a:r}){const o=(e%360+360)%360/60,i=n*t,a=i*(1-Math.abs(o%2-1));let s=0,l=0,d=0;switch(Math.floor(o)){case 0:s=i,l=a;break;case 1:s=a,l=i;break;case 2:l=i,d=a;break;case 3:l=a,d=i;break;case 4:s=a,d=i;break;default:s=i,d=a;break}const p=n-i,m=Math.round((s+p)*255),b=Math.round((l+p)*255),g=Math.round((d+p)*255);return {r:Nt(m,0,255),g:Nt(b,0,255),b:Nt(g,0,255),a:Nt(r,0,1)}}function Iv({r:e,g:t,b:n,a:r}){const o=Nt(e,0,255)/255,i=Nt(t,0,255)/255,a=Nt(n,0,255)/255,s=Math.max(o,i,a),l=Math.min(o,i,a),d=s-l;let c=0;d!==0&&(s===o?c=60*((i-a)/d%6):s===i?c=60*((a-o)/d+2):c=60*((o-i)/d+4)),c<0&&(c+=360);const p=s===0?0:d/s;return {h:c,s:p,v:s,a:Nt(r,0,1)}}function Pf({r:e,g:t,b:n}){const r=o=>Nt(Math.round(o),0,255).toString(16).padStart(2,"0");return `#${r(e)}${r(t)}${r(n)}`.toUpperCase()}function e1({r:e,g:t,b:n,a:r}){const o=Nt(Math.round(r*255),0,255);return `${Pf({r:e,g:t,b:n})}${o.toString(16).padStart(2,"0")}`.toUpperCase()}function ma({r:e,g:t,b:n,a:r}){const o=Math.round(r*1e3)/1e3;return `rgba(${e}, ${t}, ${n}, ${o})`}function ei(e){let t=e.trim();if(!t||(t.startsWith("#")&&(t=t.slice(1)),![3,4,6,8].includes(t.length))||!/^[0-9a-fA-F]+$/.test(t))return null;(t.length===3||t.length===4)&&(t=t.split("").map(a=>a+a).join(""));let n=255;t.length===8&&(n=parseInt(t.slice(6,8),16),t=t.slice(0,6));const r=parseInt(t.slice(0,2),16),o=parseInt(t.slice(2,4),16),i=parseInt(t.slice(4,6),16);return {r,g:o,b:i,a:n/255}}function up(e){if(!e)return null;const t=e.trim();if(t.startsWith("#"))return ei(t);const n=t.match(/^rgba?\(([^)]+)\)$/i);if(n){const r=n[1].split(",").map(l=>l.trim());if(r.length<3)return null;const o=Number(r[0]),i=Number(r[1]),a=Number(r[2]),s=r[3]!=null?Number(r[3]):1;return [o,i,a,s].some(l=>Number.isNaN(l))?null:{r:o,g:i,b:a,a:s}}return null}function t1(e,t){const n=up(e)??ei(e??"")??{r:244,g:67,b:54,a:1};return typeof t=="number"&&(n.a=Nt(t,0,1)),Iv(n)}function n1(e){return `#${e.trim().replace(/[^0-9a-fA-F#]/g,"").replace(/#/g,"")}`.slice(0,9).toUpperCase()}function r1(e){let t=e.trim();return t&&(/^rgba?\s*\(/i.test(t)?t=t.replace(/^rgba?/i,"rgba"):(t=t.replace(/^\(?(.*)\)?$/,"$1"),t=`rgba(${t})`),t=t.replace(/\s*\(\s*/,"("),t=t.replace(/\s*\)\s*$/,")"),t=t.replace(/\s*,\s*/g,", "),t)}function oo(e){const t=La(e),n=La({...e,a:1});return {hsva:{...e},hex:Pf(n),hexa:e1(t),rgba:ma(t),alpha:e.a}}function o1(e={}){const{id:t,label:n="Color",value:r,alpha:o,defaultExpanded:i=false,detectMobile:a,onInput:s,onChange:l}=e,c=a?a():Wt.detect().platform==="mobile";let p=t1(r,o);const m=ft({id:t,className:"color-picker",title:n,padding:c?"md":"lg",variant:"soft",expandable:!c,defaultExpanded:!c&&i});m.classList.add(c?"color-picker--mobile":"color-picker--desktop");const b=m.querySelector(".card-header");b&&b.classList.add("color-picker__header");const g=b?.querySelector(".card-title"),w=x("button",{className:"color-picker__preview",type:"button",title:`Preview ${n}`,"aria-label":`Change ${n}`});g?g.prepend(w):b?b.prepend(w):m.prepend(w);const _=m.querySelector(".card-toggle");!c&&_&&w.addEventListener("click",()=>{m.classList.contains("card--collapsed")&&_.click();});const C=m.querySelector(".card-collapse");let E=null,P=null,O=null,F=null,A=null,T=null,M=null,S=null,R=null,z="hex";function j(te){const ne=oo(p);te==="input"?s?.(ne):l?.(ne);}function q(){const te=oo(p);if(w.style.setProperty("--cp-preview-color",te.rgba),w.setAttribute("aria-label",`${n}: ${te.hexa}`),!c&&E&&P&&O&&F&&A&&T&&M){const ne=La({...p,s:1,v:1,a:1}),ie=ma(ne);E.style.setProperty("--cp-palette-hue",ie),P.style.left=`${p.s*100}%`,P.style.top=`${(1-p.v)*100}%`,O.style.setProperty("--cp-alpha-gradient",`linear-gradient(180deg, ${ma({...ne,a:1})} 0%, ${ma({...ne,a:0})} 100%)`),F.style.top=`${(1-p.a)*100}%`,A.style.setProperty("--cp-hue-color",ma(La({...p,v:1,s:1,a:1}))),T.style.left=`${p.h/360*100}%`;const ee=p.a===1?te.hex:te.hexa,H=te.rgba,K=z==="hex"?ee:H;M!==document.activeElement&&(M.value=K),M.setAttribute("aria-label",`${z.toUpperCase()} code for ${n}`),M.placeholder=z==="hex"?"#RRGGBB or #RRGGBBAA":"rgba(0, 0, 0, 1)",z==="hex"?M.maxLength=9:M.removeAttribute("maxLength"),M.dataset.mode=z,S&&(S.textContent=z.toUpperCase(),S.setAttribute("aria-label",z==="hex"?"Passer en saisie RGBA":"Revenir en saisie HEX"),S.setAttribute("aria-pressed",z==="rgba"?"true":"false"),S.classList.toggle("is-alt",z==="rgba"));}R&&R!==document.activeElement&&(R.value=te.hex);}function U(te,ne=null){p={h:(te.h%360+360)%360,s:Nt(te.s,0,1),v:Nt(te.v,0,1),a:Nt(te.a,0,1)},q(),ne&&j(ne);}function ce(te,ne=null){U(Iv(te),ne);}function W(te,ne,ie){te.addEventListener("pointerdown",ee=>{ee.preventDefault();const H=ee.pointerId,K=B=>{B.pointerId===H&&ne(B);},D=B=>{B.pointerId===H&&(document.removeEventListener("pointermove",K),document.removeEventListener("pointerup",D),document.removeEventListener("pointercancel",D),ie?.(B));};ne(ee),document.addEventListener("pointermove",K),document.addEventListener("pointerup",D),document.addEventListener("pointercancel",D);});}if(!c&&C){const te=C.querySelector(".card-body");if(te){te.classList.add("color-picker__body"),P=x("div",{className:"color-picker__palette-cursor"}),E=x("div",{className:"color-picker__palette"},P),F=x("div",{className:"color-picker__alpha-thumb"}),O=x("div",{className:"color-picker__alpha"},F),T=x("div",{className:"color-picker__hue-thumb"}),A=x("div",{className:"color-picker__hue"},T);const ne=x("div",{className:"color-picker__main"},E,O),ie=x("div",{className:"color-picker__hue-row"},A),ee=od({blockGameKeys:true});M=ee.input,M.classList.add("color-picker__hex-input"),M.value="",M.maxLength=9,M.spellcheck=false,M.inputMode="text",M.setAttribute("aria-label",`Hex code for ${n}`),S=x("button",{type:"button",className:"color-picker__mode-btn",textContent:"HEX","aria-pressed":"false","aria-label":"Passer en saisie RGBA"}),ee.root.classList.add("color-picker__hex-wrap");const H=x("div",{className:"color-picker__hex-row"},S,ee.root);te.replaceChildren(ne,ie,H),W(E,D=>{if(!E||!P)return;const B=E.getBoundingClientRect(),Q=Nt((D.clientX-B.left)/B.width,0,1),ae=Nt((D.clientY-B.top)/B.height,0,1);U({...p,s:Q,v:1-ae},"input");},()=>j("change")),W(O,D=>{if(!O)return;const B=O.getBoundingClientRect(),Q=Nt((D.clientY-B.top)/B.height,0,1);U({...p,a:1-Q},"input");},()=>j("change")),W(A,D=>{if(!A)return;const B=A.getBoundingClientRect(),Q=Nt((D.clientX-B.left)/B.width,0,1);U({...p,h:Q*360},"input");},()=>j("change")),S.addEventListener("click",()=>{if(z=z==="hex"?"rgba":"hex",M){const D=oo(p);M.value=z==="hex"?p.a===1?D.hex:D.hexa:D.rgba;}q(),M?.focus(),M?.select();}),M.addEventListener("input",()=>{if(z==="hex"){const D=n1(M.value);if(D!==M.value){const B=M.selectionStart??D.length;M.value=D,M.setSelectionRange(B,B);}}});const K=()=>{const D=M.value;if(z==="hex"){const B=ei(D);if(!B){M.value=p.a===1?oo(p).hex:oo(p).hexa;return}const Q=D.startsWith("#")?D.slice(1):D,ae=Q.length===4||Q.length===8;B.a=ae?B.a:p.a,ce(B,"change");}else {const B=r1(D),Q=up(B);if(!Q){M.value=oo(p).rgba;return}ce(Q,"change");}};M.addEventListener("change",K),M.addEventListener("blur",K),M.addEventListener("keydown",D=>{D.key==="Enter"&&(K(),M.blur());});}}return c&&(C&&C.remove(),R=x("input",{className:"color-picker__native",type:"color",value:Pf(La({...p,a:1}))}),w.addEventListener("click",()=>R.click()),R.addEventListener("input",()=>{const te=ei(R.value);te&&(te.a=p.a,ce(te,"input"),j("change"));}),m.appendChild(R)),q(),{root:m,isMobile:c,getValue:()=>oo(p),setValue:(te,ne)=>{const ie=up(te)??ei(te)??ei("#FFFFFF");ie&&(typeof ne=="number"&&(ie.a=ne),ce(ie,null));}}}const i1=window;function a1(){if(typeof unsafeWindow<"u"&&unsafeWindow)return unsafeWindow;const e=window.wrappedJSObject;return e&&e!==window?e:i1}const s1=a1(),he=s1;function l1(e){try{return !!e.isSecureContext}catch{return  false}}function Mf(e){const t=e?.getRootNode?.();return t&&(t instanceof Document||t.host)?t:document}function Pv(){const e=navigator.platform||"",t=navigator.userAgent||"";return /Mac|iPhone|iPad|iPod/i.test(e)||/Mac OS|iOS/i.test(t)}async function c1(){try{const e=await navigator.permissions?.query?.({name:"clipboard-write"});return e?e.state==="granted"||e.state==="prompt":!0}catch{return  true}}function d1(e,t){const n=document.createElement("textarea");return n.value=e,n.setAttribute("readonly","true"),n.style.position="fixed",n.style.opacity="0",n.style.pointerEvents="none",n.style.top="0",t.appendChild?t.appendChild(n):document.body.appendChild(n),n}function u1(e){try{const t=window.getSelection?.();if(!t)return !1;const n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),!0}catch{return  false}}async function p1(e){if(!("clipboard"in navigator))return {ok:false,method:"clipboard-write"};if(!l1(he))return {ok:false,method:"clipboard-write"};if(!await c1())return {ok:false,method:"clipboard-write"};try{return await navigator.clipboard.writeText(e),{ok:!0,method:"clipboard-write"}}catch{return {ok:false,method:"clipboard-write"}}}function f1(e,t){try{const n=t||Mf(),r=d1(e,n);r.focus(),r.select(),r.setSelectionRange(0,r.value.length);let o=!1;try{o=document.execCommand("copy");}catch{o=!1;}return r.remove(),{ok:o,method:"execCommand"}}catch{return {ok:false,method:"execCommand"}}}function h1(e,t){if(!t)return {ok:false,method:"selection"};const n=t.textContent??"";let r=false;if(n!==e)try{t.textContent=e,r=!0;}catch{}const o=u1(t);r&&setTimeout(()=>{try{t.textContent=n;}catch{}},80);const i=Pv()?"⌘C pour copier":"Ctrl+C pour copier";return {ok:o,method:"selection",hint:i}}async function g1(e,t={}){const n=(e??"").toString();if(!n.length)return {ok:false,method:"noop"};const r=await p1(n);if(r.ok)return r;const o=t.injectionRoot||Mf(t.valueNode||void 0),i=f1(n,o);if(i.ok)return i;const a=h1(n,t.valueNode||null);if(a.ok)return a;if(!t.disablePromptFallback)try{return window.prompt(Wt.isDiscord()?"Copie manuelle (Discord bloque clipboard):":"Copie manuelle:",n),{ok:!0,method:"prompt"}}catch{}return {ok:false,method:"noop"}}function m1(e,t,n={}){const r=o=>{if(n.showTip){n.showTip(o);return}try{e.setAttribute("aria-label",o);const i=document.createElement("div");i.textContent=o,i.style.position="absolute",i.style.top="-28px",i.style.right="0",i.style.padding="4px 8px",i.style.borderRadius="8px",i.style.fontSize="12px",i.style.background="color-mix(in oklab, var(--bg) 85%, transparent)",i.style.border="1px solid var(--border)",i.style.color="var(--fg)",i.style.pointerEvents="none",i.style.opacity="0",i.style.transition="opacity .12s";const a=Mf(e);a.appendChild?a.appendChild(i):document.body.appendChild(i);const s=e.getBoundingClientRect();i.style.left=`${s.right-8}px`,i.style.top=`${s.top-28}px`,requestAnimationFrame(()=>i.style.opacity="1"),setTimeout(()=>{i.style.opacity="0",setTimeout(()=>i.remove(),150);},1200);}catch{}};e.addEventListener("click",async o=>{o.stopPropagation();const i=(t()??"").toString(),a=await g1(i,{valueNode:n.valueNode??null,injectionRoot:n.injectionRoot??null,disablePromptFallback:n.disablePromptFallback??false});n.onResult?.(a),a.ok?a.method==="clipboard-write"||a.method==="execCommand"||a.method==="prompt"?r("Copié"):a.method==="selection"&&r(a.hint||(Pv()?"⌘C pour copier":"Ctrl+C pour copier")):r("Impossible de copier");});}const ai={light:{"--bg":"rgba(255,255,255,0.7)","--fg":"#0f172a","--muted":"rgba(15,23,42,0.06)","--soft":"rgba(15,23,42,0.04)","--accent":"#2563eb","--border":"rgba(15,23,42,0.12)","--shadow":"rgba(2,6,23,.2)","--paper":"#FDFBF7","--tab-bg":"#ffffff","--tab-fg":"#0f172a","--pill-from":"#4f46e5","--pill-to":"#06b6d4","--low":"#dc2626","--medium":"#f59e0b","--high":"#16a34a","--complete":"#15803d","--info":"#2563eb","--xp-fill":"#0febff","--accent-1":"#16a34a","--accent-2":"#7c3aed","--mut-rainbow":"#FF00FF","--mut-gold":"#EBC800","--mut-wet":"#5FFFFF","--mut-chilled":"#B4E6FF","--mut-frozen":"#B9C8FF","--mut-dawnlit":"#F59BE1","--mut-dawncharged":"#C896FF","--mut-ambershine":"#FFB478","--mut-ambercharged":"#FA8C4B","--rarity-common":"#E7E7E7","--rarity-uncommon":"#67BD4D","--rarity-rare":"#0071C6","--rarity-legendary":"#FFC734","--rarity-mythical":"#9944A7","--rarity-divine":"#FF7835","--rarity-celestial":"#FF00FF","--rainbow-text-gradient":"linear-gradient(90deg, #b000b0, #d00000, #b08000, #008000, #0000b0, #4b0082, #9400d3)","--switch-thumb":"#ffffff","--journal-ink":"#333333"},dark:{"--bg":"rgba(10,12,18,0.6)","--fg":"#e5e7eb","--muted":"rgba(229,231,235,0.08)","--soft":"rgba(229,231,235,0.05)","--accent":"#60a5fa","--border":"rgba(148,163,184,0.2)","--shadow":"rgba(0,0,0,.45)","--paper":"#1a1d24","--tab-bg":"rgba(255,255,255,0.08)","--tab-fg":"#e5e7eb","--pill-from":"#6366f1","--pill-to":"#06b6d4","--low":"#ef4444","--medium":"#f59e0b","--high":"#22c55e","--complete":"#16a34a","--info":"#3b82f6","--xp-fill":"#0febff","--accent-1":"#22c55e","--accent-2":"#a855f7","--mut-rainbow":"#FF00FF","--mut-gold":"#EBC800","--mut-wet":"#5FFFFF","--mut-chilled":"#B4E6FF","--mut-frozen":"#B9C8FF","--mut-dawnlit":"#F59BE1","--mut-dawncharged":"#C896FF","--mut-ambershine":"#FFB478","--mut-ambercharged":"#FA8C4B","--rarity-common":"#E7E7E7","--rarity-uncommon":"#67BD4D","--rarity-rare":"#0071C6","--rarity-legendary":"#FFC734","--rarity-mythical":"#9944A7","--rarity-divine":"#FF7835","--rarity-celestial":"#FF00FF","--rainbow-text-gradient":"linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #00ffff, #ff00ff)","--switch-thumb":"#ffffff","--journal-ink":"#ffffff"},sepia:{"--bg":"rgba(247,242,231,0.72)","--fg":"#3b2f2f","--muted":"rgba(59,47,47,0.06)","--soft":"rgba(59,47,47,0.04)","--accent":"#b07d62","--border":"rgba(59,47,47,0.14)","--shadow":"rgba(0,0,0,.18)","--paper":"#F5E6D3","--tab-bg":"#fff","--tab-fg":"#3b2f2f","--pill-from":"#b07d62","--pill-to":"#d4a373","--low":"#c2410c","--medium":"#d97706","--high":"#15803d","--complete":"#166534","--info":"#1d4ed8","--accent-1":"#15803d","--accent-2":"#6b21a8","--mut-rainbow":"#FF00FF","--mut-gold":"#EBC800","--mut-wet":"#5FFFFF","--mut-chilled":"#B4E6FF","--mut-frozen":"#B9C8FF","--mut-dawnlit":"#F59BE1","--mut-dawncharged":"#C896FF","--mut-ambershine":"#FFB478","--mut-ambercharged":"#FA8C4B","--rarity-common":"#E7E7E7","--rarity-uncommon":"#67BD4D","--rarity-rare":"#0071C6","--rarity-legendary":"#FFC734","--rarity-mythical":"#9944A7","--rarity-divine":"#FF7835","--rarity-celestial":"#FF00FF","--rainbow-text-gradient":"linear-gradient(90deg, #b000b0, #d00000, #b08000, #008000, #0000b0, #4b0082, #9400d3)","--switch-thumb":"#ffffff","--journal-ink":"#3b2f2f"},forest:{"--bg":"rgba(14,24,18,0.62)","--fg":"#e7f5e9","--muted":"rgba(231,245,233,0.08)","--soft":"rgba(231,245,233,0.05)","--accent":"#34d399","--border":"rgba(231,245,233,0.16)","--shadow":"rgba(0,0,0,.5)","--paper":"#1e2820","--tab-bg":"rgba(255,255,255,0.06)","--tab-fg":"#e7f5e9","--pill-from":"#10b981","--pill-to":"#84cc16","--low":"#dc2626","--medium":"#eab308","--high":"#22c55e","--complete":"#16a34a","--info":"#06b6d4","--accent-1":"#22c55e","--accent-2":"#8b5cf6","--mut-rainbow":"#FF00FF","--mut-gold":"#EBC800","--mut-wet":"#5FFFFF","--mut-chilled":"#B4E6FF","--mut-frozen":"#B9C8FF","--mut-dawnlit":"#F59BE1","--mut-dawncharged":"#C896FF","--mut-ambershine":"#FFB478","--mut-ambercharged":"#FA8C4B","--rarity-common":"#E7E7E7","--rarity-uncommon":"#67BD4D","--rarity-rare":"#0071C6","--rarity-legendary":"#FFC734","--rarity-mythical":"#9944A7","--rarity-divine":"#FF7835","--rarity-celestial":"#FF00FF","--rainbow-text-gradient":"linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #00ffff, #ff00ff)","--switch-thumb":"#ffffff","--journal-ink":"#ffffff"},violet:{"--bg":"rgba(23, 16, 42, 0.68)","--fg":"#f5f3ff","--muted":"rgba(245,243,255,0.08)","--soft":"rgba(245,243,255,0.05)","--accent":"#a855f7","--border":"rgba(216,180,254,0.22)","--shadow":"rgba(12,3,30,.55)","--paper":"#1a1424","--tab-bg":"rgba(255,255,255,0.08)","--tab-fg":"#ede9fe","--pill-from":"#a855f7","--pill-to":"#f472b6","--low":"#f43f5e","--medium":"#fbbf24","--high":"#4ade80","--complete":"#22c55e","--info":"#60a5fa","--accent-1":"#4ade80","--accent-2":"#c084fc","--mut-rainbow":"#FF00FF","--mut-gold":"#EBC800","--mut-wet":"#5FFFFF","--mut-chilled":"#B4E6FF","--mut-frozen":"#B9C8FF","--mut-dawnlit":"#F59BE1","--mut-dawncharged":"#C896FF","--mut-ambershine":"#FFB478","--mut-ambercharged":"#FA8C4B","--rarity-common":"#E7E7E7","--rarity-uncommon":"#67BD4D","--rarity-rare":"#0071C6","--rarity-legendary":"#FFC734","--rarity-mythical":"#9944A7","--rarity-divine":"#FF7835","--rarity-celestial":"#FF00FF","--rainbow-text-gradient":"linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #00ffff, #ff00ff)","--switch-thumb":"#ffffff","--journal-ink":"#ffffff"},ocean:{"--bg":"rgba(10, 34, 46, 0.66)","--fg":"#e0f7ff","--muted":"rgba(224,247,255,0.07)","--soft":"rgba(224,247,255,0.05)","--accent":"#38bdf8","--border":"rgba(125, 211, 252, 0.22)","--shadow":"rgba(0, 16, 32, .52)","--paper":"#0f2027","--tab-bg":"rgba(56,189,248,0.14)","--tab-fg":"#e0f7ff","--pill-from":"#0ea5e9","--pill-to":"#14b8a6","--low":"#f43f5e","--medium":"#fbbf24","--high":"#34d399","--complete":"#10b981","--info":"#38bdf8","--accent-1":"#22c55e","--accent-2":"#a78bfa","--mut-rainbow":"#FF00FF","--mut-gold":"#EBC800","--mut-wet":"#5FFFFF","--mut-chilled":"#B4E6FF","--mut-frozen":"#B9C8FF","--mut-dawnlit":"#F59BE1","--mut-dawncharged":"#C896FF","--mut-ambershine":"#FFB478","--mut-ambercharged":"#FA8C4B","--rarity-common":"#E7E7E7","--rarity-uncommon":"#67BD4D","--rarity-rare":"#0071C6","--rarity-legendary":"#FFC734","--rarity-mythical":"#9944A7","--rarity-divine":"#FF7835","--rarity-celestial":"#FF00FF","--rainbow-text-gradient":"linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #00ffff, #ff00ff)","--switch-thumb":"#ffffff","--journal-ink":"#ffffff"},ember:{"--bg":"rgba(34,18,10,0.64)","--fg":"#fff7ed","--muted":"rgba(255,247,237,0.08)","--soft":"rgba(255,247,237,0.05)","--accent":"#f97316","--border":"rgba(255, 159, 92, 0.24)","--shadow":"rgba(16,6,2,.52)","--paper":"#1a1210","--tab-bg":"rgba(255,247,237,0.09)","--tab-fg":"#fff7ed","--pill-from":"#fb923c","--pill-to":"#facc15","--low":"#dc2626","--medium":"#f59e0b","--high":"#22c55e","--complete":"#16a34a","--info":"#38bdf8","--accent-1":"#22c55e","--accent-2":"#c084fc","--mut-rainbow":"#FF00FF","--mut-gold":"#EBC800","--mut-wet":"#5FFFFF","--mut-chilled":"#B4E6FF","--mut-frozen":"#B9C8FF","--mut-dawnlit":"#F59BE1","--mut-dawncharged":"#C896FF","--mut-ambershine":"#FFB478","--mut-ambercharged":"#FA8C4B","--rarity-common":"#E7E7E7","--rarity-uncommon":"#67BD4D","--rarity-rare":"#0071C6","--rarity-legendary":"#FFC734","--rarity-mythical":"#9944A7","--rarity-divine":"#FF7835","--rarity-celestial":"#FF00FF","--rainbow-text-gradient":"linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #00ffff, #ff00ff)","--switch-thumb":"#ffffff","--journal-ink":"#ffffff"},magicGarden:{"--bg":"#201D1D","--fg":"#F5F5F5","--muted":"rgba(255,255,255,0.6)","--soft":"rgba(0,0,0,0.3)","--accent":"#FFF27D","--border":"rgba(255,255,255,0.1)","--border-accent":"#4A3B2E","--shadow":"rgba(0,0,0,0.5)","--paper":"#FDFBF7","--card-shadow":"0 4px 10px rgba(0, 0, 0, 0.5)","--tab-bg":"#10725A","--tab-fg":"#F5F5F5","--section-title":"#10725A","--group-title":"#5EB292","--item-label":"#F5F5F5","--item-desc":"rgba(255,255,255,0.6)","--item-value":"#FFF27D","--card-bg":"rgba(0,0,0,0.3)","--card-radius":"12px","--card-border":"#4A3B2E","--pill-from":"#FFF27D","--pill-to":"#5EB292","--scrollbar-thumb":"rgba(255,255,255,0.2)","--scrollbar-thumb-hover":"rgba(255,255,255,0.3)","--low":"#F98B4B","--medium":"#F3D32B","--high":"#5EAC46","--complete":"#0B893F","--info":"#38bdf8","--accent-1":"#4caf50","--accent-2":"#9c27b0","--mut-rainbow":"#FF00FF","--mut-gold":"#EBC800","--mut-wet":"#5FFFFF","--mut-chilled":"#B4E6FF","--mut-frozen":"#B9C8FF","--mut-dawnlit":"#F59BE1","--mut-dawncharged":"#C896FF","--mut-ambershine":"#FFB478","--mut-ambercharged":"#FA8C4B","--rarity-common":"#E7E7E7","--rarity-uncommon":"#67BD4D","--rarity-rare":"#0071C6","--rarity-legendary":"#FFC734","--rarity-mythical":"#9944A7","--rarity-divine":"#FF7835","--rarity-celestial":"#FF00FF","--rainbow-text-gradient":"linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #00ffff, #ff00ff)","--switch-thumb":"#ffffff","--journal-ink":"#000000"}};function b1(e){const{host:t,themes:n,initialTheme:r,onThemeChange:o}=e;let i=r,a=null,s=false;function l(c){const p=n[c]||n[i]||{};t.setAttribute("data-theme",c),s&&t.classList.add("theme-anim");for(const[m,b]of Object.entries(p))t.style.setProperty(m,b);s?(a!==null&&clearTimeout(a),a=he.setTimeout(()=>{t.classList.remove("theme-anim"),a=null;},320)):s=true,i=c,o?.(c);}function d(){return i}return l(r),{applyTheme:l,getCurrentTheme:d}}const pp={ui:{expandedCards:{style:false,hudSections:false,enhancements:false,journal:false,system:false}}};async function v1(){const e=await Kr("tab-settings",{version:2,defaults:pp,sanitize:o=>({ui:{expandedCards:Ci(pp.ui.expandedCards,o.ui?.expandedCards)}})});function t(o){const i=e.get();e.update({ui:{...i.ui,...o,expandedCards:Ci(i.ui.expandedCards,o.expandedCards)}});}function n(o,i){const a=e.get();e.update({ui:{...a.ui,expandedCards:{...a.ui.expandedCards,[o]:!!i}}});}function r(o){const i=e.get();n(o,!i.ui.expandedCards[o]);}return {get:e.get,set:e.set,save:e.save,setUI:t,setCardExpanded:n,toggleCard:r}}class y1{constructor(){de(this,"injections",new Map);de(this,"state",{});de(this,"initialized",false);}register(t){if(this.injections.has(t.id)){console.warn(`[InjectionRegistry] ${t.id} already registered`);return}this.injections.set(t.id,t),this.loadState(t.id),console.log(`[InjectionRegistry] Registered: ${t.name}`);}initAll(){if(!this.initialized){for(const[t,n]of this.injections)if(this.state[t]??n.defaultEnabled??false)try{n.injection.init();}catch(o){console.error(`[InjectionRegistry] Failed to init ${t}:`,o);}this.initialized=true,console.log("[InjectionRegistry] All injections initialized");}}destroyAll(){for(const[,t]of this.injections)try{t.injection.destroy();}catch(n){console.error(`[InjectionRegistry] Failed to destroy ${t.id}:`,n);}this.initialized=false,console.log("[InjectionRegistry] All injections destroyed");}setEnabled(t,n){const r=this.injections.get(t);if(!r){console.warn(`[InjectionRegistry] Unknown injection: ${t}`);return}this.state[t]=n,this.saveState(t),n?r.injection.init():r.injection.destroy(),console.log(`[InjectionRegistry] ${r.name} ${n?"enabled":"disabled"}`);}getAll(){return Array.from(this.injections.values())}isEnabled(t){return this.state[t]??false}loadState(t){const n=this.injections.get(t);if(!n)return;const r=tt(n.storageKey,n.defaultEnabled??false);this.state[t]=r;}saveState(t){const n=this.injections.get(t);n&&rt(n.storageKey,this.state[t]);}}let fu=null;function Tc(){return fu||(fu=new y1),fu}function Mv(e){return e.replace(/[_-]+/g," ").replace(/^\w/,t=>t.toUpperCase())}function x1(){return Object.keys(ai).map(e=>({value:e,label:Mv(e)}))}const w1=["--bg","--fg","--accent","--muted","--soft","--border","--shadow","--paper","--tab-bg","--tab-fg","--pill-from","--pill-to","--low","--medium","--high","--complete","--info","--accent-1","--accent-2","--accent-3"];function C1(e){return Mv(e.replace(/^--/,""))}function S1(e){return e.alpha<1?e.rgba:e.hex}const xn={pets:{enabled:true},autoFavorite:{enabled:true},locker:{enabled:true},trackers:{enabled:true},alerts:{enabled:true},avatar:{enabled:true},room:{enabled:true},bulkFavorite:{enabled:false},cropSizeIndicator:{enabled:false},eggProbabilityIndicator:{enabled:false},cropValueIndicator:{enabled:true}};class k1 extends Tr{constructor(n){super({id:"tab-settings",label:"Settings"});de(this,"featureConfig",xn);this.deps=n;}async build(n){const r=this.createGrid("12px");r.id="settings",n.appendChild(r);let o;try{o=await v1();}catch{o={get:()=>pp,set:()=>{},save:()=>{},setUI:()=>{},setCardExpanded:()=>{},toggleCard:()=>{}};}const i=o.get(),a=tt(ut.CONFIG,{});this.featureConfig=this.mergeFeatureConfig(a);const s=Object.keys(ai),l=this.deps.getCurrentTheme?.()??this.deps.initialTheme,d=s.includes(l)?l:s[0]??"dark";let c=d;const p=Tf({text:"Theme",tone:"muted",size:"lg"}),m=Io({options:x1(),value:d,onChange:P=>{c=P,this.deps.applyTheme(P),this.renderThemePickers(P,b,c);}}),b=x("div",{className:"settings-theme-grid"}),g=ft({title:"Style",padding:"lg",expandable:true,defaultExpanded:!!i.ui.expandedCards.style,onExpandChange:P=>o.setCardExpanded("style",P)},x("div",{className:"kv settings-theme-row"},p.root,m.root),b);this.renderThemePickers(d,b,c);const w=this.createHUDSectionsCard({defaultExpanded:!!i.ui.expandedCards.hudSections,onExpandChange:P=>o.setCardExpanded("hudSections",P)}),_=this.createEnhancementsCard({defaultExpanded:!!i.ui.expandedCards.enhancements,onExpandChange:P=>o.setCardExpanded("enhancements",P)}),C=this.createJournalCard({defaultExpanded:!!i.ui.expandedCards.journal,onExpandChange:P=>o.setCardExpanded("journal",P)}),E=this.createEnvCard({defaultExpanded:!!i.ui.expandedCards.system,onExpandChange:P=>o.setCardExpanded("system",P)});r.appendChild(g),r.appendChild(w),r.appendChild(_),r.appendChild(C),r.appendChild(E);}mergeFeatureConfig(n){return {pets:{...xn.pets,...n.pets},autoFavorite:{...xn.autoFavorite,...n.autoFavorite},locker:{...xn.locker,...n.locker},trackers:{...xn.trackers,...n.trackers},alerts:{...xn.alerts,...n.alerts},avatar:{...xn.avatar,...n.avatar},room:{...xn.room,...n.room},bulkFavorite:{...xn.bulkFavorite,...n.bulkFavorite},cropSizeIndicator:{...xn.cropSizeIndicator,...n.cropSizeIndicator},eggProbabilityIndicator:{...xn.eggProbabilityIndicator,...n.eggProbabilityIndicator},cropValueIndicator:{...xn.cropValueIndicator,...n.cropValueIndicator}}}saveFeatureConfig(){rt(ut.CONFIG,this.featureConfig),console.log("[Settings] Feature config saved:",this.featureConfig);}createHUDSectionsCard(n){const r=(o,i,a,s,l=false,d=false)=>{const c=x("div",{style:`
          display: grid;
          grid-template-columns: 1fr auto;
          gap: 12px;
          padding: ${l?"0":"12px"} 0 ${d?"0":"12px"} 0;
          ${d?"":"border-bottom: 1px solid var(--border);"}
          transition: opacity 0.2s ease;
          opacity: ${i?"1":"0.5"};
        `}),p=x("div"),m=x("div",{style:"font-weight: 500; margin-bottom: 4px;"},o),b=x("div",{style:"font-size: 12px; color: var(--fg); opacity: 0.7;"},s);p.append(m,b);const g=Xr({checked:i,onChange:w=>{c.style.opacity=w?"1":"0.5",a(w);}});return c.append(p,g.root),c};return ft({title:"HUD Sections",padding:"lg",expandable:true,defaultExpanded:n?.defaultExpanded??false,onExpandChange:n?.onExpandChange},x("div",{},r("Auto-Favorite",this.featureConfig.autoFavorite.enabled,o=>{this.featureConfig.autoFavorite.enabled=o,this.saveFeatureConfig();},"Automatic mutation favoriting settings",true),r("Pets",this.featureConfig.pets.enabled,o=>{this.featureConfig.pets.enabled=o,this.saveFeatureConfig();},"Pet management and team tracking"),r("Locker",this.featureConfig.locker.enabled,o=>{this.featureConfig.locker.enabled=o,this.saveFeatureConfig();},"Configure crop, egg, and decor blockers"),r("Trackers",this.featureConfig.trackers.enabled,o=>{this.featureConfig.trackers.enabled=o,this.saveFeatureConfig();},"Resource and progress tracking"),r("Alerts",this.featureConfig.alerts.enabled,o=>{this.featureConfig.alerts.enabled=o,this.saveFeatureConfig();},"Event notifications and alerts"),r("Avatar",this.featureConfig.avatar.enabled,o=>{this.featureConfig.avatar.enabled=o,this.saveFeatureConfig();},"Avatar customization and loadouts"),r("Room",this.featureConfig.room.enabled,o=>{this.featureConfig.room.enabled=o,this.saveFeatureConfig();},"Public room browser",false,true)))}createSectionRow(n,r,o,i,a=false,s=false){const l=x("div",{style:`
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 12px;
        padding: ${a?"0":"12px"} 0 ${s?"0":"12px"} 0;
        ${s?"":"border-bottom: 1px solid var(--border);"}
        transition: opacity 0.2s ease;
        opacity: ${r?"1":"0.5"};
      `}),d=x("div"),c=x("div",{style:"font-weight: 500; margin-bottom: 4px;"},n),p=x("div",{style:"font-size: 12px; color: var(--fg); opacity: 0.7;"},i);d.append(c,p);const m=Xr({checked:r,onChange:b=>{l.style.opacity=b?"1":"0.5",o(b);}});return l.append(d,m.root),l}createEnhancementsCard(n){const r=Tc(),i=[...r.getAll().filter(s=>!this.isJournalInjection(s.id))].sort((s,l)=>s.name.localeCompare(l.name)),a=i.map((s,l)=>{const d=l===0,c=l===i.length-1,p=r.isEnabled(s.id);return this.createSectionRow(s.name,p,m=>{r.setEnabled(s.id,m),this.saveFeatureConfig();},s.description,d,c)});return ft({title:"In-Game Enhancements",variant:"soft",padding:"lg",expandable:true,defaultExpanded:n?.defaultExpanded??false,onExpandChange:n?.onExpandChange},x("div",{},...a))}createJournalCard(n){const r=Tc(),i=[...r.getAll().filter(s=>this.isJournalInjection(s.id)).filter(s=>s.id!=="journalHints"&&s.id!=="journalFilterSort")].sort((s,l)=>s.name.localeCompare(l.name)),a=i.map((s,l)=>{const d=l===0,c=l===i.length-1,p=r.isEnabled(s.id);return this.createSectionRow(s.name,p,m=>{r.setEnabled(s.id,m),this.saveFeatureConfig();},s.description,d,c)});return ft({title:"Journal",variant:"soft",padding:"lg",expandable:true,defaultExpanded:n?.defaultExpanded??false,onExpandChange:n?.onExpandChange},x("div",{},...a))}isJournalInjection(n){return n==="abilitiesInject"||n==="journalHints"||n==="journalFilterSort"||n==="journalAllTab"||n==="missingVariantsIndicator"}renderThemePickers(n,r,o){const i=ai[n];if(r.replaceChildren(),!!i)for(const a of w1){const s=i[a];if(s==null)continue;const l=o1({label:C1(a),value:s,defaultExpanded:false,onInput:d=>this.updateThemeVar(n,a,d,o),onChange:d=>this.updateThemeVar(n,a,d,o)});r.appendChild(l.root);}}updateThemeVar(n,r,o,i){const a=ai[n];a&&(a[r]=S1(o),i===n&&this.deps.applyTheme(n));}createEnvCard(n){const r=n?.defaultExpanded??false,o=n?.onExpandChange,i=(C,E)=>{const P=x("div",{className:"kv kv--inline-mobile"}),O=x("label",{},C),F=x("div",{className:"ro"});return typeof E=="string"?F.textContent=E:F.append(E),P.append(O,F),P},a=x("code",{},"—"),s=x("span",{},"—"),l=x("span",{},"—"),d=x("span",{},"—"),c=x("span",{},"—"),p=x("span",{},"—"),m=()=>{const C=Wt.detect();l.textContent=C.surface??"Unknown",d.textContent=C.platform??"Unknown",c.textContent=C.browser??"Unknown",p.textContent=C.os??"Unknown",a.textContent=C.host??"Unknown",s.textContent=C.isInIframe?"Yes":"No";},b=kt({label:"Copy JSON",variant:"primary",size:"sm"});m1(b,()=>{const C=Wt.detect();return JSON.stringify(C,null,2)});const g=x("div",{style:"width:100%;display:flex;justify-content:center;"},b),w=ft({title:"System",variant:"soft",padding:"lg",footer:g,expandable:true,defaultExpanded:r,onExpandChange:o},i("Surface",l),i("Platform",d),i("Browser",c),i("OS",p),i("Host",a),i("Iframe",s)),_=()=>{document.hidden||m();};return document.addEventListener("visibilitychange",_),m(),this.addCleanup(()=>document.removeEventListener("visibilitychange",_)),w}}function id(e){const{id:t,columns:n,data:r,pageSize:o=0,stickyHeader:i=true,zebra:a=true,animations:s=true,respectReducedMotion:l=true,compact:d=false,maxHeight:c,selectable:p=false,selectionType:m="switch",selectOnRowClick:b=false,initialSelection:g=[],hideHeaderCheckbox:w=false,getRowId:_=(h,v)=>String(v),onSortChange:C,onSelectionChange:E,onRowClick:P}=e;let O=n.slice(),F=r.slice(),A=r.slice(),T=null,M=null,S=1;const R=typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(prefers-reduced-motion: reduce)").matches:false,z=!!s&&!(l&&R),j=x("div",{className:"lg-table-wrap",id:t});if(c!=null){const h=typeof c=="number"?`${c}px`:c;j.style.setProperty("--tbl-max-h",h);}const q=x("div",{className:"lg-table"}),U=x("div",{className:"lg-thead"}),ce=x("div",{className:"lg-tbody"}),W=x("div",{className:"lg-tfoot"});i&&j.classList.add("sticky"),a&&j.classList.add("zebra"),d&&j.classList.add("compact"),p&&j.classList.add("selectable");const te=m==="switch"?"52px":"36px";j.style.setProperty("--check-w",te);function ne(h){return h==="center"?"center":h==="right"?"flex-end":"flex-start"}function ie(){const h=O.map(L=>{const G=(L.width||"1fr").trim();return /\bfr$/.test(G)?`minmax(0, ${G})`:G}),v=(p?[te,...h]:h).join(" ");j.style.setProperty("--lg-cols",v);}ie();function ee(){return o?Math.max(1,Math.ceil(F.length/o)):1}function H(){if(!o)return F;const h=(S-1)*o;return F.slice(h,h+o)}function K(){if(!T||!M)return;const h=O.find(G=>String(G.key)===T),v=M==="asc"?1:-1,L=h?.sortFn?(G,V)=>v*h.sortFn(G,V):(G,V)=>{const Z=G[T],ue=V[T];return Z==null&&ue==null?0:Z==null?-1*v:ue==null?1*v:typeof Z=="number"&&typeof ue=="number"?v*(Z-ue):v*String(Z).localeCompare(String(ue),void 0,{numeric:true,sensitivity:"base"})};F.sort(L);}const D=new Set(g);function B(){return Array.from(D)}const Q=new Map;function ae(h){D.clear(),h.forEach(v=>D.add(v)),Ie(),Q.forEach((v,L)=>{v.setChecked(D.has(L),true);}),je(),E?.(B());}function le(){D.clear(),Ie(),Q.forEach(h=>h.setChecked(false,true)),je(),E?.(B());}let ve=null;function Ie(){if(!ve)return;const h=H();if(!h.length){ve.indeterminate=false,ve.checked=false;return}const v=h.map((G,V)=>_(G,(S-1)*(o||0)+V)),L=v.reduce((G,V)=>G+(D.has(V)?1:0),0);ve.checked=L===v.length,ve.indeterminate=L>0&&L<v.length;}let Be=false;function bt(){Be=false;const h=ce.offsetWidth-ce.clientWidth;U.style.paddingRight=h>0?`${h}px`:"0px";}function Qt(){Be||(Be=true,requestAnimationFrame(bt));}const gt=new ResizeObserver(()=>Qt()),Rt=()=>Qt();function rn(){U.replaceChildren();const h=x("div",{className:"lg-tr lg-tr-head"});if(p){const v=x("div",{className:"lg-th lg-th-check"});w||(ve=x("input",{type:"checkbox"}),ve.addEventListener("change",()=>{const L=H(),G=ve.checked;L.forEach((V,Z)=>{const ue=_(V,(S-1)*(o||0)+Z);G?D.add(ue):D.delete(ue);}),E?.(B()),je();}),v.appendChild(ve)),h.appendChild(v);}O.forEach(v=>{const L=x("button",{className:"lg-th",type:"button",title:v.title||v.header});L.textContent=v.header,v.align&&L.style.setProperty("--col-justify",ne(v.align)),v.sortable&&L.classList.add("sortable"),T===String(v.key)&&M?L.setAttribute("data-sort",M):L.removeAttribute("data-sort"),v.sortable&&L.addEventListener("click",()=>{const G=String(v.key);T!==G?(T=G,M="asc"):(M=M==="asc"?"desc":M==="desc"?null:"asc",M||(T=null,F=A.slice())),C?.(T,M),T&&M&&K(),Tt();}),h.appendChild(L);}),U.appendChild(h);try{gt.disconnect();}catch{}gt.observe(ce),Qt();}function jt(h){return Array.from(h.querySelectorAll(":scope > .lg-td, :scope > .lg-td-check"))}function on(h){return h.querySelector(".lg-td, .lg-td-check")}function at(h){const v=on(h);return v?v.getBoundingClientRect():null}function je(){const h=H(),v=new Map;Array.from(ce.children).forEach(Z=>{const ue=Z,Ce=ue.getAttribute("data-id");if(!Ce)return;const be=at(ue);be&&v.set(Ce,be);});const L=new Map;Array.from(ce.children).forEach(Z=>{const ue=Z,Ce=ue.getAttribute("data-id");Ce&&L.set(Ce,ue);});const G=[];for(let Z=0;Z<h.length;Z++){const ue=h[Z],Ce=(o?(S-1)*o:0)+Z,be=_(ue,Ce);G.push(be);let Se=L.get(be);Se||(Se=Ln(ue,Ce),z&&jt(Se).forEach(pt=>{pt.style.transform="translateY(6px)",pt.style.opacity="0";})),ce.appendChild(Se);}const V=[];if(L.forEach((Z,ue)=>{G.includes(ue)||V.push(Z);}),!z){V.forEach(Z=>Z.remove()),Ie(),Qt();return}G.forEach(Z=>{const ue=ce.querySelector(`.lg-tr-body[data-id="${Z}"]`);if(!ue)return;const Ce=at(ue),be=v.get(Z),Se=jt(ue);if(be&&Ce){const Je=be.left-Ce.left,Ot=be.top-Ce.top;Se.forEach(Ct=>{Ct.style.transition="none",Ct.style.transform=`translate(${Je}px, ${Ot}px)`,Ct.style.opacity="1";}),on(ue)?.getBoundingClientRect(),Se.forEach(Ct=>{Ct.style.willChange="transform, opacity",Ct.style.transition="transform .18s ease, opacity .18s ease";}),requestAnimationFrame(()=>{Se.forEach(Ct=>{Ct.style.transform="translate(0,0)";});});}else Se.forEach(Je=>{Je.style.transition="transform .18s ease, opacity .18s ease";}),requestAnimationFrame(()=>{Se.forEach(Je=>{Je.style.transform="translate(0,0)",Je.style.opacity="1";});});const ot=Je=>{(Je.propertyName==="transform"||Je.propertyName==="opacity")&&(Se.forEach(Ot=>{Ot.style.willChange="",Ot.style.transition="",Ot.style.transform="",Ot.style.opacity="";}),Je.currentTarget.removeEventListener("transitionend",ot));},pt=Se[0];pt&&pt.addEventListener("transitionend",ot);}),V.forEach(Z=>{const ue=jt(Z);ue.forEach(Se=>{Se.style.willChange="transform, opacity",Se.style.transition="transform .18s ease, opacity .18s ease",Se.style.opacity="0",Se.style.transform="translateY(-6px)";});const Ce=Se=>{Se.propertyName==="opacity"&&(Se.currentTarget.removeEventListener("transitionend",Ce),Z.remove());},be=ue[0];be?be.addEventListener("transitionend",Ce):Z.remove();}),Ie(),Qt();}function Ln(h,v){const L=_(h,v),G=x("div",{className:"lg-tr lg-tr-body","data-id":L});if(p){const V=x("div",{className:"lg-td lg-td-check"});if(m==="switch"){const Z=Xr({size:"sm",checked:D.has(L),onChange:ue=>{ue?D.add(L):D.delete(L),Ie(),E?.(B());}});Q.set(L,Z),V.appendChild(Z.root);}else {const Z=x("input",{type:"checkbox",className:"lg-row-check"});Z.checked=D.has(L),Z.addEventListener("change",ue=>{ue.stopPropagation(),Z.checked?D.add(L):D.delete(L),Ie(),E?.(B());}),Z.addEventListener("click",ue=>ue.stopPropagation()),V.appendChild(Z);}G.appendChild(V);}return O.forEach(V=>{const Z=x("div",{className:"lg-td"});V.align&&Z.style.setProperty("--col-justify",ne(V.align));let ue=V.render?V.render(h,v):String(h[V.key]??"");typeof ue=="string"?Z.textContent=ue:Z.appendChild(ue),G.appendChild(Z);}),(P||p&&b)&&(G.classList.add("clickable"),G.addEventListener("click",V=>{if(!V.target.closest(".lg-td-check")){if(p&&b){const Z=!D.has(L);if(Z?D.add(L):D.delete(L),Ie(),m==="switch"){const ue=Q.get(L);ue&&ue.setChecked(Z,true);}else {const ue=G.querySelector(".lg-row-check");ue&&(ue.checked=Z);}E?.(B());}P?.(h,v,V);}})),G}function Rn(){if(W.replaceChildren(),!o)return;const h=ee(),v=x("div",{className:"lg-pager"}),L=x("button",{className:"btn",type:"button"},"←"),G=x("button",{className:"btn",type:"button"},"→"),V=x("span",{className:"lg-pager-info"},`${S} / ${h}`);L.disabled=S<=1,G.disabled=S>=h,L.addEventListener("click",()=>yt(S-1)),G.addEventListener("click",()=>yt(S+1)),v.append(L,V,G),W.appendChild(v);}function yt(h){const v=ee();S=Math.min(Math.max(1,h),v),je(),Rn();}function Tt(){ie(),rn(),je(),Rn();}function an(h){A=h.slice(),F=h.slice(),T&&M&&K(),yt(1);}function Wn(h){O=h.slice(),Tt();}function mn(h,v="asc"){T=h,M=h?v:null,T&&M?K():F=A.slice(),Tt();}function I(){try{gt.disconnect();}catch{}window.removeEventListener("resize",Rt);}return q.append(U,ce,W),j.appendChild(q),window.addEventListener("resize",Rt),Tt(),{root:j,setData:an,setColumns:Wn,sortBy:mn,getSelection:B,setSelection:ae,clearSelection:le,setPage:yt,getState:()=>({page:S,pageCount:ee(),sortKey:T,sortDir:M}),destroy:I}}let Ic=false;const ba=new Set;function _1(e=document){let t=e.activeElement||null;for(;t&&t.shadowRoot&&t.shadowRoot.activeElement;)t=t.shadowRoot.activeElement;return t}const _n=e=>{const t=_1();if(t){for(const n of ba)if(t===n||n.contains(t)){e.stopImmediatePropagation(),e.stopPropagation();return}}};function A1(){Ic||(Ic=true,window.addEventListener("keydown",_n,true),window.addEventListener("keypress",_n,true),window.addEventListener("keyup",_n,true),document.addEventListener("keydown",_n,true),document.addEventListener("keypress",_n,true),document.addEventListener("keyup",_n,true));}function E1(){Ic&&(Ic=false,window.removeEventListener("keydown",_n,true),window.removeEventListener("keypress",_n,true),window.removeEventListener("keyup",_n,true),document.removeEventListener("keydown",_n,true),document.removeEventListener("keypress",_n,true),document.removeEventListener("keyup",_n,true));}function T1(e){return ba.size===0&&A1(),ba.add(e),()=>{ba.delete(e),ba.size===0&&E1();}}function al(e){return e==null?null:typeof e=="string"?document.createTextNode(e):e}function I1(){const e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"svg");t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("width","16"),t.setAttribute("height","16"),t.setAttribute("aria-hidden","true"),t.style.display="none",t.style.flexShrink="0";const n=document.createElementNS(e,"circle");n.setAttribute("cx","12"),n.setAttribute("cy","12"),n.setAttribute("r","9"),n.setAttribute("fill","none"),n.setAttribute("stroke","currentColor"),n.setAttribute("stroke-width","3"),n.setAttribute("stroke-linecap","round");const r=document.createElementNS(e,"animate");r.setAttribute("attributeName","stroke-dasharray"),r.setAttribute("values","1,150;90,150;90,150"),r.setAttribute("dur","1.5s"),r.setAttribute("repeatCount","indefinite");const o=document.createElementNS(e,"animateTransform");return o.setAttribute("attributeName","transform"),o.setAttribute("attributeType","XML"),o.setAttribute("type","rotate"),o.setAttribute("from","0 12 12"),o.setAttribute("to","360 12 12"),o.setAttribute("dur","1s"),o.setAttribute("repeatCount","indefinite"),n.append(r,o),t.appendChild(n),t}function vs(e={}){const{id:t,placeholder:n="Search...",value:r="",size:o="md",disabled:i=false,autoFocus:a=false,onChange:s,onSearch:l,autoSearch:d=false,debounceMs:c=0,focusKey:p="/",iconLeft:m,iconRight:b,withClear:g=true,clearTitle:w="Clear",ariaLabel:_,submitLabel:C,loading:E=false,blockGameKeys:P=true}=e,O=x("div",{className:"search"+(o?` search--${o}`:""),id:t}),F=x("span",{className:"search-ico search-ico--left"});if(m){const le=al(m);le&&F.appendChild(le);}else F.textContent="🔎",F.style.opacity=".9";const A=x("input",{className:"input search-input",type:"text",placeholder:n,value:r,"aria-label":_||n}),T=x("span",{className:"search-ico search-ico--right"});if(b){const le=al(b);le&&T.appendChild(le);}const M=I1();M.classList.add("search-spinner");const S=g?x("button",{className:"search-clear",type:"button",title:w},"×"):null,R=C!=null?x("button",{className:"btn search-submit",type:"button"},C):null,z=x("div",{className:"search-field"},F,A,T,M,...S?[S]:[]);O.append(z,...R?[R]:[]);let j=!!i,q=null;function U(le){M.style.display=le?"inline-block":"none",O.classList.toggle("is-loading",le);}function ce(){q!=null&&(window.clearTimeout(q),q=null);}function W(le){ce(),c>0?q=window.setTimeout(()=>{q=null,le();},c):le();}function te(){s?.(A.value),d&&l&&l(A.value);}A.addEventListener("input",()=>{W(te);}),A.addEventListener("keydown",le=>{le.key==="Enter"?(le.preventDefault(),ce(),l?.(A.value)):le.key==="Escape"&&(A.value.length>0?ee("",{notify:true}):A.blur());}),S&&S.addEventListener("click",()=>ee("",{notify:true})),R&&R.addEventListener("click",()=>l?.(A.value));let ne=()=>{};if(P&&(ne=T1(A)),p){const le=ve=>{if(ve.key===p&&!ve.ctrlKey&&!ve.metaKey&&!ve.altKey){const Ie=document.activeElement;Ie&&(Ie.tagName==="INPUT"||Ie.tagName==="TEXTAREA"||Ie.isContentEditable)||(ve.preventDefault(),A.focus());}};window.addEventListener("keydown",le,true),O.__cleanup=()=>{window.removeEventListener("keydown",le,true),ne();};}else O.__cleanup=()=>{ne();};function ie(le){j=!!le,A.disabled=j,S&&(S.disabled=j),R&&(R.disabled=j),O.classList.toggle("disabled",j);}function ee(le,ve={}){const Ie=A.value;A.value=le??"",ve.notify&&Ie!==le&&W(te);}function H(){return A.value}function K(){A.focus();}function D(){A.blur();}function B(le){A.placeholder=le;}function Q(le){ee("",le);}return ie(j),U(E),a&&K(),{root:O,input:A,getValue:H,setValue:ee,focus:K,blur:D,setDisabled:ie,setPlaceholder:B,clear:Q,setLoading:U,setIconLeft(le){F.replaceChildren();const ve=al(le??"🔎");ve&&F.appendChild(ve);},setIconRight(le){T.replaceChildren();const ve=al(le??"");ve&&T.appendChild(ve);}}}const ad=e=>new Promise(t=>setTimeout(t,e)),Bn=e=>{try{return e()}catch{return}},nr=(e,t,n)=>Math.max(t,Math.min(n,e)),P1=e=>nr(e,0,1);async function Qg(e,t,n){const r=performance.now();for(;performance.now()-r<t;){const o=await Promise.race([e,ad(50).then(()=>null)]);if(o!==null)return o}throw new Error(`${n} timeout`)}let Lf=null;function Lv(){return Lf}function M1(e){Lf=e;}function Rv(){return Lf!==null}const L1=/\/(?:r\/\d+\/)?version\/([^/]+)/,R1=15e3,O1=50;function F1(){return he?.document??(typeof document<"u"?document:null)}function Rf(e={}){if(Rv())return;const t=e.doc??F1();if(!t)return;const n=t.scripts;for(let r=0;r<n.length;r++){const i=n.item(r)?.src;if(!i)continue;const a=i.match(L1);if(a?.[1]){M1(a[1]);return}}}function N1(){return Rf(),Lv()}function D1(){return Rv()}async function $1(e={}){const t=e.timeoutMs??R1,n=performance.now();for(;performance.now()-n<t;){Rf();const r=Lv();if(r)return r;await ad(O1);}throw new Error("MGVersion timeout (gameVersion not found)")}const Of={init:Rf,isReady:D1,get:N1,wait:$1},B1=he?.location?.origin||"https://magicgarden.gg";function Ov(){return typeof GM_xmlhttpRequest=="function"}function Fv(e,t="text"){return new Promise((n,r)=>{GM_xmlhttpRequest({method:"GET",url:e,responseType:t,onload:o=>o.status>=200&&o.status<300?n(o):r(new Error(`HTTP ${o.status} for ${e}`)),onerror:()=>r(new Error(`Network error for ${e}`)),ontimeout:()=>r(new Error(`Timeout for ${e}`))});})}async function Ff(e){if(Ov())return JSON.parse((await Fv(e,"text")).responseText);const t=await fetch(e);if(!t.ok)throw new Error(`HTTP ${t.status} for ${e}`);return t.json()}async function Nv(e){if(Ov())return (await Fv(e,"blob")).response;const t=await fetch(e);if(!t.ok)throw new Error(`HTTP ${t.status} for ${e}`);return t.blob()}function z1(e){return new Promise((t,n)=>{const r=URL.createObjectURL(e),o=he?.Image||Image,i=new o;i.decoding="async",i.onload=()=>{URL.revokeObjectURL(r),t(i);},i.onerror=()=>{URL.revokeObjectURL(r),n(new Error("Image decode failed"));},i.src=r;})}const Cr=(e,t)=>e.replace(/\/?$/,"/")+String(t||"").replace(/^\//,""),j1=e=>e.lastIndexOf("/")>=0?e.slice(0,e.lastIndexOf("/")+1):"",Zg=(e,t)=>String(t||"").startsWith("/")?String(t).slice(1):j1(e)+String(t||"");let Nf=null,Dv=null;function $v(){return Nf}function G1(){return Dv}function H1(e){Nf=e;}function U1(e){Dv=e;}function Bv(){return Nf!==null}const W1=15e3;async function V1(e={}){Bv()||await Df(e);}async function Df(e={}){const t=$v();if(t)return t;const n=G1();if(n)return n;const r=(async()=>{const o=e.gameVersion??await Of.wait({timeoutMs:W1}),i=`${B1}/version/${o}/assets/`;return H1(i),i})();return U1(r),r}async function q1(e){const t=await Df();return Cr(t,e)}function X1(){return Bv()}const Fo={init:V1,isReady:X1,base:Df,url:q1},zv=new Map;function K1(e){return zv.get(e)}function Y1(e,t){zv.set(e,t);}const jv="manifest.json";let fp=null;async function J1(){fp||(fp=await Gv());}function Q1(){return fp!==null}async function Gv(e={}){const t=e.baseUrl??await Fo.base(),n=K1(t);if(n)return n;const r=Ff(Cr(t,jv));return Y1(t,r),r}function Z1(e,t){return e.bundles.find(n=>n.name===t)??null}function ek(e){if(!e)return [];const t=new Set;for(const n of e.assets)for(const r of n.src??[])typeof r=="string"&&r.endsWith(".json")&&r!==jv&&t.add(r);return Array.from(t)}const Sr={init:J1,isReady:Q1,load:Gv,getBundle:Z1,listJsonFromBundle:ek},tk=he,$n=tk.Object??Object,sd=$n.keys,Pc=$n.values,Mc=$n.entries,em=new WeakSet;function nk(){return {data:{items:null,decor:null,mutations:null,eggs:null,pets:null,abilities:null,plants:null,weather:null},isHookInstalled:false,scanInterval:null,scanAttempts:0,weatherPollingTimer:null,weatherPollAttempts:0,colorPollingTimer:null,colorPollAttempts:0}}const Le=nk(),io={items:["WateringCan","PlanterPot","Shovel"],decor:["SmallRock","MediumRock","LargeRock","WoodBench","StoneBench","MarbleBench"],mutations:["Gold","Rainbow","Wet","Chilled","Frozen"],eggs:["CommonEgg","UncommonEgg","RareEgg"],pets:["Worm","Snail","Bee","Chicken","Bunny"],abilities:["ProduceScaleBoost","DoubleHarvest","SeedFinderI","CoinFinderI"],plants:["Carrot","Strawberry","Aloe","Blueberry","Apple"]},rk=["Rain","Frost","Thunderstorm","Dawn","AmberMoon"],tm=/main-[^/]+\.js(\?|$)/,ok=6,ik=150,ak=2e3,sk=200,lk=50,ck=10,dk=1e3,hp="ProduceScaleBoost",ao=(e,t)=>t.every(n=>e.includes(n));function so(e,t){Le.data[e]==null&&(Le.data[e]=t,Lc()&&Wv());}function Lc(){return Object.values(Le.data).every(e=>e!=null)}function Hv(e,t){if(!e||typeof e!="object"||em.has(e))return;em.add(e);let n;try{n=sd(e);}catch{return}if(!n||n.length===0)return;const r=e;let o;if(!Le.data.items&&ao(n,io.items)&&(o=r.WateringCan,o&&typeof o=="object"&&"coinPrice"in o&&"creditPrice"in o&&so("items",r)),!Le.data.decor&&ao(n,io.decor)&&(o=r.SmallRock,o&&typeof o=="object"&&"coinPrice"in o&&"creditPrice"in o&&so("decor",r)),!Le.data.mutations&&ao(n,io.mutations)&&(o=r.Gold,o&&typeof o=="object"&&"baseChance"in o&&"coinMultiplier"in o&&so("mutations",r)),!Le.data.eggs&&ao(n,io.eggs)&&(o=r.CommonEgg,o&&typeof o=="object"&&"faunaSpawnWeights"in o&&"secondsToHatch"in o&&so("eggs",r)),!Le.data.pets&&ao(n,io.pets)&&(o=r.Worm,o&&typeof o=="object"&&"coinsToFullyReplenishHunger"in o&&"diet"in o&&Array.isArray(o.diet)&&so("pets",r)),!Le.data.abilities&&ao(n,io.abilities)&&(o=r.ProduceScaleBoost,o&&typeof o=="object"&&"trigger"in o&&"baseParameters"in o&&so("abilities",r)),!Le.data.plants&&ao(n,io.plants)&&(o=r.Carrot,o&&typeof o=="object"&&"seed"in o&&"plant"in o&&"crop"in o&&so("plants",r)),!(t>=ok))for(const i of n){let a;try{a=r[i];}catch{continue}a&&typeof a=="object"&&Hv(a,t+1);}}function Vl(e){try{Hv(e,0);}catch{}}function Uv(){if(!Le.isHookInstalled){if($n.__MG_HOOKED__){Le.isHookInstalled=true;return}$n.__MG_HOOKED__=true,Le.isHookInstalled=true;try{$n.keys=function(t){return Vl(t),sd.apply(this,arguments)},Pc&&($n.values=function(t){return Vl(t),Pc.apply(this,arguments)}),Mc&&($n.entries=function(t){return Vl(t),Mc.apply(this,arguments)});}catch{}}}function Wv(){if(Le.isHookInstalled){try{$n.keys=sd,Pc&&($n.values=Pc),Mc&&($n.entries=Mc);}catch{}Le.isHookInstalled=false;}}function uk(){if(Le.scanInterval||Lc())return;const e=()=>{if(Lc()||Le.scanAttempts>ik){Vv();return}Le.scanAttempts++;try{sd(he).forEach(t=>{try{Vl(he[t]);}catch{}});}catch{}};e(),Le.scanInterval=setInterval(e,ak);}function Vv(){Le.scanInterval&&(clearInterval(Le.scanInterval),Le.scanInterval=null);}const nm=he;function pk(){try{for(const e of nm.document?.scripts||[]){const t=e?.src?String(e.src):"";if(tm.test(t))return t}}catch{}try{for(const e of nm.performance?.getEntriesByType?.("resource")||[]){const t=e?.name?String(e.name):"";if(tm.test(t))return t}}catch{}return null}function fk(e,t){const n=[];let r=e.indexOf(t);for(;r!==-1;)n.push(r),r=e.indexOf(t,r+t.length);return n}function ld(e,t){let n=0,r="",o=false;for(let i=t;i<e.length;i++){const a=e[i];if(r){if(o){o=false;continue}if(a==="\\"){o=true;continue}a===r&&(r="");continue}if(a==='"'||a==="'"||a==="`"){r=a;continue}if(a==="{")n++;else if(a==="}"&&--n===0)return e.slice(t,i+1)}return null}function hk(e,t){const n=Math.max(e.lastIndexOf("const ",t),e.lastIndexOf("let ",t),e.lastIndexOf("var ",t));if(n<0)return null;const r=e.indexOf("=",n);if(r<0||r>t)return null;const o=e.indexOf("{",r);return o<0||o>t?null:ld(e,o)}let hu=null,ta=null;async function qv(){return hu||ta||(ta=(async()=>{const e=pk();if(!e)return null;try{const t=await fetch(e,{credentials:"include"});if(!t.ok)return null;const n=await t.text();return hu=n,n}catch{return null}finally{ta=null;}})(),ta)}function gk(e){const t={};let n=false;for(const r of rk){const o=e?.[r];if(!o||typeof o!="object")continue;const i=o.iconSpriteKey||null,{iconSpriteKey:a,...s}=o;t[r]={weatherId:r,spriteId:i,...s},n=true;}return t.Sunny||(t.Sunny={weatherId:"Sunny",name:"Sunny",spriteId:"sprite/ui/SunnyIcon",type:"primary"}),!n||t.Rain&&t.Rain.mutator?.mutation!=="Wet"?null:t}function mk(e,t){const n=Math.max(0,t-3e3),r=e.substring(n,t),o=/Rain:\{/,i=r.match(o);if(!i||i.index===void 0)return null;const a=n+i.index;let s=-1;for(let l=a-1;l>=Math.max(0,a-200);l--)if(e[l]==="{"){s=l;break}return s<0?null:ld(e,s)}function bk(e){return e.replace(/\[([A-Za-z_$][\w$]*\.)(Rain|Frost|Dawn|AmberMoon|Thunderstorm)\]/g,'"$2"').replace(/\b[A-Za-z_$][\w$]*\.(Hydro|Lunar)\b/g,'"$1"').replace(/\$t\.(Rain|Frost|Dawn|AmberMoon|Thunderstorm)\b/g,'"$1"').replace(/\b[A-Za-z_$][\w$]*\.(Rain|Frost|Dawn|AmberMoon|Thunderstorm)\b/g,'"$1"')}async function vk(){if(Le.data.weather)return  true;const e=await qv();if(!e)return  false;let t=e.indexOf("mutator");if(t<0&&(t=e.indexOf('name:"Amber Moon"')),t<0)return  false;const n=hk(e,t)??mk(e,t);if(!n)return  false;const r=bk(n);let o;try{o=Function('"use strict";return('+r+")")();}catch{return  false}const i=gk(o);return i?(Le.data.weather=i,true):false}function yk(){if(Le.weatherPollingTimer)return;Le.weatherPollAttempts=0;const e=setInterval(async()=>{(await vk()||++Le.weatherPollAttempts>sk)&&(clearInterval(e),Le.weatherPollingTimer=null);},lk);Le.weatherPollingTimer=e;}function xk(){Le.weatherPollingTimer&&(clearInterval(Le.weatherPollingTimer),Le.weatherPollingTimer=null);}const wk={bg:"rgba(100, 100, 100, 0.9)",hover:"rgba(150, 150, 150, 1)"};function Ck(e){const t=fk(e,hp);if(!t.length)return null;for(const n of t){const r=Math.max(0,n-4e3),o=Math.min(e.length,n+4e3),a=e.slice(r,o).lastIndexOf("switch(");if(a===-1)continue;const s=r+a,l=e.indexOf("{",s);if(l===-1)continue;const d=ld(e,l);if(d&&d.includes(hp)&&(d.includes('bg:"')||d.includes("bg:'")))return d}return null}function Sk(e){const t={},n=[],r=/case\s*(['"])([^'"]+)\1\s*:|default\s*:|return\s*\{/g,o=(a,s)=>{const l=new RegExp(`${s}\\s*:\\s*(['"])([\\s\\S]*?)\\1`),d=a.match(l);return d?d[2]:null};let i;for(;(i=r.exec(e))!==null;){if(i[2]){n.push(i[2]);continue}const a=i[0];if(a.startsWith("default")){n.length=0;continue}if(!a.startsWith("return"))continue;const s=e.indexOf("{",i.index);if(s===-1){n.length=0;continue}const l=ld(e,s);if(!l){n.length=0;continue}const d=o(l,"bg");if(!d){n.length=0;continue}const c=o(l,"hover")||d;for(const p of n)t[p]||(t[p]={bg:d,hover:c});n.length=0;}return Object.keys(t).length?t:null}async function kk(){const e=await qv();if(!e)return null;const t=Ck(e);return t?Sk(t):null}function _k(e){const t=e[hp];return t!=null&&typeof t=="object"&&"color"in t}async function Ak(){if(!Le.data.abilities)return  false;const e=Le.data.abilities;if(_k(e))return  true;const t=await kk();if(!t)return  false;const n={};for(const[r,o]of Object.entries(e)){const i=t[r]||wk;n[r]={...o,color:{bg:i.bg,hover:i.hover}};}return Le.data.abilities=n,console.log("[MGData] Enriched abilities with colors"),true}function Ek(){if(Le.colorPollingTimer)return;Le.colorPollAttempts=0;const e=setInterval(async()=>{(await Ak()||++Le.colorPollAttempts>ck)&&(clearInterval(e),Le.colorPollingTimer=null);},dk);Le.colorPollingTimer=e;}function Tk(){Le.colorPollingTimer&&(clearInterval(Le.colorPollingTimer),Le.colorPollingTimer=null);}function Ik(){return {ready:false,app:null,renderer:null,ctors:null,baseUrl:null,textures:new Map,animations:new Map,live:new Set,defaultParent:null,overlay:null,categoryIndex:null}}function Pk(){return {lru:new Map,cost:0,srcCanvas:new Map}}function Mk(){return {cache:new Map,maxEntries:200}}const Lk={enabled:true,maxEntries:200,maxCost:800,srcCanvasMax:100},Rk={enabled:true,maxEntries:200},Ut=Ik(),Ok=Pk(),Fk={...Lk},Nk=Mk(),Dk={...Rk};function nn(){return Ut}function Si(){return Ok}function Ka(){return Fk}function Ya(){return Nk}function gp(){return Dk}function Xv(){return Ut.ready}const rm=Function.prototype.bind,nt={_bindPatched:false,engine:null,tos:null,app:null,renderer:null,ticker:null,stage:null};let Kv,Yv,Jv;const $k=new Promise(e=>{Kv=e;}),Bk=new Promise(e=>{Yv=e;}),zk=new Promise(e=>{Jv=e;});function jk(e){return !!(e&&typeof e=="object"&&typeof e.start=="function"&&typeof e.destroy=="function"&&e.app&&e.app.stage&&e.app.renderer&&e.systems&&typeof e.systems.values=="function")}function Gk(e){try{for(const t of e.systems.values()){const n=t?.system;if(n?.name==="tileObject")return n}}catch{}return null}function Hk(e){nt.engine=e,nt.tos=Gk(e)||null,nt.app=e.app||null,nt.renderer=e.app?.renderer||null,nt.ticker=e.app?.ticker||null,nt.stage=e.app?.stage||null;try{Kv(e);}catch{}try{nt.app&&Yv(nt.app);}catch{}try{nt.renderer&&Jv(nt.renderer);}catch{}}function $f(){return nt.engine?true:(nt._bindPatched||(nt._bindPatched=true,Function.prototype.bind=function(e,...t){const n=rm.call(this,e,...t);try{!nt.engine&&jk(e)&&(Function.prototype.bind=rm,nt._bindPatched=!1,Hk(e));}catch{}return n}),false)}$f();async function Uk(e=15e3){const t=performance.now();for(;performance.now()-t<e;){if(nt.engine)return  true;$f(),await ad(50);}throw new Error("MGPixiHooks: engine capture timeout")}async function Wk(e=15e3){return nt.engine||await Uk(e),true}function Vk(){return nt.engine&&nt.app?{ok:true,engine:nt.engine,tos:nt.tos,app:nt.app}:($f(),{ok:false,engine:nt.engine,tos:nt.tos,app:nt.app,note:"Not captured. Wait for room, or reload."})}const An={engineReady:$k,appReady:Bk,rendererReady:zk,engine:()=>nt.engine,tos:()=>nt.tos,app:()=>nt.app,renderer:()=>nt.renderer,ticker:()=>nt.ticker,stage:()=>nt.stage,PIXI:()=>he.PIXI||null,init:Wk,hook:Vk,ready:()=>!!nt.engine};function Rc(e){const t=String(e||"").trim();return t?t.startsWith("sprite/")||t.startsWith("sprites/")?t:t.includes("/")?`sprite/${t}`:t:""}function ys(e,t){const n=String(e||"").trim().replace(/^sprites?\//,"").replace(/^\/+|\/+$/g,""),r=String(t||"").trim();return r.includes("/")||!n?Rc(r):`sprite/${n}/${r}`}function Ja(e,t,n,r){const o=ys(e,t);if(n.has(o)||r.has(o))return o;const i=String(t||"").trim();if(n.has(i)||r.has(i))return i;const a=Rc(i);return n.has(a)||r.has(a)?a:o}function qk(e,t,n=25e3){const r=[e],o=new Set;let i=0;for(;r.length&&i++<n;){const a=r.pop();if(!a||o.has(a))continue;if(o.add(a),t(a))return a;const s=a.children;if(Array.isArray(s))for(let l=s.length-1;l>=0;l--)r.push(s[l]);}return null}function Xk(e){const t=he.PIXI;if(t?.Texture&&t?.Sprite&&t?.Container&&t?.Rectangle)return {Container:t.Container,Sprite:t.Sprite,Texture:t.Texture,Rectangle:t.Rectangle,AnimatedSprite:t.AnimatedSprite||null};const n=e?.stage,r=qk(n,o=>o?.texture?.frame&&o?.constructor&&o?.texture?.constructor&&o?.texture?.frame?.constructor);if(!r)throw new Error("No Sprite found yet (constructors).");return {Container:n.constructor,Sprite:r.constructor,Texture:r.texture.constructor,Rectangle:r.texture.frame.constructor,AnimatedSprite:t?.AnimatedSprite||null}}async function Kk(e,t=15e3){const n=performance.now();for(;performance.now()-n<t;)try{return Xk(e)}catch{await ad(50);}throw new Error("Constructors timeout")}const lo=(...e)=>{try{console.log("[MGSprite]",...e);}catch{}};function Yk(e){return e&&typeof e=="object"&&e.frames&&e.meta&&typeof e.meta.image=="string"}function gu(e,t,n,r,o){return new e(t,n,r,o)}function Jk(e,t,n,r,o,i,a){let s;try{s=new e({source:t.source,frame:n,orig:r,trim:o||void 0,rotate:i||0});}catch{s=new e(t.baseTexture||t,n,r,o||void 0,i||0);}if(a)if(s.defaultAnchor?.set)try{s.defaultAnchor.set(a.x,a.y);}catch{}else s.defaultAnchor?(s.defaultAnchor.x=a.x,s.defaultAnchor.y=a.y):s.defaultAnchor={x:a.x,y:a.y};try{s.updateUvs?.();}catch{}return s}function Qk(e,t,n,r){const{Texture:o,Rectangle:i}=r;for(const[a,s]of Object.entries(e.frames)){const l=s.frame,d=!!s.rotated,c=d?2:0,p=d?l.h:l.w,m=d?l.w:l.h,b=gu(i,l.x,l.y,p,m),g=s.sourceSize||{w:l.w,h:l.h},w=gu(i,0,0,g.w,g.h);let _=null;if(s.trimmed&&s.spriteSourceSize){const C=s.spriteSourceSize;_=gu(i,C.x,C.y,C.w,C.h);}n.set(a,Jk(o,t,b,w,_,c,s.anchor||null));}}function Zk(e,t,n){if(!(!e.animations||typeof e.animations!="object"))for(const[r,o]of Object.entries(e.animations)){if(!Array.isArray(o))continue;const i=o.map(a=>t.get(a)).filter(Boolean);i.length>=2&&n.set(r,i);}}function e_(e,t){const n=(r,o)=>{const i=String(r||"").trim(),a=String(o||"").trim();!i||!a||(t.has(i)||t.set(i,new Set),t.get(i).add(a));};for(const r of Object.keys(e.frames||{})){const o=/^sprite\/([^/]+)\/(.+)$/.exec(r);o&&n(o[1],o[2]);}}async function t_(e,t){const n=await Sr.load({baseUrl:e}),r=Sr.getBundle(n,"default");if(!r)throw new Error("No default bundle in manifest");const o=Sr.listJsonFromBundle(r),i=new Set,a=new Map,s=new Map,l=new Map;async function d(c){if(i.has(c))return;i.add(c);const p=await Ff(Cr(e,c));if(!Yk(p))return;const m=p.meta?.related_multi_packs;if(Array.isArray(m))for(const _ of m)await d(Zg(c,_));const b=Zg(c,p.meta.image),g=await z1(await Nv(Cr(e,b))),w=t.Texture.from(g);Qk(p,w,a,t),Zk(p,a,s),e_(p,l);}for(const c of o)await d(c);return {textures:a,animations:s,categoryIndex:l}}let sl=null;async function n_(){return Ut.ready?true:sl||(sl=(async()=>{const e=performance.now();lo("init start");const t=await Qg(An.appReady,15e3,"PIXI app");lo("app ready");const n=await Qg(An.rendererReady,15e3,"PIXI renderer");lo("renderer ready"),Ut.app=t,Ut.renderer=n||t?.renderer||null,Ut.ctors=await Kk(t),lo("constructors resolved"),Ut.baseUrl=await Fo.base(),lo("base url",Ut.baseUrl);const{textures:r,animations:o,categoryIndex:i}=await t_(Ut.baseUrl,Ut.ctors);return Ut.textures=r,Ut.animations=o,Ut.categoryIndex=i,lo("atlases loaded","textures",Ut.textures.size,"animations",Ut.animations.size,"categories",Ut.categoryIndex?.size??0),Ut.ready=true,lo("ready in",Math.round(performance.now()-e),"ms"),true})(),sl)}const ki={Gold:{overlayTall:null,tallIconOverride:null},Rainbow:{overlayTall:null,tallIconOverride:null,angle:130,angleTall:0},Wet:{overlayTall:"sprite/mutation-overlay/WetTallPlant",tallIconOverride:"sprite/mutation/Puddle"},Chilled:{overlayTall:"sprite/mutation-overlay/ChilledTallPlant",tallIconOverride:null},Frozen:{overlayTall:"sprite/mutation-overlay/FrozenTallPlant",tallIconOverride:null},Thunderstruck:{overlayTall:"sprite/mutation-overlay/ThunderstruckTallPlant",tallIconOverride:"sprite/mutation/ThunderstruckGround"},Dawnlit:{overlayTall:null,tallIconOverride:null},Ambershine:{overlayTall:null,tallIconOverride:null},Dawncharged:{overlayTall:null,tallIconOverride:null},Ambercharged:{overlayTall:null,tallIconOverride:null}},Qv=Object.keys(ki),r_=["Gold","Rainbow","Wet","Chilled","Frozen","Thunderstruck","Ambershine","Dawnlit","Dawncharged","Ambercharged"],om=new Map(r_.map((e,t)=>[e,t]));function Oc(e){return [...new Set(e.filter(Boolean))].sort((n,r)=>(om.get(n)??1/0)-(om.get(r)??1/0))}const o_=["Wet","Chilled","Frozen","Thunderstruck"],i_=new Set(["Dawnlit","Ambershine","Dawncharged","Ambercharged"]),a_={Banana:.68,Beet:.65,Carrot:.6,Sunflower:.5,Starweaver:.5,FavaBean:.25,BurrosTail:.2},s_={Pepper:.6,Banana:.6},l_=256,c_=.5,d_=2;function Zv(e){if(!e.length)return {muts:[],overlayMuts:[],selectedMuts:[],sig:""};const t=Oc(e),n=u_(e),r=p_(e);return {muts:n,overlayMuts:r,selectedMuts:t,sig:`${t.join(",")}|${n.join(",")}|${r.join(",")}`}}function u_(e){const t=e.filter((o,i,a)=>ki[o]&&a.indexOf(o)===i);if(!t.length)return [];if(t.includes("Gold"))return ["Gold"];if(t.includes("Rainbow"))return ["Rainbow"];const n=["Ambershine","Dawnlit","Dawncharged","Ambercharged"];return t.some(o=>n.includes(o))?Oc(t.filter(o=>!o_.includes(o))):Oc(t)}function p_(e){const t=e.filter((n,r,o)=>ki[n]?.overlayTall&&o.indexOf(n)===r);return Oc(t)}function mu(e,t){return e.map(n=>({name:n,meta:ki[n],overlayTall:ki[n]?.overlayTall??null,isTall:t}))}const f_={Gold:{op:"source-atop",colors:["rgb(235,200,0)"],a:.7},Rainbow:{op:"color",colors:["#FF1744","#FF9100","#FFEA00","#00E676","#2979FF","#D500F9"],ang:130,angTall:0,masked:true},Wet:{op:"source-atop",colors:["rgb(50,180,200)"],a:.25},Chilled:{op:"source-atop",colors:["rgb(100,160,210)"],a:.45},Frozen:{op:"source-atop",colors:["rgb(100,130,220)"],a:.5},Thunderstruck:{op:"source-atop",colors:["rgb(16, 141, 163)"],a:.4},Dawnlit:{op:"source-atop",colors:["rgb(209,70,231)"],a:.5},Ambershine:{op:"source-atop",colors:["rgb(190,100,40)"],a:.5},Dawncharged:{op:"source-atop",colors:["rgb(140,80,200)"],a:.5},Ambercharged:{op:"source-atop",colors:["rgb(170,60,25)"],a:.5}},ll=(()=>{try{const t=document.createElement("canvas").getContext("2d");if(!t)return new Set;const n=["color","hue","saturation","luminosity","overlay","screen","lighter","source-atop"],r=new Set;for(const o of n)t.globalCompositeOperation=o,t.globalCompositeOperation===o&&r.add(o);return r}catch{return new Set}})();function h_(e){return ll.has(e)?e:ll.has("overlay")?"overlay":ll.has("screen")?"screen":ll.has("lighter")?"lighter":"source-atop"}function g_(e,t,n,r,o=false){const i=(r-90)*Math.PI/180,a=t/2,s=n/2;if(!o){const p=Math.min(t,n)/2;return e.createLinearGradient(a-Math.cos(i)*p,s-Math.sin(i)*p,a+Math.cos(i)*p,s+Math.sin(i)*p)}const l=Math.cos(i),d=Math.sin(i),c=Math.abs(l)*t/2+Math.abs(d)*n/2;return e.createLinearGradient(a-l*c,s-d*c,a+l*c,s+d*c)}function im(e,t,n,r,o=false){const i=r.colors?.length?r.colors:["#fff"],a=r.ang!=null?g_(e,t,n,r.ang,o):e.createLinearGradient(0,0,0,n);i.length===1?(a.addColorStop(0,i[0]),a.addColorStop(1,i[0])):i.forEach((s,l)=>a.addColorStop(l/(i.length-1),s)),e.fillStyle=a,e.fillRect(0,0,t,n);}function m_(e,t,n,r){const o=f_[n];if(!o)return;const i={...o};n==="Rainbow"&&r&&i.angTall!=null&&(i.ang=i.angTall);const a=n==="Rainbow"&&r,s=t.width,l=t.height;e.save();const d=i.masked?h_(i.op):"source-in";if(e.globalCompositeOperation=d,i.a!=null&&(e.globalAlpha=i.a),i.masked){const c=document.createElement("canvas");c.width=s,c.height=l;const p=c.getContext("2d");p.imageSmoothingEnabled=false,im(p,s,l,i,a),p.globalCompositeOperation="destination-in",p.drawImage(t,0,0),e.drawImage(c,0,0);}else im(e,s,l,i,a);e.restore();}function b_(e){return /tallplant/i.test(e)}function Bf(e){const t=String(e||"").split("/");return t[t.length-1]||""}function ey(e){switch(e){case "Ambershine":return ["Ambershine","Amberlit"];case "Dawncharged":return ["Dawncharged","Dawnbound"];case "Ambercharged":return ["Ambercharged","Amberbound"];case "Thunderstruck":return ["Thunderstruck","ThunderstruckGround"];default:return [e]}}function v_(e,t){const n=String(e||"").toLowerCase();for(const r of t.keys()){const o=/sprite\/mutation-overlay\/([A-Za-z0-9]+)TallPlant/i.exec(String(r));if(!o||!o[1])continue;if(o[1].toLowerCase()===n){const a=t.get(r);if(a)return {tex:a,key:r}}}return null}function y_(e,t,n,r){if(!t)return null;const o=Bf(e),i=ey(t);for(const a of i){const s=[`sprite/mutation/${a}${o}`,`sprite/mutation/${a}-${o}`,`sprite/mutation/${a}_${o}`,`sprite/mutation/${a}/${o}`,`sprite/mutation/${a}`];for(const l of s){const d=n.get(l);if(d)return {tex:d,key:l}}{const l=`sprite/mutation-overlay/${a}TallPlant`,d=n.get(l);if(d)return {tex:d,key:l};const c=`sprite/mutation-overlay/${a}`,p=n.get(c);if(p)return {tex:p,key:c};const m=v_(t,n);if(m)return m}}return null}function x_(e,t,n,r){if(!t)return null;const o=ki[t];if(n&&o?.tallIconOverride){const s=r.get(o.tallIconOverride);if(s)return s}const i=Bf(e),a=ey(t);for(const s of a){const l=[`sprite/mutation/${s}Icon`,`sprite/mutation/${s}`,`sprite/mutation/${s}${i}`,`sprite/mutation/${s}-${i}`,`sprite/mutation/${s}_${i}`,`sprite/mutation/${s}/${i}`];for(const d of l){const c=r.get(d);if(c)return c}if(n){const d=`sprite/mutation-overlay/${s}TallPlantIcon`,c=r.get(d);if(c)return c;const p=`sprite/mutation-overlay/${s}TallPlant`,m=r.get(p);if(m)return m}}return null}function w_(e,t,n){const r=e?.orig?.width??e?.frame?.width??e?.width??1,o=e?.orig?.height??e?.frame?.height??e?.height??1,i=e?.defaultAnchor?.x??0,a=e?.defaultAnchor?.y??0;let s=s_[t]??i;const l=o>r*1.5;let d=a_[t]??(l?a:.4);const c={x:(s-i)*r,y:(d-a)*o},p=Math.min(r,o),m=Math.min(1.5,p/l_);let b=c_*m;return n&&(b*=d_),{width:r,height:o,anchorX:i,anchorY:a,offset:c,iconScale:b}}function ty(e,t){return `${t.sig}::${e}`}function ny(e){return e?e.isAnim?e.frames?.length||0:e.tex?1:0:0}function C_(e,t,n){e.lru.delete(t),e.lru.set(t,n);}function S_(e,t){if(t.enabled)for(;e.lru.size>t.maxEntries||e.cost>t.maxCost;){const n=e.lru.keys().next().value;if(n===void 0)break;const r=e.lru.get(n);e.lru.delete(n),e.cost=Math.max(0,e.cost-ny(r??null));}}function ry(e,t){const n=e.lru.get(t);return n?(C_(e,t,n),n):null}function oy(e,t,n,r){e.lru.set(t,n),e.cost+=ny(n),S_(e,r);}function k_(e){e.lru.clear(),e.cost=0,e.srcCanvas.clear();}function __(e,t){return e.srcCanvas.get(t)??null}function A_(e,t,n,r){if(e.srcCanvas.set(t,n),e.srcCanvas.size>r.srcCanvasMax){const o=e.srcCanvas.keys().next().value;o!==void 0&&e.srcCanvas.delete(o);}}function cd(e,t,n,r,o){const i=__(r,e);if(i)return i;let a=null;const s=t?.resolution??1;try{if(t?.extract?.canvas){const l=new n.Sprite(e),d=t.extract.canvas(l);if(l.destroy?.({children:!0,texture:!1,baseTexture:!1}),s>1&&d){const c=Math.round(d.width/s),p=Math.round(d.height/s);a=document.createElement("canvas"),a.width=c,a.height=p;const m=a.getContext("2d");m&&(m.imageSmoothingEnabled=!1,m.drawImage(d,0,0,c,p));}else a=d;}}catch{}if(!a){const l=e?.frame||e?._frame,d=e?.orig||e?._orig,c=e?.trim||e?._trim,p=e?.rotate||e?._rotate||0,m=e?.baseTexture?.resource?.source||e?.baseTexture?.resource||e?.source?.resource?.source||e?.source?.resource||e?._source?.resource?.source||null;if(!l||!m)throw new Error("textureToCanvas fail");a=document.createElement("canvas");const b=Math.max(1,(d?.width??l.width)|0),g=Math.max(1,(d?.height??l.height)|0),w=c?.x??0,_=c?.y??0;a.width=b,a.height=g;const C=a.getContext("2d");C.imageSmoothingEnabled=false,p===true||p===2||p===8?(C.save(),C.translate(w+l.height/2,_+l.width/2),C.rotate(-Math.PI/2),C.drawImage(m,l.x,l.y,l.width,l.height,-l.width/2,-l.height/2,l.width,l.height),C.restore()):C.drawImage(m,l.x,l.y,l.width,l.height,w,_,l.width,l.height);}return A_(r,e,a,o),a}function E_(e,t,n,r,o,i,a,s){const{w:l,h:d,aX:c,aY:p,basePos:m}=t,b=[];for(const g of n){const w=new r.Sprite(e);w.anchor?.set?.(c,p),w.position.set(m.x,m.y),w.zIndex=1;const _=document.createElement("canvas");_.width=l,_.height=d;const C=_.getContext("2d");C.imageSmoothingEnabled=false,C.save(),C.translate(l*c,d*p),C.drawImage(cd(e,o,r,i,a),-l*c,-d*p),C.restore(),m_(C,_,g.name,g.isTall);const E=r.Texture.from(_,{resolution:e.resolution??1});s.push(E),w.texture=E,b.push(w);}return b}function T_(e,t,n,r,o,i,a,s,l,d){const{aX:c,basePos:p}=t,m=[];for(const b of n){const g=b.overlayTall&&r.get(b.overlayTall)&&{tex:r.get(b.overlayTall),key:b.overlayTall}||y_(e,b.name,r);if(!g?.tex)continue;const w=cd(g.tex,i,o,a,s);if(!w)continue;const _=w.width,C={x:0,y:0},E={x:p.x-c*_,y:0},P=document.createElement("canvas");P.width=_,P.height=w.height;const O=P.getContext("2d");if(!O)continue;O.imageSmoothingEnabled=false,O.drawImage(w,0,0),O.globalCompositeOperation="destination-in",O.drawImage(l,-E.x,-0);const F=o.Texture.from(P,{resolution:g.tex.resolution??1});d.push(F);const A=new o.Sprite(F);A.anchor?.set?.(C.x,C.y),A.position.set(E.x,E.y),A.scale.set(1),A.alpha=1,A.zIndex=3,m.push(A);}return m}function I_(e,t,n,r,o,i){const{basePos:a}=t,s=[];for(const l of n){if(l.name==="Gold"||l.name==="Rainbow")continue;const d=x_(e,l.name,l.isTall,r);if(!d)continue;const c=new o.Sprite(d),p=d?.defaultAnchor?.x??.5,m=d?.defaultAnchor?.y??.5;c.anchor?.set?.(p,m),c.position.set(a.x+i.offset.x,a.y+i.offset.y),c.scale.set(i.iconScale),l.isTall&&(c.zIndex=-1),i_.has(l.name)&&(c.zIndex=10),c.zIndex||(c.zIndex=2),s.push(c);}return s}function iy(e,t,n,r){try{if(!e||!r.renderer||!r.ctors?.Container||!r.ctors?.Sprite||!r.ctors?.Texture)return null;const{Container:o,Sprite:i,Texture:a}=r.ctors,s=e?.orig?.width??e?.frame?.width??e?.width??1,l=e?.orig?.height??e?.frame?.height??e?.height??1,d=e?.defaultAnchor?.x??.5,c=e?.defaultAnchor?.y??.5,p={x:s*d,y:l*c},m=cd(e,r.renderer,r.ctors,r.cacheState,r.cacheConfig),b=new o;b.sortableChildren=!0;const g=new i(e);g.anchor?.set?.(d,c),g.position.set(p.x,p.y),g.zIndex=0,b.addChild(g);const w=b_(t),_=mu(n.muts,w),C=mu(n.overlayMuts,w),E=mu(n.selectedMuts,w),P=[],O={w:s,h:l,aX:d,aY:c,basePos:p},F=Bf(t),A=w_(e,F,w);E_(e,O,_,r.ctors,r.renderer,r.cacheState,r.cacheConfig,P).forEach(U=>b.addChild(U)),w&&T_(t,O,C,r.textures,r.ctors,r.renderer,r.cacheState,r.cacheConfig,m,P).forEach(ce=>b.addChild(ce)),I_(t,O,E,r.textures,r.ctors,A).forEach(U=>b.addChild(U));let S={x:0,y:0,width:s,height:l};try{const U=b.getLocalBounds?.()||b.getBounds?.(!0);U&&Number.isFinite(U.width)&&Number.isFinite(U.height)&&(S={x:U.x,y:U.y,width:U.width,height:U.height});}catch{}const{Rectangle:R}=r.ctors,z=R?new R(0,0,s,l):void 0;let j=null;if(typeof r.renderer.generateTexture=="function"?j=r.renderer.generateTexture(b,{resolution:1,region:z}):r.renderer.textureGenerator?.generateTexture&&(j=r.renderer.textureGenerator.generateTexture({target:b,resolution:1,region:z})),!j)throw new Error("no render texture");const q=j instanceof a?j:a.from(r.renderer.extract.canvas(j));try{q.__mg_base={baseX:-S.x,baseY:-S.y,baseW:s,baseH:l,texW:S.width,texH:S.height};}catch{}j&&j!==q&&j.destroy?.(!0),b.destroy({children:!0,texture:!1,baseTexture:!1});try{q.__mg_gen=!0,q.label=`${t}|${n.sig}`;}catch{}return q}catch{return null}}function P_(e,t,n,r){if(!e||e.length<2)return null;const o=[];for(const i of e){const a=iy(i,t,n,r);a&&o.push(a);}return o.length>=2?o:null}function ay(e,t,n,r,o){const i=t.scale??1,a=t.frameIndex??0,s=t.mutations?.slice().sort().join(",")||"",l=t.anchorX??.5,d=t.anchorY??.5;return `${e}|s${i}|f${a}|m${s}|ax${l}|ay${d}|bm${n}|bp${o}|p${r}`}function M_(e,t){const n=e.cache.get(t);return n?(n.lastAccess=performance.now(),n.canvas):null}function L_(e,t,n,r){if(t.enabled){if(e.cache.size>=t.maxEntries){let o=null,i=1/0;for(const[a,s]of e.cache)s.lastAccess<i&&(i=s.lastAccess,o=a);o&&e.cache.delete(o);}e.cache.set(n,{canvas:r,lastAccess:performance.now()});}}function am(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");return n&&n.drawImage(e,0,0),t}function R_(e){e.cache.clear();}function O_(e){return {size:e.cache.size,maxEntries:e.maxEntries}}function F_(){return new Promise(e=>{typeof requestIdleCallback<"u"?requestIdleCallback(()=>e(),{timeout:50}):setTimeout(e,0);})}async function N_(e,t,n,r,o,i,a,s=5,l=0){if(!t.ready||!i.enabled)return 0;const d=e.length;let c=0;a?.(0,d);for(let p=0;p<d;p+=s){const m=e.slice(p,p+s);for(const b of m)try{const g=Ja(null,b,t.textures,t.animations),w={scale:1},_=ly(w),C=cy(_,w),E=uy(_,w.boundsPadding),P=ay(g,w,_,C,E);o.cache.has(P)||mp(t,n,r,null,b,w,o,i),c++;}catch{c++;}a?.(c,d),p+s<d&&await F_();}return c}function D_(e){if(e.overlay)return e.overlay;const t=new e.ctors.Container;t.sortableChildren=true,t.zIndex=99999999;try{e.app.stage.sortableChildren=!0;}catch{}return e.app.stage.addChild(t),e.overlay=t,t}function $_(e){const t=e.defaultParent;if(!t)return null;try{return typeof t=="function"?t():t}catch{return null}}function zf(e,t,n,r,o,i){if(!n.length)return t;const a=Zv(n);if(!a.sig)return t;const s=ty(e,a),l=ry(o,s);if(l?.tex)return l.tex;const d=iy(t,e,a,{renderer:r.renderer,ctors:r.ctors,textures:r.textures,cacheState:o,cacheConfig:i});return d?(oy(o,s,{isAnim:false,tex:d},i),d):t}function sy(e,t,n,r,o,i){if(!n.length)return t;const a=Zv(n);if(!a.sig)return t;const s=ty(e,a),l=ry(o,s);if(l?.isAnim&&l.frames?.length)return l.frames;const d=P_(t,e,a,{renderer:r.renderer,ctors:r.ctors,textures:r.textures,cacheState:o,cacheConfig:i});return d?(oy(o,s,{isAnim:true,frames:d},i),d):t}function sm(e,t,n,r,o,i={}){if(!e.ready)throw new Error("MGSprite not ready yet");const a=Ja(r,o,e.textures,e.animations),s=i.mutations||[],l=i.parent||$_(e)||D_(e),d=e.renderer?.width||e.renderer?.view?.width||innerWidth,c=e.renderer?.height||e.renderer?.view?.height||innerHeight,p=i.center?d/2:i.x??d/2,m=i.center?c/2:i.y??c/2;let b;const g=e.animations.get(a);if(g&&g.length>=2){const C=sy(a,g,s,e,t,n),E=e.ctors.AnimatedSprite;if(E)b=new E(C),b.animationSpeed=i.fps?i.fps/60:i.speed??.15,b.loop=i.loop??true,b.play();else {const P=new e.ctors.Sprite(C[0]),F=1e3/Math.max(1,i.fps||8);let A=0,T=0;const M=S=>{const R=e.app.ticker?.deltaMS??S*16.666666666666668;if(A+=R,A<F)return;const z=A/F|0;A%=F,T=(T+z)%C.length,P.texture=C[T];};P.__mgTick=M,e.app.ticker?.add?.(M),b=P;}}else {const C=e.textures.get(a);if(!C)throw new Error(`Unknown sprite/anim key: ${a}`);const E=zf(a,C,s,e,t,n);b=new e.ctors.Sprite(E);}const w=i.anchorX??b.texture?.defaultAnchor?.x??.5,_=i.anchorY??b.texture?.defaultAnchor?.y??.5;return b.anchor?.set?.(w,_),b.position.set(p,m),b.scale.set(i.scale??1),b.alpha=i.alpha??1,b.rotation=i.rotation??0,b.zIndex=i.zIndex??999999,l.addChild(b),e.live.add(b),b.__mgDestroy=()=>{try{b.__mgTick&&e.app.ticker?.remove?.(b.__mgTick);}catch{}try{b.destroy?.({children:!0,texture:!1,baseTexture:!1});}catch{try{b.destroy?.();}catch{}}e.live.delete(b);},b}function B_(e,t){const n=e.renderer;if(n?.extract?.canvas)return n.extract.canvas(t);if(n?.plugins?.extract?.canvas)return n.plugins.extract.canvas(t);throw new Error("No extract.canvas available on renderer")}const lm=new Map;function ly(e){return e.boundsMode?e.boundsMode:e.mutations&&e.mutations.length>0?"base":"mutations"}function cy(e,t){return e==="mutations"?t.pad??2:t.pad??0}function na(e){return Number.isFinite(e)?Math.max(0,e):0}function dy(e){if(typeof e=="number"){const t=na(e);return {top:t,right:t,bottom:t,left:t}}return e?{top:na(e.top??0),right:na(e.right??0),bottom:na(e.bottom??0),left:na(e.left??0)}:{top:0,right:0,bottom:0,left:0}}function uy(e,t){if(e==="mutations")return "0,0,0,0";if(e==="padded"&&t==null)return "auto";const n=dy(t);return `${n.top},${n.right},${n.bottom},${n.left}`}function py(e){const t=e?.orig?.width??e?.frame?.width??e?.width??1,n=e?.orig?.height??e?.frame?.height??e?.height??1;return {w:t,h:n}}function fy(e,t,n){const r=e?.__mg_base;return r&&Number.isFinite(r.baseX)&&Number.isFinite(r.baseY)&&Number.isFinite(r.baseW)&&Number.isFinite(r.baseH)&&Number.isFinite(r.texW)&&Number.isFinite(r.texH)?r:{baseX:0,baseY:0,baseW:t,baseH:n,texW:t,texH:n}}function z_(e,t,n,r,o,i){const a=`${e}|f${t}`,s=lm.get(a);if(s)return s;const l=py(n),d={top:0,right:0,bottom:0,left:0};for(const c of Qv){const p=zf(e,n,[c],r,o,i),m=fy(p,l.w,l.h),b=Math.max(0,m.baseX),g=Math.max(0,m.baseY),w=Math.max(0,m.texW-m.baseX-m.baseW),_=Math.max(0,m.texH-m.baseY-m.baseH);b>d.left&&(d.left=b),g>d.top&&(d.top=g),w>d.right&&(d.right=w),_>d.bottom&&(d.bottom=_);}return lm.set(a,d),d}function mp(e,t,n,r,o,i={},a,s){if(!e.ready)throw new Error("MGSprite not ready yet");const l=Ja(r,o,e.textures,e.animations),d=ly(i),c=cy(d,i),p=uy(d,i.boundsPadding),m=a&&s?.enabled?ay(l,i,d,c,p):null;if(m&&a&&s?.enabled){const P=M_(a,m);if(P)return am(P)}const b=i.mutations||[],g=e.animations.get(l),w=Math.max(0,(i.frameIndex??0)|0);let _,C;if(g?.length)if(_=g[w%g.length],b.length){const P=sy(l,g,b,e,t,n);C=P[w%P.length];}else C=_;else {const P=e.textures.get(l);if(!P)throw new Error(`Unknown sprite/anim key: ${l}`);_=P,C=zf(l,P,b,e,t,n);}let E;if(d==="mutations"){const P=new e.ctors.Sprite(C),O=i.anchorX??P.texture?.defaultAnchor?.x??.5,F=i.anchorY??P.texture?.defaultAnchor?.y??.5;P.anchor?.set?.(O,F),P.scale.set(i.scale??1);const A=new e.ctors.Container;A.addChild(P);try{A.updateTransform?.();}catch{}const T=P.getBounds?.(true)||{x:0,y:0,width:P.width,height:P.height};P.position.set(-T.x+c,-T.y+c),E=B_(e,A);try{A.destroy?.({children:!0});}catch{}}else {const P=i.scale??1;let O=dy(i.boundsPadding);d==="padded"&&i.boundsPadding==null&&(O=z_(l,w,_,e,t,n)),c&&(O={top:O.top+c,right:O.right+c,bottom:O.bottom+c,left:O.left+c});const F=py(_),A=fy(C,F.w,F.h),T=Math.max(1,Math.ceil((F.w+O.left+O.right)*P)),M=Math.max(1,Math.ceil((F.h+O.top+O.bottom)*P));E=document.createElement("canvas"),E.width=T,E.height=M;const S=E.getContext("2d");if(S){S.imageSmoothingEnabled=false;const R=cd(C,e.renderer,e.ctors,t,n),z=(O.left-A.baseX)*P,j=(O.top-A.baseY)*P;S.drawImage(R,z,j,R.width*P,R.height*P);}}return m&&a&&s?.enabled?(L_(a,s,m,E),am(E)):E}function j_(e){for(const t of Array.from(e.live))t.__mgDestroy?.();}function G_(e,t){return e.defaultParent=t,true}function H_(e,t){return e.defaultParent=t,true}function No(){if(!Xv())throw new Error("MGSprite not ready yet")}function U_(e,t,n){return typeof t=="string"?sm(nn(),Si(),Ka(),e,t,n||{}):sm(nn(),Si(),Ka(),null,e,t||{})}function W_(e,t,n){return typeof t=="string"?mp(nn(),Si(),Ka(),e,t,n||{},Ya(),gp()):mp(nn(),Si(),Ka(),null,e,t||{},Ya(),gp())}function V_(){j_(nn());}function q_(e){return G_(nn(),e)}function X_(e){return H_(nn(),e)}function K_(e,t){const n=nn(),r=typeof t=="string"?Ja(e,t,n.textures,n.animations):Ja(null,e,n.textures,n.animations);return n.textures.has(r)||n.animations.has(r)}function Y_(){No();const e=nn().categoryIndex;return e?Array.from(e.keys()).sort((t,n)=>t.localeCompare(n)):[]}function J_(e){No();const t=String(e||"").trim();if(!t)return [];const n=nn().categoryIndex;return n?Array.from(n.get(t)?.values()||[]):[]}function Q_(e,t){No();const n=String(e||"").trim(),r=String(t||"").trim();if(!n||!r)return  false;const o=nn().categoryIndex;if(!o)return  false;const i=n.toLowerCase(),a=r.toLowerCase();for(const[s,l]of o.entries())if(s.toLowerCase()===i){for(const d of l.values())if(d.toLowerCase()===a)return  true}return  false}function Z_(e){No();const t=nn().categoryIndex;if(!t)return [];const n=String(e||"").trim().toLowerCase(),r=[];for(const[o,i]of t.entries())for(const a of i.values()){const s=ys(o,a);(!n||s.toLowerCase().startsWith(n))&&r.push(s);}return r.sort((o,i)=>o.localeCompare(i))}function eA(e){No();const t=String(e||"").trim();if(!t)return null;const n=Rc(t),r=/^sprite\/([^/]+)\/(.+)$/.exec(n);if(!r)return null;const o=r[1],i=r[2],a=nn().categoryIndex,s=o.toLowerCase(),l=i.toLowerCase();let d=o,c=i;if(a){const p=Array.from(a.keys()).find(g=>g.toLowerCase()===s);if(!p)return null;d=p;const m=a.get(p);if(!m)return null;const b=Array.from(m.values()).find(g=>g.toLowerCase()===l);if(!b)return null;c=b;}return {category:d,id:c,key:ys(d,c)}}function tA(e,t){No();const n=String(e||"").trim(),r=String(t||"").trim();if(!n||!r)throw new Error("getIdPath(category, id) requires both category and id");const o=nn().categoryIndex;if(!o)throw new Error("Sprite categories not indexed");const i=n.toLowerCase(),a=r.toLowerCase(),s=Array.from(o.keys()).find(c=>c.toLowerCase()===i)||n,l=o.get(s);if(!l)throw new Error(`Unknown sprite category: ${n}`);const d=Array.from(l.values()).find(c=>c.toLowerCase()===a)||r;if(!l.has(d))throw new Error(`Unknown sprite id: ${n}/${r}`);return ys(s,d)}function nA(){k_(Si());}function rA(){R_(Ya());}function oA(){return O_(Ya())}function iA(){return [...Qv]}async function aA(e,t,n=10,r=0){return No(),N_(e,nn(),Si(),Ka(),Ya(),gp(),t,n,r)}const ye={init:n_,isReady:Xv,show:U_,toCanvas:W_,clear:V_,attach:q_,attachProvider:X_,has:K_,key:(e,t)=>ys(e,t),getCategories:Y_,getCategoryId:J_,hasId:Q_,listIds:Z_,getIdInfo:eA,getIdPath:tA,clearMutationCache:nA,clearToCanvasCache:rA,getToCanvasCacheStats:oA,getMutationNames:iA,warmup:aA};function sA(e){return String(e||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^A-Za-z0-9]/g,"").trim()}function lA(e,t=[]){const n=new Set,r=o=>{const i=String(o||"").trim();i&&n.add(i);};r(e);for(const o of t)r(o);for(const o of Array.from(n.values()))o.endsWith("s")?r(o.slice(0,-1)):r(`${o}s`),o.endsWith("es")&&r(o.slice(0,-2));return Array.from(n.values()).filter(Boolean)}function hy(e,t,n,r=[],o=[]){if(!ye)return console.warn("[MGData] MGSprite not available in pickSpriteId"),null;const i=lA(e,r);if(!i.length)return null;const a=[t,...o].filter(c=>typeof c=="string"),s=c=>{const p=String(c||"").trim();if(!p)return null;for(const m of i)try{if(ye.has(m,p))return ye.getIdPath(m,p)}catch{}return null};for(const c of a){const p=s(c);if(p)return p}const l=sA(n||""),d=s(l||n||"");if(d)return d;try{for(const c of i){const p=ye.listIds(`sprite/${c}/`),m=a.map(g=>String(g||"").toLowerCase()),b=String(n||l||"").toLowerCase();for(const g of p){const _=(g.split("/").pop()||"").toLowerCase();if(m.some(C=>C&&C===_)||_===b)return g}for(const g of p){const _=(g.split("/").pop()||"").toLowerCase();if(m.some(C=>C&&(_.includes(C)||C.includes(_)))||b&&(_.includes(b)||b.includes(_)))return g}}}catch{}return null}function Cn(e,t,n,r,o=[],i=[]){if(!e||typeof e!="object")return;const a=e.tileRef;if(!a||typeof a!="object")return;const s=String(a.spritesheet||t||"").trim(),l=hy(s,n,r,o,i);if(l)try{e.spriteId=l;}catch{}const d=e.rotationVariants;if(d&&typeof d=="object")for(const c of Object.values(d))Cn(c,s,n,r);if(e.immatureTileRef){const c={tileRef:e.immatureTileRef};Cn(c,s,n,r),c.spriteId&&(e.immatureSpriteId=c.spriteId);}if(e.topmostLayerTileRef){const c={tileRef:e.topmostLayerTileRef};Cn(c,s,n,r),c.spriteId&&(e.topmostLayerSpriteId=c.spriteId);}e.activeState&&typeof e.activeState=="object"&&Cn(e.activeState,s,n,e.activeState?.name||r);}function cA(e,t,n,r=[]){if(!Array.isArray(t)||t.length===0)return null;const o=t[0],i=t.slice(1);return hy(e,o,n??null,r,i)}function dA(e){for(const[t,n]of Object.entries(e.items||{}))Cn(n,"items",t,n?.name,["item"]);for(const[t,n]of Object.entries(e.decor||{}))Cn(n,"decor",t,n?.name);for(const[t,n]of Object.entries(e.mutations||{})){Cn(n,"mutations",t,n?.name,["mutation"]);const r=cA("mutation-overlay",[`${t}TallPlant`,`${t}TallPlantIcon`,t],n?.name,["mutation-overlay"]);if(r)try{n.overlaySpriteId=r;}catch{}}for(const[t,n]of Object.entries(e.eggs||{}))Cn(n,"pets",t,n?.name,["pet"]);for(const[t,n]of Object.entries(e.pets||{}))Cn(n,"pets",t,n?.name,["pet"]);for(const[t,n]of Object.entries(e.plants||{})){const r=n;r.seed&&Cn(r.seed,r.seed?.tileRef?.spritesheet||"seeds",`${t}Seed`,r.seed?.name||`${t} Seed`,["seed","plant","plants"],[t]),r.plant&&Cn(r.plant,r.plant?.tileRef?.spritesheet||"plants",`${t}Plant`,r.plant?.name||`${t} Plant`,["plant","plants","tallplants"],[t]),r.crop&&Cn(r.crop,r.crop?.tileRef?.spritesheet||"plants",t,r.crop?.name||t,["plant","plants"],[`${t}Crop`]);}}function uA(){try{console.log("[MGData] Resolving sprites..."),dA(Le.data),console.log("[MGData] Sprite resolution complete");}catch(e){try{console.warn("[MGData] sprite resolution failed",e);}catch{}}}const gy=5e3,my=50;function by(e){return new Promise(t=>setTimeout(t,e))}function pA(e){return Le.data[e]}function fA(){return {...Le.data}}function hA(e){return Le.data[e]!=null}async function gA(e,t=gy,n=my){const r=Date.now();for(;Date.now()-r<t;){const o=Le.data[e];if(o!=null)return o;await by(n);}throw new Error(`MGData.waitFor: timeout waiting for "${e}"`)}async function mA(e=gy,t=my){const n=Date.now();for(;Date.now()-n<e;){if(Object.values(Le.data).some(r=>r!=null))return {...Le.data};await by(t);}throw new Error("MGData.waitForAnyData: timeout")}const vy=["CoinFinderI","CoinFinderII","CoinFinderIII","SeedFinderI","SeedFinderII","SeedFinderIII","SeedFinderIV","HungerRestore","HungerRestoreII","DoubleHarvest","DoubleHatch","ProduceEater","PetHatchSizeBoost","PetHatchSizeBoostII","PetAgeBoost","PetAgeBoostII","PetRefund","PetRefundII","ProduceRefund","SellBoostI","SellBoostII","SellBoostIII","SellBoostIV","GoldGranter","RainbowGranter","RainDance","PetXpBoost","PetXpBoostII","EggGrowthBoost","EggGrowthBoostII_NEW","EggGrowthBoostII","PlantGrowthBoost","PlantGrowthBoostII","ProduceScaleBoost","ProduceScaleBoostII"];function yy(e){return vy.includes(e)}function xy(e){return e.filter(t=>yy(t.action))}function cm(e){const t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=Math.floor(e%60);return t>0?`${t}h ${n}m`:n>0?`${n}m ${r}s`:`${r}s`}function bu(e){return e?.name||e?.petSpecies||"Unknown Pet"}function wy(e){const{action:t,parameters:n}=e,r=n;switch(t){case "CoinFinderI":case "CoinFinderII":case "CoinFinderIII":return `Found ${r.coinsFound||0} coins`;case "SeedFinderI":case "SeedFinderII":case "SeedFinderIII":case "SeedFinderIV":return `Found 1× ${r.speciesId||"Unknown"} seed`;case "HungerRestore":case "HungerRestoreII":{const o=bu(r.targetPet),i=r.hungerRestoreAmount||0,s=r.pet?.id===r.targetPet?.id?"itself":o;return `Restored ${i} hunger to ${s}`}case "DoubleHarvest":return `Double harvested ${r.harvestedCrop?.species||"Unknown"}`;case "DoubleHatch":return `Double hatched ${r.extraPet?.petSpecies||"Unknown"}`;case "ProduceEater":{const o=r.growSlot?.species||"Unknown",i=r.sellPrice||0;return `Ate ${o} for ${i} coins`}case "PetHatchSizeBoost":case "PetHatchSizeBoostII":{const o=bu(r.targetPet),i=r.strengthIncrease||0;return `Boosted ${o}'s size by +${i.toFixed(0)}`}case "PetAgeBoost":case "PetAgeBoostII":{const o=bu(r.targetPet);return `Gave +${r.bonusXp||0} XP to ${o}`}case "PetRefund":case "PetRefundII":return `Refunded 1× ${r.eggId||"Unknown Egg"}`;case "ProduceRefund":{const o=r.cropsRefunded?.length||0;return `Refunded ${o} ${o===1?"crop":"crops"}`}case "SellBoostI":case "SellBoostII":case "SellBoostIII":case "SellBoostIV":return `Gave +${r.bonusCoins||0} bonus coins`;case "GoldGranter":case "RainbowGranter":case "RainDance":{const o=r.mutation||"Unknown";return `Made ${r.growSlot?.species||"Unknown"} turn ${o}`}case "PetXpBoost":case "PetXpBoostII":{const o=r.bonusXp||0,i=r.petsAffected?.length||0;return `Gave +${o} XP to ${i} ${i===1?"pet":"pets"}`}case "EggGrowthBoost":case "EggGrowthBoostII_NEW":case "EggGrowthBoostII":{const o=r.secondsReduced||0,i=r.eggsAffected?.length||0,a=cm(o);return `Reduced ${i} ${i===1?"egg":"eggs"} growth by ${a}`}case "PlantGrowthBoost":case "PlantGrowthBoostII":{const o=r.secondsReduced||0,i=r.numPlantsAffected||0,a=cm(o);return `Reduced ${i} ${i===1?"plant":"plants"} growth by ${a}`}case "ProduceScaleBoost":case "ProduceScaleBoostII":{const o=r.scaleIncreasePercentage||0,i=r.numPlantsAffected||0;return `Boosted ${i} ${i===1?"crop":"crops"} size by +${o.toFixed(0)}%`}default:return `Unknown ability: ${t}`}}const we={async init(){Uv(),uk(),yk(),Ek();},isReady:Lc,get:pA,getAll:fA,has:hA,waitFor:gA,waitForAny:mA,resolveSprites:uA,cleanup(){Wv(),Vv(),xk(),Tk();}},bA=new Map;function vA(){return bA}function bp(){return he.jotaiAtomCache?.cache}function Wr(e){const t=vA(),n=t.get(e);if(n)return n;const r=bp();if(!r)return null;for(const o of r.values())if((o?.debugLabel||o?.label||"")===e)return t.set(e,o),o;return null}function yA(){const e=he;if(e.__REACT_DEVTOOLS_GLOBAL_HOOK__)return;const t=new Map,n=new Map;e.__REACT_DEVTOOLS_GLOBAL_HOOK__={renderers:t,supportsFiber:true,inject:r=>{const o=t.size+1;return t.set(o,r),n.set(o,new Set),o},onCommitFiberRoot:(r,o)=>{const i=n.get(r);i&&i.add(o);},onCommitFiberUnmount:()=>{},onPostCommitFiberRoot:()=>{},getFiberRoots:r=>n.get(r),checkDCE:()=>{},isDisabled:false};}const xA={baseStore:null,captureInProgress:false,captureError:null,lastCapturedVia:null,mirror:void 0};function Fi(){return xA}const wA="__JOTAI_STORE_READY__";let dm=false;const vp=new Set;function cl(){if(!dm){dm=true;for(const e of vp)try{e();}catch{}try{const e=he.CustomEvent||CustomEvent;he.dispatchEvent?.(new e(wA));}catch{}}}function CA(e){vp.add(e);const t=xp();if(t.via&&!t.polyfill)try{e();}catch{}return ()=>{vp.delete(e);}}async function jf(e={}){const{timeoutMs:t=6e3,intervalMs:n=50}=e,r=xp();if(!(r.via&&!r.polyfill))return new Promise((o,i)=>{let a=false;const s=CA(()=>{a||(a=true,s(),o());}),l=Date.now();(async()=>{for(;!a&&Date.now()-l<t;){const c=xp();if(c.via&&!c.polyfill){if(a)return;a=true,s(),o();return}await Qa(n);}a||(a=true,s(),i(new Error("Store not captured within timeout")));})();})}const Qa=e=>new Promise(t=>setTimeout(t,e));function Cy(){try{const e=he.Event||Event;he.dispatchEvent?.(new e("visibilitychange"));}catch{}}function yp(e){return e&&typeof e=="object"&&typeof e.get=="function"&&typeof e.set=="function"&&typeof e.sub=="function"}function vu(e,t=0,n=new WeakSet){if(t>3||!e||typeof e!="object"||n.has(e))return null;try{n.add(e);}catch{return null}if(yp(e))return e;const r=["store","value","current","state","s","baseStore"];for(const o of r)try{const i=e[o];if(yp(i))return i}catch{}return null}function Sy(){const e=Fi(),t=he.__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!t?.renderers?.size)return null;let n=0;for(const[r]of t.renderers){const o=t.getFiberRoots?.(r);o&&(n+=o.size||0);}if(n===0)return null;for(const[r]of t.renderers){const o=t.getFiberRoots?.(r);if(o)for(const i of o){const a=new Set,s=[i.current];for(;s.length;){const l=s.pop();if(!(!l||a.has(l))){a.add(l);try{const d=l?.pendingProps?.value;if(yp(d))return e.lastCapturedVia="fiber",d}catch{}try{let d=l?.memoizedState,c=0;for(;d&&c<15;){c++;const p=vu(d);if(p)return e.lastCapturedVia="fiber",p;const m=vu(d.memoizedState);if(m)return e.lastCapturedVia="fiber",m;d=d.next;}}catch{}try{if(l?.stateNode){const d=vu(l.stateNode);if(d)return e.lastCapturedVia="fiber",d}}catch{}l.child&&s.push(l.child),l.sibling&&s.push(l.sibling),l.alternate&&s.push(l.alternate);}}}}return null}function ky(){return {get:()=>{throw new Error("Store not captured: get unavailable")},set:()=>{throw new Error("Store not captured: set unavailable")},sub:()=>()=>{},__polyfill:true}}async function SA(e=5e3){const t=Date.now();let n=bp();for(;!n&&Date.now()-t<e;)await Qa(100),n=bp();if(!n)throw new Error("jotaiAtomCache.cache not found");const r=Fi();let o=null,i=null;const a=[],s=()=>{for(const d of a)try{d.__origWrite&&(d.write=d.__origWrite,delete d.__origWrite);}catch{}};for(const d of n.values()){if(!d||typeof d.write!="function"||d.__origWrite)continue;const c=d.write;d.__origWrite=c,d.write=function(p,m,...b){return i||(o=p,i=m,s()),c.call(this,p,m,...b)},a.push(d);}Cy();const l=Date.now();for(;!i&&Date.now()-l<e;)await Qa(50);return i?(r.lastCapturedVia="write",{get:d=>o(d),set:(d,c)=>i(d,c),sub:(d,c)=>{let p;try{p=o(d);}catch{}const m=setInterval(()=>{let b;try{b=o(d);}catch{return}if(b!==p){p=b;try{c();}catch{}}},100);return ()=>clearInterval(m)}}):(s(),r.lastCapturedVia="polyfill",ky())}async function kA(e=1e4){const t=Fi();Cy();const n=Date.now();for(;Date.now()-n<e;){const r=Sy();if(r)return r;await Qa(50);}return t.lastCapturedVia="polyfill",ky()}async function Gf(){const e=Fi();if(e.baseStore&&!e.baseStore.__polyfill)return cl(),e.baseStore;if(e.captureInProgress){const t=Date.now(),n=2500;for(;!e.baseStore&&Date.now()-t<n;)await Qa(25);if(e.baseStore)return e.baseStore.__polyfill||cl(),e.baseStore}e.captureInProgress=true;try{const t=Sy();if(t)return e.baseStore=t,cl(),t;try{const r=await SA(5e3);return e.baseStore=r,r.__polyfill||cl(),r}catch(r){e.captureError=r;}const n=await kA();return e.baseStore=n,n}catch(t){throw e.captureError=t,t}finally{e.captureInProgress=false;}}function xp(){const e=Fi();return {via:e.lastCapturedVia,polyfill:!!e.baseStore?.__polyfill,error:e.captureError}}async function _A(){const e=await Gf(),t=new WeakMap,n=async o=>{let i=t.get(o);if(i)return i;i={last:void 0,has:false,subs:new Set},t.set(o,i);try{i.last=e.get(o),i.has=!0;}catch{}const a=e.sub(o,()=>{let s;try{s=e.get(o);}catch{return}const l=i.last,d=!Object.is(s,l)||!i.has;if(i.last=s,i.has=true,d)for(const c of i.subs)try{c(s,l);}catch{}});return i.unsubUpstream=a,i};return {async get(o){const i=await n(o);if(i.has)return i.last;const a=e.get(o);return i.last=a,i.has=true,a},async set(o,i){await e.set(o,i);const a=await n(o);a.last=i,a.has=true;},async sub(o,i){const a=await n(o);if(a.subs.add(i),a.has)try{i(a.last,a.last);}catch{}return ()=>{a.subs.delete(i);}},getShadow(o){return t.get(o)?.last},hasShadow(o){return !!t.get(o)?.has},async ensureWatch(o){await n(o);},async asStore(){return {get:o=>this.get(o),set:(o,i)=>this.set(o,i),sub:(o,i)=>{let a=null;return this.sub(o,()=>i()).then(s=>a=s),()=>a?.()}}}}}async function ql(){const e=Fi();return e.mirror||(e.mirror=await _A()),e.mirror}const et={async select(e){const t=await ql(),n=Wr(e);if(!n)throw new Error(`[Store] Atom not found: "${e}"`);return t.get(n)},async set(e,t){const n=await ql(),r=Wr(e);if(!r)throw new Error(`[Store] Atom not found: "${e}"`);await n.set(r,t);},async subscribe(e,t){const n=await ql(),r=Wr(e);if(!r)throw new Error(`[Store] Atom not found: "${e}"`);return n.sub(r,o=>{try{t(o);}catch{}})},async subscribeImmediate(e,t){const n=await et.select(e);try{t(n);}catch{}return et.subscribe(e,t)}};async function _y(){await ql();}const xs=Object.freeze(Object.defineProperty({__proto__:null,Store:et,prewarm:_y,waitForStore:jf},Symbol.toStringTag,{value:"Module"}));function Hf(e){return e?Array.isArray(e)?e.slice():e.split(".").map(t=>t.match(/^\d+$/)?Number(t):t):[]}function Za(e,t){const n=Hf(t);let r=e;for(const o of n){if(r==null)return;r=r[o];}return r}function AA(e,t,n){const r=Hf(t);if(!r.length)return n;const o=Array.isArray(e)?[...e]:{...e??{}};let i=o;for(let a=0;a<r.length-1;a++){const s=r[a],l=i[s],d=typeof l=="object"&&l!==null?Array.isArray(l)?[...l]:{...l}:{};i[s]=d,i=d;}return i[r[r.length-1]]=n,o}function um(e,t){const n={};for(const r of t)n[r]=r.includes(".")?Za(e,r):e?.[r];try{return JSON.stringify(n)}catch{return String(n)}}function EA(e,t,n){const r=n.mode??"auto";function o(d){const c=t?Za(d,t):d,p=new Map;if(c==null)return {signatures:p,keys:[]};const m=Array.isArray(c);if((r==="array"||r==="auto"&&m)&&m)for(let g=0;g<c.length;g++){const w=c[g],_=n.key?n.key(w,g,d):g,C=n.sig?n.sig(w,g,d):n.fields?um(w,n.fields):JSON.stringify(w);p.set(_,C);}else for(const[g,w]of Object.entries(c)){const _=n.key?n.key(w,g,d):g,C=n.sig?n.sig(w,g,d):n.fields?um(w,n.fields):JSON.stringify(w);p.set(_,C);}return {signatures:p,keys:Array.from(p.keys())}}function i(d,c){if(d===c)return  true;if(!d||!c||d.size!==c.size)return  false;for(const[p,m]of d)if(c.get(p)!==m)return  false;return  true}async function a(d){let c=null;return et.subscribeImmediate(e,p=>{const m=t?Za(p,t):p,{signatures:b}=o(m);if(!i(c,b)){const g=new Set([...c?Array.from(c.keys()):[],...Array.from(b.keys())]),w=[];for(const _ of g){const C=c?.get(_)??"__NONE__",E=b.get(_)??"__NONE__";C!==E&&w.push(_);}c=b,d({value:m,changedKeys:w});}})}async function s(d,c){return a(({value:p,changedKeys:m})=>{m.includes(d)&&c({value:p});})}async function l(d,c){const p=new Set(d);return a(({value:m,changedKeys:b})=>{const g=b.filter(w=>p.has(w));g.length&&c({value:m,changedKeys:g});})}return {sub:a,subKey:s,subKeys:l}}const ti=new Map;function TA(e,t){const n=ti.get(e);if(n)try{n();}catch{}return ti.set(e,t),()=>{try{t();}catch{}ti.get(e)===t&&ti.delete(e);}}function lt(e,t={}){const{path:n,write:r="replace"}=t,o=n?`${e}:${Hf(n).join(".")}`:e;async function i(){const p=await et.select(e);return n?Za(p,n):p}async function a(p){if(typeof r=="function"){const g=await et.select(e),w=r(p,g);return et.set(e,w)}const m=await et.select(e),b=n?AA(m,n,p):p;return r==="merge-shallow"&&!n&&m&&typeof m=="object"&&typeof p=="object"?et.set(e,{...m,...p}):et.set(e,b)}async function s(p){const m=await i(),b=p(m);return await a(b),b}async function l(p,m,b){let g;const w=C=>{const E=n?Za(C,n):C;if(typeof g>"u"||!b(g,E)){const P=g;g=E,m(E,P);}},_=p?await et.subscribeImmediate(e,w):await et.subscribe(e,w);return TA(o,_)}function d(){const p=ti.get(o);if(p){try{p();}catch{}ti.delete(o);}}function c(p){return EA(e,p?.path??n,p)}return {label:o,get:i,set:a,update:s,onChange:(p,m=Object.is)=>l(false,p,m),onChangeNow:(p,m=Object.is)=>l(true,p,m),asSignature:c,stopOnChange:d}}function oe(e){return lt(e)}oe("positionAtom");oe("lastPositionInMyGardenAtom");oe("playerDirectionAtom");oe("stateAtom");oe("quinoaDataAtom");oe("currentTimeAtom");oe("actionAtom");oe("isPressAndHoldActionAtom");oe("mapAtom");oe("tileSizeAtom");lt("mapAtom",{path:"cols"});lt("mapAtom",{path:"rows"});lt("mapAtom",{path:"spawnTiles"});lt("mapAtom",{path:"locations.seedShop.spawnTileIdx"});lt("mapAtom",{path:"locations.eggShop.spawnTileIdx"});lt("mapAtom",{path:"locations.toolShop.spawnTileIdx"});lt("mapAtom",{path:"locations.decorShop.spawnTileIdx"});lt("mapAtom",{path:"locations.sellCropsShop.spawnTileIdx"});lt("mapAtom",{path:"locations.sellPetShop.spawnTileIdx"});lt("mapAtom",{path:"locations.collectorsClub.spawnTileIdx"});lt("mapAtom",{path:"locations.wishingWell.spawnTileIdx"});lt("mapAtom",{path:"locations.shopsCenter.spawnTileIdx"});oe("playerAtom");oe("myDataAtom");oe("myUserSlotIdxAtom");oe("isSpectatingAtom");oe("myCoinsCountAtom");oe("numPlayersAtom");lt("playerAtom",{path:"id"});lt("myDataAtom",{path:"activityLogs"});oe("userSlotsAtom");oe("filteredUserSlotsAtom");oe("myUserSlotAtom");oe("spectatorsAtom");lt("stateAtom",{path:"child"});lt("stateAtom",{path:"child.data"});lt("stateAtom",{path:"child.data.shops"});const IA=lt("stateAtom",{path:"child.data.userSlots"}),PA=lt("stateAtom",{path:"data.players"}),MA=lt("stateAtom",{path:"data.hostPlayerId"});oe("myInventoryAtom");oe("myInventoryItemsAtom");oe("isMyInventoryAtMaxLengthAtom");oe("myFavoritedItemIdsAtom");oe("myCropInventoryAtom");oe("mySeedInventoryAtom");oe("myToolInventoryAtom");oe("myEggInventoryAtom");oe("myDecorInventoryAtom");oe("myPetInventoryAtom");lt("myInventoryAtom",{path:"favoritedItemIds"});oe("itemTypeFiltersAtom");oe("myItemStoragesAtom");oe("myPetHutchStoragesAtom");oe("myPetHutchItemsAtom");oe("myPetHutchPetItemsAtom");oe("myNumPetHutchItemsAtom");oe("myValidatedSelectedItemIndexAtom");oe("isSelectedItemAtomSuspended");oe("mySelectedItemAtom");oe("mySelectedItemNameAtom");oe("mySelectedItemRotationsAtom");oe("mySelectedItemRotationAtom");oe("setSelectedIndexToEndAtom");oe("myPossiblyNoLongerValidSelectedItemIndexAtom");oe("myCurrentGlobalTileIndexAtom");oe("myCurrentGardenTileAtom");oe("myCurrentGardenObjectAtom");oe("myOwnCurrentGardenObjectAtom");oe("myOwnCurrentDirtTileIndexAtom");oe("myCurrentGardenObjectNameAtom");oe("isInMyGardenAtom");oe("myGardenBoardwalkTileObjectsAtom");const LA=lt("myDataAtom",{path:"garden"});lt("myDataAtom",{path:"garden.tileObjects"});lt("myOwnCurrentGardenObjectAtom",{path:"objectType"});oe("myCurrentStablePlantObjectInfoAtom");oe("myCurrentSortedGrowSlotIndicesAtom");oe("myCurrentGrowSlotIndexAtom");oe("myCurrentGrowSlotsAtom");oe("myCurrentGrowSlotAtom");oe("secondsUntilCurrentGrowSlotMaturesAtom");oe("isCurrentGrowSlotMatureAtom");oe("numGrowSlotsAtom");oe("myCurrentEggAtom");oe("petInfosAtom");oe("myPetInfosAtom");oe("myPetSlotInfosAtom");oe("myPrimitivePetSlotsAtom");oe("myNonPrimitivePetSlotsAtom");oe("expandedPetSlotIdAtom");oe("myPetsProgressAtom");oe("myActiveCropMutationPetsAtom");oe("totalPetSellPriceAtom");oe("selectedPetHasNewVariantsAtom");const RA=oe("shopsAtom"),OA=oe("myShopPurchasesAtom");oe("seedShopAtom");oe("seedShopInventoryAtom");oe("seedShopRestockSecondsAtom");oe("seedShopCustomRestockInventoryAtom");oe("eggShopAtom");oe("eggShopInventoryAtom");oe("eggShopRestockSecondsAtom");oe("eggShopCustomRestockInventoryAtom");oe("toolShopAtom");oe("toolShopInventoryAtom");oe("toolShopRestockSecondsAtom");oe("toolShopCustomRestockInventoryAtom");oe("decorShopAtom");oe("decorShopInventoryAtom");oe("decorShopRestockSecondsAtom");oe("decorShopCustomRestockInventoryAtom");oe("isDecorShopAboutToRestockAtom");lt("shopsAtom",{path:"seed"});lt("shopsAtom",{path:"tool"});lt("shopsAtom",{path:"egg"});lt("shopsAtom",{path:"decor"});oe("myCropItemsAtom");oe("myCropItemsToSellAtom");oe("totalCropSellPriceAtom");oe("friendBonusMultiplierAtom");oe("myJournalAtom");oe("myCropJournalAtom");oe("myPetJournalAtom");oe("myStatsAtom");oe("myActivityLogsAtom");oe("newLogsAtom");oe("hasNewLogsAtom");oe("newCropLogsFromSellingAtom");oe("hasNewCropLogsFromSellingAtom");oe("myCompletedTasksAtom");oe("myActiveTasksAtom");oe("isWelcomeToastVisibleAtom");oe("shouldCloseWelcomeToastAtom");oe("isInitialMoveToDirtPatchToastVisibleAtom");oe("isFirstPlantSeedActiveAtom");oe("isThirdSeedPlantActiveAtom");oe("isThirdSeedPlantCompletedAtom");oe("isDemoTouchpadVisibleAtom");oe("areShopAnnouncersEnabledAtom");oe("arePresentablesEnabledAtom");oe("isEmptyDirtTileHighlightedAtom");oe("isPlantTileHighlightedAtom");oe("isItemHiglightedInHotbarAtom");oe("isItemHighlightedInModalAtom");oe("isMyGardenButtonHighlightedAtom");oe("isSellButtonHighlightedAtom");oe("isShopButtonHighlightedAtom");oe("isInstaGrowButtonHiddenAtom");oe("isActionButtonHighlightedAtom");oe("isGardenItemInfoCardHiddenAtom");oe("isSeedPurchaseButtonHighlightedAtom");oe("isFirstSeedPurchaseActiveAtom");oe("isFirstCropHarvestActiveAtom");oe("isWeatherStatusHighlightedAtom");oe("weatherAtom");const dd=oe("activeModalAtom");oe("hotkeyBeingPressedAtom");oe("avatarTriggerAnimationAtom");oe("avatarDataAtom");oe("emoteDataAtom");oe("otherUserSlotsAtom");oe("otherPlayerPositionsAtom");oe("otherPlayerSelectedItemsAtom");oe("otherPlayerLastActionsAtom");oe("traderBunnyPlayerId");oe("npcPlayersAtom");oe("npcQuinoaUsersAtom");oe("numNpcAvatarsAtom");oe("traderBunnyEmoteTimeoutAtom");oe("traderBunnyEmoteAtom");oe("unsortedLeaderboardAtom");oe("currentGardenNameAtom");oe("quinoaEngineAtom");oe("quinoaInitializationErrorAtom");oe("avgPingAtom");oe("serverClientTimeOffsetAtom");oe("isEstablishingShotRunningAtom");oe("isEstablishingShotCompleteAtom");const Ye={initialized:false,activeModal:null,isCustom:false,shadow:null,patchedAtoms:new Set,originalReads:new Map,unsubscribes:[],listeners:{onOpen:new Set,onClose:new Set}};function ud(){return Ye}function FA(){return Ye.initialized}function Do(){return Ye.isCustom&&Ye.activeModal!==null}function Po(){return Ye.activeModal}function Ay(e){return !Ye.shadow||Ye.shadow.modal!==e?null:Ye.shadow.data}function NA(e){Ye.initialized=e;}function Uf(e){Ye.activeModal=e;}function Wf(e){Ye.isCustom=e;}function Ey(e,t){Ye.shadow={modal:e,data:t,timestamp:Date.now()};}function Ty(){Ye.shadow=null;}function pm(e,t){Ye.patchedAtoms.add(e),Ye.originalReads.set(e,t);}function DA(e){return Ye.originalReads.get(e)}function wp(e){return Ye.patchedAtoms.has(e)}function $A(e){Ye.patchedAtoms.delete(e),Ye.originalReads.delete(e);}function BA(e){Ye.unsubscribes.push(e);}function zA(){for(const e of Ye.unsubscribes)try{e();}catch{}Ye.unsubscribes.length=0;}function jA(e){return Ye.listeners.onOpen.add(e),()=>Ye.listeners.onOpen.delete(e)}function Iy(e){return Ye.listeners.onClose.add(e),()=>Ye.listeners.onClose.delete(e)}function Py(e){for(const t of Array.from(Ye.listeners.onOpen))try{t(e);}catch{}}function Vf(e){for(const t of Array.from(Ye.listeners.onClose))try{t(e);}catch{}}function GA(){zA(),Ye.initialized=false,Ye.activeModal=null,Ye.isCustom=false,Ye.shadow=null,Ye.patchedAtoms.clear(),Ye.originalReads.clear(),Ye.listeners.onOpen.clear(),Ye.listeners.onClose.clear();}const qf={inventory:{atoms:[{atomLabel:"myInventoryAtom",dataKey:"_full",transform:e=>{const t=e;return {items:t.items??[],storages:t.storages??[],favoritedItemIds:t.favoritedItemIds??[]}}}],derivedAtoms:[{atomLabel:"myCropInventoryAtom",sourceKey:"items",deriveFn:e=>Array.isArray(e)?e.filter(t=>t.itemType==="Produce"):[]},{atomLabel:"mySeedInventoryAtom",sourceKey:"items",deriveFn:e=>Array.isArray(e)?e.filter(t=>t.itemType==="Seed"):[]},{atomLabel:"myToolInventoryAtom",sourceKey:"items",deriveFn:e=>Array.isArray(e)?e.filter(t=>t.itemType==="Tool"):[]},{atomLabel:"myEggInventoryAtom",sourceKey:"items",deriveFn:e=>Array.isArray(e)?e.filter(t=>t.itemType==="Egg"):[]},{atomLabel:"myDecorInventoryAtom",sourceKey:"items",deriveFn:e=>Array.isArray(e)?e.filter(t=>t.itemType==="Decor"):[]},{atomLabel:"myPetInventoryAtom",sourceKey:"items",deriveFn:e=>Array.isArray(e)?e.filter(t=>t.itemType==="Pet"):[]}]},journal:{atoms:[{atomLabel:"myJournalAtom",dataKey:"_full"}],derivedAtoms:[{atomLabel:"myCropJournalAtom",sourceKey:"produce",deriveFn:e=>e??{}},{atomLabel:"myPetJournalAtom",sourceKey:"pets",deriveFn:e=>e??{}}]},stats:{atoms:[{atomLabel:"myStatsAtom",dataKey:"_full"}]},activityLog:{atoms:[{atomLabel:"myActivityLogsAtom",dataKey:"logs"}]},seedShop:{atoms:[{atomLabel:"seedShopInventoryAtom",dataKey:"inventory"},{atomLabel:"seedShopRestockSecondsAtom",dataKey:"secondsUntilRestock",transform:e=>e??0}]},eggShop:{atoms:[{atomLabel:"eggShopInventoryAtom",dataKey:"inventory"},{atomLabel:"eggShopRestockSecondsAtom",dataKey:"secondsUntilRestock",transform:e=>e??0}]},toolShop:{atoms:[{atomLabel:"toolShopInventoryAtom",dataKey:"inventory"},{atomLabel:"toolShopRestockSecondsAtom",dataKey:"secondsUntilRestock",transform:e=>e??0}]},decorShop:{atoms:[{atomLabel:"decorShopInventoryAtom",dataKey:"inventory"},{atomLabel:"decorShopRestockSecondsAtom",dataKey:"secondsUntilRestock",transform:e=>e??0}]},leaderboard:{atoms:[{atomLabel:"unsortedLeaderboardAtom",dataKey:"entries"}]},petHutch:{atoms:[{atomLabel:"myPetHutchItemsAtom",dataKey:"items"},{atomLabel:"myPetHutchPetItemsAtom",dataKey:"petItems"}]}};function My(e){return qf[e]}function HA(e){const t=qf[e],n=[];for(const r of t.atoms)n.push(r.atomLabel);if(t.derivedAtoms)for(const r of t.derivedAtoms)n.push(r.atomLabel);return n}const UA=new Set(["inventory","journal","stats","activityLog","petHutch"]),WA=new Set(["seedShop","eggShop","toolShop","decorShop"]),VA=new Set(["leaderboard"]);function qA(e,t,n,r){return function(i){const a=Do(),s=Po();if(a&&s===r){const l=Ay(r);if(l!==null){let d;if(n.dataKey==="_full"?d=l:d=l[n.dataKey],d!==void 0)return t(i),n.transform?n.transform(d):d}}return t(i)}}function XA(e,t,n,r,o){return function(a){if(Do()&&Po()===o){const s=Ay(o);if(s!==null){const l=s[n];if(l!==void 0)return t(a),r(l)}}return t(a)}}function KA(e){const t=My(e);for(const n of t.atoms){const r=Wr(n.atomLabel);if(!r||wp(n.atomLabel))continue;const o=r.read;if(typeof o!="function")continue;const i=qA(n.atomLabel,o,n,e);r.read=i,pm(n.atomLabel,o);}if(t.derivedAtoms)for(const n of t.derivedAtoms){const r=Wr(n.atomLabel);if(!r||wp(n.atomLabel))continue;const o=r.read;if(typeof o!="function")continue;const i=XA(n.atomLabel,o,n.sourceKey,n.deriveFn,e);r.read=i,pm(n.atomLabel,o);}}async function pd(e){const t=My(e);for(const r of t.atoms)fm(r.atomLabel);if(t.derivedAtoms)for(const r of t.derivedAtoms)fm(r.atomLabel);const n=await Gf();await Ly(n,e);}async function YA(e){const t=await Gf();await Ly(t,e);const n=HA(e);for(const r of n){const o=Wr(r);if(o)try{t.get(o);}catch{}}}function fm(e){if(!wp(e))return;const t=Wr(e),n=DA(e);t&&n&&(t.read=n),$A(e);}async function Ly(e,t){const n=UA.has(t),r=WA.has(t),o=VA.has(t);if(!n&&!r&&!o)return;const i=Wr("stateAtom");if(i)try{const a=e.get(i);if(!a||typeof a!="object")return;let s=null;if(n||r){const l=a.child,d=l?.data;if(l&&d&&typeof d=="object"){let c=null;if(n&&Array.isArray(d.userSlots)){const p=d.userSlots.map(m=>{if(!m||typeof m!="object")return m;const b=m,g=b.data,w=g&&typeof g=="object"?{...g}:g;return {...b,data:w}});c={...c??d,userSlots:p};}if(r&&d.shops&&typeof d.shops=="object"&&(c={...c??d,shops:{...d.shops}}),c){const p={...l,data:c};s={...a,child:p};}}}if(o){const l=a.data;if(l&&Array.isArray(l.players)){const d={...l,players:[...l.players]};s={...s??a,data:d};}}if(!s)return;await e.set(i,s);}catch{}}async function JA(){for(const e of Object.keys(qf))await pd(e);}let dl=null,Ra=null;async function QA(){if(ud().initialized)return;Ra=await et.select("activeModalAtom"),dl=setInterval(async()=>{try{const n=await et.select("activeModalAtom"),r=Ra;r!==n&&(Ra=n,ZA(n,r));}catch{}},50),BA(()=>{dl&&(clearInterval(dl),dl=null);}),NA(true);}function ZA(e,t){const n=Do(),r=Po();e===null&&t!==null&&(n&&r===t?eE("native"):n||Vf({modal:t,wasCustom:false,closedBy:"native"})),e!==null&&!n&&Py({modal:e,isCustom:false});}async function eE(e){const t=Po();t&&(Ty(),Wf(false),Uf(null),await pd(t),Vf({modal:t,wasCustom:true,closedBy:e}));}async function tE(e,t){if(!ud().initialized)throw new Error("[MGCustomModal] Not initialized. Call init() first.");Do()&&await Ry(),Ey(e,t),Wf(true),Uf(e),KA(e),await YA(e),await dd.set(e),Ra=e,Py({modal:e,isCustom:true});}function nE(e,t){const n=ud();if(!n.isCustom||n.activeModal!==e||!n.shadow)return;const o={...n.shadow.data,...t};Ey(e,o);}async function Ry(){const e=ud();if(!e.isCustom||!e.activeModal)return;const t=e.activeModal;Ty(),Wf(false),Uf(null),await dd.set(null),Ra=null,await pd(t),Vf({modal:t,wasCustom:true,closedBy:"api"});}function rE(){return new Promise(e=>{if(!Do()){e();return}const t=Iy(()=>{t(),e();});})}async function oE(){if(Do()){const e=Po();e&&await pd(e);}await JA(),GA();}const si={async init(){return QA()},isReady(){return FA()},async show(e,t){return tE(e,t)},update(e,t){return nE(e,t)},async close(){return Ry()},isOpen(){return Po()!==null},isCustomOpen(){return Do()},getActiveModal(){return Po()},waitForClose(){return rE()},onOpen(e){return jA(e)},onClose(e){return Iy(e)},async destroy(){return oE()}};function iE(){return {ready:false,xform:null,xformAt:0}}const En=iE();function Oy(){return En.ready}function Ni(e){try{if(typeof structuredClone=="function")return structuredClone(e)}catch{}try{return JSON.parse(JSON.stringify(e))}catch{}return e}function ws(){return An.tos()}function Xf(){return An.engine()}function aE(){const e=ws()?.map?.cols;return Number.isFinite(e)&&e>0?e:null}function Kf(e,t){const n=aE();return n?t*n+e|0:null}let ul=null;async function sE(e=15e3){return En.ready?true:ul||(ul=(async()=>{if(await An.init(e),!ws())throw new Error("MGTile: engine captured but tileObject system not found");return En.ready=true,true})(),ul)}function ko(e,t,n=true){const r=ws(),o=Kf(e,t);if(!r||o==null)return {gidx:null,tv:null};let i=r.tileViews?.get?.(o)||null;if(!i&&n&&typeof r.getOrCreateTileView=="function")try{i=r.getOrCreateTileView(o);}catch{}return {gidx:o,tv:i||null}}function yu(e,t){if("startTime"in t&&(e.startTime=Number(t.startTime)),"endTime"in t&&(e.endTime=Number(t.endTime)),"targetScale"in t&&(e.targetScale=Number(t.targetScale)),"mutations"in t){if(!Array.isArray(t.mutations))throw new Error("MGTile: mutations must be an array of strings");e.mutations=t.mutations.slice();}}function Yf(e,t){if(!e)throw new Error("MGTile: no tileObject on this tile");if(e.objectType!==t)throw new Error(`MGTile: expected objectType "${t}", got "${e.objectType}"`)}function li(e,t,n,r={}){const o=r.ensureView!==false,i=r.forceUpdate!==false,a=Xf(),{gidx:s,tv:l}=ko(Number(e),Number(t),o);if(s==null)throw new Error("MGTile: cols unavailable (engine/TOS not ready)");if(!l)throw new Error("MGTile: TileView unavailable (not instantiated)");const d=l.tileObject;if(typeof l.onDataChanged!="function")throw new Error("MGTile: tileView.onDataChanged not found (different API?)");if(l.onDataChanged(n),i&&a?.reusableContext&&typeof l.update=="function")try{l.update(a.reusableContext);}catch{}return {ok:true,tx:Number(e),ty:Number(t),gidx:s,before:d,after:l.tileObject}}function fd(e,t,n={}){const r=n.ensureView!==false,o=n.clone!==false,{gidx:i,tv:a}=ko(Number(e),Number(t),r);if(i==null)throw new Error("MGTile: cols unavailable (engine not ready)");if(!a)return {tx:Number(e),ty:Number(t),gidx:i,tileView:null,tileObject:void 0};const s=a.tileObject;return {tx:Number(e),ty:Number(t),gidx:i,tileView:a,tileObject:o?Ni(s):s}}function lE(e,t,n={}){return li(e,t,null,n)}function cE(e,t,n,r={}){const i=fd(e,t,{...r,clone:false}).tileView?.tileObject;Yf(i,"plant");const a=Ni(i);if(Array.isArray(a.slots)||(a.slots=[]),"plantedAt"in n&&(a.plantedAt=Number(n.plantedAt)),"maturedAt"in n&&(a.maturedAt=Number(n.maturedAt)),"species"in n&&(a.species=String(n.species)),"slotIdx"in n&&"slotPatch"in n){const s=Number(n.slotIdx)|0;if(!a.slots[s])throw new Error(`MGTile: plant slot ${s} doesn't exist`);return yu(a.slots[s],n.slotPatch),li(e,t,a,r)}if("slots"in n){const s=n.slots;if(Array.isArray(s)){for(let l=0;l<s.length;l++)if(s[l]!=null){if(!a.slots[l])throw new Error(`MGTile: plant slot ${l} doesn't exist`);yu(a.slots[l],s[l]);}}else if(s&&typeof s=="object")for(const l of Object.keys(s)){const d=Number(l)|0;if(Number.isFinite(d)){if(!a.slots[d])throw new Error(`MGTile: plant slot ${d} doesn't exist`);yu(a.slots[d],s[d]);}}else throw new Error("MGTile: patch.slots must be array or object map");return li(e,t,a,r)}return li(e,t,a,r)}function dE(e,t,n,r={}){const i=fd(e,t,{...r,clone:false}).tileView?.tileObject;Yf(i,"decor");const a=Ni(i);return "rotation"in n&&(a.rotation=Number(n.rotation)),li(e,t,a,r)}function uE(e,t,n,r={}){const i=fd(e,t,{...r,clone:false}).tileView?.tileObject;Yf(i,"egg");const a=Ni(i);return "plantedAt"in n&&(a.plantedAt=Number(n.plantedAt)),"maturedAt"in n&&(a.maturedAt=Number(n.maturedAt)),li(e,t,a,r)}function pE(e,t,n,r={}){const o=r.ensureView!==false,i=r.forceUpdate!==false,a=Xf(),{gidx:s,tv:l}=ko(Number(e),Number(t),o);if(s==null)throw new Error("MGTile: cols unavailable (engine not ready)");if(!l)throw new Error("MGTile: TileView unavailable");const d=l.tileObject,c=typeof n=="function"?n(Ni(d)):n;if(l.onDataChanged(c),i&&a?.reusableContext&&typeof l.update=="function")try{l.update(a.reusableContext);}catch{}return {ok:true,tx:Number(e),ty:Number(t),gidx:s,before:d,after:l.tileObject}}function fE(e,t,n={}){const r=n.ensureView!==false,{gidx:o,tv:i}=ko(Number(e),Number(t),r);if(o==null)throw new Error("MGTile: cols unavailable");if(!i)return {ok:true,tx:Number(e),ty:Number(t),gidx:o,tv:null,tileObject:void 0};const a=n.clone!==false,s=i.tileObject;return {ok:true,tx:Number(e),ty:Number(t),gidx:o,objectType:s?.objectType??null,tileObject:a?Ni(s):s,tvKeys:Object.keys(i||{}).sort(),tileView:i}}function xu(e){if(!e)return null;const t=o=>o&&(typeof o.getGlobalPosition=="function"||typeof o.toGlobal=="function"),n=["container","root","view","tile","ground","base","floor","bg","background","baseSprite","tileSprite","displayObject","gfx","graphics","sprite"];for(const o of n)if(t(e[o]))return e[o];if(t(e))return e;const r=[e.container,e.root,e.view,e.displayObject,e.tileSprite,e.gfx,e.graphics,e.sprite];for(const o of r)if(t(o))return o;try{for(const o of Object.keys(e))if(t(e[o]))return e[o]}catch{}return null}function Xl(e){const t=Bn(()=>e?.getGlobalPosition?.());if(t&&Number.isFinite(t.x)&&Number.isFinite(t.y))return {x:t.x,y:t.y};const n=Bn(()=>e?.toGlobal?.({x:0,y:0}));return n&&Number.isFinite(n.x)&&Number.isFinite(n.y)?{x:n.x,y:n.y}:null}function hE(e){try{if(!e?.getBounds)return "center";const t=e.getBounds(),n=Xl(e);if(!n||!t||!Number.isFinite(t.width)||!Number.isFinite(t.height))return "center";const r=t.x+t.width/2,o=t.y+t.height/2;return Math.hypot(n.x-r,n.y-o)<Math.hypot(n.x-t.x,n.y-t.y)?"center":"topleft"}catch{return "center"}}function gE(){const e=ws(),t=e?.map?.cols,n=e?.map?.rows;if(!e||!Number.isFinite(t)||t<=1)return null;const r=Number.isFinite(n)&&n>1?n:null,o=[[0,0],[1,1],[Math.min(2,t-2),0],[0,1]];r&&r>2&&o.push([Math.floor(t/2),Math.floor(r/2)]);for(const[i,a]of o){if(i<0||a<0||i>=t||r&&a>=r)continue;const s=ko(i,a,true).tv,l=i+1<t?ko(i+1,a,true).tv:null,d=ko(i,a+1,true).tv,c=xu(s),p=xu(l),m=xu(d);if(!c||!p||!m)continue;const b=Xl(c),g=Xl(p),w=Xl(m);if(!b||!g||!w)continue;const _={x:g.x-b.x,y:g.y-b.y},C={x:w.x-b.x,y:w.y-b.y},E=_.x*C.y-_.y*C.x;if(!Number.isFinite(E)||Math.abs(E)<1e-6)continue;const P=1/E,O={a:C.y*P,b:-C.x*P,c:-_.y*P,d:_.x*P},F={x:b.x-i*_.x-a*C.x,y:b.y-i*_.y-a*C.y},A=hE(c),T=A==="center"?F:{x:F.x+.5*(_.x+C.x),y:F.y+.5*(_.y+C.y)};return {ok:true,cols:t,rows:r,vx:_,vy:C,inv:O,anchorMode:A,originCenter:T}}return null}function Fy(){return En.xform=gE(),En.xformAt=Date.now(),{ok:!!En.xform?.ok,xform:En.xform}}function mE(e,t={}){if(!e||!Number.isFinite(e.x)||!Number.isFinite(e.y))return null;const n=Number.isFinite(t.maxAgeMs)?Number(t.maxAgeMs):1500;(!En.xform?.ok||t.forceRebuild||Date.now()-En.xformAt>n)&&Fy();const r=En.xform;if(!r?.ok)return null;const o=e.x-r.originCenter.x,i=e.y-r.originCenter.y,a=r.inv.a*o+r.inv.b*i,s=r.inv.c*o+r.inv.d*i,l=Math.floor(a),d=Math.floor(s),c=[[l,d],[l+1,d],[l,d+1],[l+1,d+1]];let p=null,m=1/0;for(const[b,g]of c){if(b<0||g<0||b>=r.cols||Number.isFinite(r.rows)&&r.rows!==null&&g>=r.rows)continue;const w=r.originCenter.x+b*r.vx.x+g*r.vy.x,_=r.originCenter.y+b*r.vx.y+g*r.vy.y,C=(e.x-w)**2+(e.y-_)**2;C<m&&(m=C,p={tx:b,ty:g,fx:a,fy:s,x:e.x,y:e.y,gidx:null});}return p?(p.gidx=Kf(p.tx,p.ty),p):null}function bE(e,t){const n=En.xform;return n?.ok?{x:n.originCenter.x+e*n.vx.x+t*n.vy.x,y:n.originCenter.y+e*n.vx.y+t*n.vy.y}:null}function On(){if(!Oy())throw new Error("MGTile: not ready. Call MGTile.init() first.")}function vE(){return ["MGTile.init()","MGTile.hook()","MGTile.getTileObject(tx,ty) / inspect(tx,ty)","MGTile.setTileEmpty(tx,ty)","MGTile.setTilePlant(tx,ty,{...}) / setTileDecor / setTileEgg","MGTile.setTileObjectRaw(tx,ty,objOrFn)","MGTile.rebuildTransform() / pointToTile({x,y})","MGTile.tileToPoint(tx,ty)"].join(`
`)}const Er={init:sE,isReady:Oy,hook:An.hook,engine:Xf,tos:ws,gidx:(e,t)=>Kf(Number(e),Number(t)),getTileObject:(e,t,n={})=>(On(),fd(e,t,n)),inspect:(e,t,n={})=>(On(),fE(e,t,n)),setTileEmpty:(e,t,n={})=>(On(),lE(e,t,n)),setTilePlant:(e,t,n,r={})=>(On(),cE(e,t,n,r)),setTileDecor:(e,t,n,r={})=>(On(),dE(e,t,n,r)),setTileEgg:(e,t,n,r={})=>(On(),uE(e,t,n,r)),setTileObjectRaw:(e,t,n,r={})=>(On(),pE(e,t,n,r)),rebuildTransform:()=>(On(),Fy()),pointToTile:(e,t={})=>(On(),mE(e,t)),tileToPoint:(e,t)=>(On(),bE(e,t)),getTransform:()=>(On(),En.xform),help:vE};function yE(){return {ready:false,app:null,renderer:null,stage:null,ticker:null,tileSets:new Map,highlights:new Map,watches:new Map,fades:new Map,fadeWatches:new Map}}const Me=yE();function Ny(){return Me.ready}async function xE(e=15e3){if(Me.ready)return Cp(),true;if(await An.init(e),Me.app=An.app(),Me.ticker=An.ticker(),Me.renderer=An.renderer(),Me.stage=An.stage(),!Me.app||!Me.ticker)throw new Error("MGPixi: PIXI app/ticker not found");return Me.ready=true,Cp(),true}function Cp(){const e=he;return e.$PIXI=e.PIXI||null,e.$app=Me.app||null,e.$renderer=Me.renderer||null,e.$stage=Me.stage||null,e.$ticker=Me.ticker||null,e.__MG_PIXI__={PIXI:e.$PIXI,app:e.$app,renderer:e.$renderer,stage:e.$stage,ticker:e.$ticker,ready:Me.ready},e.__MG_PIXI__}function Jf(e){return !!e&&typeof e=="object"&&!Array.isArray(e)}function Sp(e){return !!(e&&typeof e.getBounds=="function"&&("parent"in e||"children"in e))}function Fc(e){return !!(e&&typeof e.tint=="number")}function Mo(e){return !!(e&&typeof e.alpha=="number")}function Kl(e,t,n){return e+(t-e)*n}function wE(e,t,n){const r=e>>16&255,o=e>>8&255,i=e&255,a=t>>16&255,s=t>>8&255,l=t&255,d=Kl(r,a,n)|0,c=Kl(o,s,n)|0,p=Kl(i,l,n)|0;return d<<16|c<<8|p}function CE(e,t=900){const n=[],r=[e];for(;r.length&&n.length<t;){const o=r.pop();if(!o)continue;Fc(o)&&n.push(o);const i=o.children;if(Array.isArray(i))for(let a=i.length-1;a>=0;a--)r.push(i[a]);}return n}function SE(e,t=25e3){const n=[],r=[e];let o=0;for(;r.length&&o++<t;){const i=r.pop();if(!i)continue;Mo(i)&&n.push(i);const a=i.children;if(Array.isArray(a))for(let s=a.length-1;s>=0;s--)r.push(a[s]);}return n}const kE=["plantVisual","cropVisual","slotVisual","slotView","displayObject","view","container","root","sprite","gfx","graphics"];function kp(e){if(!e)return null;if(Sp(e))return e;if(!Jf(e))return null;for(const t of kE){const n=e[t];if(Sp(n))return n}return null}function _E(e,t){const n=[{o:e,d:0}],r=new Set,o=6;for(;n.length;){const{o:i,d:a}=n.shift();if(!(!i||a>o)&&!r.has(i)){if(r.add(i),Array.isArray(i)){if(i.length===t){const s=new Array(t);let l=true;for(let d=0;d<t;d++){const c=kp(i[d]);if(!c){l=false;break}s[d]=c;}if(l)return s}for(const s of i)n.push({o:s,d:a+1});continue}if(Jf(i)){const s=i;for(const l of Object.keys(s))n.push({o:s[l],d:a+1});}}}return null}function Dy(e){if(!Array.isArray(e))return [];const t=new Set,n=[];for(const r of e){let o,i;if(Array.isArray(r))o=r[0],i=r[1];else if(Jf(r))o=r.x??r.tx,i=r.y??r.ty;else continue;if(o=Number(o),i=Number(i),!Number.isFinite(o)||!Number.isFinite(i))continue;o|=0,i|=0;const a=`${o},${i}`;t.has(a)||(t.add(a),n.push({x:o,y:i}));}return n}function AE(e,t){const n=String(e||"").trim();if(!n)throw new Error("MGPixi.defineTileSet: empty name");const r=Dy(t);return Me.tileSets.set(n,r),{ok:true,name:n,count:r.length}}function EE(e){return Me.tileSets.delete(String(e||"").trim())}function TE(){return Array.from(Me.tileSets.keys()).sort((e,t)=>e.localeCompare(t))}function $y(e){return !!(e&&(e.tileSet!=null||Array.isArray(e.tiles)))}function Qf(e){const n=Er.tos?.()?.tileViews;if(!n?.entries)throw new Error("MGPixi: TOS.tileViews not found");if(!$y(e))return {entries:Array.from(n.entries()),gidxSet:null};let r=[];if(e.tileSet!=null){const i=String(e.tileSet||"").trim(),a=Me.tileSets.get(i);if(!a)throw new Error(`MGPixi: tileSet not found "${i}"`);r=a;}else r=Dy(e.tiles||[]);const o=new Map;for(const i of r){const a=Er.getTileObject(i.x,i.y,{ensureView:true,clone:false});a?.tileView&&a.gidx!=null&&o.set(a.gidx,a.tileView);}return {entries:Array.from(o.entries()),gidxSet:new Set(o.keys())}}function Zf(e){const t=Me.highlights.get(e);if(!t)return  false;Bn(()=>Me.ticker?.remove(t.tick)),t.root&&t.baseAlpha!=null&&Mo(t.root)&&Bn(()=>{t.root.alpha=t.baseAlpha;});for(const n of t.tint)n.o&&Fc(n.o)&&Bn(()=>{n.o.tint=n.baseTint;});return Me.highlights.delete(e),true}function By(e=null){for(const t of Array.from(Me.highlights.keys()))e&&!String(t).startsWith(e)||Zf(t);return  true}function zy(e,t={}){if(!Sp(e))throw new Error("MGPixi.highlightPulse: invalid root");const n=String(t.key||`hl:${Math.random().toString(16).slice(2)}`);if(Me.highlights.has(n))return n;const r=Mo(e)?Number(e.alpha):null,o=nr(Number(t.minAlpha??.12),0,1),i=nr(Number(t.maxAlpha??1),0,1),a=Number(t.speed??1.25),s=(t.tint??8386303)>>>0,l=nr(Number(t.tintMix??.85),0,1),d=t.deepTint!==false,c=[];if(d)for(const b of CE(e))c.push({o:b,baseTint:b.tint});else Fc(e)&&c.push({o:e,baseTint:e.tint});const p=performance.now(),m=()=>{const b=(performance.now()-p)/1e3,g=(Math.sin(b*Math.PI*2*a)+1)/2,w=g*g*(3-2*g);r!=null&&Mo(e)&&(e.alpha=nr(Kl(o,i,w)*r,0,1));const _=w*l;for(const C of c)C.o&&Fc(C.o)&&(C.o.tint=wE(C.baseTint,s,_));};return Me.ticker?.add(m),Me.highlights.set(n,{root:e,tick:m,baseAlpha:r,tint:c}),n}function IE(e,t){const n=e?.mutations;if(!Array.isArray(n))return  false;for(const r of n)if(String(r||"").toLowerCase()===t)return  true;return  false}function jy(e,t={}){const n=String(e||"").trim().toLowerCase();if(!n)throw new Error("MGPixi.highlightMutation: empty mutation");const{entries:r,gidxSet:o}=Qf(t),i=`hlmut:${n}:`;if(t.clear===true)if(!o)By(i);else for(const p of Array.from(Me.highlights.keys())){if(!p.startsWith(i))continue;const m=p.split(":"),b=Number(m[2]);o.has(b)&&Zf(p);}const a={tint:(t.tint??8386303)>>>0,minAlpha:Number(t.minAlpha??.12),maxAlpha:Number(t.maxAlpha??1),speed:Number(t.speed??1.25),tintMix:Number(t.tintMix??.85),deepTint:t.deepTint!==false};let s=0,l=0,d=0,c=0;for(const[p,m]of r){const b=m?.tileObject;if(!b||b.objectType!=="plant")continue;const g=b.slots;if(!Array.isArray(g)||g.length===0)continue;let w=false;const _=[];for(let P=0;P<g.length;P++)IE(g[P],n)&&(_.push(P),w=true);if(!w)continue;s++,l+=_.length;const C=m?.childView?.plantVisual||m?.childView||m,E=_E(C,g.length);if(!E){c+=_.length;continue}for(const P of _){const O=E[P];if(!O){c++;continue}const F=`${i}${p}:${P}`;Me.highlights.has(F)||(zy(O,{key:F,...a}),d++);}}return {ok:true,mutation:n,filtered:!!o,plantsMatched:s,matchedSlots:l,newHighlights:d,failedSlots:c}}function PE(e,t={}){const n=String(e||"").trim().toLowerCase();if(!n)throw new Error("MGPixi.watchMutation: empty mutation");const r=`watchmut:${n}:${t.tileSet?`set:${t.tileSet}`:t.tiles?"tiles":"all"}`,o=Number.isFinite(t.intervalMs)?t.intervalMs:1e3,i=Me.watches.get(r);i&&clearInterval(i);const a=setInterval(()=>{Bn(()=>jy(n,{...t,clear:!1}));},o);return Me.watches.set(r,a),{ok:true,key:r,mutation:n,intervalMs:o}}function ME(e){const t=String(e||"").trim();if(!t)return  false;if(!t.startsWith("watchmut:")){const r=t.toLowerCase();let o=0;for(const[i,a]of Array.from(Me.watches.entries()))i.startsWith(`watchmut:${r}:`)&&(clearInterval(a),Me.watches.delete(i),o++);return o>0}const n=Me.watches.get(t);return n?(clearInterval(n),Me.watches.delete(t),true):false}function LE(e){const t=e?.childView?.plantVisual||e?.childView?.cropVisual||e?.childView||e?.displayObject||e;return kp(t)||kp(e?.displayObject)||null}function Gy(e){const t=Me.fades.get(e);if(!t)return  false;for(const n of t.targets)n.o&&Mo(n.o)&&Number.isFinite(n.baseAlpha)&&Bn(()=>{n.o.alpha=n.baseAlpha;});return Me.fades.delete(e),true}function _p(e=null){for(const t of Array.from(Me.fades.keys()))e&&!String(t).startsWith(e)||Gy(t);return  true}function Hy(e,t={}){const n=String(e||"").trim().toLowerCase();if(!n)throw new Error("MGPixi.clearSpeciesFade: empty species");const r=`fade:${n}:`;if(!$y(t))return _p(r);const{gidxSet:o}=Qf(t);if(!o)return _p(r);for(const i of Array.from(Me.fades.keys())){if(!i.startsWith(r))continue;const a=Number(i.slice(r.length));o.has(a)&&Gy(i);}return  true}function Uy(e,t={}){const n=String(e||"").trim().toLowerCase();if(!n)throw new Error("MGPixi.fadeSpecies: empty species");const r=nr(Number(t.alpha??.2),0,1),o=t.deep===true,{entries:i,gidxSet:a}=Qf(t),s=`fade:${n}:`;t.clear===true&&Hy(n,t);let l=0,d=0,c=0,p=0;for(const[m,b]of i){const g=b?.tileObject;if(!g||g.objectType!=="plant")continue;l++;const w=String(g.species||"").trim().toLowerCase();if(!w||w!==n)continue;d++;const _=LE(b);if(!_||!Mo(_)){p++;continue}const C=`${s}${m}`;if(Me.fades.has(C)){Bn(()=>{_.alpha=r;}),c++;continue}const E=o?SE(_):[_],P=[];for(const O of E)Mo(O)&&P.push({o:O,baseAlpha:Number(O.alpha)});for(const O of P)Bn(()=>{O.o.alpha=r;});Me.fades.set(C,{targets:P}),c++;}return {ok:true,species:n,alpha:r,deep:o,filtered:!!a,plantsSeen:l,matchedPlants:d,applied:c,failed:p,totalFades:Me.fades.size}}function RE(e,t={}){const n=String(e||"").trim().toLowerCase();if(!n)throw new Error("MGPixi.watchFadeSpecies: empty species");const r=`watchfade:${n}:${t.tileSet?`set:${t.tileSet}`:t.tiles?"tiles":"all"}`,o=Number.isFinite(t.intervalMs)?t.intervalMs:1e3,i=Me.fadeWatches.get(r);i&&clearInterval(i);const a=setInterval(()=>{Bn(()=>Uy(n,{...t,clear:!1}));},o);return Me.fadeWatches.set(r,a),{ok:true,key:r,species:n,intervalMs:o}}function OE(e){const t=String(e||"").trim();if(!t)return  false;if(!t.startsWith("watchfade:")){const r=t.toLowerCase();let o=0;for(const[i,a]of Array.from(Me.fadeWatches.entries()))i.startsWith(`watchfade:${r}:`)&&(clearInterval(a),Me.fadeWatches.delete(i),o++);return o>0}const n=Me.fadeWatches.get(t);return n?(clearInterval(n),Me.fadeWatches.delete(t),true):false}function FE(e){const t=Array.isArray(e?.slots)?e.slots:[];return {objectType:"plant",species:e?.species??null,plantedAt:e?.plantedAt??null,maturedAt:e?.maturedAt??null,slotCount:t.length,slots:t.map((n,r)=>({idx:r,mutations:Array.isArray(n?.mutations)?n.mutations.slice():[]}))}}function NE(e,t,n={}){const r=Number(e)|0,o=Number(t)|0,i=n.ensureView!==false,a=Er.getTileObject(r,o,{ensureView:i,clone:false}),s=a?.tileView||null,l=s?.tileObject,d={ok:true,tx:r,ty:o,gidx:a?.gidx??Er.gidx?.(r,o)??null,hasTileView:!!s,objectType:l?.objectType??null,tileObject:l??null,summary:l?.objectType==="plant"?FE(l):l?{objectType:l.objectType??null}:null,display:s?s.childView?.plantVisual||s.childView||s.displayObject||s:null};return n.log!==false&&Bn(()=>console.log("[MGPixi.inspectTile]",d)),d}function DE(e,t,n){const r=he.PIXI;if(!r)return;let o=Me.stage.getChildByName("gemini-overlay");o||(o=new r.Container,o.name="gemini-overlay",Me.stage.addChild(o));const i=n.key;let a=o.getChildByName(i);a||(a=new r.Graphics,a.name=i,o.addChild(a));const s=Er.tileToPoint(e,t);if(!s)return;a.clear(),a.lineStyle(2,n.tint??65280,n.alpha??1),a.beginFill(n.tint??65280,(n.alpha??1)*.2);const l=Er.getTransform(),d=l?Math.hypot(l.vx.x,l.vx.y):32,c=l?Math.hypot(l.vy.x,l.vy.y):32;a.drawRect(0,0,d,c),a.endFill(),a.x=s.x,a.y=s.y,l&&(a.rotation=Math.atan2(l.vx.y,l.vx.x));}function $E(e){const t=Me.stage?.getChildByName("gemini-overlay");if(!t)return  false;const n=t.getChildByName(e);return n?(t.removeChild(n),n.destroy?.(),true):false}function Gt(){if(!Ny())throw new Error("MGPixi: call MGPixi.init() first")}const hd={init:xE,isReady:Ny,expose:Cp,get app(){return Me.app},get renderer(){return Me.renderer},get stage(){return Me.stage},get ticker(){return Me.ticker},get PIXI(){return he.PIXI||null},defineTileSet:(e,t)=>(Gt(),AE(e,t)),deleteTileSet:e=>(Gt(),EE(e)),listTileSets:()=>(Gt(),TE()),highlightPulse:(e,t)=>(Gt(),zy(e,t)),stopHighlight:e=>(Gt(),Zf(e)),clearHighlights:e=>(Gt(),By(e)),drawOverlayBox:(e,t,n)=>(Gt(),DE(e,t,n)),stopOverlay:e=>(Gt(),$E(e)),highlightMutation:(e,t)=>(Gt(),jy(e,t)),watchMutation:(e,t)=>(Gt(),PE(e,t)),stopWatchMutation:e=>(Gt(),ME(e)),inspectTile:(e,t,n)=>(Gt(),NE(e,t,n)),fadeSpecies:(e,t)=>(Gt(),Uy(e,t)),clearSpeciesFade:(e,t)=>(Gt(),Hy(e,t)),clearFades:e=>(Gt(),_p(e)),watchFadeSpecies:(e,t)=>(Gt(),RE(e,t)),stopWatchFadeSpecies:e=>(Gt(),OE(e))},BE=["Top","Mid","Bottom","DiscordAvatarPlaceholder"],Yl={AVATAR:/avatarelements[^"']*\.riv/,EMOTES:/emotes[^"']*\.riv/,UI:/(giftbox|currency|bread|donut|streak)[^"']*\.riv/},Wy=new Map;let Vy=[],qy=false;function zE(e){return Wy.get(e)}function jE(e,t){Wy.set(e,t);}function GE(){return [...Vy]}function HE(e){Vy=e;}function UE(){return qy}function hm(e){qy=e;}async function Xy(){const t=Wt.detect().origin,n=Array.from(document.scripts),r=[];for(const i of n){const a=i.textContent||"",s=gm(a,t);r.push(...s);}for(const i of n)if(i.src)try{if(new URL(i.src).origin!==t)continue;const s=await fetch(i.src);if(!s.ok)continue;const l=await s.text(),d=gm(l,t);r.push(...d);}catch(a){console.debug("[MGRiveLoader] Failed to fetch script:",i.src,a);}const o=Array.from(new Map(r.map(i=>[i.url,i])).values());return HE(o),console.log(`[MGRiveLoader] Discovered ${o.length} .riv files:`,o),o}function gm(e,t){const n=[];return Object.entries(Yl).forEach(([r,o])=>{const i=new RegExp(`["']([^"']*\\.riv)["']`,"g");let a;for(;(a=i.exec(e))!==null;){const s=a[1];if(!o.test(s))continue;const l=s.startsWith("/")?`${t}${s}`:s,d=WE(s);n.push({name:VE(s),url:l,type:d});}}),n}function WE(e){return Yl.AVATAR.test(e)?"avatar":Yl.EMOTES.test(e)?"emote":Yl.UI.test(e)?"ui":"other"}function VE(e){const t=e.split("/");return t[t.length-1].replace(/-[a-zA-Z0-9]+\.riv$/,"")}async function Ky(){const t=(await Xy()).find(n=>n.type==="avatar");return t||(console.warn("[MGRiveLoader] Could not find avatar .riv file"),null)}var Jl={exports:{}},qE=Jl.exports,mm;function XE(){return mm||(mm=1,(function(e,t){(function(r,o){e.exports=o();})(qE,()=>(()=>{var n=[,((a,s,l)=>{l.r(s),l.d(s,{default:()=>c});var d=(()=>{var p=typeof document<"u"?document.currentScript?.src:void 0;return(function(m={}){var b,g=m,w,_,C=new Promise((u,f)=>{w=u,_=f;}),E=typeof window=="object",P=typeof importScripts=="function";function O(){function u(X){const Y=k;y=f=0,k=new Map,Y.forEach(se=>{try{se(X);}catch(re){console.error(re);}}),this.ob(),N&&N.Qb();}let f=0,y=0,k=new Map,N=null,$=null;this.requestAnimationFrame=function(X){f||(f=requestAnimationFrame(u.bind(this)));const Y=++y;return k.set(Y,X),Y},this.cancelAnimationFrame=function(X){k.delete(X),f&&k.size==0&&(cancelAnimationFrame(f),f=0);},this.Ob=function(X){$&&(document.body.remove($),$=null),X||($=document.createElement("div"),$.style.backgroundColor="black",$.style.position="fixed",$.style.right=0,$.style.top=0,$.style.color="white",$.style.padding="4px",$.innerHTML="RIVE FPS",X=function(Y){$.innerHTML="RIVE FPS "+Y.toFixed(1);},document.body.appendChild($)),N=new function(){let Y=0,se=0;this.Qb=function(){var re=performance.now();se?(++Y,re-=se,1e3<re&&(X(1e3*Y/re),Y=se=0)):(se=re,Y=0);};};},this.Lb=function(){$&&(document.body.remove($),$=null),N=null;},this.ob=function(){};}function F(u){console.assert(true);const f=new Map;let y=-1/0;this.push=function(k){return k=k+((1<<u)-1)>>u,f.has(k)&&clearTimeout(f.get(k)),f.set(k,setTimeout(function(){f.delete(k),f.length==0?y=-1/0:k==y&&(y=Math.max(...f.keys()),console.assert(y<k));},1e3)),y=Math.max(k,y),y<<u};}const A=g.onRuntimeInitialized;g.onRuntimeInitialized=function(){A&&A();let u=g.decodeAudio;g.decodeAudio=function(N,$){N=u(N),$(N);};let f=g.decodeFont;g.decodeFont=function(N,$){N=f(N),$(N);};const y=g.FileAssetLoader;g.ptrToAsset=N=>{let $=g.ptrToFileAsset(N);return $.isImage?g.ptrToImageAsset(N):$.isFont?g.ptrToFontAsset(N):$.isAudio?g.ptrToAudioAsset(N):$},g.CustomFileAssetLoader=y.extend("CustomFileAssetLoader",{__construct:function({loadContents:N}){this.__parent.__construct.call(this),this.Eb=N;},loadContents:function(N,$){return N=g.ptrToAsset(N),this.Eb(N,$)}}),g.CDNFileAssetLoader=y.extend("CDNFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this);},loadContents:function(N){let $=g.ptrToAsset(N);return N=$.cdnUuid,N===""?false:((function(X,Y){var se=new XMLHttpRequest;se.responseType="arraybuffer",se.onreadystatechange=function(){se.readyState==4&&se.status==200&&Y(se);},se.open("GET",X,true),se.send(null);})($.cdnBaseUrl+"/"+N,X=>{$.decode(new Uint8Array(X.response));}),true)}}),g.FallbackFileAssetLoader=y.extend("FallbackFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this),this.kb=[];},addLoader:function(N){this.kb.push(N);},loadContents:function(N,$){for(let X of this.kb)if(X.loadContents(N,$))return  true;return  false}});let k=g.computeAlignment;g.computeAlignment=function(N,$,X,Y,se=1){return k.call(this,N,$,X,Y,se)};};const T="createConicGradient createImageData createLinearGradient createPattern createRadialGradient getContextAttributes getImageData getLineDash getTransform isContextLost isPointInPath isPointInStroke measureText".split(" "),M=new function(){function u(){if(!f){let He=function(qe,_e,ct){if(_e=fe.createShader(_e),fe.shaderSource(_e,ct),fe.compileShader(_e),ct=fe.getShaderInfoLog(_e),0<(ct||"").length)throw ct;fe.attachShader(qe,_e);};var J=document.createElement("canvas"),xe={alpha:1,depth:0,stencil:0,antialias:0,premultipliedAlpha:1,preserveDrawingBuffer:0,powerPreference:"high-performance",failIfMajorPerformanceCaveat:0,enableExtensionsByDefault:1,explicitSwapControl:1,renderViaOffscreenBackBuffer:1};let fe;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(fe=J.getContext("webgl",xe),y=1,!fe)return console.log("No WebGL support. Image mesh will not be drawn."),false}else if(fe=J.getContext("webgl2",xe))y=2;else if(fe=J.getContext("webgl",xe))y=1;else return console.log("No WebGL support. Image mesh will not be drawn."),false;if(fe=new Proxy(fe,{get(qe,_e){if(qe.isContextLost()){if(se||(console.error("Cannot render the mesh because the GL Context was lost. Tried to invoke ",_e),se=true),typeof qe[_e]=="function")return function(){}}else return typeof qe[_e]=="function"?function(...ct){return qe[_e].apply(qe,ct)}:qe[_e]},set(qe,_e,ct){if(qe.isContextLost())se||(console.error("Cannot render the mesh because the GL Context was lost. Tried to set property "+_e),se=true);else return qe[_e]=ct,true}}),k=Math.min(fe.getParameter(fe.MAX_RENDERBUFFER_SIZE),fe.getParameter(fe.MAX_TEXTURE_SIZE)),J=fe.createProgram(),He(J,fe.VERTEX_SHADER,`attribute vec2 vertex;
                attribute vec2 uv;
                uniform vec4 mat;
                uniform vec2 translate;
                varying vec2 st;
                void main() {
                    st = uv;
                    gl_Position = vec4(mat2(mat) * vertex + translate, 0, 1);
                }`),He(J,fe.FRAGMENT_SHADER,`precision highp float;
                uniform sampler2D image;
                varying vec2 st;
                void main() {
                    gl_FragColor = texture2D(image, st);
                }`),fe.bindAttribLocation(J,0,"vertex"),fe.bindAttribLocation(J,1,"uv"),fe.linkProgram(J),xe=fe.getProgramInfoLog(J),0<(xe||"").trim().length)throw xe;N=fe.getUniformLocation(J,"mat"),$=fe.getUniformLocation(J,"translate"),fe.useProgram(J),fe.bindBuffer(fe.ARRAY_BUFFER,fe.createBuffer()),fe.enableVertexAttribArray(0),fe.enableVertexAttribArray(1),fe.bindBuffer(fe.ELEMENT_ARRAY_BUFFER,fe.createBuffer()),fe.uniform1i(fe.getUniformLocation(J,"image"),0),fe.pixelStorei(fe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,true),f=fe;}return  true}let f=null,y=0,k=0,N=null,$=null,X=0,Y=0,se=false;u(),this.bc=function(){return u(),k},this.Kb=function(J){f.deleteTexture&&f.deleteTexture(J);},this.Jb=function(J){if(!u())return null;const xe=f.createTexture();return xe?(f.bindTexture(f.TEXTURE_2D,xe),f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,J),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),y==2?(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR_MIPMAP_LINEAR),f.generateMipmap(f.TEXTURE_2D)):f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),xe):null};const re=new F(8),me=new F(8),Ae=new F(10),Ee=new F(10);this.Nb=function(J,xe,fe,He,qe){if(u()){var _e=re.push(J),ct=me.push(xe);if(f.canvas){(f.canvas.width!=_e||f.canvas.height!=ct)&&(f.canvas.width=_e,f.canvas.height=ct),f.viewport(0,ct-xe,J,xe),f.disable(f.SCISSOR_TEST),f.clearColor(0,0,0,0),f.clear(f.COLOR_BUFFER_BIT),f.enable(f.SCISSOR_TEST),fe.sort((Ze,Kn)=>Kn.vb-Ze.vb),_e=Ae.push(He),X!=_e&&(f.bufferData(f.ARRAY_BUFFER,8*_e,f.DYNAMIC_DRAW),X=_e),_e=0;for(var Ft of fe)f.bufferSubData(f.ARRAY_BUFFER,_e,Ft.Ta),_e+=4*Ft.Ta.length;console.assert(_e==4*He);for(var fn of fe)f.bufferSubData(f.ARRAY_BUFFER,_e,fn.Bb),_e+=4*fn.Bb.length;console.assert(_e==8*He),_e=Ee.push(qe),Y!=_e&&(f.bufferData(f.ELEMENT_ARRAY_BUFFER,2*_e,f.DYNAMIC_DRAW),Y=_e),Ft=0;for(var to of fe)f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,Ft,to.indices),Ft+=2*to.indices.length;console.assert(Ft==2*qe),to=0,fn=true,_e=Ft=0;for(const Ze of fe){Ze.image.Ja!=to&&(f.bindTexture(f.TEXTURE_2D,Ze.image.Ia||null),to=Ze.image.Ja),Ze.hc?(f.scissor(Ze.Za,ct-Ze.$a-Ze.jb,Ze.uc,Ze.jb),fn=true):fn&&(f.scissor(0,ct-xe,J,xe),fn=false),fe=2/J;const Kn=-2/xe;f.uniform4f(N,Ze.ha[0]*fe*Ze.Aa,Ze.ha[1]*Kn*Ze.Ba,Ze.ha[2]*fe*Ze.Aa,Ze.ha[3]*Kn*Ze.Ba),f.uniform2f($,Ze.ha[4]*fe*Ze.Aa+fe*(Ze.Za-Ze.cc*Ze.Aa)-1,Ze.ha[5]*Kn*Ze.Ba+Kn*(Ze.$a-Ze.dc*Ze.Ba)+1),f.vertexAttribPointer(0,2,f.FLOAT,false,0,_e),f.vertexAttribPointer(1,2,f.FLOAT,false,0,_e+4*He),f.drawElements(f.TRIANGLES,Ze.indices.length,f.UNSIGNED_SHORT,Ft),_e+=4*Ze.Ta.length,Ft+=2*Ze.indices.length;}console.assert(_e==4*He),console.assert(Ft==2*qe);}}},this.canvas=function(){return u()&&f.canvas};},S=g.onRuntimeInitialized;g.onRuntimeInitialized=function(){function u(pe){switch(pe){case re.srcOver:return "source-over";case re.screen:return "screen";case re.overlay:return "overlay";case re.darken:return "darken";case re.lighten:return "lighten";case re.colorDodge:return "color-dodge";case re.colorBurn:return "color-burn";case re.hardLight:return "hard-light";case re.softLight:return "soft-light";case re.difference:return "difference";case re.exclusion:return "exclusion";case re.multiply:return "multiply";case re.hue:return "hue";case re.saturation:return "saturation";case re.color:return "color";case re.luminosity:return "luminosity"}}function f(pe){return "rgba("+((16711680&pe)>>>16)+","+((65280&pe)>>>8)+","+((255&pe)>>>0)+","+((4278190080&pe)>>>24)/255+")"}function y(){0<ct.length&&(M.Nb(_e.drawWidth(),_e.drawHeight(),ct,Ft,fn),ct=[],fn=Ft=0,_e.reset(512,512));for(const pe of qe){for(const ke of pe.I)ke();pe.I=[];}qe.clear();}S&&S();var k=g.RenderPaintStyle;const N=g.RenderPath,$=g.RenderPaint,X=g.Renderer,Y=g.StrokeCap,se=g.StrokeJoin,re=g.BlendMode,me=k.fill,Ae=k.stroke,Ee=g.FillRule.evenOdd;let J=1;var xe=g.RenderImage.extend("CanvasRenderImage",{__construct:function({la:pe,wa:ke}={}){this.__parent.__construct.call(this),this.Ja=J,J=J+1&2147483647||1,this.la=pe,this.wa=ke;},__destruct:function(){this.Ia&&(M.Kb(this.Ia),URL.revokeObjectURL(this.Wa)),this.__parent.__destruct.call(this);},decode:function(pe){var ke=this;ke.wa&&ke.wa(ke);var Xe=new Image;ke.Wa=URL.createObjectURL(new Blob([pe],{type:"image/png"})),Xe.onload=function(){ke.Db=Xe,ke.Ia=M.Jb(Xe),ke.size(Xe.width,Xe.height),ke.la&&ke.la(ke);},Xe.src=ke.Wa;}}),fe=N.extend("CanvasRenderPath",{__construct:function(){this.__parent.__construct.call(this),this.U=new Path2D;},rewind:function(){this.U=new Path2D;},addPath:function(pe,ke,Xe,Ue,it,Ke,We){var st=this.U,Yn=st.addPath;pe=pe.U;const _t=new DOMMatrix;_t.a=ke,_t.b=Xe,_t.c=Ue,_t.d=it,_t.e=Ke,_t.f=We,Yn.call(st,pe,_t);},fillRule:function(pe){this.Va=pe;},moveTo:function(pe,ke){this.U.moveTo(pe,ke);},lineTo:function(pe,ke){this.U.lineTo(pe,ke);},cubicTo:function(pe,ke,Xe,Ue,it,Ke){this.U.bezierCurveTo(pe,ke,Xe,Ue,it,Ke);},close:function(){this.U.closePath();}}),He=$.extend("CanvasRenderPaint",{color:function(pe){this.Xa=f(pe);},thickness:function(pe){this.Gb=pe;},join:function(pe){switch(pe){case se.miter:this.Ha="miter";break;case se.round:this.Ha="round";break;case se.bevel:this.Ha="bevel";}},cap:function(pe){switch(pe){case Y.butt:this.Ga="butt";break;case Y.round:this.Ga="round";break;case Y.square:this.Ga="square";}},style:function(pe){this.Fb=pe;},blendMode:function(pe){this.Cb=u(pe);},clearGradient:function(){this.ja=null;},linearGradient:function(pe,ke,Xe,Ue){this.ja={xb:pe,yb:ke,cb:Xe,eb:Ue,Qa:[]};},radialGradient:function(pe,ke,Xe,Ue){this.ja={xb:pe,yb:ke,cb:Xe,eb:Ue,Qa:[],ac:true};},addStop:function(pe,ke){this.ja.Qa.push({color:pe,stop:ke});},completeGradient:function(){},draw:function(pe,ke,Xe,Ue){let it=this.Fb;var Ke=this.Xa,We=this.ja;const st=pe.globalCompositeOperation,Yn=pe.globalAlpha;if(pe.globalCompositeOperation=this.Cb,pe.globalAlpha=Ue,We!=null){Ke=We.xb;const hn=We.yb,It=We.cb;var _t=We.eb;Ue=We.Qa,We.ac?(We=It-Ke,_t-=hn,Ke=pe.createRadialGradient(Ke,hn,0,Ke,hn,Math.sqrt(We*We+_t*_t))):Ke=pe.createLinearGradient(Ke,hn,It,_t);for(let Wo=0,tl=Ue.length;Wo<tl;Wo++)We=Ue[Wo],Ke.addColorStop(We.stop,f(We.color));this.Xa=Ke,this.ja=null;}switch(it){case Ae:pe.strokeStyle=Ke,pe.lineWidth=this.Gb,pe.lineCap=this.Ga,pe.lineJoin=this.Ha,pe.stroke(ke);break;case me:pe.fillStyle=Ke,pe.fill(ke,Xe);}pe.globalCompositeOperation=st,pe.globalAlpha=Yn;}});const qe=new Set;let _e=null,ct=[],Ft=0,fn=0;var to=g.CanvasRenderer=X.extend("Renderer",{__construct:function(pe){this.__parent.__construct.call(this),this.T=[1,0,0,1,0,0],this.G=[1],this.B=pe.getContext("2d"),this.Ua=pe,this.I=[];},save:function(){this.T.push(...this.T.slice(this.T.length-6)),this.G.push(this.G[this.G.length-1]),this.I.push(this.B.save.bind(this.B));},restore:function(){const pe=this.T.length-6;if(6>pe)throw "restore() called without matching save().";this.T.splice(pe),this.G.pop(),this.I.push(this.B.restore.bind(this.B));},transform:function(pe,ke,Xe,Ue,it,Ke){const We=this.T,st=We.length-6;We.splice(st,6,We[st]*pe+We[st+2]*ke,We[st+1]*pe+We[st+3]*ke,We[st]*Xe+We[st+2]*Ue,We[st+1]*Xe+We[st+3]*Ue,We[st]*it+We[st+2]*Ke+We[st+4],We[st+1]*it+We[st+3]*Ke+We[st+5]),this.I.push(this.B.transform.bind(this.B,pe,ke,Xe,Ue,it,Ke));},rotate:function(pe){const ke=Math.sin(pe);pe=Math.cos(pe),this.transform(pe,ke,-ke,pe,0,0);},modulateOpacity:function(pe){this.G[this.G.length-1]*=pe;},_drawPath:function(pe,ke){this.I.push(ke.draw.bind(ke,this.B,pe.U,pe.Va===Ee?"evenodd":"nonzero",Math.max(0,this.G[this.G.length-1])));},_drawRiveImage:function(pe,ke,Xe,Ue){var it=pe.Db;if(it){var Ke=this.B,We=u(Xe),st=Math.max(0,Ue*this.G[this.G.length-1]);this.I.push(function(){Ke.globalCompositeOperation=We,Ke.globalAlpha=st,Ke.drawImage(it,0,0),Ke.globalAlpha=1;});}},_getMatrix:function(pe){const ke=this.T,Xe=ke.length-6;for(let Ue=0;6>Ue;++Ue)pe[Ue]=ke[Xe+Ue];},_drawImageMesh:function(pe,ke,Xe,Ue,it,Ke,We,st,Yn,_t,hn){ke=this.B.canvas.width;var It=this.B.canvas.height;const Wo=_t-st,tl=hn-Yn;st=Math.max(st,0),Yn=Math.max(Yn,0),_t=Math.min(_t,ke),hn=Math.min(hn,It);const Zi=_t-st,ea=hn-Yn;if(console.assert(Zi<=Math.min(Wo,ke)),console.assert(ea<=Math.min(tl,It)),!(0>=Zi||0>=ea)){_t=Zi<Wo||ea<tl,ke=hn=1;var no=Math.ceil(Zi*hn),ro=Math.ceil(ea*ke);It=M.bc(),no>It&&(hn*=It/no,no=It),ro>It&&(ke*=It/ro,ro=It),_e||(_e=new g.DynamicRectanizer(It),_e.reset(512,512)),It=_e.addRect(no,ro),0>It&&(y(),qe.add(this),It=_e.addRect(no,ro),console.assert(0<=It));var qg=It&65535,Xg=It>>16;ct.push({ha:this.T.slice(this.T.length-6),image:pe,Za:qg,$a:Xg,cc:st,dc:Yn,uc:no,jb:ro,Aa:hn,Ba:ke,Ta:new Float32Array(it),Bb:new Float32Array(Ke),indices:new Uint16Array(We),hc:_t,vb:pe.Ja<<1|(_t?1:0)}),Ft+=it.length,fn+=We.length;var Vo=this.B,dS=u(Xe),uS=Math.max(0,Ue*this.G[this.G.length-1]);this.I.push(function(){Vo.save(),Vo.resetTransform(),Vo.globalCompositeOperation=dS,Vo.globalAlpha=uS;const Kg=M.canvas();Kg&&Vo.drawImage(Kg,qg,Xg,no,ro,st,Yn,Zi,ea),Vo.restore();});}},_clipPath:function(pe){this.I.push(this.B.clip.bind(this.B,pe.U,pe.Va===Ee?"evenodd":"nonzero"));},clear:function(){qe.add(this),this.I.push(this.B.clearRect.bind(this.B,0,0,this.Ua.width,this.Ua.height));},flush:function(){},translate:function(pe,ke){this.transform(1,0,0,1,pe,ke);}});g.makeRenderer=function(pe){const ke=new to(pe),Xe=ke.B;return new Proxy(ke,{get(Ue,it){if(typeof Ue[it]=="function")return function(...Ke){return Ue[it].apply(Ue,Ke)};if(typeof Xe[it]=="function"){if(-1<T.indexOf(it))throw Error("RiveException: Method call to '"+it+"()' is not allowed, as the renderer cannot immediately pass through the return                 values of any canvas 2d context methods.");return function(...Ke){ke.I.push(Xe[it].bind(Xe,...Ke));}}return Ue[it]},set(Ue,it,Ke){if(it in Xe)return ke.I.push(()=>{Xe[it]=Ke;}),true}})},g.decodeImage=function(pe,ke){new xe({la:ke}).decode(pe);},g.renderFactory={makeRenderPaint:function(){return new He},makeRenderPath:function(){return new fe},makeRenderImage:function(){let pe=Kn;return new xe({wa:()=>{pe.total++;},la:()=>{if(pe.loaded++,pe.loaded===pe.total){const ke=pe.ready;ke&&(ke(),pe.ready=null);}}})}};let Ze=g.load,Kn=null;g.load=function(pe,ke,Xe=true){const Ue=new g.FallbackFileAssetLoader;return ke!==void 0&&Ue.addLoader(ke),Xe&&(ke=new g.CDNFileAssetLoader,Ue.addLoader(ke)),new Promise(function(it){let Ke=null;Kn={total:0,loaded:0,ready:function(){it(Ke);}},Ke=Ze(pe,Ue),Kn.total==0&&it(Ke);})};let cS=g.RendererWrapper.prototype.align;g.RendererWrapper.prototype.align=function(pe,ke,Xe,Ue,it=1){cS.call(this,pe,ke,Xe,Ue,it);},k=new O,g.requestAnimationFrame=k.requestAnimationFrame.bind(k),g.cancelAnimationFrame=k.cancelAnimationFrame.bind(k),g.enableFPSCounter=k.Ob.bind(k),g.disableFPSCounter=k.Lb,k.ob=y,g.resolveAnimationFrame=y,g.cleanup=function(){_e&&_e.delete();};};var R=Object.assign({},g),z="./this.program",j="",q,U;(E||P)&&(P?j=self.location.href:typeof document<"u"&&document.currentScript&&(j=document.currentScript.src),p&&(j=p),j.startsWith("blob:")?j="":j=j.substr(0,j.replace(/[?#].*/,"").lastIndexOf("/")+1),P&&(U=u=>{var f=new XMLHttpRequest;return f.open("GET",u,false),f.responseType="arraybuffer",f.send(null),new Uint8Array(f.response)}),q=(u,f,y)=>{if(on(u)){var k=new XMLHttpRequest;k.open("GET",u,true),k.responseType="arraybuffer",k.onload=()=>{k.status==200||k.status==0&&k.response?f(k.response):y();},k.onerror=y,k.send(null);}else fetch(u,{credentials:"same-origin"}).then(N=>N.ok?N.arrayBuffer():Promise.reject(Error(N.status+" : "+N.url))).then(f,y);});var ce=g.print||console.log.bind(console),W=g.printErr||console.error.bind(console);Object.assign(g,R),R=null,g.thisProgram&&(z=g.thisProgram);var te;g.wasmBinary&&(te=g.wasmBinary);var ne,ie=false,ee,H,K,D,B,Q,ae,le;function ve(){var u=ne.buffer;g.HEAP8=ee=new Int8Array(u),g.HEAP16=K=new Int16Array(u),g.HEAPU8=H=new Uint8Array(u),g.HEAPU16=D=new Uint16Array(u),g.HEAP32=B=new Int32Array(u),g.HEAPU32=Q=new Uint32Array(u),g.HEAPF32=ae=new Float32Array(u),g.HEAPF64=le=new Float64Array(u);}var Ie=[],Be=[],bt=[];function Qt(){var u=g.preRun.shift();Ie.unshift(u);}var gt=0,Rt=null;function rn(u){throw g.onAbort?.(u),u="Aborted("+u+")",W(u),ie=true,u=new WebAssembly.RuntimeError(u+". Build with -sASSERTIONS for more info."),_(u),u}var jt=u=>u.startsWith("data:application/octet-stream;base64,"),on=u=>u.startsWith("file://"),at;function je(u){if(u==at&&te)return new Uint8Array(te);if(U)return U(u);throw "both async and sync fetching of the wasm failed"}function Ln(u){return te?Promise.resolve().then(()=>je(u)):new Promise((f,y)=>{q(u,k=>f(new Uint8Array(k)),()=>{try{f(je(u));}catch(k){y(k);}});})}function Rn(u,f,y){return Ln(u).then(k=>WebAssembly.instantiate(k,f)).then(y,k=>{W(`failed to asynchronously prepare wasm: ${k}`),rn(k);})}function yt(u,f){var y=at;return te||typeof WebAssembly.instantiateStreaming!="function"||jt(y)||on(y)||typeof fetch!="function"?Rn(y,u,f):fetch(y,{credentials:"same-origin"}).then(k=>WebAssembly.instantiateStreaming(k,u).then(f,function(N){return W(`wasm streaming compile failed: ${N}`),W("falling back to ArrayBuffer instantiation"),Rn(y,u,f)}))}var Tt,an,Wn={490930:(u,f,y,k,N)=>{if(typeof window>"u"||(window.AudioContext||window.webkitAudioContext)===void 0)return 0;if(typeof window.h>"u"){window.h={za:0},window.h.J={},window.h.J.xa=u,window.h.J.capture=f,window.h.J.Ka=y,window.h.ga={},window.h.ga.stopped=k,window.h.ga.wb=N;let $=window.h;$.D=[],$.sc=function(X){for(var Y=0;Y<$.D.length;++Y)if($.D[Y]==null)return $.D[Y]=X,Y;return $.D.push(X),$.D.length-1},$.Ab=function(X){for($.D[X]=null;0<$.D.length&&$.D[$.D.length-1]==null;)$.D.pop();},$.Pc=function(X){for(var Y=0;Y<$.D.length;++Y)if($.D[Y]==X)return $.Ab(Y)},$.qa=function(X){return $.D[X]},$.Sa=["touchend","click"],$.unlock=function(){for(var X=0;X<$.D.length;++X){var Y=$.D[X];Y!=null&&Y.L!=null&&Y.state===$.ga.wb&&Y.L.resume().then(()=>{zg(Y.pb);},se=>{console.error("Failed to resume audiocontext",se);});}$.Sa.map(function(se){document.removeEventListener(se,$.unlock,true);});},$.Sa.map(function(X){document.addEventListener(X,$.unlock,true);});}return window.h.za+=1,1},493108:()=>{typeof window.h<"u"&&(window.h.Sa.map(function(u){document.removeEventListener(u,window.h.unlock,true);}),--window.h.za,window.h.za===0&&delete window.h);},493412:()=>navigator.mediaDevices!==void 0&&navigator.mediaDevices.getUserMedia!==void 0,493516:()=>{try{var u=new(window.AudioContext||window.webkitAudioContext),f=u.sampleRate;return u.close(),f}catch{return 0}},493687:(u,f,y,k,N,$)=>{if(typeof window.h>"u")return  -1;var X={},Y={};return u==window.h.J.xa&&y!=0&&(Y.sampleRate=y),X.L=new(window.AudioContext||window.webkitAudioContext)(Y),X.L.suspend(),X.state=window.h.ga.stopped,y=0,u!=window.h.J.xa&&(y=f),X.Z=X.L.createScriptProcessor(k,y,f),X.Z.onaudioprocess=function(se){if((X.ra==null||X.ra.length==0)&&(X.ra=new Float32Array(ae.buffer,N,k*f)),u==window.h.J.capture||u==window.h.J.Ka){for(var re=0;re<f;re+=1)for(var me=se.inputBuffer.getChannelData(re),Ae=X.ra,Ee=0;Ee<k;Ee+=1)Ae[Ee*f+re]=me[Ee];jg($,k,N);}if(u==window.h.J.xa||u==window.h.J.Ka)for(Gg($,k,N),re=0;re<se.outputBuffer.numberOfChannels;++re)for(me=se.outputBuffer.getChannelData(re),Ae=X.ra,Ee=0;Ee<k;Ee+=1)me[Ee]=Ae[Ee*f+re];else for(re=0;re<se.outputBuffer.numberOfChannels;++re)se.outputBuffer.getChannelData(re).fill(0);},u!=window.h.J.capture&&u!=window.h.J.Ka||navigator.mediaDevices.getUserMedia({audio:true,video:false}).then(function(se){X.Ca=X.L.createMediaStreamSource(se),X.Ca.connect(X.Z),X.Z.connect(X.L.destination);}).catch(function(se){console.log("Failed to get user media: "+se);}),u==window.h.J.xa&&X.Z.connect(X.L.destination),X.pb=$,window.h.sc(X)},496564:u=>window.h.qa(u).L.sampleRate,496637:u=>{u=window.h.qa(u),u.Z!==void 0&&(u.Z.onaudioprocess=function(){},u.Z.disconnect(),u.Z=void 0),u.Ca!==void 0&&(u.Ca.disconnect(),u.Ca=void 0),u.L.close(),u.L=void 0,u.pb=void 0;},497037:u=>{window.h.Ab(u);},497087:u=>{u=window.h.qa(u),u.L.resume(),u.state=window.h.ga.wb;},497226:u=>{u=window.h.qa(u),u.L.suspend(),u.state=window.h.ga.stopped;}},mn=u=>{for(;0<u.length;)u.shift()(g);};function I(){var u=B[+Wi>>2];return Wi+=4,u}var h=(u,f)=>{for(var y=0,k=u.length-1;0<=k;k--){var N=u[k];N==="."?u.splice(k,1):N===".."?(u.splice(k,1),y++):y&&(u.splice(k,1),y--);}if(f)for(;y;y--)u.unshift("..");return u},v=u=>{var f=u.charAt(0)==="/",y=u.substr(-1)==="/";return (u=h(u.split("/").filter(k=>!!k),!f).join("/"))||f||(u="."),u&&y&&(u+="/"),(f?"/":"")+u},L=u=>{var f=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(u).slice(1);return u=f[0],f=f[1],!u&&!f?".":(f&&(f=f.substr(0,f.length-1)),u+f)},G=u=>{if(u==="/")return "/";u=v(u),u=u.replace(/\/$/,"");var f=u.lastIndexOf("/");return f===-1?u:u.substr(f+1)},V=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return u=>crypto.getRandomValues(u);rn("initRandomDevice");},Z=u=>(Z=V())(u),ue=(...u)=>{for(var f="",y=false,k=u.length-1;-1<=k&&!y;k--){if(y=0<=k?u[k]:"/",typeof y!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!y)return "";f=y+"/"+f,y=y.charAt(0)==="/";}return f=h(f.split("/").filter(N=>!!N),!y).join("/"),(y?"/":"")+f||"."},Ce=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,be=(u,f,y)=>{var k=f+y;for(y=f;u[y]&&!(y>=k);)++y;if(16<y-f&&u.buffer&&Ce)return Ce.decode(u.subarray(f,y));for(k="";f<y;){var N=u[f++];if(N&128){var $=u[f++]&63;if((N&224)==192)k+=String.fromCharCode((N&31)<<6|$);else {var X=u[f++]&63;N=(N&240)==224?(N&15)<<12|$<<6|X:(N&7)<<18|$<<12|X<<6|u[f++]&63,65536>N?k+=String.fromCharCode(N):(N-=65536,k+=String.fromCharCode(55296|N>>10,56320|N&1023));}}else k+=String.fromCharCode(N);}return k},Se=[],ot=u=>{for(var f=0,y=0;y<u.length;++y){var k=u.charCodeAt(y);127>=k?f++:2047>=k?f+=2:55296<=k&&57343>=k?(f+=4,++y):f+=3;}return f},pt=(u,f,y,k)=>{if(!(0<k))return 0;var N=y;k=y+k-1;for(var $=0;$<u.length;++$){var X=u.charCodeAt($);if(55296<=X&&57343>=X){var Y=u.charCodeAt(++$);X=65536+((X&1023)<<10)|Y&1023;}if(127>=X){if(y>=k)break;f[y++]=X;}else {if(2047>=X){if(y+1>=k)break;f[y++]=192|X>>6;}else {if(65535>=X){if(y+2>=k)break;f[y++]=224|X>>12;}else {if(y+3>=k)break;f[y++]=240|X>>18,f[y++]=128|X>>12&63;}f[y++]=128|X>>6&63;}f[y++]=128|X&63;}}return f[y]=0,y-N};function Je(u,f){var y=Array(ot(u)+1);return u=pt(u,y,0,y.length),f&&(y.length=u),y}var Ot=[];function Ct(u,f){Ot[u]={input:[],H:[],W:f},Vd(u,dn);}var dn={open(u){var f=Ot[u.node.ya];if(!f)throw new Te(43);u.s=f,u.seekable=false;},close(u){u.s.W.pa(u.s);},pa(u){u.s.W.pa(u.s);},read(u,f,y,k){if(!u.s||!u.s.W.ib)throw new Te(60);for(var N=0,$=0;$<k;$++){try{var X=u.s.W.ib(u.s);}catch{throw new Te(29)}if(X===void 0&&N===0)throw new Te(6);if(X==null)break;N++,f[y+$]=X;}return N&&(u.node.timestamp=Date.now()),N},write(u,f,y,k){if(!u.s||!u.s.W.Na)throw new Te(60);try{for(var N=0;N<k;N++)u.s.W.Na(u.s,f[y+N]);}catch{throw new Te(29)}return k&&(u.node.timestamp=Date.now()),N}},un={ib(){e:{if(!Se.length){var u=null;if(typeof window<"u"&&typeof window.prompt=="function"&&(u=window.prompt("Input: "),u!==null&&(u+=`
`)),!u){u=null;break e}Se=Je(u,true);}u=Se.shift();}return u},Na(u,f){f===null||f===10?(ce(be(u.H,0)),u.H=[]):f!=0&&u.H.push(f);},pa(u){u.H&&0<u.H.length&&(ce(be(u.H,0)),u.H=[]);},Yb(){return {Ac:25856,Cc:5,zc:191,Bc:35387,yc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},Zb(){return 0},$b(){return [24,80]}},bn={Na(u,f){f===null||f===10?(W(be(u.H,0)),u.H=[]):f!=0&&u.H.push(f);},pa(u){u.H&&0<u.H.length&&(W(be(u.H,0)),u.H=[]);}};function dr(u,f){var y=u.l?u.l.length:0;y>=f||(f=Math.max(f,y*(1048576>y?2:1.125)>>>0),y!=0&&(f=Math.max(f,256)),y=u.l,u.l=new Uint8Array(f),0<u.v&&u.l.set(y.subarray(0,u.v),0));}var $e={O:null,V(){return $e.createNode(null,"/",16895,0)},createNode(u,f,y,k){if((y&61440)===24576||(y&61440)===4096)throw new Te(63);return $e.O||($e.O={dir:{node:{Y:$e.j.Y,R:$e.j.R,ka:$e.j.ka,ua:$e.j.ua,tb:$e.j.tb,zb:$e.j.zb,ub:$e.j.ub,sb:$e.j.sb,Da:$e.j.Da},stream:{ba:$e.m.ba}},file:{node:{Y:$e.j.Y,R:$e.j.R},stream:{ba:$e.m.ba,read:$e.m.read,write:$e.m.write,Ya:$e.m.Ya,lb:$e.m.lb,nb:$e.m.nb}},link:{node:{Y:$e.j.Y,R:$e.j.R,ma:$e.j.ma},stream:{}},ab:{node:{Y:$e.j.Y,R:$e.j.R},stream:OC}}),y=fg(u,f,y,k),(y.mode&61440)===16384?(y.j=$e.O.dir.node,y.m=$e.O.dir.stream,y.l={}):(y.mode&61440)===32768?(y.j=$e.O.file.node,y.m=$e.O.file.stream,y.v=0,y.l=null):(y.mode&61440)===40960?(y.j=$e.O.link.node,y.m=$e.O.link.stream):(y.mode&61440)===8192&&(y.j=$e.O.ab.node,y.m=$e.O.ab.stream),y.timestamp=Date.now(),u&&(u.l[f]=y,u.timestamp=y.timestamp),y},Gc(u){return u.l?u.l.subarray?u.l.subarray(0,u.v):new Uint8Array(u.l):new Uint8Array(0)},j:{Y(u){var f={};return f.Ec=(u.mode&61440)===8192?u.id:1,f.Ic=u.id,f.mode=u.mode,f.Lc=1,f.uid=0,f.Hc=0,f.ya=u.ya,(u.mode&61440)===16384?f.size=4096:(u.mode&61440)===32768?f.size=u.v:(u.mode&61440)===40960?f.size=u.link.length:f.size=0,f.wc=new Date(u.timestamp),f.Kc=new Date(u.timestamp),f.Dc=new Date(u.timestamp),f.Hb=4096,f.xc=Math.ceil(f.size/f.Hb),f},R(u,f){if(f.mode!==void 0&&(u.mode=f.mode),f.timestamp!==void 0&&(u.timestamp=f.timestamp),f.size!==void 0&&(f=f.size,u.v!=f))if(f==0)u.l=null,u.v=0;else {var y=u.l;u.l=new Uint8Array(f),y&&u.l.set(y.subarray(0,Math.min(f,u.v))),u.v=f;}},ka(){throw Wd[44]},ua(u,f,y,k){return $e.createNode(u,f,y,k)},tb(u,f,y){if((u.mode&61440)===16384){try{var k=Bs(f,y);}catch{}if(k)for(var N in k.l)throw new Te(55)}delete u.parent.l[u.name],u.parent.timestamp=Date.now(),u.name=y,f.l[y]=u,f.timestamp=u.parent.timestamp;},zb(u,f){delete u.l[f],u.timestamp=Date.now();},ub(u,f){var y=Bs(u,f),k;for(k in y.l)throw new Te(55);delete u.l[f],u.timestamp=Date.now();},sb(u){var f=[".",".."],y;for(y of Object.keys(u.l))f.push(y);return f},Da(u,f,y){return u=$e.createNode(u,f,41471,0),u.link=y,u},ma(u){if((u.mode&61440)!==40960)throw new Te(28);return u.link}},m:{read(u,f,y,k,N){var $=u.node.l;if(N>=u.node.v)return 0;if(u=Math.min(u.node.v-N,k),8<u&&$.subarray)f.set($.subarray(N,N+u),y);else for(k=0;k<u;k++)f[y+k]=$[N+k];return u},write(u,f,y,k,N,$){if(f.buffer===ee.buffer&&($=false),!k)return 0;if(u=u.node,u.timestamp=Date.now(),f.subarray&&(!u.l||u.l.subarray)){if($)return u.l=f.subarray(y,y+k),u.v=k;if(u.v===0&&N===0)return u.l=f.slice(y,y+k),u.v=k;if(N+k<=u.v)return u.l.set(f.subarray(y,y+k),N),k}if(dr(u,N+k),u.l.subarray&&f.subarray)u.l.set(f.subarray(y,y+k),N);else for($=0;$<k;$++)u.l[N+$]=f[y+$];return u.v=Math.max(u.v,N+k),k},ba(u,f,y){if(y===1?f+=u.position:y===2&&(u.node.mode&61440)===32768&&(f+=u.node.v),0>f)throw new Te(28);return f},Ya(u,f,y){dr(u.node,f+y),u.node.v=Math.max(u.node.v,f+y);},lb(u,f,y,k,N){if((u.node.mode&61440)!==32768)throw new Te(43);if(u=u.node.l,N&2||u.buffer!==ee.buffer){if((0<y||y+f<u.length)&&(u.subarray?u=u.subarray(y,y+f):u=Array.prototype.slice.call(u,y,y+f)),y=true,rn(),f=void 0,!f)throw new Te(48);ee.set(u,f);}else y=false,f=u.byteOffset;return {o:f,vc:y}},nb(u,f,y,k){return $e.m.write(u,f,0,k,y,false),0}}},ur=(u,f)=>{var y=0;return u&&(y|=365),f&&(y|=146),y},vn=null,Qe={},yn=[],PC=1,Hi=null,dg=true,Te=class{constructor(u){this.name="ErrnoError",this.aa=u;}},Wd={},MC=class{constructor(){this.h={},this.node=null;}get flags(){return this.h.flags}set flags(u){this.h.flags=u;}get position(){return this.h.position}set position(u){this.h.position=u;}},LC=class{constructor(u,f,y,k){u||(u=this),this.parent=u,this.V=u.V,this.va=null,this.id=PC++,this.name=f,this.mode=y,this.j={},this.m={},this.ya=k;}get read(){return (this.mode&365)===365}set read(u){u?this.mode|=365:this.mode&=-366;}get write(){return (this.mode&146)===146}set write(u){u?this.mode|=146:this.mode&=-147;}};function Qr(u,f={}){if(u=ue(u),!u)return {path:"",node:null};if(f=Object.assign({hb:true,Pa:0},f),8<f.Pa)throw new Te(32);u=u.split("/").filter(X=>!!X);for(var y=vn,k="/",N=0;N<u.length;N++){var $=N===u.length-1;if($&&f.parent)break;if(y=Bs(y,u[N]),k=v(k+"/"+u[N]),y.va&&(!$||$&&f.hb)&&(y=y.va.root),!$||f.gb){for($=0;(y.mode&61440)===40960;)if(y=FC(k),k=ue(L(k),y),y=Qr(k,{Pa:f.Pa+1}).node,40<$++)throw new Te(32)}}return {path:k,node:y}}function ug(u){for(var f;;){if(u===u.parent)return u=u.V.mb,f?u[u.length-1]!=="/"?`${u}/${f}`:u+f:u;f=f?`${u.name}/${f}`:u.name,u=u.parent;}}function pg(u,f){for(var y=0,k=0;k<f.length;k++)y=(y<<5)-y+f.charCodeAt(k)|0;return (u+y>>>0)%Hi.length}function Bs(u,f){var y=(u.mode&61440)===16384?(y=zs(u,"x"))?y:u.j.ka?0:2:54;if(y)throw new Te(y);for(y=Hi[pg(u.id,f)];y;y=y.fc){var k=y.name;if(y.parent.id===u.id&&k===f)return y}return u.j.ka(u,f)}function fg(u,f,y,k){return u=new LC(u,f,y,k),f=pg(u.parent.id,u.name),u.fc=Hi[f],Hi[f]=u}function hg(u){var f=["r","w","rw"][u&3];return u&512&&(f+="w"),f}function zs(u,f){if(dg)return 0;if(!f.includes("r")||u.mode&292){if(f.includes("w")&&!(u.mode&146)||f.includes("x")&&!(u.mode&73))return 2}else return 2;return 0}function gg(u,f){try{return Bs(u,f),20}catch{}return zs(u,"wx")}function Mr(u){if(u=yn[u],!u)throw new Te(8);return u}function mg(u,f=-1){if(u=Object.assign(new MC,u),f==-1)e:{for(f=0;4096>=f;f++)if(!yn[f])break e;throw new Te(33)}return u.X=f,yn[f]=u}function RC(u,f=-1){return u=mg(u,f),u.m?.Fc?.(u),u}var OC={open(u){u.m=Qe[u.node.ya].m,u.m.open?.(u);},ba(){throw new Te(70)}};function Vd(u,f){Qe[u]={m:f};}function bg(u,f){var y=f==="/";if(y&&vn)throw new Te(10);if(!y&&f){var k=Qr(f,{hb:false});if(f=k.path,k=k.node,k.va)throw new Te(10);if((k.mode&61440)!==16384)throw new Te(54)}f={type:u,Nc:{},mb:f,ec:[]},u=u.V(f),u.V=f,f.root=u,y?vn=u:k&&(k.va=f,k.V&&k.V.ec.push(f));}function qd(u,f,y){var k=Qr(u,{parent:true}).node;if(u=G(u),!u||u==="."||u==="..")throw new Te(28);var N=gg(k,u);if(N)throw new Te(N);if(!k.j.ua)throw new Te(63);return k.j.ua(k,u,f,y)}function pr(u){return qd(u,16895,0)}function js(u,f,y){typeof y>"u"&&(y=f,f=438),qd(u,f|8192,y);}function Xd(u,f){if(!ue(u))throw new Te(44);var y=Qr(f,{parent:true}).node;if(!y)throw new Te(44);f=G(f);var k=gg(y,f);if(k)throw new Te(k);if(!y.j.Da)throw new Te(63);y.j.Da(y,f,u);}function FC(u){if(u=Qr(u).node,!u)throw new Te(44);if(!u.j.ma)throw new Te(28);return ue(ug(u.parent),u.j.ma(u))}function Gs(u,f,y){if(u==="")throw new Te(44);if(typeof f=="string"){var k={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[f];if(typeof k>"u")throw Error(`Unknown file open mode: ${f}`);f=k;}if(y=f&64?(typeof y>"u"?438:y)&4095|32768:0,typeof u=="object")var N=u;else {u=v(u);try{N=Qr(u,{gb:!(f&131072)}).node;}catch{}}if(k=false,f&64)if(N){if(f&128)throw new Te(20)}else N=qd(u,y,0),k=true;if(!N)throw new Te(44);if((N.mode&61440)===8192&&(f&=-513),f&65536&&(N.mode&61440)!==16384)throw new Te(54);if(!k&&(y=N?(N.mode&61440)===40960?32:(N.mode&61440)===16384&&(hg(f)!=="r"||f&512)?31:zs(N,hg(f)):44))throw new Te(y);if(f&512&&!k){if(y=N,y=typeof y=="string"?Qr(y,{gb:true}).node:y,!y.j.R)throw new Te(63);if((y.mode&61440)===16384)throw new Te(31);if((y.mode&61440)!==32768)throw new Te(28);if(k=zs(y,"w"))throw new Te(k);y.j.R(y,{size:0,timestamp:Date.now()});}return f&=-131713,N=mg({node:N,path:ug(N),flags:f,seekable:true,position:0,m:N.m,tc:[],error:false}),N.m.open&&N.m.open(N),!g.logReadFiles||f&1||(Kd||(Kd={}),u in Kd||(Kd[u]=1)),N}function vg(u,f,y){if(u.X===null)throw new Te(8);if(!u.seekable||!u.m.ba)throw new Te(70);if(y!=0&&y!=1&&y!=2)throw new Te(28);u.position=u.m.ba(u,f,y),u.tc=[];}var yg;function Ui(u,f,y){u=v("/dev/"+u);var k=ur(!!f,!!y);xg||(xg=64);var N=xg++<<8|0;Vd(N,{open($){$.seekable=false;},close(){y?.buffer?.length&&y(10);},read($,X,Y,se){for(var re=0,me=0;me<se;me++){try{var Ae=f();}catch{throw new Te(29)}if(Ae===void 0&&re===0)throw new Te(6);if(Ae==null)break;re++,X[Y+me]=Ae;}return re&&($.node.timestamp=Date.now()),re},write($,X,Y,se){for(var re=0;re<se;re++)try{y(X[Y+re]);}catch{throw new Te(29)}return se&&($.node.timestamp=Date.now()),re}}),js(u,k,N);}var xg,Zr={},Kd,Wi=void 0,Go=(u,f)=>Object.defineProperty(f,"name",{value:u}),Yd=[],fr=[],Fe,Vn=u=>{if(!u)throw new Fe("Cannot use deleted val. handle = "+u);return fr[u]},qn=u=>{switch(u){case void 0:return 2;case null:return 4;case  true:return 6;case  false:return 8;default:const f=Yd.pop()||fr.length;return fr[f]=u,fr[f+1]=1,f}},wg=u=>{var f=Error,y=Go(u,function(k){this.name=u,this.message=k,k=Error(k).stack,k!==void 0&&(this.stack=this.toString()+`
`+k.replace(/^Error(:[^\n]*)?\n/,""));});return y.prototype=Object.create(f.prototype),y.prototype.constructor=y,y.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},y},Cg,Sg,St=u=>{for(var f="";H[u];)f+=Sg[H[u++]];return f},Vi=[],Jd=()=>{for(;Vi.length;){var u=Vi.pop();u.g.fa=false,u.delete();}},qi,hr={},Qd=(u,f)=>{if(f===void 0)throw new Fe("ptr should not be undefined");for(;u.C;)f=u.na(f),u=u.C;return f},eo={},kg=u=>{u=Bg(u);var f=St(u);return mr(u),f},Xi=(u,f)=>{var y=eo[u];if(y===void 0)throw u=`${f} has unknown type ${kg(u)}`,new Fe(u);return y},Hs=()=>{},Zd=false,_g=(u,f,y)=>f===y?u:y.C===void 0?null:(u=_g(u,f,y.C),u===null?null:y.Mb(u)),Ag={},NC=(u,f)=>(f=Qd(u,f),hr[f]),Ki,Us=(u,f)=>{if(!f.u||!f.o)throw new Ki("makeClassHandle requires ptr and ptrType");if(!!f.K!=!!f.F)throw new Ki("Both smartPtrType and smartPtr must be specified");return f.count={value:1},Ho(Object.create(u,{g:{value:f,writable:true}}))},Ho=u=>typeof FinalizationRegistry>"u"?(Ho=f=>f,u):(Zd=new FinalizationRegistry(f=>{f=f.g,--f.count.value,f.count.value===0&&(f.F?f.K.P(f.F):f.u.i.P(f.o));}),Ho=f=>{var y=f.g;return y.F&&Zd.register(f,{g:y},f),f},Hs=f=>{Zd.unregister(f);},Ho(u)),Ws={},Yi=u=>{for(;u.length;){var f=u.pop();u.pop()(f);}};function Ji(u){return this.fromWireType(Q[u>>2])}var Uo={},Vs={},pn=(u,f,y)=>{function k(Y){if(Y=y(Y),Y.length!==u.length)throw new Ki("Mismatched type converter count");for(var se=0;se<u.length;++se)Xn(u[se],Y[se]);}u.forEach(function(Y){Vs[Y]=f;});var N=Array(f.length),$=[],X=0;f.forEach((Y,se)=>{eo.hasOwnProperty(Y)?N[se]=eo[Y]:($.push(Y),Uo.hasOwnProperty(Y)||(Uo[Y]=[]),Uo[Y].push(()=>{N[se]=eo[Y],++X,X===$.length&&k(N);}));}),$.length===0&&k(N);};function DC(u,f,y={}){var k=f.name;if(!u)throw new Fe(`type "${k}" must have a positive integer typeid pointer`);if(eo.hasOwnProperty(u)){if(y.Wb)return;throw new Fe(`Cannot register type '${k}' twice`)}eo[u]=f,delete Vs[u],Uo.hasOwnProperty(u)&&(f=Uo[u],delete Uo[u],f.forEach(N=>N()));}function Xn(u,f,y={}){if(!("argPackAdvance"in f))throw new TypeError("registerType registeredInstance requires argPackAdvance");return DC(u,f,y)}var eu=u=>{throw new Fe(u.g.u.i.name+" instance already deleted")};function qs(){}var tu=(u,f,y)=>{if(u[f].A===void 0){var k=u[f];u[f]=function(...N){if(!u[f].A.hasOwnProperty(N.length))throw new Fe(`Function '${y}' called with an invalid number of arguments (${N.length}) - expects one of (${u[f].A})!`);return u[f].A[N.length].apply(this,N)},u[f].A=[],u[f].A[k.ea]=k;}},nu=(u,f,y)=>{if(g.hasOwnProperty(u)){if(y===void 0||g[u].A!==void 0&&g[u].A[y]!==void 0)throw new Fe(`Cannot register public name '${u}' twice`);if(tu(g,u,u),g.hasOwnProperty(y))throw new Fe(`Cannot register multiple overloads of a function with the same number of arguments (${y})!`);g[u].A[y]=f;}else g[u]=f,y!==void 0&&(g[u].Mc=y);},$C=u=>{if(u===void 0)return "_unknown";u=u.replace(/[^a-zA-Z0-9_]/g,"$");var f=u.charCodeAt(0);return 48<=f&&57>=f?`_${u}`:u};function BC(u,f,y,k,N,$,X,Y){this.name=u,this.constructor=f,this.N=y,this.P=k,this.C=N,this.Rb=$,this.na=X,this.Mb=Y,this.qb=[];}var Xs=(u,f,y)=>{for(;f!==y;){if(!f.na)throw new Fe(`Expected null or instance of ${y.name}, got an instance of ${f.name}`);u=f.na(u),f=f.C;}return u};function zC(u,f){if(f===null){if(this.Ma)throw new Fe(`null is not a valid ${this.name}`);return 0}if(!f.g)throw new Fe(`Cannot pass "${au(f)}" as a ${this.name}`);if(!f.g.o)throw new Fe(`Cannot pass deleted object as a pointer of type ${this.name}`);return Xs(f.g.o,f.g.u.i,this.i)}function jC(u,f){if(f===null){if(this.Ma)throw new Fe(`null is not a valid ${this.name}`);if(this.ta){var y=this.Oa();return u!==null&&u.push(this.P,y),y}return 0}if(!f||!f.g)throw new Fe(`Cannot pass "${au(f)}" as a ${this.name}`);if(!f.g.o)throw new Fe(`Cannot pass deleted object as a pointer of type ${this.name}`);if(!this.sa&&f.g.u.sa)throw new Fe(`Cannot convert argument of type ${f.g.K?f.g.K.name:f.g.u.name} to parameter type ${this.name}`);if(y=Xs(f.g.o,f.g.u.i,this.i),this.ta){if(f.g.F===void 0)throw new Fe("Passing raw pointer to smart pointer is illegal");switch(this.nc){case 0:if(f.g.K===this)y=f.g.F;else throw new Fe(`Cannot convert argument of type ${f.g.K?f.g.K.name:f.g.u.name} to parameter type ${this.name}`);break;case 1:y=f.g.F;break;case 2:if(f.g.K===this)y=f.g.F;else {var k=f.clone();y=this.jc(y,qn(()=>k.delete())),u!==null&&u.push(this.P,y);}break;default:throw new Fe("Unsupporting sharing policy")}}return y}function GC(u,f){if(f===null){if(this.Ma)throw new Fe(`null is not a valid ${this.name}`);return 0}if(!f.g)throw new Fe(`Cannot pass "${au(f)}" as a ${this.name}`);if(!f.g.o)throw new Fe(`Cannot pass deleted object as a pointer of type ${this.name}`);if(f.g.u.sa)throw new Fe(`Cannot convert argument of type ${f.g.u.name} to parameter type ${this.name}`);return Xs(f.g.o,f.g.u.i,this.i)}function Ks(u,f,y,k,N,$,X,Y,se,re,me){this.name=u,this.i=f,this.Ma=y,this.sa=k,this.ta=N,this.ic=$,this.nc=X,this.rb=Y,this.Oa=se,this.jc=re,this.P=me,N||f.C!==void 0?this.toWireType=jC:(this.toWireType=k?zC:GC,this.M=null);}var Eg=(u,f,y)=>{if(!g.hasOwnProperty(u))throw new Ki("Replacing nonexistent public symbol");g[u].A!==void 0&&y!==void 0?g[u].A[y]=f:(g[u]=f,g[u].ea=y);},Ys=[],Tg,ru=u=>{var f=Ys[u];return f||(u>=Ys.length&&(Ys.length=u+1),Ys[u]=f=Tg.get(u)),f},HC=(u,f,y=[])=>(u.includes("j")?(u=u.replace(/p/g,"i"),f=(0, g["dynCall_"+u])(f,...y)):f=ru(f)(...y),f),UC=(u,f)=>(...y)=>HC(u,f,y),Xt=(u,f)=>{u=St(u);var y=u.includes("j")?UC(u,f):ru(f);if(typeof y!="function")throw new Fe(`unknown function pointer with signature ${u}: ${f}`);return y},Ig,gr=(u,f)=>{function y($){N[$]||eo[$]||(Vs[$]?Vs[$].forEach(y):(k.push($),N[$]=true));}var k=[],N={};throw f.forEach(y),new Ig(`${u}: `+k.map(kg).join([", "]))};function WC(u){for(var f=1;f<u.length;++f)if(u[f]!==null&&u[f].M===void 0)return  true;return  false}function Js(u,f,y,k,N){var $=f.length;if(2>$)throw new Fe("argTypes array size mismatch! Must at least get return value and 'this' types!");var X=f[1]!==null&&y!==null,Y=WC(f),se=f[0].name!=="void",re=$-2,me=Array(re),Ae=[],Ee=[];return Go(u,function(...J){if(J.length!==re)throw new Fe(`function ${u} called with ${J.length} arguments, expected ${re}`);if(Ee.length=0,Ae.length=X?2:1,Ae[0]=N,X){var xe=f[1].toWireType(Ee,this);Ae[1]=xe;}for(var fe=0;fe<re;++fe)me[fe]=f[fe+2].toWireType(Ee,J[fe]),Ae.push(me[fe]);if(J=k(...Ae),Y)Yi(Ee);else for(fe=X?1:2;fe<f.length;fe++){var He=fe===1?xe:me[fe-2];f[fe].M!==null&&f[fe].M(He);}return xe=se?f[0].fromWireType(J):void 0,xe})}var Qs=(u,f)=>{for(var y=[],k=0;k<u;k++)y.push(Q[f+4*k>>2]);return y},ou=u=>{u=u.trim();const f=u.indexOf("(");return f!==-1?u.substr(0,f):u},Pg=(u,f,y)=>{if(!(u instanceof Object))throw new Fe(`${y} with invalid "this": ${u}`);if(!(u instanceof f.i.constructor))throw new Fe(`${y} incompatible with "this" of type ${u.constructor.name}`);if(!u.g.o)throw new Fe(`cannot call emscripten binding method ${y} on deleted object`);return Xs(u.g.o,u.g.u.i,f.i)},iu=u=>{9<u&&--fr[u+1]===0&&(fr[u]=void 0,Yd.push(u));},VC={name:"emscripten::val",fromWireType:u=>{var f=Vn(u);return iu(u),f},toWireType:(u,f)=>qn(f),argPackAdvance:8,readValueFromPointer:Ji,M:null},qC=(u,f,y)=>{switch(f){case 1:return y?function(k){return this.fromWireType(ee[k])}:function(k){return this.fromWireType(H[k])};case 2:return y?function(k){return this.fromWireType(K[k>>1])}:function(k){return this.fromWireType(D[k>>1])};case 4:return y?function(k){return this.fromWireType(B[k>>2])}:function(k){return this.fromWireType(Q[k>>2])};default:throw new TypeError(`invalid integer width (${f}): ${u}`)}},au=u=>{if(u===null)return "null";var f=typeof u;return f==="object"||f==="array"||f==="function"?u.toString():""+u},XC=(u,f)=>{switch(f){case 4:return function(y){return this.fromWireType(ae[y>>2])};case 8:return function(y){return this.fromWireType(le[y>>3])};default:throw new TypeError(`invalid float width (${f}): ${u}`)}},KC=(u,f,y)=>{switch(f){case 1:return y?k=>ee[k]:k=>H[k];case 2:return y?k=>K[k>>1]:k=>D[k>>1];case 4:return y?k=>B[k>>2]:k=>Q[k>>2];default:throw new TypeError(`invalid integer width (${f}): ${u}`)}},Mg=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,YC=(u,f)=>{for(var y=u>>1,k=y+f/2;!(y>=k)&&D[y];)++y;if(y<<=1,32<y-u&&Mg)return Mg.decode(H.subarray(u,y));for(y="",k=0;!(k>=f/2);++k){var N=K[u+2*k>>1];if(N==0)break;y+=String.fromCharCode(N);}return y},JC=(u,f,y)=>{if(y??(y=2147483647),2>y)return 0;y-=2;var k=f;y=y<2*u.length?y/2:u.length;for(var N=0;N<y;++N)K[f>>1]=u.charCodeAt(N),f+=2;return K[f>>1]=0,f-k},QC=u=>2*u.length,ZC=(u,f)=>{for(var y=0,k="";!(y>=f/4);){var N=B[u+4*y>>2];if(N==0)break;++y,65536<=N?(N-=65536,k+=String.fromCharCode(55296|N>>10,56320|N&1023)):k+=String.fromCharCode(N);}return k},eS=(u,f,y)=>{if(y??(y=2147483647),4>y)return 0;var k=f;y=k+y-4;for(var N=0;N<u.length;++N){var $=u.charCodeAt(N);if(55296<=$&&57343>=$){var X=u.charCodeAt(++N);$=65536+(($&1023)<<10)|X&1023;}if(B[f>>2]=$,f+=4,f+4>y)break}return B[f>>2]=0,f-k},tS=u=>{for(var f=0,y=0;y<u.length;++y){var k=u.charCodeAt(y);55296<=k&&57343>=k&&++y,f+=4;}return f},Lg=(u,f,y)=>{var k=[];return u=u.toWireType(k,y),k.length&&(Q[f>>2]=qn(k)),u},nS={},su=u=>{var f=nS[u];return f===void 0?St(u):f},lu=[],rS=u=>{var f=lu.length;return lu.push(u),f},oS=(u,f)=>{for(var y=Array(u),k=0;k<u;++k)y[k]=Xi(Q[f+4*k>>2],"parameter "+k);return y},iS=Reflect.construct,Qi=u=>u%4===0&&(u%100!==0||u%400===0),aS=[0,31,60,91,121,152,182,213,244,274,305,335],sS=[0,31,59,90,120,151,181,212,243,273,304,334],cu=[],du={},Rg=()=>{if(!uu){var u={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:z||"./this.program"},f;for(f in du)du[f]===void 0?delete u[f]:u[f]=du[f];var y=[];for(f in u)y.push(`${f}=${u[f]}`);uu=y;}return uu},uu,Og=[31,29,31,30,31,30,31,31,30,31,30,31],Fg=[31,28,31,30,31,30,31,31,30,31,30,31],Ng=(u,f,y,k)=>{function N(J,xe,fe){for(J=typeof J=="number"?J.toString():J||"";J.length<xe;)J=fe[0]+J;return J}function $(J,xe){return N(J,xe,"0")}function X(J,xe){function fe(qe){return 0>qe?-1:0<qe?1:0}var He;return (He=fe(J.getFullYear()-xe.getFullYear()))===0&&(He=fe(J.getMonth()-xe.getMonth()))===0&&(He=fe(J.getDate()-xe.getDate())),He}function Y(J){switch(J.getDay()){case 0:return new Date(J.getFullYear()-1,11,29);case 1:return J;case 2:return new Date(J.getFullYear(),0,3);case 3:return new Date(J.getFullYear(),0,2);case 4:return new Date(J.getFullYear(),0,1);case 5:return new Date(J.getFullYear()-1,11,31);case 6:return new Date(J.getFullYear()-1,11,30)}}function se(J){var xe=J.ca;for(J=new Date(new Date(J.da+1900,0,1).getTime());0<xe;){var fe=J.getMonth(),He=(Qi(J.getFullYear())?Og:Fg)[fe];if(xe>He-J.getDate())xe-=He-J.getDate()+1,J.setDate(1),11>fe?J.setMonth(fe+1):(J.setMonth(0),J.setFullYear(J.getFullYear()+1));else {J.setDate(J.getDate()+xe);break}}return fe=new Date(J.getFullYear()+1,0,4),xe=Y(new Date(J.getFullYear(),0,4)),fe=Y(fe),0>=X(xe,J)?0>=X(fe,J)?J.getFullYear()+1:J.getFullYear():J.getFullYear()-1}var re=Q[k+40>>2];k={qc:B[k>>2],pc:B[k+4>>2],Ea:B[k+8>>2],Ra:B[k+12>>2],Fa:B[k+16>>2],da:B[k+20>>2],S:B[k+24>>2],ca:B[k+28>>2],Oc:B[k+32>>2],oc:B[k+36>>2],rc:re&&re?be(H,re):""},y=y?be(H,y):"",re={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var me in re)y=y.replace(new RegExp(me,"g"),re[me]);var Ae="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),Ee="January February March April May June July August September October November December".split(" ");re={"%a":J=>Ae[J.S].substring(0,3),"%A":J=>Ae[J.S],"%b":J=>Ee[J.Fa].substring(0,3),"%B":J=>Ee[J.Fa],"%C":J=>$((J.da+1900)/100|0,2),"%d":J=>$(J.Ra,2),"%e":J=>N(J.Ra,2," "),"%g":J=>se(J).toString().substring(2),"%G":se,"%H":J=>$(J.Ea,2),"%I":J=>(J=J.Ea,J==0?J=12:12<J&&(J-=12),$(J,2)),"%j":J=>{for(var xe=0,fe=0;fe<=J.Fa-1;xe+=(Qi(J.da+1900)?Og:Fg)[fe++]);return $(J.Ra+xe,3)},"%m":J=>$(J.Fa+1,2),"%M":J=>$(J.pc,2),"%n":()=>`
`,"%p":J=>0<=J.Ea&&12>J.Ea?"AM":"PM","%S":J=>$(J.qc,2),"%t":()=>"	","%u":J=>J.S||7,"%U":J=>$(Math.floor((J.ca+7-J.S)/7),2),"%V":J=>{var xe=Math.floor((J.ca+7-(J.S+6)%7)/7);if(2>=(J.S+371-J.ca-2)%7&&xe++,xe)xe==53&&(fe=(J.S+371-J.ca)%7,fe==4||fe==3&&Qi(J.da)||(xe=1));else {xe=52;var fe=(J.S+7-J.ca-1)%7;(fe==4||fe==5&&Qi(J.da%400-1))&&xe++;}return $(xe,2)},"%w":J=>J.S,"%W":J=>$(Math.floor((J.ca+7-(J.S+6)%7)/7),2),"%y":J=>(J.da+1900).toString().substring(2),"%Y":J=>J.da+1900,"%z":J=>{J=J.oc;var xe=0<=J;return J=Math.abs(J)/60,(xe?"+":"-")+("0000"+(J/60*100+J%60)).slice(-4)},"%Z":J=>J.rc,"%%":()=>"%"},y=y.replace(/%%/g,"\0\0");for(me in re)y.includes(me)&&(y=y.replace(new RegExp(me,"g"),re[me](k)));return y=y.replace(/\0\0/g,"%"),me=Je(y,false),me.length>f?0:(ee.set(me,u),me.length-1)};[44].forEach(u=>{Wd[u]=new Te(u),Wd[u].stack="<generic error, no stack>";}),Hi=Array(4096),bg($e,"/"),pr("/tmp"),pr("/home"),pr("/home/web_user"),(function(){pr("/dev"),Vd(259,{read:()=>0,write:(k,N,$,X)=>X}),js("/dev/null",259),Ct(1280,un),Ct(1536,bn),js("/dev/tty",1280),js("/dev/tty1",1536);var u=new Uint8Array(1024),f=0,y=()=>(f===0&&(f=Z(u).byteLength),u[--f]);Ui("random",y),Ui("urandom",y),pr("/dev/shm"),pr("/dev/shm/tmp");})(),(function(){pr("/proc");var u=pr("/proc/self");pr("/proc/self/fd"),bg({V(){var f=fg(u,"fd",16895,73);return f.j={ka(y,k){var N=Mr(+k);return y={parent:null,V:{mb:"fake"},j:{ma:()=>N.path}},y.parent=y}},f}},"/proc/self/fd");})(),Fe=g.BindingError=class extends Error{constructor(u){super(u),this.name="BindingError";}},fr.push(0,1,void 0,1,null,1,true,1,false,1),g.count_emval_handles=()=>fr.length/2-5-Yd.length,Cg=g.PureVirtualError=wg("PureVirtualError");for(var Dg=Array(256),Zs=0;256>Zs;++Zs)Dg[Zs]=String.fromCharCode(Zs);Sg=Dg,g.getInheritedInstanceCount=()=>Object.keys(hr).length,g.getLiveInheritedInstances=()=>{var u=[],f;for(f in hr)hr.hasOwnProperty(f)&&u.push(hr[f]);return u},g.flushPendingDeletes=Jd,g.setDelayFunction=u=>{qi=u,Vi.length&&qi&&qi(Jd);},Ki=g.InternalError=class extends Error{constructor(u){super(u),this.name="InternalError";}},Object.assign(qs.prototype,{isAliasOf:function(u){if(!(this instanceof qs&&u instanceof qs))return  false;var f=this.g.u.i,y=this.g.o;u.g=u.g;var k=u.g.u.i;for(u=u.g.o;f.C;)y=f.na(y),f=f.C;for(;k.C;)u=k.na(u),k=k.C;return f===k&&y===u},clone:function(){if(this.g.o||eu(this),this.g.ia)return this.g.count.value+=1,this;var u=Ho,f=Object,y=f.create,k=Object.getPrototypeOf(this),N=this.g;return u=u(y.call(f,k,{g:{value:{count:N.count,fa:N.fa,ia:N.ia,o:N.o,u:N.u,F:N.F,K:N.K}}})),u.g.count.value+=1,u.g.fa=false,u},delete(){if(this.g.o||eu(this),this.g.fa&&!this.g.ia)throw new Fe("Object already scheduled for deletion");Hs(this);var u=this.g;--u.count.value,u.count.value===0&&(u.F?u.K.P(u.F):u.u.i.P(u.o)),this.g.ia||(this.g.F=void 0,this.g.o=void 0);},isDeleted:function(){return !this.g.o},deleteLater:function(){if(this.g.o||eu(this),this.g.fa&&!this.g.ia)throw new Fe("Object already scheduled for deletion");return Vi.push(this),Vi.length===1&&qi&&qi(Jd),this.g.fa=true,this}}),Object.assign(Ks.prototype,{Sb(u){return this.rb&&(u=this.rb(u)),u},bb(u){this.P?.(u);},argPackAdvance:8,readValueFromPointer:Ji,fromWireType:function(u){function f(){return this.ta?Us(this.i.N,{u:this.ic,o:y,K:this,F:u}):Us(this.i.N,{u:this,o:u})}var y=this.Sb(u);if(!y)return this.bb(u),null;var k=NC(this.i,y);if(k!==void 0)return k.g.count.value===0?(k.g.o=y,k.g.F=u,k.clone()):(k=k.clone(),this.bb(u),k);if(k=this.i.Rb(y),k=Ag[k],!k)return f.call(this);k=this.sa?k.Ib:k.pointerType;var N=_g(y,this.i,k.i);return N===null?f.call(this):this.ta?Us(k.i.N,{u:k,o:N,K:this,F:u}):Us(k.i.N,{u:k,o:N})}}),Ig=g.UnboundTypeError=wg("UnboundTypeError");var $g={__syscall_fcntl64:function(u,f,y){Wi=y;try{var k=Mr(u);switch(f){case 0:var N=I();if(0>N)break;for(;yn[N];)N++;return RC(k,N).X;case 1:case 2:return 0;case 3:return k.flags;case 4:return N=I(),k.flags|=N,0;case 12:return N=I(),K[N+0>>1]=2,0;case 13:case 14:return 0}return -28}catch($){if(typeof Zr>"u"||$.name!=="ErrnoError")throw $;return -$.aa}},__syscall_ioctl:function(u,f,y){Wi=y;try{var k=Mr(u);switch(f){case 21509:return k.s?0:-59;case 21505:if(!k.s)return -59;if(k.s.W.Yb){u=[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var N=I();B[N>>2]=25856,B[N+4>>2]=5,B[N+8>>2]=191,B[N+12>>2]=35387;for(var $=0;32>$;$++)ee[N+$+17]=u[$]||0;}return 0;case 21510:case 21511:case 21512:return k.s?0:-59;case 21506:case 21507:case 21508:if(!k.s)return -59;if(k.s.W.Zb)for(N=I(),u=[],$=0;32>$;$++)u.push(ee[N+$+17]);return 0;case 21519:return k.s?(N=I(),B[N>>2]=0):-59;case 21520:return k.s?-28:-59;case 21531:if(N=I(),!k.m.Xb)throw new Te(59);return k.m.Xb(k,f,N);case 21523:return k.s?(k.s.W.$b&&($=[24,80],N=I(),K[N>>1]=$[0],K[N+2>>1]=$[1]),0):-59;case 21524:return k.s?0:-59;case 21515:return k.s?0:-59;default:return -28}}catch(X){if(typeof Zr>"u"||X.name!=="ErrnoError")throw X;return -X.aa}},__syscall_openat:function(u,f,y,k){Wi=k;try{f=f?be(H,f):"";var N=f;if(N.charAt(0)==="/")f=N;else {var $=u===-100?"/":Mr(u).path;if(N.length==0)throw new Te(44);f=v($+"/"+N);}var X=k?I():0;return Gs(f,y,X).X}catch(Y){if(typeof Zr>"u"||Y.name!=="ErrnoError")throw Y;return -Y.aa}},_abort_js:()=>{rn("");},_embind_create_inheriting_constructor:(u,f,y)=>{u=St(u),f=Xi(f,"wrapper"),y=Vn(y);var k=f.i,N=k.N,$=k.C.N,X=k.C.constructor;return u=Go(u,function(...Y){k.C.qb.forEach(function(se){if(this[se]===$[se])throw new Cg(`Pure virtual function ${se} must be implemented in JavaScript`)}.bind(this)),Object.defineProperty(this,"__parent",{value:N}),this.__construct(...Y);}),N.__construct=function(...Y){if(this===N)throw new Fe("Pass correct 'this' to __construct");Y=X.implement(this,...Y),Hs(Y);var se=Y.g;if(Y.notifyOnDestruction(),se.ia=true,Object.defineProperties(this,{g:{value:se}}),Ho(this),Y=se.o,Y=Qd(k,Y),hr.hasOwnProperty(Y))throw new Fe(`Tried to register registered instance: ${Y}`);hr[Y]=this;},N.__destruct=function(){if(this===N)throw new Fe("Pass correct 'this' to __destruct");Hs(this);var Y=this.g.o;if(Y=Qd(k,Y),hr.hasOwnProperty(Y))delete hr[Y];else throw new Fe(`Tried to unregister unregistered instance: ${Y}`)},u.prototype=Object.create(N),Object.assign(u.prototype,y),qn(u)},_embind_finalize_value_object:u=>{var f=Ws[u];delete Ws[u];var y=f.Oa,k=f.P,N=f.fb,$=N.map(X=>X.Vb).concat(N.map(X=>X.lc));pn([u],$,X=>{var Y={};return N.forEach((se,re)=>{var me=X[re],Ae=se.Tb,Ee=se.Ub,J=X[re+N.length],xe=se.kc,fe=se.mc;Y[se.Pb]={read:He=>me.fromWireType(Ae(Ee,He)),write:(He,qe)=>{var _e=[];xe(fe,He,J.toWireType(_e,qe)),Yi(_e);}};}),[{name:f.name,fromWireType:se=>{var re={},me;for(me in Y)re[me]=Y[me].read(se);return k(se),re},toWireType:(se,re)=>{for(var me in Y)if(!(me in re))throw new TypeError(`Missing field: "${me}"`);var Ae=y();for(me in Y)Y[me].write(Ae,re[me]);return se!==null&&se.push(k,Ae),Ae},argPackAdvance:8,readValueFromPointer:Ji,M:k}]});},_embind_register_bigint:()=>{},_embind_register_bool:(u,f,y,k)=>{f=St(f),Xn(u,{name:f,fromWireType:function(N){return !!N},toWireType:function(N,$){return $?y:k},argPackAdvance:8,readValueFromPointer:function(N){return this.fromWireType(H[N])},M:null});},_embind_register_class:(u,f,y,k,N,$,X,Y,se,re,me,Ae,Ee)=>{me=St(me),$=Xt(N,$),Y&&(Y=Xt(X,Y)),re&&(re=Xt(se,re)),Ee=Xt(Ae,Ee);var J=$C(me);nu(J,function(){gr(`Cannot construct ${me} due to unbound types`,[k]);}),pn([u,f,y],k?[k]:[],xe=>{if(xe=xe[0],k)var fe=xe.i,He=fe.N;else He=qs.prototype;xe=Go(me,function(...Ft){if(Object.getPrototypeOf(this)!==qe)throw new Fe("Use 'new' to construct "+me);if(_e.$===void 0)throw new Fe(me+" has no accessible constructor");var fn=_e.$[Ft.length];if(fn===void 0)throw new Fe(`Tried to invoke ctor of ${me} with invalid number of parameters (${Ft.length}) - expected (${Object.keys(_e.$).toString()}) parameters instead!`);return fn.apply(this,Ft)});var qe=Object.create(He,{constructor:{value:xe}});xe.prototype=qe;var _e=new BC(me,xe,qe,Ee,fe,$,Y,re);if(_e.C){var ct;(ct=_e.C).oa??(ct.oa=[]),_e.C.oa.push(_e);}return fe=new Ks(me,_e,true,false,false),ct=new Ks(me+"*",_e,false,false,false),He=new Ks(me+" const*",_e,false,true,false),Ag[u]={pointerType:ct,Ib:He},Eg(J,xe),[fe,ct,He]});},_embind_register_class_class_function:(u,f,y,k,N,$,X)=>{var Y=Qs(y,k);f=St(f),f=ou(f),$=Xt(N,$),pn([],[u],se=>{function re(){gr(`Cannot call ${me} due to unbound types`,Y);}se=se[0];var me=`${se.name}.${f}`;f.startsWith("@@")&&(f=Symbol[f.substring(2)]);var Ae=se.i.constructor;return Ae[f]===void 0?(re.ea=y-1,Ae[f]=re):(tu(Ae,f,me),Ae[f].A[y-1]=re),pn([],Y,Ee=>{if(Ee=Js(me,[Ee[0],null].concat(Ee.slice(1)),null,$,X),Ae[f].A===void 0?(Ee.ea=y-1,Ae[f]=Ee):Ae[f].A[y-1]=Ee,se.i.oa)for(const J of se.i.oa)J.constructor.hasOwnProperty(f)||(J.constructor[f]=Ee);return []}),[]});},_embind_register_class_class_property:(u,f,y,k,N,$,X,Y)=>{f=St(f),$=Xt(N,$),pn([],[u],se=>{se=se[0];var re=`${se.name}.${f}`,me={get(){gr(`Cannot access ${re} due to unbound types`,[y]);},enumerable:true,configurable:true};return me.set=Y?()=>{gr(`Cannot access ${re} due to unbound types`,[y]);}:()=>{throw new Fe(`${re} is a read-only property`)},Object.defineProperty(se.i.constructor,f,me),pn([],[y],Ae=>{Ae=Ae[0];var Ee={get(){return Ae.fromWireType($(k))},enumerable:true};return Y&&(Y=Xt(X,Y),Ee.set=J=>{var xe=[];Y(k,Ae.toWireType(xe,J)),Yi(xe);}),Object.defineProperty(se.i.constructor,f,Ee),[]}),[]});},_embind_register_class_constructor:(u,f,y,k,N,$)=>{var X=Qs(f,y);N=Xt(k,N),pn([],[u],Y=>{Y=Y[0];var se=`constructor ${Y.name}`;if(Y.i.$===void 0&&(Y.i.$=[]),Y.i.$[f-1]!==void 0)throw new Fe(`Cannot register multiple constructors with identical number of parameters (${f-1}) for class '${Y.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return Y.i.$[f-1]=()=>{gr(`Cannot construct ${Y.name} due to unbound types`,X);},pn([],X,re=>(re.splice(1,0,null),Y.i.$[f-1]=Js(se,re,null,N,$),[])),[]});},_embind_register_class_function:(u,f,y,k,N,$,X,Y)=>{var se=Qs(y,k);f=St(f),f=ou(f),$=Xt(N,$),pn([],[u],re=>{function me(){gr(`Cannot call ${Ae} due to unbound types`,se);}re=re[0];var Ae=`${re.name}.${f}`;f.startsWith("@@")&&(f=Symbol[f.substring(2)]),Y&&re.i.qb.push(f);var Ee=re.i.N,J=Ee[f];return J===void 0||J.A===void 0&&J.className!==re.name&&J.ea===y-2?(me.ea=y-2,me.className=re.name,Ee[f]=me):(tu(Ee,f,Ae),Ee[f].A[y-2]=me),pn([],se,xe=>(xe=Js(Ae,xe,re,$,X),Ee[f].A===void 0?(xe.ea=y-2,Ee[f]=xe):Ee[f].A[y-2]=xe,[])),[]});},_embind_register_class_property:(u,f,y,k,N,$,X,Y,se,re)=>{f=St(f),N=Xt(k,N),pn([],[u],me=>{me=me[0];var Ae=`${me.name}.${f}`,Ee={get(){gr(`Cannot access ${Ae} due to unbound types`,[y,X]);},enumerable:true,configurable:true};return Ee.set=se?()=>gr(`Cannot access ${Ae} due to unbound types`,[y,X]):()=>{throw new Fe(Ae+" is a read-only property")},Object.defineProperty(me.i.N,f,Ee),pn([],se?[y,X]:[y],J=>{var xe=J[0],fe={get(){var qe=Pg(this,me,Ae+" getter");return xe.fromWireType(N($,qe))},enumerable:true};if(se){se=Xt(Y,se);var He=J[1];fe.set=function(qe){var _e=Pg(this,me,Ae+" setter"),ct=[];se(re,_e,He.toWireType(ct,qe)),Yi(ct);};}return Object.defineProperty(me.i.N,f,fe),[]}),[]});},_embind_register_emval:u=>Xn(u,VC),_embind_register_enum:(u,f,y,k)=>{function N(){}f=St(f),N.values={},Xn(u,{name:f,constructor:N,fromWireType:function($){return this.constructor.values[$]},toWireType:($,X)=>X.value,argPackAdvance:8,readValueFromPointer:qC(f,y,k),M:null}),nu(f,N);},_embind_register_enum_value:(u,f,y)=>{var k=Xi(u,"enum");f=St(f),u=k.constructor,k=Object.create(k.constructor.prototype,{value:{value:y},constructor:{value:Go(`${k.name}_${f}`,function(){})}}),u.values[y]=k,u[f]=k;},_embind_register_float:(u,f,y)=>{f=St(f),Xn(u,{name:f,fromWireType:k=>k,toWireType:(k,N)=>N,argPackAdvance:8,readValueFromPointer:XC(f,y),M:null});},_embind_register_function:(u,f,y,k,N,$)=>{var X=Qs(f,y);u=St(u),u=ou(u),N=Xt(k,N),nu(u,function(){gr(`Cannot call ${u} due to unbound types`,X);},f-1),pn([],X,Y=>(Eg(u,Js(u,[Y[0],null].concat(Y.slice(1)),null,N,$),f-1),[]));},_embind_register_integer:(u,f,y,k,N)=>{if(f=St(f),N===-1&&(N=4294967295),N=Y=>Y,k===0){var $=32-8*y;N=Y=>Y<<$>>>$;}var X=f.includes("unsigned")?function(Y,se){return se>>>0}:function(Y,se){return se};Xn(u,{name:f,fromWireType:N,toWireType:X,argPackAdvance:8,readValueFromPointer:KC(f,y,k!==0),M:null});},_embind_register_memory_view:(u,f,y)=>{function k($){return new N(ee.buffer,Q[$+4>>2],Q[$>>2])}var N=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][f];y=St(y),Xn(u,{name:y,fromWireType:k,argPackAdvance:8,readValueFromPointer:k},{Wb:true});},_embind_register_std_string:(u,f)=>{f=St(f);var y=f==="std::string";Xn(u,{name:f,fromWireType:function(k){var N=Q[k>>2],$=k+4;if(y)for(var X=$,Y=0;Y<=N;++Y){var se=$+Y;if(Y==N||H[se]==0){if(X=X?be(H,X,se-X):"",re===void 0)var re=X;else re+="\0",re+=X;X=se+1;}}else {for(re=Array(N),Y=0;Y<N;++Y)re[Y]=String.fromCharCode(H[$+Y]);re=re.join("");}return mr(k),re},toWireType:function(k,N){N instanceof ArrayBuffer&&(N=new Uint8Array(N));var $=typeof N=="string";if(!($||N instanceof Uint8Array||N instanceof Uint8ClampedArray||N instanceof Int8Array))throw new Fe("Cannot pass non-string to std::string");var X=y&&$?ot(N):N.length,Y=pu(4+X+1),se=Y+4;if(Q[Y>>2]=X,y&&$)pt(N,H,se,X+1);else if($)for($=0;$<X;++$){var re=N.charCodeAt($);if(255<re)throw mr(se),new Fe("String has UTF-16 code units that do not fit in 8 bits");H[se+$]=re;}else for($=0;$<X;++$)H[se+$]=N[$];return k!==null&&k.push(mr,Y),Y},argPackAdvance:8,readValueFromPointer:Ji,M(k){mr(k);}});},_embind_register_std_wstring:(u,f,y)=>{if(y=St(y),f===2)var k=YC,N=JC,$=QC,X=Y=>D[Y>>1];else f===4&&(k=ZC,N=eS,$=tS,X=Y=>Q[Y>>2]);Xn(u,{name:y,fromWireType:Y=>{for(var se=Q[Y>>2],re,me=Y+4,Ae=0;Ae<=se;++Ae){var Ee=Y+4+Ae*f;(Ae==se||X(Ee)==0)&&(me=k(me,Ee-me),re===void 0?re=me:(re+="\0",re+=me),me=Ee+f);}return mr(Y),re},toWireType:(Y,se)=>{if(typeof se!="string")throw new Fe(`Cannot pass non-string to C++ string type ${y}`);var re=$(se),me=pu(4+re+f);return Q[me>>2]=re/f,N(se,me+4,re+f),Y!==null&&Y.push(mr,me),me},argPackAdvance:8,readValueFromPointer:Ji,M(Y){mr(Y);}});},_embind_register_value_object:(u,f,y,k,N,$)=>{Ws[u]={name:St(f),Oa:Xt(y,k),P:Xt(N,$),fb:[]};},_embind_register_value_object_field:(u,f,y,k,N,$,X,Y,se,re)=>{Ws[u].fb.push({Pb:St(f),Vb:y,Tb:Xt(k,N),Ub:$,lc:X,kc:Xt(Y,se),mc:re});},_embind_register_void:(u,f)=>{f=St(f),Xn(u,{Jc:true,name:f,argPackAdvance:0,fromWireType:()=>{},toWireType:()=>{}});},_emscripten_get_now_is_monotonic:()=>1,_emscripten_memcpy_js:(u,f,y)=>H.copyWithin(u,f,f+y),_emscripten_throw_longjmp:()=>{throw 1/0},_emval_as:(u,f,y)=>(u=Vn(u),f=Xi(f,"emval::as"),Lg(f,y,u)),_emval_call_method:(u,f,y,k,N)=>(u=lu[u],f=Vn(f),y=su(y),u(f,f[y],k,N)),_emval_decref:iu,_emval_get_method_caller:(u,f,y)=>{var k=oS(u,f),N=k.shift();u--;var $=Array(u);return f=`methodCaller<(${k.map(X=>X.name).join(", ")}) => ${N.name}>`,rS(Go(f,(X,Y,se,re)=>{for(var me=0,Ae=0;Ae<u;++Ae)$[Ae]=k[Ae].readValueFromPointer(re+me),me+=k[Ae].argPackAdvance;return X=y===1?iS(Y,$):Y.apply(X,$),Lg(N,se,X)}))},_emval_get_module_property:u=>(u=su(u),qn(g[u])),_emval_get_property:(u,f)=>(u=Vn(u),f=Vn(f),qn(u[f])),_emval_incref:u=>{9<u&&(fr[u+1]+=1);},_emval_new_array:()=>qn([]),_emval_new_cstring:u=>qn(su(u)),_emval_new_object:()=>qn({}),_emval_run_destructors:u=>{var f=Vn(u);Yi(f),iu(u);},_emval_set_property:(u,f,y)=>{u=Vn(u),f=Vn(f),y=Vn(y),u[f]=y;},_emval_take_value:(u,f)=>(u=Xi(u,"_emval_take_value"),u=u.readValueFromPointer(f),qn(u)),_gmtime_js:function(u,f,y){u=new Date(1e3*(f+2097152>>>0<4194305-!!u?(u>>>0)+4294967296*f:NaN)),B[y>>2]=u.getUTCSeconds(),B[y+4>>2]=u.getUTCMinutes(),B[y+8>>2]=u.getUTCHours(),B[y+12>>2]=u.getUTCDate(),B[y+16>>2]=u.getUTCMonth(),B[y+20>>2]=u.getUTCFullYear()-1900,B[y+24>>2]=u.getUTCDay(),B[y+28>>2]=(u.getTime()-Date.UTC(u.getUTCFullYear(),0,1,0,0,0,0))/864e5|0;},_localtime_js:function(u,f,y){u=new Date(1e3*(f+2097152>>>0<4194305-!!u?(u>>>0)+4294967296*f:NaN)),B[y>>2]=u.getSeconds(),B[y+4>>2]=u.getMinutes(),B[y+8>>2]=u.getHours(),B[y+12>>2]=u.getDate(),B[y+16>>2]=u.getMonth(),B[y+20>>2]=u.getFullYear()-1900,B[y+24>>2]=u.getDay(),B[y+28>>2]=(Qi(u.getFullYear())?aS:sS)[u.getMonth()]+u.getDate()-1|0,B[y+36>>2]=-(60*u.getTimezoneOffset()),f=new Date(u.getFullYear(),6,1).getTimezoneOffset();var k=new Date(u.getFullYear(),0,1).getTimezoneOffset();B[y+32>>2]=(f!=k&&u.getTimezoneOffset()==Math.min(k,f))|0;},_tzset_js:(u,f,y,k)=>{var N=new Date().getFullYear(),$=new Date(N,0,1),X=new Date(N,6,1);N=$.getTimezoneOffset();var Y=X.getTimezoneOffset();Q[u>>2]=60*Math.max(N,Y),B[f>>2]=+(N!=Y),u=se=>se.toLocaleTimeString(void 0,{hour12:false,timeZoneName:"short"}).split(" ")[1],$=u($),X=u(X),Y<N?(pt($,H,y,17),pt(X,H,k,17)):(pt($,H,k,17),pt(X,H,y,17));},emscripten_asm_const_int:(u,f,y)=>{cu.length=0;for(var k;k=H[f++];){var N=k!=105;N&=k!=112,y+=N&&y%8?4:0,cu.push(k==112?Q[y>>2]:k==105?B[y>>2]:le[y>>3]),y+=N?8:4;}return Wn[u](...cu)},emscripten_date_now:()=>Date.now(),emscripten_get_now:()=>performance.now(),emscripten_resize_heap:u=>{var f=H.length;if(u>>>=0,2147483648<u)return  false;for(var y=1;4>=y;y*=2){var k=f*(1+.2/y);k=Math.min(k,u+100663296);var N=Math;k=Math.max(u,k);e:{N=(N.min.call(N,2147483648,k+(65536-k%65536)%65536)-ne.buffer.byteLength+65535)/65536;try{ne.grow(N),ve();var $=1;break e}catch{}$=void 0;}if($)return  true}return  false},environ_get:(u,f)=>{var y=0;return Rg().forEach((k,N)=>{var $=f+y;for(N=Q[u+4*N>>2]=$,$=0;$<k.length;++$)ee[N++]=k.charCodeAt($);ee[N]=0,y+=k.length+1;}),0},environ_sizes_get:(u,f)=>{var y=Rg();Q[u>>2]=y.length;var k=0;return y.forEach(N=>k+=N.length+1),Q[f>>2]=k,0},fd_close:function(u){try{var f=Mr(u);if(f.X===null)throw new Te(8);f.La&&(f.La=null);try{f.m.close&&f.m.close(f);}catch(y){throw y}finally{yn[f.X]=null;}return f.X=null,0}catch(y){if(typeof Zr>"u"||y.name!=="ErrnoError")throw y;return y.aa}},fd_read:function(u,f,y,k){try{e:{var N=Mr(u);u=f;for(var $,X=f=0;X<y;X++){var Y=Q[u>>2],se=Q[u+4>>2];u+=8;var re=N,me=$,Ae=ee;if(0>se||0>me)throw new Te(28);if(re.X===null)throw new Te(8);if((re.flags&2097155)===1)throw new Te(8);if((re.node.mode&61440)===16384)throw new Te(31);if(!re.m.read)throw new Te(28);var Ee=typeof me<"u";if(!Ee)me=re.position;else if(!re.seekable)throw new Te(70);var J=re.m.read(re,Ae,Y,se,me);Ee||(re.position+=J);var xe=J;if(0>xe){var fe=-1;break e}if(f+=xe,xe<se)break;typeof $<"u"&&($+=xe);}fe=f;}return Q[k>>2]=fe,0}catch(He){if(typeof Zr>"u"||He.name!=="ErrnoError")throw He;return He.aa}},fd_seek:function(u,f,y,k,N){f=y+2097152>>>0<4194305-!!f?(f>>>0)+4294967296*y:NaN;try{if(isNaN(f))return 61;var $=Mr(u);return vg($,f,k),an=[$.position>>>0,(Tt=$.position,1<=+Math.abs(Tt)?0<Tt?+Math.floor(Tt/4294967296)>>>0:~~+Math.ceil((Tt-+(~~Tt>>>0))/4294967296)>>>0:0)],B[N>>2]=an[0],B[N+4>>2]=an[1],$.La&&f===0&&k===0&&($.La=null),0}catch(X){if(typeof Zr>"u"||X.name!=="ErrnoError")throw X;return X.aa}},fd_write:function(u,f,y,k){try{e:{var N=Mr(u);u=f;for(var $,X=f=0;X<y;X++){var Y=Q[u>>2],se=Q[u+4>>2];u+=8;var re=N,me=Y,Ae=se,Ee=$,J=ee;if(0>Ae||0>Ee)throw new Te(28);if(re.X===null)throw new Te(8);if((re.flags&2097155)===0)throw new Te(8);if((re.node.mode&61440)===16384)throw new Te(31);if(!re.m.write)throw new Te(28);re.seekable&&re.flags&1024&&vg(re,0,2);var xe=typeof Ee<"u";if(!xe)Ee=re.position;else if(!re.seekable)throw new Te(70);var fe=re.m.write(re,J,me,Ae,Ee,void 0);xe||(re.position+=fe);var He=fe;if(0>He){var qe=-1;break e}f+=He,typeof $<"u"&&($+=He);}qe=f;}return Q[k>>2]=qe,0}catch(_e){if(typeof Zr>"u"||_e.name!=="ErrnoError")throw _e;return _e.aa}},invoke_vii:lS,isWindowsBrowser:function(){return  -1<navigator.platform.indexOf("Win")},strftime:Ng,strftime_l:(u,f,y,k)=>Ng(u,f,y,k)},ht=(function(){function u(y){return ht=y.exports,ne=ht.memory,ve(),Tg=ht.__indirect_function_table,Be.unshift(ht.__wasm_call_ctors),gt--,g.monitorRunDependencies?.(gt),gt==0&&Rt&&(y=Rt,Rt=null,y()),ht}var f={env:$g,wasi_snapshot_preview1:$g};if(gt++,g.monitorRunDependencies?.(gt),g.instantiateWasm)try{return g.instantiateWasm(f,u)}catch(y){W(`Module.instantiateWasm callback failed with error: ${y}`),_(y);}return at||(at=jt("canvas_advanced.wasm")?"canvas_advanced.wasm":g.locateFile?g.locateFile("canvas_advanced.wasm",j):j+"canvas_advanced.wasm"),yt(f,function(y){u(y.instance);}).catch(_),{}})(),mr=u=>(mr=ht.free)(u),pu=u=>(pu=ht.malloc)(u),Bg=u=>(Bg=ht.__getTypeName)(u),zg=g._ma_device__on_notification_unlocked=u=>(zg=g._ma_device__on_notification_unlocked=ht.ma_device__on_notification_unlocked)(u);g._ma_malloc_emscripten=(u,f)=>(g._ma_malloc_emscripten=ht.ma_malloc_emscripten)(u,f),g._ma_free_emscripten=(u,f)=>(g._ma_free_emscripten=ht.ma_free_emscripten)(u,f);var jg=g._ma_device_process_pcm_frames_capture__webaudio=(u,f,y)=>(jg=g._ma_device_process_pcm_frames_capture__webaudio=ht.ma_device_process_pcm_frames_capture__webaudio)(u,f,y),Gg=g._ma_device_process_pcm_frames_playback__webaudio=(u,f,y)=>(Gg=g._ma_device_process_pcm_frames_playback__webaudio=ht.ma_device_process_pcm_frames_playback__webaudio)(u,f,y),Hg=(u,f)=>(Hg=ht.setThrew)(u,f),Ug=u=>(Ug=ht._emscripten_stack_restore)(u),Wg=()=>(Wg=ht.emscripten_stack_get_current)();g.dynCall_iiji=(u,f,y,k,N)=>(g.dynCall_iiji=ht.dynCall_iiji)(u,f,y,k,N),g.dynCall_jiji=(u,f,y,k,N)=>(g.dynCall_jiji=ht.dynCall_jiji)(u,f,y,k,N),g.dynCall_iiiji=(u,f,y,k,N,$)=>(g.dynCall_iiiji=ht.dynCall_iiiji)(u,f,y,k,N,$),g.dynCall_iij=(u,f,y,k)=>(g.dynCall_iij=ht.dynCall_iij)(u,f,y,k),g.dynCall_jii=(u,f,y)=>(g.dynCall_jii=ht.dynCall_jii)(u,f,y),g.dynCall_viijii=(u,f,y,k,N,$,X)=>(g.dynCall_viijii=ht.dynCall_viijii)(u,f,y,k,N,$,X),g.dynCall_iiiiij=(u,f,y,k,N,$,X)=>(g.dynCall_iiiiij=ht.dynCall_iiiiij)(u,f,y,k,N,$,X),g.dynCall_iiiiijj=(u,f,y,k,N,$,X,Y,se)=>(g.dynCall_iiiiijj=ht.dynCall_iiiiijj)(u,f,y,k,N,$,X,Y,se),g.dynCall_iiiiiijj=(u,f,y,k,N,$,X,Y,se,re)=>(g.dynCall_iiiiiijj=ht.dynCall_iiiiiijj)(u,f,y,k,N,$,X,Y,se,re);function lS(u,f,y){var k=Wg();try{ru(u)(f,y);}catch(N){if(Ug(k),N!==N+0)throw N;Hg(1,0);}}var el;Rt=function u(){el||Vg(),el||(Rt=u);};function Vg(){function u(){if(!el&&(el=true,g.calledRun=true,!ie)){if(g.noFSInit||yg||(yg=true,g.stdin=g.stdin,g.stdout=g.stdout,g.stderr=g.stderr,g.stdin?Ui("stdin",g.stdin):Xd("/dev/tty","/dev/stdin"),g.stdout?Ui("stdout",null,g.stdout):Xd("/dev/tty","/dev/stdout"),g.stderr?Ui("stderr",null,g.stderr):Xd("/dev/tty1","/dev/stderr"),Gs("/dev/stdin",0),Gs("/dev/stdout",1),Gs("/dev/stderr",1)),dg=false,mn(Be),w(g),g.onRuntimeInitialized&&g.onRuntimeInitialized(),g.postRun)for(typeof g.postRun=="function"&&(g.postRun=[g.postRun]);g.postRun.length;){var f=g.postRun.shift();bt.unshift(f);}mn(bt);}}if(!(0<gt)){if(g.preRun)for(typeof g.preRun=="function"&&(g.preRun=[g.preRun]);g.preRun.length;)Qt();mn(Ie),0<gt||(g.setStatus?(g.setStatus("Running..."),setTimeout(function(){setTimeout(function(){g.setStatus("");},1),u();},1)):u());}}if(g.preInit)for(typeof g.preInit=="function"&&(g.preInit=[g.preInit]);0<g.preInit.length;)g.preInit.pop()();return Vg(),b=C,b})})();const c=d;}),(a=>{a.exports=JSON.parse(`{"name":"@rive-app/canvas","version":"2.34.3","description":"Rive's canvas based web api.","main":"rive.js","homepage":"https://rive.app","repository":{"type":"git","url":"https://github.com/rive-app/rive-wasm/tree/master/js"},"keywords":["rive","animation"],"author":"Rive","contributors":["Luigi Rosso <luigi@rive.app> (https://rive.app)","Maxwell Talbot <max@rive.app> (https://rive.app)","Arthur Vivian <arthur@rive.app> (https://rive.app)","Umberto Sonnino <umberto@rive.app> (https://rive.app)","Matthew Sullivan <matt.j.sullivan@gmail.com> (mailto:matt.j.sullivan@gmail.com)"],"license":"MIT","files":["rive.js","rive.js.map","rive.wasm","rive_fallback.wasm","rive.d.ts","rive_advanced.mjs.d.ts"],"typings":"rive.d.ts","dependencies":{},"browser":{"fs":false,"path":false}}`);}),((a,s,l)=>{l.r(s),l.d(s,{Animation:()=>d.Animation});var d=l(4);}),((a,s,l)=>{l.r(s),l.d(s,{Animation:()=>d});var d=(function(){function c(p,m,b,g){this.animation=p,this.artboard=m,this.playing=g,this.loopCount=0,this.scrubTo=null,this.instance=new b.LinearAnimationInstance(p,m);}return Object.defineProperty(c.prototype,"name",{get:function(){return this.animation.name},enumerable:false,configurable:true}),Object.defineProperty(c.prototype,"time",{get:function(){return this.instance.time},set:function(p){this.instance.time=p;},enumerable:false,configurable:true}),Object.defineProperty(c.prototype,"loopValue",{get:function(){return this.animation.loopValue},enumerable:false,configurable:true}),Object.defineProperty(c.prototype,"needsScrub",{get:function(){return this.scrubTo!==null},enumerable:false,configurable:true}),c.prototype.advance=function(p){this.scrubTo===null?this.instance.advance(p):(this.instance.time=0,this.instance.advance(this.scrubTo),this.scrubTo=null);},c.prototype.apply=function(p){this.instance.apply(p);},c.prototype.cleanup=function(){this.instance.delete();},c})();}),((a,s,l)=>{l.r(s),l.d(s,{AudioAssetWrapper:()=>p.AudioAssetWrapper,AudioWrapper:()=>p.AudioWrapper,BLANK_URL:()=>c.BLANK_URL,CustomFileAssetLoaderWrapper:()=>p.CustomFileAssetLoaderWrapper,FileAssetWrapper:()=>p.FileAssetWrapper,FileFinalizer:()=>p.FileFinalizer,FontAssetWrapper:()=>p.FontAssetWrapper,FontWrapper:()=>p.FontWrapper,ImageAssetWrapper:()=>p.ImageAssetWrapper,ImageWrapper:()=>p.ImageWrapper,createFinalization:()=>p.createFinalization,finalizationRegistry:()=>p.finalizationRegistry,registerTouchInteractions:()=>d.registerTouchInteractions,sanitizeUrl:()=>c.sanitizeUrl});var d=l(6),c=l(7),p=l(8);}),((a,s,l)=>{l.r(s),l.d(s,{registerTouchInteractions:()=>p});var d=void 0,c=function(m,b,g){var w,_,C=[];if(["touchstart","touchmove"].indexOf(m.type)>-1&&(!((w=m.changedTouches)===null||w===void 0)&&w.length)){b||m.preventDefault();for(var E=0,P=g?m.changedTouches.length:1;E<P;){var O=m.changedTouches[E];C.push({clientX:O.clientX,clientY:O.clientY,identifier:O.identifier}),E++;}}else if(m.type==="touchend"&&(!((_=m.changedTouches)===null||_===void 0)&&_.length))for(var E=0,P=g?m.changedTouches.length:1;E<P;){var O=m.changedTouches[E];C.push({clientX:O.clientX,clientY:O.clientY,identifier:O.identifier}),E++;}else C.push({clientX:m.clientX,clientY:m.clientY,identifier:0});return C},p=function(m){var b=m.canvas,g=m.artboard,w=m.stateMachines,_=w===void 0?[]:w,C=m.renderer,E=m.rive,P=m.fit,O=m.alignment,F=m.isTouchScrollEnabled,A=F===void 0?false:F,T=m.dispatchPointerExit,M=T===void 0?true:T,S=m.enableMultiTouch,R=S===void 0?false:S,z=m.layoutScaleFactor,j=z===void 0?1:z;if(!b||!_.length||!C||!E||!g||typeof window>"u")return null;var q=null,U=false,ce=function(te){if(U&&te instanceof MouseEvent){te.type=="mouseup"&&(U=false);return}U=A&&te.type==="touchend"&&q==="touchstart",q=te.type;var ne=te.currentTarget.getBoundingClientRect(),ie=c(te,A,R),ee=E.computeAlignment(P,O,{minX:0,minY:0,maxX:ne.width,maxY:ne.height},g.bounds,j),H=new E.Mat2D;switch(ee.invert(H),ie.forEach(function(at){var je=at.clientX,Ln=at.clientY;if(!(!je&&!Ln)){var Rn=je-ne.left,yt=Ln-ne.top,Tt=new E.Vec2D(Rn,yt),an=E.mapXY(H,Tt),Wn=an.x(),mn=an.y();at.transformedX=Wn,at.transformedY=mn,an.delete(),Tt.delete();}}),H.delete(),ee.delete(),te.type){case "mouseout":for(var K=function(at){M?ie.forEach(function(je){at.pointerExit(je.transformedX,je.transformedY,je.identifier);}):ie.forEach(function(je){at.pointerMove(je.transformedX,je.transformedY,je.identifier);});},D=0,B=_;D<B.length;D++){var Q=B[D];K(Q);}break;case "touchmove":case "mouseover":case "mousemove":{for(var ae=function(at){ie.forEach(function(je){at.pointerMove(je.transformedX,je.transformedY,je.identifier);});},le=0,ve=_;le<ve.length;le++){var Q=ve[le];ae(Q);}break}case "touchstart":case "mousedown":{for(var Ie=function(at){ie.forEach(function(je){at.pointerDown(je.transformedX,je.transformedY,je.identifier);});},Be=0,bt=_;Be<bt.length;Be++){var Q=bt[Be];Ie(Q);}break}case "touchend":{for(var Qt=function(at){ie.forEach(function(je){at.pointerUp(je.transformedX,je.transformedY,je.identifier),at.pointerExit(je.transformedX,je.transformedY,je.identifier);});},gt=0,Rt=_;gt<Rt.length;gt++){var Q=Rt[gt];Qt(Q);}break}case "mouseup":{for(var rn=function(at){ie.forEach(function(je){at.pointerUp(je.transformedX,je.transformedY,je.identifier);});},jt=0,on=_;jt<on.length;jt++){var Q=on[jt];rn(Q);}break}}},W=ce.bind(d);return b.addEventListener("mouseover",W),b.addEventListener("mouseout",W),b.addEventListener("mousemove",W),b.addEventListener("mousedown",W),b.addEventListener("mouseup",W),b.addEventListener("touchmove",W,{passive:A}),b.addEventListener("touchstart",W,{passive:A}),b.addEventListener("touchend",W),function(){b.removeEventListener("mouseover",W),b.removeEventListener("mouseout",W),b.removeEventListener("mousemove",W),b.removeEventListener("mousedown",W),b.removeEventListener("mouseup",W),b.removeEventListener("touchmove",W),b.removeEventListener("touchstart",W),b.removeEventListener("touchend",W);}};}),((a,s,l)=>{l.r(s),l.d(s,{BLANK_URL:()=>w,sanitizeUrl:()=>E});var d=/^([^\w]*)(javascript|data|vbscript)/im,c=/&#(\w+)(^\w|;)?/g,p=/&(newline|tab);/gi,m=/[\u0000-\u001F\u007F-\u009F\u2000-\u200D\uFEFF]/gim,b=/^.+(:|&colon;)/gim,g=[".","/"],w="about:blank";function _(P){return g.indexOf(P[0])>-1}function C(P){var O=P.replace(m,"");return O.replace(c,function(F,A){return String.fromCharCode(A)})}function E(P){if(!P)return w;var O=C(P).replace(p,"").replace(m,"").trim();if(!O)return w;if(_(O))return O;var F=O.match(b);if(!F)return O;var A=F[0];return d.test(A)?w:O}}),((a,s,l)=>{l.r(s),l.d(s,{AudioAssetWrapper:()=>P,AudioWrapper:()=>g,CustomFileAssetLoaderWrapper:()=>_,FileAssetWrapper:()=>C,FileFinalizer:()=>c,FontAssetWrapper:()=>O,FontWrapper:()=>w,ImageAssetWrapper:()=>E,ImageWrapper:()=>b,createFinalization:()=>M,finalizationRegistry:()=>T});var d=(function(){var S=function(R,z){return S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(j,q){j.__proto__=q;}||function(j,q){for(var U in q)Object.prototype.hasOwnProperty.call(q,U)&&(j[U]=q[U]);},S(R,z)};return function(R,z){if(typeof z!="function"&&z!==null)throw new TypeError("Class extends value "+String(z)+" is not a constructor or null");S(R,z);function j(){this.constructor=R;}R.prototype=z===null?Object.create(z):(j.prototype=z.prototype,new j);}})(),c=(function(){function S(R){this.selfUnref=false,this._file=R;}return S.prototype.unref=function(){this._file&&this._file.unref();},S})(),p=(function(){function S(R){this._finalizableObject=R;}return S.prototype.unref=function(){this._finalizableObject.unref();},S})(),m=(function(){function S(){this.selfUnref=false;}return S.prototype.unref=function(){},S})(),b=(function(S){d(R,S);function R(z){var j=S.call(this)||this;return j._nativeImage=z,j}return Object.defineProperty(R.prototype,"nativeImage",{get:function(){return this._nativeImage},enumerable:false,configurable:true}),R.prototype.unref=function(){this.selfUnref&&this._nativeImage.unref();},R})(m),g=(function(S){d(R,S);function R(z){var j=S.call(this)||this;return j._nativeAudio=z,j}return Object.defineProperty(R.prototype,"nativeAudio",{get:function(){return this._nativeAudio},enumerable:false,configurable:true}),R.prototype.unref=function(){this.selfUnref&&this._nativeAudio.unref();},R})(m),w=(function(S){d(R,S);function R(z){var j=S.call(this)||this;return j._nativeFont=z,j}return Object.defineProperty(R.prototype,"nativeFont",{get:function(){return this._nativeFont},enumerable:false,configurable:true}),R.prototype.unref=function(){this.selfUnref&&this._nativeFont.unref();},R})(m),_=(function(){function S(R,z){this._assetLoaderCallback=z,this.assetLoader=new R.CustomFileAssetLoader({loadContents:this.loadContents.bind(this)});}return S.prototype.loadContents=function(R,z){var j;return R.isImage?j=new E(R):R.isAudio?j=new P(R):R.isFont&&(j=new O(R)),this._assetLoaderCallback(j,z)},S})(),C=(function(){function S(R){this._nativeFileAsset=R;}return S.prototype.decode=function(R){this._nativeFileAsset.decode(R);},Object.defineProperty(S.prototype,"name",{get:function(){return this._nativeFileAsset.name},enumerable:false,configurable:true}),Object.defineProperty(S.prototype,"fileExtension",{get:function(){return this._nativeFileAsset.fileExtension},enumerable:false,configurable:true}),Object.defineProperty(S.prototype,"uniqueFilename",{get:function(){return this._nativeFileAsset.uniqueFilename},enumerable:false,configurable:true}),Object.defineProperty(S.prototype,"isAudio",{get:function(){return this._nativeFileAsset.isAudio},enumerable:false,configurable:true}),Object.defineProperty(S.prototype,"isImage",{get:function(){return this._nativeFileAsset.isImage},enumerable:false,configurable:true}),Object.defineProperty(S.prototype,"isFont",{get:function(){return this._nativeFileAsset.isFont},enumerable:false,configurable:true}),Object.defineProperty(S.prototype,"cdnUuid",{get:function(){return this._nativeFileAsset.cdnUuid},enumerable:false,configurable:true}),Object.defineProperty(S.prototype,"nativeFileAsset",{get:function(){return this._nativeFileAsset},enumerable:false,configurable:true}),S})(),E=(function(S){d(R,S);function R(){return S!==null&&S.apply(this,arguments)||this}return R.prototype.setRenderImage=function(z){this._nativeFileAsset.setRenderImage(z.nativeImage);},R})(C),P=(function(S){d(R,S);function R(){return S!==null&&S.apply(this,arguments)||this}return R.prototype.setAudioSource=function(z){this._nativeFileAsset.setAudioSource(z.nativeAudio);},R})(C),O=(function(S){d(R,S);function R(){return S!==null&&S.apply(this,arguments)||this}return R.prototype.setFont=function(z){this._nativeFileAsset.setFont(z.nativeFont);},R})(C),F=(function(){function S(R){}return S.prototype.register=function(R){R.selfUnref=true;},S.prototype.unregister=function(R){},S})(),A=typeof FinalizationRegistry<"u"?FinalizationRegistry:F,T=new A(function(S){S?.unref();}),M=function(S,R){var z=new p(R);T.register(S,z);};})],r={};function o(a){var s=r[a];if(s!==void 0)return s.exports;var l=r[a]={exports:{}};return n[a](l,l.exports,o),l.exports}o.d=(a,s)=>{for(var l in s)o.o(s,l)&&!o.o(a,l)&&Object.defineProperty(a,l,{enumerable:true,get:s[l]});},o.o=(a,s)=>Object.prototype.hasOwnProperty.call(a,s),o.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:true});};var i={};return (()=>{o.r(i),o.d(i,{Alignment:()=>E,DataEnum:()=>ve,DrawOptimizationOptions:()=>P,EventType:()=>U,Fit:()=>C,Layout:()=>O,LoopType:()=>ce,Rive:()=>ae,RiveEventType:()=>M,RiveFile:()=>Q,RuntimeLoader:()=>F,StateMachineInput:()=>T,StateMachineInputType:()=>A,Testing:()=>Tt,ViewModel:()=>le,ViewModelInstance:()=>Be,ViewModelInstanceArtboard:()=>Ln,ViewModelInstanceAssetImage:()=>je,ViewModelInstanceBoolean:()=>Rt,ViewModelInstanceColor:()=>at,ViewModelInstanceEnum:()=>jt,ViewModelInstanceList:()=>on,ViewModelInstanceNumber:()=>gt,ViewModelInstanceString:()=>Qt,ViewModelInstanceTrigger:()=>rn,ViewModelInstanceValue:()=>bt,decodeAudio:()=>an,decodeFont:()=>mn,decodeImage:()=>Wn});var a=o(1),s=o(2),l=o(3),d=o(5),c=(function(){var I=function(h,v){return I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,G){L.__proto__=G;}||function(L,G){for(var V in G)Object.prototype.hasOwnProperty.call(G,V)&&(L[V]=G[V]);},I(h,v)};return function(h,v){if(typeof v!="function"&&v!==null)throw new TypeError("Class extends value "+String(v)+" is not a constructor or null");I(h,v);function L(){this.constructor=h;}h.prototype=v===null?Object.create(v):(L.prototype=v.prototype,new L);}})(),p=function(){return p=Object.assign||function(I){for(var h,v=1,L=arguments.length;v<L;v++){h=arguments[v];for(var G in h)Object.prototype.hasOwnProperty.call(h,G)&&(I[G]=h[G]);}return I},p.apply(this,arguments)},m=function(I,h,v,L){function G(V){return V instanceof v?V:new v(function(Z){Z(V);})}return new(v||(v=Promise))(function(V,Z){function ue(Se){try{be(L.next(Se));}catch(ot){Z(ot);}}function Ce(Se){try{be(L.throw(Se));}catch(ot){Z(ot);}}function be(Se){Se.done?V(Se.value):G(Se.value).then(ue,Ce);}be((L=L.apply(I,[])).next());})},b=function(I,h){var v={label:0,sent:function(){if(V[0]&1)throw V[1];return V[1]},trys:[],ops:[]},L,G,V,Z=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return Z.next=ue(0),Z.throw=ue(1),Z.return=ue(2),typeof Symbol=="function"&&(Z[Symbol.iterator]=function(){return this}),Z;function ue(be){return function(Se){return Ce([be,Se])}}function Ce(be){if(L)throw new TypeError("Generator is already executing.");for(;Z&&(Z=0,be[0]&&(v=0)),v;)try{if(L=1,G&&(V=be[0]&2?G.return:be[0]?G.throw||((V=G.return)&&V.call(G),0):G.next)&&!(V=V.call(G,be[1])).done)return V;switch(G=0,V&&(be=[be[0]&2,V.value]),be[0]){case 0:case 1:V=be;break;case 4:return v.label++,{value:be[1],done:!1};case 5:v.label++,G=be[1],be=[0];continue;case 7:be=v.ops.pop(),v.trys.pop();continue;default:if(V=v.trys,!(V=V.length>0&&V[V.length-1])&&(be[0]===6||be[0]===2)){v=0;continue}if(be[0]===3&&(!V||be[1]>V[0]&&be[1]<V[3])){v.label=be[1];break}if(be[0]===6&&v.label<V[1]){v.label=V[1],V=be;break}if(V&&v.label<V[2]){v.label=V[2],v.ops.push(be);break}V[2]&&v.ops.pop(),v.trys.pop();continue}be=h.call(I,v);}catch(Se){be=[6,Se],G=0;}finally{L=V=0;}if(be[0]&5)throw be[1];return {value:be[0]?be[1]:void 0,done:true}}},g=function(I,h,v){for(var L=0,G=h.length,V;L<G;L++)(V||!(L in h))&&(V||(V=Array.prototype.slice.call(h,0,L)),V[L]=h[L]);return I.concat(V||Array.prototype.slice.call(h))},w=(function(I){c(h,I);function h(){var v=I!==null&&I.apply(this,arguments)||this;return v.isHandledError=true,v}return h})(Error),_=function(I){return I&&I.isHandledError?I.message:"Problem loading file; may be corrupt!"},C;(function(I){I.Cover="cover",I.Contain="contain",I.Fill="fill",I.FitWidth="fitWidth",I.FitHeight="fitHeight",I.None="none",I.ScaleDown="scaleDown",I.Layout="layout";})(C||(C={}));var E;(function(I){I.Center="center",I.TopLeft="topLeft",I.TopCenter="topCenter",I.TopRight="topRight",I.CenterLeft="centerLeft",I.CenterRight="centerRight",I.BottomLeft="bottomLeft",I.BottomCenter="bottomCenter",I.BottomRight="bottomRight";})(E||(E={}));var P;(function(I){I.AlwaysDraw="alwaysDraw",I.DrawOnChanged="drawOnChanged";})(P||(P={}));var O=(function(){function I(h){var v,L,G,V,Z,ue,Ce;this.fit=(v=h?.fit)!==null&&v!==void 0?v:C.Contain,this.alignment=(L=h?.alignment)!==null&&L!==void 0?L:E.Center,this.layoutScaleFactor=(G=h?.layoutScaleFactor)!==null&&G!==void 0?G:1,this.minX=(V=h?.minX)!==null&&V!==void 0?V:0,this.minY=(Z=h?.minY)!==null&&Z!==void 0?Z:0,this.maxX=(ue=h?.maxX)!==null&&ue!==void 0?ue:0,this.maxY=(Ce=h?.maxY)!==null&&Ce!==void 0?Ce:0;}return I.new=function(h){var v=h.fit,L=h.alignment,G=h.minX,V=h.minY,Z=h.maxX,ue=h.maxY;return console.warn("This function is deprecated: please use `new Layout({})` instead"),new I({fit:v,alignment:L,minX:G,minY:V,maxX:Z,maxY:ue})},I.prototype.copyWith=function(h){var v=h.fit,L=h.alignment,G=h.layoutScaleFactor,V=h.minX,Z=h.minY,ue=h.maxX,Ce=h.maxY;return new I({fit:v??this.fit,alignment:L??this.alignment,layoutScaleFactor:G??this.layoutScaleFactor,minX:V??this.minX,minY:Z??this.minY,maxX:ue??this.maxX,maxY:Ce??this.maxY})},I.prototype.runtimeFit=function(h){if(this.cachedRuntimeFit)return this.cachedRuntimeFit;var v;return this.fit===C.Cover?v=h.Fit.cover:this.fit===C.Contain?v=h.Fit.contain:this.fit===C.Fill?v=h.Fit.fill:this.fit===C.FitWidth?v=h.Fit.fitWidth:this.fit===C.FitHeight?v=h.Fit.fitHeight:this.fit===C.ScaleDown?v=h.Fit.scaleDown:this.fit===C.Layout?v=h.Fit.layout:v=h.Fit.none,this.cachedRuntimeFit=v,v},I.prototype.runtimeAlignment=function(h){if(this.cachedRuntimeAlignment)return this.cachedRuntimeAlignment;var v;return this.alignment===E.TopLeft?v=h.Alignment.topLeft:this.alignment===E.TopCenter?v=h.Alignment.topCenter:this.alignment===E.TopRight?v=h.Alignment.topRight:this.alignment===E.CenterLeft?v=h.Alignment.centerLeft:this.alignment===E.CenterRight?v=h.Alignment.centerRight:this.alignment===E.BottomLeft?v=h.Alignment.bottomLeft:this.alignment===E.BottomCenter?v=h.Alignment.bottomCenter:this.alignment===E.BottomRight?v=h.Alignment.bottomRight:v=h.Alignment.center,this.cachedRuntimeAlignment=v,v},I})(),F=(function(){function I(){}return I.loadRuntime=function(){a.default({locateFile:function(){return I.wasmURL}}).then(function(h){var v;for(I.runtime=h;I.callBackQueue.length>0;)(v=I.callBackQueue.shift())===null||v===void 0||v(I.runtime);}).catch(function(h){var v={message:h?.message||"Unknown error",type:h?.name||"Error",wasmError:h instanceof WebAssembly.CompileError||h instanceof WebAssembly.RuntimeError,originalError:h};console.debug("Rive WASM load error details:",v);var L="https://cdn.jsdelivr.net/npm/".concat(s.name,"@").concat(s.version,"/rive_fallback.wasm");if(I.wasmURL.toLowerCase()!==L)console.warn("Failed to load WASM from ".concat(I.wasmURL," (").concat(v.message,"), trying jsdelivr as a backup")),I.setWasmUrl(L),I.loadRuntime();else {var G=["Could not load Rive WASM file from ".concat(I.wasmURL," or ").concat(L,"."),"Possible reasons:","- Network connection is down","- WebAssembly is not supported in this environment","- The WASM file is corrupted or incompatible",`
Error details:`,"- Type: ".concat(v.type),"- Message: ".concat(v.message),"- WebAssembly-specific error: ".concat(v.wasmError),`
To resolve, you may need to:`,"1. Check your network connection","2. Set a new WASM source via RuntimeLoader.setWasmUrl()","3. Call RuntimeLoader.loadRuntime() again"].join(`
`);console.error(G);}});},I.getInstance=function(h){I.isLoading||(I.isLoading=true,I.loadRuntime()),I.runtime?h(I.runtime):I.callBackQueue.push(h);},I.awaitInstance=function(){return new Promise(function(h){return I.getInstance(function(v){return h(v)})})},I.setWasmUrl=function(h){I.wasmURL=h;},I.getWasmUrl=function(){return I.wasmURL},I.isLoading=false,I.callBackQueue=[],I.wasmURL="https://unpkg.com/".concat(s.name,"@").concat(s.version,"/rive.wasm"),I})(),A;(function(I){I[I.Number=56]="Number",I[I.Trigger=58]="Trigger",I[I.Boolean=59]="Boolean";})(A||(A={}));var T=(function(){function I(h,v){this.type=h,this.runtimeInput=v;}return Object.defineProperty(I.prototype,"name",{get:function(){return this.runtimeInput.name},enumerable:false,configurable:true}),Object.defineProperty(I.prototype,"value",{get:function(){return this.runtimeInput.value},set:function(h){this.runtimeInput.value=h;},enumerable:false,configurable:true}),I.prototype.fire=function(){this.type===A.Trigger&&this.runtimeInput.fire();},I.prototype.delete=function(){this.runtimeInput=null;},I})(),M;(function(I){I[I.General=128]="General",I[I.OpenUrl=131]="OpenUrl";})(M||(M={}));var S=(function(){function I(h){this.isBindableArtboard=false,this.isBindableArtboard=h;}return I})(),R=(function(I){c(h,I);function h(v,L){var G=I.call(this,false)||this;return G.nativeArtboard=v,G.file=L,G}return h})(S),z=(function(I){c(h,I);function h(v){var L=I.call(this,true)||this;return L.selfUnref=false,L.nativeArtboard=v,L}return Object.defineProperty(h.prototype,"viewModel",{set:function(v){this.nativeViewModel=v.nativeInstance;},enumerable:false,configurable:true}),h.prototype.destroy=function(){var v;this.selfUnref&&(this.nativeArtboard.unref(),(v=this.nativeViewModel)===null||v===void 0||v.unref());},h})(S),j=(function(){function I(h,v,L,G){this.stateMachine=h,this.playing=L,this.artboard=G,this.inputs=[],this.instance=new v.StateMachineInstance(h,G),this.initInputs(v);}return Object.defineProperty(I.prototype,"name",{get:function(){return this.stateMachine.name},enumerable:false,configurable:true}),Object.defineProperty(I.prototype,"statesChanged",{get:function(){for(var h=[],v=0;v<this.instance.stateChangedCount();v++)h.push(this.instance.stateChangedNameByIndex(v));return h},enumerable:false,configurable:true}),I.prototype.advance=function(h){this.instance.advance(h);},I.prototype.advanceAndApply=function(h){this.instance.advanceAndApply(h);},I.prototype.reportedEventCount=function(){return this.instance.reportedEventCount()},I.prototype.reportedEventAt=function(h){return this.instance.reportedEventAt(h)},I.prototype.initInputs=function(h){for(var v=0;v<this.instance.inputCount();v++){var L=this.instance.input(v);this.inputs.push(this.mapRuntimeInput(L,h));}},I.prototype.mapRuntimeInput=function(h,v){if(h.type===v.SMIInput.bool)return new T(A.Boolean,h.asBool());if(h.type===v.SMIInput.number)return new T(A.Number,h.asNumber());if(h.type===v.SMIInput.trigger)return new T(A.Trigger,h.asTrigger())},I.prototype.cleanup=function(){this.inputs.forEach(function(h){h.delete();}),this.inputs.length=0,this.instance.delete();},I.prototype.bindViewModelInstance=function(h){h.runtimeInstance!=null&&this.instance.bindViewModelInstance(h.runtimeInstance);},I})(),q=(function(){function I(h,v,L,G,V){G===void 0&&(G=[]),V===void 0&&(V=[]),this.runtime=h,this.artboard=v,this.eventManager=L,this.animations=G,this.stateMachines=V;}return I.prototype.add=function(h,v,L){if(L===void 0&&(L=true),h=yt(h),h.length===0)this.animations.forEach(function(Je){return Je.playing=v}),this.stateMachines.forEach(function(Je){return Je.playing=v});else for(var G=this.animations.map(function(Je){return Je.name}),V=this.stateMachines.map(function(Je){return Je.name}),Z=0;Z<h.length;Z++){var ue=G.indexOf(h[Z]),Ce=V.indexOf(h[Z]);if(ue>=0||Ce>=0)ue>=0?this.animations[ue].playing=v:this.stateMachines[Ce].playing=v;else {var be=this.artboard.animationByName(h[Z]);if(be){var Se=new l.Animation(be,this.artboard,this.runtime,v);Se.advance(0),Se.apply(1),this.animations.push(Se);}else {var ot=this.artboard.stateMachineByName(h[Z]);if(ot){var pt=new j(ot,this.runtime,v,this.artboard);this.stateMachines.push(pt);}}}}return L&&(v?this.eventManager.fire({type:U.Play,data:this.playing}):this.eventManager.fire({type:U.Pause,data:this.paused})),v?this.playing:this.paused},I.prototype.initLinearAnimations=function(h,v){for(var L=this.animations.map(function(Ce){return Ce.name}),G=0;G<h.length;G++){var V=L.indexOf(h[G]);if(V>=0)this.animations[V].playing=v;else {var Z=this.artboard.animationByName(h[G]);if(Z){var ue=new l.Animation(Z,this.artboard,this.runtime,v);ue.advance(0),ue.apply(1),this.animations.push(ue);}else console.error("Animation with name ".concat(h[G]," not found."));}}},I.prototype.initStateMachines=function(h,v){for(var L=this.stateMachines.map(function(Ce){return Ce.name}),G=0;G<h.length;G++){var V=L.indexOf(h[G]);if(V>=0)this.stateMachines[V].playing=v;else {var Z=this.artboard.stateMachineByName(h[G]);if(Z){var ue=new j(Z,this.runtime,v,this.artboard);this.stateMachines.push(ue);}else console.warn("State Machine with name ".concat(h[G]," not found.")),this.initLinearAnimations([h[G]],v);}}},I.prototype.play=function(h){return this.add(h,true)},I.prototype.advanceIfPaused=function(){this.stateMachines.forEach(function(h){h.playing||h.advanceAndApply(0);});},I.prototype.pause=function(h){return this.add(h,false)},I.prototype.scrub=function(h,v){var L=this.animations.filter(function(G){return h.includes(G.name)});return L.forEach(function(G){return G.scrubTo=v}),L.map(function(G){return G.name})},Object.defineProperty(I.prototype,"playing",{get:function(){return this.animations.filter(function(h){return h.playing}).map(function(h){return h.name}).concat(this.stateMachines.filter(function(h){return h.playing}).map(function(h){return h.name}))},enumerable:false,configurable:true}),Object.defineProperty(I.prototype,"paused",{get:function(){return this.animations.filter(function(h){return !h.playing}).map(function(h){return h.name}).concat(this.stateMachines.filter(function(h){return !h.playing}).map(function(h){return h.name}))},enumerable:false,configurable:true}),I.prototype.stop=function(h){var v=this;h=yt(h);var L=[];if(h.length===0)L=this.animations.map(function(Z){return Z.name}).concat(this.stateMachines.map(function(Z){return Z.name})),this.animations.forEach(function(Z){return Z.cleanup()}),this.stateMachines.forEach(function(Z){return Z.cleanup()}),this.animations.splice(0,this.animations.length),this.stateMachines.splice(0,this.stateMachines.length);else {var G=this.animations.filter(function(Z){return h.includes(Z.name)});G.forEach(function(Z){Z.cleanup(),v.animations.splice(v.animations.indexOf(Z),1);});var V=this.stateMachines.filter(function(Z){return h.includes(Z.name)});V.forEach(function(Z){Z.cleanup(),v.stateMachines.splice(v.stateMachines.indexOf(Z),1);}),L=G.map(function(Z){return Z.name}).concat(V.map(function(Z){return Z.name}));}return this.eventManager.fire({type:U.Stop,data:L}),L},Object.defineProperty(I.prototype,"isPlaying",{get:function(){return this.animations.reduce(function(h,v){return h||v.playing},false)||this.stateMachines.reduce(function(h,v){return h||v.playing},false)},enumerable:false,configurable:true}),Object.defineProperty(I.prototype,"isPaused",{get:function(){return !this.isPlaying&&(this.animations.length>0||this.stateMachines.length>0)},enumerable:false,configurable:true}),Object.defineProperty(I.prototype,"isStopped",{get:function(){return this.animations.length===0&&this.stateMachines.length===0},enumerable:false,configurable:true}),I.prototype.atLeastOne=function(h,v){v===void 0&&(v=true);var L;return this.animations.length===0&&this.stateMachines.length===0&&(this.artboard.animationCount()>0?this.add([L=this.artboard.animationByIndex(0).name],h,v):this.artboard.stateMachineCount()>0&&this.add([L=this.artboard.stateMachineByIndex(0).name],h,v)),L},I.prototype.handleLooping=function(){for(var h=0,v=this.animations.filter(function(G){return G.playing});h<v.length;h++){var L=v[h];L.loopValue===0&&L.loopCount?(L.loopCount=0,this.stop(L.name)):L.loopValue===1&&L.loopCount?(this.eventManager.fire({type:U.Loop,data:{animation:L.name,type:ce.Loop}}),L.loopCount=0):L.loopValue===2&&L.loopCount>1&&(this.eventManager.fire({type:U.Loop,data:{animation:L.name,type:ce.PingPong}}),L.loopCount=0);}},I.prototype.handleStateChanges=function(){for(var h=[],v=0,L=this.stateMachines.filter(function(V){return V.playing});v<L.length;v++){var G=L[v];h.push.apply(h,G.statesChanged);}h.length>0&&this.eventManager.fire({type:U.StateChange,data:h});},I.prototype.handleAdvancing=function(h){this.eventManager.fire({type:U.Advance,data:h});},I})(),U;(function(I){I.Load="load",I.LoadError="loaderror",I.Play="play",I.Pause="pause",I.Stop="stop",I.Loop="loop",I.Draw="draw",I.Advance="advance",I.StateChange="statechange",I.RiveEvent="riveevent",I.AudioStatusChange="audiostatuschange";})(U||(U={}));var ce;(function(I){I.OneShot="oneshot",I.Loop="loop",I.PingPong="pingpong";})(ce||(ce={}));var W=(function(){function I(h){h===void 0&&(h=[]),this.listeners=h;}return I.prototype.getListeners=function(h){return this.listeners.filter(function(v){return v.type===h})},I.prototype.add=function(h){this.listeners.includes(h)||this.listeners.push(h);},I.prototype.remove=function(h){for(var v=0;v<this.listeners.length;v++){var L=this.listeners[v];if(L.type===h.type&&L.callback===h.callback){this.listeners.splice(v,1);break}}},I.prototype.removeAll=function(h){var v=this;h?this.listeners.filter(function(L){return L.type===h}).forEach(function(L){return v.remove(L)}):this.listeners.splice(0,this.listeners.length);},I.prototype.fire=function(h){var v=this.getListeners(h.type);v.forEach(function(L){return L.callback(h)});},I})(),te=(function(){function I(h){this.eventManager=h,this.queue=[];}return I.prototype.add=function(h){this.queue.push(h);},I.prototype.process=function(){for(;this.queue.length>0;){var h=this.queue.shift();h?.action&&h.action(),h?.event&&this.eventManager.fire(h.event);}},I})(),ne;(function(I){I[I.AVAILABLE=0]="AVAILABLE",I[I.UNAVAILABLE=1]="UNAVAILABLE";})(ne||(ne={}));var ie=(function(I){c(h,I);function h(){var v=I!==null&&I.apply(this,arguments)||this;return v._started=false,v._enabled=false,v._status=ne.UNAVAILABLE,v}return h.prototype.delay=function(v){return m(this,void 0,void 0,function(){return b(this,function(L){return [2,new Promise(function(G){return setTimeout(G,v)})]})})},h.prototype.timeout=function(){return m(this,void 0,void 0,function(){return b(this,function(v){return [2,new Promise(function(L,G){return setTimeout(G,50)})]})})},h.prototype.reportToListeners=function(){this.fire({type:U.AudioStatusChange}),this.removeAll();},h.prototype.enableAudio=function(){return m(this,void 0,void 0,function(){return b(this,function(v){return this._enabled||(this._enabled=true,this._status=ne.AVAILABLE,this.reportToListeners()),[2]})})},h.prototype.testAudio=function(){return m(this,void 0,void 0,function(){return b(this,function(v){switch(v.label){case 0:if(!(this._status===ne.UNAVAILABLE&&this._audioContext!==null))return [3,4];v.label=1;case 1:return v.trys.push([1,3,,4]),[4,Promise.race([this._audioContext.resume(),this.timeout()])];case 2:return v.sent(),this.enableAudio(),[3,4];case 3:return v.sent(),[3,4];case 4:return [2]}})})},h.prototype._establishAudio=function(){return m(this,void 0,void 0,function(){return b(this,function(v){switch(v.label){case 0:return this._started?[3,5]:(this._started=true,typeof window>"u"?(this.enableAudio(),[3,5]):[3,1]);case 1:this._audioContext=new AudioContext,this.listenForUserAction(),v.label=2;case 2:return this._status!==ne.UNAVAILABLE?[3,5]:[4,this.testAudio()];case 3:return v.sent(),[4,this.delay(1e3)];case 4:return v.sent(),[3,2];case 5:return [2]}})})},h.prototype.listenForUserAction=function(){var v=this,L=function(){return m(v,void 0,void 0,function(){return b(this,function(G){return this.enableAudio(),[2]})})};document.addEventListener("pointerdown",L,{once:true});},h.prototype.establishAudio=function(){return m(this,void 0,void 0,function(){return b(this,function(v){return this._establishAudio(),[2]})})},Object.defineProperty(h.prototype,"systemVolume",{get:function(){return this._status===ne.UNAVAILABLE?(this.testAudio(),0):1},enumerable:false,configurable:true}),Object.defineProperty(h.prototype,"status",{get:function(){return this._status},enumerable:false,configurable:true}),h})(W),ee=new ie,H=(function(){function I(){}return I.prototype.observe=function(){},I.prototype.unobserve=function(){},I.prototype.disconnect=function(){},I})(),K=globalThis.ResizeObserver||H,D=(function(){function I(){var h=this;this._elementsMap=new Map,this._onObservedEntry=function(v){var L=h._elementsMap.get(v.target);L!==null?L.onResize(v.target.clientWidth==0||v.target.clientHeight==0):h._resizeObserver.unobserve(v.target);},this._onObserved=function(v){v.forEach(h._onObservedEntry);},this._resizeObserver=new K(this._onObserved);}return I.prototype.add=function(h,v){var L={onResize:v,element:h};return this._elementsMap.set(h,L),this._resizeObserver.observe(h),L},I.prototype.remove=function(h){this._resizeObserver.unobserve(h.element),this._elementsMap.delete(h.element);},I})(),B=new D,Q=(function(){function I(h){this.enableRiveAssetCDN=true,this.referenceCount=0,this.destroyed=false,this.selfUnref=false,this.bindableArtboards=[],this.src=h.src,this.buffer=h.buffer,h.assetLoader&&(this.assetLoader=h.assetLoader),this.enableRiveAssetCDN=typeof h.enableRiveAssetCDN=="boolean"?h.enableRiveAssetCDN:true,this.eventManager=new W,h.onLoad&&this.on(U.Load,h.onLoad),h.onLoadError&&this.on(U.LoadError,h.onLoadError);}return I.prototype.releaseFile=function(){var h;this.selfUnref&&((h=this.file)===null||h===void 0||h.unref()),this.file=null;},I.prototype.releaseBindableArtboards=function(){this.bindableArtboards.forEach(function(h){return h.destroy()});},I.prototype.initData=function(){return m(this,void 0,void 0,function(){var h,v,L,G,V;return b(this,function(Z){switch(Z.label){case 0:return this.src?(h=this,[4,Rn(this.src)]):[3,2];case 1:h.buffer=Z.sent(),Z.label=2;case 2:return this.destroyed?[2]:(this.assetLoader&&(L=new d.CustomFileAssetLoaderWrapper(this.runtime,this.assetLoader),v=L.assetLoader),G=this,[4,this.runtime.load(new Uint8Array(this.buffer),v,this.enableRiveAssetCDN)]);case 3:return G.file=Z.sent(),V=new d.FileFinalizer(this.file),d.finalizationRegistry.register(this,V),this.destroyed?(this.releaseFile(),[2]):(this.file!==null?this.eventManager.fire({type:U.Load,data:this}):this.fireLoadError(I.fileLoadErrorMessage),[2])}})})},I.prototype.init=function(){return m(this,void 0,void 0,function(){var h,v;return b(this,function(L){switch(L.label){case 0:if(!this.src&&!this.buffer)return this.fireLoadError(I.missingErrorMessage),[2];L.label=1;case 1:return L.trys.push([1,4,,5]),h=this,[4,F.awaitInstance()];case 2:return h.runtime=L.sent(),this.destroyed?[2]:[4,this.initData()];case 3:return L.sent(),[3,5];case 4:return v=L.sent(),this.fireLoadError(v instanceof Error?v.message:I.fileLoadErrorMessage),[3,5];case 5:return [2]}})})},I.prototype.fireLoadError=function(h){throw this.eventManager.fire({type:U.LoadError,data:h}),new Error(h)},I.prototype.on=function(h,v){this.eventManager.add({type:h,callback:v});},I.prototype.off=function(h,v){this.eventManager.remove({type:h,callback:v});},I.prototype.cleanup=function(){this.referenceCount-=1,this.referenceCount<=0&&(this.removeAllRiveEventListeners(),this.releaseFile(),this.releaseBindableArtboards(),this.destroyed=true);},I.prototype.removeAllRiveEventListeners=function(h){this.eventManager.removeAll(h);},I.prototype.getInstance=function(){if(this.file!==null)return this.referenceCount+=1,this.file},I.prototype.destroyIfUnused=function(){this.referenceCount<=0&&this.cleanup();},I.prototype.createBindableArtboard=function(h){if(h!=null){var v=new z(h);return (0, d.createFinalization)(v,v.nativeArtboard),this.bindableArtboards.push(v),v}return null},I.prototype.getArtboard=function(h){var v=this.file.artboardByName(h);if(v!=null)return new R(v,this)},I.prototype.getBindableArtboard=function(h){var v=this.file.bindableArtboardByName(h);return this.createBindableArtboard(v)},I.prototype.getDefaultBindableArtboard=function(){var h=this.file.bindableArtboardDefault();return this.createBindableArtboard(h)},I.prototype.internalBindableArtboardFromArtboard=function(h){var v=this.file.internalBindableArtboardFromArtboard(h);return this.createBindableArtboard(v)},I.prototype.viewModelByName=function(h){var v=this.file.viewModelByName(h);return v!==null?new le(v):null},I.missingErrorMessage="Rive source file or data buffer required",I.fileLoadErrorMessage="The file failed to load",I})(),ae=(function(){function I(h){var v=this,L,G;this.loaded=false,this.destroyed=false,this._observed=null,this.readyForPlaying=false,this.artboard=null,this.eventCleanup=null,this.shouldDisableRiveListeners=false,this.automaticallyHandleEvents=false,this.dispatchPointerExit=true,this.enableMultiTouch=false,this.enableRiveAssetCDN=true,this._volume=1,this._artboardWidth=void 0,this._artboardHeight=void 0,this._devicePixelRatioUsed=1,this._hasZeroSize=false,this._needsRedraw=false,this._currentCanvasWidth=0,this._currentCanvasHeight=0,this._audioEventListener=null,this._boundDraw=null,this._viewModelInstance=null,this._dataEnums=null,this.drawOptimization=P.DrawOnChanged,this.durations=[],this.frameTimes=[],this.frameCount=0,this.isTouchScrollEnabled=false,this.onCanvasResize=function(V){var Z=v._hasZeroSize!==V;v._hasZeroSize=V,V?(!v._layout.maxX||!v._layout.maxY)&&v.resizeToCanvas():Z&&v.resizeDrawingSurfaceToCanvas();},this.renderSecondTimer=0,this._boundDraw=this.draw.bind(this),this.canvas=h.canvas,h.canvas.constructor===HTMLCanvasElement&&(this._observed=B.add(this.canvas,this.onCanvasResize)),this._currentCanvasWidth=this.canvas.width,this._currentCanvasHeight=this.canvas.height,this.src=h.src,this.buffer=h.buffer,this.riveFile=h.riveFile,this.layout=(L=h.layout)!==null&&L!==void 0?L:new O,this.shouldDisableRiveListeners=!!h.shouldDisableRiveListeners,this.isTouchScrollEnabled=!!h.isTouchScrollEnabled,this.automaticallyHandleEvents=!!h.automaticallyHandleEvents,this.dispatchPointerExit=h.dispatchPointerExit===false?h.dispatchPointerExit:this.dispatchPointerExit,this.enableMultiTouch=!!h.enableMultiTouch,this.drawOptimization=(G=h.drawingOptions)!==null&&G!==void 0?G:this.drawOptimization,this.enableRiveAssetCDN=h.enableRiveAssetCDN===void 0?true:h.enableRiveAssetCDN,this.eventManager=new W,h.onLoad&&this.on(U.Load,h.onLoad),h.onLoadError&&this.on(U.LoadError,h.onLoadError),h.onPlay&&this.on(U.Play,h.onPlay),h.onPause&&this.on(U.Pause,h.onPause),h.onStop&&this.on(U.Stop,h.onStop),h.onLoop&&this.on(U.Loop,h.onLoop),h.onStateChange&&this.on(U.StateChange,h.onStateChange),h.onAdvance&&this.on(U.Advance,h.onAdvance),h.onload&&!h.onLoad&&this.on(U.Load,h.onload),h.onloaderror&&!h.onLoadError&&this.on(U.LoadError,h.onloaderror),h.onplay&&!h.onPlay&&this.on(U.Play,h.onplay),h.onpause&&!h.onPause&&this.on(U.Pause,h.onpause),h.onstop&&!h.onStop&&this.on(U.Stop,h.onstop),h.onloop&&!h.onLoop&&this.on(U.Loop,h.onloop),h.onstatechange&&!h.onStateChange&&this.on(U.StateChange,h.onstatechange),h.assetLoader&&(this.assetLoader=h.assetLoader),this.taskQueue=new te(this.eventManager),this.init({src:this.src,buffer:this.buffer,riveFile:this.riveFile,autoplay:h.autoplay,autoBind:h.autoBind,animations:h.animations,stateMachines:h.stateMachines,artboard:h.artboard,useOffscreenRenderer:h.useOffscreenRenderer});}return Object.defineProperty(I.prototype,"viewModelCount",{get:function(){return this.file.viewModelCount()},enumerable:false,configurable:true}),I.new=function(h){return console.warn("This function is deprecated: please use `new Rive({})` instead"),new I(h)},I.prototype.onSystemAudioChanged=function(){this.volume=this._volume;},I.prototype.init=function(h){var v=this,L=h.src,G=h.buffer,V=h.riveFile,Z=h.animations,ue=h.stateMachines,Ce=h.artboard,be=h.autoplay,Se=be===void 0?false:be,ot=h.useOffscreenRenderer,pt=ot===void 0?false:ot,Je=h.autoBind,Ot=Je===void 0?false:Je;if(!this.destroyed){if(this.src=L,this.buffer=G,this.riveFile=V,!this.src&&!this.buffer&&!this.riveFile)throw new w(I.missingErrorMessage);var Ct=yt(Z),dn=yt(ue);this.loaded=false,this.readyForPlaying=false,F.awaitInstance().then(function(un){v.destroyed||(v.runtime=un,v.removeRiveListeners(),v.deleteRiveRenderer(),v.renderer=v.runtime.makeRenderer(v.canvas,pt),v.canvas.width||v.canvas.height||v.resizeDrawingSurfaceToCanvas(),v.initData(Ce,Ct,dn,Se,Ot).then(function(bn){if(bn)return v.setupRiveListeners()}).catch(function(bn){console.error(bn);}));}).catch(function(un){console.error(un);});}},I.prototype.setupRiveListeners=function(h){var v=this;if(this.eventCleanup&&this.eventCleanup(),!this.shouldDisableRiveListeners){var L=(this.animator.stateMachines||[]).filter(function(ue){return ue.playing&&v.runtime.hasListeners(ue.instance)}).map(function(ue){return ue.instance}),G=this.isTouchScrollEnabled,V=this.dispatchPointerExit,Z=this.enableMultiTouch;h&&"isTouchScrollEnabled"in h&&(G=h.isTouchScrollEnabled),this.eventCleanup=(0, d.registerTouchInteractions)({canvas:this.canvas,artboard:this.artboard,stateMachines:L,renderer:this.renderer,rive:this.runtime,fit:this._layout.runtimeFit(this.runtime),alignment:this._layout.runtimeAlignment(this.runtime),isTouchScrollEnabled:G,dispatchPointerExit:V,enableMultiTouch:Z,layoutScaleFactor:this._layout.layoutScaleFactor});}},I.prototype.removeRiveListeners=function(){this.eventCleanup&&(this.eventCleanup(),this.eventCleanup=null);},I.prototype.initializeAudio=function(){var h=this,v;ee.status==ne.UNAVAILABLE&&!((v=this.artboard)===null||v===void 0)&&v.hasAudio&&this._audioEventListener===null&&(this._audioEventListener={type:U.AudioStatusChange,callback:function(){return h.onSystemAudioChanged()}},ee.add(this._audioEventListener),ee.establishAudio());},I.prototype.initArtboardSize=function(){this.artboard&&(this._artboardWidth=this.artboard.width=this._artboardWidth||this.artboard.width,this._artboardHeight=this.artboard.height=this._artboardHeight||this.artboard.height);},I.prototype.initData=function(h,v,L,G,V){return m(this,void 0,void 0,function(){var Z,ue,Ce,be;return b(this,function(Se){switch(Se.label){case 0:return Se.trys.push([0,3,,4]),this.riveFile!=null?[3,2]:(Z=new Q({src:this.src,buffer:this.buffer,enableRiveAssetCDN:this.enableRiveAssetCDN,assetLoader:this.assetLoader}),this.riveFile=Z,[4,Z.init()]);case 1:if(Se.sent(),this.destroyed)return Z.destroyIfUnused(),[2,false];Se.label=2;case 2:return this.file=this.riveFile.getInstance(),this.initArtboard(h,v,L,G,V),this.initArtboardSize(),this.initializeAudio(),this.loaded=true,this.eventManager.fire({type:U.Load,data:(be=this.src)!==null&&be!==void 0?be:"buffer"}),this.animator.advanceIfPaused(),this.readyForPlaying=true,this.taskQueue.process(),this.drawFrame(),[2,true];case 3:return ue=Se.sent(),Ce=_(ue),console.warn(Ce),this.eventManager.fire({type:U.LoadError,data:Ce}),[2,Promise.reject(Ce)];case 4:return [2]}})})},I.prototype.initArtboard=function(h,v,L,G,V){if(this.file){var Z=h?this.file.artboardByName(h):this.file.defaultArtboard();if(!Z){var ue="Invalid artboard name or no default artboard";console.warn(ue),this.eventManager.fire({type:U.LoadError,data:ue});return}this.artboard=Z,Z.volume=this._volume*ee.systemVolume,this.animator=new q(this.runtime,this.artboard,this.eventManager);var Ce;if(v.length>0||L.length>0?(Ce=v.concat(L),this.animator.initLinearAnimations(v,G),this.animator.initStateMachines(L,G)):Ce=[this.animator.atLeastOne(G,false)],this.taskQueue.add({event:{type:G?U.Play:U.Pause,data:Ce}}),V){var be=this.file.defaultArtboardViewModel(Z);if(be!==null){var Se=be.defaultInstance();if(Se!==null){var ot=new Be(Se,null);(0, d.createFinalization)(ot,ot.runtimeInstance),this.bindViewModelInstance(ot);}}}}},I.prototype.drawFrame=function(){var h,v;!((h=document?.timeline)===null||h===void 0)&&h.currentTime?this.loaded&&this.artboard&&!this.frameRequestId&&(this._boundDraw(document.timeline.currentTime),(v=this.runtime)===null||v===void 0||v.resolveAnimationFrame()):this.scheduleRendering();},I.prototype._canvasSizeChanged=function(){var h=false;return this.canvas&&(this.canvas.width!==this._currentCanvasWidth&&(this._currentCanvasWidth=this.canvas.width,h=true),this.canvas.height!==this._currentCanvasHeight&&(this._currentCanvasHeight=this.canvas.height,h=true)),h},I.prototype.draw=function(h,v){var L;this.frameRequestId=null;var G=performance.now();this.lastRenderTime||(this.lastRenderTime=h),this.renderSecondTimer+=h-this.lastRenderTime,this.renderSecondTimer>5e3&&(this.renderSecondTimer=0,v?.());var V=(h-this.lastRenderTime)/1e3;this.lastRenderTime=h;for(var Z=this.animator.animations.filter(function(yn){return yn.playing||yn.needsScrub}).sort(function(yn){return yn.needsScrub?-1:1}),ue=0,Ce=Z;ue<Ce.length;ue++){var be=Ce[ue];be.advance(V),be.instance.didLoop&&(be.loopCount+=1),be.apply(1);}for(var Se=this.animator.stateMachines.filter(function(yn){return yn.playing}),ot=0,pt=Se;ot<pt.length;ot++){var Je=pt[ot],Ot=Je.reportedEventCount();if(Ot)for(var Ct=0;Ct<Ot;Ct++){var dn=Je.reportedEventAt(Ct);if(dn)if(dn.type===M.OpenUrl){if(this.eventManager.fire({type:U.RiveEvent,data:dn}),this.automaticallyHandleEvents){var un=document.createElement("a"),bn=dn,dr=bn.url,$e=bn.target,ur=(0, d.sanitizeUrl)(dr);dr&&un.setAttribute("href",ur),$e&&un.setAttribute("target",$e),ur&&ur!==d.BLANK_URL&&un.click();}}else this.eventManager.fire({type:U.RiveEvent,data:dn});}Je.advanceAndApply(V);}this.animator.stateMachines.length==0&&this.artboard.advance(V);var vn=this.renderer;this._hasZeroSize||(this.drawOptimization==P.AlwaysDraw||this.artboard.didChange()||this._needsRedraw||this._canvasSizeChanged())&&(vn.clear(),vn.save(),this.alignRenderer(),this.artboard.draw(vn),vn.restore(),vn.flush(),this._needsRedraw=false),this.animator.handleLooping(),this.animator.handleStateChanges(),this.animator.handleAdvancing(V),this.frameCount++;var Qe=performance.now();for(this.frameTimes.push(Qe),this.durations.push(Qe-G);this.frameTimes[0]<=Qe-1e3;)this.frameTimes.shift(),this.durations.shift();(L=this._viewModelInstance)===null||L===void 0||L.handleCallbacks(),this.animator.isPlaying?this.scheduleRendering():this.animator.isPaused?this.lastRenderTime=0:this.animator.isStopped&&(this.lastRenderTime=0);},I.prototype.alignRenderer=function(){var h=this,v=h.renderer,L=h.runtime,G=h._layout,V=h.artboard;v.align(G.runtimeFit(L),G.runtimeAlignment(L),{minX:G.minX,minY:G.minY,maxX:G.maxX,maxY:G.maxY},V.bounds,this._devicePixelRatioUsed*G.layoutScaleFactor);},Object.defineProperty(I.prototype,"fps",{get:function(){return this.durations.length},enumerable:false,configurable:true}),Object.defineProperty(I.prototype,"frameTime",{get:function(){return this.durations.length===0?0:(this.durations.reduce(function(h,v){return h+v},0)/this.durations.length).toFixed(4)},enumerable:false,configurable:true}),I.prototype.cleanup=function(){var h,v;this.destroyed=true,this.stopRendering(),this.cleanupInstances(),this._observed!==null&&B.remove(this._observed),this.removeRiveListeners(),this.file&&((h=this.riveFile)===null||h===void 0||h.cleanup(),this.file=null),this.riveFile=null,this.deleteRiveRenderer(),this._audioEventListener!==null&&(ee.remove(this._audioEventListener),this._audioEventListener=null),(v=this._viewModelInstance)===null||v===void 0||v.cleanup(),this._viewModelInstance=null,this._dataEnums=null;},I.prototype.deleteRiveRenderer=function(){var h;(h=this.renderer)===null||h===void 0||h.delete(),this.renderer=null;},I.prototype.cleanupInstances=function(){this.eventCleanup!==null&&this.eventCleanup(),this.stop(),this.artboard&&(this.artboard.delete(),this.artboard=null);},I.prototype.retrieveTextRun=function(h){var v;if(!h){console.warn("No text run name provided");return}if(!this.artboard){console.warn("Tried to access text run, but the Artboard is null");return}var L=this.artboard.textRun(h);if(!L){console.warn("Could not access a text run with name '".concat(h,"' in the '").concat((v=this.artboard)===null||v===void 0?void 0:v.name,"' Artboard. Note that you must rename a text run node in the Rive editor to make it queryable at runtime."));return}return L},I.prototype.getTextRunValue=function(h){var v=this.retrieveTextRun(h);return v?v.text:void 0},I.prototype.setTextRunValue=function(h,v){var L=this.retrieveTextRun(h);L&&(L.text=v);},I.prototype.play=function(h,v){var L=this;if(h=yt(h),!this.readyForPlaying){this.taskQueue.add({action:function(){return L.play(h,v)}});return}this.animator.play(h),this.eventCleanup&&this.eventCleanup(),this.setupRiveListeners(),this.startRendering();},I.prototype.pause=function(h){var v=this;if(h=yt(h),!this.readyForPlaying){this.taskQueue.add({action:function(){return v.pause(h)}});return}this.eventCleanup&&this.eventCleanup(),this.animator.pause(h);},I.prototype.scrub=function(h,v){var L=this;if(h=yt(h),!this.readyForPlaying){this.taskQueue.add({action:function(){return L.scrub(h,v)}});return}this.animator.scrub(h,v||0),this.drawFrame();},I.prototype.stop=function(h){var v=this;if(h=yt(h),!this.readyForPlaying){this.taskQueue.add({action:function(){return v.stop(h)}});return}this.animator&&this.animator.stop(h),this.eventCleanup&&this.eventCleanup();},I.prototype.reset=function(h){var v,L,G=h?.artboard,V=yt(h?.animations),Z=yt(h?.stateMachines),ue=(v=h?.autoplay)!==null&&v!==void 0?v:false,Ce=(L=h?.autoBind)!==null&&L!==void 0?L:false;this.cleanupInstances(),this.initArtboard(G,V,Z,ue,Ce),this.taskQueue.process();},I.prototype.load=function(h){this.file=null,this.stop(),this.init(h);},Object.defineProperty(I.prototype,"layout",{get:function(){return this._layout},set:function(h){this._layout=h,(!h.maxX||!h.maxY)&&this.resizeToCanvas(),this.loaded&&!this.animator.isPlaying&&this.drawFrame();},enumerable:false,configurable:true}),I.prototype.resizeToCanvas=function(){this._layout=this.layout.copyWith({minX:0,minY:0,maxX:this.canvas.width,maxY:this.canvas.height});},I.prototype.resizeDrawingSurfaceToCanvas=function(h){if(this.canvas instanceof HTMLCanvasElement&&window){var v=this.canvas.getBoundingClientRect(),L=v.width,G=v.height,V=h||window.devicePixelRatio||1;if(this.devicePixelRatioUsed=V,this.canvas.width=V*L,this.canvas.height=V*G,this._needsRedraw=true,this.resizeToCanvas(),this.drawFrame(),this.layout.fit===C.Layout){var Z=this._layout.layoutScaleFactor;this.artboard.width=L/Z,this.artboard.height=G/Z;}}},Object.defineProperty(I.prototype,"source",{get:function(){return this.src},enumerable:false,configurable:true}),Object.defineProperty(I.prototype,"activeArtboard",{get:function(){return this.artboard?this.artboard.name:""},enumerable:false,configurable:true}),Object.defineProperty(I.prototype,"animationNames",{get:function(){if(!this.loaded||!this.artboard)return [];for(var h=[],v=0;v<this.artboard.animationCount();v++)h.push(this.artboard.animationByIndex(v).name);return h},enumerable:false,configurable:true}),Object.defineProperty(I.prototype,"stateMachineNames",{get:function(){if(!this.loaded||!this.artboard)return [];for(var h=[],v=0;v<this.artboard.stateMachineCount();v++)h.push(this.artboard.stateMachineByIndex(v).name);return h},enumerable:false,configurable:true}),I.prototype.stateMachineInputs=function(h){if(this.loaded){var v=this.animator.stateMachines.find(function(L){return L.name===h});return v?.inputs}},I.prototype.retrieveInputAtPath=function(h,v){if(!h){console.warn("No input name provided for path '".concat(v,"'"));return}if(!this.artboard){console.warn("Tried to access input: '".concat(h,"', at path: '").concat(v,"', but the Artboard is null"));return}var L=this.artboard.inputByPath(h,v);if(!L){console.warn("Could not access an input with name: '".concat(h,"', at path:'").concat(v,"'"));return}return L},I.prototype.setBooleanStateAtPath=function(h,v,L){var G=this.retrieveInputAtPath(h,L);G&&(G.type===A.Boolean?G.asBool().value=v:console.warn("Input with name: '".concat(h,"', at path:'").concat(L,"' is not a boolean")));},I.prototype.setNumberStateAtPath=function(h,v,L){var G=this.retrieveInputAtPath(h,L);G&&(G.type===A.Number?G.asNumber().value=v:console.warn("Input with name: '".concat(h,"', at path:'").concat(L,"' is not a number")));},I.prototype.fireStateAtPath=function(h,v){var L=this.retrieveInputAtPath(h,v);L&&(L.type===A.Trigger?L.asTrigger().fire():console.warn("Input with name: '".concat(h,"', at path:'").concat(v,"' is not a trigger")));},I.prototype.retrieveTextAtPath=function(h,v){if(!h){console.warn("No text name provided for path '".concat(v,"'"));return}if(!v){console.warn("No path provided for text '".concat(h,"'"));return}if(!this.artboard){console.warn("Tried to access text: '".concat(h,"', at path: '").concat(v,"', but the Artboard is null"));return}var L=this.artboard.textByPath(h,v);if(!L){console.warn("Could not access text with name: '".concat(h,"', at path:'").concat(v,"'"));return}return L},I.prototype.getTextRunValueAtPath=function(h,v){var L=this.retrieveTextAtPath(h,v);if(!L){console.warn("Could not get text with name: '".concat(h,"', at path:'").concat(v,"'"));return}return L.text},I.prototype.setTextRunValueAtPath=function(h,v,L){var G=this.retrieveTextAtPath(h,L);if(!G){console.warn("Could not set text with name: '".concat(h,"', at path:'").concat(L,"'"));return}G.text=v;},Object.defineProperty(I.prototype,"playingStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(h){return h.playing}).map(function(h){return h.name}):[]},enumerable:false,configurable:true}),Object.defineProperty(I.prototype,"playingAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(h){return h.playing}).map(function(h){return h.name}):[]},enumerable:false,configurable:true}),Object.defineProperty(I.prototype,"pausedAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(h){return !h.playing}).map(function(h){return h.name}):[]},enumerable:false,configurable:true}),Object.defineProperty(I.prototype,"pausedStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(h){return !h.playing}).map(function(h){return h.name}):[]},enumerable:false,configurable:true}),Object.defineProperty(I.prototype,"isPlaying",{get:function(){return this.animator.isPlaying},enumerable:false,configurable:true}),Object.defineProperty(I.prototype,"isPaused",{get:function(){return this.animator.isPaused},enumerable:false,configurable:true}),Object.defineProperty(I.prototype,"isStopped",{get:function(){var h,v;return (v=(h=this.animator)===null||h===void 0?void 0:h.isStopped)!==null&&v!==void 0?v:true},enumerable:false,configurable:true}),Object.defineProperty(I.prototype,"bounds",{get:function(){return this.artboard?this.artboard.bounds:void 0},enumerable:false,configurable:true}),I.prototype.on=function(h,v){this.eventManager.add({type:h,callback:v});},I.prototype.off=function(h,v){this.eventManager.remove({type:h,callback:v});},I.prototype.unsubscribe=function(h,v){console.warn("This function is deprecated: please use `off()` instead."),this.off(h,v);},I.prototype.removeAllRiveEventListeners=function(h){this.eventManager.removeAll(h);},I.prototype.unsubscribeAll=function(h){console.warn("This function is deprecated: please use `removeAllRiveEventListeners()` instead."),this.removeAllRiveEventListeners(h);},I.prototype.stopRendering=function(){this.loaded&&this.frameRequestId&&(this.runtime.cancelAnimationFrame?this.runtime.cancelAnimationFrame(this.frameRequestId):cancelAnimationFrame(this.frameRequestId),this.frameRequestId=null);},I.prototype.startRendering=function(){this.drawFrame();},I.prototype.scheduleRendering=function(){this.loaded&&this.artboard&&!this.frameRequestId&&(this.runtime.requestAnimationFrame?this.frameRequestId=this.runtime.requestAnimationFrame(this._boundDraw):this.frameRequestId=requestAnimationFrame(this._boundDraw));},I.prototype.enableFPSCounter=function(h){this.runtime.enableFPSCounter(h);},I.prototype.disableFPSCounter=function(){this.runtime.disableFPSCounter();},Object.defineProperty(I.prototype,"contents",{get:function(){if(this.loaded){for(var h={artboards:[]},v=0;v<this.file.artboardCount();v++){for(var L=this.file.artboardByIndex(v),G={name:L.name,animations:[],stateMachines:[]},V=0;V<L.animationCount();V++){var Z=L.animationByIndex(V);G.animations.push(Z.name);}for(var ue=0;ue<L.stateMachineCount();ue++){for(var Ce=L.stateMachineByIndex(ue),be=Ce.name,Se=new this.runtime.StateMachineInstance(Ce,L),ot=[],pt=0;pt<Se.inputCount();pt++){var Je=Se.input(pt);ot.push({name:Je.name,type:Je.type});}G.stateMachines.push({name:be,inputs:ot});}h.artboards.push(G);}return h}},enumerable:false,configurable:true}),Object.defineProperty(I.prototype,"volume",{get:function(){return this.artboard&&this.artboard.volume!==this._volume&&(this._volume=this.artboard.volume),this._volume},set:function(h){this._volume=h,this.artboard&&(this.artboard.volume=h*ee.systemVolume);},enumerable:false,configurable:true}),Object.defineProperty(I.prototype,"artboardWidth",{get:function(){var h;return this.artboard?this.artboard.width:(h=this._artboardWidth)!==null&&h!==void 0?h:0},set:function(h){this._artboardWidth=h,this.artboard&&(this.artboard.width=h);},enumerable:false,configurable:true}),Object.defineProperty(I.prototype,"artboardHeight",{get:function(){var h;return this.artboard?this.artboard.height:(h=this._artboardHeight)!==null&&h!==void 0?h:0},set:function(h){this._artboardHeight=h,this.artboard&&(this.artboard.height=h);},enumerable:false,configurable:true}),I.prototype.resetArtboardSize=function(){this.artboard?(this.artboard.resetArtboardSize(),this._artboardWidth=this.artboard.width,this._artboardHeight=this.artboard.height):(this._artboardWidth=void 0,this._artboardHeight=void 0);},Object.defineProperty(I.prototype,"devicePixelRatioUsed",{get:function(){return this._devicePixelRatioUsed},set:function(h){this._devicePixelRatioUsed=h;},enumerable:false,configurable:true}),I.prototype.bindViewModelInstance=function(h){var v;this.artboard&&!this.destroyed&&h&&h.runtimeInstance&&(h.internalIncrementReferenceCount(),(v=this._viewModelInstance)===null||v===void 0||v.cleanup(),this._viewModelInstance=h,this.animator.stateMachines.length>0?this.animator.stateMachines.forEach(function(L){return L.bindViewModelInstance(h)}):this.artboard.bindViewModelInstance(h.runtimeInstance));},Object.defineProperty(I.prototype,"viewModelInstance",{get:function(){return this._viewModelInstance},enumerable:false,configurable:true}),I.prototype.viewModelByIndex=function(h){var v=this.file.viewModelByIndex(h);return v!==null?new le(v):null},I.prototype.viewModelByName=function(h){var v;return (v=this.riveFile)===null||v===void 0?void 0:v.viewModelByName(h)},I.prototype.enums=function(){if(this._dataEnums===null){var h=this.file.enums();this._dataEnums=h.map(function(v){return new ve(v)});}return this._dataEnums},I.prototype.defaultViewModel=function(){if(this.artboard){var h=this.file.defaultArtboardViewModel(this.artboard);if(h)return new le(h)}return null},I.prototype.getArtboard=function(h){var v,L;return (L=(v=this.riveFile)===null||v===void 0?void 0:v.getArtboard(h))!==null&&L!==void 0?L:null},I.prototype.getBindableArtboard=function(h){var v,L;return (L=(v=this.riveFile)===null||v===void 0?void 0:v.getBindableArtboard(h))!==null&&L!==void 0?L:null},I.prototype.getDefaultBindableArtboard=function(){var h,v;return (v=(h=this.riveFile)===null||h===void 0?void 0:h.getDefaultBindableArtboard())!==null&&v!==void 0?v:null},I.missingErrorMessage="Rive source file or data buffer required",I.cleanupErrorMessage="Attempt to use file after calling cleanup.",I})(),le=(function(){function I(h){this._viewModel=h;}return Object.defineProperty(I.prototype,"instanceCount",{get:function(){return this._viewModel.instanceCount},enumerable:false,configurable:true}),Object.defineProperty(I.prototype,"name",{get:function(){return this._viewModel.name},enumerable:false,configurable:true}),I.prototype.instanceByIndex=function(h){var v=this._viewModel.instanceByIndex(h);if(v!==null){var L=new Be(v,null);return (0, d.createFinalization)(L,v),L}return null},I.prototype.instanceByName=function(h){var v=this._viewModel.instanceByName(h);if(v!==null){var L=new Be(v,null);return (0, d.createFinalization)(L,v),L}return null},I.prototype.defaultInstance=function(){var h=this._viewModel.defaultInstance();if(h!==null){var v=new Be(h,null);return (0, d.createFinalization)(v,h),v}return null},I.prototype.instance=function(){var h=this._viewModel.instance();if(h!==null){var v=new Be(h,null);return (0, d.createFinalization)(v,h),v}return null},Object.defineProperty(I.prototype,"properties",{get:function(){return this._viewModel.getProperties()},enumerable:false,configurable:true}),Object.defineProperty(I.prototype,"instanceNames",{get:function(){return this._viewModel.getInstanceNames()},enumerable:false,configurable:true}),I})(),ve=(function(){function I(h){this._dataEnum=h;}return Object.defineProperty(I.prototype,"name",{get:function(){return this._dataEnum.name},enumerable:false,configurable:true}),Object.defineProperty(I.prototype,"values",{get:function(){return this._dataEnum.values},enumerable:false,configurable:true}),I})(),Ie;(function(I){I.Number="number",I.String="string",I.Boolean="boolean",I.Color="color",I.Trigger="trigger",I.Enum="enum",I.List="list",I.Image="image",I.Artboard="artboard";})(Ie||(Ie={}));var Be=(function(){function I(h,v){this._parents=[],this._children=[],this._viewModelInstances=new Map,this._propertiesWithCallbacks=[],this._referenceCount=0,this.selfUnref=false,this._runtimeInstance=h,v!==null&&this._parents.push(v);}return Object.defineProperty(I.prototype,"runtimeInstance",{get:function(){return this._runtimeInstance},enumerable:false,configurable:true}),Object.defineProperty(I.prototype,"nativeInstance",{get:function(){return this._runtimeInstance},enumerable:false,configurable:true}),I.prototype.handleCallbacks=function(){this._propertiesWithCallbacks.length!==0&&(this._propertiesWithCallbacks.forEach(function(h){h.handleCallbacks();}),this._propertiesWithCallbacks.forEach(function(h){h.clearChanges();})),this._children.forEach(function(h){return h.handleCallbacks()});},I.prototype.addParent=function(h){this._parents.includes(h)||(this._parents.push(h),(this._propertiesWithCallbacks.length>0||this._children.length>0)&&h.addToViewModelCallbacks(this));},I.prototype.removeParent=function(h){var v=this._parents.indexOf(h);if(v!==-1){var L=this._parents[v];L.removeFromViewModelCallbacks(this),this._parents.splice(v,1);}},I.prototype.addToPropertyCallbacks=function(h){var v=this;this._propertiesWithCallbacks.includes(h)||(this._propertiesWithCallbacks.push(h),this._propertiesWithCallbacks.length>0&&this._parents.forEach(function(L){L.addToViewModelCallbacks(v);}));},I.prototype.removeFromPropertyCallbacks=function(h){var v=this;this._propertiesWithCallbacks.includes(h)&&(this._propertiesWithCallbacks=this._propertiesWithCallbacks.filter(function(L){return L!==h}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(L){L.removeFromViewModelCallbacks(v);}));},I.prototype.addToViewModelCallbacks=function(h){var v=this;this._children.includes(h)||(this._children.push(h),this._parents.forEach(function(L){L.addToViewModelCallbacks(v);}));},I.prototype.removeFromViewModelCallbacks=function(h){var v=this;this._children.includes(h)&&(this._children=this._children.filter(function(L){return L!==h}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(L){L.removeFromViewModelCallbacks(v);}));},I.prototype.clearCallbacks=function(){this._propertiesWithCallbacks.forEach(function(h){h.clearCallbacks();});},I.prototype.propertyFromPath=function(h,v){var L=h.split("/");return this.propertyFromPathSegments(L,0,v)},I.prototype.viewModelFromPathSegments=function(h,v){var L=this.internalViewModelInstance(h[v]);return L!==null?v==h.length-1?L:L.viewModelFromPathSegments(h,v++):null},I.prototype.propertyFromPathSegments=function(h,v,L){var G,V,Z,ue,Ce,be,Se,ot,pt,Je,Ot,Ct,dn,un,bn,dr,$e,ur;if(v<h.length-1){var vn=this.internalViewModelInstance(h[v]);return vn!==null?vn.propertyFromPathSegments(h,v+1,L):null}var Qe=null;switch(L){case Ie.Number:if(Qe=(V=(G=this._runtimeInstance)===null||G===void 0?void 0:G.number(h[v]))!==null&&V!==void 0?V:null,Qe!==null)return new gt(Qe,this);break;case Ie.String:if(Qe=(ue=(Z=this._runtimeInstance)===null||Z===void 0?void 0:Z.string(h[v]))!==null&&ue!==void 0?ue:null,Qe!==null)return new Qt(Qe,this);break;case Ie.Boolean:if(Qe=(be=(Ce=this._runtimeInstance)===null||Ce===void 0?void 0:Ce.boolean(h[v]))!==null&&be!==void 0?be:null,Qe!==null)return new Rt(Qe,this);break;case Ie.Color:if(Qe=(ot=(Se=this._runtimeInstance)===null||Se===void 0?void 0:Se.color(h[v]))!==null&&ot!==void 0?ot:null,Qe!==null)return new at(Qe,this);break;case Ie.Trigger:if(Qe=(Je=(pt=this._runtimeInstance)===null||pt===void 0?void 0:pt.trigger(h[v]))!==null&&Je!==void 0?Je:null,Qe!==null)return new rn(Qe,this);break;case Ie.Enum:if(Qe=(Ct=(Ot=this._runtimeInstance)===null||Ot===void 0?void 0:Ot.enum(h[v]))!==null&&Ct!==void 0?Ct:null,Qe!==null)return new jt(Qe,this);break;case Ie.List:if(Qe=(un=(dn=this._runtimeInstance)===null||dn===void 0?void 0:dn.list(h[v]))!==null&&un!==void 0?un:null,Qe!==null)return new on(Qe,this);break;case Ie.Image:if(Qe=(dr=(bn=this._runtimeInstance)===null||bn===void 0?void 0:bn.image(h[v]))!==null&&dr!==void 0?dr:null,Qe!==null)return new je(Qe,this);break;case Ie.Artboard:if(Qe=(ur=($e=this._runtimeInstance)===null||$e===void 0?void 0:$e.artboard(h[v]))!==null&&ur!==void 0?ur:null,Qe!==null)return new Ln(Qe,this);break}return null},I.prototype.internalViewModelInstance=function(h){var v;if(this._viewModelInstances.has(h))return this._viewModelInstances.get(h);var L=(v=this._runtimeInstance)===null||v===void 0?void 0:v.viewModel(h);if(L!==null){var G=new I(L,this);return (0, d.createFinalization)(G,L),G.internalIncrementReferenceCount(),this._viewModelInstances.set(h,G),G}return null},I.prototype.number=function(h){var v=this.propertyFromPath(h,Ie.Number);return v},I.prototype.string=function(h){var v=this.propertyFromPath(h,Ie.String);return v},I.prototype.boolean=function(h){var v=this.propertyFromPath(h,Ie.Boolean);return v},I.prototype.color=function(h){var v=this.propertyFromPath(h,Ie.Color);return v},I.prototype.trigger=function(h){var v=this.propertyFromPath(h,Ie.Trigger);return v},I.prototype.enum=function(h){var v=this.propertyFromPath(h,Ie.Enum);return v},I.prototype.list=function(h){var v=this.propertyFromPath(h,Ie.List);return v},I.prototype.image=function(h){var v=this.propertyFromPath(h,Ie.Image);return v},I.prototype.artboard=function(h){var v=this.propertyFromPath(h,Ie.Artboard);return v},I.prototype.viewModel=function(h){var v=h.split("/"),L=v.length>1?this.viewModelFromPathSegments(v.slice(0,v.length-1),0):this;return L!=null?L.internalViewModelInstance(v[v.length-1]):null},I.prototype.internalReplaceViewModel=function(h,v){var L;if(v.runtimeInstance!==null){var G=((L=this._runtimeInstance)===null||L===void 0?void 0:L.replaceViewModel(h,v.runtimeInstance))||false;if(G){v.internalIncrementReferenceCount();var V=this.internalViewModelInstance(h);V!==null&&(V.removeParent(this),this._children.includes(V)&&(this._children=this._children.filter(function(Z){return Z!==V})),V.cleanup()),this._viewModelInstances.set(h,v),v.addParent(this);}return G}return  false},I.prototype.replaceViewModel=function(h,v){var L,G=h.split("/"),V=G.length>1?this.viewModelFromPathSegments(G.slice(0,G.length-1),0):this;return (L=V?.internalReplaceViewModel(G[G.length-1],v))!==null&&L!==void 0?L:false},I.prototype.incrementReferenceCount=function(){var h;this._referenceCount++,(h=this._runtimeInstance)===null||h===void 0||h.incrementReferenceCount();},I.prototype.decrementReferenceCount=function(){var h;this._referenceCount--,(h=this._runtimeInstance)===null||h===void 0||h.decrementReferenceCount();},Object.defineProperty(I.prototype,"properties",{get:function(){var h;return ((h=this._runtimeInstance)===null||h===void 0?void 0:h.getProperties().map(function(v){return p({},v)}))||[]},enumerable:false,configurable:true}),I.prototype.internalIncrementReferenceCount=function(){this._referenceCount++;},I.prototype.cleanup=function(){var h=this,v;if(this._referenceCount--,this._referenceCount<=0){this.selfUnref&&((v=this._runtimeInstance)===null||v===void 0||v.unref()),this._runtimeInstance=null,this.clearCallbacks(),this._propertiesWithCallbacks=[],this._viewModelInstances.forEach(function(V){V.cleanup();}),this._viewModelInstances.clear();var L=g([],this._children);this._children.length=0;var G=g([],this._parents);this._parents.length=0,L.forEach(function(V){V.removeParent(h);}),G.forEach(function(V){V.removeFromViewModelCallbacks(h);});}},I})(),bt=(function(){function I(h,v){this.callbacks=[],this._viewModelInstanceValue=h,this._parentViewModel=v;}return I.prototype.on=function(h){this.callbacks.length===0&&this._viewModelInstanceValue.clearChanges(),this.callbacks.includes(h)||(this.callbacks.push(h),this._parentViewModel.addToPropertyCallbacks(this));},I.prototype.off=function(h){h?this.callbacks=this.callbacks.filter(function(v){return v!==h}):this.callbacks.length=0,this.callbacks.length===0&&this._parentViewModel.removeFromPropertyCallbacks(this);},I.prototype.internalHandleCallback=function(h){},I.prototype.handleCallbacks=function(){var h=this;this._viewModelInstanceValue.hasChanged&&this.callbacks.forEach(function(v){h.internalHandleCallback(v);});},I.prototype.clearChanges=function(){this._viewModelInstanceValue.clearChanges();},I.prototype.clearCallbacks=function(){this.callbacks.length=0;},Object.defineProperty(I.prototype,"name",{get:function(){return this._viewModelInstanceValue.name},enumerable:false,configurable:true}),I})(),Qt=(function(I){c(h,I);function h(v,L){return I.call(this,v,L)||this}return Object.defineProperty(h.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(v){this._viewModelInstanceValue.value=v;},enumerable:false,configurable:true}),h.prototype.internalHandleCallback=function(v){v(this.value);},h})(bt),gt=(function(I){c(h,I);function h(v,L){return I.call(this,v,L)||this}return Object.defineProperty(h.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(v){this._viewModelInstanceValue.value=v;},enumerable:false,configurable:true}),h.prototype.internalHandleCallback=function(v){v(this.value);},h})(bt),Rt=(function(I){c(h,I);function h(v,L){return I.call(this,v,L)||this}return Object.defineProperty(h.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(v){this._viewModelInstanceValue.value=v;},enumerable:false,configurable:true}),h.prototype.internalHandleCallback=function(v){v(this.value);},h})(bt),rn=(function(I){c(h,I);function h(v,L){return I.call(this,v,L)||this}return h.prototype.trigger=function(){return this._viewModelInstanceValue.trigger()},h.prototype.internalHandleCallback=function(v){v();},h})(bt),jt=(function(I){c(h,I);function h(v,L){return I.call(this,v,L)||this}return Object.defineProperty(h.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(v){this._viewModelInstanceValue.value=v;},enumerable:false,configurable:true}),Object.defineProperty(h.prototype,"valueIndex",{get:function(){return this._viewModelInstanceValue.valueIndex},set:function(v){this._viewModelInstanceValue.valueIndex=v;},enumerable:false,configurable:true}),Object.defineProperty(h.prototype,"values",{get:function(){return this._viewModelInstanceValue.values},enumerable:false,configurable:true}),h.prototype.internalHandleCallback=function(v){v(this.value);},h})(bt),on=(function(I){c(h,I);function h(v,L){return I.call(this,v,L)||this}return Object.defineProperty(h.prototype,"length",{get:function(){return this._viewModelInstanceValue.size},enumerable:false,configurable:true}),h.prototype.addInstance=function(v){v.runtimeInstance!=null&&(this._viewModelInstanceValue.addInstance(v.runtimeInstance),v.addParent(this._parentViewModel));},h.prototype.addInstanceAt=function(v,L){return v.runtimeInstance!=null&&this._viewModelInstanceValue.addInstanceAt(v.runtimeInstance,L)?(v.addParent(this._parentViewModel),true):false},h.prototype.removeInstance=function(v){v.runtimeInstance!=null&&(this._viewModelInstanceValue.removeInstance(v.runtimeInstance),v.removeParent(this._parentViewModel));},h.prototype.removeInstanceAt=function(v){this._viewModelInstanceValue.removeInstanceAt(v);},h.prototype.instanceAt=function(v){var L=this._viewModelInstanceValue.instanceAt(v);if(L!=null){var G=new Be(L,this._parentViewModel);return (0, d.createFinalization)(G,L),G}return null},h.prototype.swap=function(v,L){this._viewModelInstanceValue.swap(v,L);},h.prototype.internalHandleCallback=function(v){v();},h})(bt),at=(function(I){c(h,I);function h(v,L){return I.call(this,v,L)||this}return Object.defineProperty(h.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(v){this._viewModelInstanceValue.value=v;},enumerable:false,configurable:true}),h.prototype.rgb=function(v,L,G){this._viewModelInstanceValue.rgb(v,L,G);},h.prototype.rgba=function(v,L,G,V){this._viewModelInstanceValue.argb(V,v,L,G);},h.prototype.argb=function(v,L,G,V){this._viewModelInstanceValue.argb(v,L,G,V);},h.prototype.alpha=function(v){this._viewModelInstanceValue.alpha(v);},h.prototype.opacity=function(v){this._viewModelInstanceValue.alpha(Math.round(Math.max(0,Math.min(1,v))*255));},h.prototype.internalHandleCallback=function(v){v(this.value);},h})(bt),je=(function(I){c(h,I);function h(v,L){return I.call(this,v,L)||this}return Object.defineProperty(h.prototype,"value",{set:function(v){var L;this._viewModelInstanceValue.value((L=v?.nativeImage)!==null&&L!==void 0?L:null);},enumerable:false,configurable:true}),h.prototype.internalHandleCallback=function(v){v();},h})(bt),Ln=(function(I){c(h,I);function h(v,L){return I.call(this,v,L)||this}return Object.defineProperty(h.prototype,"value",{set:function(v){var L,G,V;v.isBindableArtboard?V=v:V=v.file.internalBindableArtboardFromArtboard(v.nativeArtboard),this._viewModelInstanceValue.value((L=V?.nativeArtboard)!==null&&L!==void 0?L:null),V?.nativeViewModel&&this._viewModelInstanceValue.viewModelInstance((G=V?.nativeViewModel)!==null&&G!==void 0?G:null);},enumerable:false,configurable:true}),h.prototype.internalHandleCallback=function(v){v();},h})(bt),Rn=function(I){return m(void 0,void 0,void 0,function(){var h,v,L;return b(this,function(G){switch(G.label){case 0:return h=new Request(I),[4,fetch(h)];case 1:return v=G.sent(),[4,v.arrayBuffer()];case 2:return L=G.sent(),[2,L]}})})},yt=function(I){return typeof I=="string"?[I]:I instanceof Array?I:[]},Tt={EventManager:W,TaskQueueManager:te},an=function(I){return m(void 0,void 0,void 0,function(){var h,v,L;return b(this,function(G){switch(G.label){case 0:return h=new Promise(function(V){return F.getInstance(function(Z){Z.decodeAudio(I,V);})}),[4,h];case 1:return v=G.sent(),L=new d.AudioWrapper(v),d.finalizationRegistry.register(L,v),[2,L]}})})},Wn=function(I){return m(void 0,void 0,void 0,function(){var h,v,L;return b(this,function(G){switch(G.label){case 0:return h=new Promise(function(V){return F.getInstance(function(Z){Z.decodeImage(I,V);})}),[4,h];case 1:return v=G.sent(),L=new d.ImageWrapper(v),d.finalizationRegistry.register(L,v),[2,L]}})})},mn=function(I){return m(void 0,void 0,void 0,function(){var h,v,L;return b(this,function(G){switch(G.label){case 0:return h=new Promise(function(V){return F.getInstance(function(Z){Z.decodeFont(I,V);})}),[4,h];case 1:return v=G.sent(),L=new d.FontWrapper(v),d.finalizationRegistry.register(L,v),[2,L]}})})};})(),i})());})(Jl)),Jl.exports}var eh=XE();async function th(e){const t=zE(e);if(t)return console.log(`[MGRiveLoader] Using cached RiveFile: ${e}`),t;console.log(`[MGRiveLoader] Loading RiveFile from: ${e}`);const n=await fetch(e);if(!n.ok)throw new Error(`Failed to load RiveFile: ${e} (${n.status})`);const r=await n.arrayBuffer(),o={};let i=null;if(await new Promise((s,l)=>{i=new eh.RiveFile({buffer:r,assetLoader:d=>d.isImage&&BE.includes(d.name)?(o[d.name]=d,console.log(`[MGRiveLoader] Captured image asset: ${d.name}`),true):false,onLoad:()=>{console.log(`[MGRiveLoader] RiveFile loaded: ${e}`),s();},onLoadError:d=>{console.error("[MGRiveLoader] RiveFile load error:",d),l(d);}}),i.init().catch(d=>{console.error("[MGRiveLoader] Failed to initialize RiveFile:",d),l(d);});}),!i)throw new Error(`[MGRiveLoader] Failed to create RiveFile for ${e}`);i.getInstance();const a={riveFile:i,imageAssets:o,url:e,loadedAt:Date.now()};return jE(e,a),a}const Yy=[{id:"Top_DefaultGray.png",filename:"Top_DefaultGray.png",type:"Top",availability:"default",displayName:"Default",price:0,url:""},{id:"Mid_DefaultGray.png",filename:"Mid_DefaultGray.png",type:"Mid",availability:"default",displayName:"Default",price:0,url:""},{id:"Bottom_DefaultGray.png",filename:"Bottom_DefaultGray.png",type:"Bottom",availability:"default",displayName:"Default",price:0,url:""},{id:"Expression_Default.png",filename:"Expression_Default.png",type:"Expression",availability:"default",displayName:"Default",price:0,url:""},{id:"Top_Blank.png",filename:"Top_Blank.png",type:"Top",availability:"default",displayName:"None",price:0,url:""},{id:"Mid_Blank.png",filename:"Mid_Blank.png",type:"Mid",availability:"default",displayName:"None",price:0,url:""},{id:"Bottom_Blank.png",filename:"Bottom_Blank.png",type:"Bottom",availability:"default",displayName:"None",price:0,url:""},{id:"Expression_Blank.png",filename:"Expression_Blank.png",type:"Expression",availability:"default",displayName:"None",price:0,url:""}],KE=(function(){const t=typeof document<"u"&&document.createElement("link").relList;return t&&t.supports&&t.supports("modulepreload")?"modulepreload":"preload"})(),YE=function(e){return "/"+e},bm={},Pn=function(t,n,r){let o=Promise.resolve();if(n&&n.length>0){let l=function(d){return Promise.all(d.map(c=>Promise.resolve(c).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),s=a?.nonce||a?.getAttribute("nonce");o=l(n.map(d=>{if(d=YE(d),d in bm)return;bm[d]=true;const c=d.endsWith(".css"),p=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${p}`))return;const m=document.createElement("link");if(m.rel=c?"stylesheet":KE,c||(m.as="script"),m.crossOrigin="",m.href=d,s&&m.setAttribute("nonce",s),document.head.appendChild(m),c)return new Promise((b,g)=>{m.addEventListener("load",b),m.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${d}`)));})}));}function i(a){const s=new Event("vite:preloadError",{cancelable:true});if(s.payload=a,window.dispatchEvent(s),!s.defaultPrevented)throw a}return o.then(a=>{for(const s of a||[])s.status==="rejected"&&i(s.reason);return t().catch(i)})},pl={BOTTOM:0,MID:1,TOP:2,EXPRESSION:3},Ap=["Bottom_DefaultGray.png","Mid_DefaultGray.png","Top_DefaultGray.png","Expression_Default.png"];async function Jy(){try{const{Store:e}=await Pn(async()=>{const{Store:o}=await Promise.resolve().then(()=>xs);return {Store:o}},void 0),t=await e.select("myDataAtom");if(!t||typeof t!="object")throw new Error("myDataAtom not available");const n=t.cosmetic,r=t.name;return {avatar:n?.avatar||[...Ap],color:n?.color||"Red",name:r||"Player"}}catch(e){return console.error("[Avatar] Failed to get current avatar state:",e),{avatar:[...Ap],color:"Red",name:"Player"}}}function Qy(e,t){const n=t?[...t]:[...Ap];return e.bottom&&(n[pl.BOTTOM]=e.bottom),e.mid&&(n[pl.MID]=e.mid),e.top&&(n[pl.TOP]=e.top),e.expression&&(n[pl.EXPRESSION]=e.expression),n}const Zy="Expression_Stressed.png";function JE(){try{return Array.from(he.document.querySelectorAll("script")).find(r=>r.src.includes("/version/"))?.src.match(/\/version\/([^/]+)\//)?.[1]||"669ccaa"}catch(e){return console.error("[Avatar API] Failed to get version hash:",e),"669ccaa"}}function QE(){return he.location.pathname.split("/").pop()||"UNKNOWN"}async function ZE(){try{const e=JE(),t=QE(),n=`https://magicgarden.gg/version/${e}/api/rooms/${t}/me/cosmetics`,r=await fetch(n,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error(`HTTP ${r.status}`);return await r.json()}catch(e){return console.error("[Avatar API] Failed to fetch owned cosmetics:",e),[]}}function wu(){return  false}const $r={ownedFilenames:new Set,loaded:false,error:null},eT=[];function Cu(){eT.forEach(e=>e());}async function ex(){try{await jf();const{Store:e}=await Pn(async()=>{const{Store:r}=await Promise.resolve().then(()=>xs);return {Store:r}},void 0);if(!await e.select("isUserAuthenticatedAtom")){$r.loaded=!0,Cu();return}const n=await ZE();$r.ownedFilenames=new Set(n.map(r=>r.cosmeticFilename)),$r.loaded=!0,$r.error=null,Cu();}catch(e){$r.error=e,$r.loaded=true,Cu();}}function tT(e){return $r.ownedFilenames.has(e)}function nT(){return $r.loaded}const Ep=[];let vm=false,ym=false;function rT(){ym||(ym=true,sT().then(()=>{}).catch(()=>{}));}rT();let xm=false;async function oT(){xm||(await ex(),xm=true);}function $o(){try{const t=Array.from(he.document.querySelectorAll("script")).find(n=>n.src.includes("/version/"));if(t){const n=t.src.match(/(https:\/\/.+?\/version\/[^/]+)/);if(n)return `${n[1]}/assets/cosmetic/`}return console.warn("[Avatar] Could not find versioned asset path, using fallback"),`${he.location.origin}/assets/cosmetic/`}catch(e){return console.error("[Avatar] Failed to get asset base URL:",e),"https://magicgarden.gg/assets/cosmetic/"}}function iT(e,t){if(!t)return e;let n=e;if(t.type){const r=Array.isArray(t.type)?t.type:[t.type];n=n.filter(o=>r.includes(o.type));}if(t.availability){const r=Array.isArray(t.availability)?t.availability:[t.availability];n=n.filter(o=>r.includes(o.availability));}if(t.search){const r=t.search.toLowerCase();n=n.filter(o=>o.displayName.toLowerCase().includes(r));}return n}function aT(e,t){return t?.includeUnowned?e:e.filter(n=>n.availability==="default"?true:tT(n.filename))}async function sT(){if(!vm)try{const e=$o(),t=e.replace(/\/cosmetic\/$/,"/manifest.json"),n=await fetch(t);if(!n.ok)return;const i=((await n.json())?.bundles||[]).find(s=>s.name==="cosmetic"||s.name==="cosmetics");if(!i)return;const a=new Set(Yy.map(s=>s.filename));for(const s of i.assets||[])for(const l of s.src||[]){if(typeof l!="string")continue;const d=/^(cosmetic|cosmetics)\/(.+)\.png$/i.exec(l);if(!d)continue;const c=d[1],p=d[2],m=`${p}.png`;if(a.has(m))continue;const b=p.split("_");if(b.length<2)continue;const g=b[0],w=b.slice(1).join(" ").replace(/([a-z])([A-Z])/g,"$1 $2");Ep.push({id:m,filename:m,type:g,displayName:w,availability:"purchasable",price:0,url:`${e.replace(/\/cosmetic\/$/,`/${c}/`)}${m}`}),a.add(m);}vm=!0,console.log(`[Avatar] Discovered ${Ep.length} new items from manifest`);}catch(e){console.error("[Avatar] Discovery failed:",e);}}function Cs(e){const t=$o(),n=Ep.map(d=>({...d,url:d.url||`${t}${d.filename}`})),r=Yy.map(d=>({...d,url:`${t}${d.filename}`})),o=new Set,i=[];for(const d of n)o.has(d.filename)||(i.push(d),o.add(d.filename));for(const d of r)o.has(d.filename)||(i.push(d),o.add(d.filename));const s=[...[],...i];let l=iT(s,e);return l=aT(l,e),l}async function tx(e){return await oT(),Cs(e)}function lT(e){return Cs(e).map(t=>t.url)}async function gd(){const{avatar:e,color:t}=await Jy();return {top:e[2],mid:e[1],bottom:e[0],expression:e[3],color:t,array:e}}async function cT(){const e=await Jy(),t=await gd(),n=Cs(),r={};return n.forEach(o=>{r[o.type]=(r[o.type]||0)+1;}),{current:{avatar:e.avatar,color:e.color,parsed:{top:t.top,mid:t.mid,bottom:t.bottom,expression:t.expression}},counts:r,allItems:n,assetBaseUrl:$o()}}const dT="_Blank.png";let fl=null;function uT(){if(fl)return Promise.resolve(fl);const e=document.createElement("canvas");return e.width=1,e.height=1,new Promise((t,n)=>{e.toBlob(r=>{if(!r){n(new Error("[MGRiveLoader] Failed to create transparent PNG"));return}r.arrayBuffer().then(o=>{fl=new Uint8Array(o),t(fl);},n);},"image/png");})}async function Su(e,t,n){let r;if(t.includes(dT))r=await uT();else {const i=await fetch(`${n}${t}`).then(a=>a.arrayBuffer());r=new Uint8Array(i);}const o=await eh.decodeImage(r);e.setRenderImage(o),o.unref();}async function nx(e,t){const{imageAssets:n}=e,r=$o(),o=[];t.top&&n.Top&&o.push(Su(n.Top,t.top,r).catch(i=>console.warn("[MGRiveLoader] Failed to load Top:",i))),t.mid&&n.Mid&&o.push(Su(n.Mid,t.mid,r).catch(i=>console.warn("[MGRiveLoader] Failed to load Mid:",i))),t.bottom&&n.Bottom&&o.push(Su(n.Bottom,t.bottom,r).catch(i=>console.warn("[MGRiveLoader] Failed to load Bottom:",i))),await Promise.all(o);}async function pT(e){const{canvas:t,outfit:n,riveUrl:r,stateMachine:o="State Machine 1",autoplay:i=true}=e;let a=r;if(!a){const c=await Ky();if(!c)throw new Error("[MGRiveLoader] Could not find avatar .riv file");a=c.url;}console.log(`[MGRiveLoader] Creating Rive instance from: ${a}`);const s=await th(a),l=new eh.Rive({riveFile:s.riveFile,canvas:t,autoplay:i,stateMachines:o});if(console.log("[MGRiveLoader] Rive instance created"),await nx(s,n),n.expression&&n.expression!=="Expression_Blank.png"){const p=["Expression_Default.png","Expression_Alarmed.png","Expression_Annoyed.png","Expression_Bashful.png","Expression_Calm3.png","Expression_Crying.png","Expression_Cute.png","Expression_Derpy.png","Expression_Happy.png","Expression_Mad.png","Expression_Pouty.png","Expression_Shocked.png","Expression_Thinking.png","Expression_Tired.png","Expression_Loopy.png","Expression_SoHappy.png","Expression_Vampire.png","Expression_Stressed.png"].indexOf(n.expression);if(p!==-1&&l.stateMachineInputs("State Machine 1")){const m=l.stateMachineInputs("State Machine 1").find(b=>b.name==="expression");m&&(m.value=p,console.log(`[MGRiveLoader] Set expression: ${n.expression} (index ${p})`),l.drawFrame());}}return console.log("[MGRiveLoader] Outfit applied"),{rive:l,cacheEntry:s,outfit:{...n},play(){l.play();},pause(){l.pause();},triggerAnimation(c){const p=l.stateMachineInputs(o);if(!p)return  false;const m=p.find(b=>b.name===c);return m?(typeof m.fire=="function"?m.fire():m.value=true,true):false},randomAnimation(){const c=l.stateMachineInputs(o);if(!c||c.length===0)return  false;const p=c.filter(b=>typeof b.fire=="function");return p.length===0?false:(p[Math.floor(Math.random()*p.length)].fire(),true)},destroy(){l.cleanup();}}}async function fT(e,t){if(console.log("[MGRiveLoader] Updating outfit"),await nx(e.cacheEntry,t),t.expression&&t.expression!=="Expression_Blank.png"){const r=["Expression_Default.png","Expression_Alarmed.png","Expression_Annoyed.png","Expression_Bashful.png","Expression_Calm3.png","Expression_Crying.png","Expression_Cute.png","Expression_Derpy.png","Expression_Happy.png","Expression_Mad.png","Expression_Pouty.png","Expression_Shocked.png","Expression_Thinking.png","Expression_Tired.png","Expression_Loopy.png","Expression_SoHappy.png","Expression_Vampire.png","Expression_Stressed.png"].indexOf(t.expression);if(r!==-1&&e.rive.stateMachineInputs("State Machine 1")){const o=e.rive.stateMachineInputs("State Machine 1").find(i=>i.name==="expression");o&&(o.value=r,console.log(`[MGRiveLoader] Set expression: ${t.expression} (index ${r})`),e.rive.drawFrame());}}e.outfit={...t},console.log("[MGRiveLoader] Outfit updated");}let wm=false;async function hT(){if(!wm){wm=true;try{await Xy(),hm(!0),console.log("[MGRiveLoader] Initialized");}catch(e){throw console.error("[MGRiveLoader] Initialization failed:",e),hm(false),e}}}function gT(){return UE()}function mT(){return GE()}async function bT(e){return await th(e)}async function vT(){const e=await Ky();return e?await th(e.url):null}async function yT(e){return await pT(e)}async function xT(e,t){return await fT(e,t)}const _i={init:hT,isReady:gT,list:mT,getRiveFile:bT,getAvatarRiveFile:vT,createInstance:yT,updateOutfit:xT};function wT(){return {ready:false,baseUrl:null,urls:{ambience:new Map,music:new Map},sfx:{mp3Url:null,atlasUrl:null,atlas:null,groups:new Map,buffer:null},tracks:{ambience:null,music:null},customAudio:{current:null,onEnd:void 0},ctx:null}}const Oe=wT();function rx(){return Oe.ready}const Cm=he??window;async function ox(){const e=Oe.ctx;if(e)return e;const t=Cm.AudioContext||Cm.webkitAudioContext;if(!t)throw new Error("WebAudio not supported");const n=new t;return Oe.ctx=n,n}async function ix(){if(Oe.ctx&&Oe.ctx.state==="suspended")try{await Oe.ctx.resume();}catch{}}const CT={sfx:"soundEffectsVolume",music:"musicVolume",ambience:"ambienceVolume"},ST={sfx:"soundEffectsVolumeAtom",music:"musicVolumeAtom",ambience:"ambienceVolumeAtom"},Oa=.001,Fa=.2;function Sm(e,t=NaN){try{const n=localStorage.getItem(e);if(n==null)return t;let r;try{r=JSON.parse(n);}catch{r=n;}if(typeof r=="number"&&Number.isFinite(r))return r;if(typeof r=="string"){const o=parseFloat(r);if(Number.isFinite(o))return o}}catch{}return t}function es(e){const t=CT[e],n=ST[e];if(!t)return {atom:Fa,vol100:hl(Fa)};const r=Sm(t,NaN);if(Number.isFinite(r)){const i=nr(r,0,1);return {atom:i,vol100:hl(i)}}if(n){const i=Sm(n,NaN);if(Number.isFinite(i)){const a=nr(i,0,1);return {atom:a,vol100:hl(a)}}}const o=Fa;return {atom:o,vol100:hl(o)}}function kT(e){const t=Number(e);if(!Number.isFinite(t))return null;if(t<=0)return 0;const r=(nr(t,1,100)-1)/99;return Oa+r*(Fa-Oa)}function hl(e){const t=nr(Number(e),0,1);if(t<=Oa)return 0;const n=(t-Oa)/(Fa-Oa);return Math.round(1+n*99)}function ax(e,t){if(t==null)return es(e).atom;const n=kT(t);return n===null?es(e).atom:P1(n)}function _T(e){const t=new Map,n=(r,o)=>{t.has(r)||t.set(r,[]),t.get(r).push(o);};for(const r of Object.keys(e||{})){const o=/^(.*)_([A-Z])$/.exec(r);o?.[1]?n(o[1],r):n(r,r);}for(const[r,o]of Array.from(t.entries()))o.sort((i,a)=>i.localeCompare(a)),t.set(r,o);Oe.sfx.groups=t;}function AT(e){const t=Oe.sfx.atlas;if(!t)throw new Error("SFX atlas not loaded");if(t[e])return e;const n=Oe.sfx.groups.get(e);if(n?.length)return n[Math.random()*n.length|0];throw new Error(`Unknown sfx/group: ${e}`)}async function ET(){if(Oe.sfx.buffer)return Oe.sfx.buffer;if(!Oe.sfx.mp3Url)throw new Error("SFX mp3 url missing");const e=await ox();await ix();const n=await(await Nv(Oe.sfx.mp3Url)).arrayBuffer(),r=await new Promise((o,i)=>{const a=e.decodeAudioData(n,o,i);a?.then&&a.then(o,i);});return Oe.sfx.buffer=r,r}async function TT(e,t={}){if(!Oe.ready)throw new Error("MGAudio not ready yet");const n=String(e||"").trim();if(!n)throw new Error("Missing sfx name");const r=AT(n),o=Oe.sfx.atlas[r];if(!o)throw new Error(`Missing segment for sfx: ${r}`);const i=await ox();await ix();const a=await ET(),s=Math.max(0,+o.start||0),l=Math.max(s,+o.end||s),d=Math.max(.01,l-s),c=ax("sfx",t.volume),p=i.createGain();p.gain.value=c,p.connect(i.destination);const m=i.createBufferSource();return m.buffer=a,m.connect(p),m.start(0,s,d),{name:r,source:m,start:s,end:l,duration:d,volume:c}}const Ai={MAX_SOUNDS:50,MAX_SIZE_BYTES:250*1024},IT={sounds:[],itemCustomSounds:[],version:1},Jn={shop:{soundId:"default-notification",volume:80,mode:"one-shot"},pet:{soundId:"default-notification",volume:80,mode:"one-shot"},weather:{soundId:"default-notification",volume:80,mode:"one-shot"}};class nh extends Error{constructor(t){super(t),this.name="CustomSoundError";}}class PT extends nh{constructor(){super(`Maximum number of sounds reached (${Ai.MAX_SOUNDS})`),this.name="SoundLimitError";}}class MT extends nh{constructor(t){super(`Sound size (${Math.round(t/1024)}KB) exceeds limit (${Ai.MAX_SIZE_BYTES/1024}KB)`),this.name="SoundSizeError";}}class LT extends nh{constructor(t){super(`Sound not found: ${t}`),this.name="SoundNotFoundError";}}function RT(e){const t={sounds:e.sounds??[],itemCustomSounds:e.itemCustomSounds??[],version:e.version??1};return e.itemCustomSounds||rh(t),t}function md(){const e=tt(Jt.MODULE.AUDIO_CUSTOM_SOUNDS,IT);return RT(e)}function rh(e){rt(Jt.MODULE.AUDIO_CUSTOM_SOUNDS,e);}function km(){return md().sounds}function bd(e){const t=md();t.sounds=e,rh(t);}function vd(){return md().itemCustomSounds}function sx(e){const t=md();t.itemCustomSounds=e,rh(t);}function OT(e){const t={shop:{soundId:e.shop?.soundId??Jn.shop.soundId,volume:e.shop?.volume??Jn.shop.volume,mode:e.shop?.mode??Jn.shop.mode},pet:{soundId:e.pet?.soundId??Jn.pet.soundId,volume:e.pet?.volume??Jn.pet.volume,mode:e.pet?.mode??Jn.pet.mode},weather:{soundId:e.weather?.soundId??Jn.weather.soundId,volume:e.weather?.volume??Jn.weather.volume,mode:e.weather?.mode??Jn.weather.mode}};return t!==e&&ih(t),t}function oh(){const e=tt(Jt.MODULE.AUDIO_NOTIFICATION_SETTINGS,Jn);return OT(e)}function ih(e){rt(Jt.MODULE.AUDIO_NOTIFICATION_SETTINGS,e);}const FT="https://cdn.pixabay.com/audio/2025/05/31/audio_b2dfcd42bb.mp3",lx=[{id:"default-notification",name:"Default",source:FT,type:"upload",createdAt:0}];function NT(e){const t=new Set(e.map(r=>r.id)),n=lx.filter(r=>!t.has(r.id));return n.length===0?e:[...e,...n]}function cx(e){return lx.some(t=>t.id===e)}function DT(e){if(!e.startsWith("data:"))return 0;const n=e.indexOf(",");if(n===-1)return 0;const o=e.slice(n+1).length*3/4;return Math.round(o)}function dx(e){if(!e||!e.trim())throw new Error("Sound source cannot be empty");const t=DT(e);if(t>0&&t>Ai.MAX_SIZE_BYTES)throw new MT(t)}function ux(e){if(!e||!e.trim())throw new Error("Sound name cannot be empty");if(e.length>100)throw new Error("Sound name too long (max 100 characters)")}function $T(e){if(e>=Ai.MAX_SOUNDS)throw new PT}let In=[],Tp=false;function cr(){Tp||px();}function BT(){return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=Math.random()*16|0;return (e==="x"?t:t&3|8).toString(16)})}function px(){if(Tp)return;let e=km();e=NT(e),e.length!==km().length&&bd(e),In=e,Tp=true,console.log(`[CustomSounds] Initialized with ${In.length} sounds`);}function zT(){return cr(),[...In]}function fx(e){return cr(),In.find(t=>t.id===e)}function jT(e,t,n){cr(),ux(e),dx(t),$T(In.length);const r={id:BT(),name:e.trim(),source:t.trim(),type:n,createdAt:Date.now()};return In.push(r),bd(In),console.log(`[CustomSounds] Added sound: ${r.name} (${r.id})`),r}function GT(e){if(cr(),cx(e))throw new Error("Cannot remove default sounds");const t=In.findIndex(r=>r.id===e);if(t===-1)return  false;const n=In.splice(t,1)[0];return bd(In),console.log(`[CustomSounds] Removed sound: ${n.name} (${n.id})`),true}function HT(e,t){if(cr(),cx(e))throw new Error("Cannot update default sounds");const n=In.find(r=>r.id===e);return n?(t.name!==void 0&&(ux(t.name),n.name=t.name.trim()),t.source!==void 0&&(dx(t.source),n.source=t.source.trim()),bd(In),console.log(`[CustomSounds] Updated sound: ${n.name} (${n.id})`),true):false}async function UT(e,t={}){cr();const n=fx(e);if(!n)throw new LT(e);const{MGAudio:r}=await Pn(async()=>{const{MGAudio:o}=await Promise.resolve().then(()=>bx);return {MGAudio:o}},void 0);try{await r.playCustom(n.source,{volume:t.volume??.5,loop:t.loop??!1}),console.log(`[CustomSounds] Playing: ${n.name} (${n.id})`);}catch(o){throw console.error(`[CustomSounds] Failed to play ${n.name}:`,o),o}}function WT(){Pn(async()=>{const{MGAudio:e}=await Promise.resolve().then(()=>bx);return {MGAudio:e}},void 0).then(({MGAudio:e})=>{e.stopCustom(),console.log("[CustomSounds] Stopped current sound");});}function VT(){return oh()}function qT(e){return oh()[e]}function XT(e,t){const n=oh();n[e]=t,ih(n),console.log(`[CustomSounds] Updated notification config for ${e}:`,t);}function KT(e){ih(e),console.log("[CustomSounds] Updated all notification settings");}function Ei(e,t,n){return e==="shop"&&n?`${e}:${n}:${t}`:`${e}:${t}`}function hx(e,t,n){cr();const r=vd(),o=Ei(e,t,n);return r.find(i=>Ei(i.entityType,i.entityId,i.shopType)===o)??null}function YT(e,t,n,r){cr();const o=vd(),i=Ei(e,t,r),a=o.findIndex(l=>Ei(l.entityType,l.entityId,l.shopType)===i),s={entityType:e,entityId:t,shopType:r,soundId:n.soundId,volume:n.volume,mode:n.mode};a!==-1?o[a]=s:o.push(s),sx(o),console.log(`[CustomSounds] Set custom sound for ${e}:${t}`,n),window.dispatchEvent(new CustomEvent(xt.CUSTOM_SOUND_CHANGE,{detail:{action:"set",entityType:e,entityId:t,shopType:r,config:n}}));}function JT(e,t,n){cr();const r=vd(),o=Ei(e,t,n),i=r.findIndex(a=>Ei(a.entityType,a.entityId,a.shopType)===o);return i===-1?false:(r.splice(i,1),sx(r),console.log(`[CustomSounds] Removed custom sound for ${e}:${t}`),window.dispatchEvent(new CustomEvent(xt.CUSTOM_SOUND_CHANGE,{detail:{action:"remove",entityType:e,entityId:t,shopType:n}})),true)}function QT(e,t,n){return hx(e,t,n)!==null}function ZT(e){return cr(),vd().filter(n=>n.entityType===e)}const Ne={init:px,getAll:zT,getById:fx,add:jT,remove:GT,update:HT,play:UT,stop:WT,getNotificationSettings:VT,getNotificationConfig:qT,setNotificationConfig:XT,setNotificationSettings:KT,getItemCustomSound:hx,setItemCustomSound:YT,removeItemCustomSound:JT,hasItemCustomSound:QT,getItemCustomSoundsByType:ZT};let gl=null;async function eI(){return Oe.ready?true:gl||(gl=(async()=>{Oe.baseUrl=await Fo.base();const e=await Sr.load({baseUrl:Oe.baseUrl}),t=Sr.getBundle(e,"audio");if(!t)throw new Error("No audio bundle in manifest");for(const n of t.assets||[])for(const r of n.src||[]){if(typeof r!="string")continue;const o=/^audio\/(ambience|music)\/(.+)\.mp3$/i.exec(r);if(o){const i=o[1].toLowerCase(),a=o[2];Oe.urls[i].set(a,Cr(Oe.baseUrl,r));continue}/^audio\/sfx\/sfx\.mp3$/i.test(r)&&(Oe.sfx.mp3Url=Cr(Oe.baseUrl,r)),/^audio\/sfx\/sfx\.json$/i.test(r)&&(Oe.sfx.atlasUrl=Cr(Oe.baseUrl,r));}if(!Oe.sfx.atlasUrl)throw new Error("Missing audio/sfx/sfx.json in manifest");return Oe.sfx.atlas=await Ff(Oe.sfx.atlasUrl),_T(Oe.sfx.atlas),Ne.init(),Oe.ready=true,true})(),gl)}function gx(e){if(e!=="music"&&e!=="ambience")return  false;const t=Oe.tracks[e];if(t){try{t.pause();}catch{}try{t.src="";}catch{}}return Oe.tracks[e]=null,true}function tI(e,t,n={}){if(!Oe.ready)throw new Error("MGAudio not ready yet");if(e!=="music"&&e!=="ambience")throw new Error(`Invalid category: ${e}`);const r=Oe.urls[e].get(t);if(!r)throw new Error(`Unknown ${e}: ${t}`);gx(e);const o=new Audio(r);return o.loop=!!n.loop,o.volume=ax(e,n.volume),o.preload="auto",o.play().catch(()=>{}),Oe.tracks[e]=o,o}function nI(e,t={}){const n=String(e||"").trim();return n==="music"||n==="ambience"?Array.from(Oe.urls[n].keys()).sort():n==="sfx"?Oe.sfx.atlas?t.groups?Array.from(Oe.sfx.groups.keys()).sort():Object.keys(Oe.sfx.atlas).sort():[]:[]}function rI(){return ["sfx","music","ambience"]}function oI(){return Array.from(Oe.sfx.groups.keys()).sort((e,t)=>e.localeCompare(t))}function iI(e,t){const n=String(e||"").trim().toLowerCase(),r=String(t||"").trim();if(!r||n!=="music"&&n!=="ambience")return  false;const o=Oe.urls[n],i=r.toLowerCase();for(const a of Array.from(o.keys()))if(a.toLowerCase()===i)return  true;return  false}function aI(e){const t=String(e||"").trim();if(!t)return  false;const n=t.toLowerCase();for(const r of Array.from(Oe.sfx.groups.keys()))if(r.toLowerCase()===n)return  true;return  false}function sI(e,t){const n=String(e||"").trim().toLowerCase(),r=String(t||"").trim();if(!r)throw new Error("getTrackUrl(category, name) missing name");if(n!=="music"&&n!=="ambience")throw new Error(`Invalid category: ${e}`);const o=Oe.urls[n],i=r.toLowerCase();for(const[a,s]of Array.from(o.entries()))if(a.toLowerCase()===i)return s;return null}function lI(){return Oe.tracks.music&&(Oe.tracks.music.volume=es("music").atom),Oe.tracks.ambience&&(Oe.tracks.ambience.volume=es("ambience").atom),true}let gn=null;async function cI(e,t={}){mx();const n=new Audio(e);n.volume=t.volume??1,n.loop=t.loop??false,n.preload="auto";const r={audio:n,url:e,stop:()=>{n.loop?n.loop=false:(n.pause(),n.currentTime=0,gn?.audio===n&&(gn=null));},setVolume:o=>{n.volume=Math.max(0,Math.min(1,o));},isPlaying:()=>!n.paused&&!n.ended};gn=r;try{await new Promise((o,i)=>{const a=setTimeout(()=>{i(new Error("Audio load timeout"));},5e3),s=()=>{clearTimeout(a),n.removeEventListener("canplay",l),n.removeEventListener("error",d);},l=()=>{s(),o();},d=()=>{s(),i(new Error(`Audio load error: ${n.error?.message}`));};n.readyState>=2?(clearTimeout(a),o()):(n.addEventListener("canplay",l,{once:!0}),n.addEventListener("error",d,{once:!0}));}),await n.play();}catch(o){throw gn=null,o}return n.addEventListener("ended",()=>{gn?.audio===n&&(gn=null);}),r}function mx(){return gn?(gn.stop(),gn=null,true):false}function dI(e){return gn?(gn.setVolume(e),true):false}function uI(){return gn?.isPlaying()??false}function pI(){return gn}function sn(){if(!rx())throw new Error("MGAudio not ready yet")}async function fI(e,t,n={}){const r=String(e||"").trim(),o=String(t||"").trim();if(!r||!o)throw new Error("play(category, asset) missing args");if(r==="sfx")return TT(o,n);if(r==="music"||r==="ambience")return tI(r,o,n);throw new Error(`Unknown category: ${r}`)}const Et={init:eI,isReady:rx,play:fI,stop:e=>(sn(),gx(e)),list:(e,t)=>(sn(),nI(e,t)),refreshVolumes:()=>(sn(),lI()),categoryVolume:e=>(sn(),es(e)),getCategories:()=>(sn(),rI()),getGroups:()=>(sn(),oI()),hasTrack:(e,t)=>(sn(),iI(e,t)),hasGroup:e=>(sn(),aI(e)),getTrackUrl:(e,t)=>(sn(),sI(e,t)),playCustom:async(e,t)=>(sn(),cI(e,t)),stopCustom:()=>(sn(),mx()),setCustomVolume:e=>(sn(),dI(e)),isCustomPlaying:()=>(sn(),uI()),getCustomHandle:()=>(sn(),pI()),CustomSounds:Ne},bx=Object.freeze(Object.defineProperty({__proto__:null,MGAudio:Et},Symbol.toStringTag,{value:"Module"}));function hI(){return {ready:false,baseUrl:null,byCat:new Map,byBase:new Map,overlay:null,live:new Set,defaultParent:null}}const dt=hI();function vx(){return dt.ready}let ml=null;async function gI(){return dt.ready?true:ml||(ml=(async()=>{dt.baseUrl=await Fo.base();const e=await Sr.load({baseUrl:dt.baseUrl}),t=Sr.getBundle(e,"cosmetic");if(!t)throw new Error("No 'cosmetic' bundle in manifest");dt.byCat.clear(),dt.byBase.clear();for(const n of t.assets||[])for(const r of n.src||[]){if(typeof r!="string"||!/^cosmetic\/.+\.png$/i.test(r))continue;const i=r.split("/").pop().replace(/\.png$/i,""),a=i.indexOf("_");if(a<0)continue;const s=i.slice(0,a),l=i.slice(a+1),d=Cr(dt.baseUrl,r);dt.byBase.set(i,d),dt.byCat.has(s)||dt.byCat.set(s,new Map),dt.byCat.get(s).set(l,d);}return dt.ready=true,true})(),ml)}function Ip(e){let t=String(e||"").trim();return t?(t=t.replace(/^cosmetic\//i,""),t=t.replace(/\.png$/i,""),t):""}function mI(e,t){if(t===void 0){const i=Ip(e),a=i.indexOf("_");return a<0?{cat:"",asset:i,base:i}:{cat:i.slice(0,a),asset:i.slice(a+1),base:i}}const n=String(e||"").trim(),r=Ip(t),o=r.includes("_")?r:`${n}_${r}`;if(r.includes("_")&&!n){const i=r.indexOf("_");return {cat:r.slice(0,i),asset:r.slice(i+1),base:r}}return {cat:n,asset:r.replace(/^.+?_/,""),base:o}}function bI(){return Array.from(dt.byCat.keys()).sort((e,t)=>e.localeCompare(t))}function vI(e){const t=dt.byCat.get(String(e||"").trim());return t?Array.from(t.keys()).sort((n,r)=>n.localeCompare(r)):[]}function Pp(e,t){const{cat:n,asset:r,base:o}=mI(e,t),i=dt.byBase.get(o);if(i)return i;const s=dt.byCat.get(n)?.get(r);if(s)return s;if(!dt.baseUrl)throw new Error("MGCosmetic not initialized");if(!o)throw new Error("Invalid cosmetic name");return Cr(dt.baseUrl,`cosmetic/${o}.png`)}const _m=he?.document??document;function yI(){if(dt.overlay)return dt.overlay;const e=_m.createElement("div");return e.id="MG_COSMETIC_OVERLAY",e.style.cssText=["position:fixed","left:0","top:0","width:100vw","height:100vh","pointer-events:none","z-index:99999999"].join(";"),_m.documentElement.appendChild(e),dt.overlay=e,e}function xI(){const e=dt.defaultParent;if(!e)return null;try{return typeof e=="function"?e():e}catch{return null}}function wI(e){return dt.defaultParent=e,true}const CI=he?.document??document;function Mp(e,t,n){if(!dt.ready)throw new Error("MGCosmetic not ready yet");let r,o;typeof t=="object"&&t!==null?(r=t,o=void 0):typeof t=="string"?(o=t,r=n||{}):(o=void 0,r=n||{});const i=o!==void 0?Pp(e,o):Pp(e),a=CI.createElement("img");if(a.decoding="async",a.loading="eager",a.src=i,a.alt=r.alt!=null?String(r.alt):Ip(o??e),r.className&&(a.className=String(r.className)),r.width!=null&&(a.style.width=String(r.width)),r.height!=null&&(a.style.height=String(r.height)),r.opacity!=null&&(a.style.opacity=String(r.opacity)),r.style&&typeof r.style=="object")for(const[s,l]of Object.entries(r.style))try{a.style[s]=String(l);}catch{}return a}function SI(e,t,n){let r,o;typeof t=="object"&&t!==null?(r=t,o=void 0):typeof t=="string"?(o=t,r=n||{}):(o=void 0,r=n||{});const i=r.parent||xI()||yI(),a=o!==void 0?Mp(e,o,r):Mp(e,r);if(i===dt.overlay||r.center||r.x!=null||r.y!=null||r.absolute){a.style.position="absolute",a.style.pointerEvents="none",a.style.zIndex=String(r.zIndex??999999);const l=r.scale??1,d=r.rotation??0;if(r.center)a.style.left="50%",a.style.top="50%",a.style.transform=`translate(-50%, -50%) scale(${l}) rotate(${d}rad)`;else {const c=r.x??innerWidth/2,p=r.y??innerHeight/2;a.style.left=`${c}px`,a.style.top=`${p}px`,a.style.transform=`scale(${l}) rotate(${d}rad)`,r.anchor==="center"&&(a.style.transform=`translate(-50%, -50%) scale(${l}) rotate(${d}rad)`);}}return i.appendChild(a),dt.live.add(a),a.__mgDestroy=()=>{try{a.remove();}catch{}dt.live.delete(a);},a}function kI(){for(const e of Array.from(dt.live))e.__mgDestroy?.();}const _I=100,ku=[];function Lp(e,t,n){let r="";if(n&&typeof n=="object"){if(t==="PartialState"){const o=n.op||"",i=n.path||"";let a="";if("value"in n){const s=n.value;a=typeof s=="object"?`{${Object.keys(s||{}).slice(0,2).join(",")}}`:String(s);}if(o||i)r=`PartialState : ${o} ${i} ${a}`.trim();else {const s=Object.keys(n).filter(l=>l!=="type");s.length>0&&(r=`PartialState - {${s.join(", ")}}`);}}if(!r&&n.event&&(r+=`${n.event} `),!r&&n.op&&(r+=`op:${n.op} `),!r&&n.data){const o=Object.keys(n.data);o.length>0&&(r+=`{${o.slice(0,3).join(",")}${o.length>3?"...":""}}`);}else !r&&Array.isArray(n)&&(r+=`[${n.length} items]`);}else typeof n=="string"&&(r=n.slice(0,50));ku.push({direction:e,type:String(t),timestamp:Date.now(),payload:n,summary:r.trim()||"-"}),ku.length>_I&&ku.shift();}const ln={nativeCtor:null,captured:[],latestOpen:null},Am=Symbol.for("ariesmod.ws.capture.wrapped"),Em=Symbol.for("ariesmod.ws.capture.native"),yx=1;function Rp(e){return !!e&&e.readyState===yx}function AI(){if(Rp(ln.latestOpen))return ln.latestOpen;for(let e=ln.captured.length-1;e>=0;e--){const t=ln.captured[e];if(Rp(t))return t}return null}function EI(e,t){ln.captured.push(e),ln.captured.length>25&&ln.captured.splice(0,ln.captured.length-25);const n=()=>{ln.latestOpen=e,t&&console.log("[WS] captured socket opened",e.url);};e.addEventListener("open",n),e.addEventListener("close",()=>{ln.latestOpen===e&&(ln.latestOpen=null),t&&console.log("[WS] captured socket closed",e.url);}),e.addEventListener("message",r=>{try{const o=JSON.parse(r.data);Lp("in",o.type||"unknown",o);}catch{Lp("in","raw",r.data);}}),e.readyState===yx&&n();}function TI(e=he,t={}){const n=!!t.debug,r=e?.WebSocket;if(typeof r!="function")return ()=>{};if(r[Am])return ln.nativeCtor=r[Em]??ln.nativeCtor??null,()=>{};const o=r;ln.nativeCtor=o;function i(a,s){const l=s!==void 0?new o(a,s):new o(a);try{EI(l,n);}catch{}return l}try{i.prototype=o.prototype;}catch{}try{Object.setPrototypeOf(i,o);}catch{}try{i.CONNECTING=o.CONNECTING,i.OPEN=o.OPEN,i.CLOSING=o.CLOSING,i.CLOSED=o.CLOSED;}catch{}i[Am]=true,i[Em]=o;try{e.WebSocket=i,n&&console.log("[WS] WebSocket capture installed");}catch{return ()=>{}}return ()=>{try{e.WebSocket===i&&(e.WebSocket=o);}catch{}}}function II(e=he){const t=e?.MagicCircle_RoomConnection?.currentWebSocket;return t&&typeof t=="object"?t:null}function Nc(e=he){const t=AI();if(t)return {ws:t,source:"captured"};const n=II(e);return n?{ws:n,source:"roomConnection"}:{ws:null,source:null}}function xx(e,t={}){const n=t.pageWindow??he,r=t.intervalMs??500,o=!!t.debug;let i=null,a=null;const s=()=>{const d=Nc(n);(d.ws!==i||d.source!==a)&&(i=d.ws,a=d.source,o&&console.log("[WS] best socket changed:",d.source,d.ws),e(d));};s();const l=setInterval(s,r);return ()=>clearInterval(l)}function PI(e){if(typeof e=="string")return e;try{return JSON.stringify(e)}catch{return null}}function MI(e,t=he){const n=t?.MagicCircle_RoomConnection;if(n&&typeof n.sendMessage=="function")try{return Array.isArray(e)?n.sendMessage(...e):n.sendMessage(e),{ok:!0}}catch(i){return {ok:false,reason:"error",error:i}}const{ws:r}=Nc(t);if(!r)return {ok:false,reason:"no-ws"};if(!Rp(r))return {ok:false,reason:"not-open"};const o=PI(e);if(o==null)return {ok:false,reason:"error",error:new Error("Cannot stringify message")};try{const i=JSON.parse(o);Lp("out",i.type||"unknown",i);}catch{}try{return r.send(o),{ok:!0}}catch(i){return {ok:false,reason:"error",error:i}}}function LI(e,t={},n=he){return MI({type:e,...t},n)}const Ir={Welcome:"Welcome",PartialState:"PartialState",ServerErrorMessage:"ServerErrorMessage",Config:"Config",InappropriateContentRejected:"InappropriateContentRejected",Emote:"Emote",CurrencyTransaction:"CurrencyTransaction",Pong:"Pong"},ge={Chat:"Chat",Emote:"Emote",Wish:"Wish",KickPlayer:"KickPlayer",SetPlayerData:"SetPlayerData",UsurpHost:"UsurpHost",Dev:"Dev",SetSelectedGame:"SetSelectedGame",VoteForGame:"VoteForGame",RequestGame:"RequestGame",RestartGame:"RestartGame",Ping:"Ping",PlayerPosition:"PlayerPosition",Teleport:"Teleport",CheckWeatherStatus:"CheckWeatherStatus",MoveInventoryItem:"MoveInventoryItem",DropObject:"DropObject",PickupObject:"PickupObject",ToggleFavoriteItem:"ToggleFavoriteItem",PutItemInStorage:"PutItemInStorage",RetrieveItemFromStorage:"RetrieveItemFromStorage",MoveStorageItem:"MoveStorageItem",LogItems:"LogItems",PlantSeed:"PlantSeed",WaterPlant:"WaterPlant",HarvestCrop:"HarvestCrop",SellAllCrops:"SellAllCrops",PurchaseSeed:"PurchaseSeed",PurchaseEgg:"PurchaseEgg",PurchaseTool:"PurchaseTool",PurchaseDecor:"PurchaseDecor",PlantEgg:"PlantEgg",HatchEgg:"HatchEgg",PlantGardenPlant:"PlantGardenPlant",PotPlant:"PotPlant",MutationPotion:"MutationPotion",PickupDecor:"PickupDecor",PlaceDecor:"PlaceDecor",RemoveGardenObject:"RemoveGardenObject",PlacePet:"PlacePet",FeedPet:"FeedPet",PetPositions:"PetPositions",SwapPet:"SwapPet",StorePet:"StorePet",NamePet:"NamePet",SellPet:"SellPet",ReportSpeakingStart:"ReportSpeakingStart"};var Gn=(e=>(e[e.ReconnectInitiated=4100]="ReconnectInitiated",e[e.PlayerLeftVoluntarily=4200]="PlayerLeftVoluntarily",e[e.UserSessionSuperseded=4250]="UserSessionSuperseded",e[e.ConnectionSuperseded=4300]="ConnectionSuperseded",e[e.ServerDisposed=4310]="ServerDisposed",e[e.HeartbeatExpired=4400]="HeartbeatExpired",e[e.PlayerKicked=4500]="PlayerKicked",e[e.VersionMismatch=4700]="VersionMismatch",e[e.VersionExpired=4710]="VersionExpired",e[e.AuthenticationFailure=4800]="AuthenticationFailure",e))(Gn||{});new Set(Object.values(Ir));new Set(Object.values(ge));const RI=["Room","Quinoa"],OI={Room:["Room"],Quinoa:RI};function De(e,t={},n=he){const r=t,{scopePath:o,scope:i,...a}=r,s=typeof o=="string"?o:i,l=Array.isArray(o)?o:s==="Room"||s==="Quinoa"?OI[s]:null;return LI(e,l?{scopePath:l,...a}:a,n)}function FI(e,t=he){return De(ge.Chat,{scope:"Room",message:e},t)}function NI(e,t=he){return De(ge.Emote,{scope:"Room",emoteType:e},t)}function DI(e,t=he){return De(ge.Wish,{scope:"Quinoa",wish:e},t)}function $I(e,t=he){return De(ge.KickPlayer,{scope:"Room",playerId:e},t)}function yd(e,t=he){console.log("[Gemini][WS] setPlayerData:",e);const{name:n,cosmetic:r}=e;return De(ge.SetPlayerData,{scope:"Room",name:n,cosmetic:r},t)}function BI(e=he){return De(ge.UsurpHost,{scope:"Quinoa"},e)}function zI(e=he){return De(ge.ReportSpeakingStart,{scope:"Quinoa"},e)}function jI(e,t=he){return De(ge.SetSelectedGame,{scope:"Room",gameId:e},t)}function GI(e,t=he){return De(ge.VoteForGame,{scope:"Room",gameId:e},t)}function HI(e,t=he){return De(ge.RequestGame,{scope:"Room",gameId:e},t)}function UI(e=he){return De(ge.RestartGame,{scope:"Room"},e)}function WI(e,t=he){return De(ge.Ping,{scope:"Quinoa",id:e},t)}function wx(e,t,n=he){return De(ge.PlayerPosition,{scope:"Quinoa",x:e,y:t},n)}const VI=wx;function qI(e,t,n=he){return De(ge.Teleport,{scope:"Quinoa",x:e,y:t},n)}function XI(e=he){return De(ge.CheckWeatherStatus,{scope:"Quinoa"},e)}function KI(e,t,n=he){return De(ge.MoveInventoryItem,{scope:"Quinoa",fromIndex:e,toIndex:t},n)}function YI(e,t=he){return De(ge.DropObject,{scope:"Quinoa",slotIndex:e},t)}function JI(e,t=he){return De(ge.PickupObject,{scope:"Quinoa",objectId:e},t)}function xd(e,t=he){return De(ge.ToggleFavoriteItem,{scope:"Quinoa",itemId:e},t)}function ah(e,t="PetHutch",n=he){return De(ge.PutItemInStorage,{scope:"Quinoa",itemId:e,storageId:t},n)}function sh(e,t="PetHutch",n=he){return De(ge.RetrieveItemFromStorage,{scope:"Quinoa",itemId:e,storageId:t},n)}function QI(e,t,n=he){return De(ge.MoveStorageItem,{scope:"Quinoa",fromIndex:e,toIndex:t},n)}function ZI(e=he){return De(ge.LogItems,{scope:"Quinoa"},e)}function eP(e,t,n,r=he){return De(ge.PlantSeed,{scope:"Quinoa",seedId:e,x:t,y:n},r)}function tP(e,t=he){return De(ge.WaterPlant,{scope:"Quinoa",plantId:e},t)}function nP(e,t=he){return De(ge.HarvestCrop,{scope:"Quinoa",cropId:e},t)}function rP(e=he){return De(ge.SellAllCrops,{scope:"Quinoa"},e)}function lh(e,t=he){return De(ge.PurchaseDecor,{scope:"Quinoa",decorId:e},t)}function ch(e,t=he){return De(ge.PurchaseEgg,{scope:"Quinoa",eggId:e},t)}function dh(e,t=he){return De(ge.PurchaseTool,{scope:"Quinoa",toolId:e},t)}function uh(e,t=he){return De(ge.PurchaseSeed,{scope:"Quinoa",species:e},t)}function oP(e,t,n,r=he){return De(ge.PlantEgg,{scope:"Quinoa",eggId:e,x:t,y:n},r)}function iP(e,t=he){return De(ge.HatchEgg,{scope:"Quinoa",eggId:e},t)}function aP(e,t,n,r=he){return De(ge.PlantGardenPlant,{scope:"Quinoa",plantId:e,x:t,y:n},r)}function sP(e,t,n=he){return De(ge.PotPlant,{scope:"Quinoa",plantId:e,potId:t},n)}function lP(e,t,n=he){return De(ge.MutationPotion,{scope:"Quinoa",potionId:e,targetId:t},n)}function cP(e,t=he){return De(ge.PickupDecor,{scope:"Quinoa",decorInstanceId:e},t)}function dP(e,t,n,r=he){return De(ge.PlaceDecor,{scope:"Quinoa",decorId:e,x:t,y:n},r)}function uP(e,t=he){return De(ge.RemoveGardenObject,{scope:"Quinoa",objectId:e},t)}function Cx(e,t={x:0,y:0},n="Dirt",r=0,o=he){return De(ge.PlacePet,{scope:"Quinoa",itemId:e,position:t,tileType:n,localTileIndex:r},o)}function pP(e,t,n=he){return De(ge.FeedPet,{scope:"Quinoa",petId:e,foodItemId:t},n)}function fP(e,t=he){return De(ge.PetPositions,{scope:"Quinoa",positions:e},t)}function Sx(e,t,n=he){return De(ge.SwapPet,{scope:"Quinoa",petSlotId:e,petInventoryId:t},n)}function kx(e,t=he){return De(ge.StorePet,{scope:"Quinoa",itemId:e},t)}function hP(e,t,n=he){return De(ge.NamePet,{scope:"Quinoa",petId:e,name:t},n)}function gP(e,t=he){return De(ge.SellPet,{scope:"Quinoa",petId:e},t)}async function _x(e){try{const t=await gd(),n=[e.bottom!==void 0?e.bottom:t.bottom,e.mid!==void 0?e.mid:t.mid,e.top!==void 0?e.top:t.top,e.expression!==void 0?e.expression:t.expression],r=e.color!==void 0?e.color:t.color,o=yd({cosmetic:{color:r,avatar:n}},he);return console.log("[Avatar] Set outfit:",{outfit:e,finalAvatar:n,result:o}),!0}catch(t){return console.error("[Avatar] Failed to set outfit:",t),false}}async function mP(){return _x({top:"Top_DefaultGray.png",mid:"Mid_DefaultGray.png",bottom:"Bottom_DefaultGray.png",expression:"Expression_Default.png",color:"Red"})}const va=new Map;function bP(e){if(va.has(e))return va.get(e);const t=new Promise((n,r)=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>n(o),o.onerror=()=>{va.delete(e),r(new Error(`Failed to load image: ${e}`));},o.src=e;});return va.set(e,t),t}function vP(){va.clear();}function yP(e){return Cs().find(r=>r.filename===e)?.url||""}async function xP(e,t={}){const n=document.createElement("canvas"),r=t.width||400,o=t.height||400,i=t.scale||1;n.width=r*i,n.height=o*i;const a=n.getContext("2d");if(!a)throw new Error("Failed to get canvas 2D context");if(a.imageSmoothingEnabled=i!==1,e.color){const c={Red:"#FF0000",Blue:"#0000FF",Green:"#00FF00",Yellow:"#FFFF00",Purple:"#800080",Orange:"#FFA500",Pink:"#FFC0CB",Brown:"#A52A2A"};a.fillStyle=c[e.color]||"#FF0000",a.fillRect(0,0,n.width,n.height);}const l=[e.bottom,e.mid,e.top,e.expression].filter(c=>!!c).map(c=>yP(c));return (await Promise.all(l.map(c=>bP(c)))).forEach(c=>{a.drawImage(c,0,0,n.width,n.height);}),n}let ph=null,ci=null,go=null,zr=null;function _u(e){return $o()+e}async function wP(e){try{const{Store:t}=await Pn(async()=>{const{Store:a}=await Promise.resolve().then(()=>xs);return {Store:a}},void 0),n=await t.select("myDataAtom"),r=n?.cosmetic?.avatar||[],o=Qy(e,r),i=e.color||n?.cosmetic?.color||"Red";return ph={avatar:o,color:i},SP(),kP(o),console.log("[Avatar] Rendered avatar override:",o),!0}catch(t){return console.error("[Avatar] Failed to render avatar:",t),false}}async function CP(){ph=null,ci&&(clearInterval(ci),ci=null),go&&(go.disconnect(),go=null);const e=he.document;return e.querySelectorAll("[data-gemini-avatar-overridden]").forEach(t=>{t.removeAttribute("data-gemini-avatar-overridden");}),e.querySelectorAll(".gemini-avatar-overlay").forEach(t=>t.remove()),e.querySelectorAll("img[data-gemini-override]").forEach(t=>{t.removeAttribute("data-gemini-override");}),zr&&(zr.remove(),zr=null),console.log("[Avatar] Cleared override"),true}function SP(){if(zr)return;const e=he.document;zr=e.createElement("style"),zr.id="gemini-avatar-override-styles",zr.textContent=`
        [data-gemini-avatar-overridden="true"] canvas {
            opacity: 0 !important;
            visibility: hidden !important;
        }

        .gemini-avatar-overlay {
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            pointer-events: none !important;
            z-index: 9999 !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }

        .gemini-avatar-overlay img {
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            object-fit: contain !important;
        }
    `,e.head.appendChild(zr);}function kP(e){ci&&clearInterval(ci),go&&go.disconnect();const t=he.document,n=()=>{const o=t.querySelectorAll(".Avatar");let i=0;o.forEach(a=>{const s=Array.from(a.querySelectorAll("img"));if(s.length===4){let d=false;s.forEach((c,p)=>{const m=_u(e[p]);c.src!==m&&(d=true);}),d&&(s.forEach((c,p)=>{c.src=_u(e[p]),c.setAttribute("data-gemini-override",e[p]);}),i++);return}if(a.querySelector("canvas")&&!a.querySelector(".gemini-avatar-overlay")){a.setAttribute("data-gemini-avatar-overridden","true");const d=t.createElement("div");d.className="gemini-avatar-overlay",e.forEach(c=>{const p=t.createElement("img");p.src=_u(c),p.setAttribute("data-gemini-cosmetic",c),d.appendChild(p);}),window.getComputedStyle(a).position==="static"&&(a.style.position="relative"),a.appendChild(d),i++;}}),i>0&&console.log(`[Avatar] Re-applied ${i} override(s) (React reverted)`);};n(),ci=setInterval(n,500),go=new MutationObserver(()=>{setTimeout(n,10);});const r=t.querySelector(".game-root")||t.querySelector("#root")||t.body;go.observe(r,{childList:true,subtree:true,attributeFilter:["src"]}),console.log("[Avatar] Aggressive monitor started (500ms + MutationObserver)");}function _P(){return ph}function AP(e){if(!e)return  false;const t=e.toLowerCase();return t.includes("_blank")||t.includes("_none")||t===Zy.toLowerCase()}function EP(e){return e.some(AP)}let Dc=null,ni=null;he.Gemini_AvatarOverride=null;async function Ax(e){try{const{Store:t}=await Pn(async()=>{const{Store:w}=await Promise.resolve().then(()=>xs);return {Store:w}},void 0),{getPlayers:n}=await Pn(async()=>{const{getPlayers:w}=await Promise.resolve().then(()=>Fx);return {getPlayers:w}},void 0);wu();const i=n().get().myPlayer;if(!i)return console.error("[WorldAvatar] myPlayer not available"),!1;const a=i.id,s=i.cosmetic.avatar;he.MagicCircle_PlayerId=a,ni||(ni=[...s]);let l=Qy(e,s);const d=EP(l);wu(),Dc=l,he.Gemini_AvatarOverride=l,console.log("[WorldAvatar] Applying override:",l);const c=await t.select("stateAtom");if(!c?.data?.players)return console.error("[WorldAvatar] stateAtom.data.players not available"),!1;const p=c.data.players.findIndex(w=>w.id===a);if(p===-1)return console.error("[WorldAvatar] Current player not found in players array"),!1;const m=c.data.players[p],b=[...c.data.players];b[p]={...m,cosmetic:{...m.cosmetic,avatar:l}};const g={...c,data:{...c.data,players:b}};return await t.set("stateAtom",g),wu()&&d||yd({name:i.name,cosmetic:{...i.cosmetic,avatar:l}},he),!0}catch{return  false}}async function TP(){if(!Dc||!ni)return  true;try{const{Store:e}=await Pn(async()=>{const{Store:p}=await Promise.resolve().then(()=>xs);return {Store:p}},void 0),{getPlayers:t}=await Pn(async()=>{const{getPlayers:p}=await Promise.resolve().then(()=>Fx);return {getPlayers:p}},void 0);he.Gemini_AvatarOverride=null;const o=t().get().myPlayer;if(!o)return !1;const i=o.id,a=await e.select("stateAtom");if(!a?.data?.players)return !1;const s=a.data.players.findIndex(p=>p.id===i);if(s===-1)return !1;const l=a.data.players[s],d=[...a.data.players];d[s]={...l,cosmetic:{...l.cosmetic,avatar:ni}};const c={...a,data:{...a.data,players:d}};return await e.set("stateAtom",c),yd({name:o.name,cosmetic:{...o.cosmetic,avatar:ni}},he),Dc=null,ni=null,!0}catch{return  false}}function IP(){return Dc}let Kt=[];const Ql=[],Tm=()=>{Ql.forEach(e=>e([...Kt]));},_o={init(){Kt=tt(Jt.SECTION.AVATAR_LOADOUTS,[]);},get(){return [...Kt]},async save(e,t,n){if(!n){const i=Kt.find(a=>a.top===t.top&&a.mid===t.mid&&a.bottom===t.bottom&&a.expression===t.expression);if(i)return i.id}const r=n||Math.random().toString(36).substring(2,9),o={...t,id:r,name:e,createdAt:n&&Kt.find(i=>i.id===n)?.createdAt||Date.now()};if(n){const i=Kt.findIndex(a=>a.id===n);i!==-1?Kt[i]=o:Kt.push(o);}else Kt.push(o);return rt(Jt.SECTION.AVATAR_LOADOUTS,Kt),Tm(),r},delete(e){Kt=Kt.filter(t=>t.id!==e),rt(Jt.SECTION.AVATAR_LOADOUTS,Kt),Tm();},rename(e,t){const n=Kt.find(r=>r.id===e);n&&(n.name=t,rt(Jt.SECTION.AVATAR_LOADOUTS,Kt));},async wear(e){const t=Kt.find(r=>r.id===e);if(!t)return  false;const n={top:t.top,mid:t.mid,bottom:t.bottom,expression:t.expression};return await Ax(n)},subscribe(e){return Ql.push(e),()=>{const t=Ql.indexOf(e);t!==-1&&Ql.splice(t,1);}}},Ex={init:ex,isReady:()=>nT(),list:Cs,listAsync:tx,listUrls:lT,get:gd,debug:cT,set:_x,blank:mP,Loadouts:_o,toCanvas:xP,clearImageCache:vP,render:wP,clearOverride:CP,getOverride:_P,renderWorld:Ax,clearWorldOverride:TP,getWorldOverride:IP};function co(){if(!vx())throw new Error("MGCosmetic not ready yet")}const fh={init:gI,isReady:vx,categories:()=>(co(),bI()),list:e=>(co(),vI(e)),url:((e,t)=>(co(),Pp(e,t))),create:((e,t,n)=>(co(),Mp(e,t,n))),show:((e,t,n)=>(co(),SI(e,t,n))),attach:e=>(co(),wI(e)),clear:()=>(co(),kI()),Avatar:Ex},Im={Gold:25,Rainbow:50,Wet:2,Chilled:2,Frozen:10,Dawnlit:2,Dawnbound:3,Amberlit:5,Amberbound:6};function Tx(e){const t=we.get("mutations");if(!t)return Im[e]??null;const n=t[e];return !n||typeof n.coinMultiplier!="number"?Im[e]??null:n.coinMultiplier}const Au=new Map;function Eu(e){if(Au.has(e))return Au.get(e);const t=Tx(e)??1;return Au.set(e,t),t}const PP=new Set(["Gold","Rainbow"]),MP=new Set(["Wet","Chilled","Frozen","Dawnlit","Dawnbound","Amberlit","Amberbound"]);function hh(e){let t=1,n=0,r=0;for(const o of e)if(o==="Gold"||o==="Rainbow")o==="Rainbow"?t=Eu("Rainbow"):t===1&&(t=Eu("Gold"));else {const i=Eu(o);i>1&&(n+=i,r++);}return t*(1+n-r)}function LP(e){return Tx(e)}function RP(e){return PP.has(e)}function OP(e){return MP.has(e)}function FP(e){return OP(e)}function gh(e,t){const n=wd(e);if(!n)return 50;const r=n.maxScale;if(t<=1)return 50;if(t>=r)return 100;const o=(t-1)/(r-1);return Math.floor(50+50*o)}function zn(e,t,n){const r=wd(e);if(!r)return 0;const o=r.baseSellPrice,i=hh(n);return Math.round(o*t*i)}function NP(e,t,n){if(n>=t)return 100;if(n<=e)return 0;const r=t-e,o=n-e;return Math.floor(o/r*100)}function DP(e,t){return t>=e}function wd(e){const t=we.get("plants");if(!t)return null;const n=t[e];return n?.crop?{baseSellPrice:n.crop.baseSellPrice??0,maxScale:n.crop.maxScale??1,growTime:n.crop.growTime??0}:null}const Ix=3600,Tu=80,$P=100,ya=30;function Cd(e){return e/Ix}function Ss(e,t){const n=_s(e);if(!n)return Tu;const r=n.maxScale;if(t<=1)return Tu;if(t>=r)return $P;const o=(t-1)/(r-1);return Math.floor(Tu+20*o)}function ks(e,t,n){const r=_s(e);if(!r)return n-ya;const o=r.hoursToMature,i=t/Ix,a=ya/o,s=Math.min(a*i,ya),l=n-ya;return Math.floor(l+s)}function Sd(e,t){const n=_s(e);return n?t>=n.hoursToMature:false}function Px(e){const t=_s(e);return t?ya/t.hoursToMature:0}function BP(e,t,n){const r=t-e;return r<=0||n<=0?0:r/n}function _s(e){const t=we.get("pets");if(!t)return null;const n=t[e];return n?{hoursToMature:n.hoursToMature??0,maxScale:n.maxScale??1,abilities:n.abilities??[]}:null}function Mx(e,t){return t<=0?1:Math.min(1,e/t)}const Dt=3600,bl=80,Pm=100,rr=30,zP={Worm:30,Snail:60,Bee:15,Chicken:60,Bunny:45,Dragonfly:15,Pig:60,Cow:75,Turkey:60,SnowFox:45,Stoat:60,WhiteCaribou:75,Squirrel:30,Turtle:90,Goat:60,Butterfly:30,Peacock:60,Capybara:60};function As(e){const t=we.get("pets");if(!t)return null;const n=t[e];return n?{hoursToMature:n.hoursToMature??0,maxScale:n.maxScale??1}:null}function jP(e){return e/Dt}function Es(e,t){const n=As(e);if(!n)return bl;const{maxScale:r}=n;if(t<=1)return bl;if(t>=r)return Pm;const o=(t-1)/(r-1);return Math.floor(bl+(Pm-bl)*o)}function GP(e){return e-rr}function HP(e){const t=As(e);return !t||t.hoursToMature<=0?0:rr/t.hoursToMature}function Ts(e,t,n){const r=As(e);if(!r)return n-rr;const o=t/Dt,i=rr/r.hoursToMature,a=Math.min(i*o,rr),s=n-rr;return Math.floor(s+a)}function Lx(e,t,n){const r=As(e);if(!r)return 0;const o=n-rr,i=t-o;if(i<=0)return 0;const a=rr/r.hoursToMature;return a<=0?0:i/a*Dt}function mh(e,t,n,r,o=Dt){const a=Lx(e,n,r)-t;return a<=0?0:o<=0?1/0:a/o}function kd(e,t,n,r=Dt){return mh(e,t,n,n,r)}function bh(e,t,n,r,o=Dt){if(n>=r)return 0;const i=n+1;return mh(e,t,i,r,o)}function UP(e,t){return e>=t}function WP(e,t){const n=t-rr,o=(e-n)/rr*100;return Math.min(100,Math.max(0,o))}const VP=Object.freeze(Object.defineProperty({__proto__:null,calculateAge:jP,calculateCurrentStrength:Ts,calculateHoursToMaxStrength:kd,calculateHoursToNextStrength:bh,calculateHoursToStrength:mh,calculateMaxStrength:Es,calculateStartingStrength:GP,calculateStrengthPerHour:HP,calculateStrengthProgress:WP,calculateXpForStrength:Lx,getSpeciesData:As,isPetMature:UP},Symbol.toStringTag,{value:"Module"}));function vh(e){const t=we.get("pets");if(!t)return 100/24;const n=t[e];if(!n?.coinsToFullyReplenishHunger)return 100/24;const r=zP[e];return r?n.coinsToFullyReplenishHunger/r*60:(console.warn(`[Feed] Unknown species "${e}", using 60min default`),n.coinsToFullyReplenishHunger/60*60)}function qP(e,t){return e<=0?0:t<=0?1/0:e/t}function yh(e,t,n,r){if(e<=0||n<=0)return 0;const o=t/n;if(o>=e)return 0;const i=e-o,a=r/n;return Math.ceil(i/a)}function xh(e,t,n){const r=we.get("pets");if(!r)return 0;const o=r[e];if(!o?.coinsToFullyReplenishHunger)return 0;const i=o.coinsToFullyReplenishHunger,a=vh(e);return yh(n,t,a,i)}function ts(e,t,n){const r=we.get("pets");if(!r)return 0;const o=r[e];if(!o?.coinsToFullyReplenishHunger)return 0;const i=o.coinsToFullyReplenishHunger,a=vh(e);return yh(n,t,a,i)}function wh(e,t,n,r,o,i){return e?t&&i>0?ts(n,r,i):0:ts(n,r,o)}const XP=Object.freeze(Object.defineProperty({__proto__:null,calculateAdjustedFeedsToMax:wh,calculateFeedsForDuration:yh,calculateFeedsToMaxStrength:ts,calculateFeedsToNextStrength:xh,calculateHoursUntilStarving:qP,getHungerDrainPerHour:vh},Symbol.toStringTag,{value:"Module"})),Rx={init(){},isReady(){return  true},crop:{calculateSize:gh,calculateSellPrice:zn,calculateProgress:NP,isReady:DP,getData:wd},pet:{calculateAge:Cd,calculateMaxStrength:Ss,calculateCurrentStrength:ks,isMature:Sd,calculateStrengthPerHour:Px,getData:_s},mutation:{calculateMultiplier:hh,getValue:LP,isGrowth:RP,isEnvironmental:FP},xp:VP,feed:XP};function jn(e,t){if(e===t)return  true;if(e===null||t===null)return e===t;if(typeof e!=typeof t)return  false;if(typeof e!="object")return e===t;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return  false;for(let a=0;a<e.length;a++)if(!jn(e[a],t[a]))return  false;return  true}if(Array.isArray(e)||Array.isArray(t))return  false;const n=e,r=t,o=Object.keys(n),i=Object.keys(r);if(o.length!==i.length)return  false;for(const a of o)if(!Object.prototype.hasOwnProperty.call(r,a)||!jn(n[a],r[a]))return  false;return  true}const Mm={currentGardenTile:"myCurrentGardenTileAtom",globalTileIndex:"myCurrentGlobalTileIndexAtom",gardenObject:"myCurrentGardenObjectAtom",isMature:"isGardenObjectMatureAtom",isInMyGarden:"isInMyGardenAtom",gardenName:"currentGardenNameAtom",sortedSlotIndices:"myCurrentSortedGrowSlotIndicesAtom",currentGrowSlotIndex:"myCurrentGrowSlotIndexAtom"},Lm={position:{globalIndex:null,localIndex:null},tile:{type:null,isEmpty:true},garden:{name:null,isOwner:false,playerSlotIndex:null},object:{type:null,data:null,isMature:false},plant:null};function KP(e){const t=e.currentGardenTile;return {globalIndex:e.globalTileIndex,localIndex:t?.localTileIndex??null}}function YP(e){return {type:e.currentGardenTile?.tileType??null,isEmpty:e.gardenObject===null}}function JP(e){const t=e.currentGardenTile;return {name:e.gardenName,isOwner:e.isInMyGarden??false,playerSlotIndex:t?.userSlotIdx??null}}function QP(e){const t=e.gardenObject;return t?{type:t.objectType,data:t,isMature:e.isMature??false}:{type:null,data:null,isMature:false}}function ZP(e){const t=e.gardenObject;if(!t||t.objectType!=="plant")return null;const n=t,r=e.sortedSlotIndices??[];return {species:n.species,slots:n.slots??[],currentSlotIndex:e.currentGrowSlotIndex,sortedSlotIndices:r,nextHarvestSlotIndex:r.length>0?r[0]:null}}function Rm(e){return {position:KP(e),tile:YP(e),garden:JP(e),object:QP(e),plant:ZP(e)}}function Om(e){return JSON.stringify({globalIndex:e.position.globalIndex,localIndex:e.position.localIndex,tileType:e.tile.type,isEmpty:e.tile.isEmpty,gardenName:e.garden.name,isOwner:e.garden.isOwner,playerSlotIndex:e.garden.playerSlotIndex,objectType:e.object.type,isMature:e.object.isMature,plantSpecies:e.plant?.species??null,slotCount:e.plant?.slots.length??0})}function e2(e,t){return e.type!==t.type||e.isMature!==t.isMature?true:e.data===null&&t.data===null?false:e.data===null||t.data===null?true:!jn(e.data,t.data)}function t2(e,t){return e===null&&t===null?false:e===null||t===null||e.species!==t.species||e.currentSlotIndex!==t.currentSlotIndex||e.nextHarvestSlotIndex!==t.nextHarvestSlotIndex||e.slots.length!==t.slots.length||!jn(e.sortedSlotIndices,t.sortedSlotIndices)?true:!jn(e.slots,t.slots)}function n2(e,t){return e.name!==t.name||e.isOwner!==t.isOwner||e.playerSlotIndex!==t.playerSlotIndex}function r2(){let e=Lm,t=Lm,n=false;const r=[],o={all:new Set,stable:new Set,object:new Set,plantInfo:new Set,garden:new Set},i={},a=Object.keys(Mm),s=new Set;function l(){if(s.size<a.length)return;const c=Rm(i);if(!jn(e,c)&&(t=e,e=c,!!n)){for(const p of o.all)p(e,t);if(Om(t)!==Om(e))for(const p of o.stable)p(e,t);if(e2(t.object,e.object)){const p={current:e.object,previous:t.object};for(const m of o.object)m(p);}if(t2(t.plant,e.plant)){const p={current:e.plant,previous:t.plant};for(const m of o.plantInfo)m(p);}if(n2(t.garden,e.garden)){const p={current:e.garden,previous:t.garden};for(const m of o.garden)m(p);}}}async function d(){if(n)return;const c=a.map(async p=>{const m=Mm[p],b=await et.subscribe(m,g=>{i[p]=g,s.add(p),l();});r.push(b);});await Promise.all(c),n=true,s.size===a.length&&(e=Rm(i));}return d(),{get(){return e},subscribe(c,p){return o.all.add(c),p?.immediate!==false&&n&&s.size===a.length&&c(e,e),()=>o.all.delete(c)},subscribeStable(c,p){return o.stable.add(c),p?.immediate!==false&&n&&s.size===a.length&&c(e,e),()=>o.stable.delete(c)},subscribeObject(c,p){return o.object.add(c),p?.immediate&&n&&s.size===a.length&&c({current:e.object,previous:e.object}),()=>o.object.delete(c)},subscribePlantInfo(c,p){return o.plantInfo.add(c),p?.immediate&&n&&s.size===a.length&&c({current:e.plant,previous:e.plant}),()=>o.plantInfo.delete(c)},subscribeGarden(c,p){return o.garden.add(c),p?.immediate&&n&&s.size===a.length&&c({current:e.garden,previous:e.garden}),()=>o.garden.delete(c)},destroy(){for(const c of r)c();r.length=0,o.all.clear(),o.stable.clear(),o.object.clear(),o.plantInfo.clear(),o.garden.clear(),n=false;}}}let Iu=null;function mt(){return Iu||(Iu=r2()),Iu}function o2(){let e=null;const t=[],n=new Set,r={},o=new Set,i=2;function a(p,m){return {x:m%p,y:Math.floor(m/p)}}function s(p,m,b){return b*p+m}function l(p,m){const{cols:b,rows:g}=p,w=b*g,_=new Set,C=new Set,E=new Map,P=[],O=p.userSlotIdxAndDirtTileIdxToGlobalTileIdx??[],F=p.userSlotIdxAndBoardwalkTileIdxToGlobalTileIdx??[],A=Math.max(O.length,F.length);for(let S=0;S<A;S++){const R=O[S]??[],z=F[S]??[],j=R.map((U,ce)=>(_.add(U),E.set(U,S),{globalIndex:U,localIndex:ce,position:a(b,U)})),q=z.map((U,ce)=>(C.add(U),E.set(U,S),{globalIndex:U,localIndex:ce,position:a(b,U)}));P.push({userSlotIdx:S,dirtTiles:j,boardwalkTiles:q,allTiles:[...j,...q]});}const T=p.spawnTiles.map(S=>a(b,S)),M={};if(p.locations)for(const[S,R]of Object.entries(p.locations)){const z=R.spawnTileIdx??[];M[S]={name:S,spawnTiles:z,spawnPositions:z.map(j=>a(b,j))};}return {cols:b,rows:g,totalTiles:w,tileSize:m,spawnTiles:p.spawnTiles,spawnPositions:T,locations:M,userSlots:P,globalToXY(S){return a(b,S)},xyToGlobal(S,R){return s(b,S,R)},getTileOwner(S){return E.get(S)??null},isDirtTile(S){return _.has(S)},isBoardwalkTile(S){return C.has(S)}}}function d(){if(o.size<i||e)return;const p=r.map,m=r.tileSize??0;if(p){e=l(p,m);for(const b of n)b(e);n.clear();}}async function c(){const p=await et.subscribe("mapAtom",b=>{r.map=b,o.add("map"),d();});t.push(p);const m=await et.subscribe("tileSizeAtom",b=>{r.tileSize=b,o.add("tileSize"),d();});t.push(m);}return c(),{get(){return e},isReady(){return e!==null},onReady(p,m){return e?(m?.immediate!==false&&p(e),()=>{}):(n.add(p),()=>n.delete(p))},destroy(){for(const p of t)p();t.length=0,e=null,n.clear();}}}let Pu=null;function Op(){return Pu||(Pu=o2()),Pu}function i2(){const e=we.get("mutations");return e?Object.keys(e):[]}function Ox(){const e={};for(const t of i2())e[t]=[];return e}function Fp(){return {garden:null,mySlotIndex:null,plants:{all:[],mature:[],growing:[],bySpecies:{},count:0},crops:{all:[],mature:[],growing:[],mutated:{all:[],byMutation:Ox()}},eggs:{all:[],mature:[],growing:[],byType:{},count:0},decors:{tileObjects:[],boardwalk:[],all:[],byType:{},count:0},tiles:{tileObjects:[],boardwalk:[],empty:{tileObjects:[],boardwalk:[]}},counts:{plants:0,maturePlants:0,crops:0,matureCrops:0,eggs:0,matureEggs:0,decors:0,emptyTileObjects:0,emptyBoardwalk:0}}}function Fm(e){return JSON.stringify({plants:e.counts.plants,maturePlants:e.counts.maturePlants,crops:e.counts.crops,matureCrops:e.counts.matureCrops,eggs:e.counts.eggs,matureEggs:e.counts.matureEggs,decors:e.counts.decors,emptyTileObjects:e.counts.emptyTileObjects,emptyBoardwalk:e.counts.emptyBoardwalk})}function a2(e,t,n,r){const o=t.slots.filter(i=>r>=i.endTime).length;return {tileIndex:e,position:n,species:t.species,plantedAt:t.plantedAt,maturedAt:t.maturedAt,isMature:r>=t.maturedAt,slots:t.slots,slotsCount:t.slots.length,matureSlotsCount:o}}function s2(e,t,n,r,o){return {tileIndex:e,position:t,slotIndex:n,species:r.species,startTime:r.startTime,endTime:r.endTime,targetScale:r.targetScale,mutations:[...r.mutations],isMature:o>=r.endTime,fruitCount:1}}function l2(e,t,n,r){return {tileIndex:e,position:n,eggId:t.eggId,plantedAt:t.plantedAt,maturedAt:t.maturedAt,isMature:r>=t.maturedAt}}function Nm(e,t,n,r){return {tileIndex:e,position:n,decorId:t.decorId,rotation:t.rotation,location:r}}function Dm(e,t){const{garden:n,mySlotIndex:r}=e,o=Date.now();if(!n||r===null)return Fp();const i=t().get(),a=i?.userSlots[r],s=a?.dirtTiles??[],l=a?.boardwalkTiles??[],d=[],c=[],p=[],m={},b=[],g=[],w=[],_=[],C=Ox(),E=[],P=[],O=[],F={},A=[],T=[],M={},S=new Set,R=new Set;for(const[U,ce]of Object.entries(n.tileObjects)){const W=parseInt(U,10);S.add(W);const te=i?i.globalToXY(W):{x:0,y:0};if(ce.objectType==="plant"){const ne=ce,ie=a2(U,ne,te,o);d.push(ie),ie.isMature?c.push(ie):p.push(ie),m[ie.species]||(m[ie.species]=[]),m[ie.species].push(ie);for(let ee=0;ee<ne.slots.length;ee++){const H=ne.slots[ee],K=s2(U,te,ee,H,o);if(b.push(K),K.isMature?g.push(K):w.push(K),K.mutations.length>0){_.push(K);for(const D of K.mutations)C[D]||(C[D]=[]),C[D].push(K);}}}else if(ce.objectType==="egg"){const ie=l2(U,ce,te,o);E.push(ie),F[ie.eggId]||(F[ie.eggId]=[]),F[ie.eggId].push(ie),ie.isMature?P.push(ie):O.push(ie);}else if(ce.objectType==="decor"){const ie=Nm(U,ce,te,"tileObjects");A.push(ie),M[ie.decorId]||(M[ie.decorId]=[]),M[ie.decorId].push(ie);}}for(const[U,ce]of Object.entries(n.boardwalkTileObjects)){const W=parseInt(U,10);R.add(W);const te=i?i.globalToXY(W):{x:0,y:0},ie=Nm(U,ce,te,"boardwalk");T.push(ie),M[ie.decorId]||(M[ie.decorId]=[]),M[ie.decorId].push(ie);}const z=[...A,...T],j=s.filter(U=>!S.has(U.localIndex)),q=l.filter(U=>!R.has(U.localIndex));return {garden:n,mySlotIndex:r,plants:{all:d,mature:c,growing:p,bySpecies:m,count:d.length},crops:{all:b,mature:g,growing:w,mutated:{all:_,byMutation:C}},eggs:{all:E,mature:P,growing:O,byType:F,count:E.length},decors:{tileObjects:A,boardwalk:T,all:z,byType:M,count:z.length},tiles:{tileObjects:s,boardwalk:l,empty:{tileObjects:j,boardwalk:q}},counts:{plants:d.length,maturePlants:c.length,crops:b.length,matureCrops:g.length,eggs:E.length,matureEggs:P.length,decors:z.length,emptyTileObjects:j.length,emptyBoardwalk:q.length}}}function c2(e,t){const n=new Set(e.map(a=>a.tileIndex)),r=new Set(t.map(a=>a.tileIndex)),o=t.filter(a=>!n.has(a.tileIndex)),i=e.filter(a=>!r.has(a.tileIndex));return {added:o,removed:i}}function d2(e,t,n){const r=new Set(e.map(i=>i.tileIndex)),o=new Set(n.map(i=>i.tileIndex));return t.filter(i=>!r.has(i.tileIndex)&&o.has(i.tileIndex))}function u2(e,t,n){const r=new Set(e.map(i=>`${i.tileIndex}:${i.slotIndex}`)),o=new Set(n.map(i=>`${i.tileIndex}:${i.slotIndex}`));return t.filter(i=>{const a=`${i.tileIndex}:${i.slotIndex}`;return !r.has(a)&&o.has(a)})}function p2(e,t,n){const r=new Set(e.map(i=>i.tileIndex)),o=new Set(n.map(i=>i.tileIndex));return t.filter(i=>!r.has(i.tileIndex)&&o.has(i.tileIndex))}function f2(e,t){const n=[],r=new Map(e.map(o=>[o.tileIndex,o]));for(const o of t){const i=r.get(o.tileIndex);if(!i)continue;const a=Math.min(i.slots.length,o.slots.length);for(let s=0;s<a;s++){const l=new Set(i.slots[s].mutations),d=new Set(o.slots[s].mutations),c=[...d].filter(m=>!l.has(m)),p=[...l].filter(m=>!d.has(m));if(c.length>0||p.length>0){const m=Date.now(),b=o.slots[s],g={tileIndex:o.tileIndex,position:o.position,slotIndex:s,species:b.species,startTime:b.startTime,endTime:b.endTime,targetScale:b.targetScale,mutations:[...b.mutations],isMature:m>=b.endTime,fruitCount:1};n.push({crop:g,added:c,removed:p});}}}return n}function h2(e,t,n){const r=[],o=new Map(t.map(a=>[a.tileIndex,a])),i=new Map;for(const a of n)i.set(`${a.tileIndex}:${a.slotIndex}`,a);for(const a of e){const s=o.get(a.tileIndex);if(!s)continue;const l=Math.min(a.slots.length,s.slots.length);for(let d=0;d<l;d++){const c=a.slots[d],p=s.slots[d];if(c.startTime!==p.startTime){const m=i.get(`${a.tileIndex}:${d}`);if(!m||!m.isMature)continue;const b={tileIndex:a.tileIndex,position:a.position,slotIndex:d,species:c.species,startTime:c.startTime,endTime:c.endTime,targetScale:c.targetScale,mutations:[...c.mutations],isMature:true,fruitCount:1};r.push({crop:b,remainingSlots:s.slotsCount});}}if(s.slotsCount<a.slotsCount)for(let d=s.slotsCount;d<a.slotsCount;d++){const c=i.get(`${a.tileIndex}:${d}`);if(!c||!c.isMature)continue;const p=a.slots[d];if(!p)continue;const m={tileIndex:a.tileIndex,position:a.position,slotIndex:d,species:p.species,startTime:p.startTime,endTime:p.endTime,targetScale:p.targetScale,mutations:[...p.mutations],isMature:true,fruitCount:1};r.push({crop:m,remainingSlots:s.slotsCount});}}return r}function g2(e,t){const n=new Set(e.map(a=>a.tileIndex)),r=new Set(t.map(a=>a.tileIndex)),o=t.filter(a=>!n.has(a.tileIndex)),i=e.filter(a=>!r.has(a.tileIndex));return {added:o,removed:i}}function m2(e,t){const n=l=>`${l.tileIndex}:${l.location}`,r=l=>`${l.tileIndex}:${l.location}`,o=new Set(e.map(n)),i=new Set(t.map(r)),a=t.filter(l=>!o.has(r(l))),s=e.filter(l=>!i.has(n(l)));return {added:a,removed:s}}function b2(){let e=Fp(),t=Fp(),n=false;const r=[],o={all:new Set,stable:new Set,plantAdded:new Set,plantRemoved:new Set,plantMatured:new Set,cropMutated:new Set,cropMatured:new Set,cropHarvested:new Set,eggPlaced:new Set,eggRemoved:new Set,eggMatured:new Set,decorPlaced:new Set,decorRemoved:new Set},i={},a=new Set,s=2;function l(){if(a.size<s)return;const c=Dm(i,Op);if(jn(e,c)||(t=e,e=c,!n))return;for(const P of o.all)P(e,t);if(Fm(t)!==Fm(e))for(const P of o.stable)P(e,t);const p=c2(t.plants.all,e.plants.all);for(const P of p.added)for(const O of o.plantAdded)O({plant:P});for(const P of p.removed)for(const O of o.plantRemoved)O({plant:P,tileIndex:P.tileIndex});const m=d2(t.plants.mature,e.plants.mature,e.plants.all);for(const P of m)for(const O of o.plantMatured)O({plant:P});const b=f2(t.plants.all,e.plants.all);for(const P of b)for(const O of o.cropMutated)O(P);const g=u2(t.crops.mature,e.crops.mature,e.crops.all);for(const P of g)for(const O of o.cropMatured)O({crop:P});const w=h2(t.plants.all,e.plants.all,t.crops.all);for(const P of w)for(const O of o.cropHarvested)O(P);const _=g2(t.eggs.all,e.eggs.all);for(const P of _.added)for(const O of o.eggPlaced)O({egg:P});for(const P of _.removed)for(const O of o.eggRemoved)O({egg:P});const C=p2(t.eggs.mature,e.eggs.mature,e.eggs.all);for(const P of C)for(const O of o.eggMatured)O({egg:P});const E=m2(t.decors.all,e.decors.all);for(const P of E.added)for(const O of o.decorPlaced)O({decor:P});for(const P of E.removed)for(const O of o.decorRemoved)O({decor:P});}async function d(){if(n)return;const c=await LA.onChangeNow(m=>{i.garden=m,a.add("garden"),l();});r.push(c);const p=await et.subscribe("myUserSlotIdxAtom",m=>{i.mySlotIndex=m,a.add("mySlotIndex"),l();});r.push(p),n=true,a.size===s&&(e=Dm(i,Op));}return d(),{get(){return e},subscribe(c,p){return o.all.add(c),p?.immediate!==false&&n&&a.size===s&&c(e,e),()=>o.all.delete(c)},subscribeStable(c,p){return o.stable.add(c),p?.immediate!==false&&n&&a.size===s&&c(e,e),()=>o.stable.delete(c)},subscribePlantAdded(c,p){if(o.plantAdded.add(c),p?.immediate&&n&&a.size===s)for(const m of e.plants.all)c({plant:m});return ()=>o.plantAdded.delete(c)},subscribePlantRemoved(c,p){return o.plantRemoved.add(c),()=>o.plantRemoved.delete(c)},subscribePlantMatured(c,p){if(o.plantMatured.add(c),p?.immediate&&n&&a.size===s)for(const m of e.plants.mature)c({plant:m});return ()=>o.plantMatured.delete(c)},subscribeCropMutated(c,p){if(o.cropMutated.add(c),p?.immediate&&n&&a.size===s)for(const m of e.crops.mutated.all)c({crop:m,added:m.mutations,removed:[]});return ()=>o.cropMutated.delete(c)},subscribeCropMatured(c,p){if(o.cropMatured.add(c),p?.immediate&&n&&a.size===s)for(const m of e.crops.mature)c({crop:m});return ()=>o.cropMatured.delete(c)},subscribeCropHarvested(c,p){return o.cropHarvested.add(c),()=>o.cropHarvested.delete(c)},subscribeEggPlaced(c,p){if(o.eggPlaced.add(c),p?.immediate&&n&&a.size===s)for(const m of e.eggs.all)c({egg:m});return ()=>o.eggPlaced.delete(c)},subscribeEggRemoved(c,p){return o.eggRemoved.add(c),()=>o.eggRemoved.delete(c)},subscribeEggMatured(c,p){if(o.eggMatured.add(c),p?.immediate&&n&&a.size===s)for(const m of e.eggs.mature)c({egg:m});return ()=>o.eggMatured.delete(c)},subscribeDecorPlaced(c,p){if(o.decorPlaced.add(c),p?.immediate&&n&&a.size===s)for(const m of e.decors.all)c({decor:m});return ()=>o.decorPlaced.delete(c)},subscribeDecorRemoved(c,p){return o.decorRemoved.add(c),()=>o.decorRemoved.delete(c)},destroy(){for(const c of r)c();r.length=0,o.all.clear(),o.stable.clear(),o.plantAdded.clear(),o.plantRemoved.clear(),o.plantMatured.clear(),o.cropMutated.clear(),o.cropMatured.clear(),o.cropHarvested.clear(),o.eggPlaced.clear(),o.eggRemoved.clear(),o.eggMatured.clear(),o.decorPlaced.clear(),o.decorRemoved.clear(),n=false;}}}let Mu=null;function Di(){return Mu||(Mu=b2()),Mu}const $m={inventory:"myPetInventoryAtom",hutch:"myPetHutchPetItemsAtom",active:"myPetInfosAtom",slotInfos:"myPetSlotInfosAtom",expandedPetSlotId:"expandedPetSlotIdAtom",myNumPetHutchItems:"myNumPetHutchItemsAtom",activityLogs:"myDataAtom"};function Bm(e,t){const n=Cd(e.xp),r=Ss(e.petSpecies,e.targetScale),o=ks(e.petSpecies,e.xp,r),i=Sd(e.petSpecies,n),l=we.get("pets")?.[e.petSpecies]?.coinsToFullyReplenishHunger??1,d=e.hunger/l*100;return {id:e.id,petSpecies:e.petSpecies,name:e.name,xp:e.xp,hunger:e.hunger,hungerPercent:d,mutations:[...e.mutations],targetScale:e.targetScale,abilities:[...e.abilities],location:t,position:null,lastAbilityTrigger:null,growthStage:n,currentStrength:o,maxStrength:r,isMature:i}}function v2(e,t){const r=t[e.slot.id]?.lastAbilityTrigger??null,o=Cd(e.slot.xp),i=Ss(e.slot.petSpecies,e.slot.targetScale),a=ks(e.slot.petSpecies,e.slot.xp,i),s=Sd(e.slot.petSpecies,o),c=we.get("pets")?.[e.slot.petSpecies]?.coinsToFullyReplenishHunger??1,p=e.slot.hunger/c*100;return {id:e.slot.id,petSpecies:e.slot.petSpecies,name:e.slot.name,xp:e.slot.xp,hunger:e.slot.hunger,hungerPercent:p,mutations:[...e.slot.mutations],targetScale:e.slot.targetScale,abilities:[...e.slot.abilities],location:"active",position:e.position?{x:e.position.x,y:e.position.y}:null,lastAbilityTrigger:r,growthStage:o,currentStrength:a,maxStrength:i,isMature:s}}const zm=500;let Qn=[],Zl=0;function y2(){try{const e=tt(Jt.GLOBAL.MY_PETS_ABILITY_LOGS,[]);if(!Array.isArray(e))return [];const t=e.filter(n=>typeof n=="object"&&n!==null&&typeof n.petId=="string"&&typeof n.petName=="string"&&typeof n.petSpecies=="string"&&typeof n.abilityId=="string"&&typeof n.performedAt=="number");return t.length<e.length&&console.log(`[myPets] Migrated ability logs: removed ${e.length-t.length} old entries`),t.length>0&&(Zl=Math.max(...t.map(n=>n.performedAt))),t}catch(e){return console.error("[myPets] Failed to load ability logs from storage:",e),[]}}function x2(e){try{rt(Jt.GLOBAL.MY_PETS_ABILITY_LOGS,e);}catch(t){console.error("[myPets] Failed to save ability logs to storage:",t);}}function w2(e){try{const n=e.parameters.pet;return !n||!n.id||!n.petSpecies?null:{petId:n.id,petName:n.name||n.petSpecies,petSpecies:n.petSpecies,abilityId:e.action,data:e.parameters,performedAt:e.timestamp}}catch(t){return console.error("[myPets] Failed to convert activity log:",t),null}}function C2(e){if(!e||!Array.isArray(e))return;const t=xy(e),n=[];for(const r of t)if(r.timestamp>Zl){const o=w2(r);o&&n.push(o);}n.length!==0&&(Zl=Math.max(...n.map(r=>r.performedAt),Zl),Qn=[...n,...Qn],Qn.length>zm&&(Qn=Qn.slice(0,zm)),x2(Qn),console.log(`[myPets] Processed ${n.length} new ability logs (total: ${Qn.length})`));}function jm(e){const t=new Set,n=[];for(const b of e.active??[]){const g=v2(b,e.slotInfos??{});n.push(g),t.add(g.id);}const r=[];for(const b of e.inventory??[]){if(t.has(b.id))continue;const g=Bm(b,"inventory");r.push(g),t.add(g.id);}const o=[];for(const b of e.hutch??[]){if(t.has(b.id))continue;const g=Bm(b,"hutch");o.push(g),t.add(g.id);}const i=[...n,...r,...o],a=e.expandedPetSlotId??null,s=a?i.find(b=>b.id===a)??null:null,c=Di().get().decors.all.some(b=>b.decorId==="PetHutch"),p=e.myNumPetHutchItems??0;return {all:i,byLocation:{inventory:r,hutch:o,active:n},counts:{inventory:r.length,hutch:o.length,active:n.length,total:i.length},hutch:{hasHutch:c,currentItems:p,maxItems:25},expandedPetSlotId:a,expandedPet:s,abilityLogs:[...Qn]}}const Gm={all:[],byLocation:{inventory:[],hutch:[],active:[]},counts:{inventory:0,hutch:0,active:0,total:0},hutch:{hasHutch:false,currentItems:0,maxItems:25},expandedPetSlotId:null,expandedPet:null,abilityLogs:[]};function S2(e,t){if(e.length!==t.length)return  false;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return  false;return  true}function Hm(e){return JSON.stringify({id:e.id,petSpecies:e.petSpecies,name:e.name,mutations:e.mutations,abilities:e.abilities,location:e.location})}function k2(e,t){if(e.all.length!==t.all.length)return  false;const n=e.all.map(Hm),r=t.all.map(Hm);return S2(n,r)}function _2(e,t){const n=[],r=new Map(e.all.map(o=>[o.id,o]));for(const o of t.all){const i=r.get(o.id);i&&i.location!==o.location&&n.push({pet:o,from:i.location,to:o.location});}return n}function A2(e,t){const n=[],r=new Map(e.all.map(o=>[o.id,o]));for(const o of t.all){if(!o.lastAbilityTrigger)continue;const a=r.get(o.id)?.lastAbilityTrigger;(!a||a.abilityId!==o.lastAbilityTrigger.abilityId||a.performedAt!==o.lastAbilityTrigger.performedAt)&&n.push({pet:o,trigger:o.lastAbilityTrigger});}return n}function E2(e,t){const n=new Set(e.all.map(a=>a.id)),r=new Set(t.all.map(a=>a.id)),o=t.all.filter(a=>!n.has(a.id)),i=e.all.filter(a=>!r.has(a.id));return o.length===0&&i.length===0?null:{added:o,removed:i,counts:t.counts}}function T2(e,t){const n=[],r=new Map(e.all.map(o=>[o.id,o]));for(const o of t.all){const i=r.get(o.id);i&&o.growthStage>i.growthStage&&n.push({pet:o,previousStage:i.growthStage,newStage:o.growthStage});}return n}function I2(e,t){const n=[],r=new Map(e.all.map(o=>[o.id,o]));for(const o of t.all){const i=r.get(o.id);i&&o.currentStrength>i.currentStrength&&n.push({pet:o,previousStrength:i.currentStrength,newStrength:o.currentStrength});}return n}function P2(e,t){const n=[],r=new Map(e.all.map(o=>[o.id,o]));for(const o of t.all){const i=r.get(o.id);i&&o.currentStrength===o.maxStrength&&i.currentStrength<i.maxStrength&&n.push({pet:o});}return n}function M2(){let e=Gm,t=Gm,n=false;const r=[],o={all:new Set,stable:new Set,location:new Set,ability:new Set,count:new Set,expandedPet:new Set,growth:new Set,strengthGain:new Set,maxStrength:new Set},i={},a=Object.keys($m),s=new Set;function l(){if(s.size<a.length)return;if(i.activityLogs){const C=i.activityLogs?.activityLogs||i.activityLogs;Array.isArray(C)&&C2(C);}const c=jm(i);if(jn(e,c)||(t=e,e=c,!n))return;for(const C of o.all)C(e,t);if(!k2(t,e))for(const C of o.stable)C(e,t);const p=_2(t,e);for(const C of p)for(const E of o.location)E(C);const m=A2(t,e);for(const C of m)for(const E of o.ability)E(C);const b=E2(t,e);if(b)for(const C of o.count)C(b);const g=T2(t,e);for(const C of g)for(const E of o.growth)E(C);const w=I2(t,e);for(const C of w)for(const E of o.strengthGain)E(C);const _=P2(t,e);for(const C of _)for(const E of o.maxStrength)E(C);if(t.expandedPetSlotId!==e.expandedPetSlotId){const C={current:e.expandedPet,previous:t.expandedPet,currentId:e.expandedPetSlotId,previousId:t.expandedPetSlotId};for(const E of o.expandedPet)E(C);}}async function d(){if(n)return;Qn=y2(),console.log(`[myPets] Loaded ${Qn.length} ability logs from storage`);const c=a.map(async p=>{const m=$m[p],b=await et.subscribe(m,g=>{i[p]=g,s.add(p),l();});r.push(b);});await Promise.all(c),n=true,s.size===a.length&&(e=jm(i));}return d(),{get(){return e},subscribe(c,p){return o.all.add(c),p?.immediate!==false&&n&&s.size===a.length&&c(e,e),()=>o.all.delete(c)},subscribeStable(c,p){return o.stable.add(c),p?.immediate!==false&&n&&s.size===a.length&&c(e,e),()=>o.stable.delete(c)},subscribeLocation(c,p){if(o.location.add(c),p?.immediate&&n&&s.size===a.length)for(const m of e.all)c({pet:m,from:m.location,to:m.location});return ()=>o.location.delete(c)},subscribeAbility(c,p){if(o.ability.add(c),p?.immediate&&n&&s.size===a.length)for(const m of e.all)m.lastAbilityTrigger&&c({pet:m,trigger:m.lastAbilityTrigger});return ()=>o.ability.delete(c)},subscribeCount(c,p){return o.count.add(c),p?.immediate&&n&&s.size===a.length&&c({added:e.all,removed:[],counts:e.counts}),()=>o.count.delete(c)},subscribeExpandedPet(c,p){return o.expandedPet.add(c),p?.immediate&&n&&s.size===a.length&&c({current:e.expandedPet,previous:e.expandedPet,currentId:e.expandedPetSlotId,previousId:e.expandedPetSlotId}),()=>o.expandedPet.delete(c)},subscribeGrowth(c,p){if(o.growth.add(c),p?.immediate&&n&&s.size===a.length)for(const m of e.all)c({pet:m,previousStage:m.growthStage,newStage:m.growthStage});return ()=>o.growth.delete(c)},subscribeStrengthGain(c,p){if(o.strengthGain.add(c),p?.immediate&&n&&s.size===a.length)for(const m of e.all)c({pet:m,previousStrength:m.currentStrength,newStrength:m.currentStrength});return ()=>o.strengthGain.delete(c)},subscribeMaxStrength(c,p){if(o.maxStrength.add(c),p?.immediate&&n&&s.size===a.length)for(const m of e.all)m.currentStrength===m.maxStrength&&c({pet:m});return ()=>o.maxStrength.delete(c)},destroy(){for(const c of r)c();r.length=0,o.all.clear(),o.stable.clear(),o.location.clear(),o.ability.clear(),o.count.clear(),o.expandedPet.clear(),o.growth.clear(),o.strengthGain.clear(),o.maxStrength.clear(),n=false;}}}let Lu=null;function Bo(){return Lu||(Lu=M2()),Lu}const Um={inventory:"myInventoryAtom",isFull:"isMyInventoryAtMaxLengthAtom",selectedItemIndex:"myValidatedSelectedItemIndexAtom"},Wm={items:[],favoritedItemIds:[],count:0,isFull:false,selectedItem:null};function Vm(e){const t=e.inventory,n=t?.items??[],r=t?.favoritedItemIds??[],o=e.selectedItemIndex;let i=null;return o!==null&&o>=0&&o<n.length&&(i={index:o,item:n[o]}),{items:n,favoritedItemIds:r,count:n.length,isFull:e.isFull??false,selectedItem:i}}function qm(e){const t=e.items.map(n=>"id"in n?n.id:"species"in n&&n.itemType==="Seed"?`seed:${n.species}:${n.quantity}`:"toolId"in n?`tool:${n.toolId}:${n.quantity}`:"eggId"in n?`egg:${n.eggId}:${n.quantity}`:"decorId"in n?`decor:${n.decorId}:${n.quantity}`:JSON.stringify(n));return JSON.stringify({itemKeys:t,favoritedItemIds:e.favoritedItemIds,isFull:e.isFull,selectedItemIndex:e.selectedItem?.index??null})}function L2(e,t){return qm(e)===qm(t)}function R2(e,t){return e===null&&t===null?false:e===null||t===null?true:e.index!==t.index}function vl(e){return "id"in e?e.id:"species"in e&&e.itemType==="Seed"?`seed:${e.species}`:"toolId"in e?`tool:${e.toolId}`:"eggId"in e?`egg:${e.eggId}`:"decorId"in e?`decor:${e.decorId}`:JSON.stringify(e)}function O2(e,t){const n=new Set(e.map(vl)),r=new Set(t.map(vl)),o=t.filter(a=>!n.has(vl(a))),i=e.filter(a=>!r.has(vl(a)));return o.length===0&&i.length===0?null:{added:o,removed:i,counts:{before:e.length,after:t.length}}}function F2(e,t){const n=new Set(e),r=new Set(t),o=t.filter(a=>!n.has(a)),i=e.filter(a=>!r.has(a));return o.length===0&&i.length===0?null:{added:o,removed:i,current:t}}function N2(){let e=Wm,t=Wm,n=false;const r=[],o={all:new Set,stable:new Set,selection:new Set,items:new Set,favorites:new Set},i={},a=Object.keys(Um),s=new Set;function l(){if(s.size<a.length)return;const c=Vm(i);if(jn(e,c)||(t=e,e=c,!n))return;for(const b of o.all)b(e,t);if(!L2(t,e))for(const b of o.stable)b(e,t);if(R2(t.selectedItem,e.selectedItem)){const b={current:e.selectedItem,previous:t.selectedItem};for(const g of o.selection)g(b);}const p=O2(t.items,e.items);if(p)for(const b of o.items)b(p);const m=F2(t.favoritedItemIds,e.favoritedItemIds);if(m)for(const b of o.favorites)b(m);}async function d(){if(n)return;const c=a.map(async p=>{const m=Um[p],b=await et.subscribe(m,g=>{i[p]=g,s.add(p),l();});r.push(b);});await Promise.all(c),n=true,s.size===a.length&&(e=Vm(i));}return d(),{get(){return e},subscribe(c,p){return o.all.add(c),p?.immediate!==false&&n&&s.size===a.length&&c(e,e),()=>o.all.delete(c)},subscribeStable(c,p){return o.stable.add(c),p?.immediate!==false&&n&&s.size===a.length&&c(e,e),()=>o.stable.delete(c)},subscribeSelection(c,p){return o.selection.add(c),p?.immediate&&n&&s.size===a.length&&c({current:e.selectedItem,previous:e.selectedItem}),()=>o.selection.delete(c)},subscribeItems(c,p){return o.items.add(c),p?.immediate&&n&&s.size===a.length&&c({added:e.items,removed:[],counts:{before:0,after:e.count}}),()=>o.items.delete(c)},subscribeFavorites(c,p){return o.favorites.add(c),p?.immediate&&n&&s.size===a.length&&c({added:e.favoritedItemIds,removed:[],current:e.favoritedItemIds}),()=>o.favorites.delete(c)},destroy(){for(const c of r)c();r.length=0,o.all.clear(),o.stable.clear(),o.selection.clear(),o.items.clear(),o.favorites.clear(),n=false;}}}let Ru=null;function Hn(){return Ru||(Ru=N2()),Ru}const Np={all:[],host:null,myPlayer:null,count:0};function D2(e,t,n){const r=n.get(e.id),o=r?.slot,i=o?.data,a=o?.lastActionEvent;return {id:e.id,name:e.name,discordId:e.databaseUserId,discordAvatarUrl:e.discordAvatarUrl,guildId:e.guildId,isConnected:e.isConnected,isHost:e.id===t,slotIndex:r?.index??null,position:o?.position??null,cosmetic:{color:e.cosmetic?.color??"",avatar:e.cosmetic?.avatar?[...e.cosmetic.avatar]:[]},emote:{type:e.emoteData?.emoteType??-1},coins:i?.coinsCount??0,inventory:i?.inventory??null,shopPurchases:i?.shopPurchases??null,garden:i?.garden??null,pets:{slots:i?.petSlots??[],slotInfos:o?.petSlotInfos??null},journal:i?.journal??null,stats:i?.stats??null,tasksCompleted:i?.tasksCompleted??[],activityLogs:i?.activityLogs??[],customRestocks:{config:i?.customRestocks??null,inventories:o?.customRestockInventories??null},lastAction:a?{type:a.action,data:a.data,timestamp:a.timestamp}:null,selectedItemIndex:o?.notAuthoritative_selectedItemIndex??null,lastSlotMachineInfo:o?.lastSlotMachineInfo??null}}function Xm(e){const t=e.players,n=e.hostPlayerId??"",r=e.userSlots??[],o=e.myUserSlotIndex;if(!t||!Array.isArray(t)||t.length===0)return Np;const i=new Map;Array.isArray(r)&&r.forEach((d,c)=>{d?.type==="user"&&d?.playerId&&i.set(d.playerId,{slot:d,index:c});});const a=t.map(d=>D2(d,n,i)),s=a.find(d=>d.isHost)??null,l=o!==null?a.find(d=>d.slotIndex===o)??null:null;return {all:a,host:s,myPlayer:l,count:a.length}}function Km(e){const t=e.all.map(n=>`${n.id}:${n.isConnected}:${n.isHost}`);return JSON.stringify({playerKeys:t,hostId:e.host?.id??null,count:e.count})}function $2(e,t){const n=[],r=new Set(e.map(i=>i.id)),o=new Set(t.map(i=>i.id));for(const i of t)r.has(i.id)||n.push({player:i,type:"join"});for(const i of e)o.has(i.id)||n.push({player:i,type:"leave"});return n}function B2(e,t){const n=[],r=new Map(e.map(o=>[o.id,o]));for(const o of t){const i=r.get(o.id);i&&i.isConnected!==o.isConnected&&n.push({player:o,isConnected:o.isConnected});}return n}function z2(){let e=Np,t=Np,n=false;const r=[],o={all:new Set,stable:new Set,joinLeave:new Set,connection:new Set,host:new Set},i={},a=new Set,s=4;function l(){if(a.size<s)return;const c=Xm(i);if(jn(e,c)||(t=e,e=c,!n))return;for(const w of o.all)w(e,t);if(Km(t)!==Km(e))for(const w of o.stable)w(e,t);const p=$2(t.all,e.all);for(const w of p)for(const _ of o.joinLeave)_(w);const m=B2(t.all,e.all);for(const w of m)for(const _ of o.connection)_(w);const b=t.host?.id??null,g=e.host?.id??null;if(b!==g){const w={current:e.host,previous:t.host};for(const _ of o.host)_(w);}}async function d(){if(n)return;const c=await PA.onChangeNow(g=>{i.players=g,a.add("players"),l();});r.push(c);const p=await MA.onChangeNow(g=>{i.hostPlayerId=g,a.add("hostPlayerId"),l();});r.push(p);const m=await IA.onChangeNow(g=>{i.userSlots=g,a.add("userSlots"),l();});r.push(m);const b=await et.subscribe("myUserSlotIdxAtom",g=>{i.myUserSlotIndex=g,a.add("myUserSlotIndex"),l();});r.push(b),n=true,a.size===s&&(e=Xm(i));}return d(),{get(){return e},subscribe(c,p){return o.all.add(c),p?.immediate!==false&&n&&a.size===s&&c(e,e),()=>o.all.delete(c)},subscribeStable(c,p){return o.stable.add(c),p?.immediate!==false&&n&&a.size===s&&c(e,e),()=>o.stable.delete(c)},subscribeJoinLeave(c,p){if(o.joinLeave.add(c),p?.immediate&&n&&a.size===s)for(const m of e.all)c({player:m,type:"join"});return ()=>o.joinLeave.delete(c)},subscribeConnection(c,p){if(o.connection.add(c),p?.immediate&&n&&a.size===s)for(const m of e.all)c({player:m,isConnected:m.isConnected});return ()=>o.connection.delete(c)},subscribeHost(c,p){return o.host.add(c),p?.immediate&&n&&a.size===s&&c({current:e.host,previous:e.host}),()=>o.host.delete(c)},destroy(){for(const c of r)c();r.length=0,o.all.clear(),o.stable.clear(),o.joinLeave.clear(),o.connection.clear(),o.host.clear(),n=false;}}}let Ou=null;function Ch(){return Ou||(Ou=z2()),Ou}const Fx=Object.freeze(Object.defineProperty({__proto__:null,getPlayers:Ch},Symbol.toStringTag,{value:"Module"})),Is=["seed","tool","egg","decor"];function j2(e,t){switch(t){case "seed":return e.species??e.itemType;case "tool":return e.toolId??e.itemType;case "egg":return e.eggId??e.itemType;case "decor":return e.decorId??e.itemType;default:return e.itemType}}function G2(e,t,n){const r=j2(e,t),o=n[r]??0,i=Math.max(0,e.initialStock-o);return {id:r,itemType:e.itemType,initialStock:e.initialStock,purchased:o,remaining:i,isAvailable:i>0,price:e.price}}function H2(e,t,n){if(!t)return {type:e,items:[],availableCount:0,totalCount:0,secondsUntilRestock:0,restockAt:null};const o=n[e]?.purchases??{},i=(t.inventory??[]).map(d=>G2(d,e,o)),a=i.filter(d=>d.isAvailable).length,s=t.secondsUntilRestock??0,l=s>0?Date.now()+s*1e3:null;return {type:e,items:i,availableCount:a,totalCount:i.length,secondsUntilRestock:s,restockAt:l}}function Ym(e){const t=e.shops,n=e.purchases??{},r=Is.map(s=>H2(s,t?.[s],n)),o={seed:r[0],tool:r[1],egg:r[2],decor:r[3]},i=r.filter(s=>s.restockAt!==null);let a=null;if(i.length>0){const l=i.sort((d,c)=>(d.restockAt??0)-(c.restockAt??0))[0];a={shop:l.type,seconds:l.secondsUntilRestock,at:l.restockAt};}return {all:r,byType:o,nextRestock:a}}const Jm={all:Is.map(e=>({type:e,items:[],availableCount:0,totalCount:0,secondsUntilRestock:0,restockAt:null})),byType:{seed:{type:"seed",items:[],availableCount:0,totalCount:0,secondsUntilRestock:0,restockAt:null},tool:{type:"tool",items:[],availableCount:0,totalCount:0,secondsUntilRestock:0,restockAt:null},egg:{type:"egg",items:[],availableCount:0,totalCount:0,secondsUntilRestock:0,restockAt:null},decor:{type:"decor",items:[],availableCount:0,totalCount:0,secondsUntilRestock:0,restockAt:null}},nextRestock:null};function Qm(e){return JSON.stringify({shops:e.all.map(t=>({type:t.type,itemCount:t.items.length,availableCount:t.availableCount}))})}function U2(e,t){const n=e.secondsUntilRestock,r=t.secondsUntilRestock;return n>0&&n<=5&&r>n||n>0&&r===0&&t.items.some(i=>i.purchased===0)?{shop:t,previousItems:e.items}:null}function W2(e,t){const n=[];for(const r of Is){const o=e.byType[r],i=t.byType[r],a=new Map(o.items.map(s=>[s.id,s]));for(const s of i.items){const l=a.get(s.id);l&&s.purchased>l.purchased&&n.push({shopType:r,itemId:s.id,quantity:s.purchased-l.purchased,newPurchased:s.purchased,remaining:s.remaining});}}return n}function V2(e,t){const n=[];for(const r of Is){const o=e.byType[r],i=t.byType[r],a=new Map(o.items.map(s=>[s.id,s]));for(const s of i.items){const l=a.get(s.id);l&&l.isAvailable!==s.isAvailable&&n.push({shopType:r,itemId:s.id,wasAvailable:l.isAvailable,isAvailable:s.isAvailable});}}return n}function q2(){let e=Jm,t=Jm,n=false;const r=[],o={all:new Set,stable:new Set,seedRestock:new Set,toolRestock:new Set,eggRestock:new Set,decorRestock:new Set,purchase:new Set,availability:new Set},i={},a=new Set,s=2;function l(){if(a.size<s)return;const c=Ym(i);if(jn(e,c)||(t=e,e=c,!n))return;for(const g of o.all)g(e,t);if(Qm(t)!==Qm(e))for(const g of o.stable)g(e,t);const p={seed:o.seedRestock,tool:o.toolRestock,egg:o.eggRestock,decor:o.decorRestock};for(const g of Is){const w=U2(t.byType[g],e.byType[g]);if(w)for(const _ of p[g])_(w);}const m=W2(t,e);for(const g of m)for(const w of o.purchase)w(g);const b=V2(t,e);for(const g of b)for(const w of o.availability)w(g);}async function d(){if(n)return;const c=await RA.onChangeNow(m=>{i.shops=m,a.add("shops"),l();});r.push(c);const p=await OA.onChangeNow(m=>{i.purchases=m,a.add("purchases"),l();});r.push(p),n=true,a.size===s&&(e=Ym(i));}return d(),{get(){return e},getShop(c){return e.byType[c]},getItem(c,p){return e.byType[c].items.find(b=>b.id===p)??null},subscribe(c,p){return o.all.add(c),p?.immediate!==false&&n&&a.size===s&&c(e,e),()=>o.all.delete(c)},subscribeStable(c,p){return o.stable.add(c),p?.immediate!==false&&n&&a.size===s&&c(e,e),()=>o.stable.delete(c)},subscribeSeedRestock(c,p){return o.seedRestock.add(c),p?.immediate&&n&&a.size===s&&c({shop:e.byType.seed,previousItems:[]}),()=>o.seedRestock.delete(c)},subscribeToolRestock(c,p){return o.toolRestock.add(c),p?.immediate&&n&&a.size===s&&c({shop:e.byType.tool,previousItems:[]}),()=>o.toolRestock.delete(c)},subscribeEggRestock(c,p){return o.eggRestock.add(c),p?.immediate&&n&&a.size===s&&c({shop:e.byType.egg,previousItems:[]}),()=>o.eggRestock.delete(c)},subscribeDecorRestock(c,p){return o.decorRestock.add(c),p?.immediate&&n&&a.size===s&&c({shop:e.byType.decor,previousItems:[]}),()=>o.decorRestock.delete(c)},subscribePurchase(c,p){if(o.purchase.add(c),p?.immediate&&n&&a.size===s)for(const m of e.all)for(const b of m.items)b.purchased>0&&c({shopType:m.type,itemId:b.id,quantity:b.purchased,newPurchased:b.purchased,remaining:b.remaining});return ()=>o.purchase.delete(c)},subscribeAvailability(c,p){if(o.availability.add(c),p?.immediate&&n&&a.size===s)for(const m of e.all)for(const b of m.items)c({shopType:m.type,itemId:b.id,wasAvailable:b.isAvailable,isAvailable:b.isAvailable});return ()=>o.availability.delete(c)},destroy(){for(const c of r)c();r.length=0,o.all.clear(),o.stable.clear(),o.seedRestock.clear(),o.toolRestock.clear(),o.eggRestock.clear(),o.decorRestock.clear(),o.purchase.clear(),o.availability.clear(),n=false;}}}let Fu=null;function $i(){return Fu||(Fu=q2()),Fu}function Nx(e){const t=e||"Sunny",o=we.get("weather")?.[t]?.name||t;return {id:t,name:o,isActive:t!=="Sunny",type:t,startTime:null,endTime:null,remainingSeconds:0}}function Zm(){return Nx(null)}function X2(){let e=Zm(),t=Zm(),n=null,r=false,o=null;const i={all:new Set,stable:new Set};function a(l){const d=(l||"Sunny")!==(n||"Sunny");n=l;const c=Nx(l),p=e.id!==c.id;if(t=e,e=c,!!r){if(d)for(const m of i.all)m(e,t);if(p){const m={current:e,previous:t};for(const b of i.stable)b(m);}}}async function s(){r||(o=await et.subscribe("weatherAtom",l=>{a(l);}),r=true);}return s(),{get(){return e},subscribe(l,d){return i.all.add(l),d?.immediate!==false&&r&&l(e,e),()=>i.all.delete(l)},subscribeStable(l,d){return i.stable.add(l),d?.immediate&&r&&l({current:e,previous:e}),()=>i.stable.delete(l)},destroy(){o?.(),o=null,i.all.clear(),i.stable.clear(),r=false;}}}let Nu=null;function Ps(){return Nu||(Nu=X2()),Nu}let Yt=null;function Dx(){return Yt||(Yt={currentTile:mt(),myPets:Bo(),gameMap:Op(),myInventory:Hn(),players:Ch(),shops:$i(),weather:Ps(),myGarden:Di()},Yt)}function br(){if(!Yt)throw new Error("[Globals] Not initialized. Call initGlobals() first.");return Yt}function K2(){Yt&&(Yt.currentTile.destroy(),Yt.myPets.destroy(),Yt.gameMap.destroy(),Yt.myInventory.destroy(),Yt.players.destroy(),Yt.shops.destroy(),Yt.weather.destroy(),Yt.myGarden.destroy(),Yt=null);}const Ge={get currentTile(){return br().currentTile},get myPets(){return br().myPets},get gameMap(){return br().gameMap},get myInventory(){return br().myInventory},get players(){return br().players},get shops(){return br().shops},get weather(){return br().weather},get myGarden(){return br().myGarden}};function Y2(e){const t=uh(e);return {ok:t.ok,itemId:e,reason:t.ok?void 0:t.reason}}function J2(e){const r=Ge.shops.getShop("seed").items.find(s=>s.id===e);if(!r)return {ok:false,itemId:e,totalPurchased:0,errors:[`Seed not found in shop: ${e}`]};const o=r.remaining,i=[];let a=0;for(let s=0;s<o;s++){const l=uh(e);l.ok?a++:i.push(l.reason||`Failed to purchase seed ${s+1}`);}return {ok:a>0,itemId:e,totalPurchased:a,errors:i}}function Q2(e){const t=ch(e);return {ok:t.ok,itemId:e,reason:t.ok?void 0:t.reason}}function Z2(e){const r=Ge.shops.getShop("egg").items.find(s=>s.id===e);if(!r)return {ok:false,itemId:e,totalPurchased:0,errors:[`Egg not found in shop: ${e}`]};const o=r.remaining,i=[];let a=0;for(let s=0;s<o;s++){const l=ch(e);l.ok?a++:i.push(l.reason||`Failed to purchase egg ${s+1}`);}return {ok:a>0,itemId:e,totalPurchased:a,errors:i}}function eM(e){const t=lh(e);return {ok:t.ok,itemId:e,reason:t.ok?void 0:t.reason}}function tM(e){const r=Ge.shops.getShop("decor").items.find(s=>s.id===e);if(!r)return {ok:false,itemId:e,totalPurchased:0,errors:[`Decor not found in shop: ${e}`]};const o=r.remaining,i=[];let a=0;for(let s=0;s<o;s++){const l=lh(e);l.ok?a++:i.push(l.reason||`Failed to purchase decor ${s+1}`);}return {ok:a>0,itemId:e,totalPurchased:a,errors:i}}function nM(e){const t=dh(e);return {ok:t.ok,itemId:e,reason:t.ok?void 0:t.reason}}function rM(e){const r=Ge.shops.getShop("tool").items.find(s=>s.id===e);if(!r)return {ok:false,itemId:e,totalPurchased:0,errors:[`Tool not found in shop: ${e}`]};const o=r.remaining,i=[];let a=0;for(let s=0;s<o;s++){const l=dh(e);l.ok?a++:i.push(l.reason||`Failed to purchase tool ${s+1}`);}return {ok:a>0,itemId:e,totalPurchased:a,errors:i}}let Du=false;const mo={init(){Du||(Du=true,console.log("[MGShopActions] Initialized"));},isReady(){return Du},seed:{buy:Y2,buyAll:J2},egg:{buy:Q2,buyAll:Z2},decor:{buy:eM,buyAll:tM},tool:{buy:nM,buyAll:rM}};async function $x(e){const t=[{name:"Data",init:()=>we.init()},{name:"CustomModal",init:()=>si.init()},{name:"Sprites",init:()=>ye.init()},{name:"TileObjectSystem",init:()=>Er.init()},{name:"Pixi",init:()=>hd.init()},{name:"RiveLoader",init:()=>_i.init()},{name:"Audio",init:()=>Et.init()},{name:"Cosmetics",init:()=>fh.init()},{name:"ShopActions",init:()=>mo.init()}];await Promise.all(t.map(async n=>{e?.({status:"start",name:n.name});try{await n.init(),e?.({status:"success",name:n.name});}catch(r){console.error(`[${n.name}] failed`,r),e?.({status:"error",name:n.name,error:r});}})),console.log("[Gemini] Modules ready. Access via Gemini.Modules in console.");}const Sh=Object.freeze(Object.defineProperty({__proto__:null,MGAssets:Fo,MGAudio:Et,MGCalculators:Rx,MGCosmetic:fh,MGCustomModal:si,MGData:we,MGEnvironment:Wt,MGManifest:Sr,MGPixi:hd,MGPixiHooks:An,MGRiveLoader:_i,MGShopActions:mo,MGSprite:ye,MGTile:Er,MGVersion:Of,PET_ABILITY_ACTIONS:vy,filterPetAbilityLogs:xy,formatAbilityLog:wy,initAllModules:$x,isPetAbilityAction:yy},Symbol.toStringTag,{value:"Module"}));function oM(e){const t=String(e??"").trim().toLowerCase();return t?t==="common"?"Common":t==="uncommon"?"Uncommon":t==="rare"?"Rare":t==="legendary"?"Legendary":t==="mythical"?"Mythical":t==="divine"?"Divine":t==="celestial"?"Celestial":t==="unknown"||t==="unknow"?"Unknown":null:null}function iM(e){return e.toLowerCase()}function Ms(e={}){const{id:t,label:n="",type:r="neutral",tone:o="soft",border:i,withBorder:a,pill:s=true,size:l="md",onClick:d,variant:c="default",rarity:p=null,abilityId:m="",abilityName:b=""}=e,g=x("span",{className:"badge",id:t});s&&g.classList.add("badge--pill"),l==="sm"?g.classList.add("badge--sm"):l==="lg"?g.classList.add("badge--lg"):g.classList.add("badge--md"),d&&g.addEventListener("click",d);let w=false,_=a;function C(){w||(_===false?g.style.border="none":g.style.border="");}function E(S,R=o){g.classList.remove("badge--neutral","badge--info","badge--success","badge--warning","badge--danger","badge--soft","badge--outline","badge--solid"),g.classList.add(`badge--${S}`,`badge--${R}`),C();}function P(S){const R=(S??"").trim();R?(g.style.border=R,w=true):(w=false,C());}function O(S){_=S,C();}function F(S){g.textContent=S;}function A(S,R=o){E(S,R);}function T(S){g.classList.remove("badge--rarity","badge--rarity-common","badge--rarity-uncommon","badge--rarity-rare","badge--rarity-legendary","badge--rarity-mythical","badge--rarity-divine","badge--rarity-celestial","badge--rarity-unknown"),g.style.background="",g.style.backgroundSize="",g.style.animation="",g.style.color="",g.style.webkitTextStroke="";const R=oM(S);if(!R){g.textContent=String(S??"—");return}g.textContent=R,g.classList.add("badge--rarity",`badge--rarity-${iM(R)}`);}function M(S,R){const j=we.get("abilities")?.[S],q=j?.color,U=q?.bg||"rgba(100, 100, 100, 0.9)",ce=q?.hover||"rgba(150, 150, 150, 1)";g.classList.remove("badge--neutral","badge--info","badge--success","badge--warning","badge--danger","badge--soft","badge--outline","badge--solid","badge--rarity","badge--rarity-common","badge--rarity-uncommon","badge--rarity-rare","badge--rarity-legendary","badge--rarity-mythical","badge--rarity-divine","badge--rarity-celestial","badge--rarity-unknown"),g.classList.add("badge--ability"),g.textContent=R||j?.name||S||"Unknown Ability",g.style.background=U,g.style.color="white",g.style.border="none",g.style.webkitTextStroke="",g.style.animation="",g.style.backgroundSize="";const W=()=>{g.style.background=ce;},te=()=>{g.style.background=U;};g.removeEventListener("mouseenter",W),g.removeEventListener("mouseleave",te),g.addEventListener("mouseenter",W),g.addEventListener("mouseleave",te);}return c==="rarity"?T(p):c==="ability"?M(m,b):(g.textContent=n,E(r,o),typeof a=="boolean"&&O(a),i&&P(i)),{root:g,setLabel:F,setType:A,setBorder:P,setWithBorder:O,setRarity:T,setAbility:M}}const aM={expanded:false,sort:{key:null,dir:null},search:""},sM={categories:{}};async function lM(){const e=await Kr("tab-test",{version:2,defaults:sM,sanitize:i=>({categories:i.categories&&typeof i.categories=="object"?i.categories:{}})});function t(i){return e.get().categories[i]||{...aM}}function n(i,a){const s=e.get(),l=t(i);e.update({categories:{...s.categories,[i]:{...l,expanded:a}}});}function r(i,a,s){const l=e.get(),d=t(i);e.update({categories:{...l.categories,[i]:{...d,sort:{key:a,dir:s}}}});}function o(i,a){const s=e.get(),l=t(i);e.update({categories:{...s.categories,[i]:{...l,search:a}}});}return {get:e.get,set:e.set,save:e.save,getCategoryState:t,setCategoryExpanded:n,setCategorySort:r,setCategorySearch:o}}const cM={Common:1,Uncommon:2,Rare:3,Legendary:4,Mythical:5,Divine:6,Celestial:7};function yl(e){return e?cM[e]??0:0}class dM extends Tr{constructor(){super({id:"tab-test",label:"Test"});de(this,"stateCtrl",null);}async build(n){this.stateCtrl=await lM();const r=this.createContainer("test-section");r.style.display="flex",r.style.flexDirection="column",r.style.gap="12px",n.appendChild(r),await this.buildSpriteTables(r);}renderSprite(n){const r=x("div",{style:"display:flex;align-items:center;justify-content:center;width:32px;height:32px;"});if(n.spriteId){const o=n.spriteId;requestAnimationFrame(()=>{try{const i=ye.toCanvas(o,{scale:1});i.style.maxWidth="32px",i.style.maxHeight="32px",i.style.objectFit="contain",r.appendChild(i);}catch{r.textContent="-";}});}else r.textContent="-";return r}renderRarity(n){if(!n.rarity){const o=x("span",{style:"opacity:0.5;"});return o.textContent="—",o}return Ms({variant:"rarity",rarity:n.rarity,size:"sm"}).root}createDataCard(n,r,o,i){const a=this.stateCtrl.getCategoryState(n),s=m=>{if(!m)return o;const b=m.toLowerCase();return o.filter(g=>g.name.toLowerCase().includes(b))},l=id({columns:i,data:s(a.search),pageSize:0,compact:true,maxHeight:"calc(var(--lg-row-h, 40px) * 6)",getRowId:m=>m.spriteId,onSortChange:(m,b)=>{this.stateCtrl.setCategorySort(n,m,b);}});a.sort.key&&a.sort.dir&&l.sortBy(a.sort.key,a.sort.dir);const d=vs({placeholder:"Search...",value:a.search,debounceMs:150,withClear:true,size:"sm",focusKey:"",onChange:m=>{const b=m.trim();this.stateCtrl.setCategorySearch(n,b),l.setData(s(b));}}),c=x("div",{style:"margin-bottom:8px;"});c.appendChild(d.root);const p=x("div");return p.appendChild(c),p.appendChild(l.root),ft({title:r,subtitle:`${o.length} entries`,variant:"soft",padding:"sm",expandable:true,defaultExpanded:a.expanded,onExpandChange:m=>{this.stateCtrl.setCategoryExpanded(n,m);}},p)}formatCategoryName(n){return n.split("-").map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" ")}findPlantBySprite(n,r){const o=we.get("plants");if(!o)return null;for(const a of Object.values(o))if(a?.seed?.spriteId===n||a?.plant?.spriteId===n||a?.crop?.spriteId===n)return a;const i=r.toLowerCase();for(const a of Object.values(o)){const s=(a?.seed?.name||"").toLowerCase();if(s===i||s===`${i} seed`)return a}return null}findPetBySpriteId(n){const r=we.get("pets");if(!r)return null;for(const o of Object.values(r))if(o?.spriteId===n)return o;return null}findItemBySpriteId(n){const r=we.get("items");if(!r)return null;for(const o of Object.values(r))if(o?.spriteId===n)return o;return null}findDecorBySpriteId(n){const r=we.get("decor");if(!r)return null;for(const o of Object.values(r))if(o?.spriteId===n)return o;return null}findEggBySpriteId(n){const r=we.get("eggs");if(!r)return null;for(const o of Object.values(r))if(o?.spriteId===n)return o;return null}getRarityForSprite(n,r,o){const i=n.toLowerCase();if(i==="plant"||i==="seed"||i==="tallplant"){const a=this.findPlantBySprite(r,o);if(a?.seed?.rarity)return a.seed.rarity}if(i==="pet"){const a=this.findPetBySpriteId(r);if(a?.rarity)return a.rarity}if(i==="item"){const a=this.findItemBySpriteId(r);if(a?.rarity)return a.rarity}if(i==="decor"){const a=this.findDecorBySpriteId(r);if(a?.rarity)return a.rarity}if(i==="egg"){const a=this.findEggBySpriteId(r);if(a?.rarity)return a.rarity}return null}yieldToMain(n=0){return new Promise(r=>{n>0?setTimeout(r,n):typeof requestIdleCallback<"u"?requestIdleCallback(()=>r(),{timeout:50}):setTimeout(r,4);})}async buildSpriteTables(n){const r=[{key:"name",header:"Name",sortable:true,width:"1fr",sortFn:(i,a)=>i.name.localeCompare(a.name,void 0,{numeric:true,sensitivity:"base"})},{key:"rarity",header:"Rarity",sortable:true,width:"100px",align:"center",render:i=>this.renderRarity(i),sortFn:(i,a)=>yl(i.rarity)-yl(a.rarity)},{key:"sprite",header:"Sprite",width:"60px",align:"center",render:i=>this.renderSprite(i)}];if(!ye.isReady())try{await ye.init();}catch{return}const o=ye.getCategories();for(let i=0;i<o.length;i++){await this.yieldToMain(8);const a=o[i],l=ye.getCategoryId(a).map(d=>{const c=`sprite/${a}/${d}`;return {name:d,spriteId:c,rarity:this.getRarityForSprite(a,c,d)}});if(l.sort((d,c)=>yl(d.rarity)-yl(c.rarity)),l.length>0){const d=this.createDataCard(a,this.formatCategoryName(a),l,r);n.appendChild(d);}}}}function vt(e,t,n){if(e.querySelector(`style[data-style-id="${n}"]`))return;const r=document.createElement("style");r.setAttribute("data-style-id",n),r.textContent=t,e.appendChild(r);}const Bx=`
  /* Themed scrollbar using CSS variables */
  #auto-favorite-settings .selection-grid::-webkit-scrollbar {
    width: 6px;
  }
  #auto-favorite-settings .selection-grid::-webkit-scrollbar-track {
    background: transparent;
  }
  #auto-favorite-settings .selection-grid::-webkit-scrollbar-thumb {
    background: var(--scrollbar-thumb, rgba(255,255,255,0.2));
    border-radius: 3px;
  }
  #auto-favorite-settings .selection-grid::-webkit-scrollbar-thumb:hover {
    background: var(--scrollbar-thumb-hover, rgba(255,255,255,0.3));
  }

  /* Game-style checkbox using theme variables */
  #auto-favorite-settings .game-checkbox {
    appearance: none;
    width: 18px;
    height: 18px;
    border: 2px solid color-mix(in oklab, var(--tab-bg) 60%, transparent);
    border-radius: 3px;
    background: var(--bg);
    cursor: pointer;
    position: relative;
    transition: all 0.2s;
  }

  #auto-favorite-settings .game-checkbox:hover {
    border-color: var(--accent);
    box-shadow: 0 0 4px color-mix(in oklab, var(--accent) 40%, transparent);
  }

  #auto-favorite-settings .game-checkbox:checked {
    background: linear-gradient(135deg, var(--tab-bg) 0%, var(--accent) 100%);
    border-color: var(--accent);
  }

  #auto-favorite-settings .game-checkbox:checked::after {
    content: '✓';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: var(--bg);
    font-size: 14px;
    font-weight: bold;
  }

  /* Item row using theme variables */
  #auto-favorite-settings .item-row {
    background: color-mix(in oklab, var(--tab-bg) 8%, transparent);
    border: 1px solid color-mix(in oklab, var(--tab-bg) 20%, transparent);
    transition: all 0.15s ease;
  }

  #auto-favorite-settings .item-row:hover {
    background: color-mix(in oklab, var(--tab-bg) 15%, transparent);
    border-color: var(--accent);
    transform: translateX(2px);
  }

  #auto-favorite-settings .item-row.checked {
    background: color-mix(in oklab, var(--accent) 12%, transparent);
    border-color: var(--accent);
  }

  /* Responsive Mutation Rows - Fluid Flexbox */
  #auto-favorite-settings .mut-row {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 8px;
    width: 100%;
  }

  #auto-favorite-settings .mut-btn {
    flex: 1 1 130px;
    min-width: 0; /* Allow shrinking below content size */
  }

  /* Base mutation button (inactive state) */
  .mut-btn {
    padding: 8px 12px;
    min-height: 52px;
    border-radius: var(--card-radius, 12px);
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    background: color-mix(in oklab, var(--bg) 12%, transparent);
    border: 2px solid color-mix(in oklab, var(--border) 40%, transparent);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    box-shadow: none;
    opacity: 0.8;
    width: 100%;
  }

  /* Active state - full opacity */
  .mut-btn.active {
    opacity: 1;
  }

  /* Rainbow mutation - special gradient */
  .mut-btn--rainbow.active {
    background: linear-gradient(
      135deg,
      rgba(255, 0, 0, 0.3) 0%,
      rgba(255, 165, 0, 0.3) 20%,
      rgba(255, 255, 0, 0.3) 40%,
      rgba(0, 128, 0, 0.3) 60%,
      rgba(0, 0, 255, 0.3) 80%,
      rgba(75, 0, 130, 0.3) 100%
    );
    border-color: #fff9c4;
    box-shadow: 0 4px 18px rgba(255, 255, 255, 0.25);
  }

  /* Gold mutation */
  .mut-btn--gold.active {
    background: color-mix(in oklab, var(--mut-gold) 25%, transparent);
    border-color: var(--mut-gold);
    box-shadow: 0 4px 12px color-mix(in oklab, var(--mut-gold) 30%, transparent);
  }

  /* Wet mutation */
  .mut-btn--wet.active {
    background: color-mix(in oklab, var(--mut-wet) 25%, transparent);
    border-color: var(--mut-wet);
    box-shadow: 0 4px 12px color-mix(in oklab, var(--mut-wet) 30%, transparent);
  }

  /* Chilled mutation */
  .mut-btn--chilled.active {
    background: color-mix(in oklab, var(--mut-chilled) 25%, transparent);
    border-color: var(--mut-chilled);
    box-shadow: 0 4px 12px color-mix(in oklab, var(--mut-chilled) 30%, transparent);
  }

  /* Frozen mutation */
  .mut-btn--frozen.active {
    background: color-mix(in oklab, var(--mut-frozen) 25%, transparent);
    border-color: var(--mut-frozen);
    box-shadow: 0 4px 12px color-mix(in oklab, var(--mut-frozen) 30%, transparent);
  }

  /* Dawnlit mutation */
  .mut-btn--dawnlit.active {
    background: color-mix(in oklab, var(--mut-dawnlit) 25%, transparent);
    border-color: var(--mut-dawnlit);
    box-shadow: 0 4px 12px color-mix(in oklab, var(--mut-dawnlit) 30%, transparent);
  }

  /* Dawncharged mutation */
  .mut-btn--dawncharged.active {
    background: color-mix(in oklab, var(--mut-dawncharged) 25%, transparent);
    border-color: var(--mut-dawncharged);
    box-shadow: 0 4px 12px color-mix(in oklab, var(--mut-dawncharged) 30%, transparent);
  }

  /* Ambershine mutation */
  .mut-btn--ambershine.active {
    background: color-mix(in oklab, var(--mut-ambershine) 25%, transparent);
    border-color: var(--mut-ambershine);
    box-shadow: 0 4px 12px color-mix(in oklab, var(--mut-ambershine) 30%, transparent);
  }

  /* Ambercharged mutation */
  .mut-btn--ambercharged.active {
    background: color-mix(in oklab, var(--mut-ambercharged) 25%, transparent);
    border-color: var(--mut-ambercharged);
    box-shadow: 0 4px 12px color-mix(in oklab, var(--mut-ambercharged) 30%, transparent);
  }
`,uM={enabled:false,favoriteProduceList:[],favoritePetsList:[],favoriteMutations:[]};let fo=null;async function pM(){if(fo)return fo;fo=await Kr("tab-auto-favorite",{version:1,defaults:uM});const e=tt(ut.AUTO_FAVORITE_UI,null);return e&&(await fo.set(e),_S(ut.AUTO_FAVORITE_UI),console.log("[AutoFavoriteSettings] Migrated old storage to new state")),fo}function Fn(){if(!fo)throw new Error("[AutoFavoriteSettings] Section state not initialized. Call initSectionState() first.");return fo}const kh=ut.AUTO_FAVORITE,zx={enabled:false,mode:"simple",simple:{enabled:false,favoriteSpecies:[],favoriteMutations:[]}};function Lo(){return tt(kh,zx)}function _h(e){rt(kh,e);}function jx(e){const n={...Lo(),...e};return _h(n),n}function Ah(e){const t=Lo();return t.mode="simple",t.simple={...t.simple,...e},_h(t),t}function fM(e){Ah({favoriteSpecies:e});}function hM(e){Ah({favoriteMutations:e});}function eb(){return Lo().enabled}let ec=null;const Na=new Set;function Dp(){const e=Lo();if(!e.enabled){console.log("[AutoFavorite] Disabled");return}Na.clear(),ec=Hn().subscribeItems(t=>{if(t.added.length>0){const n=Lo();for(const r of t.added)mM(r,n);}}),console.log(`✅ [AutoFavorite] Started - Watching ${e.simple.favoriteSpecies.length} species, ${e.simple.favoriteMutations.length} mutations`);}function Gx(){ec&&(ec(),ec=null),Na.clear(),console.log("🛑 [AutoFavorite] Stopped");}function gM(e){const t=Lo();t.enabled=e,t.simple.enabled=e,jx(t),e?Dp():Gx();}function mM(e,t){if(e.itemType!=="Produce"&&e.itemType!=="Pet")return;if(!e.id){console.warn("[AutoFavorite] Item has no ID:",e);return}if(!(Na.has(e.id)||e.isFavorited||e.favorited)&&Hx(e,t.simple)){Na.add(e.id);try{xd(e.id),console.log(`[AutoFavorite] ⭐ Favorited ${e.itemType}: ${e.species||e.id}`);}catch(r){console.error("[AutoFavorite] WebSocket error:",r),Na.delete(e.id);}}}function Hx(e,t){if(!t.enabled)return  false;const n=e.itemType==="Pet"?e.petSpecies:e.species;return n?!!(t.favoriteSpecies.includes(n)||t.favoriteMutations.length>0&&(e.mutations||[]).some(o=>t.favoriteMutations.includes(o))):false}function bM(){return Object.keys(we.get("mutations")??{})}const Ux={init(){this.isReady()||Dp();},isReady(){return eb()},DEFAULT_CONFIG:zx,STORAGE_KEY:kh,loadConfig:Lo,saveConfig:_h,updateConfig:jx,updateSimpleConfig:Ah,setFavoriteSpecies:fM,setFavoriteMutations:hM,isEnabled:eb,start:Dp,stop:Gx,setEnabled:gM,shouldFavorite:Hx,getGameMutations:bM};let $u=null,tb=null;function Wx(){try{return Ch().get().myPlayer?.journal||null}catch{return null}}function vM(e){return e?`pro:${Object.keys(e.produce).length}-pet:${Object.keys(e.pets).length}`:"null"}function Vx(){const e=we.get("mutations")??{};return ["Normal",...Object.keys(e),"Max Weight"]}function qx(){return ["Normal","Gold","Rainbow","Max Weight"]}function yM(){return Object.keys(we.get("mutations")??{})}function Xx(e){const n=(we.get("pets")??{})[e];if(!n?.innateAbilityWeights||typeof n.innateAbilityWeights!="object")return [];const r=n.innateAbilityWeights,o=["RainbowGranter","GoldGranter"];return Object.keys(r).filter(i=>!o.includes(i))}function Kx(e){const t=we.get("plants")??{},n=Object.keys(t),r=Vx(),o=e?.produce??{},i=[];let a=0;for(const d of n){const p=o[d]?.variantsLogged?.map(b=>b.variant)??[],m=r.filter(b=>!p.includes(b));a+=p.length,i.push({species:d,variantsLogged:p,variantsMissing:m,variantsTotal:r.length,variantsPercentage:r.length>0?p.length/r.length*100:0,isComplete:m.length===0});}const s=n.length*r.length,l=i.filter(d=>d.variantsLogged.length>0).length;return {total:n.length,logged:l,percentage:n.length>0?l/n.length*100:0,speciesDetails:i,variantsTotal:s,variantsLogged:a,variantsPercentage:s>0?a/s*100:0}}function Yx(e){const t=we.get("pets")??{},n=Object.keys(t),r=qx(),o=e?.pets??{},i=[];let a=0,s=0,l=0,d=0;for(const p of n){const m=o[p],b=m?.variantsLogged?.map(P=>P.variant)??[],g=m?.abilitiesLogged?.map(P=>P.ability)??[],w=r.filter(P=>!b.includes(P)),_=Xx(p),C=g.filter(P=>_.includes(P)),E=_.filter(P=>!C.includes(P));s+=r.length,a+=b.length,d+=_.length,l+=Math.min(C.length,_.length),i.push({species:p,variantsLogged:b,variantsMissing:w,variantsTotal:r.length,variantsPercentage:r.length>0?b.length/r.length*100:0,abilitiesLogged:C,abilitiesMissing:E,abilitiesTotal:_.length,abilitiesPercentage:_.length>0?C.length/_.length*100:0,isComplete:w.length===0&&(_.length===0||E.length===0)});}const c=i.filter(p=>p.variantsLogged.length>0).length;return {total:n.length,logged:c,percentage:n.length>0?c/n.length*100:0,speciesDetails:i,variantsTotal:s,variantsLogged:a,variantsPercentage:s>0?a/s*100:0,abilitiesTotal:d,abilitiesLogged:l,abilitiesPercentage:d>0?l/d*100:0}}async function _d(e=false){await we.waitForAny();const t=Wx(),n=vM(t);if(!e&&$u&&n===tb)return $u;const r={plants:Kx(t),pets:Yx(t),lastUpdated:Date.now()};return $u=r,tb=n,r}async function xM(){const e=await _d();return {plants:e.plants.speciesDetails.filter(t=>t.variantsMissing.length>0).map(t=>({species:t.species,missing:t.variantsMissing})),pets:e.pets.speciesDetails.filter(t=>t.variantsMissing.length>0||(t.abilitiesMissing?.length??0)>0).map(t=>({species:t.species,missingVariants:t.variantsMissing,missingAbilities:t.abilitiesMissing??[]}))}}let Da=null,$p=false;function wM(){$p||($p=true,Da||(Da=setInterval(async()=>{const e=await _d();Eh(e);},3e4)),console.log("[Journal] Started"));}function CM(){Da&&(clearInterval(Da),Da=null),$p=false;}function Eh(e){window.dispatchEvent(new CustomEvent("gemini:journal-updated",{detail:e}));}async function SM(){const e=await _d();return Eh(e),e}function kM(e){try{const t=Bt.getMyJournal();if(!t?.pets)return [];const n=t.pets[e];return n?.abilitiesLogged?n.abilitiesLogged.map(r=>r.ability):[]}catch(t){return console.error("[AbilitiesInject] Failed to get logged abilities:",t),[]}}function _M(e,t){try{const n=Bt.getMyJournal();if(!n?.pets)return;const r=n.pets[e];return r?.abilitiesLogged?r.abilitiesLogged.find(i=>i.ability===t)?.createdAt:void 0}catch(n){console.error("[AbilitiesInject] Failed to get ability log date:",n);return}}function Th(e){try{const t=we.getAll();if(!t?.pets)return [];const n=t.pets[e];if(!n)return [];if(n.innateAbilityWeights&&typeof n.innateAbilityWeights=="object"){const r=n.innateAbilityWeights,o=["RainbowGranter","GoldGranter"];return Object.entries(r).filter(([i])=>!o.includes(i)).sort(([,i],[,a])=>a-i).map(([i])=>i)}return []}catch(t){return console.error("[AbilitiesInject] Failed to get all abilities:",t),[]}}function AM(e){try{const t=we.getAll();if(!t?.abilities)return e;const n=t.abilities[e];if(!n)return e;const r=n.name;if(typeof r=="string")return r;const o=n.displayName;return typeof o=="string"?o:e}catch(t){return console.error("[AbilitiesInject] Failed to get ability name:",t),e}}function Ih(e){try{const t=["RainbowGranter","GoldGranter"],n=kM(e),r=Th(e),o=n.filter(l=>!t.includes(l)),i=r.filter(l=>!o.includes(l)),a=r.length,s=a>0?o.length/a*100:0;return {logged:o,missing:i,total:a,percentage:s}}catch(t){return console.error("[AbilitiesInject] Failed to calculate progress:",t),{logged:[],missing:[],total:0,percentage:0}}}function EM(e){const t=new Date(e),n=t.toLocaleDateString("en-US",{month:"short"}),r=t.getDate(),o=t.getFullYear();return `${n} ${r}, ${o}`}function TM(e){const n=we.get("abilities")?.[e];return {bg:n?.color?.bg||"rgba(100, 100, 100, 0.9)",hover:n?.color?.hover||"rgba(150, 150, 150, 1)"}}function IM(e,t,n,r){const o=n?_M(e,t):void 0,i=document.createElement("div");i.className="gemini-ability-entry",i.style.cssText=`
    display: grid;
    grid-template-rows: 1fr auto;
    gap: 8px;
    align-items: center;
    justify-items: center;
  `;const a=r?"80px":"100px",s=document.createElement("div");if(s.className="gemini-ability-stamp",o){const d=`Logged on ${EM(o)}`;s.style.cursor="help";let c=null;s.addEventListener("mouseenter",()=>{c=document.createElement("div"),c.textContent=d,c.style.cssText=`
        position: fixed;
        background: rgba(45, 35, 28, 0.95);
        color: var(--fg);
        font-size: 11px;
        padding: 8px 12px;
        border-radius: 6px;
        z-index: 10000;
        pointer-events: none;
        box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        white-space: nowrap;
        transform: scale(0.95);
        opacity: 0;
        transition: opacity 0.1s ease, transform 0.1s ease;
      `,document.body.appendChild(c);const p=s.getBoundingClientRect(),m=c.offsetHeight,b=c.offsetWidth;let g=p.left+p.width/2-b/2,w=p.top-m-8;w<8&&(w=p.bottom+8),g<8&&(g=8),g+b>window.innerWidth-8&&(g=window.innerWidth-b-8),c.style.left=`${g}px`,c.style.top=`${w}px`,requestAnimationFrame(()=>{c&&(c.style.opacity="1",c.style.transform="scale(1)");});}),s.addEventListener("mouseleave",()=>{c&&(c.remove(),c=null);});}const l=$v();l||console.error("[AbilitiesInject] Base URL not available - modules may not be initialized"),s.style.cssText=`
    position: relative;
    width: ${a};
    height: ${a};
    display: flex;
    align-items: center;
    justify-content: center;
    ${l?`background-image: url(${l}ui/Stamp.webp);`:""}
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
  `;try{const d=ye.toCanvas("pet",e,{scale:.7,boundsMode:"padded"});if(d){const c=r?"56px":"70px";d.style.position="absolute",d.style.top="50%",d.style.left="50%",d.style.transform="translate(-50%, -50%)",d.style.width=c,d.style.height=c,d.style.objectFit="contain",d.style.imageRendering="pixelated",d.style.zIndex="1",n||(d.style.filter="grayscale(1) brightness(0.16)"),s.appendChild(d);}else {const c=document.createElement("div");c.textContent="ðŸ¾",c.style.fontSize="32px",c.style.position="absolute",c.style.top="50%",c.style.left="50%",c.style.transform="translate(-50%, -50%)",c.style.zIndex="1",s.appendChild(c);}}catch(d){console.warn("[AbilitiesInject] Failed to load pet sprite:",e,d);const c=document.createElement("div");c.textContent="ðŸ¾",c.style.fontSize="32px",c.style.position="absolute",c.style.top="50%",c.style.left="50%",c.style.transform="translate(-50%, -50%)",c.style.zIndex="1",s.appendChild(c);}if(n){const d=AM(t),c=TM(t),p=document.createElement("div");p.className="gemini-ability-badge",p.textContent=d,p.style.cssText=`
      background: ${c.bg};
      color: white;
      padding: 4px;
      border-radius: 10px;
      min-width: ${r?"80px":"90px"};
      width: auto;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: ${r?"12px":"14px"};
      font-weight: bold;
      text-align: center;
    `,i.appendChild(s),i.appendChild(p);}else {const d=document.createElement("div");d.className="gemini-ability-badge",d.style.cssText=`
      background: var(--paper, var(--soft));
      padding: 4px;
      border-radius: 10px;
      min-width: ${r?"80px":"90px"};
      width: auto;
      display: flex;
      align-items: center;
      justify-content: center;
    `;const c=document.createElement("span");c.style.cssText=`
      font-size: ${r?"12px":"14px"};
      color: var(--fg);
      text-align: center;
      font-weight: normal;
      width: 100%;
    `,c.textContent="???",d.appendChild(c),i.appendChild(s),i.appendChild(d);}return i}function PM(e,t,n){return [...e.logged,...e.missing].map(o=>{const i=e.logged.includes(o);return IM(t,o,i,n)})}const ri="p.chakra-text.css-1qd26jh",Ph="p.chakra-text.css-12b1ql2";let Ti=[],Bp=null,$a=null,ns=false,$c=false;const nb="gemini-ability-entry";let tc=false;const Ao="gemini-overview-updated";let Bu=null;function MM(){const e=document.querySelector(ri);if(!e)return null;const t=e.textContent?.trim();if(!t||t==="???"||!document.querySelector(Ph))return null;const r=document.querySelectorAll("div.McGrid");let o=null;for(const i of r){const a=i.textContent||"",s=a.includes("Normal"),l=a.includes("Gold"),d=a.includes("Max Weight"),c=a.includes("Rainbow"),p=a.includes("???"),m=[s,l,d,c,p].filter(Boolean).length,b=a.includes("Crops")||a.includes("Pets"),g=a.includes("Collected"),w=a.includes("Back");if(m>=2&&!b&&!g&&!w){o=i;break}}return o?{speciesName:t,variantGrid:o}:null}function Jx(e){const t=we.get("pets")??{};for(const[r,o]of Object.entries(t)){const i=o;if(i.name===e||i.displayName===e||r===e)return r}const n=e.toLowerCase();for(const[r,o]of Object.entries(t)){const i=o,a=typeof i.name=="string"?i.name:void 0,s=typeof i.displayName=="string"?i.displayName:void 0;if(a&&a.toLowerCase()===n||s&&s.toLowerCase()===n||r.toLowerCase()===n)return r}return n.replace(/\s+/g,"")}function Qx(e){const t=we.get("pets")??{};return e in t}function Bc(){const e=document.querySelector(".gemini-journal-allTab");if(e){const o=e.querySelector(".gemini-allTab-tab");if(o instanceof HTMLElement&&o.offsetHeight>25)return "All"}const t=document.querySelectorAll("button");let n=null,r=null;for(const o of t){const i=o.textContent?.trim();i==="Crops"&&(n=o),i==="Pets"&&(r=o);}if(!n&&!r)return null;if(n&&r){const o=n.offsetHeight,i=r.offsetHeight;if(o>i)return "Crops";if(i>o)return "Pets";if(n.getAttribute("aria-selected")==="true")return "Crops";if(r.getAttribute("aria-selected")==="true")return "Pets"}return r&&r.offsetParent?"Pets":n&&n.offsetParent?"Crops":null}function Zx(){if(!Array.from(document.querySelectorAll("p.chakra-text")).find(i=>i.textContent?.includes("GARDEN JOURNAL"))||!Array.from(document.querySelectorAll("p.chakra-text")).find(i=>i.textContent?.match(/Collected\s+\d+%/)))return  false;const n=document.querySelector(ri);return n&&!n.textContent?.includes("GARDEN")?false:Bc()==="Pets"}function LM(){const e=Array.from(document.querySelectorAll("p.chakra-text")).find(w=>w.textContent?.match(/Collected\s+\d+%/));if(!e||Bc()!=="Pets")return  false;if(e.classList.contains(Ao))return  true;const n=e.querySelector("span.chakra-text");if(!n)return  false;const r=n.textContent?.match(/\((\d+)\/(\d+)\)/);if(!r)return  false;const o=parseInt(r[1],10),i=parseInt(r[2],10),a=we.get("pets")??{},s=Object.keys(a).length*4,l=s*.25;if(Math.abs(i-s)>l)return  false;if(!e.hasAttribute("data-original-percent")){const w=e.textContent?.match(/Collected\s+(\d+)%/);w&&e.setAttribute("data-original-percent",w[1]);}n.hasAttribute("data-original-count")||n.setAttribute("data-original-count",n.textContent||"");let d=0,c=0;for(const w of Object.keys(a)){const _=Th(w),C=Ih(w);d+=_.length,c+=C.logged.length;}const p=o+c,m=i+d,b=Math.floor(p/m*100),g=e.childNodes[0];return g&&g.nodeType===Node.TEXT_NODE&&(g.textContent=`Collected ${b}% `),n.textContent=`(${p}/${m})`,e.classList.add(Ao),true}function RM(){we.get("pets");const e=document.querySelectorAll("p.chakra-text");for(const t of e){const n=t.textContent||"";if(!n.match(/^\d+\/\d+$/)||t.classList.contains(Ao))continue;const r=n.match(/^(\d+)\/(\d+)$/);if(!r)continue;const o=parseInt(r[1],10),i=parseInt(r[2],10);let a=null,s=t,l=false;for(;s&&!l;){if(s.classList.contains("McGrid")){const w=s.querySelectorAll("p.chakra-text");for(const _ of w){const C=_.textContent||"";if(C!=="???"&&!C.includes("/")&&C.length>2&&C.length<30){a=_,l=true;break}}}s=s.parentElement;}if(!a)continue;const d=a.textContent?.trim();if(!d)continue;const c=Jx(d);if(!c||!Qx(c))continue;const p=Th(c),m=Ih(c);if(p.length===0)continue;const b=o+m.logged.length,g=i+p.length;t.textContent=`${b}/${g}`,t.classList.add(Ao);}}function OM(){if(!Zx()){tc=false;return}if(!tc)try{const e=LM();RM(),e&&(tc=!0);}catch(e){console.error("[AbilitiesInject] Failed to update overview page:",e);}}function zp(){const e=Array.from(document.querySelectorAll("p.chakra-text")).find(t=>t.hasAttribute("data-original-percent"));if(e){const t=e.getAttribute("data-original-percent");if(t){const r=e.childNodes[0];r&&r.nodeType===Node.TEXT_NODE&&(r.textContent=`Collected ${t}% `);}e.removeAttribute("data-original-percent"),e.classList.remove(Ao);const n=e.querySelector("span.chakra-text");if(n){const r=n.getAttribute("data-original-count");r&&(n.textContent=r),n.removeAttribute("data-original-count");}}document.querySelectorAll(`.${Ao}`).forEach(t=>{t.classList.remove(Ao);}),tc=false;}function FM(){return window.innerWidth<768}function NM(e,t){const n=document.querySelector(Ph);if(!n)return;const r=n.textContent?.match(/Collected (\d+)\/(\d+)/);if(!r)return;const o=parseInt(r[1],10),i=parseInt(r[2],10),a=o+e,s=i+t;n.textContent=`Collected ${a}/${s}`;}function DM(e,t){try{$c=!0,vr();const n=Ih(t);if(n.total===0)return;const r=PM(n,t,FM());for(const o of r)e.appendChild(o),Ti.push(o);NM(n.logged.length,n.total),xa={logged:n.logged.length,total:n.total};}catch(n){console.error("[AbilitiesInject] Failed to inject:",n),vr();}finally{setTimeout(()=>{$c=false;},0);}}function $M(e,t){const n=document.querySelector(Ph);if(!n)return;const r=n.textContent?.match(/Collected (\d+)\/(\d+)/);if(!r)return;const o=parseInt(r[1],10),i=parseInt(r[2],10),a=o-e,s=i-t;n.textContent=`Collected ${a}/${s}`;}let xa=null;function vr(){xa&&($M(xa.logged,xa.total),xa=null);for(const e of Ti)e.remove();Ti=[],Bp=null,$c=false;}function uo(){if($c)return;const e=Bc();e!==Bu&&(Bu==="Pets"&&e!=="Pets"&&(zp(),vr()),Bu=e);const t=Bc();if(Zx()&&t==="Pets"){vr(),OM();return}zp();const n=MM();if(!n){vr();return}const r=Jx(n.speciesName);if(!r){vr();return}if(!Qx(r)){vr();return}r===Bp&&Ti.length>0&&Ti[0].isConnected||(Bp=r,DM(n.variantGrid,r));}function BM(){uo(),setTimeout(()=>{uo();},100),setTimeout(()=>{uo();},500),setTimeout(()=>{uo();},1e3),$a=new MutationObserver(e=>{for(const t of e)t.type==="childList"&&(t.addedNodes.forEach(n=>{if(n instanceof HTMLElement){if(n.classList.contains(nb)||Ti.includes(n))return;const r=n.textContent||"";(r.includes("GARDEN JOURNAL")||r.includes("Collected")||r.includes("Chicken")||r.includes("Bunny"))&&uo(),(n.matches?.(ri)||n.querySelector?.(ri))&&uo(),(n.matches?.("div.McGrid")||n.querySelector?.("div.McGrid"))&&uo();}}),t.removedNodes.forEach(n=>{if(n instanceof HTMLElement){if(n.classList.contains(nb))return;(n.matches?.(ri)||n.querySelector?.(ri))&&vr();}}));}),$a.observe(document.body,{childList:true,subtree:true});}function zM(){$a&&($a.disconnect(),$a=null),vr(),zp();}function jM(){ns||(ns=true,BM());}function GM(){ns&&(ns=false,zM());}function HM(){return ns}const UM={init:jM,destroy:GM,isEnabled:HM};function Vt(){const e=[];return {add(t){e.push(t);},run(){for(const t of e)try{t();}catch(n){console.warn("[CleanupTracker] Error during cleanup:",n);}},clear(){e.length=0;}}}function zo(e,t){e.add(()=>t.disconnect());}let nc=false;function Bi(){return nc}function lr(e){if(!nc){nc=true;try{e();}finally{nc=false;}}}const WM={Normal:"Normal: Harvest a {cropName} and log it without any mutations.",Wet:"Wet is the most common mutation, gained during the Rain weather event.",Chilled:"The Chilled mutation is gained during the Snow weather event.",Frozen:"The Frozen mutation is obtained from Wet crops during the Snow weather event, or Chilled crops during Rain.",Dawnlit:"The Dawnlit mutation is gained during the Dawn weather event.",Ambershine:"The Amberlit mutation is gained during the Amber Moon weather event.",Gold:"Gold is a rare mutation that appears in 1% of newly planted crops. Pets with the Gold Granter ability have a small chance to apply the Gold mutation to a random crop.",Rainbow:"Rainbow is a very rare mutation that appears in 0.1% of newly planted crops.  Pets with the Rainbow Granter ability have a small chance to apply the Rainbow mutation to a random crop.",Dawncharged:"Dawnbound: During the Dawn lunar event, place a {cropName} with the Dawnlit mutation adjacent to a Dawnbinder crop.",Ambercharged:"Amberbound: During the Amber Moon lunar event, place a {cropName} with the Amberlit mutation adjacent to a Moonbinder crop.","Max Weight":"Max weight applies only to size 100 crops (the largest possible). The size of a crop can be checked by hovering over its weight. Obtaining weight 100 crops can be achieved through Crop Size Boost pets."},VM={Normal:"Hatch a {petName} without any mutations",Gold:"All pets have a 1% base chance to hatch with the gold mutation; increase these chances with the Pet Mutation Boost abilities.",Rainbow:"All pets have a 0.1% base chance to hatch with the rainbow mutation; increase these chances with the Pet Mutation Boost abilities.","Max Weight":"Hatch a {petName} with a Max STR of 100, using Max Strength Boost ability is recommended while hatching"},qM={CommonEgg:["Worm","Snail","Bee"],UncommonEgg:["Chicken","Bunny","Dragonfly"],RareEgg:["Pig","Cow","Turkey"],WinterEgg:["SnowFox","Stoat","WhiteCaribou"],LegendaryEgg:["Squirrel","Turtle","Goat"],MythicalEgg:["Butterfly","Peacock","Capybara"]},XM={CommonEgg:"Common Eggs",UncommonEgg:"Uncommon Eggs",RareEgg:"Rare Eggs",WinterEgg:"Winter Eggs",LegendaryEgg:"Legendary Eggs",MythicalEgg:"Mythical Eggs"};function KM(e){for(const[t,n]of Object.entries(qM))if(n.includes(e))return XM[t]||t;return "Eggs"}function YM(e){return `Keep hatching ${KM(e)} to get a pet with this ability`}function JM(e,t){const n=WM[e];return n?n.replace(/\{cropName\}/g,t):`Obtain a ${e} ${t}`}function QM(e,t){const n=VM[e];return n?n.replace(/\{petName\}/g,t):`Obtain a ${e} ${t}`}let rc=null;function ZM(e){const t=document.createElement("div");return t.className="gemini-journal-hint",t.textContent=e,t.style.cssText=`
    position: fixed;
    background: var(--paper, rgba(45, 35, 28, 0.95));
    color: var(--fg);
    font-size: 11px;
    padding: 8px 12px;
    border-radius: 6px;
    max-width: 240px;
    z-index: 10000;
    pointer-events: none;
    box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    line-height: 1.4;
    opacity: 0;
    transform: scale(0.95);
    transition: opacity 0.1s ease, transform 0.1s ease;
    font-family: inherit;
    text-align: center;
  `,t}function eL(e,t){const n=t.getBoundingClientRect(),r=240,o=8;let i=n.left+n.width/2-r/2,a=n.top-40-o;i<8&&(i=8),i+r>window.innerWidth-8&&(i=window.innerWidth-r-8),a<8&&(a=n.bottom+o),e.style.left=`${i}px`,e.style.top=`${a}px`;}function rb(e,t){zc();const n=ZM(t);document.body.appendChild(n),eL(n,e),requestAnimationFrame(()=>{n.style.opacity="1",n.style.transform="scale(1)";}),rc=n;}function zc(){rc&&(rc.remove(),rc=null);}function Ad(e){const t=we.get("plants")??{};for(const[o,i]of Object.entries(t)){const a=i;if(a?.crop?.name===e)return {id:o,type:"crop"};if(a?.plant?.name===e)return {id:o,type:"crop"};if(o===e)return {id:o,type:"crop"}}const n=we.get("pets")??{};for(const[o,i]of Object.entries(n)){const a=i;if(a?.name===e)return {id:o,type:"pet"};if(a?.displayName===e)return {id:o,type:"pet"};if(o===e)return {id:o,type:"pet"}}const r=e.toLowerCase();for(const[o,i]of Object.entries(t)){const a=i;if(a?.crop?.name?.toLowerCase()===r)return {id:o,type:"crop"};if(a?.plant?.name?.toLowerCase()===r)return {id:o,type:"crop"};if(o.toLowerCase()===r)return {id:o,type:"crop"}}for(const[o,i]of Object.entries(n)){const a=i;if(a?.name?.toLowerCase()===r)return {id:o,type:"pet"};if(a?.displayName?.toLowerCase()===r)return {id:o,type:"pet"};if(o.toLowerCase()===r)return {id:o,type:"pet"}}return null}function e0(e,t){if(t==="crop"){const r=(we.get("plants")??{})[e];return r?.crop?.name||r?.plant?.name||e}else {const r=(we.get("pets")??{})[e];return r?.name||r?.displayName||e}}let Ba=Vt(),Ii=false;const t0="gemini-hint-attached";function tL(){const e=document.querySelectorAll(".chakra-text, p, span");for(const t of e){const n=t.textContent?.trim();if(n&&n!=="???"&&!n.includes("/")&&!n.includes("%")&&!(n==="Crops"||n==="Pets"||n==="All")&&!(n.includes("GARDEN")||n.includes("JOURNAL"))&&!n.includes("Collected")&&n.length>=3&&n.length<=20){const r=Ad(n);if(r)return {displayName:n,id:r.id,type:r.type}}}return null}function nL(){const e=document.querySelectorAll("button");for(const t of e){const n=t.textContent?.trim(),r=t.querySelector('[class*="MotionMcFlex"], .MotionMcFlex, div[style*="height: 35px"]');if(r&&r.offsetHeight>=30){if(n==="Crops")return "crops";if(n==="Pets")return "pets"}}return null}function rL(){const e=[],t=document.querySelectorAll("p"),n=document.querySelectorAll("span"),r=[...t,...n];for(const o of r){if(o.textContent?.trim()!=="???"||!o.offsetParent)continue;let a=o.parentElement,s=null;for(let l=0;l<4&&a&&!s;l++){const d=a.parentElement;if(!d)break;for(const c of Array.from(d.children)){if(!(c instanceof HTMLElement)||c===a)continue;const p=m=>{if(n0(m))return  true;for(const b of Array.from(m.children))if(b instanceof HTMLElement&&p(b))return  true;return  false};if(p(c)){s=d;break}}a=d;}s&&(s.classList.contains(t0)||e.push(s));}return e}function oL(){return Bt.getCropVariants()}function jp(){return Bt.getPetVariants()}function ob(e,t){return (t==="crops"?oL():jp())[e]??null}function n0(e){return e.style.backgroundImage&&e.style.backgroundImage.includes("Stamp")?true:window.getComputedStyle(e).backgroundImage.includes("Stamp")}function iL(e){let t=e.parentElement;for(let n=0;n<8&&t;n++){const r=t.querySelectorAll("div"),o=[];for(const i of r)n0(i)&&o.push(i);if(o.length>=4)return o;t=t.parentElement;}return []}function aL(e,t){let n=e.parentElement;for(let r=0;r<6&&n;r++){const o=[];for(const i of t)n.contains(i)&&o.push(i);if(o.length===1){const i=o[0];return t.indexOf(i)}n=n.parentElement;}return  -1}function sL(e,t){return t>jp().length&&e>=jp().length?"ability":"variant"}function lL(e){const t=tL();if(!t)return;const n=nL();if(!n)return;const r=iL(e);if(r.length===0)return;const o=aL(e,r);if(o===-1)return;let i="";if(n==="crops"){const d=ob(o,"crops");if(!d)return;i=JM(d,t.displayName);}else if(n==="pets")if(sL(o,r.length)==="variant"){const c=ob(o,"pets");if(!c)return;i=QM(c,t.displayName);}else i=YM(t.id);e.classList.add(t0);const a=()=>rb(e,i),s=()=>zc(),l=d=>{d.stopPropagation(),rb(e,i),setTimeout(()=>zc(),3e3);};e.addEventListener("mouseenter",a),e.addEventListener("mouseleave",s),e.addEventListener("click",l),Ba.add(()=>{e.removeEventListener("mouseenter",a),e.removeEventListener("mouseleave",s),e.removeEventListener("click",l);});}function r0(){const e=rL();if(e.length!==0)for(const t of e)lL(t);}function cL(){const e=new MutationObserver(()=>{Ii&&r0();});e.observe(document.body,{childList:true,subtree:true}),zo(Ba,e);}function dL(){Ii||(Ii=true,r0(),cL());}function uL(){Ii&&(Ii=false,Ba.run(),Ba.clear(),Ba=Vt(),zc());}function pL(){return Ii}const fL=Object.freeze(Object.defineProperty({__proto__:null,destroy:uL,init:dL,isEnabled:pL},Symbol.toStringTag,{value:"Module"}));function Ls(){const e=document.querySelectorAll('.chakra-box, [class*="Box"], div');for(const n of e)if(n.style.backgroundImage?.includes("GardenJournal")||window.getComputedStyle(n).backgroundImage?.includes("GardenJournal"))return n;const t=document.querySelectorAll(".chakra-text, p, span");for(const n of t)if(n.textContent?.includes("GARDEN JOURNAL")){let r=n.parentElement;for(let o=0;o<10&&r;o++){if(r.classList.contains("McGrid")||r.querySelector(".McGrid"))return r;r=r.parentElement;}}return null}function hL(){const e=Ls();if(!e)return null;const t=e.querySelectorAll(".McFlex");for(const n of t){const r=window.getComputedStyle(n);if((r.overflowY==="auto"||r.overflowY==="scroll")&&n.querySelector(":scope > .McGrid"))return n}return null}function o0(){const e=Ls();if(!e)return null;const t=e.querySelectorAll(".chakra-text, p, span");for(const n of t)if((n.textContent?.trim()??"").match(/Collected\s+\d+%/i))return n;return null}let di=Vt(),rs=false,Gr={filter:"all",sort:"default"};const i0="gemini-journal-filterSort";function gL(){const e=Ls();if(!e)return null;const t=e.querySelectorAll(".chakra-text, p, span");for(const n of t)if((n.textContent?.trim()??"").match(/Collected\s+\d+%/i))return n;return null}function mL(){const e=hL();return e?Array.from(e.querySelectorAll(":scope > .McGrid")).filter(n=>(n.textContent??"").match(/\d+\/\d+/)!==null):[]}function bL(){const e=document.createElement("div");e.className=i0,e.style.cssText=`
        display: flex;
        gap: 8px;
        padding: 6px 0;
        margin: 6px 0;
        flex-wrap: wrap;
        align-items: center;
        justify-content: center;
    `;const t=document.createElement("span");t.textContent="Filter:",t.style.cssText="color: #A88A6B; font-size: 11px;";const n=document.createElement("select");for(const[i,a]of [["all","All"],["missing","Missing"],["collected","Complete"]]){const s=document.createElement("option");s.value=i,s.textContent=a,n.appendChild(s);}n.style.cssText=`
        background: #D4C8B8;
        color: #3D3325;
        border: 1px solid #8B7355;
        border-radius: 4px;
        padding: 3px 6px;
        font-size: 10px;
        cursor: pointer;
    `,n.value=Gr.filter,n.onchange=()=>{Gr.filter=n.value,lr(()=>Gp());};const r=document.createElement("span");r.textContent="Sort:",r.style.cssText="color: #A88A6B; font-size: 11px; margin-left: 8px;";const o=document.createElement("select");for(const[i,a]of [["default","Default"],["alphabetical","A-Z"],["progress","By Progress"]]){const s=document.createElement("option");s.value=i,s.textContent=a,o.appendChild(s);}return o.style.cssText=n.style.cssText,o.value=Gr.sort,o.onchange=()=>{Gr.sort=o.value,lr(()=>Gp());},e.append(t,n,r,o),e}function vL(e,t){const n=e.querySelectorAll(".chakra-text, p, span");let r="",o=0;for(const i of n){const a=i.textContent?.trim()??"",s=a.match(/^(\d+)\/(\d+)$/);if(s){const l=parseInt(s[1]),d=parseInt(s[2]);o=d>0?l/d*100:0;continue}a!=="???"&&!a.includes("%")&&a.length>=2&&a.length<=25&&(r=a);}return !r&&o===0?null:{el:e,name:r||"???",progress:o,originalOrder:t}}function Gp(){const e=mL();if(e.length===0)return;const t=[];if(e.forEach((r,o)=>{const i=vL(r,o);i&&t.push(i);}),t.length===0)return;for(const r of t){let o=true;Gr.filter==="missing"?o=r.progress<100:Gr.filter==="collected"&&(o=r.progress===100),r.el.style.display=o?"":"none";}let n;switch(Gr.sort){case "alphabetical":n=[...t].sort((r,o)=>r.name.localeCompare(o.name));break;case "progress":n=[...t].sort((r,o)=>o.progress-r.progress);break;default:n=[...t].sort((r,o)=>r.originalOrder-o.originalOrder);}n.forEach((r,o)=>{r.el.style.order=String(o);});}function yL(){if(document.querySelector(`.${i0}`))return;const e=gL();if(!e||!e.closest(".McFlex"))return;const n=bL(),r=e.nextElementSibling;if(r&&e.parentElement)e.parentElement.insertBefore(n,r);else if(e.parentElement)e.parentElement.appendChild(n);else return;di.add(()=>n.remove());}function oc(){lr(()=>{yL(),Gp();});}let bo=null;function xL(){bo!==null&&clearTimeout(bo),bo=window.setTimeout(()=>{Bi()||oc(),bo=null;},200);}function wL(){setTimeout(oc,100),setTimeout(oc,400),setTimeout(oc,800);const e=new MutationObserver(()=>{Bi()||xL();});e.observe(document.body,{childList:true,subtree:true}),zo(di,e),di.add(()=>{bo!==null&&(clearTimeout(bo),bo=null);});}function CL(){Gr={filter:"all",sort:"default"},di.run(),di.clear(),di=Vt();}function SL(){rs||(rs=true,wL(),console.log("[JournalFilterSort] Initialized"));}function kL(){rs&&(rs=false,CL(),console.log("[JournalFilterSort] Destroyed"));}function _L(){return rs}const AL=Object.freeze(Object.defineProperty({__proto__:null,destroy:kL,init:SL,isEnabled:_L},Symbol.toStringTag,{value:"Module"}));let sr=Vt(),Vr=Vt(),os=false,Eo=false;const Ed="gemini-journal-allTab",Hp="gemini-journal-allOverlay";let wa="all",jc="default";function a0(){const e=Ls();if(!e)return null;const t=e.querySelectorAll(".chakra-text, p, span");for(const n of t){const r=n.textContent?.trim();if(r==="Crops"||r==="Pets"){const o=n.closest("button");if(o){const i=o.parentElement;if(i&&i.querySelectorAll("button").length>=2)return i}}}return null}function Mh(){const e=a0();if(!e)return {crops:null,pets:null};let t=null,n=null;const r=e.querySelectorAll("button");for(const o of r){const i=o.textContent?.trim();i==="Crops"&&(t=o),i==="Pets"&&(n=o);}return {crops:t,pets:n}}function EL(){const{crops:e,pets:t}=Mh();[e,t].forEach(n=>{if(!n)return;const r=n.querySelector("div");if(r){const o=r.querySelector("div");o instanceof HTMLElement&&(o.style.height="20px");}});}function s0(){const e=Ls();if(!e)return null;const t=e.querySelectorAll(".McGrid");for(const n of t){const r=n.querySelectorAll(":scope > .McFlex");for(const o of r){const i=window.getComputedStyle(o);if((i.overflow==="hidden"||i.overflowY==="hidden")&&(o.textContent?.includes("JOURNAL")||o.querySelector(".McGrid")))return o}}return null}function TL(e){return e<15?"#F98B4B":e<25?"#FC6D30":e<50?"#F3D32B":e<75?"#E9B52F":e<100?"#5EAC46":"#0B893F"}function IL(){const e=document.createElement("button");e.className=Ed,e.type="button",e.style.cssText=`
        background: transparent;
        border: none;
        cursor: pointer;
        height: 60px;
        padding: 0;
        margin: 0;
    `;const t=document.createElement("div");t.className="McFlex",t.style.cssText=`
        display: flex;
        align-items: flex-end;
        justify-content: center;
        height: 100%;
    `;const n=window.innerWidth<768,r=document.createElement("div");r.className="gemini-allTab-tab",r.style.cssText=`
        display: flex;
        align-items: flex-start;
        justify-content: center;
        width: ${n?"70px":"100px"};
        height: 20px;
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
        background: #5a7a6a;
        position: relative;
        border-left: 1px solid #6a9a82;
        border-right: 1px solid #6a9a82;
        border-top: 2px solid #7aba9a;
        overflow: hidden;
        transition: height 0.3s ease-in-out;
    `;const o=document.createElement("span");o.textContent="All",o.style.cssText=`
        font-size: ${n?"12px":"14px"};
        font-weight: bold;
        color: white;
        position: relative;
        z-index: 2;
    `,r.appendChild(o),t.appendChild(r),e.appendChild(t);const i=()=>{const a=window.innerWidth<768;r.style.width=a?"70px":"100px",o.style.fontSize=a?"12px":"14px";};return window.addEventListener("resize",i),sr.add(()=>window.removeEventListener("resize",i)),e.onmouseenter=()=>{Eo||(r.style.height="25px");},e.onmouseleave=()=>{Eo||(r.style.height="20px");},e.onclick=a=>{a.preventDefault(),a.stopPropagation(),lr(()=>RL());},e}function PL(e,t){const n=document.createElement("div");n.style.cssText=`
        display: grid;
        grid-template-columns: 50px 1fr;
        align-items: center;
        gap: 8px;
        cursor: pointer;
    `;const r=document.createElement("div");r.style.cssText=`
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
    `;const o=e.variantsLogged.length===0;if(o){const w=document.createElement("span");w.textContent="?",w.style.cssText="font-size: 24px; color: rgba(168, 138, 107, 0.6); font-weight: bold;",r.appendChild(w);}else try{if(ye.isReady()){const w=t==="crop"?"plant":"pet";let _=e.species;t==="crop"&&(e.species==="DawnCelestial"&&(_="DawnCelestialCrop"),e.species==="MoonCelestial"&&(_="MoonCelestialCrop"),e.species==="OrangeTulip"&&(_="Tulip"));const C=(P,O)=>{try{if(ye.has(P,O))return ye.toCanvas(P,O,{scale:.5})}catch{}return null},E=C(w,_)||(t==="crop"?C("tallplant",_):null)||C(w,_.toLowerCase())||(t==="crop"?C("tallplant",_.toLowerCase()):null);if(E)E.style.cssText="max-width: 46px; max-height: 46px; display: block;",r.appendChild(E);else {const P=document.createElement("span");P.textContent=t==="crop"?"🌱":"🐾",P.style.cssText="font-size: 20px;",r.appendChild(P);}}else {const w=document.createElement("span");w.textContent=t==="crop"?"🌱":"🐾",w.style.cssText="font-size: 20px;",r.appendChild(w);}}catch{const w=document.createElement("span");w.textContent=t==="crop"?"🌱":"🐾",w.style.cssText="font-size: 20px;",r.appendChild(w);}let i,a,s;if(t==="pet"){const w=e.abilitiesLogged?.length??0,_=e.abilitiesTotal??0;i=e.variantsLogged.length+w,a=e.variantsTotal+_,s=a>0?i/a*100:0;}else i=e.variantsLogged.length,a=e.variantsTotal,s=e.variantsPercentage;const l=TL(s),d=document.createElement("div");d.style.cssText=`
        position: relative;
        background: #D4C4A8;
        border-radius: 5px;
        padding: 6px 12px;
        overflow: hidden;
        flex: 1;
        min-width: 0;
    `;const c=document.createElement("div");c.style.cssText=`
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        width: ${s}%;
        background: ${l};
        border-radius: inherit;
        transition: width 0.3s ease;
    `;const p=document.createElement("div");p.style.cssText=`
        display: grid;
        grid-template-columns: 1fr auto;
        align-items: center;
        position: relative;
        z-index: 1;
    `;const m=e0(e.species,t),b=document.createElement("span");b.style.cssText="font-weight: bold; font-size: 13px; color: #3D3325; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;",b.textContent=o?"???":m;const g=document.createElement("span");return g.style.cssText=`font-size: 12px; font-weight: bold; color: ${s<100?"#8B6914":"#3D3325"}; margin-left: 4px; flex-shrink: 0;`,g.textContent=`${i}/${a}`,p.append(b,g),d.append(c,p),n.append(r,d),n.onclick=w=>{w.preventDefault(),w.stopPropagation(),ML(e.species,t);},n.onmouseenter=()=>{n.style.opacity="0.8";},n.onmouseleave=()=>{n.style.opacity="1";},n}function ML(e,t){lr(()=>Lh()),setTimeout(()=>{const{crops:n,pets:r}=Mh(),o=t==="crop"?n:r;o&&(o.click(),setTimeout(()=>{const i=s0();if(!i)return;const a=i.querySelectorAll(".McGrid");for(const s of a){const l=s.textContent??"";if(l.toLowerCase().includes(e.toLowerCase())||l.includes(e0(e,t))){s.click();break}}setTimeout(()=>{lr(()=>c0());},100);},200));},100);}function ib(e,t,n){const r=document.createElement("div");r.style.cssText="margin-bottom: 16px;";let o=0,i=0;for(const p of t)n==="pet"?(o+=p.variantsLogged.length+(p.abilitiesLogged?.length??0),i+=p.variantsTotal+(p.abilitiesTotal??0)):(o+=p.variantsLogged.length,i+=p.variantsTotal);const a=document.createElement("div"),s=n==="crop"?"#7cb342":"#9575cd";a.style.cssText=`
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 4px 0;
        margin-bottom: 12px;
        border-bottom: 2px solid rgba(212, 196, 168, 0.3);
    `;const l=document.createElement("span");l.textContent=e,l.style.cssText=`font-size: 16px; font-weight: 600; font-family: shrikhand, serif; color: ${s}; text-transform: uppercase;`;const d=document.createElement("span");d.textContent=`${o}/${i}`,d.style.cssText="color: #A88A6B; font-size: 12px; font-weight: bold;",a.append(l,d);const c=document.createElement("div");c.style.cssText="display: flex; flex-direction: column; gap: 12px; padding: 0 4px;";for(const p of t)c.appendChild(PL(p,n));return r.append(a,c),r}function l0(){const e=Bt.getMyJournal(),t=Bt.calculateProduceProgress(e),n=Bt.calculatePetProgress(e),r=document.createElement("div");r.className="gemini-journal-allContent",r.style.cssText=`
        padding: 12px 16px;
        flex: 1;
        overflow: hidden;
        display: flex;
        flex-direction: column;
    `;const o=document.createElement("div");o.style.cssText="text-align: center; padding-bottom: 8px;";const i=document.createElement("p");i.textContent="GARDEN JOURNAL",i.style.cssText="font-size: 20px; font-weight: bold; font-family: shrikhand, serif; color: #4F6981; margin-bottom: 4px;";const a=t.variantsLogged+n.variantsLogged+(n.abilitiesLogged??0),s=t.variantsTotal+n.variantsTotal+(n.abilitiesTotal??0),l=Math.floor(a/s*100),d=document.createElement("p");d.style.cssText="font-size: 14px; font-weight: bold; color: #4F6981; margin-top: -2px;",d.textContent=`Collected ${l}% `;const c=document.createElement("span");c.className="chakra-text",c.style.cssText="color: #A88A6B; font-size: 12px; font-weight: bold;",c.textContent=`(${a}/${s})`,d.appendChild(c);const p=document.createElement("div");p.style.cssText="height: 4px; background: #D4C4A8; border-radius: 9999px; opacity: 0.5; margin: 8px 0;",o.append(i,d,p);const m=document.createElement("div");m.style.cssText=`
        display: flex;
        gap: 12px;
        padding: 6px 0;
        margin-bottom: 8px;
        flex-wrap: wrap;
        align-items: center;
        justify-content: center;
    `;const b=document.createElement("span");b.textContent="Filter:",b.style.cssText="color: #A88A6B; font-size: 11px; font-weight: bold;";const g=document.createElement("select");for(const[O,F]of [["all","All"],["missing","Missing"],["complete","Complete"]]){const A=document.createElement("option");A.value=O,A.textContent=F,g.appendChild(A);}g.value=wa,g.style.cssText=`
        background: #D4C8B8;
        color: #3D3325;
        border: 1px solid #8B7355;
        border-radius: 4px;
        padding: 3px 8px;
        font-size: 10px;
        cursor: pointer;
    `,g.onchange=()=>{wa=g.value,sb();};const w=document.createElement("span");w.textContent="Sort:",w.style.cssText="color: #A88A6B; font-size: 11px; font-weight: bold; margin-left: 8px;";const _=document.createElement("select");for(const[O,F]of [["default","Default"],["az","A-Z"],["progress","By Progress"]]){const A=document.createElement("option");A.value=O,A.textContent=F,_.appendChild(A);}_.value=jc,_.style.cssText=g.style.cssText,_.onchange=()=>{jc=_.value,sb();},m.append(b,g,w,_);const C=document.createElement("div");C.className="gemini-all-scroll",C.style.cssText=`
        flex: 1;
        overflow-y: auto;
        padding-right: 4px;
    `,LL();const E=ab(t.speciesDetails,"crop"),P=ab(n.speciesDetails,"pet");if(E.length>0&&C.appendChild(ib("Crops",E,"crop")),P.length>0&&C.appendChild(ib("Pets",P,"pet")),E.length===0&&P.length===0){const O=document.createElement("div");O.style.cssText="text-align: center; padding: 40px 20px; color: #A88A6B; font-size: 14px;",O.textContent=wa==="missing"?"All entries are complete!":wa==="complete"?"No complete entries yet.":"No entries found.",C.appendChild(O);}return r.append(o,m,C),r}function ab(e,t){let n=e.filter(r=>{let o,i;t==="pet"?(o=r.variantsLogged.length+(r.abilitiesLogged?.length??0),i=r.variantsTotal+(r.abilitiesTotal??0)):(o=r.variantsLogged.length,i=r.variantsTotal);const a=i>0?o/i*100:0;switch(wa){case "missing":return a<100;case "complete":return a>=100;default:return  true}});return jc==="az"?n=[...n].sort((r,o)=>r.species.localeCompare(o.species)):jc==="progress"&&(n=[...n].sort((r,o)=>{const i=t==="pet"?r.variantsLogged.length+(r.abilitiesLogged?.length??0):r.variantsLogged.length,a=t==="pet"?r.variantsTotal+(r.abilitiesTotal??0):r.variantsTotal,s=a>0?i/a:0,l=t==="pet"?o.variantsLogged.length+(o.abilitiesLogged?.length??0):o.variantsLogged.length,d=t==="pet"?o.variantsTotal+(o.abilitiesTotal??0):o.variantsTotal;return (d>0?l/d:0)-s})),n}let zu=false;function LL(){if(zu)return;zu=true;const e=document.createElement("style");e.textContent=`
        .gemini-all-scroll::-webkit-scrollbar {
            width: 4px;
            height: 6px;
        }
        .gemini-all-scroll::-webkit-scrollbar-track {
            background: transparent;
        }
        .gemini-all-scroll::-webkit-scrollbar-thumb {
            background: rgba(85, 48, 20, 0.2);
            border-radius: 3px;
        }
        .gemini-all-scroll::-webkit-scrollbar-thumb:hover {
            background: rgba(110, 60, 24, 0.3);
        }
    `,document.head.appendChild(e),sr.add(()=>{e.remove(),zu=false;});}function sb(){const e=document.querySelector(`.${Hp}`);if(e){for(;e.firstChild;)e.firstChild.remove();e.appendChild(l0());}}function RL(){if(Eo)return;Eo=true;const t=document.querySelector(`.${Ed}`)?.querySelector(".gemini-allTab-tab");t&&(t.style.height="35px"),EL();const n=s0();if(!n){console.warn("[JournalAllTab] Cannot activate All tab: content wrapper not found"),Eo=false;return}const r=[];for(const a of Array.from(n.children))a instanceof HTMLElement&&!a.classList.contains(Hp)&&(r.push(a),a.style.visibility="hidden");Vr.add(()=>{for(const a of r)a.style.visibility="";});const o=document.createElement("div");o.className=Hp,o.style.cssText=`
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 10;
        background: transparent;
        display: flex;
        flex-direction: column;
    `,window.getComputedStyle(n).position==="static"&&(n.style.position="relative",Vr.add(()=>{n.style.position="";})),o.appendChild(l0()),n.appendChild(o),Vr.add(()=>o.remove()),OL(),console.log("[JournalAllTab] All tab activated");}function OL(){const e=o0();if(!e)return;const t=Bt.getMyJournal(),n=Bt.calculateProduceProgress(t),r=Bt.calculatePetProgress(t),o=n.variantsLogged+r.variantsLogged+(r.abilitiesLogged??0),i=n.variantsTotal+r.variantsTotal+(r.abilitiesTotal??0),a=Math.floor(o/i*100);if(!e.hasAttribute("data-original-percent")){const d=e.textContent?.match(/Collected\s+(\d+)%/);d&&e.setAttribute("data-original-percent",d[1]);}const s=e.querySelector("span.chakra-text");s&&!s.hasAttribute("data-original-count")&&s.setAttribute("data-original-count",s.textContent||"");const l=e.childNodes[0];l&&l.nodeType===Node.TEXT_NODE&&(l.textContent=`Collected ${a}% `),s&&(s.textContent=`(${o}/${i})`);}function FL(){const e=o0();if(!e)return;const t=e.getAttribute("data-original-percent");if(t){const r=e.childNodes[0];r&&r.nodeType===Node.TEXT_NODE&&(r.textContent=`Collected ${t}% `),e.removeAttribute("data-original-percent");}const n=e.querySelector("span.chakra-text");if(n){const r=n.getAttribute("data-original-count");r&&(n.textContent=r),n.removeAttribute("data-original-count");}}function Lh(){if(!Eo)return;Eo=false;const t=document.querySelector(`.${Ed}`)?.querySelector(".gemini-allTab-tab");t&&(t.style.height="20px"),Vr.run(),Vr=Vt(),FL(),console.log("[JournalAllTab] All tab deactivated");}function c0(){const e=a0();if(!e||e.querySelector(`.${Ed}`))return;const{crops:t,pets:n}=Mh();if(!t)return;const r=IL();e.insertBefore(r,t),sr.add(()=>r.remove());const o=()=>{lr(()=>Lh());};t&&(t.addEventListener("click",o),sr.add(()=>t.removeEventListener("click",o))),n&&(n.addEventListener("click",o),sr.add(()=>n.removeEventListener("click",o))),console.log("[JournalAllTab] Tab injected");}function ic(){lr(()=>{c0();});}let vo=null;function NL(){vo!==null&&clearTimeout(vo),vo=window.setTimeout(()=>{Bi()||ic(),vo=null;},200);}function DL(){setTimeout(ic,100),setTimeout(ic,400),setTimeout(ic,800);const e=new MutationObserver(()=>{Bi()||NL();});e.observe(document.body,{childList:true,subtree:true}),zo(sr,e),sr.add(()=>{vo!==null&&(clearTimeout(vo),vo=null);});}function $L(){Lh(),Vr.run(),Vr.clear(),sr.run(),sr.clear(),Vr=Vt(),sr=Vt();}function BL(){os||(os=true,DL(),console.log("[JournalAllTab] Initialized"));}function zL(){os&&(os=false,$L(),console.log("[JournalAllTab] Destroyed"));}function jL(){return os}const GL=Object.freeze(Object.defineProperty({__proto__:null,destroy:zL,init:BL,isEnabled:jL},Symbol.toStringTag,{value:"Module"}));function HL(){const e=Tc();rt(Dr.JOURNAL_HINTS,true),rt(Dr.JOURNAL_FILTER_SORT,true),e.register({id:"abilitiesInject",name:"Journal Abilities",description:"Shows pet abilities in journal modal",injection:UM,storageKey:Dr.ABILITIES_INJECT,defaultEnabled:true}),e.register({id:"journalHints",name:"Journal Hints",description:"Shows hints for missing journal entries on hover",injection:fL,storageKey:Dr.JOURNAL_HINTS,defaultEnabled:true}),e.register({id:"journalFilterSort",name:"Journal Filter/Sort",description:"Adds filter and sort controls to journal overview",injection:AL,storageKey:Dr.JOURNAL_FILTER_SORT,defaultEnabled:true}),e.register({id:"journalAllTab",name:"Journal All Tab",description:"Adds an All tab showing combined crops and pets view",injection:GL,storageKey:Dr.JOURNAL_ALL_TAB,defaultEnabled:true});}const lb=ut.JOURNAL,ju={injections:{abilitiesInject:true,journalHints:true,journalFilterSort:true,journalAllTab:true}};function UL(){const e=tt(lb,null);return e||(tt(ut.JOURNAL_CHECKER,null)&&rt(lb,ju),ju)}let ra=false;const Bt={init(){ra||(ra=true,UL(),wM(),HL());},destroy(){ra&&(ra=false,CM());},isReady(){return ra},getProgress(){return null},getMyJournal:Wx,getCropVariants:Vx,getPetVariants:qx,getAllMutations:yM,getPetAbilities:Xx,calculateProduceProgress:Kx,calculatePetProgress:Yx,aggregateJournalProgress:_d,getMissingSummary:xM,refresh:SM,dispatchUpdate:Eh},Rh=ut.BULK_FAVORITE,d0={enabled:false,position:"top-right"};function Rs(){return tt(Rh,d0)}function u0(e){rt(Rh,e);}function WL(e){const t=Rs();t.position=e,u0(t);}function p0(){return Rs().enabled}function VL(e){return typeof e=="object"&&e!==null&&"id"in e&&typeof e.id=="string"}async function qL(e){const t=Hn().get();if(!t?.items)return console.warn("[BulkFavorite] No inventory data available"),0;const n=new Set(t.favoritedItemIds??[]);let r=0;for(const o of t.items){if(!VL(o))continue;const i=n.has(o.id);e&&i||!e&&!i||(await xd(o.id,e),r++,await XL(50));}return console.log(`[BulkFavorite] ${e?"Favorited":"Unfavorited"} ${r} items`),r}function XL(e){return new Promise(t=>setTimeout(t,e))}let xl=false;const Up={init(){xl||(xl=true,console.log("✅ [MGBulkFavorite] Feature initialized"));},isReady(){return xl},DEFAULT_CONFIG:d0,STORAGE_KEY:Rh,loadConfig:Rs,saveConfig:u0,isEnabled:p0,setPosition:WL,bulkFavorite:qL,destroy(){xl=false;}};class KL{constructor(){de(this,"achievements",new Map);de(this,"data");de(this,"STORAGE_KEY",ut.ACHIEVEMENTS);de(this,"onUnlockCallbacks",[]);de(this,"onProgressCallbacks",[]);this.data=this.loadData();}loadData(){return tt(this.STORAGE_KEY,{unlocked:{},progress:{}})}saveData(){rt(this.STORAGE_KEY,this.data);}register(t){this.achievements.set(t.id,t),this.data.progress[t.id]||(this.data.progress[t.id]={current:0,target:t.target,percentage:0});}registerMany(t){for(const n of t)this.register(n);}async checkAchievement(t){const n=this.achievements.get(t);if(!n)throw new Error(`Achievement not found: ${t}`);const r=this.isUnlocked(t),o=await n.checkProgress(),i={current:o,target:n.target,percentage:Math.min(100,Math.floor(o/n.target*100))},a=this.data.progress[t];this.data.progress[t]=i;const s=o>=n.target;return !r&&s?this.unlock(t,i):s||this.triggerProgressCallbacks({achievement:n,progress:i,previousProgress:a}),this.saveData(),{id:t,wasUnlocked:r,isUnlocked:s,progress:i}}async checkAllAchievements(){const t=[];for(const n of this.achievements.keys()){const r=await this.checkAchievement(n);t.push(r);}return t}unlock(t,n){const r=this.achievements.get(t);if(!r)return;const o={achievementId:t,unlockedAt:Date.now(),progress:n};this.data.unlocked[t]=o,this.saveData(),this.triggerUnlockCallbacks({achievement:r,unlockedAt:o.unlockedAt,progress:n});}isUnlocked(t){return !!this.data.unlocked[t]}getAchievement(t){return this.achievements.get(t)||null}getAllAchievements(){return Array.from(this.achievements.values())}getAchievementsByCategory(t){return Array.from(this.achievements.values()).filter(n=>n.category===t)}getAchievementsByRarity(t){return Array.from(this.achievements.values()).filter(n=>n.rarity===t)}getUnlockedAchievements(){return Object.values(this.data.unlocked)}getLockedAchievements(){return Array.from(this.achievements.values()).filter(t=>!this.isUnlocked(t.id)&&!t.hidden)}getProgress(t){return this.data.progress[t]||null}getCompletionPercentage(){const t=this.achievements.size,n=Object.keys(this.data.unlocked).length;return t>0?Math.floor(n/t*100):0}getCompletionStats(){const t=this.achievements.size,n=Object.keys(this.data.unlocked).length,r=t-n,o=this.getCompletionPercentage();return {total:t,unlocked:n,locked:r,percentage:o}}onUnlock(t){return this.onUnlockCallbacks.push(t),()=>{const n=this.onUnlockCallbacks.indexOf(t);n!==-1&&this.onUnlockCallbacks.splice(n,1);}}onProgress(t){return this.onProgressCallbacks.push(t),()=>{const n=this.onProgressCallbacks.indexOf(t);n!==-1&&this.onProgressCallbacks.splice(n,1);}}triggerUnlockCallbacks(t){for(const n of this.onUnlockCallbacks)try{n(t);}catch(r){console.warn("[Achievements] Unlock callback error:",r);}}triggerProgressCallbacks(t){for(const n of this.onProgressCallbacks)try{n(t);}catch(r){console.warn("[Achievements] Progress callback error:",r);}}reset(){this.data={unlocked:{},progress:{}};for(const t of this.achievements.values())this.data.progress[t.id]={current:0,target:t.target,percentage:0};this.saveData();}exportData(){return JSON.stringify(this.data,null,2)}importData(t){try{const n=JSON.parse(t);return this.data=n,this.saveData(),!0}catch(n){return console.warn("[Achievements] Failed to import data:",n),false}}}let za=null;function Nn(){return za||(za=new KL),za}function YL(){za&&(za=null);}let wl=false;const JL={init(){wl||(Nn(),wl=true,console.log("✅ [MGAchievements] Initialized"));},isReady(){return wl},getManager(){return Nn()},register:(...e)=>Nn().register(...e),registerMany:(...e)=>Nn().registerMany(...e),isUnlocked:(...e)=>Nn().isUnlocked(...e),getAll:()=>Nn().getAllAchievements(),getUnlocked:()=>Nn().getUnlockedAchievements(),getStats:()=>Nn().getCompletionStats(),checkAll:()=>Nn().checkAllAchievements(),onUnlock:(...e)=>Nn().onUnlock(...e),onProgress:(...e)=>Nn().onProgress(...e),destroy(){YL(),wl=false;}},QL={enabled:true},f0=ut.ANTI_AFK,ZL=["visibilitychange","blur","focus","focusout","pagehide","freeze","resume"],eR=25e3,tR=1,nR=1e-5,Ve={listeners:[],savedProps:{hidden:void 0,visibilityState:void 0,hasFocus:null},audioCtx:null,oscillator:null,gainNode:null,heartbeatInterval:null};function rR(){const e=(t,n)=>{const r=o=>{o.stopImmediatePropagation(),o.preventDefault?.();};t.addEventListener(n,r,{capture:true}),Ve.listeners.push({type:n,handler:r,target:t});};for(const t of ZL)e(document,t),e(window,t);}function oR(){for(const{type:e,handler:t,target:n}of Ve.listeners)try{n.removeEventListener(e,t,{capture:!0});}catch{}Ve.listeners.length=0;}function iR(){const e=Object.getPrototypeOf(document);Ve.savedProps.hidden=Object.getOwnPropertyDescriptor(e,"hidden"),Ve.savedProps.visibilityState=Object.getOwnPropertyDescriptor(e,"visibilityState"),Ve.savedProps.hasFocus=document.hasFocus?document.hasFocus.bind(document):null;try{Object.defineProperty(e,"hidden",{configurable:!0,get:()=>!1});}catch{}try{Object.defineProperty(e,"visibilityState",{configurable:!0,get:()=>"visible"});}catch{}try{document.hasFocus=()=>!0;}catch{}}function aR(){const e=Object.getPrototypeOf(document);try{Ve.savedProps.hidden&&Object.defineProperty(e,"hidden",Ve.savedProps.hidden);}catch{}try{Ve.savedProps.visibilityState&&Object.defineProperty(e,"visibilityState",Ve.savedProps.visibilityState);}catch{}try{Ve.savedProps.hasFocus&&(document.hasFocus=Ve.savedProps.hasFocus);}catch{}}function Gc(){Ve.audioCtx&&Ve.audioCtx.state!=="running"&&Ve.audioCtx.resume?.().catch(()=>{});}function sR(){try{const e=window.AudioContext||window.webkitAudioContext;Ve.audioCtx=new e({latencyHint:"interactive"}),Ve.gainNode=Ve.audioCtx.createGain(),Ve.gainNode.gain.value=nR,Ve.oscillator=Ve.audioCtx.createOscillator(),Ve.oscillator.frequency.value=tR,Ve.oscillator.connect(Ve.gainNode).connect(Ve.audioCtx.destination),Ve.oscillator.start(),document.addEventListener("visibilitychange",Gc,{capture:!0}),window.addEventListener("focus",Gc,{capture:!0});}catch{h0();}}function h0(){try{Ve.oscillator?.stop();}catch{}try{Ve.oscillator?.disconnect(),Ve.gainNode?.disconnect();}catch{}try{Ve.audioCtx?.close?.();}catch{}document.removeEventListener("visibilitychange",Gc,{capture:true}),window.removeEventListener("focus",Gc,{capture:true}),Ve.oscillator=null,Ve.gainNode=null,Ve.audioCtx=null;}function lR(){const e=document.querySelector("canvas")||document.body||document.documentElement;Ve.heartbeatInterval=window.setInterval(()=>{try{e.dispatchEvent(new MouseEvent("mousemove",{bubbles:!0,clientX:1,clientY:1}));}catch{}},eR);}function cR(){Ve.heartbeatInterval!==null&&(clearInterval(Ve.heartbeatInterval),Ve.heartbeatInterval=null);}function Gu(){iR(),rR(),sR(),lR();}function Hu(){cR(),h0(),oR(),aR();}let Cl=false,wn=false;function qo(){return tt(f0,QL)}function Uu(e){rt(f0,e);}const ui={init(){if(Cl)return;const e=qo();Cl=true,e.enabled?(Gu(),wn=true,console.log("[MGAntiAfk] Initialized and started")):console.log("[MGAntiAfk] Initialized but disabled");},isReady(){return Cl},isRunning(){return wn},isEnabled(){return qo().enabled},enable(){const e=qo();e.enabled=true,Uu(e),wn||(Gu(),wn=true,console.log("[MGAntiAfk] Enabled"));},disable(){const e=qo();e.enabled=false,Uu(e),wn&&(Hu(),wn=false,console.log("[MGAntiAfk] Disabled"));},toggle(){ui.isEnabled()?ui.disable():ui.enable();},getConfig(){return qo()},updateConfig(e){const n={...qo(),...e};Uu(n),n.enabled&&!wn?(Gu(),wn=true):!n.enabled&&wn&&(Hu(),wn=false);},destroy(){wn&&(Hu(),wn=false),Cl=false,console.log("[MGAntiAfk] Destroyed");}},g0=ut.PET_TEAM,dR={enabled:false,teams:[],activeTeamId:null},Oh=3,cb=50,Lt="";function qt(){return tt(g0,dR)}function Yr(e){rt(g0,e);}function uR(e){const n={...qt(),...e};return Yr(n),n}function pR(){return qt().enabled}function fR(e){uR({enabled:e});}function hR(){return crypto.randomUUID()}function Wp(){return Date.now()}function m0(e=[]){const t=[...e];for(;t.length<Oh;)t.push(Lt);return [t[0]||Lt,t[1]||Lt,t[2]||Lt]}function b0(e,t){const n=qt(),r=e.trim();return r?!n.teams.some(o=>o.name.trim()===r&&o.id!==t):false}function v0(e,t){const n=qt();if(!e.some(i=>i!==Lt))return  true;const o=[...e].sort().join(",");return !n.teams.some(i=>i.id===t?false:[...i.petIds].sort().join(",")===o)}function y0(e){const n=Bo().get(),r=new Set(n.all.map(i=>i.id)),o=qt();for(const i of o.teams)for(const a of i.petIds)a!==Lt&&r.add(a);for(const i of e)if(i!==Lt&&!r.has(i))return  false;return  true}function x0(e){const n=Bo().get(),r=new Map(n.all.map(i=>[i.id,i])),o=[];for(const i of e.petIds){if(i===Lt)continue;const a=r.get(i);a&&o.push(a);}return o}function gR(e){return e.petIds.every(t=>t!==Lt)}function mR(e){const t=[];for(let n=0;n<Oh;n++)e.petIds[n]===Lt&&t.push(n);return t}function bR(e){return e.petIds.filter(t=>t!==Lt).length}function vR(e){return e.petIds.every(t=>t===Lt)}function yR(e,t){return e.petIds.includes(t)}function xR(e,t){return e.petIds.indexOf(t)}function wR(e,t=[]){const n=qt();if(n.teams.length>=cb)throw new Error(`Maximum number of teams (${cb}) reached`);if(!b0(e))throw new Error(`Team name "${e}" already exists`);const r=e.trim();if(!r)throw new Error("Team name cannot be empty");const o=m0(t);if(!y0(o))throw new Error("One or more pet IDs do not exist");if(!v0(o))throw new Error("A team with this exact composition already exists");const i={id:hR(),name:r,petIds:o,createdAt:Wp(),updatedAt:Wp()};return n.teams.push(i),Yr(n),i}function w0(e,t){const n=qt(),r=n.teams.findIndex(a=>a.id===e);if(r===-1)return null;const o=n.teams[r];if(t.name!==void 0){const a=t.name.trim();if(!a)throw new Error("Team name cannot be empty");if(!b0(a,e))throw new Error(`Team name "${a}" already exists`);t.name=a;}if(t.petIds!==void 0){const a=m0(t.petIds);if(!y0(a))throw new Error("One or more pet IDs do not exist");if(!v0(a,e))throw new Error("A team with this exact composition already exists");t.petIds=a;}const i={...o,...t,id:o.id,createdAt:o.createdAt,updatedAt:Wp()};return n.teams[r]=i,Yr(n),i}function CR(e){const t=qt(),n=t.teams.length;return t.teams=t.teams.filter(r=>r.id!==e),t.teams.length===n?false:(Yr(t),true)}function SR(e){return qt().teams.find(n=>n.id===e)??null}function kR(){return [...qt().teams]}function _R(e){const t=qt(),n=e.trim();return t.teams.find(r=>r.name.trim()===n)??null}function AR(e){const t=qt(),n=new Map(t.teams.map(r=>[r.id,r]));if(e.length!==t.teams.length)return  false;for(const r of e)if(!n.has(r))return  false;return t.teams=e.map(r=>n.get(r)),Yr(t),true}function ER(e,t){try{return w0(e,{name:t})!==null}catch(n){return console.warn(`[PetTeam] Failed to rename team ${e}:`,n),false}}function TR(){const n=Bo().get().byLocation.active.map(o=>o.id).sort(),r=qt();for(const o of r.teams){const i=o.petIds.filter(a=>a!=="").sort();if(i.length===n.length&&i.every((a,s)=>a===n[s]))return o.id}return null}function C0(){const e=TR(),t=qt();return e!==t.activeTeamId&&(t.activeTeamId=e,Yr(t)),e}function S0(e){const t=qt();t.activeTeamId=e,Yr(t);}function IR(e){return C0()===e}function PR(e){const t=Bo(),n=Hn(),r=t.get();if(n.get().isFull)throw new Error("Cannot activate team: inventory is full");const i=r.byLocation.active,a=e.petIds.filter(c=>c!==Lt).sort(),s=i.map(c=>c.id).sort();if(JSON.stringify(a)===JSON.stringify(s)){console.log("[PetTeam] Team already active");return}const l=r.hutch,d=l.hasHutch?l.maxItems-l.currentItems:0;MR(e.petIds,d,r),S0(e.id),console.log("[PetTeam] Team activated successfully");}function MR(e,t,n){const r=n.byLocation.active;let o=t;console.log(`[PetTeam] Starting swap with ${t} hutch spaces available`);for(let i=0;i<Oh;i++){const a=e[i],s=r[i]??null;if(console.log(`[PetTeam] Slot ${i}: current=${s?.id.slice(0,8)??"empty"}, target=${a.slice(0,8)||"empty"}, hutchSpace=${o}`),s?.id===a){console.log(`[PetTeam] Slot ${i}: Same pet, skipping`);continue}if(a===Lt&&s){const l=o>0;console.log(`[PetTeam] Slot ${i}: Removing pet, storeInHutch=${l}`),LR(s.id,l),l&&o--;continue}if(!s&&a!==Lt){const d=n.all.find(c=>c.id===a)?.location==="hutch";console.log(`[PetTeam] Slot ${i}: Adding pet, fromHutch=${d}`),d&&o++,RR(a,n);continue}if(s&&a!==Lt){const d=n.all.find(p=>p.id===a)?.location==="hutch";d&&o++;const c=o>0;console.log(`[PetTeam] Slot ${i}: Swapping pets, fromHutch=${d}, storeInHutch=${c}`),OR(s.id,a,n,c),c&&o--;continue}}console.log(`[PetTeam] Swap complete, ${o} hutch spaces remaining`);}function LR(e,t){kx(e),t&&ah(e);}function RR(e,t){const n=t.all.find(r=>r.id===e);if(!n){console.warn(`[PetTeam] Pet ${e} not found`);return}n.location==="hutch"&&sh(e),Cx(e);}function OR(e,t,n,r){const o=n.all.find(i=>i.id===t);if(!o){console.warn(`[PetTeam] Pet ${t} not found`);return}o.location==="hutch"&&sh(t),Sx(e,t),r&&ah(e);}function FR(){try{return localStorage.getItem("aries_mod")!==null}catch(e){return console.warn("[PetTeam] Failed to access localStorage:",e),false}}function NR(){try{const e=localStorage.getItem("aries_mod");if(!e)return [];const n=JSON.parse(e)?.pets?.teams;return Array.isArray(n)?n.filter(r=>r&&typeof r=="object"):[]}catch(e){return console.warn("[PetTeam] Failed to read Aries teams:",e),[]}}function DR(e){const t=Date.now(),n=e.slots||[],r=[typeof n[0]=="string"?n[0]:Lt,typeof n[1]=="string"?n[1]:Lt,typeof n[2]=="string"?n[2]:Lt];return {name:e.name?.trim()||"Imported Team",petIds:r,createdAt:t,updatedAt:t}}function $R(){const e={success:false,source:"none",imported:0,errors:[]};if(!FR())return e.errors.push("Aries mod not detected. Install Aries mod first."),e;const t=NR();if(t.length===0)return e.errors.push("No teams found in Aries mod. Create teams in Aries first."),e;const n=qt();n.teams=[],n.activeTeamId=null;const r=new Set;for(const o of t)try{const i=DR(o);let a=i.name;if(r.has(a)){let l=1;for(;r.has(`${a} (${l})`);)l++;a=`${a} (${l})`;}r.add(a);const s={id:crypto.randomUUID(),name:a,petIds:i.petIds,createdAt:i.createdAt,updatedAt:i.updatedAt};n.teams.push(s),e.imported++;}catch(i){const a=i instanceof Error?i.message:String(i);e.errors.push(`Failed to import "${o.name}": ${a}`);}return e.imported>0&&(Yr(n),e.success=true,e.source="aries"),e}let Sl=false;const ze={init(){if(Sl)return;if(!qt().enabled){console.log("[PetTeam] Feature disabled");return}Sl=true,console.log("[PetTeam] Feature initialized");},destroy(){Sl&&(Sl=false,console.log("[PetTeam] Feature destroyed"));},isEnabled:pR,setEnabled:fR,createTeam:wR,updateTeam:w0,deleteTeam:CR,renameTeam:ER,getTeam:SR,getAllTeams:kR,getTeamByName:_R,reorderTeams:AR,getPetsForTeam:x0,isTeamFull:gR,getEmptySlots:mR,getFilledSlotCount:bR,isTeamEmpty:vR,isPetInTeam:yR,getPetSlotIndex:xR,getActiveTeamId:C0,setActiveTeamId:S0,isActiveTeam:IR,activateTeam:PR,importFromAries:$R},BR=["PetXpBoost","PetXpBoostII","PetXpBoostIII","SnowyPetXpBoost"],k0=ut.XP_TRACKER,zR={enabled:false,sortBy:"closestToMax",filterSpecies:[],filterHasXpBoost:false,updateIntervalMs:3e3,isPoppedOut:false,popOutPosition:null,collapsedSections:{activePets:false,allPets:false,xpBoostSummary:false}},pi="XP Tracker",fi="[XpTracker]";function zi(){return tt(k0,zR)}function _0(e){rt(k0,e);}function A0(e){const n={...zi(),...e};return _0(n),n}function E0(){return zi().enabled}function jR(e){A0({enabled:e});}function Fh(e){return BR.includes(e)}function GR(e){const t=we.get("abilities");if(!t)return null;const n=t[e];return !n||!Fh(e)?null:{id:e,name:n.name??"XP Boost",baseProbability:n.baseProbability??0,bonusXp:n.baseParameters?.bonusXp??0,requiredWeather:n.baseParameters?.requiredWeather??null}}function T0(e){return e.filter(Fh)}function I0(e){return e.some(Fh)}function HR(e){switch(e){case "PetXpBoost":return "I";case "PetXpBoostII":return "II";case "PetXpBoostIII":return "III";case "SnowyPetXpBoost":return "Snowy";default:return "I"}}function P0(e,t,n,r=100){const o=GR(e);if(!o)return null;const i=HR(e),a=o.requiredWeather,s=a===null||n===a,l=t/r,d=l*l,c=o.baseProbability,p=o.bonusXp,m=c,b=Math.floor(p*d),g=m/100*60,w=s?Math.floor(g*b):0;return {abilityId:e,abilityName:o.name,tier:i,baseChancePerMinute:c,actualChancePerMinute:m,baseXpPerProc:p,actualXpPerProc:b,expectedProcsPerHour:g,expectedXpPerHour:w,requiredWeather:a,isActive:s}}function M0(e,t){const n={totalBonusXpPerHour:0,totalProcsPerHour:0,activeBoosterCount:0,boosters:[]};for(const r of e){const o=T0(r.abilities);for(const i of o){const a=P0(i,r.strength,t,r.maxStrength||100);a&&(n.boosters.push({petId:r.petId,petName:r.petName,stats:a}),a.isActive&&(n.totalBonusXpPerHour+=a.expectedXpPerHour,n.totalProcsPerHour+=a.expectedProcsPerHour,n.activeBoosterCount++));}}return n}function L0(e,t,n,r=100){const o=T0(e);return o.length===0?null:P0(o[0],t,n,r)}function db(e,t){return e.hoursToMaxStrength-t.hoursToMaxStrength}function UR(e,t){return t.hoursToMaxStrength-e.hoursToMaxStrength}function WR(e,t){return e.species.localeCompare(t.species)}function VR(e,t){return t.currentStrength-e.currentStrength}function qR(e,t){const n={active:0,inventory:1,hutch:2};return n[e.location]-n[t.location]}function XR(e,t){return e.name.localeCompare(t.name)}function KR(e){switch(e){case "closestToMax":return db;case "furthestFromMax":return UR;case "species":return WR;case "strength":return VR;case "location":return qR;case "name":return XR;default:return db}}function R0(e,t){const n=KR(t);return [...e].sort(n)}function YR(e,t){return t.length===0?e:e.filter(n=>t.includes(n.species))}function JR(e,t){return t?e.filter(n=>n.xpBoostStats!==null):e}function O0(e,t){let n=e;return n=YR(n,t.filterSpecies),n=JR(n,t.filterHasXpBoost),n=R0(n,t.sortBy),n}function oa(e){const t=ze.getTeam(e);if(!t)return null;const n=F0(t);if(n.length===0)return {teamId:t.id,teamName:t.name,pets:[],teamSummary:{baseXpPerHour:Dt,bonusXpPerHour:0,totalXpPerHour:Dt,activeBoosterCount:0,totalProcsPerHour:0}};const r=Ge.weather.get(),o=r.isActive?r.type:null,i=n.filter(c=>!c.isMature||I0(c.abilities)).filter(c=>c.hunger>0).map(c=>({petId:c.id,petName:c.name??"",abilities:c.abilities,strength:c.currentStrength})),a=M0(i,o),s=[],l=QR(n,a.totalBonusXpPerHour);for(const c of n){const p=Vp(c,o,a.totalBonusXpPerHour,l);s.push(p);}const d={baseXpPerHour:Dt,bonusXpPerHour:a.totalBonusXpPerHour,totalXpPerHour:Dt+a.totalBonusXpPerHour,activeBoosterCount:a.activeBoosterCount,totalProcsPerHour:a.totalProcsPerHour};return {teamId:t.id,teamName:t.name,pets:s,teamSummary:d}}function F0(e){const t=Ge.myPets.get(),n=[];for(const r of e.petIds){if(!r)continue;const o=t.all.find(i=>i.id===r);o&&n.push(o);}return n}function QR(e,t){let n=0;for(const r of e){const o=Es(r.petSpecies,r.targetScale);if(Ts(r.petSpecies,r.xp,o)>=o)continue;const a=r.hunger>0?Dt+t:0,s=kd(r.petSpecies,r.xp,o,a>0?a:Dt);n=Math.max(n,s);}return n}function Vp(e,t,n,r){const o=Es(e.petSpecies,e.targetScale),i=Ts(e.petSpecies,e.xp,o),a=i>=o,s=e.hunger<=0,d=s?0:(s?0:Dt)+n,c=L0(e.abilities,i,t),p=a?null:bh(e.petSpecies,e.xp,i,o,d>0?d:Dt),m=kd(e.petSpecies,e.xp,o,d>0?d:Dt),b=p!==null?xh(e.petSpecies,e.hunger,p):null,g=ts(e.petSpecies,e.hunger,m),w=a&&c&&r>0?wh(true,true,e.petSpecies,e.hunger,0,r):null;return {id:e.id,name:e.name??"",species:e.petSpecies,currentStrength:i,maxStrength:o,isMaxStrength:a,xpPerHour:d,hoursToNextStrength:p,hoursToMaxStrength:m,feedsToNextStrength:b,feedsToMaxStrength:g,isStarving:s,hunger:e.hunger,xpBoostStats:c,supportingFeeds:w,mutations:e.mutations,targetScale:e.targetScale}}function ub(e){const t=ze.getTeam(e);if(!t)return 0;const n=F0(t);if(n.length===0)return 0;const r=n.map(o=>{const i=Es(o.petSpecies,o.targetScale);return Ts(o.petSpecies,o.xp,i)/i*100});return r.reduce((o,i)=>o+i,0)/r.length}function pb(e){if(!isFinite(e)||e<=0)return "0m";if(e<1)return `${Math.ceil(e*60)}m`;if(e<24)return `${e.toFixed(1)}h`;{const t=Math.floor(e/24),n=Math.floor(e%24);return `${t}d ${n}h`}}let Pi=false,ac=null,Td=[],Nh=null;function ZR(e,t,n){const r=Es(e.petSpecies,e.targetScale),o=Ts(e.petSpecies,e.xp,r),i=o>=r,a=e.hunger<=0,s=a?0:Dt,l=L0(e.abilities,o,t);l?.isActive&&l.expectedXpPerHour;const d=e.location==="active"&&!a?s+n:0,c=bh(e.petSpecies,e.xp,o,r,d>0?d:Dt),p=kd(e.petSpecies,e.xp,r,d>0?d:Dt),m=xh(e.petSpecies,e.hunger,c),b=ts(e.petSpecies,e.hunger,p);return {id:e.id,species:e.petSpecies,name:e.name,xp:e.xp,hunger:e.hunger,location:e.location,isStarving:a,currentStrength:o,maxStrength:r,isMaxStrength:i,hoursToNextStrength:c,hoursToMaxStrength:p,feedsToNextStrength:m,feedsToMaxStrength:b,baseXpPerHour:s,totalXpPerHour:d,xpBoostStats:l,targetScale:e.targetScale,abilities:e.abilities,mutations:e.mutations}}function N0(){const e=Ge.myPets.get(),t=Ge.weather.get(),n=t.isActive?t.type:null,o=e.byLocation.active.filter(l=>!l.isMature||I0(l.abilities)).filter(l=>l.hunger>0).map(l=>({petId:l.id,petName:l.name??"",abilities:l.abilities,strength:l.currentStrength})),i=M0(o,n);Nh=i;const a=[];for(const l of e.all){const d=ZR({id:l.id,petSpecies:l.petSpecies,name:l.name??"",xp:l.xp,hunger:l.hunger,targetScale:l.targetScale,abilities:l.abilities,mutations:l.mutations,location:l.location},n,i.totalBonusXpPerHour);a.push(d);}const s=Math.max(0,...a.map(l=>l.hoursToMaxStrength));for(const l of a)l.isMaxStrength&&l.xpBoostStats&&(l.feedsToMaxStrength=wh(true,true,l.species,l.hunger,0,s));return a}function D0(){if(Pi)return;if(!zi().enabled){console.log(`${fi} ${pi} disabled`);return}console.log(`${fi} Initializing ${pi}...`),we.isReady()&&(Td=N0()),Pi=true,console.log(`${fi} ${pi} initialized`);}function Dh(){return Pi&&we.isReady()}function $h(){return Dh()?Td:[]}function eO(){return $h().filter(e=>e.location==="active")}function tO(){return Nh}function Bh(){Dh()&&(Td=N0());}function nO(e){zh();const t=zi(),n=e??t.updateIntervalMs;ac=setInterval(()=>{E0()&&Bh();},n);}function zh(){ac&&(clearInterval(ac),ac=null);}function $0(){Pi&&(zh(),Pi=false,Td=[],Nh=null,console.log(`${fi} ${pi} destroyed`));}function rO(){const e=zi();return O0($h(),{sortBy:e.sortBy,filterSpecies:e.filterSpecies,filterHasXpBoost:e.filterHasXpBoost})}function oO(e){jR(e),e?(Pi=false,D0(),we.isReady()&&Bh(),console.log(`${fi} ${pi} enabled`)):($0(),console.log(`${fi} ${pi} disabled`));}const qp={init:D0,isReady:Dh,destroy:$0,loadConfig:zi,saveConfig:_0,updateConfig:A0,isEnabled:E0,setEnabled:oO,getAllPetsProgress:$h,getActivePetsProgress:eO,getCombinedBoostStats:tO,getFilteredPets:rO,refresh:Bh,startAutoUpdate:nO,stopAutoUpdate:zh,sortPets:R0,filterAndSortPets:O0},is={EggGrowthBoost:{procRate:.21,minutesPerProc:7},EggGrowthBoostII_NEW:{procRate:.24,minutesPerProc:9},EggGrowthBoostII:{procRate:.27,minutesPerProc:11},SnowyEggGrowthBoost:{procRate:.35,minutesPerProc:10}},as={PlantGrowthBoost:{procRate:.24,minutesPerProc:3},PlantGrowthBoostII:{procRate:.27,minutesPerProc:5},PlantGrowthBoostIII:{procRate:.3,minutesPerProc:7},SnowyPlantGrowthBoost:{procRate:.4,minutesPerProc:6}};[...Object.keys(is),...Object.keys(as)];function jh(e){const t=[];for(const n of e)for(const r of n.abilities)if(r in is){const o=is[r];t.push({petId:n.id,petName:n.name||n.petSpecies,abilityId:r,procRate:o.procRate,minutesPerProc:o.minutesPerProc});}return t}function Gh(e){const t=[];for(const n of e)for(const r of n.abilities)if(r in as){const o=as[r];t.push({petId:n.id,petName:n.name||n.petSpecies,abilityId:r,procRate:o.procRate,minutesPerProc:o.minutesPerProc});}return t}function ss(e){let t=0,n=0;for(const r of e){const o=r.procRate*60;t+=o,n+=o*r.minutesPerProc;}return {procsPerHour:t,timeReductionPerHour:n}}function hi(e){return e.some(t=>t.abilities.some(n=>n in is))}function gi(e){return e.some(t=>t.abilities.some(n=>n in as))}let ja=null;function B0(){const t=mt().get().plant;if(!t)return;const n=t.currentSlotIndex!==null?t.slots[t.currentSlotIndex]:null;n&&zn(n.species,n.targetScale,n.mutations||[]);}function iO(e){B0();}function aO(){ja&&z0(),B0(),ja=mt().subscribePlantInfo(iO,{immediate:true});}function z0(){ja&&(ja(),ja=null);}const Xp="css-qnqsp4",Kp="css-v439q6";let mi=Vt(),Yp=false,ia=false,sc=null,Jp=null,yo=null;const sO=`
  .gemini-qol-cropPrice {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    margin-top: 6px;
  }

  .gemini-qol-cropPrice-sprite {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    flex-shrink: 0;
  }

  .gemini-qol-cropPrice-text {
    font-size: 14px;
    color: #FFD84D;
    font-weight: 700;
  }

  @media (max-width: 768px) {
    .gemini-qol-cropPrice {
      gap: 4px;
      margin-top: 4px;
    }

    .gemini-qol-cropPrice-sprite {
      width: 16px;
      height: 16px;
    }

    .gemini-qol-cropPrice-text {
      font-size: 12px;
    }
  }
`;function lO(){if(Yp)return;const e=document.createElement("style");e.id="gemini-qol-cropPrice-styles",e.textContent=sO,document.head.appendChild(e),mi.add(()=>e.remove()),Yp=true;}function cO(e){const t=document.createElement("div");t.className="gemini-qol-cropPrice";const n=document.createElement("div");n.className="gemini-qol-cropPrice-sprite";const r=document.createElement("canvas");r.width=20,r.height=20,n.appendChild(r);const o=document.createElement("div");o.className="gemini-qol-cropPrice-text",o.textContent=e>0?e.toLocaleString():"",t.appendChild(n),t.appendChild(o);try{const i=ye.toCanvas("ui","Coin");if(i&&r.parentElement){const a=r.getContext("2d");if(a){const s=Math.min(r.width/i.width,r.height/i.height),l=i.width*s,d=i.height*s,c=(r.width-l)/2,p=(r.height-d)/2;a.drawImage(i,c,p,l,d);}}}catch(i){console.warn("[CropValueIndicator.render] Failed to render coin sprite:",i);}return t}function dO(e){const t=[],n=e.querySelectorAll("span.chakra-text");for(const r of n){const o=r.textContent?.trim();if(!o)continue;["Gold","Rainbow","Wet","Chilled","Frozen","Dawnlit","Dawnbound","Amberlit","Amberbound"].includes(o)&&t.push(o);}return t}function uO(e){const t=e.querySelectorAll("p.chakra-text");for(const n of t){const r=n.textContent?.trim();if(!r)continue;const o=r.match(/^([\d.]+)\s*kg$/i);if(o)return parseFloat(o[1])}return 1}function pO(){const e=[],t=document.querySelectorAll(`.${Xp}`);for(const r of t)r.offsetParent&&(r.closest("button.chakra-button")||e.push({element:r}));const n=document.querySelectorAll(`.${Kp}`);for(const r of n){if(!r.offsetParent||r.closest("button.chakra-button"))continue;const o=r.querySelectorAll(":scope > .McFlex > .McFlex");if(o.length>0){const i=o[o.length-1];i.querySelector("p.chakra-text")&&e.push({element:i});}}return e}function fO(){const t=mt().get().plant;if(!t)return 0;const n=t.currentSlotIndex!==null?t.slots[t.currentSlotIndex]:null;return n?zn(n.species,n.targetScale,n.mutations||[]):0}function hO(e,t){const n=document.querySelectorAll(".gemini-qol-cropPrice");for(const r of n){if(!r.offsetParent||r.closest("button.chakra-button"))continue;const o=r.querySelector(".gemini-qol-cropPrice-text");o&&(o.textContent=e>0?e.toLocaleString():"");}}function gO(){yo!==null&&cancelAnimationFrame(yo),yo=requestAnimationFrame(()=>{yo=null;const e=fO();if(e===Jp)return;Jp=e;const n=mt().get().plant;!n||!(n.currentSlotIndex!==null&&n.slots[n.currentSlotIndex])||hO(e);});}function aa(e){if(!e.element.querySelector(".gemini-qol-cropPrice"))try{const t=e.element.querySelector("p.chakra-text");if(!t)return;const n=t.closest(".McFlex");if(!n)return;const o=mt().get().plant;let i=0,a=null;if(o&&o.currentSlotIndex!==null){const l=o.slots[o.currentSlotIndex];l&&(a=l.species,i=zn(l.species,l.targetScale,l.mutations||[]));}if(i===0){const l=t.textContent?.trim();if(l){a=l;const d=uO(n),c=dO(n);i=zn(l,d,c);}}const s=cO(i);n.appendChild(s),mi.add(()=>s.remove());}catch(t){console.warn("[CropValueIndicator.render] Failed to inject price:",t);}}function mO(){const e=pO();for(const n of e)aa(n);sc=mt().subscribePlantInfo(()=>{gO();});const t=new MutationObserver(n=>{for(const r of n)r.type==="childList"&&r.addedNodes.forEach(o=>{if(o instanceof HTMLElement){if(o.classList.contains(Xp)&&(o.closest("button.chakra-button")||aa({element:o})),o.querySelectorAll(`.${Xp}`).forEach(s=>{s.closest("button.chakra-button")||aa({element:s});}),o.classList.contains(Kp)&&!o.closest("button.chakra-button")){const s=o.querySelectorAll(":scope > .McFlex > .McFlex");if(s.length>0){const l=s[s.length-1];l.querySelector("p.chakra-text")&&!l.querySelector(".gemini-qol-cropPrice")&&aa({element:l});}}o.querySelectorAll(`.${Kp}`).forEach(s=>{if(!s.closest("button.chakra-button")){const l=s.querySelectorAll(":scope > .McFlex > .McFlex");if(l.length>0){const d=l[l.length-1];d.querySelector("p.chakra-text")&&!d.querySelector(".gemini-qol-cropPrice")&&aa({element:d});}}});}});});t.observe(document.body,{childList:true,subtree:true}),zo(mi,t);}const bO={init(){ia||(ia=true,lO(),mO());},destroy(){ia&&(ia=false,yo!==null&&(cancelAnimationFrame(yo),yo=null),sc&&(sc(),sc=null),mi.run(),mi.clear(),mi=Vt(),Yp=false,Jp=null);},isEnabled(){return ia}},j0=ut.CROP_VALUE_INDICATOR,vO={enabled:false};function Hh(){return tt(j0,vO)}function yO(e){rt(j0,e);}let ls=false;function G0(){ls||!Hh().enabled||(ls=true,aO());}function H0(){ls&&(z0(),ls=false);}function xO(){return ls}function wO(){return Hh().enabled}function CO(e){const t=Hh();t.enabled!==e&&(t.enabled=e,yO(t),e?G0():H0());}const lc={init:G0,destroy:H0,isReady:xO,isEnabled:wO,setEnabled:CO,render:bO},cs="css-qnqsp4",Uh="css-1cdcuw7",Wh='[role="tooltip"]';let cc=Vt(),sa=false,dc=null,Qp=null,xo=null;function SO(){const e=[],t=document.querySelectorAll(`.${cs}`);for(const n of t){if(!n.offsetParent||n.closest("button.chakra-button"))continue;const r=n.querySelector(`.${Uh}`);r&&e.push({element:n,weightElement:r});}return e}function kO(){const t=mt().get().plant;if(!t)return 0;const n=t.currentSlotIndex!==null?t.slots[t.currentSlotIndex]:null;return n?gh(n.species,n.targetScale):0}function _O(e,t){const n=document.querySelectorAll(`.${cs}`);for(const r of n){if(!r.offsetParent||r.closest("button.chakra-button"))continue;const o=r.querySelector(`.${Uh}`);if(o){const i=o.querySelector("svg"),a=`${e}%`;o.textContent=a,i&&o.appendChild(i);}}Hc(),console.log("[CropSizeIndicator.render] 🔄 Updated all sizes:",{species:t.species,scale:t.targetScale,size:e,count:n.length});}function AO(){xo!==null&&cancelAnimationFrame(xo),xo=requestAnimationFrame(()=>{xo=null;const e=kO();if(e===Qp)return;Qp=e;const n=mt().get().plant;if(!n)return;const r=n.currentSlotIndex!==null?n.slots[n.currentSlotIndex]:null;r&&_O(e,r);});}function U0(e,t){const n=we.get("plants");if(!n)return "";const r=n[e];return r?.crop?.baseWeight?`${(r.crop.baseWeight*t).toFixed(2)} kg`:""}function Hc(){const e=document.querySelectorAll(Wh),n=mt().get().plant;if(!n||n.currentSlotIndex===null)return;const r=n.slots[n.currentSlotIndex];if(!r)return;const o=U0(r.species,r.targetScale);for(const i of e){if(!i.offsetParent)continue;const a=i.textContent?.trim();a&&a.startsWith("Size:")&&o&&(i.textContent=o);}}function Wu(){const e=SO();for(const t of e)if(t.weightElement)try{const r=mt().get().plant;if(r&&r.currentSlotIndex!==null){const o=r.slots[r.currentSlotIndex];if(o){const i=gh(o.species,o.targetScale),a=t.weightElement.querySelector("svg");t.weightElement.textContent=`${i}%`,a&&t.weightElement.appendChild(a);}}}catch(n){console.warn("[CropSizeIndicator.render] Failed to update size:",n);}Hc();}function EO(){const e=document.querySelectorAll(`.${cs}`),n=mt().get().plant;if(!n||n.currentSlotIndex===null)return;const r=n.slots[n.currentSlotIndex];if(!r)return;const o=U0(r.species,r.targetScale);for(const a of e){if(!a.offsetParent||a.closest("button.chakra-button"))continue;const s=a.querySelector(`.${Uh}`);if(s){const l=s.querySelector("svg");s.textContent=o,l&&s.appendChild(l);}}const i=document.querySelectorAll(Wh);for(const a of i){if(!a.offsetParent)continue;const s=a.textContent?.trim();s&&!s.includes("kg")&&(a.textContent=o);}console.log("[CropSizeIndicator.render] Restored crop weights");}function TO(){Wu(),dc=mt().subscribePlantInfo(()=>{AO();});const e=new MutationObserver(t=>{for(const n of t)n.type==="childList"&&n.addedNodes.forEach(r=>{if(r instanceof HTMLElement){if(r.hasAttribute("role")&&r.getAttribute("role")==="tooltip"){const a=r.textContent?.trim();a&&a.startsWith("Size:")&&Hc();}r.classList.contains(cs)&&(r.closest("button.chakra-button")||Wu()),r.querySelectorAll(`.${cs}`).length>0&&Wu(),r.querySelectorAll(Wh).forEach(a=>{const s=a.textContent?.trim();s&&s.startsWith("Size:")&&Hc();});}});});e.observe(document.body,{childList:true,subtree:true}),zo(cc,e),console.log("[CropSizeIndicator.render] Started observing crops");}const Vh={init(){if(sa){console.log("[CropSizeIndicator.render] Already initialized");return}sa=true,TO(),console.log("✅ [CropSizeIndicator.render] Initialized");},destroy(){sa&&(sa=false,EO(),xo!==null&&(cancelAnimationFrame(xo),xo=null),dc&&(dc(),dc=null),cc.run(),cc.clear(),cc=Vt(),Qp=null,console.log("🛑 [CropSizeIndicator.render] Destroyed"));},isEnabled(){return sa}},W0=ut.CROP_SIZE_INDICATOR,IO={enabled:false};function qh(){return tt(W0,IO)}function PO(e){rt(W0,e);}let ds=false;function V0(){if(ds){console.log("[CropSizeIndicator] Already initialized");return}if(!qh().enabled){console.log("[CropSizeIndicator] Disabled");return}ds=true,console.log("[CropSizeIndicator] Initializing..."),Vh.init(),console.log("[CropSizeIndicator] Initialized successfully");}function q0(){ds&&(console.log("[CropSizeIndicator] Destroying..."),Vh.destroy(),ds=false,console.log("[CropSizeIndicator] Destroyed"));}function MO(){return ds}function LO(){return qh().enabled}function RO(e){const t=qh();if(t.enabled===e){console.log(`[CropSizeIndicator] Already ${e?"enabled":"disabled"}`);return}t.enabled=e,PO(t),e?V0():q0(),console.log(`[CropSizeIndicator] ${e?"Enabled":"Disabled"}`);}const uc={init:V0,destroy:q0,isReady:MO,isEnabled:LO,setEnabled:RO,render:Vh},OO={Normal:{letter:"N",color:"#A88A6B",bold:false},Wet:{letter:"W",color:"rgba(76, 204, 204, 1)",bold:false},Chilled:{letter:"C",color:"rgba(144, 184, 204, 1)",bold:false},Frozen:{letter:"F",color:"rgba(148, 160, 204, 1)",bold:false},Dawnlit:{letter:"D",color:"rgb(245, 155, 225)",bold:false},Ambershine:{letter:"A",color:"rgb(255, 180, 120)",bold:false},Gold:{letter:"G",color:"linear-gradient(135deg, rgba(225, 200, 55, 0.9) 0%, rgba(225, 180, 10, 0.9) 40%, rgba(215, 185, 45, 0.9) 70%, rgba(210, 185, 45, 0.9) 100%)",bold:true,isGradient:true},Rainbow:{letter:"R",color:"linear-gradient(110deg, #ff003c, #ff9a00, #f0ff00, #30ff00, #00fbff, #0018ff, #e100ff)",bold:true,isGradient:true},Dawncharged:{letter:"D",color:"rgb(200, 150, 255)",bold:true},Ambercharged:{letter:"A",color:"rgb(250, 140, 75)",bold:true},"Max Weight":{letter:"S",color:"#717171",bold:false}};function FO(e){const t=OO[e];if(!t){const r=document.createElement("span");return r.textContent=e.charAt(0).toUpperCase(),r.style.cssText="color: #888; font-size: 18px;",r}const n=document.createElement("span");return n.textContent=t.letter,n.title=e,t.isGradient?n.style.cssText=`
            background: ${t.color};
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: bold;
            font-size: 18px;
            display: inline-block;
            filter: drop-shadow(0px 0px 1px rgba(0,0,0,1)) drop-shadow(0px 1px 1px rgba(0,0,0,1));
        `:n.style.cssText=`
            color: ${t.color};
            font-weight: ${t.bold?"bold":"normal"};
            font-size: 18px;
        `,n}function X0(e){const t=FO(e),n=t.textContent??e.charAt(0).toUpperCase(),r=t.getAttribute("style")??"";return {text:n,css:r}}const Zp="css-qnqsp4",ef="css-v439q6",Id="gemini-qol-missingVariants";let bi=Vt(),tf=false,la=false,pc=null,wo=null;const NO=`
  .${Id} {
    display: flex;
    gap: 6px;
    margin-top: 6px;
    flex-wrap: wrap;
    justify-content: center;
    align-items: center;
    width: 100%;
  }
`;function DO(){if(tf)return;const e=document.createElement("style");e.id="gemini-qol-missingVariants-styles",e.textContent=NO,document.head.appendChild(e),bi.add(()=>e.remove()),tf=true;}function fb(){return Bt.getCropVariants()}function K0(e){const t=Bt.getMyJournal();if(!t)return fb();const r=t.produce?.[e]?.variantsLogged?.map(i=>i.variant)??[];return fb().filter(i=>!r.includes(i))}function $O(e){const t=we.get("plants")??{};return e in t?true:Ad(e)?.type==="crop"}function BO(){const t=mt().get().plant;if(!t)return null;let n=null;if(t.currentSlotIndex!==null){const o=t.slots[t.currentSlotIndex];o&&(n=o.species);}return n||(n=t.species),Ad(n??"")?.id??n}function zO(e){const t=document.querySelectorAll(`.${Id}`),n=K0(e);for(const r of t){if(n.length===0){r.remove();continue}const o=Array.from(r.children).map(i=>i.title);if(JSON.stringify(o)!==JSON.stringify(n)){r.replaceChildren();for(const i of n){const a=X0(i),s=document.createElement("span");s.textContent=a.text,s.title=i,s.style.cssText=a.css,r.appendChild(s);}}}}function jO(){wo!==null&&cancelAnimationFrame(wo),wo=requestAnimationFrame(()=>{wo=null;const e=BO();if(!e)return;const t=Y0();for(const n of t)Yo(n);zO(e);});}function GO(e){if(!$O(e))return null;const t=K0(e);if(t.length===0)return null;const n=document.createElement("div");n.className=Id;for(const r of t){const o=X0(r),i=document.createElement("span");i.textContent=o.text,i.title=r,i.style.cssText=o.css,n.appendChild(i);}return n}function Y0(){const e=[],t=document.querySelectorAll(`.${Zp}`);for(const r of t)r.offsetParent&&(r.closest("button.chakra-button")||e.push({element:r}));const n=document.querySelectorAll(`.${ef}`);for(const r of n){if(!r.offsetParent||r.closest("button.chakra-button"))continue;const o=r.querySelectorAll(".McFlex");for(const i of o){const a=i.querySelector("p.chakra-text");if(a&&a.textContent&&!a.textContent.includes("%")){e.push({element:i});break}}}return e}function Yo(e){if(!e.element.querySelector(`.${Id}`))try{const t=e.element.querySelector("p.chakra-text");if(!t)return;const n=t.closest(".McFlex");if(!n)return;let r=null;const i=mt().get().plant;i&&(i.currentSlotIndex!==null&&i.slots[i.currentSlotIndex]?r=i.slots[i.currentSlotIndex].species:r=i.species);const a=t.textContent?.trim()??"",s=Ad(a);if(s?.type==="crop"&&(r=s.id),!r)return;const l=GO(r);l&&(lr(()=>{n.appendChild(l);}),bi.add(()=>l.remove()));}catch(t){console.warn("[MissingVariantsIndicator] Failed to inject:",t);}}function HO(){const e=Y0();for(const n of e)Yo(n);pc=mt().subscribePlantInfo(()=>{jO();});const t=new MutationObserver(n=>{for(const r of n)r.type==="childList"&&r.addedNodes.forEach(o=>{if(o instanceof HTMLElement){if(o.classList.contains(Zp)&&(o.closest("button.chakra-button")||Yo({element:o})),o.querySelectorAll(`.${Zp}`).forEach(s=>{s.closest("button.chakra-button")||Yo({element:s});}),o.classList.contains(ef)&&!o.closest("button.chakra-button")){const s=o.querySelectorAll(":scope > .McFlex > .McFlex");if(s.length>0){const l=s[s.length-1];l.querySelector("p.chakra-text")&&Yo({element:l});}}o.querySelectorAll(`.${ef}`).forEach(s=>{if(!s.closest("button.chakra-button")){const l=s.querySelectorAll(":scope > .McFlex > .McFlex");if(l.length>0){const d=l[l.length-1];d.querySelector("p.chakra-text")&&Yo({element:d});}}});}});});t.observe(document.body,{childList:true,subtree:true}),zo(bi,t);}async function UO(){for(let n=1;n<=5;n++){if(!Bt.isReady())try{Bt.init();}catch(o){console.warn("[MissingVariantsIndicator] Failed to init journal checker:",o);}if(Bt.getMyJournal())return console.log("[MissingVariantsIndicator] Journal data available"),true;n<5&&await new Promise(o=>setTimeout(o,1e3));}return console.warn("[MissingVariantsIndicator] Journal data not available, continuing anyway"),false}const Xh={init(){la||(la=true,DO(),HO(),UO().catch(e=>{console.warn("[MissingVariantsIndicator] Error waiting for journal data:",e);}));},destroy(){la&&(la=false,pc&&(pc(),pc=null),wo!==null&&(cancelAnimationFrame(wo),wo=null),bi.run(),bi.clear(),bi=Vt(),tf=false);},isEnabled(){return la}},J0=ut.MISSING_VARIANTS_INDICATOR,WO={enabled:false};function Kh(){return tt(J0,WO)}function VO(e){rt(J0,e);}let us=false;function Q0(){us||!Kh().enabled||(us=true,Xh.init(),console.log("✅ [MissingVariantsIndicator] Initialized"));}function Z0(){us&&(Xh.destroy(),us=false,console.log("🛑 [MissingVariantsIndicator] Destroyed"));}function qO(){return us}function XO(){return Kh().enabled}function KO(e){const t=Kh();t.enabled!==e&&(t.enabled=e,VO(t),e?Q0():Z0());}const Vu={init:Q0,destroy:Z0,isReady:qO,isEnabled:XO,setEnabled:KO,render:Xh},ew=ut.SHOP_NOTIFIER,tw={seed:[],tool:[],egg:[],decor:[]},YO={enabled:false,trackedItems:tw},JO=["seed","tool","egg","decor"];function nw(e){return {seed:Array.isArray(e?.seed)?[...e.seed]:[],tool:Array.isArray(e?.tool)?[...e.tool]:[],egg:Array.isArray(e?.egg)?[...e.egg]:[],decor:Array.isArray(e?.decor)?[...e.decor]:[]}}function Os(e){return {seed:[...e.seed],tool:[...e.tool],egg:[...e.egg],decor:[...e.decor]}}function ji(){const e=tt(ew,YO);return {enabled:e?.enabled??false,trackedItems:nw(e?.trackedItems)}}function Pd(e){rt(ew,{enabled:e.enabled,trackedItems:Os(e.trackedItems)});}function QO(e){const n={...ji(),...e};return e.trackedItems&&(n.trackedItems=nw(e.trackedItems)),Pd(n),n}function Yh(){return ji().enabled}function ZO(e){QO({enabled:e});}function rw(){return Os(ji().trackedItems)}function ow(){const e=rw(),t=[];for(const n of JO)for(const r of e[n])t.push({shopType:n,itemId:r});return t}function eF(e,t){const n=ji(),r=Os(n.trackedItems),o=r[e];if(o.includes(t))return;o.push(t),Pd({...n,trackedItems:r});const i=new CustomEvent("gemini:tracked-items-changed",{detail:{shopType:e,itemId:t,action:"add"}});window.dispatchEvent(i);}function iw(e,t){const n=ji(),r=Os(n.trackedItems),o=r[e],i=o.filter(s=>s!==t);if(i.length===o.length)return;r[e]=i,Pd({...n,trackedItems:r});const a=new CustomEvent("gemini:tracked-items-changed",{detail:{shopType:e,itemId:t,action:"remove"}});window.dispatchEvent(a);}function tF(){const e=ji();Pd({...e,trackedItems:Os(tw)});}let Uc=false;const nf=[];function nF(e,t){const n=rw()[e];if(!n.length)return [];const r=new Set(n);return t.items.filter(o=>r.has(o.id)&&o.isAvailable).map(o=>({itemId:o.id,remaining:o.remaining}))}function kl(e,t){const n=nF(e,t.shop);if(!n.length)return;console.log("[ShopNotifier] Tracked items restocked",{shopType:e,items:n});const r=new CustomEvent("gemini:shop-restock-tracked",{detail:{shopType:e,items:n}});window.dispatchEvent(r);}function rF(){if(Uc)return;Uc=true;const e=$i();nf.push(e.subscribeSeedRestock(t=>kl("seed",t)),e.subscribeToolRestock(t=>kl("tool",t)),e.subscribeEggRestock(t=>kl("egg",t)),e.subscribeDecorRestock(t=>kl("decor",t)));}function oF(){if(Uc){Uc=false;for(const e of nf)e();nf.length=0;}}const aw={Shovel:{shopType:"tool",maxQuantity:1},WateringCan:{shopType:"tool",maxQuantity:99},PetHutch:{shopType:"decor",maxQuantity:1},DecorShed:{shopType:"decor",maxQuantity:1}};function iF(e,t,n){const r=n.find(i=>typeof i=="object"&&i!==null&&"toolId"in i&&i.toolId===e);return r?(r.quantity??0)>=t:false}function aF(e,t,n){const r=n.find(d=>typeof d=="object"&&d!==null&&"decorId"in d&&d.decorId===e),o=r?r.quantity??0:0,s=Di().get().decors.all.filter(d=>typeof d=="object"&&d!==null&&"decorId"in d&&d.decorId===e).length;return o+s>=t}function sw(e,t,n,r){return t==="tool"?iF(e,n,r):t==="decor"?aF(e,n,r):false}function hb(e,t){const n=aw[e];if(!n||n.shopType!==t)return  false;const o=Hn().get();return sw(e,t,n.maxQuantity,o.items)}function gb(){const t=Hn().get(),n=ow();for(const r of n){const o=aw[r.itemId];o&&o.shopType===r.shopType&&sw(r.itemId,r.shopType,o.maxQuantity,t.items)&&(console.log(`[ShopNotifier] Auto-disabling tracking for ${r.itemId} (max quantity reached)`),iw(r.shopType,r.itemId));}}let Wc=false,fc=null;function sF(){if(Wc)return;Wc=true,fc=Hn().subscribeStable(()=>{gb();}),gb();}function lF(){Wc&&(Wc=false,fc&&(fc(),fc=null));}let ps=false;function lw(){if(ps){console.log("[ShopNotifier] Already initialized");return}if(!Yh()){console.log("[ShopNotifier] Disabled");return}ps=true,rF(),sF(),console.log("[ShopNotifier] Initialized");}function cw(){ps&&(oF(),lF(),ps=false,console.log("[ShopNotifier] Destroyed"));}function cF(){return ps}function dF(){return Yh()}function uF(e){if(Yh()===e){console.log(`[ShopNotifier] Already ${e?"enabled":"disabled"}`);return}ZO(e),e?lw():cw(),console.log(`[ShopNotifier] ${e?"Enabled":"Disabled"}`);}const Ro={init:lw,destroy:cw,isReady:cF,isEnabled:dF,setEnabled:uF,addTrackedItem:eF,removeTrackedItem:iw,getTrackedItems:ow,resetTrackedItems:tF},dw=ut.WEATHER_NOTIFIER,pF={enabled:false,trackedWeathers:[]};function uw(e){return Array.isArray(e)?[...e]:[]}function Md(e){return [...e]}function Fs(){const e=tt(dw,pF);return {enabled:e?.enabled??false,trackedWeathers:uw(e?.trackedWeathers)}}function Jh(e){rt(dw,{enabled:e.enabled,trackedWeathers:Md(e.trackedWeathers)});}function fF(e){const n={...Fs(),...e};return e.trackedWeathers&&(n.trackedWeathers=uw(e.trackedWeathers)),Jh(n),n}function pw(){return Fs().enabled}function hF(e){fF({enabled:e});}function Ld(){return Md(Fs().trackedWeathers)}function gF(e){return Ld().includes(e)}function mF(e){const t=Fs(),n=Md(t.trackedWeathers);if(n.includes(e))return;n.push(e);const r=!t.enabled&&n.length>0,o={trackedWeathers:n,enabled:r?true:t.enabled};Jh(o);const i=new CustomEvent("gemini:tracked-weathers-changed",{detail:{weatherId:e,action:"add",shouldReinit:r}});window.dispatchEvent(i);const a=new CustomEvent("gemini:weather-tracked-check",{detail:{weatherId:e}});window.dispatchEvent(a);}function bF(e){const t=Fs(),n=Md(t.trackedWeathers),r=n.filter(s=>s!==e);if(r.length===n.length)return;const o=t.enabled&&r.length===0,i={trackedWeathers:r,enabled:o?false:t.enabled};Jh(i);const a=new CustomEvent("gemini:tracked-weathers-changed",{detail:{weatherId:e,action:"remove",shouldReinit:o}});window.dispatchEvent(a);}let Ga=null,hc="Sunny",yr=false,Ha=null,Vc="";function fw(e){return `${e.soundId}:${e.volume}:${e.mode}`}function qc(e){const t=Ne.getItemCustomSound("weather",e);return t?{soundId:t.soundId,volume:t.volume,mode:t.mode}:Et.CustomSounds.getNotificationConfig("weather")}function vF(e){if(yr)return;const t=Et.CustomSounds.getById(e.soundId);if(t){Ha=t.source,yr=true,Vc=fw(e);try{Et.CustomSounds.play(e.soundId,{volume:e.volume/100,loop:!0});}catch{yr=false,Ha=null,Vc="";}}}function gc(){if(yr){try{const e=Et.getCustomHandle();(!Ha||e&&e.url===Ha)&&Et.CustomSounds.stop();}catch{}yr=false,Ha=null,Vc="";}}function fs(e,t){const n=t??qc(e);if(n.mode!=="loop"){yr&&gc();return}if(!Ld().includes(e)){yr&&gc();return}const i=fw(n);yr&&i!==Vc&&gc(),yr||vF(n);}function hw(e){const{weatherId:t}=e.detail||{};if(!t)return;const o=Ps().get().id,i=qc(t);if(o===t){console.log("[WeatherNotifier] Manually tracked weather is currently active:",t),i.mode==="one-shot"&&bw(i),fs(o,i);const a=new CustomEvent("gemini:weather-appeared",{detail:{weatherId:t}});window.dispatchEvent(a);}}function gw(){const t=Ps().get().id;fs(t);}function mw(e){if(e.detail?.entityType!=="weather")return;const r=Ps().get().id;fs(r);}function yF(){if(Ga){console.log("[WeatherNotifier] Already tracking");return}const e=Ps(),t=e.get();hc=t.id,console.log("[WeatherNotifier] Starting tracking, initial weather:",hc),window.addEventListener("gemini:weather-tracked-check",hw),window.addEventListener("gemini:tracked-weathers-changed",gw),window.addEventListener(xt.CUSTOM_SOUND_CHANGE,mw);const n=qc(t.id);fs(t.id,n),Ga=e.subscribeStable(r=>{const o=r.current.id,i=r.previous.id,a=qc(o);if(console.log("[WeatherNotifier] Weather changed:",{previous:i,current:o}),fs(o,a),o!==i&&Ld().includes(o)){console.log("[WeatherNotifier] Tracked weather detected:",o),a.mode==="one-shot"&&bw(a);const l=new CustomEvent("gemini:weather-appeared",{detail:{weatherId:o}});window.dispatchEvent(l);}hc=o;}),console.log("[WeatherNotifier] Tracking initialized");}function xF(){window.removeEventListener("gemini:weather-tracked-check",hw),window.removeEventListener("gemini:tracked-weathers-changed",gw),window.removeEventListener(xt.CUSTOM_SOUND_CHANGE,mw),Ga&&(Ga(),Ga=null,hc="Sunny",gc(),console.log("[WeatherNotifier] Tracking stopped"));}function bw(e){try{Et.CustomSounds.play(e.soundId,{volume:e.volume/100});}catch(t){console.warn("[WeatherNotifier] Failed to play notification sound:",t);}}let hs=false;function vw(e){const{shouldReinit:t}=e.detail||{};t&&(console.log("[WeatherNotifier] Config changed, reinitializing..."),xw(),yw());}function yw(){if(hs){console.log("[WeatherNotifier] Already initialized");return}if(hs=true,window.addEventListener("gemini:tracked-weathers-changed",vw),!pw()){console.log("[WeatherNotifier] Disabled (waiting for tracked weathers)");return}console.log("[WeatherNotifier] Initializing"),yF(),console.log("[WeatherNotifier] Initialized");}function xw(){hs&&(console.log("[WeatherNotifier] Destroying"),window.removeEventListener("gemini:tracked-weathers-changed",vw),xF(),hs=false,console.log("[WeatherNotifier] Destroyed"));}function wF(){return hs}const Mi={init:yw,destroy:xw,isReady:wF,isEnabled:pw,setEnabled:hF,getTrackedWeathers:Ld,addTrackedWeather:mF,removeTrackedWeather:bF,isWeatherTracked:gF},CF={enabled:false,threshold:5};function Rd(){return tt(ut.PET_HUNGER_NOTIFIER,CF)}function ww(e){rt(ut.PET_HUNGER_NOTIFIER,e);}function Cw(){return Rd().enabled}function SF(e){const t=Rd();t.enabled=e,ww(t);const n=new CustomEvent("gemini:pet-hunger-config-changed",{detail:{shouldReinit:true}});window.dispatchEvent(n);}function Sw(){return Rd().threshold}function kF(e){const t=Rd();t.threshold=e,ww(t);}let Ua=null;const mc=new Set;let qr=false,Wa=null;function _F(e){if(qr)return;const t=Et.CustomSounds.getById(e.soundId);if(t){Wa=t.source,qr=true;try{Et.CustomSounds.play(e.soundId,{volume:e.volume/100,loop:!0});}catch{qr=false,Wa=null;}}}function rf(){if(qr){try{const e=Et.getCustomHandle();(!Wa||e&&e.url===Wa)&&Et.CustomSounds.stop();}catch{}qr=false,Wa=null;}}function AF(e,t){if(t.mode!=="loop"){qr&&rf();return}e?qr||_F(t):qr&&rf();}function EF(){if(Ua){console.log("[PetHungerNotifier] Already tracking");return}const e=Bo(),t=Sw();console.log("[PetHungerNotifier] Starting tracking, threshold:",t+"%"),Ua=e.subscribe(n=>{const r=n.byLocation.active,o=Et.CustomSounds.getNotificationConfig("pet"),i=o.mode==="loop";let a=false;for(const s of r)if(s.hungerPercent<t){if(a=true,!mc.has(s.id)){console.log("[PetHungerNotifier] Pet hunger low:",{name:s.name||s.petSpecies,species:s.petSpecies,hungerPercent:s.hungerPercent.toFixed(2)+"%"}),i||IF(o);const l=new CustomEvent("gemini:pet-hunger-low",{detail:{pet:s}});window.dispatchEvent(l),mc.add(s.id);}}else mc.delete(s.id);AF(a,o);}),console.log("[PetHungerNotifier] Tracking initialized");}function TF(){Ua&&(Ua(),Ua=null,mc.clear(),rf(),console.log("[PetHungerNotifier] Tracking stopped"));}function IF(e){try{Et.CustomSounds.play(e.soundId,{volume:e.volume/100});}catch(t){console.warn("[PetHungerNotifier] Failed to play notification sound:",t);}}let gs=false;function kw(e){const{shouldReinit:t}=e.detail||{};t&&(console.log("[PetHungerNotifier] Config changed, reinitializing..."),Aw(),_w());}function _w(){if(gs){console.log("[PetHungerNotifier] Already initialized");return}if(gs=true,window.addEventListener("gemini:pet-hunger-config-changed",kw),!Cw()){console.log("[PetHungerNotifier] Disabled");return}console.log("[PetHungerNotifier] Initializing"),EF(),console.log("[PetHungerNotifier] Initialized");}function Aw(){gs&&(console.log("[PetHungerNotifier] Destroying"),window.removeEventListener("gemini:pet-hunger-config-changed",kw),TF(),gs=false,console.log("[PetHungerNotifier] Destroyed"));}function PF(){return gs}const ms={init:_w,destroy:Aw,isReady:PF,isEnabled:Cw,setEnabled:SF,getThreshold:Sw,setThreshold:kF},MF={apiBaseUrl:"https://ariesmod-api.ariedam.fr/"},Ew=ut.ARIES_API;function Qh(){return tt(Ew,MF)}function LF(e){rt(Ew,e);}function RF(e){const n={...Qh(),...e};return LF(n),n}let Xc=null,Kc=null;function mb(e){Xc=e;}function bb(e){Kc=e;}function OF(){return Xc?[...Xc]:[]}function FF(){return Kc?[...Kc]:[]}function vb(){Xc=null,Kc=null;}function Tw(e,t){const n=Qh(),r=new URL(e,n.apiBaseUrl);if(t)for(const[o,i]of Object.entries(t))i!==void 0&&r.searchParams.set(o,String(i));return r.toString()}function Od(e,t){return new Promise(n=>{const r=Tw(e,t);GM_xmlhttpRequest({method:"GET",url:r,headers:{},onload:o=>{if(o.status>=200&&o.status<300)try{const i=o.responseText?JSON.parse(o.responseText):null;n({status:o.status,data:i});}catch(i){console.error("[AriesAPI] GET parse error:",i,o.responseText),n({status:o.status,data:null});}else console.error("[AriesAPI] GET error:",o.status,o.responseText),n({status:o.status,data:null});},onerror:o=>{console.error("[AriesAPI] GET request failed:",o),n({status:0,data:null});}});})}function Fd(e,t){return new Promise(n=>{const r=Tw(e);GM_xmlhttpRequest({method:"POST",url:r,headers:{"Content-Type":"application/json"},data:JSON.stringify(t),onload:o=>{if(o.status>=200&&o.status<300)try{const i=o.responseText?JSON.parse(o.responseText):null;n({status:o.status,data:i});}catch(i){console.error("[AriesAPI] POST parse error:",i,o.responseText),n({status:o.status,data:null});}else console.error("[AriesAPI] POST error:",o.status,o.responseText),n({status:o.status,data:null});},onerror:o=>{console.error("[AriesAPI] POST request failed:",o),n({status:0,data:null});}});})}async function Zh(e=50){const{data:t}=await Od("rooms",{limit:e});return !t||!Array.isArray(t)?[]:t.map(n=>({id:n.id,isPrivate:n.is_private,playersCount:n.players_count??0,lastUpdatedAt:n.last_updated_at,lastUpdatedByPlayerId:n.last_updated_by_player_id,userSlots:Array.isArray(n.user_slots)?n.user_slots.map(r=>({name:r.name,avatarUrl:r.avatar_url??null})):void 0}))}async function NF(e,t){const n=e.trim(),r=t?.minQueryLength??2;if(n.length<r)return [];const o=t?.limitRooms??200,i=n.toLowerCase(),a=await Zh(o),s=[];for(const l of a){if(!l.userSlots||l.userSlots.length===0)continue;const d=l.userSlots.filter(c=>c.name?c.name.toLowerCase().includes(i):false);d.length>0&&s.push({room:l,matchedSlots:d});}return s}async function DF(e){if(!e)return null;const{status:t,data:n}=await Od("get-player-view",{playerId:e});return t===404?null:n}async function Nd(e,t){const n=Array.from(new Set((e??[]).map(a=>String(a).trim()).filter(a=>a.length>=3)));if(n.length===0)return [];const r={playerIds:n};t?.sections&&(r.sections=Array.isArray(t.sections)?t.sections:[t.sections]);const{status:o,data:i}=await Fd("get-players-view",r);return o!==200||!Array.isArray(i)?[]:i}async function $F(e,t){const n=e.trim(),r=t?.minQueryLength??2;if(n.length<r)return [];const o=t?.limitRooms??200,i=n.toLowerCase(),a=await Zh(o),s=new Map;for(const l of a)if(!(!l.userSlots||l.userSlots.length===0))for(const d of l.userSlots){if(!d.name||!d.name.toLowerCase().includes(i))continue;const p=`${l.id}::${d.name}`;s.has(p)||s.set(p,{playerName:d.name,avatarUrl:d.avatarUrl,roomId:l.id,roomPlayersCount:l.playersCount});}return Array.from(s.values())}async function Iw(e){if(!e)return [];const{status:t,data:n}=await Od("list-friends",{playerId:e});return t!==200||!n||!Array.isArray(n.friends)?[]:n.friends}async function BF(e){const t=await Iw(e);if(t.length===0)return mb([]),[];const n=await Nd(t,{sections:["profile","room"]});return mb(n),[...n]}async function eg(e){if(!e)return {playerId:"",incoming:[],outgoing:[]};const{status:t,data:n}=await Od("list-friend-requests",{playerId:e});return t!==200||!n?{playerId:e,incoming:[],outgoing:[]}:{playerId:n.playerId,incoming:Array.isArray(n.incoming)?n.incoming:[],outgoing:Array.isArray(n.outgoing)?n.outgoing:[]}}async function zF(e){const{incoming:t}=await eg(e),n=t.map(o=>o.fromPlayerId);if(n.length===0)return bb([]),[];const r=await Nd(n,{sections:["profile"]});return bb(r),[...r]}async function jF(e){const{outgoing:t}=await eg(e),n=t.map(r=>r.toPlayerId);return n.length===0?[]:Nd(n,{sections:["profile"]})}async function GF(e,t){if(!e||!t||e===t)return  false;const{status:n}=await Fd("friend-request",{fromPlayerId:e,toPlayerId:t});return n===204?true:(n===409&&console.warn("[AriesAPI] friend-request conflict (already exists)"),false)}async function HF(e){const{playerId:t,otherPlayerId:n,action:r}=e;if(!t||!n||t===n)return  false;const{status:o}=await Fd("friend-respond",{playerId:t,otherPlayerId:n,action:r});return o===204}async function UF(e,t){if(!e||!t||e===t)return  false;const{status:n}=await Fd("friend-remove",{playerId:e,otherPlayerId:t});return n===204}let ca=false;const Yc={init(){ca||(ca=true,console.log("[AriesAPI] Initialized"));},destroy(){ca&&(ca=false,vb(),console.log("[AriesAPI] Destroyed"));},isReady(){return ca},getConfig(){return Qh()},updateConfig(e){return RF(e)},fetchRooms:Zh,searchRoomsByPlayerName:NF,fetchPlayerView:DF,fetchPlayersView:Nd,searchPlayersByName:$F,fetchFriendsIds:Iw,fetchFriendsWithViews:BF,fetchFriendRequests:eg,fetchIncomingRequestsWithViews:zF,fetchOutgoingRequestsWithViews:jF,sendFriendRequest:GF,respondFriendRequest:HF,removeFriend:UF,getCachedFriends:OF,getCachedIncomingRequests:FF,clearCache:vb},yb={enabled:true,manualLocks:[],overallRules:[],speciesRules:{}};function Jc(){return `rule-${Date.now()}-${Math.random().toString(36).slice(2,9)}`}function WF(e){const t={enabled:e.enabled,manualLocks:e.manualLocks||[],overallRules:[],speciesRules:{}},n=e.globalCriteria?.lockByScale?.enabled,r=(e.globalCriteria?.lockedMutations?.length??0)>0;if(n||r){const o={id:Jc(),name:"Migrated Global Rule",enabled:true,mode:"lock",sizeCondition:n?{enabled:true,minPercentage:e.globalCriteria.lockByScale.minPercentage}:void 0,mutationCondition:r?{enabled:true,mutations:e.globalCriteria.lockedMutations,matchMode:"any"}:void 0};t.overallRules.push(o);}if(e.speciesOverrides)for(const[o,i]of Object.entries(e.speciesOverrides)){const a=i.lockByScale?.enabled,s=(i.lockedMutations?.length??0)>0;if(a||s){const l={id:Jc(),name:`Migrated ${o} Rule`,enabled:true,mode:"lock",sizeCondition:a?{enabled:true,minPercentage:i.lockByScale.minPercentage}:void 0,mutationCondition:s?{enabled:true,mutations:i.lockedMutations,matchMode:"any"}:void 0};t.speciesRules[o]=[l];}}return console.log("[HarvestLocker] Migrated legacy config to new format"),t}function VF(e){const t=e;return t!==null&&typeof t=="object"&&"globalCriteria"in t&&!("overallRules"in t)}function wt(){const e=tt(Jt.FEATURE.HARVEST_LOCKER,yb);if(VF(e)){const t=WF(e);return Mn(t),t}return {...yb,...e,manualLocks:e.manualLocks||[],overallRules:e.overallRules||[],speciesRules:e.speciesRules||{}}}function Mn(e){rt(Jt.FEATURE.HARVEST_LOCKER,e);}function Pw(e,t,n,r){return {id:Jc(),name:e,enabled:true,mode:t,sizeCondition:n,mutationCondition:r}}function qF(e){const t=wt();t.overallRules.push(e),Mn(t);}function XF(e,t){const n=wt();n.speciesRules[e]||(n.speciesRules[e]=[]),n.speciesRules[e].push(t),Mn(n);}function Mw(e,t){const n=wt(),r=n.overallRules.findIndex(o=>o.id===e);if(r!==-1){n.overallRules[r]={...n.overallRules[r],...t},Mn(n);return}for(const o of Object.keys(n.speciesRules)){const i=n.speciesRules[o].findIndex(a=>a.id===e);if(i!==-1){n.speciesRules[o][i]={...n.speciesRules[o][i],...t},Mn(n);return}}console.warn(`[HarvestLocker] Rule ${e} not found`);}function KF(e){const t=wt(),n=t.overallRules.findIndex(r=>r.id===e);if(n!==-1){t.overallRules.splice(n,1),Mn(t);return}for(const r of Object.keys(t.speciesRules)){const o=t.speciesRules[r].findIndex(i=>i.id===e);if(o!==-1){t.speciesRules[r].splice(o,1),t.speciesRules[r].length===0&&delete t.speciesRules[r],Mn(t);return}}console.warn(`[HarvestLocker] Rule ${e} not found`);}function YF(e,t){const n=wt(),r=n.overallRules.find(i=>i.id===e);if(!r){console.warn(`[HarvestLocker] Rule ${e} not found`);return}const o={...r,id:Jc(),name:`${r.name} (${t})`};n.speciesRules[t]||(n.speciesRules[t]=[]),n.speciesRules[t].push(o),Mn(n);}const To=new Set;let xr=null;const Qc=[];function JF(e){if(Qc.length>0){console.warn("[HarvestLocker] Already started");return}xr=e;const t=Di().subscribeStable(n=>{if(!n){To.clear();return}Lw(n);});Qc.push(t);}function QF(){Qc.forEach(e=>e()),Qc.length=0,To.clear(),xr=null,console.log("[HarvestLocker] Stopped");}function Jr(e){xr=e;const t=Di().get();t&&Lw(t);}function tg(e,t){const n=`${e}-${t}`;return To.has(n)}function ZF(){return Array.from(To)}function Lw(e){if(xr){if(To.clear(),xr.manualLocks.forEach(t=>To.add(t)),!oN(e)){console.warn("[HarvestLocker] Invalid garden structure"),window.dispatchEvent(new CustomEvent(xt.HARVEST_LOCKER_LOCKS_UPDATED));return}e.plants.all.forEach(t=>{t.slots.forEach((n,r)=>{const o=`${t.tileIndex}-${r}`,i=eN(n.species);tN(n,i)&&To.add(o);});}),window.dispatchEvent(new CustomEvent(xt.HARVEST_LOCKER_LOCKS_UPDATED));}}function eN(e){return xr?xr.speciesRules[e]?xr.speciesRules[e].filter(t=>t.enabled):xr.overallRules.filter(t=>t.enabled):[]}function tN(e,t){const n=t.filter(o=>o.mode==="lock"),r=t.filter(o=>o.mode==="allow");for(const o of n)if(xb(e,o))return  true;return r.length>0&&!r.some(i=>xb(e,i))}function xb(e,t){const n=[];if(t.sizeCondition?.enabled){const r=rN(e),o=t.sizeCondition.sizeMode??"max";n.push(o==="max"?r>=t.sizeCondition.minPercentage:r<=t.sizeCondition.minPercentage);}if(t.mutationCondition?.enabled&&t.mutationCondition.mutations.length>0){const r=nN(e.mutations,t.mutationCondition.mutations,t.mutationCondition.matchMode);n.push(r);}return n.length>0&&n.every(r=>r)}function nN(e,t,n){const r=t.includes("none"),o=t.filter(a=>a!=="none"),i=r&&e.length===0;return n==="any"?i?true:o.some(a=>e.includes(a)):r&&e.length>0?false:o.length===0?i:o.every(a=>e.includes(a))}function rN(e){const n=we.get("plants")?.[e.species];if(!n||typeof n!="object"||!("crop"in n))return 0;const r=n.crop;if(typeof r!="object"||!r)return 0;const{baseTileScale:o,maxScale:i}=r,a=i-o;return a===0?100:(e.targetScale-o)/a*100}function oN(e){return typeof e=="object"&&e!==null&&"plants"in e&&typeof e.plants=="object"&&e.plants!==null&&"all"in e.plants&&Array.isArray(e.plants.all)}function Dd(e,t){const n=new MutationObserver(o=>{for(const i of o)for(const a of i.addedNodes){if(!(a instanceof Element))continue;a.matches(e)&&t(a);const s=a.querySelectorAll(e);for(const l of s)t(l);}});n.observe(document.body,{childList:true,subtree:true});const r=document.querySelectorAll(e);for(const o of r)t(o);return {disconnect:()=>n.disconnect()}}function $d(e,t){const n=new MutationObserver(r=>{for(const o of r)for(const i of o.removedNodes){if(!(i instanceof Element))continue;i.matches(e)&&t(i);const a=i.querySelectorAll(e);for(const s of a)t(s);}});return n.observe(document.body,{childList:true,subtree:true}),{disconnect:()=>n.disconnect()}}const iN=`
/* Locked crop card: purple border + subtle glow (respects border-radius, no layout shift) */
.gemini-qol-harvestLocker-locked {
  position: relative !important;
  box-shadow: 0 0 0 2px #8B3E98, 0 0 8px rgba(139, 62, 152, 0.35) !important;
  transition: box-shadow 0.25s ease !important;
}

/* Lock icon badge: top-right corner */
#gemini-qol-harvestLocker-lock-icon {
  position: absolute;
  top: 4px;
  right: 4px;
  width: 22px;
  height: 22px;
  background: linear-gradient(135deg, #652E91, #8B3E98);
  border: 1px solid rgba(174, 83, 176, 0.6);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: none;
  z-index: 10;
  box-shadow: 0 2px 8px rgba(139, 62, 152, 0.45);
  animation: gemini-harvestLocker-glow 2.5s ease-in-out infinite;
}

/* Pulse subtile sur le badge */
@keyframes gemini-harvestLocker-glow {
  0%, 100% { box-shadow: 0 2px 8px rgba(139, 62, 152, 0.45); }
  50%      { box-shadow: 0 2px 14px rgba(139, 62, 152, 0.75); }
}

/* Icone lock avec ombre pour la profondeur */
#gemini-qol-harvestLocker-lock-icon svg {
  width: 12px;
  height: 12px;
  color: #F5F5F5;
  filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.4));
}
`,wb="css-qnqsp4",Rw="gemini-qol-harvestLocker-locked",of="gemini-qol-harvestLocker-lock-icon",af="gemini-qol-harvestLocker-styles",aN='<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" focusable="false"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>';let or=null,bc=false;const sf=[];function _l(e){sf.push(e);}function sN(){for(const e of sf)try{e();}catch(t){console.warn("[HarvestLocker Inject] Cleanup error:",t);}sf.length=0;}function lN(){if(bc)return;if(document.getElementById(af)){bc=true;return}const e=document.createElement("style");e.id=af,e.textContent=iN,document.head.appendChild(e),bc=true;}function cN(){document.getElementById(af)?.remove(),bc=false;}function dN(e){if(e.classList.add(Rw),!e.querySelector(`#${of}`)){const t=document.createElement("div");t.id=of,t.innerHTML=aN,e.appendChild(t);}}function Zc(e){e.classList.remove(Rw),e.querySelector(`#${of}`)?.remove();}function qu(){if(!or)return;const e=mt().get();if(!e.plant||e.position.localIndex===null||e.plant.nextHarvestSlotIndex===null){Zc(or),console.log("[HarvestLocker Inject] No plant data — overlay removed");return}const t=String(e.position.localIndex),n=e.plant.nextHarvestSlotIndex;tg(t,n)?(dN(or),console.log(`[HarvestLocker Inject] LOCKED — overlay applied (${e.plant.species} tile:${t} slot:${n})`)):(Zc(or),console.log(`[HarvestLocker Inject] unlocked — overlay removed (${e.plant.species} tile:${t} slot:${n})`));}function uN(){lN();const e=Dd(`.${wb}`,o=>{or=o,qu();});_l(()=>e.disconnect());const t=$d(`.${wb}`,o=>{or===o&&(Zc(o),or=null);});_l(()=>t.disconnect());const n=mt().subscribePlantInfo(()=>{qu();});_l(n);const r=()=>qu();window.addEventListener(xt.HARVEST_LOCKER_LOCKS_UPDATED,r),_l(()=>window.removeEventListener(xt.HARVEST_LOCKER_LOCKS_UPDATED,r)),console.log("[HarvestLocker Inject] Started");}function pN(){or&&(Zc(or),or=null),sN(),cN(),console.log("[HarvestLocker Inject] Stopped");}let Al=false;const Ow={init(){Al||(uN(),Al=true);},destroy(){Al&&(pN(),Al=false);},isEnabled(){return wt().enabled}},Fw=[];function fN(){return Fw.slice()}function hN(e){Fw.push(e);}function Nw(e){try{return JSON.parse(e)}catch{return}}function Cb(e){if(typeof e=="string"){const t=Nw(e);return t!==void 0?t:e}return e}function Dw(e){if(e!=null){if(typeof e=="string"){const t=Nw(e);return t!==void 0?Dw(t):e}if(Array.isArray(e)&&typeof e[0]=="string")return e[0];if(typeof e=="object"){const t=e;return t.type??t.Type??t.kind??t.messageType}}}function gN(e){const t=e?.MagicCircle_RoomConnection?.currentWebSocket;return t&&typeof t=="object"?t:null}function Re(e,t,n){const r=typeof t=="boolean"?t:true,o=typeof t=="function"?t:n,i=(a,s)=>{if(Dw(a)!==e)return;const d=o(a,s);return d&&typeof d=="object"&&"kind"in d?d:typeof d=="boolean"?d?void 0:{kind:"drop"}:r?void 0:{kind:"drop"}};return hN(i),i}const da=new WeakSet,Sb=new WeakMap;function mN(e){const t=e.pageWindow,n=!!e.debug,r=e.middlewares&&e.middlewares.length?e.middlewares:fN();if(!r.length)return ()=>{};const o=m=>({ws:m,pageWindow:t,debug:n}),i=(m,b)=>{let g=m;for(const w of r){const _=w(g,o(b));if(_){if(_.kind==="drop")return {kind:"drop"};_.kind==="replace"&&(g=_.message);}}return g!==m?{kind:"replace",message:g}:void 0};let a=null,s=null,l=null;const d=()=>{const m=t?.MagicCircle_RoomConnection,b=m?.sendMessage;if(!m||typeof b!="function")return  false;if(da.has(b))return  true;const g=b.bind(m);function w(..._){const C=_.length===1?_[0]:_,E=Cb(C),P=i(E,gN(t));if(P?.kind==="drop"){n&&console.log("[WS] drop outgoing (RoomConnection.sendMessage)",E);return}if(P?.kind==="replace"){const O=P.message;return _.length>1&&Array.isArray(O)?(n&&console.log("[WS] replace outgoing (RoomConnection.sendMessage)",E,"=>",O),g(...O)):(n&&console.log("[WS] replace outgoing (RoomConnection.sendMessage)",E,"=>",O),g(O))}return g(..._)}da.add(w),Sb.set(w,b);try{m.sendMessage=w,da.add(m.sendMessage),n&&console.log("[WS] outgoing patched via MagicCircle_RoomConnection.sendMessage");}catch{return  false}return a=()=>{try{m.sendMessage===w&&(m.sendMessage=b);}catch{}},true};(()=>{const m=t?.WebSocket?.prototype,b=m?.send;if(typeof b!="function"||da.has(b))return;function g(w){const _=Cb(w),C=i(_,this);if(C?.kind==="drop"){n&&console.log("[WS] drop outgoing (ws.send)",_);return}if(C?.kind==="replace"){const E=C.message,P=typeof E=="string"||E instanceof ArrayBuffer||E instanceof Blob?E:JSON.stringify(E);return n&&console.log("[WS] replace outgoing (ws.send)",_,"=>",E),b.call(this,P)}return b.call(this,w)}da.add(g),Sb.set(g,b);try{m.send=g,n&&console.log("[WS] outgoing patched via WebSocket.prototype.send");}catch{return}s=()=>{try{m.send===g&&(m.send=b);}catch{}};})();const p=e.waitForRoomConnectionMs??4e3;if(!d()&&p>0){const m=Date.now();l=setInterval(()=>{if(d()){clearInterval(l),l=null;return}Date.now()-m>p&&(clearInterval(l),l=null,n&&console.log("[WS] RoomConnection not found, only ws.send is patched"));},250);}return ()=>{if(l){try{clearInterval(l);}catch{}l=null;}if(a){try{a();}catch{}a=null;}if(s){try{s();}catch{}s=null;}}}(function(){try{const t=({ url: (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('__entry.js', document.baseURI).href) }),n=t.glob?.("./**/*.ts",{eager:!0})??t.glob?.("./**/*.js",{eager:!0});if(!n)return}catch{}})();Re(ge.HarvestCrop,(e,t)=>{if(!wt().enabled)return  true;const r=e,o=r.slot!==void 0?String(r.slot):void 0,i=r.slotsIndex;return o!==void 0&&typeof i=="number"&&tg(o,i)?(console.log(`[HarvestLocker] Blocked harvest for slot ${o}-${i}`),false):true});let Li=false;function $w(){if(Li){console.warn("[HarvestLocker] Already initialized");return}const e=wt();if(!e.enabled){console.log("[HarvestLocker] Disabled");return}Li=true,JF(e),Ow.init(),console.log("[HarvestLocker] Initialized");}function Bw(){Li&&(Ow.destroy(),QF(),Li=false,console.log("[HarvestLocker] Destroyed"));}function bN(){return wt().enabled}function vN(e){const t=wt();t.enabled=e,Mn(t),e&&!Li?$w():!e&&Li&&Bw();}function yN(e,t){return tg(e,t)}function xN(){return ZF()}function wN(e,t){const n=wt(),r=`${e}-${t}`;n.manualLocks.includes(r)||(n.manualLocks.push(r),Mn(n),Jr(n));}function CN(e,t){const n=wt(),r=`${e}-${t}`;n.manualLocks=n.manualLocks.filter(o=>o!==r),Mn(n),Jr(n);}function SN(){const e=wt();e.manualLocks=[],Mn(e),Jr(e);}function kN(){return wt()}function _N(){return wt().overallRules}function AN(e){return wt().speciesRules[e]||[]}function EN(){const e=wt();return Object.keys(e.speciesRules)}function TN(e,t,n,r){const o=Pw(e,t,n,r);return qF(o),Jr(wt()),o}function IN(e,t,n,r,o){const i=Pw(t,n,r,o);return XF(e,i),Jr(wt()),i}function PN(e,t){Mw(e,t),Jr(wt());}function MN(e){KF(e),Jr(wt());}function LN(e,t){Mw(e,{enabled:t}),Jr(wt());}const tn={init:$w,destroy:Bw,isEnabled:bN,setEnabled:vN,isLocked:yN,getAllLockedSlots:xN,lockSlot:wN,unlockSlot:CN,clearManualLocks:SN,getOverallRules:_N,getSpeciesRules:AN,getAllSpeciesWithRules:EN,addNewOverallRule:TN,addNewSpeciesRule:IN,modifyRule:PN,removeRule:MN,toggleRule:LN,cloneRuleToSpecies:YF,getConfig:kN},kb={enabled:true,blockedEggs:[]};function Pr(){const e=tt(Jt.FEATURE.EGG_LOCKER,kb);return {...kb,...e,blockedEggs:e.blockedEggs||[]}}function Bd(e){rt(Jt.FEATURE.EGG_LOCKER,e);}function RN(e){const t=Pr();t.blockedEggs.includes(e)||(t.blockedEggs.push(e),Bd(t),window.dispatchEvent(new CustomEvent(xt.EGG_LOCKER_LOCKS_UPDATED)));}function ON(e){const t=Pr();t.blockedEggs=t.blockedEggs.filter(n=>n!==e),Bd(t),window.dispatchEvent(new CustomEvent(xt.EGG_LOCKER_LOCKS_UPDATED));}const FN=`
/* Locked egg card: purple border + subtle glow (respects border-radius, no layout shift) */
.gemini-qol-eggLocker-locked {
  position: relative !important;
  box-shadow: 0 0 0 2px #8B3E98, 0 0 8px rgba(139, 62, 152, 0.35) !important;
  transition: box-shadow 0.25s ease !important;
}

/* Lock icon badge: top-right corner */
#gemini-qol-eggLocker-lock-icon {
  position: absolute;
  top: 4px;
  right: 4px;
  width: 22px;
  height: 22px;
  background: linear-gradient(135deg, #652E91, #8B3E98);
  border: 1px solid rgba(174, 83, 176, 0.6);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: none;
  z-index: 10;
  box-shadow: 0 2px 8px rgba(139, 62, 152, 0.45);
  animation: gemini-eggLocker-glow 2.5s ease-in-out infinite;
}

/* Pulse subtle sur le badge */
@keyframes gemini-eggLocker-glow {
  0%, 100% { box-shadow: 0 2px 8px rgba(139, 62, 152, 0.45); }
  50%      { box-shadow: 0 2px 14px rgba(139, 62, 152, 0.75); }
}

/* Icone lock avec ombre pour la profondeur */
#gemini-qol-eggLocker-lock-icon svg {
  width: 12px;
  height: 12px;
  color: #F5F5F5;
  filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.4));
}
`,_b="css-qnqsp4",zw="gemini-qol-eggLocker-locked",lf="gemini-qol-eggLocker-lock-icon",cf="gemini-qol-eggLocker-styles",NN='<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" focusable="false"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>';let ir=null,vc=false;const df=[];function El(e){df.push(e);}function DN(){for(const e of df)try{e();}catch(t){console.warn("[EggLocker Inject] Cleanup error:",t);}df.length=0;}function $N(){if(vc)return;if(document.getElementById(cf)){vc=true;return}const e=document.createElement("style");e.id=cf,e.textContent=FN,document.head.appendChild(e),vc=true;}function BN(){document.getElementById(cf)?.remove(),vc=false;}function zN(e){if(e.classList.add(zw),!e.querySelector(`#${lf}`)){const t=document.createElement("div");t.id=lf,t.innerHTML=NN,e.appendChild(t);}}function ed(e){e.classList.remove(zw),e.querySelector(`#${lf}`)?.remove();}function Xu(){if(!ir)return;const e=mt().get();if(e.object.type!=="egg"||!e.object.data){ed(ir);return}const t=e.object.data;Hr.getBlockedEggs().includes(t.eggId)?(zN(ir),console.log(`[EggLocker Inject] LOCKED — overlay applied (${t.eggId})`)):(ed(ir),console.log(`[EggLocker Inject] unlocked — overlay removed (${t.eggId})`));}function jN(){$N();const e=Dd(`.${_b}`,o=>{ir=o,Xu();});El(()=>e.disconnect());const t=$d(`.${_b}`,o=>{ir===o&&(ed(o),ir=null);});El(()=>t.disconnect());const n=mt().subscribeObject(()=>{Xu();});El(n);const r=()=>Xu();window.addEventListener(xt.EGG_LOCKER_LOCKS_UPDATED,r),El(()=>window.removeEventListener(xt.EGG_LOCKER_LOCKS_UPDATED,r)),console.log("[EggLocker Inject] Started");}function GN(){ir&&(ed(ir),ir=null),DN(),BN(),console.log("[EggLocker Inject] Stopped");}let Tl=false;const jw={init(){Tl||(jN(),Tl=true);},destroy(){Tl&&(GN(),Tl=false);},isEnabled(){return Pr().enabled}};Re(ge.HatchEgg,()=>{const e=Pr();if(!e.enabled)return  true;const t=mt().get();if(t.object.type!=="egg"||!t.object.data)return  true;const n=t.object.data.eggId;return e.blockedEggs.includes(n)?(console.log(`[EggLocker] Blocked hatch for ${n}`),false):(console.log(`[EggLocker] Allowed hatch for ${n}`),true)});let Ri=false;function Gw(){if(Ri)return;if(!Pr().enabled){console.log("[EggLocker] Disabled");return}Ri=true,jw.init(),console.log("[EggLocker] Initialized");}function Hw(){Ri&&(jw.destroy(),Ri=false,console.log("[EggLocker] Destroyed"));}function HN(){return Pr().enabled}function UN(e){const t=Pr();t.enabled=e,Bd(t),e&&!Ri?Gw():!e&&Ri&&Hw();}function WN(){const e=we.get("eggs");return e?Object.keys(e):[]}function VN(){return Pr().blockedEggs}function qN(e){RN(e);}function XN(e){ON(e);}function KN(){const e=Pr();e.blockedEggs=[],Bd(e);}const Hr={init:Gw,destroy:Hw,isEnabled:HN,setEnabled:UN,getAvailableEggs:WN,getBlockedEggs:VN,blockEgg:qN,unblockEgg:XN,clearBlocks:KN},Ab={enabled:true,blockedDecors:[]};function Un(){const e=tt(Jt.FEATURE.DECOR_LOCKER,Ab);return {...Ab,...e,blockedDecors:e.blockedDecors||[]}}function Ns(e){rt(Jt.FEATURE.DECOR_LOCKER,e);}function YN(e){const t=Un();t.blockedDecors.includes(e)||(t.blockedDecors.push(e),Ns(t),window.dispatchEvent(new CustomEvent(xt.DECOR_LOCKER_LOCKS_UPDATED)));}function JN(e){const t=Un();t.blockedDecors=t.blockedDecors.filter(n=>n!==e),Ns(t),window.dispatchEvent(new CustomEvent(xt.DECOR_LOCKER_LOCKS_UPDATED));}const QN=`
/* Locked decor card: purple border + subtle glow (respects border-radius, no layout shift) */
.gemini-qol-decorLocker-locked {
  position: relative !important;
  box-shadow: 0 0 0 2px #8B3E98, 0 0 8px rgba(139, 62, 152, 0.35) !important;
  transition: box-shadow 0.25s ease !important;
}

/* Lock icon badge: top-right corner */
#gemini-qol-decorLocker-lock-icon {
  position: absolute;
  top: 4px;
  right: 4px;
  width: 22px;
  height: 22px;
  background: linear-gradient(135deg, #652E91, #8B3E98);
  border: 1px solid rgba(174, 83, 176, 0.6);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: none;
  z-index: 10;
  box-shadow: 0 2px 8px rgba(139, 62, 152, 0.45);
  animation: gemini-decorLocker-glow 2.5s ease-in-out infinite;
}

/* Pulse subtle sur le badge */
@keyframes gemini-decorLocker-glow {
  0%, 100% { box-shadow: 0 2px 8px rgba(139, 62, 152, 0.45); }
  50%      { box-shadow: 0 2px 14px rgba(139, 62, 152, 0.75); }
}

/* Icone lock avec ombre pour la profondeur */
#gemini-qol-decorLocker-lock-icon svg {
  width: 12px;
  height: 12px;
  color: #F5F5F5;
  filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.4));
}
`,Eb="css-qnqsp4",Uw="gemini-qol-decorLocker-locked",uf="gemini-qol-decorLocker-lock-icon",pf="gemini-qol-decorLocker-styles",ZN='<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" focusable="false"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>';let ar=null,yc=false;const ff=[];function Il(e){ff.push(e);}function e5(){for(const e of ff)try{e();}catch(t){console.warn("[DecorLocker Inject] Cleanup error:",t);}ff.length=0;}function t5(){if(yc)return;if(document.getElementById(pf)){yc=true;return}const e=document.createElement("style");e.id=pf,e.textContent=QN,document.head.appendChild(e),yc=true;}function n5(){document.getElementById(pf)?.remove(),yc=false;}function r5(e){if(e.classList.add(Uw),!e.querySelector(`#${uf}`)){const t=document.createElement("div");t.id=uf,t.innerHTML=ZN,e.appendChild(t);}}function td(e){e.classList.remove(Uw),e.querySelector(`#${uf}`)?.remove();}function Ku(){if(!ar)return;const e=mt().get();if(e.object.type!=="decor"||!e.object.data){td(ar);return}const t=e.object.data;Ur.isDecorBlocked(t.decorId)?(r5(ar),console.log(`[DecorLocker Inject] LOCKED — overlay applied (${t.decorId})`)):(td(ar),console.log(`[DecorLocker Inject] unlocked — overlay removed (${t.decorId})`));}function o5(){t5();const e=Dd(`.${Eb}`,o=>{ar=o,Ku();});Il(()=>e.disconnect());const t=$d(`.${Eb}`,o=>{ar===o&&(td(o),ar=null);});Il(()=>t.disconnect());const n=mt().subscribeObject(()=>{Ku();});Il(n);const r=()=>Ku();window.addEventListener(xt.DECOR_LOCKER_LOCKS_UPDATED,r),Il(()=>window.removeEventListener(xt.DECOR_LOCKER_LOCKS_UPDATED,r)),console.log("[DecorLocker Inject] Started");}function i5(){ar&&(td(ar),ar=null),e5(),n5(),console.log("[DecorLocker Inject] Stopped");}let Pl=false;const Ww={init(){Pl||(o5(),Pl=true);},destroy(){Pl&&(i5(),Pl=false);},isEnabled(){return Un().enabled}};Re(ge.PickupDecor,()=>{const e=Un();if(!e.enabled)return  true;const t=mt().get();if(!t.object||t.object.type!=="decor"||!t.object.data)return  true;const n=t.object.data.decorId;return e.blockedDecors.includes(n)?(console.log(`[DecorLocker] Blocked pickup for ${n}`),false):(console.log(`[DecorLocker] Allowed pickup for ${n}`),true)});let Oi=false;function Vw(){if(Oi)return;if(!Un().enabled){console.log("[DecorLocker] Disabled");return}Oi=true,Ww.init(),console.log("[DecorLocker] Initialized");}function qw(){Oi&&(Ww.destroy(),Oi=false,console.log("[DecorLocker] Destroyed"));}function a5(){return Un().enabled}function s5(e){const t=Un();t.enabled=e,Ns(t),e&&!Oi?Vw():!e&&Oi&&qw();}function Xw(){const e=we.get("decor");return e?Object.keys(e):[]}function l5(){return Un().blockedDecors}function c5(e){return Un().blockedDecors.includes(e)}function d5(e){YN(e);}function u5(e){JN(e);}function p5(){const e=Xw(),t=Un();t.blockedDecors=e,Ns(t),window.dispatchEvent(new CustomEvent("gemini:decorLocker-locks-updated"));}function Kw(){const e=Un();e.blockedDecors=[],Ns(e),window.dispatchEvent(new CustomEvent("gemini:decorLocker-locks-updated"));}function f5(){Kw();}const Ur={init:Vw,destroy:qw,isEnabled:a5,setEnabled:s5,getAvailableDecors:Xw,getBlockedDecors:l5,isDecorBlocked:c5,blockDecor:d5,unblockDecor:u5,blockAllDecors:p5,unblockAllDecors:Kw,clearBlocks:f5};class Yw{constructor(){de(this,"stats");de(this,"STORAGE_KEY",ut.TRACKER_STATS);this.stats=this.loadStats(),this.startSession();}loadStats(){return tt(this.STORAGE_KEY,this.getDefaultStats())}saveStats(){rt(this.STORAGE_KEY,this.stats);}getDefaultStats(){return {session:{sessionStart:Date.now(),sessionEnd:null,coinsEarned:0,coinsSpent:0,cropsHarvested:0,cropsSold:0,petsHatched:0,petsSold:0,petsFed:0,seedsPurchased:0,eggsPurchased:0,abilityProcs:0},allTime:{totalSessions:0,totalPlayTime:0,coinsEarned:0,coinsSpent:0,cropsHarvested:0,cropsSold:0,petsHatched:0,petsSold:0,petsFed:0,seedsPurchased:0,eggsPurchased:0,abilityProcs:0,crops:{},pets:{}}}}startSession(){this.stats.session={sessionStart:Date.now(),sessionEnd:null,coinsEarned:0,coinsSpent:0,cropsHarvested:0,cropsSold:0,petsHatched:0,petsSold:0,petsFed:0,seedsPurchased:0,eggsPurchased:0,abilityProcs:0},this.stats.allTime.totalSessions++,this.saveStats();}endSession(){this.stats.session.sessionEnd=Date.now();const t=this.stats.session.sessionEnd-this.stats.session.sessionStart;this.stats.allTime.totalPlayTime+=t,this.saveStats();}recordHarvest(t,n=1,r=[]){this.stats.session.cropsHarvested+=n,this.stats.allTime.cropsHarvested+=n,this.stats.allTime.crops[t]||(this.stats.allTime.crops[t]={harvested:0,sold:0,totalValue:0,mutations:{}}),this.stats.allTime.crops[t].harvested+=n;for(const o of r)this.stats.allTime.crops[t].mutations[o]||(this.stats.allTime.crops[t].mutations[o]=0),this.stats.allTime.crops[t].mutations[o]++;this.saveStats();}recordCropSale(t,n=1,r=0){this.stats.session.cropsSold+=n,this.stats.session.coinsEarned+=r,this.stats.allTime.cropsSold+=n,this.stats.allTime.coinsEarned+=r,this.stats.allTime.crops[t]||(this.stats.allTime.crops[t]={harvested:0,sold:0,totalValue:0,mutations:{}}),this.stats.allTime.crops[t].sold+=n,this.stats.allTime.crops[t].totalValue+=r,this.saveStats();}recordPetHatch(t,n=[],r=[]){this.stats.session.petsHatched++,this.stats.allTime.petsHatched++,this.stats.allTime.pets[t]||(this.stats.allTime.pets[t]={hatched:0,sold:0,fed:0,mutations:{},abilities:{}}),this.stats.allTime.pets[t].hatched++;for(const o of n)this.stats.allTime.pets[t].mutations[o]||(this.stats.allTime.pets[t].mutations[o]=0),this.stats.allTime.pets[t].mutations[o]++;for(const o of r)this.stats.allTime.pets[t].abilities[o]||(this.stats.allTime.pets[t].abilities[o]=0),this.stats.allTime.pets[t].abilities[o]++;this.saveStats();}recordPetSale(t,n=0){this.stats.session.petsSold++,this.stats.session.coinsEarned+=n,this.stats.allTime.petsSold++,this.stats.allTime.coinsEarned+=n,this.stats.allTime.pets[t]||(this.stats.allTime.pets[t]={hatched:0,sold:0,fed:0,mutations:{},abilities:{}}),this.stats.allTime.pets[t].sold++,this.saveStats();}recordPetFeed(t){this.stats.session.petsFed++,this.stats.allTime.petsFed++,this.stats.allTime.pets[t]||(this.stats.allTime.pets[t]={hatched:0,sold:0,fed:0,mutations:{},abilities:{}}),this.stats.allTime.pets[t].fed++,this.saveStats();}recordSeedPurchase(t,n=1,r=0){this.stats.session.seedsPurchased+=n,this.stats.session.coinsSpent+=r,this.stats.allTime.seedsPurchased+=n,this.stats.allTime.coinsSpent+=r,this.saveStats();}recordEggPurchase(t,n=1,r=0){this.stats.session.eggsPurchased+=n,this.stats.session.coinsSpent+=r,this.stats.allTime.eggsPurchased+=n,this.stats.allTime.coinsSpent+=r,this.saveStats();}recordAbilityProc(t){this.stats.session.abilityProcs++,this.stats.allTime.abilityProcs++,this.saveStats();}recordCoinsEarned(t){this.stats.session.coinsEarned+=t,this.stats.allTime.coinsEarned+=t,this.saveStats();}recordCoinsSpent(t){this.stats.session.coinsSpent+=t,this.stats.allTime.coinsSpent+=t,this.saveStats();}getStats(){return {...this.stats}}getSessionStats(){return {...this.stats.session}}getAllTimeStats(){return {...this.stats.allTime}}getCropStats(t){return this.stats.allTime.crops[t]||null}getPetStats(t){return this.stats.allTime.pets[t]||null}getTopCrops(t=10){return Object.entries(this.stats.allTime.crops).map(([n,r])=>({species:n,stats:r})).sort((n,r)=>r.stats.harvested-n.stats.harvested).slice(0,t)}getTopPets(t=10){return Object.entries(this.stats.allTime.pets).map(([n,r])=>({species:n,stats:r})).sort((n,r)=>r.stats.hatched-n.stats.hatched).slice(0,t)}resetSession(){this.startSession();}resetAll(){this.stats=this.getDefaultStats(),this.saveStats();}exportStats(){return JSON.stringify(this.stats,null,2)}importStats(t){try{const n=JSON.parse(t);return this.stats=n,this.saveStats(),!0}catch(n){return console.warn("[StatsTracker] Failed to import stats:",n),false}}}let vi=null;function h5(){return vi||(vi=new Yw),vi}function g5(){vi&&(vi.endSession(),vi=null);}function Jw(e){const t=Cd(e.xp),n=Ss(e.petSpecies,e.targetScale),r=ks(e.petSpecies,e.xp,n),o=Sd(e.petSpecies,t),i=Px(e.petSpecies),a=BP(r,n,i),s=Mx(r,n);return {current:r,max:n,progress:s,age:t,isMature:o,strengthPerHour:i,hoursToMax:a}}function Qw(e){return {...e,strength:Jw(e)}}function Zw(e){return e.map(Qw)}function m5(e){if(e.length===0)return {averageCurrent:0,averageMax:0,totalMature:0,totalImmature:0,strongestPet:null,weakestPet:null};const t=Zw(e),n=t.reduce((l,d)=>l+d.strength.current,0),r=t.reduce((l,d)=>l+d.strength.max,0),o=t.filter(l=>l.strength.isMature).length,i=t.length-o,a=t.reduce((l,d)=>d.strength.max>(l?.strength.max||0)?d:l,t[0]),s=t.reduce((l,d)=>d.strength.max<(l?.strength.max||1/0)?d:l,t[0]);return {averageCurrent:Math.round(n/t.length),averageMax:Math.round(r/t.length),totalMature:o,totalImmature:i,strongestPet:a,weakestPet:s}}const b5=Object.freeze(Object.defineProperty({__proto__:null,calculatePetStrength:Jw,enrichPetWithStrength:Qw,enrichPetsWithStrength:Zw,getPetStrengthStats:m5},Symbol.toStringTag,{value:"Module"}));class eC{constructor(){de(this,"logs",[]);de(this,"maxLogs",1e3);de(this,"unsubscribe",null);de(this,"isInitialized",false);}init(){this.isInitialized||(this.unsubscribe=Ge.myPets.subscribeAbility(t=>{this.log({abilityId:t.trigger.abilityId||"unknown",petId:t.pet.id,petSpecies:t.pet.petSpecies,petName:t.pet.name,timestamp:t.trigger.performedAt||Date.now()});}),this.isInitialized=true);}log(t){const n={...t,id:`${t.timestamp}-${Math.random().toString(36).substr(2,9)}`};this.logs.push(n),this.logs.length>this.maxLogs&&(this.logs=this.logs.slice(-this.maxLogs));}getLogs(t){let n=this.logs;t?.abilityId&&(n=n.filter(o=>o.abilityId===t.abilityId)),t?.petId&&(n=n.filter(o=>o.petId===t.petId)),t?.petSpecies&&(n=n.filter(o=>o.petSpecies===t.petSpecies));const{since:r}=t??{};return r!==void 0&&(n=n.filter(o=>o.timestamp>=r)),t?.limit&&(n=n.slice(-t.limit)),n}getStats(t=36e5){const n=Date.now()-t,r=this.logs.filter(i=>i.timestamp>=n),o=new Map;for(const i of r){o.has(i.abilityId)||o.set(i.abilityId,{abilityId:i.abilityId,count:0,procsPerMinute:0,procsPerHour:0,lastProc:null});const a=o.get(i.abilityId);a.count++,(!a.lastProc||i.timestamp>a.lastProc)&&(a.lastProc=i.timestamp);}for(const i of o.values())i.procsPerMinute=i.count/t*6e4,i.procsPerHour=i.count/t*36e5;return o}getAbilityStats(t,n=36e5){return this.getStats(n).get(t)||null}getPetStats(t,n=36e5){const r=Date.now()-n,o=this.logs.filter(a=>a.petId===t&&a.timestamp>=r),i=new Map;for(const a of o){i.has(a.abilityId)||i.set(a.abilityId,{abilityId:a.abilityId,count:0,procsPerMinute:0,procsPerHour:0,lastProc:null});const s=i.get(a.abilityId);s.count++,(!s.lastProc||a.timestamp>s.lastProc)&&(s.lastProc=a.timestamp);}for(const a of i.values())a.procsPerMinute=a.count/n*6e4,a.procsPerHour=a.count/n*36e5;return {totalProcs:o.length,abilities:i}}getTopAbilities(t=10,n=36e5){return Array.from(this.getStats(n).values()).sort((o,i)=>i.count-o.count).slice(0,t)}clear(){this.logs=[];}setMaxLogs(t){this.maxLogs=t,this.logs.length>t&&(this.logs=this.logs.slice(-t));}getLogCount(){return this.logs.length}isActive(){return this.isInitialized}destroy(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null),this.logs=[],this.isInitialized=false;}}let Co=null;function v5(){return Co||(Co=new eC,Co.init()),Co}function y5(){Co&&(Co.destroy(),Co=null);}const x5={StatsTracker:Yw,getStatsTracker:h5,destroyStatsTracker:g5},w5={AbilityLogger:eC,getAbilityLogger:v5,destroyAbilityLogger:y5,...b5},Dn=[{id:"Rainbow",desc:"All Rainbow items"},{id:"Gold",desc:"All Gold items"},{id:"Wet",desc:"All Wet items"},{id:"Chilled",desc:"All Chilled items"},{id:"Frozen",desc:"All Frozen items"},{id:"Dawnlit",desc:"Dawn mutations"},{id:"Dawncharged",desc:"Dawn charged"},{id:"Ambershine",desc:"Amber mutations"},{id:"Ambercharged",desc:"Amber charged"}],C5={Common:1,Uncommon:2,Rare:3,Legendary:4,Mythical:5,Divine:6,Celestial:7};function Xo(e){return e?C5[e]??0:0}class S5 extends Tr{constructor(){super({id:"tab-auto-favorite",label:"Auto-Favorite"});de(this,"allPlants",[]);de(this,"allPets",[]);de(this,"sectionElement",null);}async build(n){await pM();const r=n.getRootNode();vt(r,Bx,"auto-favorite-settings-styles");const o=this.createGrid("12px");o.id="auto-favorite-settings",this.sectionElement=o,n.appendChild(o),await this.loadGameData(),await this.waitForSprites(),this.renderContent();}async loadGameData(){try{await we.waitForAny(3e3).catch(()=>{}),await Promise.all([we.waitFor("plants",3e3).catch(()=>console.warn("[AutoFavorite UI] Still waiting for plants data...")),we.waitFor("pets",3e3).catch(()=>console.warn("[AutoFavorite UI] Still waiting for pets data..."))]);const n=we.get("plants")||{},r=we.get("pets")||{};this.allPlants=Object.keys(n).sort((o,i)=>{const a=n[o]?.seed?.rarity||null,s=n[i]?.seed?.rarity||null,l=Xo(a)-Xo(s);return l!==0?l:o.localeCompare(i,void 0,{numeric:!0,sensitivity:"base"})}),this.allPets=Object.keys(r).sort((o,i)=>{const a=r[o]?.rarity||null,s=r[i]?.rarity||null,l=Xo(a)-Xo(s);return l!==0?l:o.localeCompare(i,void 0,{numeric:!0,sensitivity:"base"})});}catch(n){console.error("[AutoFavorite UI] Failed to load game data:",n);}}async waitForSprites(){if(ye.isReady())return;const n=1e4,r=100;let o=0;return new Promise(i=>{const a=()=>{ye.isReady()||o>=n?i():(o+=r,setTimeout(a,r));};a();})}renderContent(){this.sectionElement&&(this.sectionElement.innerHTML="",this.sectionElement.appendChild(this.createMasterToggle()),this.sectionElement.appendChild(this.createMutationsCard()),this.sectionElement.appendChild(this.createProduceCard()),this.sectionElement.appendChild(this.createPetsCard()));}createMasterToggle(){const n=x("div",{className:"kv"}),r=Tf({text:"Enable Auto-Favorite",tone:"default",size:"lg"}),o=Xr({checked:Fn().get().enabled,onChange:async i=>{const a=Fn(),s=a.get();await a.set({...s,enabled:i}),await this.saveConfig();}});return n.append(r.root,o.root),ft({title:"Auto-Favorite",padding:"lg"},n,x("p",{style:"margin-top: 6px; font-size: 12px; color: var(--muted);"},"Automatically favorite items when added to inventory"))}createMutationsCard(){const n=x("div",{className:"u-col"}),r=x("div",{className:"mut-row"});r.appendChild(this.createMutationButton(Dn[0])),r.appendChild(this.createMutationButton(Dn[1])),n.appendChild(r);const o=x("div",{className:"mut-row"});o.appendChild(this.createMutationButton(Dn[2])),o.appendChild(this.createMutationButton(Dn[3])),o.appendChild(this.createMutationButton(Dn[4])),n.appendChild(o);const i=x("div",{className:"mut-row"});i.appendChild(this.createMutationButton(Dn[5])),i.appendChild(this.createMutationButton(Dn[6])),n.appendChild(i);const a=x("div",{className:"mut-row"});return a.appendChild(this.createMutationButton(Dn[7])),a.appendChild(this.createMutationButton(Dn[8])),n.appendChild(a),ft({title:"Mutations Priority",variant:"soft",padding:"lg",expandable:true,defaultExpanded:true},n,x("p",{style:"margin-top: 8px; font-size: 11px; color: var(--muted);"},`${Fn().get().favoriteMutations.length} / ${Dn.length} active`))}createMutationButton(n){let r=Fn().get().favoriteMutations.includes(n.id);const i=["mut-btn",`mut-btn--${n.id.toLowerCase()}`];r&&i.push("active");const a=x("div",{className:i.join(" ")}),s=x("div",{style:"width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;"});try{if(ye.isReady()){const c=ye.toCanvas("plant","Sunflower",{mutations:[n.id],scale:.16});c.style.width="28px",c.style.height="28px",c.style.objectFit="contain",s.appendChild(c);}}catch{}const l=n.id.charAt(0).toUpperCase()+n.id.slice(1).toLowerCase(),d=x("div",{style:"font-size: 13px; font-weight: 600; color: var(--fg); text-shadow: 0 1px 2px rgba(0,0,0,0.5); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"},l);if(a.append(s,d),n.id==="Rainbow"||n.id==="Gold"){const c=x("div",{style:"width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;"});try{if(ye.isReady()){const p=ye.toCanvas("pet","Capybara",{mutations:[n.id],scale:.16});p.style.width="28px",p.style.height="28px",p.style.objectFit="contain",c.appendChild(p);}}catch{}a.append(c);}else {const c=x("div",{style:"width: 28px; flex-shrink: 0;"});a.append(c);}return a.addEventListener("click",async c=>{c.stopPropagation();const p=Fn(),m=p.get();if(r){const g=m.favoriteMutations.filter(w=>w!==n.id);await p.set({...m,favoriteMutations:g}),r=false,a.classList.remove("active");}else {const g=[...m.favoriteMutations,n.id];await p.set({...m,favoriteMutations:g}),r=true,a.classList.add("active");}await this.saveConfig();const b=this.sectionElement?.querySelector(".card p");b&&(b.textContent=`${Fn().get().favoriteMutations.length} / ${Dn.length} active`);}),a}createProduceCard(){return this.createItemSelectionCard({title:"Produce",items:this.allPlants,category:"plant",selected:Fn().get().favoriteProduceList,onUpdate:async n=>{const r=Fn(),o=r.get();await r.set({...o,favoriteProduceList:n}),await this.saveConfig();}})}createPetsCard(){return this.createItemSelectionCard({title:"Pets",items:this.allPets,category:"pet",selected:Fn().get().favoritePetsList,onUpdate:async n=>{const r=Fn(),o=r.get();await r.set({...o,favoritePetsList:n}),await this.saveConfig();}})}createItemSelectionCard(n){const{title:r,items:o,category:i,selected:a,onUpdate:s}=n;let l=new Set(a),d=o;const c=x("div",{style:"margin-bottom: 8px;"}),p=vs({placeholder:`Search ${r.toLowerCase()}...`,value:"",debounceMs:150,withClear:true,size:"sm",focusKey:"",onChange:A=>{const T=A.trim().toLowerCase();T?d=o.filter(M=>M.toLowerCase().includes(T)):d=o,P.setData(w());}});c.appendChild(p.root);const m=x("div",{style:"display: flex; gap: 8px; margin-bottom: 12px;"}),b=kt({label:"Select All",variant:"default",size:"sm",onClick:()=>{const A=w().map(T=>T.id);P.setSelection(A);}}),g=kt({label:"Deselect All",variant:"default",size:"sm",onClick:()=>{P.clearSelection();}});m.append(b,g);const w=()=>d.map(A=>({id:A,name:A,rarity:this.getItemRarity(A,i),selected:l.has(A)})),_=A=>{if(!A){const M=x("span",{style:"opacity:0.5;"});return M.textContent="—",M}return Ms({variant:"rarity",rarity:A,size:"sm"}).root},C=A=>{const T=x("div",{style:"width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; overflow: hidden; flex-shrink: 0; background: color-mix(in oklab, var(--bg) 5%, transparent); border-radius: 6px;"});try{if(ye.isReady()){let M=i,S=A;i==="plant"&&(["Bamboo","Cactus"].includes(A)&&(M="tallplant"),A==="DawnCelestial"&&(S="DawnCelestialCrop"),A==="MoonCelestial"&&(S="MoonCelestialCrop"),A==="OrangeTulip"&&(S="Tulip"));const R=ye.toCanvas(M,S,{scale:.5});R.style.width="28px",R.style.height="28px",R.style.objectFit="contain",T.appendChild(R);}}catch{}return T},P=id({columns:[{key:"name",header:"Name",width:"1fr",align:"center",sortable:true,sortFn:(A,T)=>A.name.localeCompare(T.name,void 0,{numeric:true,sensitivity:"base"}),render:A=>{const T=x("div",{style:"display: flex; align-items: center; justify-content: center; gap: 8px; width: 100%;"}),M=C(A.id),S=x("span",{style:"font-weight: 500; color: var(--fg); white-space: nowrap;"},A.name);return T.append(M,S),T}},{key:"rarity",header:"Rarity",width:"100px",align:"center",sortable:true,sortFn:(A,T)=>Xo(A.rarity)-Xo(T.rarity),render:A=>_(A.rarity)}],data:w(),maxHeight:280,compact:true,zebra:true,animations:true,selectable:true,selectOnRowClick:true,hideHeaderCheckbox:true,initialSelection:Array.from(l),getRowId:A=>A.id,onSelectionChange:A=>{l.clear(),A.forEach(T=>l.add(T)),s(Array.from(l)),F();}}),O=x("p",{style:"margin-top: 8px; font-size: 11px; color: var(--muted);"}),F=()=>{O.textContent=`${l.size} / ${o.length} selected`;};return F(),ft({title:`${r} (${l.size}/${o.length})`,variant:"soft",padding:"lg",expandable:true,defaultExpanded:false},c,m,P.root,O)}getItemRarity(n,r){try{if(r==="pet")return (we.get("pets")||{})[n]?.rarity||null;if(r==="plant"){const o=we.get("plants")||{},i=o[n];if(i?.seed?.rarity)return i.seed.rarity;const a=n.toLowerCase();for(const s of Object.values(o))if(s?.seed?.name?.toLowerCase()===a||s?.plant?.name?.toLowerCase()===a)return s.seed.rarity}}catch{}return null}async saveConfig(){const n=Fn().get();try{const{updateSimpleConfig:r}=Ux;await r({enabled:n.enabled,favoriteSpecies:[...n.favoriteProduceList,...n.favoritePetsList],favoriteMutations:n.favoriteMutations});}catch(r){console.error("[AutoFavoriteSettings] Failed to update feature config:",r);}}}function k5(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.style.color="var(--accent)";const t=document.createElementNS("http://www.w3.org/2000/svg","line");t.setAttribute("x1","12"),t.setAttribute("y1","5"),t.setAttribute("x2","12"),t.setAttribute("y2","19");const n=document.createElementNS("http://www.w3.org/2000/svg","line");return n.setAttribute("x1","5"),n.setAttribute("y1","12"),n.setAttribute("x2","19"),n.setAttribute("y2","12"),e.appendChild(t),e.appendChild(n),e}function _5(e,t){const n=e;let r=e;const o=od({value:e,placeholder:"Team name",mode:"alphanumeric",allowSpaces:true,maxLength:50,blockGameKeys:true,onChange:i=>{const a=i.trim();a&&a!==r&&(r=a,t?.(a));},onEnter:i=>{const a=i.trim()||n;a!==r&&(r=a,t?.(a));}});return o.root.className="team-list-item__name-input",o.input.addEventListener("blur",()=>{const i=o.getValue().trim()||n;i!==r&&(r=i,t?.(i));}),o.input.addEventListener("keydown",i=>{i.key==="Escape"&&(i.preventDefault(),o.input.blur());}),o.root}function tC(e){const t=x("div",{className:"team-list-item"}),n=e.customIndicator??x("div",{className:`team-list-item__indicator ${e.isActive?"team-list-item__indicator--active":"team-list-item__indicator--inactive"}`}),r=e.isNameEditable?_5(e.team.name,e.onNameChange):x("div",{textContent:e.team.name,className:`team-list-item__name ${e.isActive?"team-list-item__name--active":"team-list-item__name--inactive"}`}),o=x("div",{className:"team-list-item__sprites"});function i(){const l=Ge.myPets.get();o.innerHTML="";for(let d=0;d<3;d++){const c=e.team.petIds[d],p=c&&c!=="",m=x("div",{className:`team-list-item__sprite-slot ${e.showSlotStyles&&!p?"team-list-item__sprite-slot--empty":""}`});if(e.onSlotClick&&(m.style.cursor="pointer",m.addEventListener("click",()=>{e.onSlotClick(d);})),p){let b=l.all.find(g=>g.id===c);if(!b){const g=window.__petDataCache;g&&g.has(c)&&(b=g.get(c));}if(b)try{const g=ye.toCanvas("pet",b.petSpecies,{mutations:b.mutations,scale:1}),w=document.createElement("canvas");w.width=g.width,w.height=g.height;const _=w.getContext("2d");if(_&&_.drawImage(g,0,0),w.style.width="100%",w.style.height="100%",w.style.objectFit="contain",m.appendChild(w),e.showSlotStyles){const C=x("div",{className:"team-list-item__sprite-slot-overlay"});m.appendChild(C),m.classList.add("team-list-item__sprite-slot--filled");}}catch(g){console.warn(`[TeamListItem] Failed to render sprite for pet ${b.petSpecies}:`,g);const w=x("div",{textContent:"🐾",className:"team-list-item__sprite-placeholder"});m.appendChild(w);}else {const g=x("div",{textContent:"⏳",className:"team-list-item__sprite-placeholder"});m.appendChild(g),console.warn(`[TeamListItem] Pet ${c} not found in myPets yet, waiting for update`);let w=false;const _=Ge.myPets.subscribe(()=>{if(w)return;const E=Ge.myPets.get().all.find(P=>P.id===c);if(E){w=true,_();try{m.innerHTML="";const P=ye.toCanvas("pet",E.petSpecies,{mutations:E.mutations,scale:1}),O=document.createElement("canvas");O.width=P.width,O.height=P.height;const F=O.getContext("2d");if(F&&F.drawImage(P,0,0),O.style.width="100%",O.style.height="100%",O.style.objectFit="contain",m.appendChild(O),e.showSlotStyles){const A=x("div",{className:"team-list-item__sprite-slot-overlay"});m.appendChild(A),m.classList.add("team-list-item__sprite-slot--filled");}console.log(`[TeamListItem] Pet ${c} sprite updated`);}catch(P){console.warn(`[TeamListItem] Failed to render sprite for pet ${E.petSpecies}:`,P),m.innerHTML="<div class='team-list-item__sprite-placeholder'>🐾</div>";}}},{immediate:false});}}else if(e.showSlotStyles&&!p){const b=k5();m.appendChild(b);}o.appendChild(m);}}i();const a=Ge.myPets.subscribe(()=>{i();});if(!e.hideDragHandle){const l=x("div",{textContent:"⋮⋮",className:"team-list-item__drag-handle"});t.appendChild(l);}if(t.appendChild(n),t.appendChild(r),t.appendChild(o),e.onExpandClick){const l=x("button",{className:`team-list-item__expand ${e.isExpanded?"team-list-item__expand--open":""}`});l.innerHTML='<svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>',l.addEventListener("click",d=>{d.stopPropagation(),e.onExpandClick?.();}),t.appendChild(l);}const s=new MutationObserver(()=>{document.contains(t)||(s.disconnect(),a());});return s.observe(document.body,{childList:true,subtree:true}),t}function A5(e){return e==null?null:typeof e=="string"?document.createTextNode(e):e}function jo(e){const{segments:t,selected:n=t[0]?.id??"",size:r="md",fullWidth:o=false,disabled:i=false,onChange:a}=e,s=x("div",{className:"sg-root"});r!=="md"&&s.classList.add(`sg--${r}`),o&&(s.style.width="100%");const l=x("div",{className:"sg-container",role:"tablist"}),d=x("div",{className:"sg-indicator"}),c=t.map(T=>{const M=x("button",{className:"sg-btn",type:"button",role:"tab","aria-selected":"false",title:T.label});if(M.id=T.id,T.icon){const R=x("span",{className:"sg-icon"}),z=A5(T.icon);z&&R.appendChild(z),M.appendChild(R);}const S=x("span",{className:"sg-label"},T.label);return M.appendChild(S),M.disabled=!!T.disabled,M});l.appendChild(d),c.forEach(T=>l.appendChild(T)),s.appendChild(l);let p=n,m=i,b=null;function g(){const T=c.find(M=>M.id===p);T&&requestAnimationFrame(()=>{const M=d,S=T.offsetLeft,R=T.offsetWidth;M.style.width=`${R}px`,M.style.transform=`translateX(${S}px)`;});}function w(){c.forEach(T=>{const M=T.id===p;T.classList.toggle("active",M),T.setAttribute("aria-selected",String(M)),T.disabled=m||!!t.find(S=>S.id===T.id)?.disabled;}),g();}function _(T){const M=T.currentTarget;if(M.disabled)return;E(M.id);}function C(T){if(m)return;const M=c.findIndex(R=>R.id===p);let S=M;if(T.key==="ArrowLeft"||T.key==="ArrowUp"?(T.preventDefault(),S=(M-1+c.length)%c.length):T.key==="ArrowRight"||T.key==="ArrowDown"?(T.preventDefault(),S=(M+1)%c.length):T.key==="Home"?(T.preventDefault(),S=0):T.key==="End"&&(T.preventDefault(),S=c.length-1),S!==M){const R=c[S];R&&!R.disabled&&(E(R.id),R.focus());}}c.forEach(T=>{T.addEventListener("click",_),T.addEventListener("keydown",C);});function E(T){!t.some(S=>S.id===T)||p===T||(p=T,w(),a?.(p));}function P(){return p}function O(T){m=!!T,w();}function F(){c.forEach(T=>{T.removeEventListener("click",_),T.removeEventListener("keydown",C);}),b?.disconnect(),b=null;}w(),b=new ResizeObserver(()=>{const T=c.find(M=>M.id===p);if(T&&T.offsetWidth>0){const M=d;M.style.transition="none",M.style.width=`${T.offsetWidth}px`,M.style.transform=`translateX(${T.offsetLeft}px)`,requestAnimationFrame(()=>{M.style.removeProperty("transition");}),b?.disconnect(),b=null;}}),b.observe(l);const A=s;return A.select=E,A.getSelected=P,A.setDisabled=O,A.destroy=F,A}function zd(e={}){const{id:t,checked:n=false,disabled:r=false,size:o="md",label:i,labelSide:a="right",onChange:s}=e,l=x("div",{className:"lg-checkbox-wrap"}),d=x("input",{className:`lg-checkbox lg-checkbox--${o}`,id:t,type:"checkbox",checked:!!n,disabled:!!r});let c=null;i&&a!=="none"&&(c=x("label",{className:"lg-checkbox-label"},i),c.addEventListener("click",w)),c&&a==="left"?l.append(c,d):c&&a==="right"?l.append(d,c):l.append(d);let p=!!n,m=!!r;function b(){d.checked=p,d.disabled=m;}function g(T=false){m||(p=!p,b(),T||s?.(p));}function w(){m||g();}function _(T){m||(T.key===" "||T.key==="Enter")&&(T.preventDefault(),g());}d.addEventListener("click",w),d.addEventListener("keydown",_);function C(){return p}function E(T,M=false){p=!!T,b(),M||s?.(p);}function P(T){m=!!T,b();}function O(T){if(!T){c&&(c.remove(),c=null);return}c?c.textContent=T:(c=x("label",{className:"lg-checkbox-label"},T),c.addEventListener("click",w),l.append(c));}function F(){d.focus();}function A(){d.removeEventListener("click",w),d.removeEventListener("keydown",_),c&&c.removeEventListener("click",w);}return b(),{root:l,input:d,isChecked:C,setChecked:E,setDisabled:P,setLabel:O,focus:F,destroy:A}}let ua=0,Tb="",Ib="";function E5(){return ua===0&&(Tb=document.body.style.overflow,Ib=document.body.style.touchAction,document.body.style.overflow="hidden",document.body.style.touchAction="none"),ua++,()=>{ua=Math.max(0,ua-1),ua===0&&(document.body.style.overflow=Tb,document.body.style.touchAction=Ib);}}class T5{constructor(t){de(this,"dragState",null);de(this,"longPressState",null);de(this,"options");de(this,"onPointerMove");de(this,"onPointerUp");de(this,"onPointerCancel");de(this,"onLongPressPointerMove");de(this,"onLongPressPointerUp");this.options=t,this.onPointerMove=this.handlePointerMove.bind(this),this.onPointerUp=this.handlePointerUp.bind(this),this.onPointerCancel=this.handlePointerCancel.bind(this),this.onLongPressPointerMove=this.handleLongPressPointerMove.bind(this),this.onLongPressPointerUp=this.handleLongPressPointerUp.bind(this);}startLongPress(t,n,r){if(this.cleanupLongPress(),ze.getAllTeams().findIndex(d=>d.id===r)===-1)return;const a=t.clientX,s=t.clientY,l=window.setTimeout(()=>{this.longPressState&&this.startDrag(t,n,r);},500);this.longPressState={pointerId:t.pointerId,startX:a,startY:s,timeout:l,target:n},window.addEventListener("pointermove",this.onLongPressPointerMove,{passive:false}),window.addEventListener("pointerup",this.onLongPressPointerUp,{passive:false});}startDrag(t,n,r){const o=this.options.getListContainer();if(this.dragState||!o)return;t.preventDefault();const a=ze.getAllTeams().findIndex(m=>m.id===r);if(a===-1)return;const s=n.getBoundingClientRect(),l=o.getBoundingClientRect(),d=n.cloneNode(true);d.classList.add("team-list-item--placeholder"),d.classList.remove("team-list-item--dragging");const c=n.style.touchAction;n.style.touchAction="none";const p=E5();if(this.dragState={itemEl:n,pointerId:t.pointerId,placeholder:d,offsetY:t.clientY-s.top,fromIndex:a,teamId:r,captureTarget:n,touchActionPrev:c,releaseScrollLock:p},n.classList.add("team-list-item--dragging"),n.style.width=`${s.width}px`,n.style.height=`${s.height}px`,n.style.left=`${s.left-l.left}px`,n.style.top=`${s.top-l.top}px`,n.style.position="absolute",n.style.zIndex="30",n.style.pointerEvents="none",o.style.position||(o.style.position="relative"),o.insertBefore(d,n.nextSibling),o.classList.add("is-reordering"),n.setPointerCapture)try{n.setPointerCapture(t.pointerId);}catch{}window.addEventListener("pointermove",this.onPointerMove,{passive:false}),window.addEventListener("pointerup",this.onPointerUp,{passive:false}),window.addEventListener("pointercancel",this.onPointerCancel,{passive:false});}cleanup(){this.cleanupDrag(),this.cleanupLongPress();}handleLongPressPointerMove(t){if(!this.longPressState||t.pointerId!==this.longPressState.pointerId)return;const n=Math.abs(t.clientX-this.longPressState.startX),r=Math.abs(t.clientY-this.longPressState.startY),o=10;(n>o||r>o)&&this.cleanupLongPress();}handleLongPressPointerUp(t){!this.longPressState||t.pointerId!==this.longPressState.pointerId||this.cleanupLongPress();}handlePointerMove(t){const n=this.options.getListContainer();if(!this.dragState||!n||t.pointerId!==this.dragState.pointerId)return;t.preventDefault();const r=n.getBoundingClientRect();let o=t.clientY-r.top-this.dragState.offsetY;const i=r.height-this.dragState.itemEl.offsetHeight;Number.isFinite(i)&&(o=Math.max(-8,Math.min(i+8,o))),this.dragState.itemEl.style.top=`${o}px`,this.updatePlaceholderPosition(t.clientY);}handlePointerUp(t){!this.dragState||t.pointerId!==this.dragState.pointerId||(t.preventDefault(),this.finishDrag());}handlePointerCancel(t){!this.dragState||t.pointerId!==this.dragState.pointerId||this.finishDrag({revert:true});}updatePlaceholderPosition(t){const n=this.options.getListContainer();if(!this.dragState||!n)return;const{placeholder:r,itemEl:o}=this.dragState,i=Array.from(n.children).filter(l=>l!==o&&l!==r&&l instanceof HTMLElement&&l.classList.contains("team-list-item")),a=new Map;i.forEach(l=>{a.set(l,l.getBoundingClientRect().top);});let s=false;for(const l of i){const d=l.getBoundingClientRect(),c=d.top+d.height/2;if(t<c){r.nextSibling!==l&&n.insertBefore(r,l),s=true;break}}s||n.appendChild(r),i.forEach(l=>{const d=a.get(l),c=l.getBoundingClientRect().top;if(d!==void 0&&d!==c){const p=d-c;l.style.transform=`translateY(${p}px)`,l.style.transition="none",l.offsetHeight,l.style.transition="transform 0.14s ease",l.style.transform="translateY(0)";}});}finishDrag(t={}){const n=this.options.getListContainer();if(!this.dragState||!n)return;const{revert:r=false}=t,{itemEl:o,placeholder:i,fromIndex:a,touchActionPrev:s,releaseScrollLock:l,pointerId:d}=this.dragState;if(n.classList.remove("is-reordering"),o.hasPointerCapture(d))try{o.releasePointerCapture(d);}catch{}if(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("pointercancel",this.onPointerCancel),r){const m=Array.from(n.children).filter(b=>b!==o&&b!==i&&b instanceof HTMLElement&&b.classList.contains("team-list-item"))[a]||null;m?n.insertBefore(i,m):n.appendChild(i);}else {const p=Array.from(n.children).filter(b=>b!==o),m=p.indexOf(i);if(m!==-1){const b=p[m];b!==i&&n.insertBefore(i,b);}}if(i.replaceWith(o),i.remove(),o.classList.remove("team-list-item--dragging"),o.style.width="",o.style.height="",o.style.left="",o.style.top="",o.style.position="",o.style.zIndex="",o.style.pointerEvents="",o.style.touchAction=s??"",Array.from(n.children).filter(p=>p instanceof HTMLElement&&p.classList.contains("team-list-item")).forEach(p=>{p.style.transform="",p.style.transition="";}),l?.(),!r){const m=Array.from(n.children).filter(b=>b instanceof HTMLElement&&b.classList.contains("team-list-item")).indexOf(o);if(m!==-1&&m!==a){const g=ze.getAllTeams().slice(),[w]=g.splice(a,1);g.splice(m,0,w);const _=g.map(C=>C.id);ze.reorderTeams(_),this.options.onReorder(_);}}this.dragState=null;}cleanupDrag(){this.dragState&&(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("pointercancel",this.onPointerCancel),this.dragState=null);}cleanupLongPress(){this.longPressState&&(window.clearTimeout(this.longPressState.timeout),window.removeEventListener("pointermove",this.onLongPressPointerMove),window.removeEventListener("pointerup",this.onLongPressPointerUp),this.longPressState=null);}}class I5{constructor(t={}){de(this,"card",null);de(this,"modeControl",null);de(this,"modeContainer",null);de(this,"teamContent",null);de(this,"listContainer",null);de(this,"teamMode","overview");de(this,"selectedTeamIds",new Set);de(this,"teamCheckboxes",new Map);de(this,"options");de(this,"dragHandler");this.options=t,this.dragHandler=new T5({getListContainer:()=>this.listContainer,onReorder:n=>{this.options.onTeamReordered?.(n),this.options.onTeamsUpdated?.();}});}build(){return this.card?this.card:this.createTeamCard()}destroy(){this.dragHandler.cleanup(),this.modeControl&&(this.modeControl.destroy(),this.modeControl=null),this.teamCheckboxes.forEach(t=>t.destroy()),this.teamCheckboxes.clear(),this.selectedTeamIds.clear(),this.card=null,this.modeContainer=null,this.teamContent=null,this.listContainer=null;}render(){if(!this.card)return;if(!ze.isEnabled()){this.renderDisabledState();return}this.modeContainer&&(this.modeContainer.style.display="flex"),this.ensureModeControl(),this.renderTeamContent();}createTeamCard(){const t=x("div",{className:"team-card-wrapper"});this.modeContainer=x("div",{className:"team-card__mode-container"}),t.appendChild(this.modeContainer),this.teamContent=x("div",{className:"team-card__content"}),t.appendChild(this.teamContent);const n=ft({title:"Team",subtitle:"Organize and switch between pet teams",expandable:true,defaultExpanded:true},t);return this.card=n,n}ensureModeControl(){if(this.modeContainer){if(!this.modeControl){this.modeControl=jo({segments:[{id:"overview",label:"Overview"},{id:"manage",label:"Manage"}],selected:this.teamMode,onChange:t=>{this.teamMode=t,this.renderTeamContent();}}),this.modeContainer.appendChild(this.modeControl);return}this.modeControl.getSelected()!==this.teamMode&&this.modeControl.select(this.teamMode);}}renderDisabledState(){if(!this.teamContent)return;this.dragHandler.cleanup(),this.listContainer=null,this.modeContainer&&(this.modeContainer.style.display="none");const t=x("div",{className:"team-card__disabled-state"}),n=x("div",{textContent:"Pet Team feature is disabled",className:"team-card__disabled-message"}),r=kt({label:"Enable Feature",onClick:()=>{ze.setEnabled(true),this.render();}});t.appendChild(n),t.appendChild(r),this.teamContent.replaceChildren(t);}renderTeamContent(){if(!this.teamContent)return;this.dragHandler.cleanup(),this.listContainer=null,this.teamContent.replaceChildren(),this.teamCheckboxes.forEach(r=>r.destroy()),this.teamCheckboxes.clear(),this.selectedTeamIds.clear();const t=ze.getAllTeams(),n=ze.getActiveTeamId();if(t.length===0){this.renderEmptyState();return}this.listContainer=x("div",{className:"team-card__list-container"}),t.forEach(r=>{const o=n===r.id;let i;this.teamMode==="manage"&&(i=this.createCheckboxIndicator(r.id));const a=tC({team:r,isActive:o,customIndicator:i?.root,hideDragHandle:this.teamMode==="manage",isNameEditable:this.teamMode==="manage",showSlotStyles:this.teamMode==="manage",onNameChange:s=>{this.handleRenameTeam(r.id,s);},onSlotClick:this.teamMode==="manage"?s=>{this.handleRemovePet(r.id,s);}:void 0});this.teamMode==="manage"&&a.classList.add("team-list-item--manage"),this.teamMode==="overview"&&(a.addEventListener("click",async s=>{if(!s.target.closest(".team-list-item__drag-handle")){a.classList.add("team-list-item--clicked"),setTimeout(()=>{a.classList.remove("team-list-item--clicked");},300);try{await ze.activateTeam(r),this.options.onTeamsUpdated?.();}catch(d){console.error("[TeamCard] Failed to activate team:",d);}}}),a.addEventListener("pointerdown",s=>{if(s.button!==0)return;s.target.closest(".team-list-item__drag-handle")?this.dragHandler.startDrag(s,a,r.id):this.dragHandler.startLongPress(s,a,r.id);})),this.listContainer.appendChild(a);}),this.teamContent.appendChild(this.listContainer),this.teamMode==="manage"&&this.renderManageActions();}renderEmptyState(){if(!this.teamContent)return;const t=x("div",{textContent:"No teams yet. Create your first team!",className:"team-card__empty-state"});if(this.teamContent.appendChild(t),this.teamMode==="manage"){const n=x("div",{className:"team-card__actions"}),r=kt({label:"New Team",variant:"primary",onClick:()=>{this.handleCreateTeam();}});n.appendChild(r),this.teamContent.appendChild(n);}}renderManageActions(){if(!this.teamContent)return;const t=x("div",{className:"team-card__actions"}),n=kt({label:"New Team",variant:"primary",onClick:()=>{this.handleCreateTeam();}}),r=kt({label:"Import from Aries",variant:"default",onClick:()=>{this.handleImportFromAries();}}),o=kt({label:"Delete Team",variant:"danger",disabled:this.selectedTeamIds.size===0,onClick:()=>{this.handleDeleteTeam();}});o.setAttribute("data-action","delete-team"),t.appendChild(n),t.appendChild(r),t.appendChild(o),this.teamContent.appendChild(t);}handleCreateTeam(){const t="New Team";let n=t,r=1;const o=ze.getAllTeams(),i=new Set(o.map(a=>a.name));for(;i.has(n);)n=`${t} (${r})`,r++;try{ze.createTeam(n,[])&&(this.render(),this.options.onTeamsUpdated?.());}catch{}}handleDeleteTeam(){if(this.selectedTeamIds.size===0)return;const t=Array.from(this.selectedTeamIds);for(const n of t)ze.deleteTeam(n);this.render(),this.options.onTeamsUpdated?.();}handleImportFromAries(){try{const t=ze.importFromAries();t.success?(console.log(`[PetTeam] Successfully imported ${t.imported} team${t.imported===1?"":"s"} from Aries mod`),this.render(),this.options.onTeamsUpdated?.()):console.error("[PetTeam] Import failed:",t.errors.join(", "));}catch(t){console.error("[PetTeam] Import error:",t);}}handleRenameTeam(t,n){ze.renameTeam(t,n),this.options.onTeamsUpdated?.();}handleRemovePet(t,n){const r=ze.getTeam(t);if(!r)return;const o=r.petIds[n];!o||o===""?this.handleAddPet(t,n):this.handleRemovePetFromSlot(t,n);}handleRemovePetFromSlot(t,n){const r=ze.getTeam(t);if(!r)return;const o=[...r.petIds];o[n]="",ze.updateTeam(t,{petIds:o}),this.render(),this.options.onTeamsUpdated?.();}async handleAddPet(t,n){const r=ze.getTeam(t);if(!r)return;const i=Ge.myPets.get().all.map(b=>({id:b.id,itemType:"Pet",petSpecies:b.petSpecies,name:b.name??null,xp:b.xp,hunger:b.hunger,mutations:b.mutations||[],targetScale:b.targetScale,abilities:b.abilities||[]})),a=new Set(r.petIds.filter(b=>b!=="")),s=i.filter(b=>!a.has(b.id));await et.set("myPossiblyNoLongerValidSelectedItemIndexAtom",null);const l=Wt.detect();(l.platform==="mobile"||l.viewportWidth<768)&&this.options.setHUDOpen&&this.options.setHUDOpen(false);const c=Ge.myInventory.subscribeSelection(b=>{if(b.current&&b.current.item){const g=b.current.item,w=[...r.petIds];w[n]=g.id,ze.updateTeam(t,{petIds:w}),this.options.onTeamsUpdated?.(),et.set("myPossiblyNoLongerValidSelectedItemIndexAtom",null),si.close().then(()=>{const _=Wt.detect();(_.platform==="mobile"||_.viewportWidth<768)&&this.options.setHUDOpen&&this.options.setHUDOpen(true),this.render(),this.options.onTeamsUpdated?.();});}});await si.show("inventory",{items:s,favoritedItemIds:[]}),await si.waitForClose();const p=Wt.detect();(p.platform==="mobile"||p.viewportWidth<768)&&this.options.setHUDOpen&&this.options.setHUDOpen(true),c();}createCheckboxIndicator(t){const n=zd({checked:this.selectedTeamIds.has(t),size:"md",onChange:r=>{r?this.selectedTeamIds.add(t):this.selectedTeamIds.delete(t),this.updateDeleteButtonState();}});return this.teamCheckboxes.set(t,n),n}updateDeleteButtonState(){const t=this.teamContent?.querySelector('[data-action="delete-team"]');t&&(t.disabled=this.selectedTeamIds.size===0);}}class P5{constructor(t,n={}){de(this,"root");de(this,"pet");de(this,"options");de(this,"contentSlot",null);de(this,"isBuilt",false);this.pet=t,this.options=n,this.root=document.createElement("div"),this.root.className="base-pet-card",n.className&&this.root.classList.add(n.className);}build(){if(this.isBuilt)return this.root;this.updateStateClasses();const t=document.createElement("div");t.className="base-pet-card__left";const n=document.createElement("div");n.className="base-pet-card__sprite-wrapper",this.renderSprite(n),t.appendChild(n);const r=document.createElement("div");r.className="base-pet-card__info";const o=document.createElement("div");if(o.className="base-pet-card__name",o.textContent=this.pet.name||this.pet.petSpecies,r.appendChild(o),!this.options.hideStr){const i=document.createElement("div");i.className="base-pet-card__str",this.renderStr(i),r.appendChild(i);}return t.appendChild(r),this.root.appendChild(t),this.contentSlot=document.createElement("div"),this.contentSlot.className="base-pet-card__content",this.root.appendChild(this.contentSlot),this.options.onClick&&(this.root.style.cursor="pointer",this.root.addEventListener("click",()=>this.options.onClick?.(this.pet))),this.isBuilt=true,this.root}getContentSlot(){if(!this.contentSlot)throw new Error("BasePetCard must be built before getting slot");return this.contentSlot}update(t){if(this.pet=t,!this.isBuilt)return;this.updateStateClasses();const n=this.root.querySelector(".base-pet-card__name");n&&(n.textContent=t.name||t.petSpecies);const r=this.root.querySelector(".base-pet-card__str");r&&this.renderStr(r);const o=this.root.querySelector(".base-pet-card__sprite-wrapper");o instanceof HTMLElement&&this.renderSprite(o);}updateStateClasses(){this.root.classList.toggle("base-pet-card--max",this.pet.currentStrength>=this.pet.maxStrength),this.root.classList.toggle("base-pet-card--starving",(this.pet.hunger||0)===0);}renderStr(t){const r=this.pet.currentStrength>=this.pet.maxStrength?`MAX ${this.pet.maxStrength}`:`STR ${this.pet.currentStrength}/${this.pet.maxStrength}`;t.innerHTML="";const o=Ms({label:r,type:"neutral",tone:"soft",size:"sm",pill:true});t.appendChild(o.root);}setCentered(t){this.root.classList.toggle("base-pet-card--centered",t);}renderSprite(t){t.innerHTML="";try{const n=this.pet.mutations||[];if(ye.has("pet",this.pet.petSpecies)){const r=ye.toCanvas("pet",this.pet.petSpecies,{mutations:n,scale:1,boundsMode:"padded"});r.style.width="64px",r.style.height="64px",r.style.objectFit="contain",t.appendChild(r);}else t.innerHTML='<div class="base-pet-card__sprite-fallback">🐾</div>';}catch{t.innerHTML='<div class="base-pet-card__sprite-fallback">🐾</div>';}}destroy(){this.root.remove(),this.contentSlot=null,this.isBuilt=false;}}const Pt={XP:{BOOST_PAIR:.85,LEVELING_PAIR:.75,PASSIVE_LEVELING:.5,STR_DISTANCE_THRESHOLD:.15},ECONOMY:{DEDICATED_COIN:.9,META_SELLING:.85,PASSIVE_EFFICIENCY:.65,ENDGAME_HARVEST:.95,SYNERGY_BONUS:.1,EARLY_REGROW:.7},HATCHING:{TIER_3_MAX_STR:.95,RAINBOW_HUNTING:.7,COMBO_BONUS:.05},TIER_BONUS:.05,CONFIDENCE_THRESHOLD:.6},Pe={XP_BOOST:["PetXpBoost","PetXpBoostII","PetXpBoostIII","SnowyPetXpBoost"],COIN_FINDER:["CoinFinderI","CoinFinderII","CoinFinderIII","SnowyCoinFinder"],SELL_BOOST:["SellBoostI","SellBoostII","SellBoostIII","SellBoostIV"],CROP_REFUND_HARVEST:["ProduceRefund","DoubleHarvest"],PLANT_GROWTH:["PlantGrowthBoost","PlantGrowthBoostII","PlantGrowthBoostIII","SnowyPlantGrowthBoost"],CROP_SIZE:["ProduceScaleBoost","ProduceScaleBoostII","ProduceScaleBoostIII","SnowyCropSizeBoost"],CROP_MUTATION:["ProduceMutationBoost","ProduceMutationBoostII","ProduceMutationBoostIII","SnowyCropMutationBoost"],EGG_GROWTH:["EggGrowthBoost","EggGrowthBoostII_NEW","EggGrowthBoostII","SnowyEggGrowthBoost"],HUNGER_BOOST:["HungerBoost","HungerBoostII","HungerBoostIII","SnowyHungerBoost"],HUNGER_RESTORE:["HungerRestore","HungerRestoreII","HungerRestoreIII","SnowyHungerRestore"],RARE_GRANTERS:["FrostGranter","GoldGranter","RainbowGranter"],COMMON_GRANTERS:["RainDance","SnowGranter"],MAX_STR_BOOST:["PetHatchSizeBoost","PetHatchSizeBoostII","PetHatchSizeBoostIII"],HATCH_XP:["PetAgeBoost","PetAgeBoostII","PetAgeBoostIII"],PET_MUTATION:["PetMutationBoost","PetMutationBoostII","PetMutationBoostIII"],DOUBLE_HATCH:["DoubleHatch"],PET_REFUND:["PetRefund","PetRefundII"]},jd={ALLOWED_PANELS:{"xp-farming":["xp"],"coin-farming":["coin","xp","hatch"],"crop-farming":["growth","coin","xp","hatch"],"time-reduction":["growth","xp"],"mutation-hunting":["growth","coin","xp"],hatching:["hatch","xp"],efficiency:["xp"],balanced:["xp","growth","coin","hatch"],unknown:["xp","growth","coin","hatch"]}};function en(e,t){return e.abilities.some(n=>t.includes(n))}function Ht(e,t){return e.filter(n=>en(n,t)).length}function M5(e){return e.includes("IV")?4:e.includes("III")||e==="EggGrowthBoostII"?3:e.includes("II")||e.includes("_NEW")?2:1}function pa(e,t){const n=e.flatMap(r=>r.abilities.filter(o=>t.includes(o))).map(M5);return n.length===0?0:n.reduce((r,o)=>r+o,0)/n.length}function Ml(e){const t=x0(e);if(t.length===0)return {primary:"unknown",confidence:0,secondary:[],suggestedFeatures:[],reasons:["Team has no pets"]};const n=[],r={},o=Ht(t,Pe.XP_BOOST),i=Pt.XP.STR_DISTANCE_THRESHOLD,s=t.filter(H=>H.maxStrength===0?false:(H.maxStrength-H.currentStrength)/H.maxStrength>i).length,l=t.filter(H=>H.currentStrength<H.maxStrength).length;if(o>=1&&s>=2)r["xp-farming"]=Pt.XP.BOOST_PAIR,n.push(`1 XP Boost + ${s} high-need pets (>${i*100}% STR distance)`);else if(o>=2){const H=pa(t,Pe.XP_BOOST);r["xp-farming"]=Pt.XP.LEVELING_PAIR+H*Pt.TIER_BONUS,n.push(`${o} XP Boost pets (avg tier ${H.toFixed(1)})`);}else l>=2&&s>=1?(r["xp-farming"]=Pt.XP.LEVELING_PAIR,n.push(`${l} leveling pets with ${s} high-need`)):l>=2&&(r["xp-farming"]=Pt.XP.PASSIVE_LEVELING,n.push(`${l} pets below max STR`));const d=Ht(t,Pe.COIN_FINDER),c=Ht(t,Pe.SELL_BOOST),p=Ht(t,Pe.CROP_REFUND_HARVEST),m=Ht(t,Pe.RARE_GRANTERS),b=Ht(t,Pe.COMMON_GRANTERS),g=t.some(H=>en(H,Pe.COIN_FINDER)&&(en(H,Pe.RARE_GRANTERS)||en(H,Pe.COMMON_GRANTERS)));d>=1&&!g?(r["coin-farming"]=Pt.ECONOMY.DEDICATED_COIN,n.push("Dedicated Coin Finder team (no granters)")):c>=1&&p>=1?(r["coin-farming"]=Pt.ECONOMY.META_SELLING,n.push("Meta Selling Team (Sell Boost + Crop Refund/Harvest)")):d>=1&&g?(r["coin-farming"]=Pt.ECONOMY.PASSIVE_EFFICIENCY,r.efficiency=Math.max(r.efficiency||0,Pt.ECONOMY.PASSIVE_EFFICIENCY),n.push("Coin Finder + Granter (passive efficiency)")):(c>=1||p>=1)&&(r["coin-farming"]=Math.max(r["coin-farming"]||0,.7),n.push("Sell/Refund abilities (coin efficiency)"));const w=Ht(t,Pe.PLANT_GROWTH),_=Ht(t,Pe.CROP_MUTATION),C=Ht(t,Pe.CROP_SIZE),E=t.filter(H=>H.abilities.includes("DoubleHarvest")).length,P=t.filter(H=>H.abilities.includes("ProduceRefund")).length,O=t.some(H=>H.abilities.includes("DoubleHarvest")&&H.abilities.includes("ProduceRefund"));if(E>=3){let H=Pt.ECONOMY.ENDGAME_HARVEST;O&&(H+=Pt.ECONOMY.SYNERGY_BONUS),r["crop-farming"]=Math.max(r["crop-farming"]||0,H),n.push("Endgame Harvest Team (3x Double Harvest)"+(O?" + capybara synergy":""));}else if(E>=1&&P>=1){let H=.85;O&&(H+=Pt.ECONOMY.SYNERGY_BONUS),r["crop-farming"]=Math.max(r["crop-farming"]||0,H),n.push("Double Harvest + Crop Refund"+(O?" (same pet - capybara)":""));}else _>=1&&E===0&&(r["crop-farming"]=Math.max(r["crop-farming"]||0,Pt.ECONOMY.EARLY_REGROW),n.push("Early Game Regrow Team (Crop Mutation)"));if(m>=1){const H=t.some(D=>D.abilities.includes("RainbowGranter")),K=t.some(D=>D.abilities.includes("GoldGranter"));H?(r["crop-farming"]=Math.max(r["crop-farming"]||0,.95),n.push("Rainbow Granter (ultra-rare, intentional)")):K?(r["crop-farming"]=Math.max(r["crop-farming"]||0,.9),n.push("Gold Granter (ultra-rare)")):(r["crop-farming"]=Math.max(r["crop-farming"]||0,.75),n.push("Frost Granter (rare mutation)"));}const F=w+_+C+b;if(F>=2&&!r["crop-farming"]){const H=(pa(t,Pe.PLANT_GROWTH)+pa(t,Pe.CROP_MUTATION)+pa(t,Pe.CROP_SIZE))/3;r["crop-farming"]=Math.max(r["crop-farming"]||0,.7+H*.03),n.push(`${F} crop-related abilities`);}const A=Ht(t,Pe.EGG_GROWTH);if(A>=1&&(r["time-reduction"]=.7,n.push(`${A} Egg Growth Boost pet(s)`)),w>=1&&!r["crop-farming"]&&(r["time-reduction"]=Math.max(r["time-reduction"]||0,.5),n.push("Plant Growth Boost (crop speed)")),m>=1||_>=1){const H=t.some(D=>D.abilities.includes("RainbowGranter")),K=t.some(D=>D.abilities.includes("GoldGranter"));H||K?(r["mutation-hunting"]=.95,n.push(`${H?"Rainbow":"Gold"} Granter (mutation focus)`)):_>=1&&(r["mutation-hunting"]=.8,n.push("Crop Mutation Boost (targeted hunting)"));}const T=Ht(t,Pe.HUNGER_BOOST),M=Ht(t,Pe.HUNGER_RESTORE);T>=1&&M>=1?(r.efficiency=.85,n.push("Hunger Boost + Hunger Restore (long-term setup)")):(T>=1||M>=1)&&(r.efficiency=.6,n.push("Hunger management (reduced feeding)"));const S=d+m+b;S>=2&&(r.efficiency=Math.max(r.efficiency||0,.6),n.push(`${S} passive abilities (passive gains)`));const R=Ht(t,Pe.MAX_STR_BOOST),z=Ht(t,Pe.HATCH_XP),j=Ht(t,Pe.PET_MUTATION),q=Ht(t,Pe.DOUBLE_HATCH),U=Ht(t,Pe.PET_REFUND);if(R>=1){const H=pa(t,Pe.MAX_STR_BOOST),K=H>=3?Pt.HATCHING.TIER_3_MAX_STR:.85;r.hatching=K+H*Pt.TIER_BONUS,n.push(`Max Strength Boost (tier ${H.toFixed(1)}) - late-game meta`);}if(j>=1||q>=1||U>=1){const H=j+q+U,K=Pt.HATCHING.RAINBOW_HUNTING+H*Pt.HATCHING.COMBO_BONUS;r.hatching=Math.max(r.hatching||0,K),n.push(`${H} rainbow hunting abilities`);}z>=1&&!r.hatching&&(r.hatching=.5,n.push("Hatch XP Boost (early-game focus)"));const ce=t.filter(H=>en(H,Pe.MAX_STR_BOOST)||en(H,Pe.PET_MUTATION)||en(H,Pe.DOUBLE_HATCH)||en(H,Pe.PET_REFUND)).length;ce>=Math.ceil(t.length*.67)&&r.hatching&&(r.hatching=Math.max(r.hatching,.97),r["crop-farming"]&&r["crop-farming"]<.97&&t.filter(K=>(en(K,Pe.CROP_REFUND_HARVEST)||en(K,Pe.CROP_SIZE)||en(K,Pe.CROP_MUTATION))&&!en(K,Pe.PET_REFUND)&&!en(K,Pe.DOUBLE_HATCH)&&!en(K,Pe.PET_MUTATION)&&!en(K,Pe.MAX_STR_BOOST)).length===0&&(delete r["crop-farming"],n.push("Suppressed crop-farming (hatching majority override)")),n.push(`Hatching Majority (${ce}/${t.length} pets) - clear team purpose`));const W=Object.entries(r).sort(([,H],[,K])=>K-H);if(W.length===0)return {primary:"balanced",confidence:.3,secondary:[],suggestedFeatures:["xp","growth","coin","hatch"],reasons:["Mixed or unclear purpose"]};const[te,ne]=W[0],ie=W.slice(1).map(([H,K])=>({purpose:H,confidence:K}));return ne<Pt.CONFIDENCE_THRESHOLD?{primary:"balanced",confidence:ne,secondary:W.map(([H,K])=>({purpose:H,confidence:K})),suggestedFeatures:["xp","growth","coin","hatch"],reasons:[...n,`Low confidence (${(ne*100).toFixed(0)}%) - showing all panels`]}:{primary:te,confidence:ne,secondary:ie,suggestedFeatures:{"xp-farming":["xp"],"coin-farming":["coin","growth","xp"],"crop-farming":["growth","coin","xp"],"time-reduction":["growth","xp"],"mutation-hunting":["growth","coin","xp"],efficiency:["xp"],hatching:["hatch","growth","xp"],balanced:["xp","growth","coin","hatch"],unknown:["xp","growth","coin","hatch"]}[te]||["xp","growth","coin","hatch"],reasons:n}}async function L5(){try{const e=window.AudioContext||window.webkitAudioContext;if(!e)return;const t=new e,n=t.currentTime,r=t.createOscillator(),o=t.createGain();r.connect(o),o.connect(t.destination),r.type="sine",r.frequency.setValueAtTime(800,n),r.frequency.exponentialRampToValueAtTime(400,n+.03),o.gain.setValueAtTime(.12,n),o.gain.exponentialRampToValueAtTime(.001,n+.05),r.start(n),r.stop(n+.05),setTimeout(()=>t.close(),100);}catch{}}function R5(e={}){const{id:t,variant:n="default",size:r="md",round:o=false,sprite:i=null,onClick:a,disabled:s=false,playSound:l=true,tooltip:d}=e,c=x("button",{className:"gemini-icon-btn",id:t});c.type="button",n!=="default"&&c.classList.add(`gemini-icon-btn--${n}`),r!=="md"&&c.classList.add(`gemini-icon-btn--${r}`),o&&c.classList.add("gemini-icon-btn--round"),d&&(c.title=d),c.disabled=s;const p=x("span",{className:"gemini-icon-btn__content"});c.appendChild(p),i&&p.appendChild(i);const m=x("span",{className:"gemini-icon-btn__swap"});m.textContent="⇄",c.appendChild(m),c.addEventListener("click",async g=>{c.disabled||(l&&L5(),a?.(g));});const b=c;return b.setSprite=g=>{p.innerHTML="",g&&p.appendChild(g);},b.setVariant=g=>{c.classList.remove("gemini-icon-btn--default","gemini-icon-btn--plant","gemini-icon-btn--egg"),g!=="default"&&c.classList.add(`gemini-icon-btn--${g}`);},b.setDisabled=g=>{c.disabled=g;},b}const nC=`
/* ═══════════════════════════════════════════════════════════════════════════
   GEMINI ICON BUTTON - Raised Icon Button with Glassmorphism
   Design: Modern glass panel with colored 3D base shadow and satisfying press
   ═══════════════════════════════════════════════════════════════════════════ */

.gemini-icon-btn {
    /* Reset */
    appearance: none;
    border: none;
    cursor: pointer;
    font-family: inherit;
    
    /* Size */
    position: relative;
    width: 40px;
    height: 36px;
    padding: 0;
    flex-shrink: 0;
    
    /* CSS variable for colored 3D base - can be overridden by variants */
    --btn-base-color: color-mix(in oklab, var(--accent) 70%, black);
    
    /* Glassmorphism Background */
    background: linear-gradient(
        180deg,
        color-mix(in oklab, white 10%, color-mix(in oklab, var(--soft) 90%, transparent)) 0%,
        color-mix(in oklab, var(--soft) 75%, transparent) 50%,
        color-mix(in oklab, var(--soft) 60%, transparent) 100%
    );
    
    /* Simple border */
    border: 1px solid color-mix(in oklab, var(--border) 60%, transparent);
    border-radius: 10px;
    
    /* 3D RAISED EFFECT - Hard-edged shadow offset to bottom-right */
    box-shadow: 
        /* Hard edge creates visible "base" on bottom and right */
        2px 2px 0 0 var(--btn-base-color),
        /* Soft diffuse shadow for depth */
        3px 3px 6px color-mix(in oklab, var(--shadow) 25%, transparent),
        /* Inner top highlight */
        inset 0 1px 1px color-mix(in oklab, white 12%, transparent);
    
    /* Smooth Transitions */
    transition: 
        transform 0.1s cubic-bezier(0.34, 1.56, 0.64, 1),
        box-shadow 0.1s ease-out,
        border-color 0.2s ease,
        background 0.15s ease,
        filter 0.15s ease;
    
    -webkit-tap-highlight-color: transparent;
}

/* ─────────────────────────────────────────────────────────────────────────────
   CONTENT - Sprite/Icon Container
   ───────────────────────────────────────────────────────────────────────────── */

.gemini-icon-btn__content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    pointer-events: none;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 22px;
    height: 22px;
    overflow: hidden;
    z-index: 1;
    transition: transform 0.1s ease-out;
}

.gemini-icon-btn canvas {
    image-rendering: pixelated;
    display: block;
    max-width: 100%;
    max-height: 100%;
}

/* ─────────────────────────────────────────────────────────────────────────────
   SWAP INDICATOR - Bottom-right badge showing this is a toggle button
   ───────────────────────────────────────────────────────────────────────────── */

.gemini-icon-btn__swap {
    position: absolute;
    bottom: 1px;
    right: 1px;
    
    /* Sizing */
    width: 14px;
    height: 14px;
    
    /* No background - just the symbol */
    background: transparent;
    border-radius: 0;
    
    /* Text styling - visible against button */
    font-size: 10px;
    font-weight: 700;
    line-height: 14px;
    text-align: center;
    color: var(--fg);
    opacity: 0.7;
    text-shadow: 
        0 1px 0 color-mix(in oklab, var(--bg) 80%, transparent),
        0 0 3px color-mix(in oklab, var(--bg) 60%, transparent);
    
    /* Don't interfere with clicks */
    pointer-events: none;
    
    /* Smooth transitions */
    transition: 
        transform 0.15s ease,
        opacity 0.15s ease;
    
    z-index: 2;
}

/* Hover: indicator becomes more visible */
.gemini-icon-btn:hover:not(:disabled) .gemini-icon-btn__swap {
    opacity: 1;
    transform: scale(1.1);
}

/* Pressed: indicator follows button */
.gemini-icon-btn:active:not(:disabled) .gemini-icon-btn__swap {
    opacity: 0.8;
    transform: scale(0.95);
}

/* ─────────────────────────────────────────────────────────────────────────────
   STATES
   ───────────────────────────────────────────────────────────────────────────── */

/* Hover - lifts button, shadow grows */
.gemini-icon-btn:hover:not(:disabled) {
    transform: translate(-1px, -1px);
    border-color: color-mix(in oklab, var(--accent) 35%, var(--border));
    box-shadow: 
        /* Shadow grows as button lifts */
        4px 4px 0 0 var(--btn-base-color),
        5px 5px 10px color-mix(in oklab, var(--shadow) 30%, transparent),
        inset 0 1px 1px color-mix(in oklab, white 15%, transparent);
    filter: brightness(1.04);
}

/* Pressed - button sinks, shadow collapses */
.gemini-icon-btn:active:not(:disabled) {
    transform: translate(1px, 1px);
    transition: 
        transform 0.05s ease-out,
        box-shadow 0.05s ease-out,
        background 0.05s ease;
    box-shadow: 
        /* Shadow nearly gone - button pressed flat */
        1px 1px 0 0 var(--btn-base-color),
        2px 2px 4px color-mix(in oklab, var(--shadow) 20%, transparent),
        inset 0 1px 2px color-mix(in oklab, black 8%, transparent);
    filter: brightness(0.96);
    background: linear-gradient(
        180deg,
        color-mix(in oklab, var(--soft) 78%, transparent) 0%,
        color-mix(in oklab, var(--soft) 68%, transparent) 50%,
        color-mix(in oklab, var(--soft) 58%, transparent) 100%
    );
}

/* Disabled */
.gemini-icon-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    filter: saturate(0.9);
}

/* Focus ring */
.gemini-icon-btn:focus-visible {
    outline: none;
    box-shadow: 
        0 0 0 2px color-mix(in oklab, var(--accent) 50%, transparent),
        3px 3px 0 0 var(--btn-base-color),
        4px 4px 8px color-mix(in oklab, var(--shadow) 30%, transparent);
}

/* ═══════════════════════════════════════════════════════════════════════════
   VARIANTS - Override the base color for different button types
   ═══════════════════════════════════════════════════════════════════════════ */

/* Plant variant - green/cyan base */
.gemini-icon-btn--plant {
    --btn-base-color: color-mix(in oklab, var(--high) 60%, black);
    background: linear-gradient(
        180deg,
        color-mix(in oklab, white 8%, color-mix(in oklab, var(--high) 15%, color-mix(in oklab, var(--soft) 90%, transparent))) 0%,
        color-mix(in oklab, var(--high) 10%, color-mix(in oklab, var(--soft) 75%, transparent)) 50%,
        color-mix(in oklab, var(--high) 8%, color-mix(in oklab, var(--soft) 60%, transparent)) 100%
    );
    border-color: color-mix(in oklab, var(--high) 25%, var(--border));
}

.gemini-icon-btn--plant:hover:not(:disabled) {
    border-color: color-mix(in oklab, var(--high) 45%, var(--border));
}

/* Egg variant - purple base */
.gemini-icon-btn--egg {
    --btn-base-color: color-mix(in oklab, var(--accent-2) 60%, black);
    background: linear-gradient(
        180deg,
        color-mix(in oklab, white 8%, color-mix(in oklab, var(--accent-2) 15%, color-mix(in oklab, var(--soft) 90%, transparent))) 0%,
        color-mix(in oklab, var(--accent-2) 10%, color-mix(in oklab, var(--soft) 75%, transparent)) 50%,
        color-mix(in oklab, var(--accent-2) 8%, color-mix(in oklab, var(--soft) 60%, transparent)) 100%
    );
    border-color: color-mix(in oklab, var(--accent-2) 25%, var(--border));
}

.gemini-icon-btn--egg:hover:not(:disabled) {
    border-color: color-mix(in oklab, var(--accent-2) 45%, var(--border));
}

/* ═══════════════════════════════════════════════════════════════════════════
   SIZE VARIANTS
   ═══════════════════════════════════════════════════════════════════════════ */

.gemini-icon-btn--sm {
    width: 32px;
    height: 28px;
    border-radius: 8px;
}

.gemini-icon-btn--sm .gemini-icon-btn__content {
    width: 18px;
    height: 18px;
}

.gemini-icon-btn--lg {
    width: 48px;
    height: 44px;
    border-radius: 12px;
}

.gemini-icon-btn--lg .gemini-icon-btn__content {
    width: 26px;
    height: 26px;
}

/* ═══════════════════════════════════════════════════════════════════════════
   CIRCULAR VARIANT
   ═══════════════════════════════════════════════════════════════════════════ */

.gemini-icon-btn--round {
    width: 38px;
    height: 38px;
    border-radius: 50%;
}

.gemini-icon-btn--round.gemini-icon-btn--sm {
    width: 30px;
    height: 30px;
}

.gemini-icon-btn--round.gemini-icon-btn--lg {
    width: 46px;
    height: 46px;
}
`;class O5{constructor(){de(this,"card",null);de(this,"listContainer",null);de(this,"innerContent",null);de(this,"logs",[]);de(this,"filteredLogs",[]);de(this,"unsubscribe",null);de(this,"ITEM_HEIGHT",88);de(this,"BUFFER_SIZE",3);de(this,"VIEWPORT_HEIGHT",480);de(this,"renderedRange",{start:0,end:0});de(this,"scrollListener",null);de(this,"scrollScheduled",false);}build(){return this.card?this.card:this.createAbilityLogsCard()}destroy(){this.scrollListener&&this.listContainer&&(this.listContainer.removeEventListener("scroll",this.scrollListener),this.scrollListener=null),this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null),this.card=null,this.listContainer=null,this.innerContent=null,this.logs=[],this.filteredLogs=[];}async render(){const t=Bo(),n=t.get().abilityLogs;this.updateFromAbilityLogs(n),this.unsubscribe=t.subscribeAbility(()=>{const r=t.get().abilityLogs;this.updateFromAbilityLogs(r);});}updateFromAbilityLogs(t){if(!t||!Array.isArray(t)){this.logs=[],this.filteredLogs=[],this.updateList();return}this.logs=t.map(n=>{const i=we.get("abilities")?.[n.abilityId]?.name||n.abilityId||"Unknown Ability",a={action:n.abilityId,timestamp:n.performedAt,parameters:n.data||{}},s=wy(a),l=new Date(n.performedAt),d=l.toLocaleDateString("en-US",{month:"short",day:"numeric"}),c=l.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),p=`${d} ${c}`;return {timestamp:n.performedAt,petName:n.petName,petSpecies:n.petSpecies,abilityName:i,abilityId:n.abilityId,description:s,formattedDate:p}}),this.filteredLogs=[...this.logs],this.updateList();}createAbilityBadge(t,n){return Ms({variant:"ability",abilityId:t,abilityName:n}).root}createAbilityLogsCard(){const t=x("div",{className:"ability-logs-container",style:"display: flex; flex-direction: column; gap: 12px;"}),n=x("div",{style:"margin-bottom: 0;"}),r=vs({placeholder:"Search logs...",value:"",debounceMs:150,withClear:true,size:"sm",focusKey:"",onChange:o=>{const i=o.trim().toLowerCase();i?this.filteredLogs=this.logs.filter(a=>a.petName.toLowerCase().includes(i)||a.petSpecies.toLowerCase().includes(i)||a.abilityName.toLowerCase().includes(i)||a.description.toLowerCase().includes(i)):this.filteredLogs=[...this.logs],this.updateList();}});return n.appendChild(r.root),t.appendChild(n),this.listContainer=x("div",{className:"ability-logs-list",style:"max-height: 480px; overflow-y: auto; overflow-x: hidden; position: relative;"}),this.innerContent=x("div",{style:"display: flex; flex-direction: column; gap: 8px; position: relative;"}),this.listContainer.appendChild(this.innerContent),this.scrollListener=()=>{this.scrollScheduled||(this.scrollScheduled=true,requestAnimationFrame(()=>{this.handleScroll(),this.scrollScheduled=false;}));},this.listContainer.addEventListener("scroll",this.scrollListener),t.appendChild(this.listContainer),this.card=ft({title:"Ability Logs",subtitle:"Track all pet ability activations",expandable:true,defaultExpanded:true},t),this.card}updateList(){if(!this.listContainer||!this.innerContent)return;this.innerContent.replaceChildren(),this.renderedRange={start:0,end:0};const t=[...this.filteredLogs].sort((n,r)=>r.timestamp-n.timestamp);if(t.length===0){const n=x("div",{className:"ability-logs-empty",style:"padding: 24px; text-align: center; color: color-mix(in oklab, var(--fg) 60%, #9ca3af); font-size: 14px;"},"No ability logs yet");this.innerContent.appendChild(n);return}this.filteredLogs=t,this.listContainer.scrollTop=0,this.handleScroll();}handleScroll(){if(!this.listContainer||!this.innerContent)return;const t=this.listContainer.scrollTop,n=Math.ceil(this.VIEWPORT_HEIGHT/this.ITEM_HEIGHT);let r=Math.max(0,Math.floor(t/this.ITEM_HEIGHT)-this.BUFFER_SIZE),o=Math.min(this.filteredLogs.length,r+n+this.BUFFER_SIZE*2);if(r===this.renderedRange.start&&o===this.renderedRange.end)return;this.renderedRange={start:r,end:o},this.innerContent.replaceChildren();const i=r*this.ITEM_HEIGHT;if(i>0){const s=x("div",{style:`height: ${i}px; flex-shrink: 0;`});this.innerContent.appendChild(s);}for(let s=r;s<o;s++){const l=this.filteredLogs[s],d=this.createLogItemCard(l);this.innerContent.appendChild(d);}const a=Math.max(0,(this.filteredLogs.length-o)*this.ITEM_HEIGHT);if(a>0){const s=x("div",{style:`height: ${a}px; flex-shrink: 0;`});this.innerContent.appendChild(s);}}createLogItemCard(t){const n=x("div",{className:"ability-log-item",style:"background: var(--soft); border: 1px solid var(--border); border-radius: 8px; padding: 12px; display: flex; gap: 12px; align-items: center; transition: all 0.2s ease;"});n.addEventListener("pointerenter",function(){this.style.background="color-mix(in oklab, var(--soft) 90%, var(--fg) 10%)",this.style.borderColor="color-mix(in oklab, var(--border) 70%, var(--fg) 30%)";}),n.addEventListener("pointerleave",function(){this.style.background="var(--soft)",this.style.borderColor="var(--border)";});const r=x("div",{style:"width: 40px; height: 40px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; background: var(--muted); border-radius: 6px;"});try{const c=ye.toCanvas("pet",t.petSpecies);c&&(c.style.width="100%",c.style.height="100%",c.style.objectFit="contain",r.appendChild(c));}catch{r.textContent="🐾",r.style.fontSize="24px";}n.appendChild(r);const o=x("div",{style:"flex: 1; min-width: 0; display: flex; flex-direction: column; gap: 4px;"}),i=x("div",{style:"display: flex; align-items: center; justify-content: space-between; gap: 8px;"}),a=x("div",{style:"font-size: 14px; font-weight: 700; color: var(--fg); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"},t.petName),s=x("div",{style:"font-size: 11px; font-weight: 500; color: color-mix(in oklab, var(--fg) 60%, #9ca3af); white-space: nowrap;"},t.formattedDate);i.appendChild(a),i.appendChild(s),o.appendChild(i);const l=this.createAbilityBadge(t.abilityId,t.abilityName);o.appendChild(l);const d=x("div",{style:"font-size: 12px; color: color-mix(in oklab, var(--fg) 70%, #9ca3af); line-height: 1.4; overflow: hidden; text-overflow: ellipsis;"},t.description);return o.appendChild(d),n.appendChild(o),n}}const rC=`
.team-card-wrapper {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.team-card__mode-container {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
}

.team-card__content {
    display: flex;
    flex-direction: column;
    gap: 12px;
    width: 100%;
}

.team-card__disabled-state {
    text-align: center;
}

.team-card__disabled-message {
    color: var(--muted);
    font-size: 14px;
    margin-bottom: 12px;
}

.team-card__empty-state {
    color: var(--muted);
    text-align: center;
    font-size: 14px;
}

.team-card__list-container {
    display: flex;
    flex-direction: column;
    position: relative;
    width: 100%;
}

.team-card__list-container.is-reordering {
    /* Active reordering state */
}

.team-card__actions {
    display: flex;
    gap: 12px;
    justify-content: center;
    width: 100%;
}

/* ═══════════════════════════════════════════════════════════════════════════
   EXPAND BUTTON
   ═══════════════════════════════════════════════════════════════════════════ */

.team-list-item__expand {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 6px;
    margin-left: 8px;
    background: transparent;
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--muted);
    cursor: pointer;
    transition: all 0.2s ease;
    flex-shrink: 0;
}

.team-list-item__expand:hover {
    background: var(--soft);
    color: var(--fg);
    border-color: var(--accent);
}

.team-list-item__expand svg {
    transition: transform 0.2s ease;
}

.team-list-item__expand--open svg {
    transform: rotate(180deg);
}

/* ═══════════════════════════════════════════════════════════════════════════
   EXPANDED CONTAINER - 1 per team with 3 pet rows
   ═══════════════════════════════════════════════════════════════════════════ */

.team-expanded-container {
    display: flex;
    flex-direction: column;
    gap: 8px;
    padding: 12px;
    margin: 0 8px 8px 8px;
    background: linear-gradient(145deg, var(--soft), var(--bg));
    border: 1px solid var(--border);
    border-radius: 12px;
    animation: expandSlideIn 0.25s ease-out;
}

@keyframes expandSlideIn {
    from {
        opacity: 0;
        transform: translateY(-8px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
    margin: 4px 12px 12px 12px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
    animation: slideDown 0.3s ease-out;
    display: flex;
    flex-direction: column;
}

@keyframes slideDown {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* ═══════════════════════════════════════════════════════════════════════════
   PET ROW - Individual row with header + content
   ═══════════════════════════════════════════════════════════════════════════ */

.expanded-pet-row {
    display: flex;
    flex-direction: column;
    padding: 0 12px 14px 12px;
}

.expanded-pet-row:first-of-type {
    padding-top: 8px;
}

.pet-row__header {
    display: flex;
    align-items: center;
    background: var(--tab-bg);
    padding: 6px 12px;
    gap: 8px;
    border: 1px solid var(--border);
    border-top-left-radius: 12px;
    border-top-right-radius: 12px;
    border-bottom: none;
    margin-bottom: 0;
}

.expanded-pet-row .base-pet-card {
    border-top-left-radius: 0;
    border-top-right-radius: 0;
}

.pet-row__nav {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--fg);
    font-size: 14px;
    font-weight: 800;
    cursor: pointer;
    transition: all 0.15s ease;
    flex-shrink: 0;
}

.pet-row__nav:hover {
    background: var(--soft);
    border-color: var(--pill-to);
    transform: scale(1.05);
}

.pet-label {
    flex: 1;
    text-align: center;
    font-size: 11px;
    font-weight: 800;
    color: var(--fg);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    opacity: 0.8;
}

/* ═══════════════════════════════════════════════════════════════════════════
   FEATURE CARD - Individual Pet Feature Display
   ═══════════════════════════════════════════════════════════════════════════ */

.feature-card {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 10px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    min-height: 200px;
}

.feature-card__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 10px;
    background: linear-gradient(90deg, var(--accent), var(--pill-to));
    border-bottom: 1px solid var(--border);
    gap: 4px;
}

.feature-card__label {
    flex: 1;
    text-align: center;
    font-size: 11px;
    font-weight: 700;
    color: var(--fg);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.feature-card__nav {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 4px;
    color: var(--fg);
    font-size: 12px;
    font-weight: 800;
    cursor: pointer;
    transition: all 0.15s ease;
    flex-shrink: 0;
}

.feature-card__nav:hover {
    background: var(--soft);
    border-color: var(--pill-to);
}

.feature-card__content {
    flex: 1;
    padding: 10px;
    background: var(--soft);
    overflow-y: auto;
    max-height: 280px;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
}

.feature-card__content::-webkit-scrollbar {
    width: 4px;
}

.feature-card__content::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 2px;
}

/* ═══════════════════════════════════════════════════════════════════════════
   RESPONSIVE - Mobile Layout
   ═══════════════════════════════════════════════════════════════════════════ */

@media (max-width: 768px) {
    .team-expanded-cards {
        grid-template-columns: 1fr;
        gap: 8px;
        padding: 10px;
        margin: 0 4px 6px 4px;
    }

    .feature-card {
        min-height: 160px;
    }

    .feature-card__content {
        max-height: 220px;
    }
}

@media (max-width: 480px) {
    .team-list-item__expand {
        padding: 4px;
    }

    .feature-card__header {
        padding: 6px 8px;
    }

    .feature-card__label {
        font-size: 10px;
    }

    .feature-card__nav {
        width: 20px;
        height: 20px;
        font-size: 10px;
    }

    .feature-card__content {
        padding: 8px;
        max-height: 180px;
    }
}

/* ═══════════════════════════════════════════════════════════════════════════
   TEAM PROGRESS
   ═══════════════════════════════════════════════════════════════════════════ */

.team-progress-bar {
    position: relative;
    height: 16px;
    background: var(--border);
    border-radius: 8px;
    margin: 10px 12px 6px 12px;
    overflow: hidden;
    border: 1px solid var(--border);
    flex-shrink: 0;
}

.team-progress-bar__fill {
    height: 100%;
    border-radius: 7px;
    transition: width 0.3s ease;
}

/* Color coding for team progress bar */
.team-progress-bar__fill--low {
    background: linear-gradient(90deg, var(--low), var(--medium));
}
.team-progress-bar__fill--medium {
    background: linear-gradient(90deg, var(--medium), var(--high));
}
.team-progress-bar__fill--high {
    background: linear-gradient(90deg, var(--high), var(--complete));
}

.team-progress-bar__percent {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 10px;
    font-weight: 800;
    color: var(--fg);
    text-shadow: 0 1px 2px rgba(0,0,0,0.4);
    pointer-events: none;
}

/* BasePetCard provides its own mobile responsiveness. We only need minimal 
   overrides for the team-level containers if necessary. */

@media (max-width: 480px) {
    .team-expanded-container {
        margin: 4px 6px 8px 6px;
    }
    
    .team-progress-bar {
        pointer-events: none;
        z-index: 5;
    }

    .feature-card__header {
        padding: 6px 8px;
    }

    .feature-card__nav {
        width: 22px;
        height: 22px;
        font-size: 10px;
    }
}

/* 320px devices */
@media (max-width: 360px) {
    .pet-row__content {
        padding: 8px;
    }
    
    .xp-stat__label {
        font-size: 9px;
    }
}

`,oC=`
/* ═══════════════════════════════════════════════════════════════════════════
   BASE PET CARD - The Shell
   ═══════════════════════════════════════════════════════════════════════════ */

.base-pet-card {
    display: flex;
    align-items: stretch;
    gap: 16px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 12px;
    transition: all 0.2s ease;
    position: relative;
}

.base-pet-card--max {
    background: var(--bg);
}

.base-pet-card--starving {
    border-color: var(--low);
    background: linear-gradient(135deg, var(--soft), var(--bg));
}

.base-pet-card--centered {
    justify-content: center;
}

.base-pet-card--centered .base-pet-card__left {
    min-width: unset;
}

.base-pet-card--centered .base-pet-card__content {
    display: none;
}

/* ═══════════════════════════════════════════════════════════════════════════
   GROUPED PET CARD - Bundled sprites for 2-3 matching pets
   ═══════════════════════════════════════════════════════════════════════════ */

.base-pet-card--grouped,
.base-pet-card--grouped-2 {
    /* Grouped state inherits base card styles */
}

.base-pet-card--grouped .base-pet-card__left,
.base-pet-card--grouped-2 .base-pet-card__left {
    min-width: 110px;
}

/* Grouped sprite container with overlapping triad/duo formation */
.grouped-sprite-container {
    position: relative;
    width: 100px;
    height: 68px;
    display: flex;
    align-items: center;
    justify-content: center;
    /* No background - just sprites */
    overflow: visible;
}

.grouped-sprite-container canvas {
    position: absolute;
    /* Natural sizing - don't stretch */
    width: auto !important;
    height: auto !important;
    max-width: 56px;
    max-height: 56px;
    image-rendering: pixelated;
}

/* 3-pet triad formation - less vertical overlap, more horizontal spread */
.grouped-sprite-container canvas:nth-child(1) { z-index: 3; left: 24px; top: 4px; }
.grouped-sprite-container canvas:nth-child(2) { z-index: 2; left: -4px; top: 12px; }
.grouped-sprite-container canvas:nth-child(3) { z-index: 1; left: 52px; top: 12px; }

/* 2-pet duo formation - more horizontal spread */
.grouped-sprite-container--duo canvas:nth-child(1) { left: 6px; top: 4px; z-index: 2; }
.grouped-sprite-container--duo canvas:nth-child(2) { left: 46px; top: 4px; z-index: 1; }

/* Stacked badges in horizontal row matching sprite layout */
.grouped-badges {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    justify-content: center;
    margin-top: 4px;
    width: 100%;
}

.grouped-badges .badge {
    font-size: 8px !important;
    padding: 2px 5px !important;
    background: var(--pill-to);
    color: var(--pill-from);
    text-shadow: 
        -1px -1px 0 rgba(0, 0, 0, 0.8),
        1px -1px 0 rgba(0, 0, 0, 0.8),
        -1px 1px 0 rgba(0, 0, 0, 0.8),
        1px 1px 0 rgba(0, 0, 0, 0.8) !important;
    border: none;
    border-radius: 8px;
    white-space: nowrap;
}


/* ═══════════════════════════════════════════════════════════════════════════
   LEFT SECTION - Sprite & Identity
   ═══════════════════════════════════════════════════════════════════════════ */

.base-pet-card__left {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    min-width: 80px;
    flex-shrink: 0;
}

.base-pet-card__sprite-wrapper {
    width: 64px;
    height: 64px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--soft);
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
}

.base-pet-card__sprite-wrapper canvas {
    image-rendering: pixelated;
}

.base-pet-card__info {
    text-align: center;
    display: flex;
    flex-direction: column;
    gap: 2px;
    width: 100%;
}

.base-pet-card__name {
    font-size: 11px;
    font-weight: 800;
    color: var(--pill-to);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 80px;
}

.base-pet-card__str {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
    font-size: 10px;
    font-weight: 700;
}

.base-str__label { color: var(--muted); }
.base-str__current { 
    color: var(--pill-to); 
    font-weight: 800; 
    text-shadow: 
        -1px -1px 0 rgba(0, 0, 0, 0.8),
        1px -1px 0 rgba(0, 0, 0, 0.8),
        -1px 1px 0 rgba(0, 0, 0, 0.8),
        1px 1px 0 rgba(0, 0, 0, 0.8);
}
.base-str__max { 
    color: var(--muted); 
    text-shadow: 
        -1px -1px 0 rgba(0, 0, 0, 0.8),
        1px -1px 0 rgba(0, 0, 0, 0.8),
        -1px 1px 0 rgba(0, 0, 0, 0.8),
        1px 1px 0 rgba(0, 0, 0, 0.8);
}

/* ═══════════════════════════════════════════════════════════════════════════
   RIGHT SECTION - The Content Slot (Stat Grid Protocol)
   ═══════════════════════════════════════════════════════════════════════════ */

.base-pet-card__content {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 6px;
    justify-content: center;
    min-width: 0;
}

/* THE STAT GRID PROTOCOL */
.stat-row {
    display: flex;
    align-items: center;
    gap: 8px;
    width: 100%;
    min-height: 20px;
}

.stat-row--boost {
    border-radius: 4px;
    padding: 2px 0;
    margin-bottom: 2px;
}

.stat__label {
    font-size: 10px;
    font-weight: 800;
    color: var(--pill-to);
    min-width: 65px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.stat__value {
    font-size: 12px;
    font-weight: 700;
    color: var(--fg);
    white-space: nowrap;
}

.stat__value--accent {
    color: var(--pill-from);
}

.stat__timer {
    font-family: monospace;
    font-size: 12px;
    color: var(--pill-from);
    min-width: 45px;
}

.stat__feeds {
    font-size: 11px;
    color: var(--pill-from);
    min-width: 40px;
    text-align: right;
    display: inline-flex;
    align-items: center;
    gap: 4px;
}

.stat__feeds canvas {
    display: block;
    image-rendering: pixelated;
}

.stat__progress-mini {
    position: relative; /* For absolute percent positioning */
    flex: 1;
    height: 8px;
    background: var(--border);
    border-radius: 4px;
    overflow: visible; /* Allow percent to show */
    margin: 0 4px;
    min-width: 60px;
}

.stat__progress-fill {
    height: 100%;
    border-radius: 3px;
    transition: width 0.3s ease;
}

/* Solid blue for XP progress bars */
.stat__progress-fill--xp {
    background: var(--pill-to);
}

/* Gray for secondary progress (max STR) */
.stat__progress-fill--xp-secondary {
    background: var(--muted);
}

/* Legacy color variants (for non-XP usage) */
.stat__progress-fill--low { background: linear-gradient(90deg, var(--low), var(--medium)); }
.stat__progress-fill--medium { background: linear-gradient(90deg, var(--medium), var(--high)); }
.stat__progress-fill--high { background: linear-gradient(90deg, var(--high), var(--complete)); }

/* Growth panel: green for plants */
.stat__progress-fill--plant {
    background: linear-gradient(90deg, var(--accent-1), color-mix(in oklab, var(--accent-1) 70%, white));
}

/* Growth panel: purple for eggs */
.stat__progress-fill--egg {
    background: linear-gradient(90deg, var(--accent-2), color-mix(in oklab, var(--accent-2) 70%, white));
}

/* STR label inline with progress bar - supports both text and sprites */
.stat__str-label {
    font-size: 10px;
    font-weight: 700;
    color: var(--pill-to);
    white-space: nowrap;
    min-width: 50px;
    display: inline-flex;
    align-items: center;
    gap: 2px;
}

/* Canvas sprites within stat rows */
.stat__str-label canvas {
    display: block;
    image-rendering: pixelated;
    vertical-align: middle;
}

.stat__percent {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    font-size: 10px;
    font-weight: 800;
    color: var(--accent);
    text-shadow:
        -1px -1px 0 rgba(0, 0, 0, 0.8),
        1px -1px 0 rgba(0, 0, 0, 0.8),
        -1px 1px 0 rgba(0, 0, 0, 0.8),
        1px 1px 0 rgba(0, 0, 0, 0.8);
    pointer-events: none;
    z-index: 2;
}

/* Badge Override for Pet Card */
.base-pet-card .badge {
    background: var(--pill-to);
    color: var(--pill-from);
    text-shadow: 
        -1px -1px 0 rgba(0, 0, 0, 0.8),
        1px -1px 0 rgba(0, 0, 0, 0.8),
        -1px 1px 0 rgba(0, 0, 0, 0.8),
        1px 1px 0 rgba(0, 0, 0, 0.8) !important;
    border: none;
    font-size: 11px;
    padding: 3px 10px;
    height: auto;
}

/* ═══════════════════════════════════════════════════════════════════════════
   RESPONSIVE
   ═══════════════════════════════════════════════════════════════════════════ */

@media (max-width: 480px) {
    .base-pet-card {
        flex-direction: column;
        align-items: center;
        padding: 10px;
    }
    
    .base-pet-card__left {
        flex-direction: row;
        width: 100%;
        justify-content: flex-start;
        border-bottom: 1px dashed var(--border);
        padding-bottom: 8px;
        min-width: unset;
        gap: 12px;
    }

    .base-pet-card__sprite-wrapper {
        width: 56px;
        height: 56px;
        padding: 4px;
        overflow: visible;
        flex-shrink: 0;
    }

    .base-pet-card__info {
        flex-direction: row;
        align-items: center;
        justify-content: flex-start;
        gap: 12px;
        text-align: left;
    }

    .base-pet-card__name {
        font-size: 13px;
        max-width: 120px;
    }

    .base-pet-card .badge {
        font-size: 11px;
        padding: 4px 10px;
    }

    .base-pet-card__sprite-wrapper canvas {
        width: 100% !important;
        height: 100% !important;
        object-fit: contain;
    }
    
    .base-pet-card__content {
        width: 100%;
        padding-top: 4px;
    }

    .stat-row {
        flex-wrap: wrap;
        gap: 6px 8px;
        margin-bottom: 8px; /* More spacing between rows on mobile */
    }

    .stat__label {
        min-width: 60px;
    }

    .stat__str-label {
        order: 0; /* Sprite FIRST on mobile */
        min-width: 30px;
        font-size: 11px;
        font-weight: 600;
        color: var(--pill-to);
    }

    .stat__timer {
        order: 1; /* Timer SECOND on mobile */
        min-width: 50px;
    }

    .stat__feeds {
        order: 2;
        min-width: 35px;
    }

    .stat__progress-mini {
        min-width: 80px;
        flex: 1;
        order: 3;
    }

    /* Percent is inside progress bar, not separate */
}
`,ng=`
.badge{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:var(--badge-py, 6px) var(--badge-px, 12px);
  border-radius:var(--badge-radius, 12px);
  border:1px solid var(--border);
  background-color: color-mix(in oklab, var(--soft) 80%, transparent);
  color: var(--fg);
  font-size: var(--badge-fs, 13px);
  line-height:1.1;
  font-weight:600;
  white-space:nowrap;
  opacity:.98;
  transition:
    background-color .28s ease,
    border-color .28s ease,
    color .28s ease,
    box-shadow .28s ease;
}

.badge--pill{ border-radius:999px; }

.badge--sm{ --badge-py:4px; --badge-px:10px; --badge-fs:12px; --badge-radius:10px; }
.badge--md{ --badge-py:6px; --badge-px:12px; --badge-fs:13px; --badge-radius:12px; }
.badge--lg,.badge--large{
  --badge-py:8px; --badge-px:14px; --badge-fs:14px; --badge-radius:12px;
}

.badge--outline{ background-color: transparent; }
.badge--solid{ background-color: color-mix(in oklab, var(--border) 18%, transparent); }

.badge--neutral{ --bd: var(--border); }
.badge--info{    --bd: color-mix(in oklab, var(--info) 65%, var(--border)); }
.badge--success{ --bd: color-mix(in oklab, var(--high) 65%, var(--border)); }
.badge--warning{ --bd: color-mix(in oklab, var(--medium) 65%, var(--border)); }
.badge--danger{  --bd: color-mix(in oklab, var(--low) 65%, var(--border)); }

.badge.badge--neutral,
.badge.badge--info,
.badge.badge--success,
.badge.badge--warning,
.badge.badge--danger{
  border-color: var(--bd, var(--border));
}

.badge--soft.badge--info    { background-color: color-mix(in oklab, var(--info) 15%, transparent); }
.badge--soft.badge--success { background-color: color-mix(in oklab, var(--high) 14%, transparent); }
.badge--soft.badge--warning { background-color: color-mix(in oklab, var(--medium) 16%, transparent); }
.badge--soft.badge--danger  { background-color: color-mix(in oklab, var(--low) 15%, transparent); }

/* ===================== RARITY ===================== */
.badge.badge--rarity{
  display:inline-flex;
  justify-content:center;
  align-items:center;
  padding:4px 8px;
  border-radius:5px;
  font-size:12px;
  font-weight:700;
  line-height:1.1;
  white-space:nowrap;
  border:none;
  background:transparent;
  color:inherit;
}

.badge.badge--rarity.badge--rarity-common    { background: var(--rarity-common); color:#0b0b0b; }
.badge.badge--rarity.badge--rarity-uncommon  { background: var(--rarity-uncommon); color:#0b0b0b; }
.badge.badge--rarity.badge--rarity-rare      { background: var(--rarity-rare); color:#ffffff; }
.badge.badge--rarity.badge--rarity-legendary { background: var(--rarity-legendary); color:#0b0b0b; }
.badge.badge--rarity.badge--rarity-mythical  { background: var(--rarity-mythical); color:#ffffff; }
.badge.badge--rarity.badge--rarity-divine    { background: var(--rarity-divine); color:#0b0b0b; }

/* Animated celestial */
@keyframes badgeCelestialShift {
  0% { background-position: 0% 50%; }
  50%{ background-position:100% 50%; }
  100%{background-position: 0% 50%; }
}
.badge.badge--rarity.badge--rarity-celestial{
  background: linear-gradient(130deg,
    rgb(0,180,216) 0%,
    rgb(124,42,232) 40%,
    rgb(160,0,126) 60%,
    rgb(255,215,0) 100%);
  background-size:200% 200%;
  animation: badgeCelestialShift 4s linear infinite;
  color:#fff;
  -webkit-text-stroke: 0.2px #000;
}

/* >>> UNKNOWN <<< */
.badge.badge--rarity.badge--rarity-unknown{
  background:#000;
  color:#fff;
}

/* ===================== ABILITY ===================== */
.badge.badge--ability{
  display:inline-flex;
  align-items:center;
  padding:4px 10px;
  border-radius:6px;
  font-size:12px;
  font-weight:600;
  color:white;
  transition:background 0.2s ease;
  border:none;
  max-width:fit-content;
}
`,iC=`
/* ═══════════════════════════════════════════════════════════════════════════
   ARCADE BUTTON - 3D Push Button with Grey Base
   Reference: Classic arcade button with red dome, silver rim, dark base
   ═══════════════════════════════════════════════════════════════════════════ */

.arcade-btn {
    /* Reset */
    appearance: none;
    border: none;
    cursor: pointer;
    font-family: inherit;
    background: none;
    
    /* Size to accommodate 3D structure */
    position: relative;
    width: 44px;
    height: 40px;
    padding: 0;
    flex-shrink: 0;
    
    -webkit-tap-highlight-color: transparent;
}

/* ─────────────────────────────────────────────────────────────────────────────
   LAYER 1: Dark grey base pedestal (bottom)
   ───────────────────────────────────────────────────────────────────────────── */
.arcade-btn::before {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 42px;
    height: 10px;
    border-radius: 5px;
    background: linear-gradient(to bottom, #4a4a4a, #1a1a1a);
    box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.1),
        0 2px 4px rgba(0,0,0,0.6);
    z-index: 1;
}

/* ─────────────────────────────────────────────────────────────────────────────
   LAYER 2: Silver cylindrical rim (middle)
   - Viewed from above as an ellipse
   - Has inner depth shadow
   ───────────────────────────────────────────────────────────────────────────── */
.arcade-btn::after {
    content: '';
    position: absolute;
    bottom: 6px;
    left: 50%;
    transform: translateX(-50%);
    width: 38px;
    height: 18px;
    border-radius: 50%;
    background: linear-gradient(to bottom, #c0c0c0, #808080 50%, #606060);
    box-shadow:
        inset 0 3px 4px rgba(255,255,255,0.4),
        inset 0 -3px 6px rgba(0,0,0,0.4),
        0 1px 2px rgba(0,0,0,0.3);
    z-index: 2;
}

/* ─────────────────────────────────────────────────────────────────────────────
   LAYER 3: Red dome button (top) 
   - 3D dome shape using asymmetric border-radius
   - Overlaps into rim for seamless connection
   - Has highlight and shadow for depth
   ───────────────────────────────────────────────────────────────────────────── */
.arcade-btn__top {
    position: absolute;
    bottom: 16px;
    left: 50%;
    transform: translateX(-50%);
    width: 34px;
    height: 22px;
    /* Asymmetric border-radius creates dome viewed from above */
    border-radius: 50% 50% 50% 50% / 70% 70% 30% 30%;
    z-index: 3;
    
    /* Red dome gradient with 3D shading */
    background: 
        /* Highlight at top-left for glossy effect */
        radial-gradient(ellipse 45% 35% at 35% 25%, 
            rgba(255,255,255,0.6), 
            transparent
        ),
        /* Main dome gradient: light red at top, dark at bottom */
        linear-gradient(to bottom, 
            #ff5555 0%,
            #ee0000 40%,
            #aa0000 80%,
            #880000 100%
        );
    
    box-shadow:
        /* Dark red underbelly visible below */
        0 4px 0 #660000,
        /* Inner shadow at bottom for 3D curve */
        inset 0 -4px 8px rgba(0,0,0,0.35),
        /* Subtle inner highlight at top */
        inset 0 2px 4px rgba(255,200,200,0.3);
    
    transition: 
        bottom 0.06s ease-out,
        box-shadow 0.06s ease-out;
}

/* Sprite content centered on button */
.arcade-btn__content {
    position: absolute;
    top: 40%;
    left: 50%;
    transform: translate(-50%, -50%);
    pointer-events: none;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 18px;
    height: 14px;
    overflow: hidden;
    z-index: 4;
}

.arcade-btn canvas {
    image-rendering: pixelated;
    display: block;
    max-width: 100%;
    max-height: 100%;
}

/* ─────────────────────────────────────────────────────────────────────────────
   STATES
   ───────────────────────────────────────────────────────────────────────────── */

/* Hover - slight brightness increase */
.arcade-btn:hover:not(:disabled) .arcade-btn__top {
    filter: brightness(1.08);
}

/* Pressed - button pushes down into rim */
.arcade-btn:active:not(:disabled) .arcade-btn__top,
.arcade-btn.arcade-btn--pressed .arcade-btn__top {
    bottom: 10px;
    box-shadow:
        0 2px 0 #660000,
        inset 0 -2px 4px rgba(0,0,0,0.3),
        inset 0 1px 2px rgba(255,200,200,0.2);
}

/* Disabled */
.arcade-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* Focus ring */
.arcade-btn:focus-visible .arcade-btn__top {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
}

/* ═══════════════════════════════════════════════════════════════════════════
   VARIANTS - Override button top color only
   Base and rim stay the same (grey)
   ═══════════════════════════════════════════════════════════════════════════ */

/* Plant variant - Cyan/Teal */
.arcade-btn--plant .arcade-btn__top {
    background: 
        radial-gradient(ellipse 45% 35% at 35% 25%, 
            rgba(255,255,255,0.6), 
            transparent
        ),
        linear-gradient(to bottom, 
            #44dddd 0%,
            #00bbbb 40%,
            #008888 80%,
            #006666 100%
        );
    box-shadow:
        0 4px 0 #004444,
        inset 0 -4px 8px rgba(0,0,0,0.35),
        inset 0 2px 4px rgba(200,255,255,0.3);
}

.arcade-btn--plant:active:not(:disabled) .arcade-btn__top {
    box-shadow:
        0 2px 0 #004444,
        inset 0 -2px 4px rgba(0,0,0,0.3),
        inset 0 1px 2px rgba(200,255,255,0.2);
}

/* Egg variant - Purple */
.arcade-btn--egg .arcade-btn__top {
    background: 
        radial-gradient(ellipse 45% 35% at 35% 25%, 
            rgba(255,255,255,0.6), 
            transparent
        ),
        linear-gradient(to bottom, 
            #aa66ff 0%,
            #8844dd 40%,
            #6622aa 80%,
            #441177 100%
        );
    box-shadow:
        0 4px 0 #331066,
        inset 0 -4px 8px rgba(0,0,0,0.35),
        inset 0 2px 4px rgba(220,200,255,0.3);
}

.arcade-btn--egg:active:not(:disabled) .arcade-btn__top {
    box-shadow:
        0 2px 0 #331066,
        inset 0 -2px 4px rgba(0,0,0,0.3),
        inset 0 1px 2px rgba(220,200,255,0.2);
}
`,F5=`
  .ability-logs-container {
    width: 100%;
  }

  .ability-logs-list {
    /* Scrollbar styling */
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
  }

  .ability-logs-list::-webkit-scrollbar {
    width: 6px;
  }

  .ability-logs-list::-webkit-scrollbar-track {
    background: transparent;
  }

  .ability-logs-list::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 3px;
  }

  .ability-logs-list::-webkit-scrollbar-thumb:hover {
    background: color-mix(in oklab, var(--border) 70%, var(--fg) 30%);
  }

  .ability-log-item {
    cursor: pointer;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
  }

  /* Touch-friendly on mobile */
  @media (hover: none) and (pointer: coarse) {
    .ability-log-item {
      padding: 14px !important;
    }

    .ability-log-item:active {
      transform: scale(0.98);
    }
  }

  /* Responsive text sizing */
  @media (max-width: 480px) {
    .ability-log-item {
      padding: 10px !important;
      gap: 10px !important;
    }
  }

  /* Empty state styling */
  .ability-logs-empty {
    /* Styles are inline in AbilityLogsCard.ts */
  }

  /* Smooth animations */
  @media (prefers-reduced-motion: no-preference) {
    .ability-log-item {
      transition: all 0.2s ease;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .ability-log-item {
      transition: none;
    }
  }
`;class N5 extends Tr{constructor(n){super({id:"tab-pets",label:"Pets"});de(this,"unsubscribeMyPets");de(this,"lastActiveTeamId",null);de(this,"teamCardPart",null);de(this,"abilityLogsCardPart",null);de(this,"deps");this.deps=n;}async build(n){this.container=n;const{MGSprite:r}=await Pn(async()=>{const{MGSprite:a}=await Promise.resolve().then(()=>Sh);return {MGSprite:a}},void 0);await r.init();const o=n.getRootNode();vt(o,rC,"team-card-styles"),vt(o,oC,"base-pet-card-styles"),vt(o,ng,"badge-styles"),vt(o,iC,"arcade-button-styles"),vt(o,nC,"gemini-icon-button-styles"),vt(o,F5,"ability-logs-card-styles");const i=this.createGrid("12px");i.id="pets",n.appendChild(i),this.initializeTeamCardPart(i),this.initializeAbilityLogsCardPart(i),this.unsubscribeMyPets=Ge.myPets.subscribeStable(()=>{const a=ze.getActiveTeamId();a!==this.lastActiveTeamId&&(this.lastActiveTeamId=a,this.teamCardPart?.render());}),this.lastActiveTeamId=ze.getActiveTeamId();}async destroy(){this.unsubscribeMyPets&&(this.unsubscribeMyPets(),this.unsubscribeMyPets=void 0),this.teamCardPart&&(this.teamCardPart.destroy(),this.teamCardPart=null),this.abilityLogsCardPart&&(this.abilityLogsCardPart.destroy(),this.abilityLogsCardPart=null);}initializeTeamCardPart(n){this.teamCardPart||(this.teamCardPart=new I5({onTeamReordered:o=>{console.log("[PetsSection] Teams reordered:",o);},setHUDOpen:this.deps?.setHUDOpen}));const r=this.teamCardPart.build();n.appendChild(r),this.teamCardPart.render();}initializeAbilityLogsCardPart(n){this.abilityLogsCardPart||(this.abilityLogsCardPart=new O5);const r=this.abilityLogsCardPart.build();n.appendChild(r),this.abilityLogsCardPart.render();}}class D5{constructor(t){de(this,"root");de(this,"options");de(this,"headerElement",null);de(this,"petsContainer",null);de(this,"footerElement",null);this.options=t,this.root=document.createElement("div"),this.root.className="xp-panel";}build(){return this.headerElement=document.createElement("div"),this.headerElement.className="xp-panel__header",this.root.appendChild(this.headerElement),this.petsContainer=document.createElement("div"),this.petsContainer.className="xp-panel__pets",this.root.appendChild(this.petsContainer),this.footerElement=document.createElement("div"),this.footerElement.className="xp-panel__footer",this.root.appendChild(this.footerElement),this.root}update(t){this.updateHeader(t.teamSummary),this.updatePets(t.pets),this.updateFooter(t.teamSummary,t.pets);}updateHeader(t){this.headerElement&&(t.bonusXpPerHour>0,this.headerElement.innerHTML=`
            <div class="xp-panel__header-title">
                <span class="xp-panel__header-icon">📊</span>
                <span>XP Tracker</span>
            </div>
            <div class="xp-panel__header-rate">
                <span class="xp-panel__rate-total">${t.totalXpPerHour.toLocaleString()} XP/hr</span>
            </div>
        `);}updatePets(t){if(this.petsContainer){this.petsContainer.innerHTML="";for(const n of t){const r=this.buildPetCard(n);this.petsContainer.appendChild(r);}}}buildPetCard(t){const n=document.createElement("div");n.className="xp-pet-card",t.isStarving&&n.classList.add("xp-pet-card--starving"),t.isMaxStrength&&n.classList.add("xp-pet-card--max");const r=document.createElement("div");r.className="xp-pet-card__sprite";const o=document.createElement("div");o.className="xp-pet-card__sprite-wrapper";try{const c=t.mutations;if(ye.has("pet",t.species)){const p=ye.toCanvas("pet",t.species,{mutations:c,scale:1,boundsMode:"padded"});p.style.width="64px",p.style.height="64px",p.style.objectFit="contain",p.style.display="block",o.appendChild(p);}else o.innerHTML='<div class="xp-pet-card__sprite-fallback">🐾</div>';}catch(c){console.warn(`[TeamXpPanel] Failed to render sprite for ${t.species}:`,c),o.innerHTML='<div class="xp-pet-card__sprite-fallback">🐾</div>';}r.appendChild(o);const i=document.createElement("div");if(i.className="xp-pet-card__badges",t.isMaxStrength&&(i.innerHTML+='<span class="xp-badge xp-badge--max">MAX</span>'),t.isStarving&&(i.innerHTML+='<span class="xp-badge xp-badge--starving">STARVING</span>'),t.xpBoostStats){const c=t.xpBoostStats.tier==="Snowy"?"❄":"⚡";i.innerHTML+=`<span class="xp-badge xp-badge--boost">${c}${t.xpBoostStats.tier}</span>`;}r.appendChild(i);const a=document.createElement("div");a.className="xp-pet-card__str-display",a.innerHTML=`
            <span class="xp-str__label">STR</span>
            <span class="xp-str__current">${t.currentStrength}</span>
            <span class="xp-str__separator">/</span>
            <span class="xp-str__max">${t.maxStrength}</span>
        `,r.appendChild(a),n.appendChild(r);const s=document.createElement("div");s.className="xp-pet-card__stats";const l=document.createElement("div");l.className="xp-pet-card__name",l.textContent=t.name||t.species,s.appendChild(l);const d=document.createElement("table");return d.className="xp-stats-table",t.isStarving?d.innerHTML=`
                <tr class="xp-stats-table__row xp-stats-table__row--warning">
                    <td class="xp-stats-table__label">Status</td>
                    <td class="xp-stats-table__value xp-stats-table__value--danger">0 XP/hr - FEED NOW!</td>
                </tr>
            `:d.innerHTML=`
                ${t.isMaxStrength?"":`
                <tr class="xp-stats-table__row">
                    <td class="xp-stats-table__label">Next STR</td>
                    <td class="xp-stats-table__value">
                        ${this.buildProgressWithStats(t,"next")}
                    </td>
                </tr>
                <tr class="xp-stats-table__row">
                    <td class="xp-stats-table__label">Max STR</td>
                    <td class="xp-stats-table__value">
                        ${this.buildProgressWithStats(t,"max")}
                    </td>
                </tr>
                `}
                ${t.xpBoostStats?`
                <tr class="xp-stats-table__row xp-stats-table__row--boost">
                    <td class="xp-stats-table__label">XP Boost</td>
                    <td class="xp-stats-table__value">
                        <span class="xp-boost-stat">+${t.xpBoostStats.expectedXpPerHour.toLocaleString()} XP/hr</span>
                        ${t.xpBoostStats.isActive?"":'<span class="xp-inactive">(inactive)</span>'}
                    </td>
                </tr>
                `:""}
                ${t.supportingFeeds!==null?`
                <tr class="xp-stats-table__row xp-stats-table__row--support">
                    <td class="xp-stats-table__label">Supporting</td>
                    <td class="xp-stats-table__value">
                        <span class="xp-support">${t.supportingFeeds} feeds to carry team</span>
                    </td>
                </tr>
                `:""}
            `,s.appendChild(d),n.appendChild(s),n}buildProgressWithStats(t,n){const r=n==="next"?t.hoursToNextStrength:t.hoursToMaxStrength,o=n==="next"?t.feedsToNextStrength:t.feedsToMaxStrength,i=t.currentStrength-Math.floor(t.currentStrength),a=Math.floor(n==="next"?i*100:t.currentStrength/t.maxStrength*100),s=n==="next"?Math.min(99,Math.max(1,a)):Math.min(100,Math.max(0,a)),l=s<33?"low":s<67?"medium":"high";return `
            <div class="xp-progress-row">
                <span class="xp-progress-row__time">${this.formatHours(r)}</span>
                <span class="xp-progress-row__feeds">(🍖 x${o})</span>
                <div class="xp-progress-row__bar-container">
                    <div class="xp-progress-row__bar">
                        <div class="xp-progress-row__fill xp-progress-row__fill--${l}" style="width: ${s}%"></div>
                    </div>
                    <span class="xp-progress-row__percent">${s}%</span>
                </div>
            </div>
        `}updateFooter(t,n){if(!this.footerElement)return;if(t.activeBoosterCount===0){this.footerElement.innerHTML="",this.footerElement.classList.add("xp-panel__footer--hidden");return}this.footerElement.classList.remove("xp-panel__footer--hidden");const o=n.filter(i=>i.xpBoostStats?.isActive).map(i=>i.name||i.species).join(", ");this.footerElement.innerHTML=`
            <div class="xp-panel__footer-icon">⚡</div>
            <div class="xp-panel__footer-content">
                <div class="xp-panel__footer-title">
                    ${t.activeBoosterCount} XP Booster${t.activeBoosterCount!==1?"s":""} Active
                </div>
                <div class="xp-panel__footer-detail">
                    +${t.bonusXpPerHour.toLocaleString()} bonus XP/hr
                    <span class="xp-panel__footer-names">(${o})</span>
                </div>
            </div>
        `;}formatHours(t){if(t===null||t===0)return "0h";if(!isFinite(t))return "∞";if(t<1)return `${Math.ceil(t*60)}m`;if(t<24)return `${t.toFixed(1)}h`;{const n=Math.floor(t/24),r=Math.floor(t%24);return `${n}d ${r}h`}}destroy(){this.root.parentNode&&this.root.parentNode.removeChild(this.root),this.headerElement=null,this.petsContainer=null,this.footerElement=null;}}const $5={id:"xp",label:"XP",icon:"📊",category:"stats",isAvailable:()=>true,getSummary:(e,t)=>{const n=ub(e.id);return n>=99?null:{text:`${Math.round(n)}%`,variant:n<33?"low":n<67?"medium":"high",tooltip:`Average progress to max STR: ${Math.round(n)}%`,priority:10}},buildPanel:(e,t)=>{const n=new D5({teamId:e.id});t.appendChild(n.build());const r=oa(e.id);return r&&n.update(r),{update:(o,i)=>{const a=oa(o.id);a&&n.update(a);},destroy:()=>n.destroy(),refresh:()=>{const o=oa(e.id);o&&n.update(o);}}},renderPetSlot:(e,t,n)=>{const r=Ge.weather.get(),o=r.isActive?r.type:null,i=oa(t.id),a=i?.teamSummary.bonusXpPerHour||0,s=i?.pets||[],l=Math.max(0,...s.map(b=>b.hoursToMaxStrength||0)),d=Vp(e,o,a,l),c=d.isMaxStrength,p=!!d.xpBoostStats;let m="";if(c)p&&d.xpBoostStats&&(m=`
                    <div class="stat-row stat-row--boost">
                        <span class="stat__label">BOOST</span>
                        <span class="stat__value stat__value--accent">+${d.xpBoostStats.expectedXpPerHour.toLocaleString()} XP/h</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat__label">SUPPORT</span>
                        <span class="stat__value">${d.supportingFeeds} feeds</span>
                    </div>
                `);else {let b="";p&&d.xpBoostStats&&(b=`
                    <div class="stat-row stat-row--boost">
                        <span class="stat__label">BOOST</span>
                        <span class="stat__value stat__value--accent">+${d.xpBoostStats.expectedXpPerHour.toLocaleString()} XP/h</span>
                    </div>
                `);const g=d.maxStrength,w=d.currentStrength,_=Math.min(100,Math.max(0,Math.floor(w/g*100))),C=e.xp%3600/3600*100,E=Math.min(99,Math.max(1,Math.floor(C))),P=d.currentStrength+1,O=d.maxStrength;m=b+`
                <div class="stat-row">
                    <span class="stat__label">NEXT STR</span>
                    <span class="stat__timer">${pb(d.hoursToNextStrength||0)}</span>
                    <span class="stat__feeds">🍖 x${d.feedsToNextStrength}</span>
                    <span class="stat__str-label">STR ${P}</span>
                    <div class="stat__progress-mini">
                        <div class="stat__progress-fill stat__progress-fill--xp" style="width: ${E}%"></div>
                        <span class="stat__percent">${E}%</span>
                    </div>
                </div>
                <div class="stat-row">
                    <span class="stat__label">MAX STR</span>
                    <span class="stat__timer">${pb(d.hoursToMaxStrength||0)}</span>
                    <span class="stat__feeds">🍖 x${d.feedsToMaxStrength}</span>
                    <span class="stat__str-label">STR ${O}</span>
                    <div class="stat__progress-mini">
                        <div class="stat__progress-fill stat__progress-fill--xp" style="width: ${_}%"></div>
                        <span class="stat__percent">${_}%</span>
                    </div>
                </div>
            `;}n.innerHTML=m?`<div class="xp-stats-compact">${m}</div>`:"";},renderGroupedSlot:(e,t,n)=>{const r=Ge.weather.get(),o=r.isActive?r.type:null,a=oa(t.id)?.teamSummary.bonusXpPerHour||0;let s=0,l=0;for(const c of e){const p=Vp(c,o,a,0);p.xpBoostStats&&(s+=p.xpBoostStats.expectedXpPerHour),p.supportingFeeds&&(l+=p.supportingFeeds);}let d="";if(s>0&&(d=`
                <div class="stat-row stat-row--boost">
                    <span class="stat__label">TEAM BOOST</span>
                    <span class="stat__value stat__value--accent">+${s.toLocaleString()} XP/h</span>
                </div>
            `,l>0&&(d+=`
                    <div class="stat-row">
                        <span class="stat__label">SUPPORT</span>
                        <span class="stat__value">${l} feeds</span>
                    </div>
                `)),s===0){if(e.every(p=>p.currentStrength>=p.maxStrength))n.innerHTML=`
                    <div class="xp-stats-compact xp-stats-grouped">
                        <div class="stat-row stat-row--info">
                            <span class="stat__message">All pets at max STR</span>
                        </div>
                    </div>
                `;else {const p=ub(t.id);n.innerHTML=`
                    <div class="xp-stats-compact xp-stats-grouped">
                        <div class="stat-row stat-row--info">
                            <span class="stat__message">Leveling: ${Math.round(p)}%</span>
                        </div>
                    </div>
                `;}return}n.innerHTML=`<div class="xp-stats-compact xp-stats-grouped">${d}</div>`;},hasContent:(e,t)=>{const n=Array.isArray(e)?e:[e];return n.some(i=>i.currentStrength<i.maxStrength)?true:n.some(i=>i.abilities.some(a=>Pe.XP_BOOST.includes(a)))},shouldDisplay:(e,t,n)=>(jd.ALLOWED_PANELS[n.primary]||[]).includes("xp")?!!(t.some(a=>a.currentStrength<a.maxStrength)||t.some(a=>a.abilities.some(s=>Pe.XP_BOOST.includes(s)))):false,countRows:(e,t)=>{const n=Array.isArray(e)?e:[e];return n.every(o=>o.currentStrength>=o.maxStrength)?n.some(i=>i.abilities.some(a=>Pe.XP_BOOST.includes(a)))?1:0:2}};function Mt(e,t,n){const r=document.createElement(e);return t&&(r.className=t),n&&(r.textContent=n),r}function Lr(e){if(e<=0)return "0m";const t=Math.floor(e/1e3),n=Math.floor(t/86400),r=Math.floor(t%86400/3600),o=Math.floor(t%3600/60),i=[];return n>0&&i.push(`${n}d`),r>0&&i.push(`${r}h`),(o>0||i.length===0)&&i.push(`${o}m`),i.join(" ")}function Rr(e,t){const n=e==="egg"?"pet":"plant",r=Mt("span","sprite-wrapper");if(!t)return r;let o=t;e==="plant"&&(o==="DawnCelestial"&&(o="DawnCelestialCrop"),o==="MoonCelestial"&&(o="MoonCelestialCrop"));try{if(ye.isReady()&&ye.has(n,o)){const i=ye.toCanvas(n,o,{scale:.3});i.style.height="16px",i.style.width="auto",i.style.imageRendering="pixelated",r.appendChild(i);}}catch{}return r}function Ll(e,t){const n=Mt("span","stacked-sprites");if(t.length===0)return n;const r=e==="egg"?"pet":"plant",o=4,a=[...new Set(t.map(l=>e==="egg"?l.eggId:l.species).filter(Boolean))].slice(0,o);if(a.length===0)return n;n.style.display="grid",n.style.gridTemplateColumns="repeat(2, 10px)",n.style.gridTemplateRows="repeat(2, 10px)",n.style.width="24px",n.style.height="24px";let s=false;for(let l=0;l<a.length;l++){let d=a[l];e==="plant"&&d&&(d==="DawnCelestial"&&(d="DawnCelestialCrop"),d==="MoonCelestial"&&(d="MoonCelestialCrop"));try{if(ye.isReady()&&d&&ye.has(r,d)){const c=ye.toCanvas(r,d,{scale:.2});c.style.height="14px",c.style.width="auto",c.style.imageRendering="pixelated",c.style.position="relative",c.style.zIndex=String(o-l),n.appendChild(c),s=!0;}}catch{}}return s||(n.textContent=e==="egg"?"🥚":"🌱"),n}function Or(e,t,n,r,o,i){const a=Mt("div","stat-row"),s=Mt("span","stat__label",e),l=Mt("span","stat__timer",t),d=Mt("span","stat__str-label");d.appendChild(n);const c=Mt("div","stat__progress-mini"),p=Mt("div",`stat__progress-fill ${o}`);p.style.width=`${r}%`,c.appendChild(p);const m=`${r}%`,b=Mt("span","stat__percent",m);return c.appendChild(b),a.appendChild(s),n&&n.innerHTML!==""&&n.textContent!=="🥚"&&n.textContent!=="🌱"&&a.appendChild(d),a.appendChild(l),a.appendChild(c),a}function Pb(e){const t=Mt("div","stat-row stat-row--boost"),n=Mt("span","stat__label","BOOST");t.appendChild(n);const r=Mt("span","stat__values-row");return e.forEach((o,i)=>{const a=Mt("span","stat__boost-item");a.appendChild(o.sprite),a.appendChild(Mt("span","stat__value stat__value--accent",o.text)),r.appendChild(a),i<e.length-1&&r.appendChild(Mt("span","stat__separator"," "));}),t.appendChild(r),t}function Mb(e,t){const n=t==="egg"?is:as;let r=0,o=false;const i=[];for(const a of e.abilities)if(a in n){const s=n[a],l=s.procRate*60;r+=l*s.minutesPerProc,o=true,i.push(a);}return {hasBoost:o,minutesPerProc:0,hourlyReduction:r,abilityName:i.join(", ")}}function Lb(e,t){const n=ze.getPetsForTeam(e),r=t==="egg"?jh(n):Gh(n);return `${((60+ss(r).timeReductionPerHour)/60).toFixed(2)}x`}function Rl(e,t,n=1){return e.length===0?0:Math.round(e.reduce((r,o)=>{const i=t-o.plantedAt,s=(o.maturedAt-t)/n,l=i+s,d=l>0?i/l*100:0;return r+Math.min(100,Math.max(0,d))},0)/e.length)}function Ol(e,t,n=1){return e.length===0?0:Math.round(e.reduce((r,o)=>{const i=t-o.startTime,s=(o.endTime-t)/n,l=i+s,d=l>0?i/l*100:0;return r+Math.min(100,Math.max(0,d))},0)/e.length)}function Rb(e,t){if(e.length===0)return {remainingMs:0,name:null};const r=[...e].sort((o,i)=>o.maturedAt-i.maturedAt)[0];return {remainingMs:Math.max(0,r.maturedAt-t),name:r.eggId||null}}function Ob(e,t){if(e.length===0)return {remainingMs:0,name:null};const r=[...e].sort((o,i)=>o.endTime-i.endTime)[0];return {remainingMs:Math.max(0,r.endTime-t),name:r.species||null}}function Fb(e,t){if(e.length===0)return 0;const n=Math.max(...e.map(r=>r.maturedAt));return Math.max(0,n-t)}function Nb(e,t){if(e.length===0)return 0;const n=Math.max(...e.map(r=>r.endTime));return Math.max(0,n-t)}function Fr(e,t){return e<=0||t<=0?0:Math.round(e/t)}const B5={id:"growth",label:"Growth",icon:"⏱️",category:"tracking",isAvailable:()=>true,getSummary:(e,t)=>{const n=Ge.myGarden.get(),r=n.eggs.growing.length+n.plants.growing.length;return r===0?null:{text:`${r} growing`,variant:"neutral",tooltip:`${n.eggs.growing.length} eggs, ${n.plants.growing.length} plants`,priority:8}},buildPanel:(e,t)=>({update:()=>{},destroy:()=>{},refresh:()=>{}}),renderPetSlot:(e,t,n,r,o)=>{const i=Ge.myGarden.get(),a=Date.now(),s=Mb(e,"egg"),l=Mb(e,"plant");if(n.innerHTML="",!s.hasBoost&&!l.hasBoost)return;const d=o?i.eggs.growing.filter(A=>o.has(A.tileIndex)):i.eggs.growing,c=o?i.crops.growing.filter(A=>o.has(A.tileIndex)):i.crops.growing;let p=r;!p&&s.hasBoost!==l.hasBoost&&(p=s.hasBoost?"egg":"plant");const m=p==="egg"&&s.hasBoost||p==="plant"&&l.hasBoost,b=!p,g=Mt("div","growth-stats-compact");if(!m&&!b){const A=r==="egg"?"Egg":"Plant",T=Mt("div","stat-row stat-row--message");T.appendChild(Mt("span","stat__message",`No ${A} Growth Boost, Click the Button to Switch View`)),g.appendChild(T),n.appendChild(g);return}const w=[],_=s.hasBoost&&(p==="egg"||b),C=l.hasBoost&&(p==="plant"||b);if(_){const A=Math.round(s.hourlyReduction/60*100);w.push({text:`+${A}% Speed`,sprite:Rr("egg","UncommonEgg")});}if(C){const A=Math.round(l.hourlyReduction/60*100);w.push({text:`+${A}% Speed`,sprite:Rr("plant","Carrot")});}w.length>0&&g.appendChild(Pb(w));const E=Lb(t,"egg"),P=parseFloat(E.replace("x","")),O=Lb(t,"plant"),F=parseFloat(O.replace("x",""));if(s.hasBoost&&(p==="egg"||b)){const A=Rb(d,a),T=Fr(A.remainingMs,P),M=d.length>0?Rl(d,a,P):100,S=T>0?Lr(T):"Ready!";g.appendChild(Or("NEXT EGG",S,Rr("egg",A.name),M,"stat__progress-fill--egg"));}if(l.hasBoost&&(p==="plant"||b)){const A=Ob(c,a),T=Fr(A.remainingMs,F),M=c.length>0?Ol(c,a,F):100,S=T>0?Lr(T):"Ready!";g.appendChild(Or("NEXT PLANT",S,Rr("plant",A.name),M,"stat__progress-fill--plant"));}if(s.hasBoost&&(p==="egg"||b)){const A=d.length>0?Rl(d,a,P):100,T=Fb(d,a),M=Fr(T,P),S=M>0?Lr(M):"All Ready!";g.appendChild(Or("ALL EGGS",S,Ll("egg",d),A,"stat__progress-fill--egg"));}else if(l.hasBoost&&(p==="plant"||b)){const A=c.length>0?Ol(c,a,F):100,T=Nb(c,a),M=Fr(T,F),S=M>0?Lr(M):"All Ready!";g.appendChild(Or("ALL PLANTS",S,Ll("plant",c),A,"stat__progress-fill--plant"));}n.appendChild(g);},renderGroupedSlot:(e,t,n,r,o)=>{const i=Ge.myGarden.get(),a=Date.now(),s=jh(e),l=Gh(e),d=ss(s),c=ss(l);n.innerHTML="";const p=d.timeReductionPerHour>0,m=c.timeReductionPerHour>0;if(!p&&!m)return;const b=Mt("div","growth-stats-compact growth-stats-grouped"),g=o?i.eggs.growing.filter(A=>o.has(A.tileIndex)):i.eggs.growing,w=o?i.crops.growing.filter(A=>o.has(A.tileIndex)):i.crops.growing,_=r==="egg"&&p,C=r==="plant"&&m,E=!r,P=(60+d.timeReductionPerHour)/60,O=(60+c.timeReductionPerHour)/60,F=[];if((_||E)&&p){const A=Math.round(d.timeReductionPerHour/60*100);F.push({text:`+${A}% Speed`,sprite:Rr("egg","UncommonEgg")});}if((C||E)&&m){const A=Math.round(c.timeReductionPerHour/60*100);F.push({text:`+${A}% Speed`,sprite:Rr("plant","Carrot")});}if(F.length>0&&b.appendChild(Pb(F)),(_||E)&&p){const A=Rb(g,a),T=Fr(A.remainingMs,P),M=g.length>0?Rl(g,a,P):100,S=T>0?Lr(T):"Ready!";b.appendChild(Or("NEXT EGG",S,Rr("egg",A.name),M,"stat__progress-fill--egg"));}if((C||E)&&m){const A=Ob(w,a),T=Fr(A.remainingMs,O),M=w.length>0?Ol(w,a,O):100,S=T>0?Lr(T):"Ready!";b.appendChild(Or("NEXT PLANT",S,Rr("plant",A.name),M,"stat__progress-fill--plant"));}if((_||E)&&p){const A=g.length>0?Rl(g,a,P):100,T=Fb(g,a),M=Fr(T,P),S=M>0?Lr(M):"All Ready!";b.appendChild(Or("ALL EGGS",S,Ll("egg",g),A,"stat__progress-fill--egg"));}else if((C||E)&&m){const A=w.length>0?Ol(w,a,O):100,T=Nb(w,a),M=Fr(T,O),S=M>0?Lr(M):"All Ready!";b.appendChild(Or("ALL PLANTS",S,Ll("plant",w),A,"stat__progress-fill--plant"));}n.appendChild(b);},hasContent:(e,t)=>{const n=Array.isArray(e)?e:[e];return hi(n)||gi(n)},shouldDisplay:(e,t,n)=>{const o=(jd.ALLOWED_PANELS[n.primary]||[]).includes("growth"),i=hi(t)||gi(t);return o&&i},countRows:(e,t,n)=>{const r=Array.isArray(e)?e:[e],o=hi(r),i=gi(r);if(!o&&!i)return 0;if(n==="egg"||n==="plant")return 2;let a=0;return o&&(a+=2),i&&(a+=2),a}},Gd=1.5,Ca=["ProduceScaleBoost","ProduceScaleBoostII","ProduceScaleBoostIII","SnowyCropSizeBoost"],Sa=["ProduceMutationBoost","ProduceMutationBoostII","ProduceMutationBoostIII","SnowyCropMutationBoost"],ka=["RainDance","SnowGranter","FrostGranter","GoldGranter","RainbowGranter"],_a=["DoubleHarvest"],Aa=["ProduceRefund"];function wr(e,t,n){const r=document.createElement(e);return t&&(r.className=t),n&&(r.textContent=n),r}function Nr(e){if(e>=1e12)return `${(e/1e12).toFixed(2)}T`;if(e>=1e9)return `${(e/1e9).toFixed(2)}B`;if(e>=1e6)return `${(e/1e6).toFixed(2)}M`;if(e>=1e3){const t=e/1e3;return t>=100?`${Math.round(t)}k`:`${t.toFixed(1)}k`}return String(Math.round(e))}function Gi(e){const t=we.get("abilities");if(!t)return null;const n=t[e];return n?{id:e,name:n.name??e,baseProbability:n.baseProbability??0,scaleIncreasePercentage:n.baseParameters?.scaleIncreasePercentage??0,mutationChanceIncreasePercentage:n.baseParameters?.mutationChanceIncreasePercentage??0,grantedMutations:n.baseParameters?.grantedMutations??[],requiredWeather:n.baseParameters?.requiredWeather??null}:null}function At(e,t){return e.abilities.some(n=>t.includes(n))}function Ds(e,t,n){if(e.hunger<=0)return  false;const r=Gi(t);return !(!r||r.requiredWeather&&n!==r.requiredWeather)}function $s(e){return (e.currentStrength<0||e.currentStrength>100)&&console.warn(`[Gemini] Invalid strength: ${e.currentStrength} for pet ${e.name||"unknown"}`),(e.maxStrength<80||e.maxStrength>100)&&console.warn(`[Gemini] Unexpected maxStrength: ${e.maxStrength} for pet ${e.name||"unknown"} (expected 80-100)`),e.currentStrength/100}function Hd(e,t){return Math.min(100,e*t)}function z5(e,t,n,r,o=Gd){const i=wd(e);if(!i)return 0;const a=zn(e,t,n)*o,s=Math.min(t*(1+r/100),i.maxScale),l=zn(e,s,n)*o;return Math.max(0,l-a)}function aC(e,t,n,r,o=Gd){if(n.includes(r))return 0;const i=zn(e,t,n)*o,a=[...n,r],s=zn(e,t,a)*o;return Math.max(0,s-i)}function Yu(e,t,n){const r=wr("div","stat-row");return r.appendChild(wr("span","stat__label",e)),r.appendChild(wr("span","stat__value",t)),r.appendChild(wr("span","stat__timer",n)),r}function Db(e,t,n){const r=wr("div","stat-row");return r.appendChild(wr("span","stat__label",e)),r.appendChild(wr("span","stat__value",t)),r.appendChild(wr("span","stat__timer",n)),r}function j5(e,t,n){const o=Ge.myGarden.get().crops.mature,i=n?o.filter(d=>n.has(String(d.tileIndex))):o;if(i.length===0)return {perProc:0,perHour:0};let a=0,s=0;for(const d of e){const c=$s(d);for(const p of Ca){if(!d.abilities.includes(p)||!Ds(d,p,t))continue;const m=Gi(p);if(!m)continue;const b=Hd(m.baseProbability,c),g=m.scaleIncreasePercentage*c,w=b/100*60;let _=0,C=0;for(const P of i){const O=Math.max(1,Math.floor(P.fruitCount)),F=z5(P.species,P.targetScale,P.mutations,g);_+=F*O,C+=O;}const E=C>0?_/C:0;a+=E*w,s+=w;}}return {perProc:s>0?a/s:0,perHour:a}}function G5(e,t,n){const o=Ge.myGarden.get().crops.mature,i=Ge.weather.get(),a=we.get("weather"),s=n?o.filter(_=>n.has(String(_.tileIndex))):o;if(s.length===0||!i.isActive||!a)return {perProc:0,perHour:0};const l=a[i.type];if(!l?.mutator)return {perProc:0,perHour:0};const d=l.mutator.chancePerMinutePerCrop??0,c=l.mutator.mutation??"";let p=0;for(const _ of e){const C=$s(_);for(const E of Sa){if(!_.abilities.includes(E)||!Ds(_,E,t))continue;const P=Gi(E);if(!P)continue;const O=P.mutationChanceIncreasePercentage*C;p+=O;}}const m=d*(p/100),b=s.length*(m/100)*60;let g=0;for(const _ of s){const C=aC(_.species,_.targetScale,_.mutations,c);g+=C;}const w=s.length>0?g/s.length:0;return {perProc:w,perHour:b*w}}function H5(e,t,n){const o=Ge.myGarden.get().crops.mature,i=n?o.filter(d=>n.has(String(d.tileIndex))):o;if(i.length===0)return {perProc:0,perHour:0};let a=0,s=0;for(const d of e){const c=$s(d);for(const p of ka){if(!d.abilities.includes(p)||!Ds(d,p,t))continue;const m=Gi(p);if(!m)continue;const g=Hd(m.baseProbability,c)/100*60,w=m.grantedMutations;if(w.length===0)continue;const _=w[0];let C=0,E=0;for(const F of i){if(_==="Gold"||_==="Rainbow"){const S=F.mutations.includes("Gold"),R=F.mutations.includes("Rainbow");if(S||R)continue}else if(F.mutations.includes(_))continue;const T=Math.max(1,Math.floor(F.fruitCount)),M=aC(F.species,F.targetScale,F.mutations,_);C+=M*T,E+=T;}const O=(E>0?C/E:0)*g;a+=O,s+=g;}}return {perProc:s>0?a/s:0,perHour:a}}function U5(e,t,n){const r=Ge.myGarden.get(),o=r.crops.all,i=r.crops.mature,a=n?o.filter(m=>n.has(String(m.tileIndex))):o,s=n?i.filter(m=>n.has(String(m.tileIndex))):i,l=s.length>0?s:a;if(l.length===0)return {expectedCrops:0,expectedCoins:0};let d=0;for(const m of e){const b=$s(m);for(const g of _a){if(!m.abilities.includes(g)||!Ds(m,g,t))continue;const w=Gi(g);if(!w)continue;const _=Hd(w.baseProbability,b);d+=_/100;}}const c=l.length*d;let p=0;for(const m of l){const b=zn(m.species,m.targetScale,m.mutations)*Gd;p+=b*d;}return {expectedCrops:c,expectedCoins:p}}function W5(e,t,n){const r=Ge.myGarden.get(),o=r.crops.all,i=r.crops.mature,a=n?o.filter(m=>n.has(String(m.tileIndex))):o,s=n?i.filter(m=>n.has(String(m.tileIndex))):i,l=s.length>0?s:a;if(l.length===0)return {expectedCrops:0,expectedCoins:0};let d=0;for(const m of e){const b=$s(m);for(const g of Aa){if(!m.abilities.includes(g)||!Ds(m,g,t))continue;const w=Gi(g);if(!w)continue;const _=Hd(w.baseProbability,b);d+=_/100;}}const c=l.length*d;let p=0;for(const m of l){const b=zn(m.species,m.targetScale,m.mutations)*Gd;p+=b*d;}return {expectedCrops:c,expectedCoins:p}}const hf={id:"coin",label:"Value",icon:"💰",category:"tracking",isAvailable:()=>true,getSummary:(e,t)=>{const n=Ge.myGarden.get(),r=n.crops.all.length;return r===0?null:{text:`${r} crops`,variant:"neutral",tooltip:`${n.crops.mature.length} mature, ${n.crops.growing.length} growing`,priority:7}},buildPanel:(e,t)=>({update:()=>{},destroy:()=>{},refresh:()=>{}}),renderPetSlot:(e,t,n,r,o)=>{const i=[e];hf.renderGroupedSlot&&hf.renderGroupedSlot(i,t,n,r,o);},renderGroupedSlot:(e,t,n,r,o)=>{const i=Ge.weather.get(),a=i.isActive?i.type:null;n.innerHTML="";const s=wr("div","value-stats-compact"),l=e.some(b=>At(b,Ca)),d=e.some(b=>At(b,Sa)),c=e.some(b=>At(b,ka)),p=e.some(b=>At(b,_a)),m=e.some(b=>At(b,Aa));if(!(!l&&!d&&!c&&!p&&!m)){if(l){const b=j5(e,a,o);s.appendChild(Yu("SIZE BOOST",`+${Nr(b.perProc)}/proc`,`+${Nr(b.perHour)}/hr`));}if(d){const b=G5(e,a,o);s.appendChild(Yu("MUTATION BOOST",`+${Nr(b.perProc)}/proc`,`+${Nr(b.perHour)}/hr`));}if(c){const b=H5(e,a,o);s.appendChild(Yu("GRANTERS",`+${Nr(b.perProc)}/proc`,`+${Nr(b.perHour)}/hr`));}if(p){const b=U5(e,a,o);s.appendChild(Db("EXTRA HARVEST",`+${b.expectedCrops.toFixed(1)} crops`,`+${Nr(b.expectedCoins)} coins`));}if(m){const b=W5(e,a,o);s.appendChild(Db("CROP REFUND",`+${b.expectedCrops.toFixed(1)} crops`,`+${Nr(b.expectedCoins)} coins`));}n.appendChild(s);}},hasContent:(e,t)=>(Array.isArray(e)?e:[e]).some(r=>At(r,Ca)||At(r,Sa)||At(r,ka)||At(r,_a)||At(r,Aa)),shouldDisplay:(e,t,n)=>{const o=(jd.ALLOWED_PANELS[n.primary]||[]).includes("coin"),i=t.some(a=>At(a,Ca)||At(a,Sa)||At(a,ka)||At(a,_a)||At(a,Aa));return o&&i},countRows:(e,t)=>{const n=Array.isArray(e)?e:[e];let r=0;return n.some(o=>At(o,Ca))&&r++,n.some(o=>At(o,Sa))&&r++,n.some(o=>At(o,ka))&&r++,n.some(o=>At(o,_a))&&r++,n.some(o=>At(o,Aa))&&r++,r}},Jo=["DoubleHatch"],Qo=["PetRefund","PetRefundII"],Zo=["PetMutationBoost","PetMutationBoostII","PetMutationBoostIII"];function cn(e,t,n){const r=document.createElement(e);return t&&(r.className=t),n&&(r.textContent=n),r}function sC(e){const t=we.get("abilities");if(!t)return null;const n=t[e];return n?{id:e,name:n.name??e,baseProbability:n.baseProbability??0,mutationChanceIncreasePercentage:n.baseParameters?.mutationChanceIncreasePercentage??0}:null}function Zt(e,t){return e.abilities.some(n=>t.includes(n))}function rg(e){return e.hunger>0}function lC(e){return e.currentStrength/e.maxStrength}function cC(e,t){return Math.min(100,e*t)}function V5(e){const t=cn("span","sprite-wrapper");try{if(ye.isReady()&&ye.has("pet",e)){const n=ye.toCanvas("pet",e,{scale:.6});n.style.height="32px",n.style.width="auto",n.style.imageRendering="pixelated",t.appendChild(n);}}catch{t.textContent="🥚";}return t}function Fl(e,t){const n=cn("div","stat-row");n.appendChild(cn("span","stat__label",e));const r=cn("div","stat__sprite-grid");for(const o of t){if(o.value<=0)continue;const i=cn("div","stat__sprite-item");i.appendChild(V5(o.eggId));const a=cn("span","stat__sprite-value",o.value.toFixed(1));i.appendChild(a),r.appendChild(i);}return n.appendChild(r),n}function $b(e,t,n,r){const o=cn("div","stat-row");o.appendChild(cn("span","stat__label","PET MUTATION"));const i=cn("span","stat__values-row"),a=cn("span","stat__value stat__value--rainbow",`${e}% (${n})`);a.style.backgroundImage="var(--rainbow-text-gradient)",a.style.webkitBackgroundClip="text",a.style.webkitTextFillColor="transparent",a.style.backgroundClip="text",i.appendChild(a),i.appendChild(cn("span","stat__separator"," | "));const s=cn("span","stat__value stat__value--gold",`${t}% (${r})`);return i.appendChild(s),o.appendChild(i),o}function og(){const e=Ge.myInventory.get(),t=new Map;for(const n of e.items)if(n.itemType==="Egg"&&n.eggId){const r=t.get(n.eggId)||0;t.set(n.eggId,r+(n.quantity||1));}return t}function ig(e){const t=Ge.myGarden.get(),n=new Map,r=e?t.eggs.all.filter(o=>e.has(String(o.tileIndex))):t.eggs.all;for(const o of r){const i=n.get(o.eggId)||0;n.set(o.eggId,i+1);}return n}function Bb(e,t){const n=t?ig(t):og(),r=[];let o=0;for(const i of e){if(!rg(i))continue;const a=lC(i);for(const s of Jo){if(!i.abilities.includes(s))continue;const l=sC(s);if(!l)continue;const d=cC(l.baseProbability,a);o+=d/100;}}for(const[i,a]of n){const s=a*o;r.push({eggId:i,value:s});}return r}function zb(e,t){const n=t?ig(t):og(),r=[];let o=0;for(const i of e){if(!rg(i))continue;const a=lC(i);for(const s of Qo){if(!i.abilities.includes(s))continue;const l=sC(s);if(!l)continue;const d=cC(l.baseProbability,a);o+=d/100;}}for(const[i,a]of n){const s=a*o;r.push({eggId:i,value:s});}return r}function jb(e,t){const n=t?ig(t):og(),r=Array.from(n.values()).reduce((b,g)=>b+g,0);let o=0,i=0;for(const b of e){if(!rg(b))continue;Zo.some(w=>b.abilities.includes(w))&&(o+=b.currentStrength*1e-4,i+=b.currentStrength*.001);}const a=we.get("mutations");let s=1,l=.1;if(a){const b=a.Gold,g=a.Rainbow;b?.baseChance!==void 0&&(s=b.baseChance),g?.baseChance!==void 0&&(l=g.baseChance);}const d=s+i,c=l+o,p=r*d/100,m=r*c/100;return {goldChance:d,rainbowChance:c,expectedGold:p,expectedRainbow:m}}const q5={id:"hatch",label:"Hatching",icon:"🥚",category:"tracking",isAvailable:()=>true,getSummary:(e,t)=>{const r=Ge.myInventory.get().items.filter(o=>o.itemType==="Egg").reduce((o,i)=>o+(i.quantity||1),0);return r===0?null:{text:`${r} eggs`,variant:"neutral",tooltip:`${r} eggs in inventory`,priority:6}},buildPanel:(e,t)=>({update:()=>{},destroy:()=>{},refresh:()=>{}}),renderPetSlot:(e,t,n,r,o)=>{n.innerHTML="";const i=cn("div","hatching-stats-compact"),a=Zt(e,Jo),s=Zt(e,Qo),l=Zt(e,Zo);if(!a&&!s&&!l)return;const d=[e];if(a){const c=Bb(d,o);c.length>0&&i.appendChild(Fl("DOUBLE HATCH",c));}if(s){const c=zb(d,o);c.length>0&&i.appendChild(Fl("PET REFUND",c));}if(l){const c=jb(d,o),p=c.rainbowChance.toFixed(4),m=c.goldChance.toFixed(2),b=c.expectedRainbow<.01?`~${(c.expectedRainbow*100).toFixed(1)}%e`:c.expectedRainbow.toFixed(2),g=c.expectedGold.toFixed(2);i.appendChild($b(p,m,b,g));}n.appendChild(i);},renderGroupedSlot:(e,t,n,r,o)=>{n.innerHTML="";const i=cn("div","hatching-stats-compact"),a=e.some(d=>Zt(d,Jo)),s=e.some(d=>Zt(d,Qo)),l=e.some(d=>Zt(d,Zo));if(!(!a&&!s&&!l)){if(a){const d=Bb(e,o);d.length>0&&i.appendChild(Fl("DOUBLE HATCH",d));}if(s){const d=zb(e,o);d.length>0&&i.appendChild(Fl("PET REFUND",d));}if(l){const d=jb(e,o),c=d.rainbowChance.toFixed(4),p=d.goldChance.toFixed(2),m=d.expectedRainbow<.01?`~${(d.expectedRainbow*100).toFixed(1)}%e`:d.expectedRainbow.toFixed(2),b=d.expectedGold.toFixed(2);i.appendChild($b(c,p,m,b));}n.appendChild(i);}},hasContent:(e,t)=>(Array.isArray(e)?e:[e]).some(r=>Zt(r,Jo)||Zt(r,Qo)||Zt(r,Zo)),shouldDisplay:(e,t,n)=>{const o=(jd.ALLOWED_PANELS[n.primary]||[]).includes("hatch"),i=t.some(a=>Zt(a,Jo)||Zt(a,Qo)||Zt(a,Zo));return o&&i},countRows:(e,t)=>{const n=Array.isArray(e)?e:[e];let r=0;return n.some(o=>Zt(o,Jo))&&r++,n.some(o=>Zt(o,Qo))&&r++,n.some(o=>Zt(o,Zo))&&r++,r}},Gb=[$5,B5,hf,q5];function X5(e){let t=e;return t=t.replace(/_NEW$/,""),t=t.replace(/^Snowy/,""),t=t.replace(/(I|II|III|IV)$/,""),t}function dC(e){return new Set(e.abilities.map(X5))}function fa(e,t){if(e.size!==t.size)return  false;for(const n of e)if(!t.has(n))return  false;return  true}function Hb(e,t){return dC(e).has(t)}function K5(e,t){if(e.length<2)return {shouldGroup:false,matchingPets:[],remainingPets:e};if(t){const a=t==="egg"?"EggGrowthBoost":"PlantGrowthBoost",s=e.filter(d=>Hb(d,a)),l=e.filter(d=>!Hb(d,a));return s.length>=2?{shouldGroup:true,matchingPets:s,remainingPets:l}:{shouldGroup:false,matchingPets:[],remainingPets:e}}const n=e.map(a=>({pet:a,abilities:dC(a)}));if(e.length===3){const[a,s,l]=n;if(fa(a.abilities,s.abilities)&&fa(a.abilities,l.abilities))return {shouldGroup:true,matchingPets:[a.pet,s.pet,l.pet],remainingPets:[]}}const[r,o,i]=n;return fa(r.abilities,o.abilities)?{shouldGroup:true,matchingPets:[r.pet,o.pet],remainingPets:i?[i.pet]:[]}:i&&fa(r.abilities,i.abilities)?{shouldGroup:true,matchingPets:[r.pet,i.pet],remainingPets:[o.pet]}:i&&fa(o.abilities,i.abilities)?{shouldGroup:true,matchingPets:[o.pet,i.pet],remainingPets:[r.pet]}:{shouldGroup:false,matchingPets:[],remainingPets:e}}const Y5=3;function J5(e,t){const n=e.abilities||[],r=d=>n.some(c=>d.includes(c));if((r(Pe.DOUBLE_HATCH)||r(Pe.PET_REFUND)||r(Pe.PET_MUTATION)||r(Pe.MAX_STR_BOOST))&&t.some(d=>d.id==="hatch"))return "hatch";if((r(Pe.COIN_FINDER)||r(Pe.SELL_BOOST)||r(Pe.CROP_REFUND_HARVEST)||r(Pe.CROP_SIZE)||r(Pe.CROP_MUTATION)||r(Pe.RARE_GRANTERS)||r(Pe.COMMON_GRANTERS))&&t.some(d=>d.id==="coin"))return "coin";if((r(Pe.EGG_GROWTH)||r(Pe.PLANT_GROWTH))&&t.some(d=>d.id==="growth"))return "growth";const s=e.currentStrength<e.maxStrength,l=r(Pe.XP_BOOST);return (s||l)&&t.some(d=>d.id==="xp")?"xp":t[0]?.id||"xp"}class Q5{constructor(t){de(this,"expandedTeams",new Map);de(this,"featureUpdateInterval",null);de(this,"options");de(this,"tileFilter");this.options=t;}setTileFilter(t){this.tileFilter=t,this.refreshAllPanels();}refreshAllPanels(){for(const[t,n]of this.expandedTeams)this.updateSpecificTeam(t,n);}isExpanded(t){return this.expandedTeams.has(t)}toggle(t){this.expandedTeams.has(t)?this.collapse(t):this.expand(t);}expand(t,n=false,r){const o=this.options.getListContainer(),i=ze.getTeam(t);if(!i||!o)return;const a=ze.getPetsForTeam(i),s=Ge.myPets.get(),l=Ml(i),d=Gb.filter(O=>!(!O.isAvailable()||O.shouldDisplay&&!O.shouldDisplay(i,a,l)));if(d.length===0){console.warn("[TeamCardExpansion] No available features to display");return}const c=l.primary==="time-reduction"||hi(a)||gi(a);let p;if(c){const O=hi(a),F=gi(a),A=Ge.myGarden.get(),T=A.eggs.growing.length>0,M=A.crops.growing.length>0;O&&F?M&&!T?p="plant":T&&!M?p="egg":p="plant":F?p="plant":O&&(p="egg");}const m=x("div",{className:"team-expanded-container"}),b=[];let g=n?{shouldGroup:false,matchingPets:[],remainingPets:a}:this.analyzeTeamForGrouping(i,a,p);const w=d.some(O=>O.id==="growth"||O.id==="hatch"||O.id==="coin");if(g.shouldGroup&&!w&&(g.matchingPets.every(F=>F.currentStrength>=F.maxStrength)||(g={shouldGroup:false,matchingPets:[],remainingPets:a})),g.shouldGroup&&g.matchingPets.length>=2){const O=d.filter(T=>!T.hasContent||T.hasContent(g.matchingPets,i)),F=O.find(T=>T.id==="growth"||T.id==="hatch"||T.id==="coin")||O[0]||d[0],A=this.createGroupedPetRow(i,g.matchingPets,d,F,p,t);m.appendChild(A.container),b.push(A.cardState);for(const T of g.remainingPets){const M=i.petIds.indexOf(T.id),S=this.createIndividualPetRow(i,T,M,d,p,t);m.appendChild(S.container),b.push(S.cardState);}}else for(let O=0;O<3;O++){const F=i.petIds[O],A=F?s.all.find(M=>M.id===F)??null:null,T=this.createIndividualPetRow(i,A,O,d,p,t,r);m.appendChild(T.container),b.push(T.cardState);}this.expandedTeams.set(t,{cards:b,expandedAt:Date.now(),container:m,growthViewType:p});const _=r==="xp"?"xp":r==="growth"?"growth":void 0;this.addProgressBar(m,a,t,_);const E=ze.getAllTeams().findIndex(O=>O.id===t),P=Array.from(o.children).filter(O=>O instanceof HTMLElement&&O.classList.contains("team-list-item"));E!==-1&&E<P.length&&P[E].insertAdjacentElement("afterend",m),this.startUpdates();}collapse(t){const n=this.expandedTeams.get(t);if(n){for(const r of n.cards)r.shell&&r.shell.destroy();n.container.remove(),this.expandedTeams.delete(t),this.expandedTeams.size===0&&this.stopUpdates();}}cleanupAll(){const t=Array.from(this.expandedTeams.keys());for(const n of t)this.collapse(n);}destroy(){this.cleanupAll(),this.stopUpdates();}addProgressBar(t,n,r,o){const i=ze.getTeam(r),a=i?Ml(i):null,s=this.expandedTeams.get(r),l=a?.primary==="time-reduction"||hi(n)||gi(n),d=o??(l?"growth":"xp");s&&(s.currentBarMode=d),d==="growth"?this.renderGrowthSummaryBar(t,n,r):this.renderXpProgressBar(t,n);}updateProgressBarForFeature(t,n){const r=this.expandedTeams.get(t);if(!r)return;const o=ze.getTeam(t);if(!o||n!=="xp"&&n!=="growth")return;const i=ze.getPetsForTeam(o),a=n==="xp"?"xp":"growth";if(r.currentBarMode===a)return;const s=r.container.querySelector(".growth-summary-overhaul"),l=r.container.querySelector(".team-progress-bar:not(.team-progress-bar--egg):not(.team-progress-bar--plant)");s&&s.remove(),l&&l.remove(),this.addProgressBar(r.container,i,t,a);}renderXpProgressBar(t,n){if(n.some(o=>o.currentStrength<o.maxStrength)&&n.length>0){const o=Math.round(n.reduce((d,c)=>d+c.currentStrength/c.maxStrength,0)/n.length*100),i=x("div",{className:"team-progress-bar"}),a=o<33?"low":o<67?"medium":"high",s=x("div",{className:`team-progress-bar__fill team-progress-bar__fill--${a}`});s.style.width=`${o}%`;const l=x("div",{className:"team-progress-bar__percent",textContent:`${o}%`});i.appendChild(s),i.appendChild(l),t.prepend(i);}}renderGrowthSummaryBar(t,n,r){const o=this.expandedTeams.get(r),i=o?.growthViewType||"plant",a=Ge.myGarden.get(),s=Date.now(),l=i==="egg"?a.eggs.growing:a.crops.growing,d=this.tileFilter?l.filter(W=>this.tileFilter.has(W.tileIndex)):l,c=d.length,p=jh(n),m=Gh(n),b=ss(p).timeReductionPerHour,g=ss(m).timeReductionPerHour,w=Math.round(i==="egg"?b:g);let _=c>0?0:100;if(c>0){const W=(60+w)/60;_=Math.round(d.reduce((te,ne)=>{const ie=i==="egg"?ne.plantedAt:ne.startTime,ee=i==="egg"?ne.maturedAt:ne.endTime,H=s-ie,D=(ee-s)/W,B=H+D,Q=B>0?H/B*100:0;return te+Math.min(100,Math.max(0,Q))},0)/c);}let C=d.find(W=>W.tileIndex===o?.pinnedItemId);!C&&c>0&&(C=[...d].sort((W,te)=>{const ne=i==="egg"?W.maturedAt:W.endTime,ie=i==="egg"?te.maturedAt:te.endTime;return ne-ie})[0]);const E=x("div",{className:"growth-summary-overhaul"}),P=x("div",{className:`team-progress-bar team-progress-bar--${i}`}),O=x("div",{className:`team-progress-bar__fill team-progress-bar__fill--${i}`});O.style.width=`${_}%`;const F=W=>{const te=Math.floor(W/60),ne=W%60;return te>0&&ne>0?`${te}h ${ne}m/h`:te>0?`${te}h/h`:`${ne}m/h`};w>0&&((60+w)/60).toFixed(2)+"";const A=x("div",{className:"team-progress-bar__overlay"});A.innerHTML=`
            <span class="bar-percent">${_}%</span>
            <span class="bar-info">${c} total +${F(w)}</span>
        `,P.appendChild(O),P.appendChild(A);const T=x("div",{className:"growth-next-item"});if(C){let W=i==="egg"?C.eggId:C.species;const te=i==="egg"?"pet":"plant";i==="plant"&&W&&(W==="DawnCelestial"&&(W="DawnCelestialCrop"),W==="MoonCelestial"&&(W="MoonCelestialCrop"));const ne=i==="egg"?C.maturedAt:C.endTime;i==="egg"?C.plantedAt:C.startTime;const ie=(60+w)/60,ee=Math.max(0,Math.round((ne-s)/ie)),H=s+ee,K=new Date(H),D=K.getDate()!==new Date().getDate(),B=K.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}).toLowerCase(),Q=`${D?"Tomorrow ":""}${B}`,ae=ve=>{const Ie=Math.floor(ve/1e3),Be=Math.floor(Ie/60),bt=Math.floor(Be/60);return bt>0?`${bt}h ${Be%60}m ${Ie%60}s`:Be>0?`${Be}m ${Ie%60}s`:`${Ie}s`},le=x("div",{className:"growth-next-sprite"});try{if(ye.isReady()&&ye.has(te,W)){const ve=ye.toCanvas(te,W,{scale:.3});ve.style.height="20px",ve.style.width="auto",ve.style.imageRendering="pixelated",le.appendChild(ve);}else le.textContent=i==="egg"?"🥚":"🌱";}catch(ve){console.warn("[GrowthSummary] Sprite error:",ve),le.textContent=i==="egg"?"🥚":"🌱";}T.innerHTML=`
                <div class="growth-next-details">
                    <span class="growth-next-time">${ae(ee)}</span>
                    <span class="growth-next-date">| ${Q}</span>
                </div>
            `,T.prepend(le);}else T.innerHTML='<span class="empty-text">No items growing</span>';const M=x("div",{className:"growth-overhaul-controls"}),S=i==="egg"?"UncommonEgg":"Carrot",R=i==="egg"?"pet":"plant";let z=null;try{ye.isReady()&&ye.has(R,S)&&(z=ye.toCanvas(R,S,{scale:.35}));}catch{}const j=R5({variant:i==="egg"?"egg":"plant",sprite:z,playSound:true,tooltip:`Switch to ${i==="egg"?"plants":"eggs"}`,onClick:W=>{W.stopPropagation(),o&&(o.growthViewType=i==="egg"?"plant":"egg",o.pinnedItemId=void 0,this.updateGrowthSummary(r));}}),q=x("button",{className:"growth-dropdown-overhaul",textContent:"▼"});q.onclick=W=>{W.stopPropagation(),this.showGrowthDropdown(q,d,i,r);},b>0&&g>0&&M.appendChild(j),M.appendChild(q),E.appendChild(P),E.appendChild(T),E.appendChild(M);const ce=t.querySelector(".growth-summary-overhaul");ce?ce.replaceWith(E):t.prepend(E);}updateGrowthSummary(t){const n=this.expandedTeams.get(t);if(n){const r=ze.getTeam(t);if(!r)return;const o=ze.getPetsForTeam(r);this.renderGrowthSummaryBar(n.container,o,t);const i=this.analyzeTeamForGrouping(r,o,n.growthViewType),a=n.cards.some(l=>l.slotIndex===-1),s=i.shouldGroup&&i.matchingPets.length>=2;if(a!==s){this.collapse(t),requestAnimationFrame(()=>this.expand(t,false));return}if(a&&s){const l=n.cards.find(d=>d.slotIndex===-1);if(l?.shell&&(l.shell.root.classList.contains("base-pet-card--grouped")?3:l.shell.root.classList.contains("base-pet-card--grouped-2")?2:0)!==i.matchingPets.length){this.collapse(t),requestAnimationFrame(()=>this.expand(t,false));return}}this.updateGroupedCardsViewType(t,n),this.updateSpecificTeam(t,n);}}updateSpecificTeam(t,n){const r=ze.getTeam(t);if(!r)return;const o=Ge.myPets.get();for(const i of n.cards){const a=r.petIds[i.slotIndex],s=a?o.all.find(l=>l.id===a):null;if(s&&i.shell&&(i.shell.update(s),i.featureData.renderPetSlot))try{const l=i.shell.getContentSlot();i.featureData.renderPetSlot(s,r,l,n.growthViewType,this.tileFilter);const d=s.currentStrength>=s.maxStrength,c=l.children.length>0||l.textContent.trim().length>0;i.shell.setCentered(d&&!c);}catch(l){console.error(`[TeamCardExpansion] Failed to render slot for ${s.id}:`,l);}}}updateGroupedCardsViewType(t,n){const r=ze.getTeam(t);if(r){for(const o of n.cards)if(o.slotIndex===-1&&o.shell){const i=o.shell.getContentSlot();if(o.featureData.renderGroupedSlot&&o.shell.root.classList.contains("base-pet-card--grouped")){i.innerHTML="";const a=ze.getPetsForTeam(r);o.featureData.renderGroupedSlot(a,r,i,n.growthViewType,this.tileFilter);const s=i.children.length>0||i.textContent.trim().length>0;o.shell.setCentered(!s);}}}}showGrowthDropdown(t,n,r,o){const i=document.querySelector(".growth-dropdown-menu");if(i){const d=i.getAttribute("data-owner-id")===o&&i.getAttribute("data-view-type")===r;if(i.remove(),d)return}const a=x("div",{className:"growth-dropdown-menu"});if(a.setAttribute("data-owner-id",o),a.setAttribute("data-view-type",r),n.length===0){const d=x("div",{className:"growth-dropdown-option"});d.textContent="No items growing",a.appendChild(d);}else {const d=r==="egg"?"pet":"plant";n.forEach(c=>{const p=c.tileIndex;let m=r==="egg"?c.eggId:c.species;r==="plant"&&(m==="DawnCelestial"&&(m="DawnCelestialCrop"),m==="MoonCelestial"&&(m="MoonCelestialCrop"));const b=x("div",{className:"growth-dropdown-option"}),g=x("span",{className:"dropdown-sprite"});try{if(ye.isReady()&&ye.has(d,m)){const P=ye.toCanvas(d,m,{scale:.3});P.style.height="16px",P.style.width="auto",P.style.imageRendering="pixelated",g.appendChild(P);}else g.textContent=r==="egg"?"🥚":"🌱";}catch{g.textContent=r==="egg"?"🥚":"🌱";}const w=r==="egg"?c.maturedAt:c.endTime,C=new Date(w).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}).toLowerCase(),E=x("span",{className:"dropdown-text"});E.textContent=`${m} - ${C}`,b.appendChild(g),b.appendChild(E),b.onclick=P=>{P.stopPropagation();const O=this.expandedTeams.get(o);O&&(O.pinnedItemId=p,this.updateGrowthSummary(o)),a.remove();},a.appendChild(b);});}const s=t.getBoundingClientRect();a.style.position="fixed",a.style.bottom=`${window.innerHeight-s.top+4}px`,a.style.top="auto",a.style.left="auto",a.style.right=`${window.innerWidth-s.right}px`,a.style.marginTop="0",a.style.zIndex="999999",document.body.appendChild(a);const l=d=>{!a.contains(d.target)&&d.target!==t&&(a.remove(),document.removeEventListener("click",l,true));};setTimeout(()=>document.addEventListener("click",l,true),10);}createIndividualPetRow(t,n,r,o,i,a,s){const l=n?o.filter(F=>!F.hasContent||F.hasContent(n,t)):o,d=l.length>0?l:o;let c=d[0];if(s)c=d.find(F=>F.id===s)||d[0];else if(n){const F=J5(n,d);c=d.find(A=>A.id===F)||d[0];}else {const A=Ml(t)?.suggestedFeatures||[];let T=false;for(const M of A){const S=d.find(R=>R.id===M);if(S){c=S,T=true;break}}T||(i?c=d.find(M=>M.id==="growth")||d[0]:c=d.find(M=>M.id==="xp")||d[0]);}const p=x("div",{className:"expanded-pet-row"}),m=x("div",{className:"pet-row__header"}),b=x("button",{textContent:"<",className:"pet-row__nav"}),g=x("div",{textContent:`${c.icon} ${c.label.toUpperCase()}`,className:"pet-label"}),w=x("button",{textContent:">",className:"pet-row__nav"});let _=null;n&&(_=new P5(n));const C={slotIndex:r,currentFeatureId:c.id,shell:_,featureData:c},E=F=>{const A=d[F];if(A.id==="growth"){const T=ze.getPetsForTeam(t),M=this.expandedTeams.get(a),S=this.analyzeTeamForGrouping(t,T,M?.growthViewType);if(S.shouldGroup&&S.matchingPets.length>=2){this.collapseAndReexpandForGrowth(a);return}}if(g.textContent=`${A.icon} ${A.label.toUpperCase()}`,_&&n){const T=_.getContentSlot();if(T.innerHTML="",A.renderPetSlot){const R=this.expandedTeams.get(a);A.renderPetSlot(n,t,T,R?.growthViewType,this.tileFilter);}const M=n.currentStrength>=n.maxStrength,S=T.children.length>0||T.textContent.trim().length>0;_.setCentered(M&&!S);}C.currentFeatureId=A.id,C.featureData=A,m.className=`pet-row__header pet-row__header--${A.id}`,this.updateProgressBarForFeature(a,A.id);};m.className=`pet-row__header pet-row__header--${c.id}`;let P=d.findIndex(F=>F.id===c.id);b.addEventListener("click",F=>{F.stopPropagation(),P=(P-1+d.length)%d.length,E(P);}),w.addEventListener("click",F=>{F.stopPropagation(),P=(P+1)%d.length,E(P);}),d.length>1&&m.appendChild(b),m.appendChild(g),d.length>1&&m.appendChild(w);let O;if(_&&n){if(O=_.build(),c.renderPetSlot){const F=_.getContentSlot();c.renderPetSlot(n,t,F,i,this.tileFilter);const A=n.currentStrength>=n.maxStrength,T=F.children.length>0||F.textContent.trim().length>0;_.setCentered(A&&!T);}}else O=x("div",{className:"pet-row__content pet-row__content--empty"}),O.innerHTML=`
                <div class="pet-row__sprite"><div class="pet-row__empty-slot">Empty</div></div>
                <div class="pet-row__info"><span class="pet-row__empty-text">No pet assigned</span></div>
            `;return p.appendChild(m),p.appendChild(O),C.container=p,{container:p,cardState:C}}createGroupedPetRow(t,n,r,o,i,a){const s=r.filter(T=>!T.hasContent||T.hasContent(n,t)),l=s.length>0?s:r;if(this.shouldUseCombinedPanel(l,n,t,i))return this.createCombinedPanelRow(t,n,l,i,a);const d=x("div",{className:"expanded-pet-row expanded-pet-row--grouped"}),c=x("div",{className:"pet-row__header"}),p=x("button",{textContent:"<",className:"pet-row__nav"}),m=x("div",{textContent:`${o.icon} ${o.label.toUpperCase()}`,className:"pet-label"}),b=x("button",{textContent:">",className:"pet-row__nav"}),g=x("div",{className:`base-pet-card base-pet-card--grouped${n.length===2?"-2":""}`}),w=x("div",{className:"base-pet-card__left"}),_=x("div",{className:`grouped-sprite-container${n.length===2?" grouped-sprite-container--duo":""}`});for(const T of n)try{const M=T.mutations||[];if(ye.has("pet",T.petSpecies)){const S=ye.toCanvas("pet",T.petSpecies,{mutations:M,scale:1,boundsMode:"padded"});S.style.imageRendering="pixelated",_.appendChild(S);}}catch{}w.appendChild(_);const C=x("div",{className:`grouped-badges${n.length===2?" grouped-badges--duo":""}`});for(const T of n){const S=T.currentStrength>=T.maxStrength?`MAX ${T.maxStrength}`:`STR ${T.currentStrength}/${T.maxStrength}`,R=x("span",{className:"badge badge--neutral badge--soft badge--sm badge--pill",textContent:S});C.appendChild(R);}w.appendChild(C),g.appendChild(w);const E=x("div",{className:"base-pet-card__content"});g.appendChild(E);const P={root:g,getContentSlot:()=>E,setCentered:T=>{g.classList.toggle("base-pet-card--centered",T);},destroy:()=>{g.remove();},update:()=>{C.innerHTML="";for(const T of n){const S=T.currentStrength>=T.maxStrength?`MAX ${T.maxStrength}`:`STR ${T.currentStrength}/${T.maxStrength}`,R=x("span",{className:"badge badge--neutral badge--soft badge--sm badge--pill",textContent:S});C.appendChild(R);}}},O={slotIndex:-1,currentFeatureId:o.id,shell:P,featureData:o},F=T=>{const M=l[T];if(M.id==="xp"&&!n.every(z=>z.currentStrength>=z.maxStrength)){this.collapseAndReexpandForXP(a);return}if(m.textContent=`${M.icon} ${M.label.toUpperCase()}`,E.innerHTML="",M.renderGroupedSlot){const R=this.expandedTeams.get(a);M.renderGroupedSlot(n,t,E,R?.growthViewType,this.tileFilter);}else if(M.renderPetSlot){const R=this.expandedTeams.get(a);M.renderPetSlot(n[0],t,E,R?.growthViewType,this.tileFilter);}const S=E.children.length>0||E.textContent.trim().length>0;P.setCentered(!S),O.currentFeatureId=M.id,O.featureData=M,c.className=`pet-row__header pet-row__header--${M.id}`;};c.className=`pet-row__header pet-row__header--${o.id}`;let A=l.findIndex(T=>T.id===o.id);return p.addEventListener("click",T=>{T.stopPropagation(),A=(A-1+l.length)%l.length,F(A);}),b.addEventListener("click",T=>{T.stopPropagation(),A=(A+1)%l.length,F(A);}),l.length>1&&c.appendChild(p),c.appendChild(m),l.length>1&&c.appendChild(b),o.renderGroupedSlot?o.renderGroupedSlot(n,t,E,i,this.tileFilter):o.renderPetSlot&&o.renderPetSlot(n[0],t,E,i,this.tileFilter),d.appendChild(c),d.appendChild(g),g.classList.add("base-pet-card--grouped"),{container:d,cardState:{...O,container:d}}}collapseAndReexpandForXP(t){const n=this.expandedTeams.get(t);if(!n){this.collapse(t),setTimeout(()=>this.expand(t,true,"xp"),100);return}n.container.style.transition="opacity 0.15s ease-out",n.container.style.opacity="0.4",requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.rebuildInPlace(t,true,"xp"),n.container.style.opacity="1";});});}collapseAndReexpandForGrowth(t){const n=this.expandedTeams.get(t);if(!n){this.collapse(t),setTimeout(()=>this.expand(t,false,"growth"),100);return}n.container.style.transition="opacity 0.15s ease-out",n.container.style.opacity="0.4",requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.rebuildInPlace(t,false,"growth"),n.container.style.opacity="1";});});}rebuildInPlace(t,n,r){const o=this.expandedTeams.get(t);if(!o)return;const i=ze.getTeam(t);if(!i)return;const a=ze.getPetsForTeam(i),s=Ge.myPets.get(),l=this.getAvailableFeaturesForTeam(i,a),d=o.growthViewType;for(const w of o.cards)w.shell&&w.shell.destroy(),w.container&&w.container.parentNode&&w.container.remove();const c=o.container.querySelector(".team-progress-bar");c&&c.remove();const p=[];let m=n?{shouldGroup:false,matchingPets:[],remainingPets:a}:this.analyzeTeamForGrouping(i,a,d);const b=l.some(w=>w.id==="growth"||w.id==="hatch"||w.id==="coin");if(m.shouldGroup&&!b&&(m.matchingPets.every(_=>_.currentStrength>=_.maxStrength)||(m={shouldGroup:false,matchingPets:[],remainingPets:a})),m.shouldGroup&&m.matchingPets.length>=2){const w=l.filter(E=>!E.hasContent||E.hasContent(m.matchingPets,i)),_=w.find(E=>E.id==="growth"||E.id==="hatch"||E.id==="coin")||w[0]||l[0],C=this.createGroupedPetRow(i,m.matchingPets,l,_,d,t);o.container.appendChild(C.container),p.push(C.cardState);for(const E of m.remainingPets){const P=i.petIds.indexOf(E.id),O=this.createIndividualPetRow(i,E,P,l,d,t);o.container.appendChild(O.container),p.push(O.cardState);}}else for(let w=0;w<3;w++){const _=i.petIds[w],C=_?s.all.find(P=>P.id===_)??null:null,E=this.createIndividualPetRow(i,C,w,l,d,t,r);o.container.appendChild(E.container),p.push(E.cardState);}o.cards=p;const g=r==="xp"?"xp":r==="growth"?"growth":void 0;this.addProgressBar(o.container,a,t,g);}getAvailableFeaturesForTeam(t,n){return Ml(t),Gb.filter(r=>r.isAvailable())}countTotalRows(t,n,r,o){let i=0;for(const a of t)a.countRows?i+=a.countRows(n,r,o):a.hasContent?.(n,r)&&(i+=1);return i}shouldUseCombinedPanel(t,n,r,o){return t.length<2?false:this.countTotalRows(t,n,r,o)<=Y5}createCombinedPanelRow(t,n,r,o,i){const a=x("div",{className:"expanded-pet-row expanded-pet-row--combined"}),s=x("div",{className:"pet-row__header pet-row__header--combined"}),l=x("span",{className:"combined-panel__icons",textContent:r.map(C=>C.icon).join(" ")});s.appendChild(l);const d=x("div",{textContent:"COMBINED",className:"pet-label"});s.appendChild(d);const c=x("div",{className:`base-pet-card base-pet-card--grouped${n.length===2?"-2":""}`}),p=x("div",{className:"base-pet-card__left"}),m=x("div",{className:`grouped-sprite-container${n.length===2?" grouped-sprite-container--duo":""}`});for(const C of n)try{const E=C.mutations||[];if(ye.has("pet",C.petSpecies)){const P=ye.toCanvas("pet",C.petSpecies,{mutations:E,scale:1,boundsMode:"padded"});P.style.imageRendering="pixelated",m.appendChild(P);}}catch{}p.appendChild(m);const b=x("div",{className:`grouped-badges${n.length===2?" grouped-badges--duo":""}`});for(const C of n){const P=C.currentStrength>=C.maxStrength?`MAX ${C.maxStrength}`:`STR ${C.currentStrength}/${C.maxStrength}`,O=x("span",{className:"badge badge--neutral badge--soft badge--sm badge--pill",textContent:P});b.appendChild(O);}p.appendChild(b),c.appendChild(p);const g=x("div",{className:"base-pet-card__content base-pet-card__content--combined"});for(const C of r){const E=x("div",{className:`combined-section combined-section--${C.id}`}),P=x("span",{className:"combined-section__icon",textContent:C.icon});E.appendChild(P);const O=x("div",{className:"combined-section__content"});C.renderGroupedSlot?C.renderGroupedSlot(n,t,O,o,this.tileFilter):C.renderPetSlot&&C.renderPetSlot(n[0],t,O,o,this.tileFilter),(O.children.length>0||O.textContent?.trim())&&(E.appendChild(O),g.appendChild(E));}c.appendChild(g);const _={slotIndex:-1,currentFeatureId:"combined",shell:{root:c,getContentSlot:()=>g,setCentered:C=>{c.classList.toggle("base-pet-card--centered",C);},destroy:()=>{c.remove();},update:()=>{b.innerHTML="";for(const C of n){const P=C.currentStrength>=C.maxStrength?`MAX ${C.maxStrength}`:`STR ${C.currentStrength}/${C.maxStrength}`,O=x("span",{className:"badge badge--neutral badge--soft badge--sm badge--pill",textContent:P});b.appendChild(O);}},build:()=>c},container:a,featureData:r[0]};return a.appendChild(s),a.appendChild(c),{container:a,cardState:_}}analyzeTeamForGrouping(t,n,r){const o=d=>(d.abilities||[]).some(p=>Pe.MAX_STR_BOOST.includes(p)||Pe.PET_MUTATION.includes(p)||Pe.DOUBLE_HATCH.includes(p)||Pe.PET_REFUND.includes(p)),i=n.filter(o);if(i.length>=2&&i.length<=3){const d=n.filter(c=>!i.includes(c));return {shouldGroup:true,matchingPets:i,remainingPets:d}}const a=["DoubleHarvest","ProduceRefund","ProduceRefundII"],s=d=>(d.abilities||[]).some(p=>a.includes(p)),l=n.filter(s);if(l.length>=2&&l.length<=3&&!l.some(c=>(c.abilities||[]).some(m=>Pe.EGG_GROWTH.includes(m)||Pe.PLANT_GROWTH.includes(m)||Pe.CROP_MUTATION.includes(m)))){const c=n.filter(p=>!l.includes(p));return {shouldGroup:true,matchingPets:l,remainingPets:c}}return K5(n,r)}startUpdates(){if(this.featureUpdateInterval!==null)return;const n=Wt.detect().platform==="mobile"?8e3:5e3;this.featureUpdateInterval=setInterval(()=>{this.updateAllFeatures();},n);}stopUpdates(){this.featureUpdateInterval!==null&&(clearInterval(this.featureUpdateInterval),this.featureUpdateInterval=null);}updateAllFeatures(){for(const[t,n]of this.expandedTeams)this.updateSpecificTeam(t,n);}}const Z5={calculationScope:"all",selectedTileIndices:[],expandedTeamIds:[]};let $t=null,Ju=null;async function eD(){return $t||(Ju||(Ju=Kr("tab-trackers",{version:3,defaults:Z5})),$t=await Ju,$t)}function yi(){if(!$t)throw new Error("[TrackersState] State not initialized. Call initTrackersState() first.");return $t}function tD(e){if(!$t)return;const t=$t.get();t.expandedTeamIds.includes(e)?$t.update({expandedTeamIds:t.expandedTeamIds.filter(r=>r!==e)}):$t.update({expandedTeamIds:[...t.expandedTeamIds,e]});}function nD(e){$t&&$t.update({calculationScope:e});}function Qu(e){if(!$t)return;const t=$t.get();t.selectedTileIndices.includes(e)?$t.update({selectedTileIndices:t.selectedTileIndices.filter(r=>r!==e)}):$t.update({selectedTileIndices:[...t.selectedTileIndices,e]});}function rD(){$t&&$t.update({selectedTileIndices:[]});}class oD{constructor(t={}){de(this,"dropdown",null);de(this,"options");de(this,"isDragging",false);de(this,"dragSelectMode",null);this.options=t,document.addEventListener("pointerup",()=>{this.isDragging=false,this.dragSelectMode=null;});}build(){if(this.dropdown)return this.dropdown;this.dropdown=x("div",{className:"tile-grid-selector"});const t=this.buildHeader();this.dropdown.appendChild(t);const n=this.buildGrids();return this.dropdown.appendChild(n),this.dropdown}show(){this.dropdown||this.build(),this.dropdown&&!this.dropdown.parentElement&&(this.options.container||document.body).appendChild(this.dropdown),this.dropdown&&this.dropdown.classList.add("tile-grid-selector--visible"),this.renderGrids();}hide(){this.dropdown&&this.dropdown.classList.remove("tile-grid-selector--visible");}destroy(){this.dropdown?.parentElement&&this.dropdown.parentElement.removeChild(this.dropdown),this.dropdown=null;}buildHeader(){const t=x("div",{className:"tile-grid-selector__header"}),r=yi().get().selectedTileIndices.length,o=x("div",{className:"tile-grid-selector__info",textContent:`${r} tile${r!==1?"s":""} selected`}),i=x("button",{className:"tile-grid-selector__btn",textContent:"Clear All"});i.addEventListener("click",()=>{rD(),this.renderGrids(),this.options.onChange&&this.options.onChange();});const a=x("button",{className:"tile-grid-selector__close-btn",textContent:"×",title:"Close"});return a.addEventListener("click",()=>{this.hide();}),t.appendChild(o),t.appendChild(i),t.appendChild(a),t}buildGrids(){const t=x("div",{className:"tile-grid-selector__grids"}),n=x("div",{className:"tile-grid-selector__grid",id:"tile-grid-1"}),r=x("div",{className:"tile-grid-selector__grid",id:"tile-grid-2"});return t.appendChild(n),t.appendChild(r),t}renderGrids(){const t=this.dropdown?.querySelector("#tile-grid-1"),n=this.dropdown?.querySelector("#tile-grid-2");if(!t||!n)return;t.innerHTML="",n.innerHTML="";const r=Ge.myGarden.get(),o=Ge.gameMap.get(),i=yi().get();if(!r.garden||!o)return;const a=r.mySlotIndex;if(a===null)return;const s=o.userSlots[a];if(!s)return;const l=s.dirtTiles,d=new Set(i.selectedTileIndices),c=r.garden.tileObjects,p=[...new Set(l.map(A=>A.position.x))].sort((A,T)=>A-T);let m=0,b=p[Math.floor(p.length/2)];for(let A=1;A<p.length;A++){const T=p[A]-p[A-1];T>m&&(m=T,b=(p[A]+p[A-1])/2);}const g=l.filter(A=>A.position.x<b),w=l.filter(A=>A.position.x>=b),_=A=>{if(A.length===0)return {minX:0,maxX:9,minY:0,maxY:9};const T=A.map(S=>S.position.x),M=A.map(S=>S.position.y);return {minX:Math.min(...T),maxX:Math.max(...T),minY:Math.min(...M),maxY:Math.max(...M)}},C=_(g),E=_(w),P=new Map,O=new Map;for(const A of g){const T=A.position.x-C.minX,M=A.position.y-C.minY;P.set(`${M},${T}`,A);}for(const A of w){const T=A.position.x-E.minX,M=A.position.y-E.minY;O.set(`${M},${T}`,A);}for(let A=0;A<10;A++)for(let T=0;T<10;T++){const M=P.get(`${A},${T}`)||null,S=this.buildTileElement(M,M&&c[M.localIndex.toString()]||null,M?d.has(M.localIndex.toString()):false);t.appendChild(S);}for(let A=0;A<10;A++)for(let T=0;T<10;T++){const M=O.get(`${A},${T}`)||null,S=this.buildTileElement(M,M&&c[M.localIndex.toString()]||null,M?d.has(M.localIndex.toString()):false);n.appendChild(S);}const F=this.dropdown?.querySelector(".tile-grid-selector__info");F&&(F.textContent=`${d.size} tile${d.size!==1?"s":""} selected`);}buildTileElement(t,n,r){const o=x("button",{className:"tile-grid-selector__tile"});if(!t)return o.classList.add("tile-grid-selector__tile--null"),o.disabled=true,o;if(r&&o.classList.add("tile-grid-selector__tile--selected"),n?o.classList.add("tile-grid-selector__tile--occupied"):o.classList.add("tile-grid-selector__tile--empty"),n&&ye.isReady()){const i=this.getSpriteForTileObject(n);i&&o.appendChild(i);}return o.addEventListener("pointerdown",i=>{i.preventDefault(),this.isDragging=true,this.dragSelectMode=r?"deselect":"select",Qu(t.localIndex.toString()),this.renderGrids(),this.options.onChange?.();}),o.addEventListener("pointerenter",()=>{if(!this.isDragging||!this.dragSelectMode)return;const a=yi().get().selectedTileIndices.includes(t.localIndex.toString());this.dragSelectMode==="select"&&!a?(Qu(t.localIndex.toString()),this.renderGrids(),this.options.onChange?.()):this.dragSelectMode==="deselect"&&a&&(Qu(t.localIndex.toString()),this.renderGrids(),this.options.onChange?.());}),o}getSpriteForTileObject(t){try{if(t.objectType==="plant"){let n=t.species;if(n==="DawnCelestial"&&(n="DawnCelestialCrop"),n==="MoonCelestial"&&(n="MoonCelestialCrop"),ye.has("plant",n)){const r=ye.toCanvas("plant",n,{scale:.25});return r.style.height="100%",r.style.width="100%",r.style.objectFit="contain",r.style.imageRendering="pixelated",r}}else if(t.objectType==="egg"){const n=t.eggId;if(ye.has("pet",n)){const r=ye.toCanvas("pet",n,{scale:.25});return r.style.height="100%",r.style.width="100%",r.style.objectFit="contain",r.style.imageRendering="pixelated",r}}else if(t.objectType==="decor"){const n=t.decorId;if(ye.has("decor",n)){const r=ye.toCanvas("decor",n,{scale:.25});return r.style.height="100%",r.style.width="100%",r.style.objectFit="contain",r.style.imageRendering="pixelated",r}}}catch(n){console.warn("[TileGridSelector] Failed to load sprite:",n);}return null}}class iD{constructor(t){de(this,"card",null);de(this,"scopeControl",null);de(this,"scopeContainer",null);de(this,"content",null);de(this,"listContainer",null);de(this,"options");de(this,"tileGridOverlay",null);de(this,"expansionHandler");this.options=t,this.expansionHandler=new Q5({getListContainer:()=>this.listContainer});}build(){return this.card?this.card:this.createCard()}destroy(){this.expansionHandler.destroy(),this.scopeControl&&(this.scopeControl.destroy(),this.scopeControl=null),this.tileGridOverlay&&(this.tileGridOverlay.destroy?.(),this.tileGridOverlay=null),this.card=null,this.scopeContainer=null,this.content=null,this.listContainer=null;}render(){if(!this.card)return;if(!ze.isEnabled()){this.renderDisabledState();return}this.scopeContainer&&(this.scopeContainer.style.display="flex"),this.ensureScopeControl(),this.renderTeamList();}getListContainer(){return this.listContainer}createCard(){const t=x("div",{className:"tracker-card-wrapper"});this.scopeContainer=x("div",{className:"tracker-card__scope-container"}),t.appendChild(this.scopeContainer),this.content=x("div",{className:"tracker-card__content"}),t.appendChild(this.content);const n=ft({title:"Trackers",expandable:true,defaultExpanded:true},t);return this.card=n,n}ensureScopeControl(){if(!this.scopeContainer)return;const t=yi().get();if(!this.scopeControl){this.scopeControl=jo({segments:[{id:"all",label:"All Tiles"},{id:"selected",label:"Selected Tiles"}],selected:t.calculationScope,onChange:n=>{const r=n;nD(r),r==="selected"?this.showTileGridOverlay():this.tileGridOverlay?.hide(),this.renderTeamList();}}),this.scopeContainer.appendChild(this.scopeControl);return}this.scopeControl.getSelected()!==t.calculationScope&&this.scopeControl.select(t.calculationScope);}showTileGridOverlay(){this.tileGridOverlay||(this.tileGridOverlay=new oD({onChange:()=>{this.renderTeamList();},container:this.scopeContainer||void 0}),this.tileGridOverlay.build()),this.tileGridOverlay.show();}renderDisabledState(){if(!this.content)return;this.expansionHandler.cleanupAll(),this.listContainer=null,this.scopeContainer&&(this.scopeContainer.style.display="none");const t=x("div",{className:"tracker-card__disabled-state"}),n=x("div",{textContent:"Pet Teams feature is not enabled",className:"tracker-card__disabled-message"});t.appendChild(n),this.content.replaceChildren(t);}renderTeamList(){if(!this.content)return;this.expansionHandler.cleanupAll(),this.content.replaceChildren();const t=ze.getAllTeams(),n=ze.getActiveTeamId(),r=yi().get(),o=r.calculationScope==="selected"?new Set(r.selectedTileIndices):void 0;if(this.expansionHandler.setTileFilter(o),t.length===0){this.renderEmptyState();return}this.listContainer=x("div",{className:"tracker-card__list-container"}),t.forEach(i=>{const a=n===i.id,s=r.expandedTeamIds.includes(i.id),l=tC({team:i,isActive:a,hideDragHandle:true,isNameEditable:false,isExpanded:s,onExpandClick:()=>{this.handleExpandToggle(i.id);}});l.setAttribute("data-team-id",i.id),l.addEventListener("click",d=>{d.stopPropagation();}),this.listContainer.appendChild(l),s&&this.expansionHandler.expand(i.id);}),this.content.appendChild(this.listContainer);}renderEmptyState(){if(!this.content)return;const t=x("div",{className:"tracker-card__empty-state"}),n=x("div",{textContent:"No teams created yet.",className:"tracker-card__empty-message"}),r=x("div",{textContent:"Create teams in the Pets tab to view trackers.",className:"tracker-card__empty-hint"});t.appendChild(n),t.appendChild(r),this.content.appendChild(t);}handleExpandToggle(t){tD(t),this.expansionHandler.toggle(t);const n=this.listContainer?.querySelector(`[data-team-id="${t}"]`);if(n){const r=yi().get().expandedTeamIds.includes(t),o=n.querySelector(".team-list-item__expand");o&&o.classList.toggle("team-list-item__expand--open",r);}}}const aD=`
/* ─────────────────────────────────────────────────────────────────────────── */
/* Card Wrapper                                                                 */
/* ─────────────────────────────────────────────────────────────────────────── */

.tracker-card-wrapper {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
  max-width: 100%;
  overflow-x: auto;
  box-sizing: border-box;
}

/* ─────────────────────────────────────────────────────────────────────────── */
/* Scope Container (All Tiles / Selected Tiles toggle)                         */
/* ─────────────────────────────────────────────────────────────────────────── */

.tracker-card__scope-container {
  position: relative; /* For tile grid overlay positioning */
  display: flex;
  justify-content: center;
  align-items: center;
  padding: var(--spacing-sm) 0;
}

/* Legacy mode-container class (deprecated, use scope-container) */
.tracker-card__mode-container {
  display: flex;
  justify-content: center;
  align-items: center;
  padding: var(--spacing-sm) 0;
}

/* ─────────────────────────────────────────────────────────────────────────── */
/* Content Container                                                            */
/* ─────────────────────────────────────────────────────────────────────────── */

.tracker-card__content {
  display: flex;
  flex-direction: column;
  max-width: 100%;
  overflow-x: visible;
}

/* ─────────────────────────────────────────────────────────────────────────── */
/* List Container                                                               */
/* ─────────────────────────────────────────────────────────────────────────── */

.tracker-card__list-container {
  display: flex;
  flex-direction: column;
  gap: 0;
  max-width: 100%;
  overflow-x: visible;
}

/* ─────────────────────────────────────────────────────────────────────────── */
/* Empty State                                                                  */
/* ─────────────────────────────────────────────────────────────────────────── */

.tracker-card__empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: var(--spacing-xl) var(--spacing-md);
  text-align: center;
  gap: var(--spacing-xs);
}

.tracker-card__empty-message {
  color: var(--fg);
  font-size: var(--font-size-md);
  font-weight: 500;
}

.tracker-card__empty-hint {
  color: var(--muted);
  font-size: var(--font-size-sm);
}

/* ─────────────────────────────────────────────────────────────────────────── */
/* Disabled State                                                               */
/* ─────────────────────────────────────────────────────────────────────────── */

.tracker-card__disabled-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: var(--spacing-xl) var(--spacing-md);
  text-align: center;
}

.tracker-card__disabled-message {
  color: var(--muted);
  font-size: var(--font-size-md);
}

/* ─────────────────────────────────────────────────────────────────────────── */
/* Override TeamListItem for Trackers context                                   */
/* ─────────────────────────────────────────────────────────────────────────── */

.tracker-card__list-container .team-list-item {
  /* Read-only: no hover cursor for team switching */
  cursor: default;
}

.tracker-card__list-container .team-list-item__expand {
  /* Ensure expand button is clickable */
  cursor: pointer;
}

/* ─────────────────────────────────────────────────────────────────────────── */
/* Expansion Container (injected by TeamCardExpansionHandler)                   */
/* ─────────────────────────────────────────────────────────────────────────── */

.tracker-card__list-container .team-expanded-container {
  margin-left: 0;
  margin-right: 0;
  border-radius: 0;
  max-width: 100%;
  overflow-x: hidden;
  box-sizing: border-box;
  /* Use existing Pets section styles via teamCard.css */
}
`,sD=`
/* ─────────────────────────────────────────────────────────────────────────── */
/* Dropdown Container                                                           */
/* ─────────────────────────────────────────────────────────────────────────── */

.tile-grid-selector {
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  margin-top: var(--spacing-xs);
  background: var(--bg);
  border: 2px solid var(--border);
  border-radius: var(--radius-md);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  z-index: 1000;
  display: none;
  flex-direction: column;
  width: min(95%, 600px); /* Scale with container, max 600px */
  max-height: 80vh; /* Prevent vertical overflow */
  overflow: hidden;
}

.tile-grid-selector--visible {
  display: flex;
}

/* ─────────────────────────────────────────────────────────────────────────── */
/* Header                                                                       */
/* ─────────────────────────────────────────────────────────────────────────── */

.tile-grid-selector__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--spacing-sm) var(--spacing-md);
  border-bottom: 1px solid var(--border);
  background: var(--bg-secondary);
}

.tile-grid-selector__info {
  font-size: var(--font-size-sm);
  font-weight: 500;
  color: var(--fg);
}

.tile-grid-selector__btn {
  padding: 4px 8px;
  font-size: var(--font-size-xs);
  font-weight: 600;
  background: var(--bg-tertiary);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  color: var(--fg);
  cursor: pointer;
  transition: all 0.15s ease;
}

.tile-grid-selector__btn:hover {
  background: var(--hover);
}

.tile-grid-selector__btn:active {
  transform: scale(0.95);
}

/* Close button (X) */
.tile-grid-selector__close-btn {
  width: 24px;
  height: 24px;
  padding: 0;
  font-size: 18px;
  font-weight: 600;
  line-height: 1;
  background: var(--bg-tertiary);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  color: var(--muted);
  cursor: pointer;
  transition: all 0.15s ease;
  margin-left: auto;
}

.tile-grid-selector__close-btn:hover {
  background: var(--danger);
  border-color: var(--danger);
  color: white;
}

/* ─────────────────────────────────────────────────────────────────────────── */
/* Grid Container                                                               */
/* ─────────────────────────────────────────────────────────────────────────── */

.tile-grid-selector__grids {
  display: flex;
  justify-content: center;
  gap: 1%;
  padding: 2%; /* Base padding */
  width: 100%;
  box-sizing: border-box;
  overflow-y: auto;
  overflow-x: hidden;
}

.tile-grid-selector__grid {
  display: grid;
  grid-template-columns: repeat(10, 1fr); /* Equal columns that fill width */
  grid-template-rows: repeat(10, auto);
  gap: 2px; /* Small fixed gap for consistency */
  padding: 4px;
  width: 48%; /* Desktop: side by side */
  background: rgba(0, 0, 0, 0.2);
  border-radius: 8px;
  height: fit-content;
}

/* Mobile: stack vertically and maximize grid size */
@media (max-width: 600px) {
  .tile-grid-selector__grids {
    flex-direction: column;
    align-items: center;
    gap: 8px;
    padding: 8px;
  }

  .tile-grid-selector__grid {
    width: 100% !important; /* Full width on mobile stack */
    max-width: 450px !important; /* Prevent excessive width */
    gap: 1px !important;
    padding: 2px !important;
  }
}

/* ─────────────────────────────────────────────────────────────────────────── */
/* Tile Elements                                                                */
/* ─────────────────────────────────────────────────────────────────────────── */

.tile-grid-selector__tile {
  /* Fill grid cell */
  width: 100%;
  aspect-ratio: 1 / 1; /* Maintain square shape */
  border: 1px solid var(--border);
  border-radius: 2px;
  background: var(--bg);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  touch-action: none;
  user-select: none;
  padding: 1px; /* Minimal padding */
  transition: all 0.1s ease;
  position: relative;
  overflow: hidden;
}

.tile-grid-selector__tile:hover:not(:disabled) {
  border-color: var(--accent);
  transform: scale(1.1);
  z-index: 10;
}

.tile-grid-selector__tile:active:not(:disabled) {
  transform: scale(0.95);
}

/* Null tiles (no tile exists at this position) */
.tile-grid-selector__tile--null {
  background: transparent;
  border-color: transparent;
  cursor: not-allowed;
}

/* Empty tiles (tile exists but nothing on it) */
.tile-grid-selector__tile--empty {
  background: var(--bg-secondary);
  border-color: var(--border);
}

/* Occupied tiles (has plant/egg/decor) */
.tile-grid-selector__tile--occupied {
  background: var(--bg);
  border-color: #6b7280;
}

/* Selected state */
.tile-grid-selector__tile--selected {
  border-color: var(--accent);
  border-width: 2px;
  box-shadow: 0 0 0 1px var(--accent);
}

.tile-grid-selector__tile--selected::after {
  content: '';
  position: absolute;
  top: 2px;
  right: 2px;
  width: 6px;
  height: 6px;
  background: var(--accent);
  border-radius: 50%;
  box-shadow: 0 0 3px rgba(0, 0, 0, 0.5);
  z-index: 100;
}

/* Sprite rendering */
.tile-grid-selector__tile canvas {
  pointer-events: none;
  user-select: none;
}
`,lD=`
.team-card-wrapper {
    display: flex;
    flex-direction: column;
    gap: 12px;
    max-width: 100%;
    overflow-x: hidden;
    box-sizing: border-box;
}

.team-card__mode-container {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
}

.team-card__content {
    display: flex;
    flex-direction: column;
    gap: 12px;
    width: 100%;
}

.team-card__disabled-state {
    text-align: center;
}

.team-card__disabled-message {
    color: var(--muted);
    font-size: 14px;
    margin-bottom: 12px;
}

.team-card__empty-state {
    color: var(--muted);
    text-align: center;
    font-size: 14px;
}

.team-card__list-container {
    display: flex;
    flex-direction: column;
    position: relative;
    width: 100%;
}

.team-card__list-container.is-reordering {
    /* Active reordering state */
}

.team-card__actions {
    display: flex;
    gap: 12px;
    justify-content: center;
    width: 100%;
}

/* ═══════════════════════════════════════════════════════════════════════════
   EXPAND BUTTON
   ═══════════════════════════════════════════════════════════════════════════ */

.team-list-item__expand {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 6px;
    margin-left: 8px;
    background: transparent;
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--muted);
    cursor: pointer;
    transition: all 0.2s ease;
    flex-shrink: 0;
}

.team-list-item__expand:hover {
    background: var(--soft);
    color: var(--fg);
    border-color: var(--accent);
}

.team-list-item__expand svg {
    transition: transform 0.2s ease;
}

.team-list-item__expand--open svg {
    transform: rotate(180deg);
}

/* ═══════════════════════════════════════════════════════════════════════════
   EXPANDED CONTAINER - 1 per team with 3 pet rows
   ═══════════════════════════════════════════════════════════════════════════ */

.team-expanded-container {
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    gap: 8px;
    padding: 12px;
    margin: 0 8px 8px 8px;
    background: linear-gradient(145deg, var(--soft), var(--bg));
    border: 1px solid var(--border);
    border-radius: 12px;
    animation: expandSlideIn 0.25s ease-out;
    max-width: calc(100% - 16px); /* Account for margins */
    overflow-x: hidden;
    box-sizing: border-box;
}

@keyframes expandSlideIn {
    from {
        opacity: 0;
        transform: translateY(-8px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* ═══════════════════════════════════════════════════════════════════════════
   PET ROW - Individual row with header + content
   ═══════════════════════════════════════════════════════════════════════════ */

.expanded-pet-row {
    display: flex;
    flex-direction: column;
    padding: 0 12px 14px 12px;
    max-width: 100%;
    overflow-x: hidden;
    box-sizing: border-box;
}

.expanded-pet-row:first-of-type {
    padding-top: 8px;
}

.pet-row__header {
    display: flex;
    align-items: center;
    background: var(--tab-bg);
    padding: 6px 12px;
    gap: 8px;
    border: 1px solid var(--border);
    border-top-left-radius: 12px;
    border-top-right-radius: 12px;
    border-bottom: none;
    margin-bottom: 0;
}

.expanded-pet-row .base-pet-card {
    border-top-left-radius: 0;
    border-top-right-radius: 0;
}

.pet-row__nav {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--fg);
    font-size: 14px;
    font-weight: 800;
    cursor: pointer;
    transition: all 0.15s ease;
    flex-shrink: 0;
}

.pet-row__nav:hover {
    background: var(--soft);
    border-color: var(--pill-to);
    transform: scale(1.05);
}

.pet-label {
    flex: 1;
    text-align: center;
    font-size: 11px;
    font-weight: 800;
    color: var(--fg);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    opacity: 0.8;
}

/* ═══════════════════════════════════════════════════════════════════════════
   FEATURE CARD - Individual Pet Feature Display
   ═══════════════════════════════════════════════════════════════════════════ */

.feature-card {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 10px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    min-height: 200px;
}

.feature-card__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 10px;
    background: linear-gradient(90deg, var(--accent), var(--pill-to));
    border-bottom: 1px solid var(--border);
    gap: 4px;
}

.feature-card__label {
    flex: 1;
    text-align: center;
    font-size: 11px;
    font-weight: 700;
    color: var(--fg);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.feature-card__nav {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 4px;
    color: var(--fg);
    font-size: 12px;
    font-weight: 800;
    cursor: pointer;
    transition: all 0.15s ease;
    flex-shrink: 0;
}

.feature-card__nav:hover {
    background: var(--soft);
    border-color: var(--pill-to);
}

.feature-card__content {
    flex: 1;
    padding: 10px;
    background: var(--soft);
    overflow-y: auto;
    max-height: 280px;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
}

.feature-card__content::-webkit-scrollbar {
    width: 4px;
}

.feature-card__content::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 2px;
}

/* ═══════════════════════════════════════════════════════════════════════════
   RESPONSIVE - Mobile Layout
   ═══════════════════════════════════════════════════════════════════════════ */

@media (max-width: 768px) {
    .team-expanded-cards {
        grid-template-columns: 1fr;
        gap: 8px;
        padding: 10px;
        margin: 0 4px 6px 4px;
    }

    .feature-card {
        min-height: 160px;
    }

    .feature-card__content {
        max-height: 220px;
    }
}

@media (max-width: 480px) {
    .team-list-item__expand {
        padding: 4px;
    }

    .feature-card__header {
        padding: 6px 8px;
    }

    .feature-card__label {
        font-size: 10px;
    }

    .feature-card__nav {
        width: 20px;
        height: 20px;
        font-size: 10px;
    }

    .feature-card__content {
        padding: 8px;
        max-height: 180px;
    }
}

/* ═══════════════════════════════════════════════════════════════════════════
   TEAM PROGRESS
   ═══════════════════════════════════════════════════════════════════════════ */

.team-progress-bar {
    position: relative;
    height: 16px;
    background: var(--border);
    border-radius: 8px;
    margin: 10px 12px 6px 12px;
    overflow: hidden;
    border: 1px solid var(--border);
    flex-shrink: 0;
    --xp-fill: var(--accent); /* Default fill color */
}

.team-progress-bar__fill {
    height: 100%;
    border-radius: 7px;
    transition: width 0.3s ease;
}

/* Color coding for team progress bar - using oklab for better mixing */
.team-progress-bar__fill--low {
    background: linear-gradient(90deg, color-mix(in oklab, var(--xp-fill) 40%, transparent), color-mix(in oklab, var(--xp-fill) 60%, transparent));
}
.team-progress-bar__fill--medium {
    background: linear-gradient(90deg, color-mix(in oklab, var(--xp-fill) 60%, transparent), color-mix(in oklab, var(--xp-fill) 85%, transparent));
}
.team-progress-bar__fill--high {
    background: linear-gradient(90deg, color-mix(in oklab, var(--xp-fill) 80%, transparent), var(--xp-fill));
}

.team-progress-bar__percent {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 11px;
    font-weight: 800;
    color: var(--fg);
    text-shadow: 0 1px 2px rgba(0,0,0,0.6);
    pointer-events: none;
    z-index: 5;
}

/* BasePetCard provides its own mobile responsiveness. We only need minimal 
   overrides for the team-level containers if necessary. */

@media (max-width: 480px) {
    .team-expanded-container {
        margin: 4px 4px 8px 4px;
        max-width: calc(100% - 8px);
        padding: 8px;
    }

    .expanded-pet-row {
        padding: 0 8px 10px 8px;
    }

    .team-progress-bar {
        pointer-events: none;
        z-index: 5;
        margin: 8px 8px 4px 8px;
    }

    .feature-card__header {
        padding: 6px 8px;
    }

    .feature-card__nav {
        width: 22px;
        height: 22px;
        font-size: 10px;
    }
}

/* 320px devices */
@media (max-width: 360px) {
    .pet-row__content {
        padding: 8px;
    }
    
    .xp-stat__label {
        font-size: 9px;
    }
}

/* ═══════════════════════════════════════════════════════════════════════════
   COMBINED PANEL MODE
   Merges multiple panels into single view when total rows ≤ 3
   ═══════════════════════════════════════════════════════════════════════════ */

.expanded-pet-row--combined {
    /* Same base styling as grouped */
}

.pet-row__header--combined {
    justify-content: center;
    gap: 12px;
    background: linear-gradient(90deg, var(--soft), var(--tab-bg), var(--soft));
}

.combined-panel__icons {
    font-size: 13px;
    opacity: 0.9;
    letter-spacing: 2px;
}

/* Combined content area */
.base-pet-card__content--combined {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

/* Individual panel sections within combined view */
.combined-section {
    display: flex;
    align-items: flex-start;
    gap: 8px;
    padding: 4px 0;
}

.combined-section + .combined-section {
    border-top: 1px solid var(--border);
    padding-top: 8px;
    margin-top: 2px;
}

.combined-section__icon {
    font-size: 12px;
    opacity: 0.75;
    min-width: 20px;
    text-align: center;
    padding-top: 2px;
}

.combined-section__content {
    flex: 1;
    min-width: 0;
}

/* Ensure stat rows within combined sections flow correctly */
.combined-section__content .stat-row,
.combined-section__content .hatching-stats-compact,
.combined-section__content .xp-stats-compact,
.combined-section__content .value-stats-compact,
.combined-section__content .growth-stats-compact {
    /* Remove any margin that might cause issues */
    margin: 0;
}

/* Combined section specific colors */
.combined-section--xp .combined-section__icon {
    color: var(--xp-fill, #6ba6ff);
}

.combined-section--hatch .combined-section__icon {
    color: #f0a050;
}

.combined-section--growth .combined-section__icon {
    color: #60c060;
}

.combined-section--coin .combined-section__icon {
    color: #ffd700;
}

/* Mobile adjustments for combined panel */
@media (max-width: 480px) {
    .combined-section {
        gap: 6px;
    }
    
    .combined-section__icon {
        font-size: 11px;
        min-width: 16px;
    }
}

`,cD=`
/* ═══════════════════════════════════════════════════════════════════════════
   GROWTH TIMER PANEL STYLES
   ═══════════════════════════════════════════════════════════════════════════ */

/* Growth Panel structural styles moved to growthPanel.css.ts */

.feature-card,
.feature-card__content {
    box-sizing: border-box;
}


/* ═══════════════════════════════════════════════════════════════════════════
   RESPONSIVE
   ═══════════════════════════════════════════════════════════════════════════ */

.growth-timer-panel {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.growth-stats {
    padding: 8px 12px;
    background: linear-gradient(135deg, var(--soft), var(--bg));
    border: 1px solid var(--border);
    border-radius: 8px;
    font-size: 11px;
    font-weight: 600;
    color: var(--muted);
    text-align: center;
}

.growth-timer-list {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.timer-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 10px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    font-size: 11px;
    transition: all 0.2s ease;
}

.timer-item:hover {
    border-color: var(--pill-to);
    box-shadow: 0 2px 8px var(--shadow);
}

.timer-sprite {
    flex-shrink: 0;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.timer-sprite canvas {
    image-rendering: pixelated;
    image-rendering: crisp-edges;
}

.timer-countdown {
    font-weight: 800;
    color: var(--fg);
    font-size: 12px;
    min-width: 65px;
}

.timer-completion {
    flex: 1;
    color: var(--muted);
    font-size: 11px;
}

.timer-boost {
    color: var(--mut-ambercharged);
    font-weight: 700;
    font-size: 10px;
    white-space: nowrap;
}

.empty-state {
    text-align: center;
    padding: 24px;
    color: var(--muted);
    font-style: italic;
    font-size: 12px;
}

/* ═══════════════════════════════════════════════════════════════════════════
   RESPONSIVE
   ═══════════════════════════════════════════════════════════════════════════ */

@media (max-width: 768px) {
    .team-expanded-cards {
        grid-template-columns: 1fr;
    }

    .feature-card__content {
        max-height: 300px;
    }
}

@media (max-width: 480px) {
    .team-expanded-cards {
        padding: 8px;
        gap: 8px;
    }

    .feature-card__header {
        padding: 8px 10px;
    }

    .feature-card__label {
        font-size: 11px;
    }

    .feature-card__nav {
        width: 24px;
        height: 24px;
        font-size: 12px;
    }

    .feature-card__content {
        padding: 10px;
    }
}

/* ═══════════════════════════════════════════════════════════════════════════
   ACCESSIBILITY
   ═══════════════════════════════════════════════════════════════════════════ */

.feature-card:focus-within {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
}

.feature-card__nav:focus {
    outline: 2px solid var(--pill-to);
    outline-offset: 2px;
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
    .team-expanded-cards,
    .feature-card,
    .timer-item {
        animation: none;
        transition: none;
    }
}

/* Mobile responsive - prevent horizontal scrolling */
@media (max-width: 480px) {
    .growth-summary-overhaul {
        flex-wrap: wrap; /* Allow wrapping on narrow screens */
        gap: 8px;
        padding: 8px 10px;
    }

    .team-progress-bar--egg,
    .team-progress-bar--plant {
        min-width: 100%; /* Force full width on mobile */
        order: -1; /* Move progress bar to top */
    }

    .growth-next-item {
        min-width: 100%;
        flex-wrap: wrap;
    }

    .growth-overhaul-controls {
        flex-shrink: 0;
    }

    .bar-percent,
    .bar-info {
        font-size: 10px;
    }

    .growth-next-time,
    .growth-next-date {
        font-size: 10px;
    }
    
    /* Center controls (buttons) on mobile */
    .growth-overhaul-controls {
        justify-content: center;
        width: 100%;
    }
    
    /* Center next item row on mobile */
    .growth-next-item {
        justify-content: center;
        width: 100%;
    }
    
    /* Center overall container elements on mobile */
    .growth-summary-overhaul {
        justify-content: center;
    }
}
`,dD=`
/* ═══════════════════════════════════════════════════════════════════════════
   XP PANEL - Main Container
   ═══════════════════════════════════════════════════════════════════════════ */

.xp-panel {
    background: linear-gradient(145deg, var(--bg), var(--soft));
    border: 1px solid var(--border);
    border-left: 3px solid var(--pill-to);
    border-radius: 16px;
    margin: 12px 0 16px 12px;
    overflow: hidden;
    box-shadow:
        0 8px 32px var(--shadow),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
    animation: xpPanelSlideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    transform-origin: top center;
}

@keyframes xpPanelSlideIn {
    from {
        opacity: 0;
        transform: translateY(-16px) scaleY(0.95);
        max-height: 0;
    }
    to {
        opacity: 1;
        transform: translateY(0) scaleY(1);
        max-height: 2000px;
    }
}

/* ═══════════════════════════════════════════════════════════════════════════
   HEADER - Team XP Rate Display
   ═══════════════════════════════════════════════════════════════════════════ */

.xp-panel__header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 14px 20px;
    /* Task 6: Theme-semantic colors */
    background: linear-gradient(90deg, var(--accent), var(--pill-to));
    border-bottom: 1px solid var(--border);
}

.xp-panel__header-title {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--fg);  /* Task 6: Use --fg for better contrast */
}

.xp-panel__header-icon {
    font-size: 16px;
}

.xp-panel__header-rate {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 14px;
    font-weight: 600;
}

.xp-panel__rate-label {
    color: var(--muted);
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.xp-panel__rate-base {
    color: var(--fg);
}

.xp-panel__rate-plus,
.xp-panel__rate-equals {
    color: var(--muted);
    font-size: 12px;
}

.xp-panel__rate-bonus {
    color: var(--mut-gold);
    font-weight: 700;
}

.xp-panel__rate-total {
    background: linear-gradient(135deg, var(--pill-from), var(--pill-to));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-size: 16px;
    font-weight: 900;
}

/* ═══════════════════════════════════════════════════════════════════════════
   PETS CONTAINER - Horizontal Scrollable Row
   ═══════════════════════════════════════════════════════════════════════════ */

.xp-panel__pets {
    display: flex;
    flex-direction: column;
    gap: 2px;
    padding: 16px;
    background: var(--soft);
}

/* ═══════════════════════════════════════════════════════════════════════════
   PET CARD - Individual Pet Display
   ═══════════════════════════════════════════════════════════════════════════ */

.xp-pet-card {
    display: flex;
    align-items: stretch;
    gap: 16px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 14px;
    transition: all 0.25s cubic-bezier(0.2, 0.8, 0.2, 1);
    position: relative;
}

.xp-pet-card:hover {
    box-shadow: 0 6px 20px var(--shadow);
    transform: translateX(2px);
}

/* Left accent bar (appears on hover with smooth color transition) */
.xp-pet-card::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 3px;
    background: linear-gradient(180deg, var(--pill-from), var(--pill-to));
    border-radius: 12px 0 0 12px;
    opacity: 0;
    transition: opacity 0.3s ease, background 0.3s ease;
}

.xp-pet-card:hover::before {
    opacity: 1;
    background: linear-gradient(180deg, var(--accent), var(--pill-to));
}

/* Max strength pet */
.xp-pet-card--max {
    border-color: var(--complete);
    background: var(--bg);
}

.xp-pet-card--max::before {
    background: linear-gradient(180deg, var(--complete), var(--high));
}

.xp-pet-card--max:hover::before {
    opacity: 0.8;
}

/* Starving pet */
.xp-pet-card--starving {
    border-color: var(--low);
    background: linear-gradient(135deg, var(--soft), var(--bg));
    animation: starvingPulse 2s ease-in-out infinite;
}

.xp-pet-card--starving::before {
    background: var(--low);
}

.xp-pet-card--starving:hover::before {
    opacity: 1;
}

@keyframes starvingPulse {
    0%, 100% { border-color: var(--low); }
    50% { border-color: var(--medium); }
}

/* ═══════════════════════════════════════════════════════════════════════════
   SPRITE SECTION - Left Side
   ═══════════════════════════════════════════════════════════════════════════ */

.xp-pet-card__sprite {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    min-width: 80px;
    flex-shrink: 0;
}

.xp-pet-card__sprite-wrapper {
    width: 64px;
    height: 64px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(145deg, var(--soft), var(--bg));
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
    box-shadow:
        inset 0 2px 4px var(--shadow),
        0 2px 8px var(--shadow);
}

.xp-pet-card__sprite-wrapper canvas {
    image-rendering: pixelated;
    image-rendering: crisp-edges;
}

.xp-pet-card__sprite-fallback {
    font-size: 32px;
    opacity: 0.5;
}

/* Badges under sprite */
.xp-pet-card__badges {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    justify-content: center;
}

.xp-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 9px;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    white-space: nowrap;
}

.xp-badge--max {
    background: linear-gradient(135deg, var(--complete), var(--high));
    color: #fff; /* White for readability on green background */
    text-shadow: 0 1px 1px rgba(0,0,0,0.2);
}

.xp-badge--starving {
    background: var(--low);
    color: #fff; /* White for readability on red background */
    text-shadow: 0 1px 1px rgba(0,0,0,0.2);
}

.xp-badge--boost {
    background: linear-gradient(135deg, var(--mut-gold), var(--mut-ambercharged));
    color: #1a1a1a; /* Dark for readability on gold background */
    text-shadow: 0 1px 0 rgba(255,255,255,0.3);
}

/* Task 9-10: STR display under sprite/badges (tight 2px spacing) */
.xp-pet-card__str-display {
    display: flex;
    align-items: baseline;
    justify-content: center;
    gap: 3px;
    margin-top: 2px; /* Task 9: tight spacing */
    font-size: 11px;
    font-weight: 600;
}

.xp-str__label {
    color: var(--pill-to); /* Updated per user request */
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-size: 10px;
}

.xp-str__current {
    color: var(--fg);
    font-weight: 800;
    font-size: 13px;
    text-shadow: 
        -1px -1px 0 rgba(0, 0, 0, 0.8),
        1px -1px 0 rgba(0, 0, 0, 0.8),
        -1px 1px 0 rgba(0, 0, 0, 0.8),
        1px 1px 0 rgba(0, 0, 0, 0.8);
}

.xp-str__separator {
    color: var(--muted);
    font-size: 11px;
}

.xp-str__max {
    color: var(--muted);
    font-size: 11px;
    text-shadow: 
        -1px -1px 0 rgba(0, 0, 0, 0.8),
        1px -1px 0 rgba(0, 0, 0, 0.8),
        -1px 1px 0 rgba(0, 0, 0, 0.8),
        1px 1px 0 rgba(0, 0, 0, 0.8);
}

/* ═══════════════════════════════════════════════════════════════════════════
   STATS SECTION - Right Side
   ═══════════════════════════════════════════════════════════════════════════ */

.xp-pet-card__stats {
    flex: 1;
    display: flex;
    flex-direction: column;
    min-width: 0;
}

.xp-pet-card__name {
    font-size: 15px;
    font-weight: 800;
    color: var(--fg);
    margin-bottom: 10px;
    padding-bottom: 8px;
    border-bottom: 1px solid var(--border);
    letter-spacing: 0.3px;
}

/* Stats Table */
.xp-stats-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
}

/* Task 3: Remove row dividers for cleaner look */
.xp-stats-table__row {
    /* No border - clean, minimal design */
}

.xp-stats-table__row:last-child {
    /* No special treatment needed */
}

.xp-stats-table__label {
    padding: 6px 12px 6px 0;
    color: var(--pill-to); /* Updated per user request */
    font-weight: 600;
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    white-space: nowrap;
    width: 80px;
}

.xp-stats-table__value {
    padding: 6px 0;
    color: var(--fg);
    font-weight: 600;
}

.xp-stats-table__value--danger {
    color: var(--low);
    font-weight: 800;
}

/* Strength display */
.xp-strength {
    display: inline-flex;
    align-items: baseline;
    gap: 2px;
}

.xp-strength__current {
    font-size: 16px;
    font-weight: 800;
    background: linear-gradient(135deg, var(--pill-from), var(--pill-to));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.xp-strength__separator {
    color: var(--muted);
    font-size: 13px;
}

.xp-strength__max {
    color: var(--muted);
    font-size: 13px;
    font-weight: 600;
}

/* Progress row (time + feeds + progress bar) */
.xp-progress-row {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
}

.xp-progress-row__time {
    font-weight: 700;
    font-size: 13px;
    color: var(--fg);
    min-width: 45px;
}

.xp-progress-row__feeds {
    font-size: 12px;
    color: var(--muted);
    white-space: nowrap;
}

.xp-progress-row__bar-container {
    display: flex;
    align-items: center;
    gap: 6px;
    flex: 1;
    min-width: 120px;
}

.xp-progress-row__bar {
    flex: 1;
    height: 10px;
    background: var(--soft);
    border: 1px solid var(--border);
    border-radius: 5px;
    overflow: hidden;
    position: relative;
}

.xp-progress-row__fill {
    height: 100%;
    border-radius: 4px;
    transition: width 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
    position: relative;
    overflow: hidden;
}

.xp-progress-row__fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg,
        transparent,
        rgba(255,255,255,0.25),
        transparent
    );
    animation: progressShimmer 2.5s infinite;
}

@keyframes progressShimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

.xp-progress-row__fill--low {
    background: linear-gradient(90deg, var(--low), var(--medium));
}

.xp-progress-row__fill--medium {
    background: linear-gradient(90deg, var(--medium), var(--high));
}

.xp-progress-row__fill--high {
    background: linear-gradient(90deg, var(--high), var(--complete));
}

.xp-progress-row__percent {
    font-size: 11px;
    font-weight: 800;
    min-width: 32px;
    text-align: right;
    color: var(--fg);
}

/* XP Boost row */
.xp-stats-table__row--boost {
    background: linear-gradient(90deg, var(--soft), transparent);
}

.xp-boost-stat {
    color: var(--mut-ambercharged);
    font-weight: 700;
}

.xp-inactive {
    color: var(--muted);
    font-style: italic;
    font-size: 11px;
    margin-left: 4px;
}

/* Supporting row */
.xp-stats-table__row--support {
    background: linear-gradient(90deg, var(--soft), transparent);
}

.xp-support {
    color: var(--pill-to);
    font-weight: 600;
}

/* Warning row */
.xp-stats-table__row--warning {
    background: linear-gradient(90deg, rgba(220, 38, 38, 0.15), transparent);
}

/* ═══════════════════════════════════════════════════════════════════════════
   FOOTER - XP Boost Summary
   ═══════════════════════════════════════════════════════════════════════════ */

.xp-panel__footer {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 14px 20px;
    /* Task 5: Theme-semantic colors */
    background: linear-gradient(90deg, var(--accent), var(--pill-to));
    border-top: 1px solid var(--border);
}

.xp-panel__footer--hidden {
    display: none;
}

.xp-panel__footer-icon {
    font-size: 24px;
    color: var(--fg);  /* Task 5: Use --fg */
    animation: boostPulse 1.5s ease-in-out infinite;
}

@keyframes boostPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

.xp-panel__footer-content {
    flex: 1;
}

.xp-panel__footer-title {
    font-size: 13px;
    font-weight: 800;
    color: var(--fg);  /* Task 5: Use --fg */
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.xp-panel__footer-detail {
    font-size: 14px;
    font-weight: 600;
    color: var(--fg);  /* Task 5: Use --fg */
    margin-top: 2px;
}

.xp-panel__footer-names {
    color: var(--pill-to);  /* Task 5: Use --pill-to for subtle contrast */
    font-size: 12px;
    font-weight: 500;
}

/* ═══════════════════════════════════════════════════════════════════════════
   RESPONSIVE
   ═══════════════════════════════════════════════════════════════════════════ */

@media (max-width: 480px) {
    .xp-panel__header {
        flex-direction: column;
        gap: 8px;
        align-items: flex-start;
    }

    .xp-pet-card {
        flex-direction: column;
        align-items: center;
        text-align: center;
    }

    .xp-pet-card__sprite {
        flex-direction: row;
        gap: 12px;
    }

    .xp-pet-card__name {
        text-align: center;
    }

    .xp-stats-table__label {
        width: auto;
    }
}

/* ═══════════════════════════════════════════════════════════════════════════
   ACCESSIBILITY
   ═══════════════════════════════════════════════════════════════════════════ */

.xp-panel:focus-within {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
    .xp-panel,
    .xp-pet-card,
    .xp-progress__fill,
    .xp-panel__footer-icon {
        animation: none;
        transition: none;
    }

    .xp-progress__fill::after {
        animation: none;
    }
}

/* ═══════════════════════════════════════════════════════════════════════════
   PRINT
   ═══════════════════════════════════════════════════════════════════════════ */

@media print {
    .xp-panel {
        box-shadow: none;
        border: 2px solid var(--border);
    }

    .xp-progress__fill::after,
    .xp-panel__footer-icon {
        animation: none;
    }
}
`,uD=`
/* ═══════════════════════════════════════════════════════════════════════════
   GROWTH STATS COMPACT - Summary Bar
   ═══════════════════════════════════════════════════════════════════════════ */

/* Main container - single inline row like XP bar */
.growth-summary-overhaul {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 14px;
    background: var(--soft);
    border-radius: 12px;
    margin-bottom: 10px;
    max-width: 100%;
    overflow-x: hidden;
    box-sizing: border-box;
}

/* Progress bar section */
.team-progress-bar--egg, .team-progress-bar--plant {
    position: relative;
    flex: 1;
    min-width: 80px;
    max-width: 100%; /* Prevent overflow */
    height: 18px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 6px;
    overflow: hidden;
}

.team-progress-bar__fill--plant {
    background: linear-gradient(90deg, var(--accent-1), color-mix(in oklab, var(--accent-1) 70%, white));
    height: 100%;
    border-radius: 5px;
    transition: width 0.3s ease;
}

.team-progress-bar__fill--egg {
    background: linear-gradient(90deg, var(--accent-2), color-mix(in oklab, var(--accent-2) 70%, white));
    height: 100%;
    border-radius: 5px;
    transition: width 0.3s ease;
}

/* Next Item Display - inline */
.growth-next-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 11px;
    white-space: nowrap;
}

.growth-next-sprite {
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.growth-next-sprite canvas {
    image-rendering: pixelated;
}

.growth-next-details {
    display: flex;
    align-items: baseline;
    gap: 4px;
}

.growth-next-time {
    font-weight: 700;
    color: var(--pill-from); /* Updated per user request */
}

.growth-next-date {
    color: var(--fg); /* Per user: "3:04 pm" */
    font-size: 10px;
}

/* Controls - inline */
.growth-overhaul-controls {
    display: flex;
    gap: 8px;
}

.growth-toggle-overhaul, .growth-dropdown-overhaul {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 3px 6px;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.15s ease;
    color: var(--fg);
    display: flex;
    align-items: center;
    justify-content: center;
}

.growth-toggle-overhaul canvas {
    image-rendering: pixelated;
}

.growth-toggle-overhaul:hover, .growth-dropdown-overhaul:hover {
    border-color: var(--accent);
    background: var(--soft);
}

.growth-dropdown-option {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 10px;
    font-size: 11px;
    font-weight: 600;
    cursor: pointer;
    border-radius: 4px;
    color: var(--fg);
}

.growth-dropdown-option:hover {
    background: var(--accent);
    color: var(--pill-to);
}

.growth-stats-compact {
    display: flex;
    flex-direction: column;
    gap: 8px;
    max-width: 100%;
    overflow-x: hidden;
}

/* ═══════════════════════════════════════════════════════════════════════════
   STAT ROW - Individual Stat Display
   ═══════════════════════════════════════════════════════════════════════════ */

.stat-row {
    display: flex;
    align-items: center;
    gap: 4px; /* Tighter spacing on desktop */
    padding: 4px 8px; /* Slightly tighter padding */
    background: transparent;
    border: none;
    border-radius: 6px;
    flex-wrap: nowrap; /* Prevent vertical stacking on desktop */
    max-width: 100%;
    box-sizing: border-box;
}

.stat-row--boost {
    background: transparent;
}

.stat__label {
    font-size: 10px;
    font-weight: 700;
    color: var(--pill-to); /* Updated per user request */
    text-transform: uppercase;
    letter-spacing: 0.5px;
    min-width: 70px;
}

.stat__timer {
    font-size: 12px;
    font-weight: 700;
    color: var(--pill-from); /* Updated per user request */
    min-width: 60px;
}

.stat__feeds {
    font-size: 11px;
    color: var(--fg); /* Per user: date/time text */
    min-width: 50px;
}

.stat__str-label {
    display: flex;
    align-items: center;
    gap: 4px;
}

.stat__progress-mini {
    position: relative; /* Required for absolute positioning of percent */
    flex: 1;
    height: 10px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 5px;
    overflow: visible; /* Changed from hidden to show overlayed percent */
    min-width: 60px;
}

.stat__progress-fill {
    height: 100%;
    transition: width 0.3s ease;
}

.stat__progress-fill--egg {
    background: linear-gradient(90deg, var(--accent-2), color-mix(in oklab, var(--accent-2) 70%, white));
}

.stat__progress-fill--plant {
    background: linear-gradient(90deg, var(--accent-1), color-mix(in oklab, var(--accent-1) 70%, white));
}

.stat__percent {
    position: absolute;
    top: 50%;
    left: 50%; /* Center properly */
    transform: translate(-50%, -50%); /* Center properly */
    font-size: 11px;
    font-weight: 800;
    color: var(--accent); /* Per user: percentage text with outline */
    text-shadow: 
        -1px -1px 0 rgba(0, 0, 0, 0.8),
        1px -1px 0 rgba(0, 0, 0, 0.8),
        -1px 1px 0 rgba(0, 0, 0, 0.8),
        1px 1px 0 rgba(0, 0, 0, 0.8); /* Black outline for visibility */
    pointer-events: none;
    z-index: 2;
}

.stat__value {
    font-size: 11px;
    font-weight: 600;
    color: var(--pill-from); /* Updated per user request */
}

.stat__value--accent {
    color: var(--mut-ambercharged);
    font-weight: 700;
}

/* Sprite wrappers - remove inline styles */
.sprite-wrapper,
.stacked-sprites {
    display: inline-flex;
    align-items: center;
}

/* ═══════════════════════════════════════════════════════════════════════════
   BOOST ROW - Displays "+Xmin/proc" text
   User requirement: Convert min/h to "Xh Ym/h" format with --pill-from color
   ═══════════════════════════════════════════════════════════════════════════ */

.boost-summary {
    font-size: 12px;
    font-weight: 700;
    color: var(--pill-from); /* Per user: boost text with outline */
    text-shadow: 
        -1px -1px 0 rgba(0, 0, 0, 0.8),
        1px -1px 0 rgba(0, 0, 0, 0.8),
        -1px 1px 0 rgba(0, 0, 0, 0.8),
        1px 1px 0 rgba(0, 0, 0, 0.8); /* Black outline for visibility */
}

.team-progress-bar__overlay {
    position: absolute;
    inset: 0;
    z-index: 2;
    display: flex;
    justify-content: space-between; /* Use space-between instead of gap */
    align-items: center;
    padding: 0 15%; /* Percentage padding for responsive centering */
    width: 100%;
    pointer-events: none;
    box-sizing: border-box;
}

.bar-percent {
    color: var(--accent);
}

.bar-info {
    color: var(--pill-from);
}

.bar-percent, 
.bar-info {
    font-size: 13px; /* Match sizes */
    font-weight: 800;
    text-shadow: 
        -1px -1px 0 rgba(0, 0, 0, 0.8),
        1px -1px 0 rgba(0, 0, 0, 0.8),
        -1px 1px 0 rgba(0, 0, 0, 0.8),
        1px 1px 0 rgba(0, 0, 0, 0.8);
}

.stat-row--message {
    justify-content: center;
    background: transparent;
    border: 1px dashed var(--border);
    opacity: 1; /* Keep fully visible for --pill-from color */
    width: 100%;
    box-sizing: border-box;
}

.stat__message {
    font-size: 11px;
    font-weight: 700;
    color: var(--pill-from);
    text-align: center;
}

/* ═══════════════════════════════════════════════════════════════════════════
   DROPDOWN MENU - Gemini Scrollbar Implementation
   ═══════════════════════════════════════════════════════════════════════════ */

.growth-dropdown-menu {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    box-shadow: 0 8px 32px var(--shadow);
    padding: 4px;
    min-width: 180px;
    max-height: 200px;
    overflow-y: auto;
    
    /* Gemini scrollbar (standard pattern) */
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
}

.growth-dropdown-menu::-webkit-scrollbar {
    width: 6px;
}

.growth-dropdown-menu::-webkit-scrollbar-track {
    background: transparent;
}

.growth-dropdown-menu::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 3px;
}

.growth-dropdown-menu::-webkit-scrollbar-thumb:hover {
    background: var(--accent);
}

/* ═══════════════════════════════════════════════════════════════════════════
   RESPONSIVE - Mobile Layout (NO HORIZONTAL SCROLLING)
   ═══════════════════════════════════════════════════════════════════════════ */

@media (max-width: 768px) {
    .growth-stats-compact {
        padding: 8px;
    }

    .stat-row {
        flex-wrap: wrap; /* Stack items vertically */
        gap: 6px;
    }

    .stat__label {
        min-width: 100%;
        text-align: left;
    }

    .stat__timer,
    .stat__feeds,
    .stat__percent {
        font-size: 10px;
    }

    .stat__progress-mini {
        min-width: 100%; /* Full width on mobile */
    }
}

@media (max-width: 480px) {
    .team-progress-bar__overlay {
        padding: 0 10%; /* Smaller percentage padding on mobile */
        white-space: nowrap;
    }

    .bar-percent, 
    .bar-info {
        font-size: 11px; /* Slightly smaller for mobile */
    }

    .stat-row {
        padding: 8px 6px;
        flex-wrap: wrap; /* Allow wrapping so progress bar can drop down */
        gap: 8px;
        align-items: center;
    }

    .stat__label {
        min-width: auto;
        max-width: 70px;
        flex-shrink: 1;
        font-size: 9px;
    }

    .stat__timer,
    .stat__value {
        flex-shrink: 0; /* Keep value next to label/sprite */
    }

    .stat__progress-mini {
        width: 100%; /* Force progress bar to new row */
        height: 12px;
        margin-top: 2px;
    }

    .growth-dropdown-menu {
        max-height: 160px; /* Smaller on mobile */
    }

    /* Touch-friendly controls - minimum 44px height */
    .growth-toggle-overhaul,
    .growth-dropdown-overhaul {
        min-height: 44px;
        min-width: 44px;
        padding: 8px 12px;
    }

    .growth-dropdown-option {
        min-height: 44px; /* Touch target */
        padding: 10px 12px;
    }
}

@media (max-width: 360px) {
    .stat__label,
    .stat__timer,
    .stat__feeds,
    .stat__percent {
        font-size: 9px;
    }

    .stat__label {
        min-width: auto; /* Allow shrinking */
        max-width: 60px; /* Cap width */
        flex-shrink: 1;
    }

    .stat__progress-mini {
        min-width: 50px;
    }

    .growth-stats-compact {
        padding: 6px;
    }

    .growth-summary-overhaul {
        padding: 8px 10px;
        gap: 8px;
    }

    .team-progress-bar__overlay {
        padding: 0 8%;
    }

    .bar-percent,
    .bar-info {
        font-size: 10px;
    }
}

/* ═══════════════════════════════════════════════════════════════════════════
   SPRITE GRID - Egg Sprite Overlays (Hatching Panel)
   ═══════════════════════════════════════════════════════════════════════════ */

.stat__sprite-grid {
    display: flex;
    gap: 12px;  /* Increased from 8px for better spacing */
    align-items: center;
    flex-wrap: wrap;
    margin-left: 8px;  /* Add some left margin to separate from label */
}

.stat__sprite-item {
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 24px;  /* Ensure minimum width for sprite + overlay */
}

.stat__sprite-value {
    position: absolute;
    top: -8px;  /* Increased from -6px for better visibility */
    right: -6px;  /* Increased from -4px for more spacing */
    font-size: 0.7rem;  /* Slightly smaller for compactness */
    font-weight: 700;  /* Increased from 600 for better readability */
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 1px 4px;  /* Slightly more padding */
    color: var(--pill-from);
    text-shadow: none;
    z-index: 10;
    white-space: nowrap;  /* Prevent text wrapping */
}

.stat__values-row {
    display: flex;
    align-items: center;
    gap: 6px;  /* Increased from 4px */
}

.stat__separator {
    color: var(--border);
    font-weight: 400;
    margin: 0 4px;  /* Add horizontal margin */
}

.stat__boost-item {
    display: flex;
    align-items: center;
    gap: 6px;  /* Increased from 4px */
}

/* ═══════════════════════════════════════════════════════════════════════════
   MUTATION COLORS - Rainbow and Gold
   ═══════════════════════════════════════════════════════════════════════════ */

.stat__value.stat__value--gold {
    color: var(--mut-gold) !important;
}

.stat__value.stat__value--rainbow {
    color: var(--mut-rainbow) !important;
}

/* ═══════════════════════════════════════════════════════════════════════════
   ACCESSIBILITY
   ═══════════════════════════════════════════════════════════════════════════ */

@media (prefers-reduced-motion: reduce) {
    .stat__progress-fill {
        transition: none;
    }
}
`;class pD extends Tr{constructor(n){super({id:"tab-trackers",label:"Trackers"});de(this,"deps");de(this,"trackerCardPart",null);de(this,"unsubscribeMyPets");this.deps=n;}async build(n){this.container=n;const{MGSprite:r}=await Pn(async()=>{const{MGSprite:a}=await Promise.resolve().then(()=>Sh);return {MGSprite:a}},void 0);await r.init(),await eD();const o=n.getRootNode();this.injectStyles(o);const i=this.createGrid("12px");i.id="trackers",n.appendChild(i),this.initializeTrackerCard(i),this.unsubscribeMyPets=Ge.myPets.subscribeStable(()=>{this.trackerCardPart?.render();});}async destroy(){this.unsubscribeMyPets&&(this.unsubscribeMyPets(),this.unsubscribeMyPets=void 0),this.trackerCardPart&&(this.trackerCardPart.destroy(),this.trackerCardPart=null);}unmount(){this.destroy().catch(console.error),super.unmount();}injectStyles(n){vt(n,aD,"tracker-card-styles"),vt(n,sD,"tile-grid-overlay-styles"),vt(n,lD,"team-card-styles"),vt(n,cD,"feature-card-styles"),vt(n,dD,"team-xp-panel-styles"),vt(n,uD,"growth-panel-styles"),vt(n,oC,"base-pet-card-styles"),vt(n,ng,"badge-styles"),vt(n,iC,"arcade-button-styles"),vt(n,nC,"gemini-icon-button-styles");}initializeTrackerCard(n){this.trackerCardPart||(this.trackerCardPart=new iD({setHUDOpen:this.deps?.setHUDOpen}));const r=this.trackerCardPart.build();n.appendChild(r),this.trackerCardPart.render();}}const fD=`
  #alerts-section {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  /* Shops card filters */
  .shops-card-filters {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    flex-wrap: nowrap;
  }

  .shops-card-filters .select {
    flex: 0 0 auto;
    min-width: 0;
    width: auto;
  }

  .shops-card-filters .search {
    flex: 1 1 auto;
    min-width: 0;
  }

  .shops-card-filters .search-input {
    padding-right: 40px;
  }

  .shops-card-filters .search-ico--right {
    right: 12px;
  }

  .shops-card-hint {
    padding: 8px 12px 12px;
    font-size: 12px;
    color: color-mix(in oklab, var(--fg) 60%, transparent);
    font-style: italic;
  }

  .shops-card-hint-mobile {
    display: none;
  }

  .weather-card-hint {
    padding: 8px 12px 12px;
    font-size: 12px;
    color: color-mix(in oklab, var(--fg) 60%, transparent);
    font-style: italic;
  }

  .weather-card-hint-mobile {
    display: none;
  }

  @media (hover: none) and (pointer: coarse) {
    .shops-card-hint-desktop,
    .weather-card-hint-desktop {
      display: none;
    }

    .shops-card-hint-mobile,
    .weather-card-hint-mobile {
      display: inline;
    }
  }

  /* Item cell with icon + name */
  .shop-item-cell {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .shop-item-icon {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* Sprite styling in icon container */
  .shop-item-sprite {
    max-width: 32px;
    max-height: 32px;
    width: auto;
    height: auto;
    image-rendering: auto;
    display: block;
  }

  .shop-item-name {
    flex: 1;
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  /* Rarity badge container in table */
  .shop-item-rarity {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
  }

  /* Toggle switch container in table */
  .shop-item-notify {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
  }

  /* Center headers for all columns */
  #shops-card .lg-tr-head .lg-th {
    justify-content: center;
  }

  /* Clickable rows with custom sound indicator */
  #shops-card .lg-tr-body {
    cursor: pointer;
    transition: background 0.15s ease, border-color 0.15s ease;
  }

  #shops-card .lg-tr-body:hover {
    background: color-mix(in oklab, var(--soft) 95%, transparent);
  }

  #shops-card .lg-tr-body.has-custom-sound .lg-td:first-child {
    border-left: 3px solid color-mix(in oklab, var(--accent) 70%, transparent);
  }

  #shops-card .lg-tr-body.has-custom-sound:hover .lg-td:first-child {
    border-left-color: var(--accent);
  }

  /* Weather card items */
  .weather-item-cell {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .weather-item-icon {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    font-size: 20px;
  }

  .weather-item-sprite {
    max-width: 32px;
    max-height: 32px;
    width: auto;
    height: auto;
    image-rendering: auto;
    display: block;
  }

  .weather-item-name {
    flex: 1;
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .weather-item-effects {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
  }

  .weather-item-notify {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
  }

  /* Center headers for weather card columns */
  #weather-card .lg-tr-head .lg-th {
    justify-content: center;
  }

  /* Clickable rows with custom sound indicator */
  #weather-card .lg-tr-body {
    cursor: pointer;
    transition: background 0.15s ease, border-color 0.15s ease;
  }

  #weather-card .lg-tr-body:hover {
    background: color-mix(in oklab, var(--soft) 95%, transparent);
  }

  #weather-card .lg-tr-body.has-custom-sound .lg-td:first-child {
    border-left: 3px solid color-mix(in oklab, var(--accent) 70%, transparent);
  }

  #weather-card .lg-tr-body.has-custom-sound:hover .lg-td:first-child {
    border-left-color: var(--accent);
  }

  /* Pet card styles */
  .pet-card-body {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .pet-card-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 16px;
  }

  /* Settings card styles */
  .alerts-settings-body {
    display: flex;
    flex-direction: column;
  }

  .alerts-settings-divider {
    height: 1px;
    background: var(--border);
    margin: 16px 0;
  }

  .notification-settings {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .notification-settings-title {
    font-size: 13px;
    font-weight: 600;
    color: var(--fg);
    margin-bottom: 4px;
  }

  .notification-item {
    display: flex;
    flex-direction: column;
    gap: 8px;
    padding: 12px;
    background: color-mix(in oklab, var(--soft) 85%, transparent);
    border: 1px solid color-mix(in oklab, var(--border) 70%, transparent);
    border-radius: 12px;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
  }

  .notification-item.is-playing {
    border-color: color-mix(in oklab, var(--accent) 45%, var(--border));
    box-shadow: 0 10px 22px color-mix(in oklab, var(--shadow) 18%, transparent);
  }

  .notification-item-label {
    font-size: 13px;
    font-weight: 500;
    color: var(--fg);
  }

  .notification-item-description {
    font-size: 12px;
    color: color-mix(in oklab, var(--fg) 60%, transparent);
  }

  .notification-item-controls {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .notification-item-controls .select {
    flex: 1 1 auto;
    min-width: 120px;
  }

  .notification-item-play {
    appearance: none;
    border: 1px solid color-mix(in oklab, var(--border) 70%, transparent);
    background: color-mix(in oklab, var(--soft) 78%, transparent);
    color: var(--fg);
    border-radius: 10px;
    min-height: 32px;
    min-width: 52px;
    padding: 0 8px;
    font-size: 11.5px;
    font-weight: 600;
    cursor: pointer;
    text-align: center;
    flex-shrink: 0;
    transition: border-color 0.2s ease, background 0.2s ease, transform 0.05s ease;
  }

  .notification-item-play:hover {
    border-color: color-mix(in oklab, var(--accent) 45%, var(--border));
  }

  .notification-item-play:active {
    transform: translateY(1px);
  }

  .notification-item .slider {
    width: 100%;
  }

  .notification-mode-row {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: nowrap;
  }

  .notification-mode-row .select {
    flex: 0 0 auto;
    min-width: 0;
    width: auto;
  }

  .notification-mode-description {
    flex: 1 1 auto;
    min-width: 0;
    font-size: 12px;
    color: color-mix(in oklab, var(--fg) 65%, transparent);
    font-style: italic;
  }
`,Ub={ui:{expandedCards:{settings:true,shops:false,weather:false,pet:false}}};async function hD(){const e=await Kr("tab-alerts",{version:1,defaults:Ub,sanitize:o=>({ui:{expandedCards:Ci(Ub.ui.expandedCards,o.ui?.expandedCards)}})});function t(o){const i=e.get();e.update({ui:{...i.ui,...o,expandedCards:Ci(i.ui.expandedCards,o.expandedCards)}});}function n(o,i){const a=e.get();e.update({ui:{...a.ui,expandedCards:{...a.ui.expandedCards,[o]:!!i}}});}function r(o){const i=e.get();n(o,!i.ui.expandedCards[o]);}return {get:e.get,set:e.set,save:e.save,setUI:t,setCardExpanded:n,toggleCard:r}}const gD={seed:"Seeds",tool:"Tools",egg:"Eggs",decor:"Decor"},Wb={seed:"🌱",tool:"🔧",egg:"🥚",decor:"🎨"},mD={seed:"plants",tool:"items",egg:"eggs",decor:"decor"},bD={seed:"seed",tool:null,egg:null,decor:null},Vb={common:0,uncommon:1,rare:2,legendary:3,mythical:4,divine:5,celestial:6};function ag(e,t,n){try{const r=mD[t],o=we.get(r);if(!o||typeof o!="object")return null;const i=o[e];if(!i||typeof i!="object")return null;const a=bD[t],s=a?i[a]:i;return !s||typeof s!="object"?null:s[n]??null}catch(r){return console.warn(`[Alerts] Failed to get ${n} for ${e}:`,r),null}}function vD(e,t){return ag(e,t,"spriteId")}function yD(e,t){const n=ag(e,t,"rarity");return n?String(n).toLowerCase():null}function xD(e,t){return ag(e,t,"name")??e}function wD(){const e=Ro.getTrackedItems();return new Set(e.map(t=>`${t.shopType}:${t.itemId}`))}function qb(e){const t=wD(),n=[],r=["seed","tool","egg","decor"];for(const o of r){const i=e.byType[o];if(i)for(const a of i.items){const s=`${o}:${a.id}`;n.push({...a,shopType:o,rarity:yD(a.id,o),spriteId:vD(a.id,o),itemName:xD(a.id,o),isTracked:t.has(s),hasCustomSound:Ne.hasItemCustomSound("shop",a.id,o)});}}return n}const CD=`
  /* Container */
  .modal-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 99999;
    pointer-events: none;
    contain: layout;
    will-change: opacity;
  }

  .modal-container.is-open {
    pointer-events: auto;
  }

  /* Backdrop */
  .modal-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: color-mix(in oklab, var(--shadow) 85%, transparent);
    backdrop-filter: blur(0px);
    opacity: 0;
    transition: opacity 0.2s ease, backdrop-filter 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 16px;
    will-change: opacity, backdrop-filter;
  }

  .modal-container.is-open .modal-backdrop {
    opacity: 1;
    backdrop-filter: blur(4px);
  }

  /* Dialog */
  .modal-dialog {
    background: var(--paper);
    border: 1px solid color-mix(in oklab, var(--border) 70%, transparent);
    border-radius: 12px;
    box-shadow: 0 10px 40px color-mix(in oklab, var(--shadow) 65%, transparent);
    display: flex;
    flex-direction: column;
    max-height: 90vh;
    width: 100%;
    opacity: 0;
    transform: scale(0.95);
    transition: transform 0.2s ease, opacity 0.2s ease;
    will-change: transform, opacity;
  }

  .modal-container.is-open .modal-dialog {
    opacity: 1;
    transform: scale(1);
  }

  /* Dialog sizes */
  .modal-dialog--sm {
    max-width: 300px;
  }

  .modal-dialog--md {
    max-width: 450px;
  }

  .modal-dialog--lg {
    max-width: 600px;
  }

  /* Header */
  .modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 20px;
    border-bottom: 1px solid color-mix(in oklab, var(--border) 60%, transparent);
  }

  .modal-title-group {
    display: flex;
    flex-direction: column;
    gap: 4px;
    min-width: 0;
  }

  .modal-title {
    margin: 0;
    font-size: 18px;
    font-weight: 600;
    color: var(--fg);
    font-family: var(--font-ui, system-ui);
  }

  .modal-subtitle {
    margin: 0;
    font-size: 12px;
    color: color-mix(in oklab, var(--fg) 55%, transparent);
    font-family: var(--font-ui, system-ui);
  }

  .modal-close {
    appearance: none;
    background: none;
    border: none;
    color: color-mix(in oklab, var(--fg) 60%, transparent);
    cursor: pointer;
    font-size: 28px;
    line-height: 1;
    padding: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    transition: all 0.15s ease;
  }

  .modal-close:hover {
    background: color-mix(in oklab, var(--soft) 85%, transparent);
    color: var(--fg);
  }

  .modal-close:focus-visible {
    outline: none;
    box-shadow: 0 0 0 2px color-mix(in oklab, var(--accent) 45%, transparent);
  }

  /* Body */
  .modal-body {
    padding: 20px;
    overflow-y: auto;
    flex: 1;
    scrollbar-gutter: stable;
  }

  /* Custom scrollbar */
  .modal-body::-webkit-scrollbar {
    width: 8px;
  }

  .modal-body::-webkit-scrollbar-track {
    background: color-mix(in oklab, var(--soft) 50%, transparent);
    border-radius: 4px;
  }

  .modal-body::-webkit-scrollbar-thumb {
    background: color-mix(in oklab, var(--border) 80%, transparent);
    border-radius: 4px;
  }

  .modal-body::-webkit-scrollbar-thumb:hover {
    background: color-mix(in oklab, var(--border) 100%, transparent);
  }

  /* Footer */
  .modal-footer {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 8px;
    padding: 20px;
    border-top: 1px solid color-mix(in oklab, var(--border) 60%, transparent);
  }

  /* Responsive (Mobile) */
  @media (max-width: 640px) {
    .modal-backdrop {
      padding: 0;
    }

    .modal-dialog {
      max-height: 100vh;
      border-radius: 0;
      height: 100%;
    }

    .modal-dialog--sm,
    .modal-dialog--md,
    .modal-dialog--lg {
      max-width: 100%;
    }
  }
`,SD={size:"md",closeOnBackdrop:true,closeOnEscape:true};function sg(e){const t={...SD,...e};let n=false,r=null,o=null,i=null,a=null,s=null;function l(){g(),t.onClose?.();}function d(F){t.closeOnBackdrop&&F.target===o&&l();}function c(F){t.closeOnEscape&&F.key==="Escape"&&l();}function p(){if(!i)return;const F=["a[href]","button:not([disabled])","textarea:not([disabled])","input:not([disabled])","select:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(","),A=Array.from(i.querySelectorAll(F));if(A.length===0)return;const T=A[0],M=A[A.length-1];T.focus();const S=R=>{R.key==="Tab"&&(R.shiftKey?document.activeElement===T&&(R.preventDefault(),M.focus()):document.activeElement===M&&(R.preventDefault(),T.focus()));};i.addEventListener("keydown",S),a=()=>{i?.removeEventListener("keydown",S);};}function m(){r=x("div",{className:"modal-container"}),r.setAttribute("role","dialog"),r.setAttribute("aria-modal","true"),r.setAttribute("aria-labelledby","modal-title");const F=x("style");F.textContent=CD,r.appendChild(F),o=x("div",{className:"modal-backdrop"}),o.addEventListener("click",d),r.appendChild(o),i=x("div",{className:`modal-dialog modal-dialog--${t.size}`});const A=x("div",{className:"modal-header"}),T=x("h2",{className:"modal-title",id:"modal-title"},t.title);if(t.subtitle){const R=x("div",{className:"modal-title-group"});R.appendChild(T),R.appendChild(x("p",{className:"modal-subtitle"},t.subtitle)),A.appendChild(R);}else A.appendChild(T);const M=x("button",{className:"modal-close",type:"button","aria-label":"Close modal"},"×");M.addEventListener("click",l),A.appendChild(M),i.appendChild(A);const S=x("div",{className:"modal-body"});if(S.appendChild(t.content),i.appendChild(S),t.footer){const R=x("div",{className:"modal-footer"});R.appendChild(t.footer),i.appendChild(R);}return o.appendChild(i),r}function b(){if(!r)return;const F=r.getBoundingClientRect(),A=window.innerWidth,T=window.innerHeight;Math.abs(F.left)>1||Math.abs(F.top)>1||Math.abs(F.width-A)>1||Math.abs(F.height-T)>1?(r.style.left=`${-F.left}px`,r.style.top=`${-F.top}px`,r.style.width=`${A}px`,r.style.height=`${T}px`):(r.style.left="0px",r.style.top="0px",r.style.width="100%",r.style.height="100%");}function g(){!n||!r||(r.classList.remove("is-open"),n=false,a&&(a(),a=null),document.removeEventListener("keydown",c),s?.(),s=null,setTimeout(()=>{r?.remove();},200));}function w(){n&&g(),o?.removeEventListener("click",d),a&&(a(),a=null),document.removeEventListener("keydown",c),s?.(),s=null,r?.remove(),r=null,o=null,i=null;}const _=m();((document.querySelector("#gemini-hud-root")||document.querySelector("#gemini-root")||document.querySelector("#gemini-hud-container"))?.shadowRoot||document.body||document.documentElement).appendChild(_),requestAnimationFrame(b);const O=()=>b();return window.addEventListener("resize",O),s=()=>{window.removeEventListener("resize",O);},requestAnimationFrame(()=>{r?.classList.add("is-open"),n=true,p(),document.addEventListener("keydown",c);}),{root:_,close:g,destroy:w}}function lg(e={}){const{id:t,min:n=0,max:r=100,step:o=1,value:i=n,label:a,showValue:s=true,disabled:l=false,onInput:d,onChange:c}=e,p=x("div",{className:"slider"}),m=x("div",{className:"slider-row"}),b=x("div",{className:"slider-track"}),g=x("div",{className:"slider-range"});b.appendChild(g);const w=x("input",{id:t,type:"range",min:String(n),max:String(r),step:String(o),value:String(i),disabled:l});w.addEventListener("input",T=>{C(),d?.(P(),T);}),w.addEventListener("change",T=>c?.(P(),T));function _(){const T=r-n;return T===0?0:(P()-n)/T}function C(){const T=Math.max(0,Math.min(1,_()));g.style.width=`${T*100}%`,A&&(A.textContent=String(P()));}function E(T){w.value=String(T),C();}function P(){return Number(w.value)}function O(T){w.disabled=!!T;}let F=null,A=null;return a&&(F=x("span",{className:"slider-label"},a),m.appendChild(F)),b.appendChild(w),m.appendChild(b),s&&(A=x("span",{className:"slider-value"},String(i)),m.appendChild(A)),p.append(m),C(),{root:p,input:w,setValue:E,getValue:P,setDisabled:O}}const Xb=`
  .custom-sound-modal .modal-backdrop {
    --safe-pad-y: max(16px, var(--inset-t, 0px), var(--inset-b, 0px));
    --safe-pad-x: max(16px, var(--inset-l, 0px), var(--inset-r, 0px));
    padding: var(--safe-pad-y) var(--safe-pad-x);
  }

  .custom-sound-modal .modal-dialog {
    width: 100%;
    max-width: min(92vw, 420px);
    max-height: min(80vh, 560px);
    height: auto;
    border-radius: 12px;
    background: var(--paper, var(--bg));
    overflow: visible;
    isolation: isolate;
  }

  .custom-sound-modal .modal-header {
    padding: 14px 16px;
  }

  .custom-sound-modal .modal-title {
    font-size: 15px;
    font-weight: 600;
  }

  .custom-sound-modal-title {
    display: inline-flex;
    align-items: center;
    gap: 10px;
  }

  .custom-sound-modal-title-icon {
    width: 32px;
    height: 32px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    font-size: 20px;
  }

  .custom-sound-modal-title-sprite {
    width: 28px;
    height: 28px;
    image-rendering: auto;
  }

  .custom-sound-modal-title-text {
    color: var(--fg);
  }

  .custom-sound-modal .modal-body {
    overflow: visible;
    flex: 0 0 auto;
  }

  .custom-sound-modal .slider-value {
    color: var(--fg);
  }

  @media (max-width: 640px) {
    .custom-sound-modal .modal-backdrop {
      align-items: center;
      justify-content: center;
      min-height: 100dvh;
      height: 100dvh;
    }

    .custom-sound-modal .modal-dialog {
      max-width: min(92vw, 360px);
      max-height: min(78vh, 520px);
      border-radius: 12px;
      height: auto;
    }

    .custom-sound-modal .modal-body {
      overflow: visible;
    }
  }

  /* Header */
  .custom-sound-modal-header {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    padding-bottom: 20px;
    border-bottom: 1px solid color-mix(in oklab, var(--border) 60%, transparent);
    margin-bottom: 20px;
  }

  .custom-sound-modal-visual {
    width: 64px;
    height: 64px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: color-mix(in oklab, var(--soft) 85%, transparent);
    border-radius: 8px;
    font-size: 32px;
  }

  .custom-sound-modal-sprite {
    width: 48px;
    height: 48px;
    image-rendering: pixelated;
  }

  .custom-sound-modal-name {
    font-size: 16px;
    font-weight: 600;
    color: var(--fg);
    text-align: center;
    font-family: var(--font-ui, system-ui);
  }

  /* Body */
  .custom-sound-modal-body {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .custom-sound-modal-row {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .custom-sound-modal-label {
    font-size: 13px;
    font-weight: 600;
    color: var(--fg);
    font-family: var(--font-ui, system-ui);
  }

  .custom-sound-modal-controls {
    display: flex;
    gap: 8px;
    align-items: center;
  }

  .custom-sound-modal-controls > *:first-child {
    flex: 1;
  }

  /* Mode */
  .custom-sound-modal-mode-controls {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .custom-sound-modal-mode-description {
    font-size: 12px;
    color: color-mix(in oklab, var(--fg) 65%, transparent);
    font-style: italic;
    font-family: var(--font-ui, system-ui);
  }

  /* Footer */
  .custom-sound-modal .modal-footer {
    justify-content: flex-start;
  }

  .custom-sound-modal-footer {
    width: 100%;
    display: flex;
    gap: 8px;
    align-items: center;
  }
`,kD={title:"Custom Sound",size:"md",closeOnBackdrop:true,closeOnEscape:true},Kb={"one-shot":"Play sound once when event occurs",loop:"Loop sound while event is active"},_D=220;function AD(){return (document.querySelector("#gemini-hud-root")||document.querySelector("#gemini-root")||document.querySelector("#gemini-hud-container"))?.shadowRoot??null}function ED(e){const t=AD();if(t){vt(t,Xb,"customSoundModal");return}const n=x("style");n.textContent=Xb,e.appendChild(n);}function uC(e){const t={...kD,...e};let n=null,r=null,o=null,i=null,a=null,s=null,l=null,d=null,c=null,p=false,m=false,b=null;function g(){c?.(),c=null,d&&(d.pause(),d.currentTime=0),d=null,o?.setLabel("Play");}async function w(){if(d){g();return}if(!l)return;const j=Ne.getById(l.soundId);if(!j){console.error(`[CustomSoundModal] Sound not found: ${l.soundId}`);return}const q=new Audio(j.source);q.volume=l.volume/100,d=q;const U=()=>{g();},ce=()=>{g(),console.error(`[CustomSoundModal] Failed to play sound: ${j.name}`);};q.addEventListener("ended",U),q.addEventListener("error",ce),c=()=>{q.removeEventListener("ended",U),q.removeEventListener("error",ce);};try{await q.play(),o?.setLabel("Stop");}catch(W){g(),console.error("[CustomSoundModal] Failed to play sound:",W);}}function _(){s&&l&&(s.textContent=Kb[l.mode]);}function C(){p||b!==null||(b=window.setTimeout(()=>{O();},_D));}function E(){p||m||(m=true,g(),t.onClose?.(),C());}function P(){p||(n?.close(),E());}function O(){p||(p=true,m=true,b!==null&&(window.clearTimeout(b),b=null),g(),r&&(r.destroy(),r=null),a&&(a.destroy(),a=null),i=null,o=null,s=null,l=null,n&&(n.destroy(),n=null));}function F(){const j=x("span",{className:"custom-sound-modal-title"});let q=false;if(e.spriteId)try{const ce=ye.toCanvas(e.spriteId);if(ce){const W=x("span",{className:"custom-sound-modal-title-icon"});ce.className="custom-sound-modal-title-sprite",W.appendChild(ce),j.appendChild(W),q=!0;}}catch{}if(!q&&e.icon){const ce=x("span",{className:"custom-sound-modal-title-icon"},e.icon);j.appendChild(ce);}const U=x("span",{className:"custom-sound-modal-title-text"},e.entityName);return j.appendChild(U),j}function A(){const j=x("div",{className:"custom-sound-modal-body"}),q=Ne.getItemCustomSound(e.entityType,e.entityId,e.shopType),U=Ne.getNotificationConfig(e.entityType);l=q?{soundId:q.soundId,volume:q.volume,mode:q.mode}:{soundId:U.soundId,volume:U.volume,mode:U.mode};const ce=Ne.getAll().map(B=>({value:B.id,label:B.name})),W=x("div",{className:"custom-sound-modal-row"}),te=x("label",{className:"custom-sound-modal-label"},"Sound");W.appendChild(te);const ne=x("div",{className:"custom-sound-modal-controls"});r=Io({value:l.soundId,options:ce,size:"sm",onChange:B=>{l&&(l.soundId=B),g();}}),ne.appendChild(r.root),o=kt({label:"Play",variant:"default",size:"sm",onClick:()=>w()}),ne.appendChild(o),W.appendChild(ne),j.appendChild(W);const ie=x("div",{className:"custom-sound-modal-row"}),ee=x("label",{className:"custom-sound-modal-label"},"Volume");ie.appendChild(ee),i=lg({min:0,max:100,step:1,value:l.volume,showValue:true,onChange:B=>{l&&(l.volume=B),d&&(d.volume=B/100);}}),ie.appendChild(i.root),j.appendChild(ie);const H=x("div",{className:"custom-sound-modal-row"}),K=x("label",{className:"custom-sound-modal-label"},"Mode");H.appendChild(K);const D=x("div",{className:"custom-sound-modal-mode-controls"});return a=Io({value:l.mode,options:[{value:"one-shot",label:"One-shot"},{value:"loop",label:"Loop"}],size:"sm",onChange:B=>{l&&(l.mode=B),_();}}),D.appendChild(a.root),s=x("div",{className:"custom-sound-modal-mode-description"},Kb[l.mode]),D.appendChild(s),H.appendChild(D),j.appendChild(H),j}function T(){const j=x("div",{className:"custom-sound-modal-footer"}),q=kt({label:"Reset",variant:"danger",size:"sm",onClick:()=>{e.onSave(null),P();}});j.appendChild(q);const U=x("div",{style:"flex: 1"});j.appendChild(U);const ce=kt({label:"Cancel",variant:"default",size:"sm",onClick:()=>P()});j.appendChild(ce);const W=kt({label:"Save",variant:"primary",size:"sm",onClick:()=>{l&&e.onSave({...l}),P();}});return j.appendChild(W),j}const M=A(),S=T(),R=x("div");ED(R),R.appendChild(M),n=sg({title:e.entityName||t.title,content:R,footer:S,size:t.size,closeOnBackdrop:t.closeOnBackdrop,closeOnEscape:t.closeOnEscape,onClose:E}),n.root.classList.add("custom-sound-modal");const z=n.root.querySelector(".modal-title");return z&&z.replaceChildren(F()),{root:n.root,close:P,destroy:O}}const TD=["seed","tool","egg","decor"],ID=new Set(TD);function Zu(e){const[t,...n]=e.split(":");return !t||n.length===0||!ID.has(t)?null:{shopType:t,itemId:n.join(":")}}const PD=500,Yb=10,MD=800;function LD(e){const{rows:t}=e,n=new Map;let r=null,o=false;const i=new Map;let a=null,s=null,l=null,d=null,c=null,p=false;function m(D,B){B?D.classList.add("has-custom-sound"):D.classList.remove("has-custom-sound");}function b(D){const B=Zu(D);return B?Ne.hasItemCustomSound("shop",B.itemId,B.shopType):false}function g(D){if(!r)return null;const B=r.root.querySelectorAll(".lg-tr-body");for(const Q of B)if(Q.dataset.id===D)return Q;return null}function w(D,B){const Q=g(D);if(!Q)return;const ae=B??b(D);m(Q,ae);}function _(){if(!r)return;r.root.querySelectorAll(".lg-tr-body").forEach(B=>{const Q=B.dataset.id;Q&&m(B,b(Q));});}function C(){o||(o=true,requestAnimationFrame(()=>{o=false,_();}));}function E(D){i.clear();for(const B of D)i.set(`${B.shopType}:${B.id}`,B);}function P(D){const B=Zu(D);return B?Ne.hasItemCustomSound("shop",B.itemId,B.shopType):false}function O(D){const B=Zu(D);if(!B||!Ne.hasItemCustomSound("shop",B.itemId,B.shopType))return;Ne.removeItemCustomSound("shop",B.itemId,B.shopType);const Q=i.get(D);Q&&(Q.hasCustomSound=false),w(D,false),C();}function F(){s!==null&&(window.clearTimeout(s),s=null),a=null;}function A(D){a=D,s!==null&&window.clearTimeout(s),s=window.setTimeout(()=>{s=null,a=null;},MD);}function T(){l!==null&&(window.clearTimeout(l),l=null),d=null,c=null,p=false;}if(r=id({columns:[{key:"item",header:"Item",width:"1fr",align:"left",sortable:true,sortFn:(D,B)=>D.itemName.localeCompare(B.itemName,void 0,{numeric:true,sensitivity:"base"}),render:D=>{const B=x("div",{className:"shop-item-cell"}),Q=x("div",{className:"shop-item-icon"});if(D.spriteId){const le=ye.toCanvas(D.spriteId);le?(le.className="shop-item-sprite",Q.appendChild(le)):Q.textContent=Wb[D.shopType];}else Q.textContent=Wb[D.shopType];const ae=x("div",{className:"shop-item-name"});return ae.textContent=D.itemName,B.appendChild(Q),B.appendChild(ae),B}},{key:"rarity",header:"Rarity",width:"120px",align:"center",sortable:true,sortFn:(D,B)=>{const Q=D.rarity?Vb[D.rarity.toLowerCase()]??999:999,ae=B.rarity?Vb[B.rarity.toLowerCase()]??999:999;return Q-ae},render:D=>{const B=x("div",{className:"shop-item-rarity"}),Q=Ms({variant:"rarity",rarity:D.rarity});return B.appendChild(Q.root),B}},{key:"notify",header:"Notify",width:"60px",align:"center",sortable:false,render:D=>{const B=x("div",{className:"shop-item-notify"}),Q=hb(D.id,D.shopType),ae=Xr({checked:D.isTracked,disabled:Q,size:"sm",onChange:ve=>{D.isTracked=ve,ve?Ro.addTrackedItem(D.shopType,D.id):Ro.removeTrackedItem(D.shopType,D.id);}}),le=`${D.shopType}:${D.id}`;return n.set(le,ae),B.appendChild(ae.root),B}}],data:t,maxHeight:400,stickyHeader:true,zebra:true,compact:true,getRowId:D=>`${D.shopType}:${D.id}`,onSortChange:()=>{C();},onRowClick:(D,B,Q)=>{const ae=`${D.shopType}:${D.id}`;if(a){if(a===ae){F();return}F();}Q.target.closest(".shop-item-notify")||uC({entityType:"shop",entityId:D.id,entityName:D.itemName,spriteId:D.spriteId,shopType:D.shopType,onSave:ve=>{ve===null?(Ne.removeItemCustomSound("shop",D.id,D.shopType),D.hasCustomSound=false,w(ae,false)):(Ne.setItemCustomSound("shop",D.id,ve,D.shopType),D.hasCustomSound=true,w(ae,true));}});}}),!r)throw new Error("[ShopsCard] Failed to create items table");E(t);const S=r.root,R=D=>{const B=D.target;if(B.closest(".shop-item-notify"))return;const ae=B.closest(".lg-tr-body")?.dataset.id;!ae||!P(ae)||(D.preventDefault(),D.stopPropagation(),A(ae),O(ae));},z=D=>{if(D.pointerType==="mouse"||D.button!==0)return;const B=D.target;if(B.closest(".shop-item-notify"))return;const ae=B.closest(".lg-tr-body")?.dataset.id;!ae||!P(ae)||(T(),d=ae,c={x:D.clientX,y:D.clientY},l=window.setTimeout(()=>{l=null,d&&(p=true,A(d),O(d));},PD));},j=D=>{if(!c||!d||p)return;const B=D.clientX-c.x,Q=D.clientY-c.y;B*B+Q*Q>Yb*Yb&&T();},q=()=>{T();},U=()=>{T();};S.addEventListener("contextmenu",R),S.addEventListener("pointerdown",z),S.addEventListener("pointermove",j),S.addEventListener("pointerup",q),S.addEventListener("pointercancel",U);const ce=r.setData.bind(r);r.setData=D=>{E(D),ce(D),C();},C();const W=D=>{for(const[B,Q]of n.entries()){const[ae,le]=B.split(":");if(D&&ae!==D)continue;const ve=hb(le,ae);Q.setDisabled(ve);}},ne=Hn().subscribeStable(()=>{W();}),ie=Di(),ee=ie.subscribeDecorPlaced(()=>{W("decor");}),H=ie.subscribeDecorRemoved(()=>{W("decor");}),K=r.destroy.bind(r);return r.destroy=()=>{ne(),ee(),H(),S.removeEventListener("contextmenu",R),S.removeEventListener("pointerdown",z),S.removeEventListener("pointermove",j),S.removeEventListener("pointerup",q),S.removeEventListener("pointercancel",U),T(),F(),n.clear(),i.clear(),K();},r}function RD(e){let t="";for(const n of e)n.length>t.length&&(t=n);return t}function OD(e,t){const n=e.getRootNode(),r=n instanceof ShadowRoot?n:document.body||document.documentElement;if(!r)return 0;const o=x("div",{className:"select"});for(const c of Array.from(e.classList))c.startsWith("select--")&&o.classList.add(c);o.style.position="absolute",o.style.visibility="hidden",o.style.pointerEvents="none",o.style.left="-9999px",o.style.top="-9999px",o.style.minWidth="0";const i=x("button",{className:"select-trigger",type:"button"});i.style.width="auto",i.style.minWidth="0",i.style.whiteSpace="nowrap";const a=e.querySelector(".select-caret")?.textContent||"v",s=x("span",{className:"select-value"},t),l=x("span",{className:"select-caret"},a);i.append(s,l),o.appendChild(i),r.appendChild(o);const d=Math.ceil(i.getBoundingClientRect().width);return o.remove(),d}function FD(e,t){const n=RD(t);if(!n)return;let r=0;const o=6,i=()=>{if(r+=1,!e.isConnected){r<o&&requestAnimationFrame(i);return}const a=OD(e,n);a>0&&(e.style.width=`${a}px`,e.style.minWidth=`${a}px`);};requestAnimationFrame(i);}function ND(e){const t=$i(),n=t.get();let r=null,o=[],i=[];const a={selectedShopType:"all",searchQuery:""},s={shopTypeSelect:null,searchInput:null,tableHandle:null};let l=0,d=new Set;function c(_,C){if(_.size!==C.size)return  false;for(const E of _)if(!C.has(E))return  false;return  true}function p(){if(!s.tableHandle)return;const _=o.filter(C=>!(a.selectedShopType!=="all"&&C.shopType!==a.selectedShopType||a.searchQuery&&!C.itemName.toLowerCase().includes(a.searchQuery.toLowerCase())));i=_,s.tableHandle.setData(_);}function m(){const _=x("div",{className:"shops-card-filters"}),E=[{value:"all",label:"All Shops"},...["seed","tool","egg","decor"].map(O=>({value:O,label:gD[O]}))];s.shopTypeSelect=Io({value:"all",options:E,size:"sm",onChange:O=>{a.selectedShopType=O,p();}});const P=s.shopTypeSelect.root;return P.style.minWidth="0",P.style.width="auto",FD(P,E.map(O=>O.label)),s.searchInput=vs({placeholder:"Search items...",size:"sm",debounceMs:150,autoSearch:true,withClear:true,blockGameKeys:true,focusKey:"",onSearch:O=>{a.searchQuery=O.trim(),p();}}),_.appendChild(s.shopTypeSelect.root),_.appendChild(s.searchInput.root),_}function b(){o=qb(n),i=[...o],l=o.length,d=new Set(o.map(F=>F.shopType));const _=x("div");s.tableHandle=LD({rows:i});const C=m();_.appendChild(C),_.appendChild(s.tableHandle.root);const E=x("div",{className:"shops-card-hint"}),P=x("span",{className:"shops-card-hint-desktop"},"Click an item to set a custom sound alert. Right-click to reset"),O=x("span",{className:"shops-card-hint-mobile"},"Tap an item to set a custom sound alert. Long-press to reset");return E.append(P,O),_.appendChild(E),r=ft({id:"shops-card",title:"Shops restock",subtitle:"Get notified when tracked items restock",expandable:true,defaultExpanded:e?.defaultExpanded??true,stateKey:"shops",variant:"soft",padding:"none",divider:false,onExpandChange:e?.onExpandChange},_),r}function g(){const _=t.get(),C=qb(_),E=C.length,P=new Set(C.map(F=>F.shopType));(E!==l||!c(P,d))&&(l=E,d=P,o=C,p());}function w(){if(s.tableHandle&&(s.tableHandle.destroy(),s.tableHandle=null),s.shopTypeSelect&&(s.shopTypeSelect.destroy(),s.shopTypeSelect=null),s.searchInput){const _=s.searchInput.root.__cleanup;_&&_(),s.searchInput=null;}r=null;}return {root:b(),refresh:g,destroy:w}}const DD=".mp3,.wav,.ogg,audio/*",$D=250*1024,BD=3;function zD(){return typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():`sound-${Date.now().toString(16)}-${Math.random().toString(16).slice(2)}`}function jD(e){const t=e.name||"Untitled",n=t.lastIndexOf(".");return n<=0?t:t.slice(0,n)||t}function GD(e){if(!Number.isFinite(e))return "0 B";if(e<1024)return `${e} B`;const t=e/1024;return t<1024?`${Math.round(t)} KB`:`${(t/1024).toFixed(1)} MB`}function pC(e){return e.split(",").map(t=>t.trim()).filter(Boolean)}function HD(e,t){const n=pC(t);if(!n.length)return  true;const r=e.name.toLowerCase(),o=e.type.toLowerCase();return n.some(i=>{const a=i.toLowerCase();if(a.startsWith("."))return r.endsWith(a);if(a.endsWith("/*")){const s=a.slice(0,-1);return o.startsWith(s)}return o===a})}function UD(e){const n=pC(e).map(r=>r.startsWith(".")?r.slice(1).toUpperCase():r.endsWith("/*")?"Audio":r.includes("/")&&r.split("/")[1]?.toUpperCase()||r.toUpperCase()).filter(Boolean);return n.length?n.join(", "):"Audio"}function WD(e={}){const{id:t,className:n,label:r="Add sounds",hint:o,accept:i=DD,multiple:a=true,disabled:s=false,maxSizeBytes:l=$D,maxItems:d,emptyLabel:c="No sounds added yet",onItemsChange:p,onFilesAdded:m,onError:b}=e;let g=[],w=0,_=null,C=false,E=!!s,P=null,O=null,F=null;const A=new Map,T=new Map,M=Number.isFinite(d)?Math.max(1,Number(d)):a?Number.POSITIVE_INFINITY:1,S=x("div",{className:"sound-picker",id:t});n&&S.classList.add(...n.split(" ").filter(Boolean)),E&&S.classList.add("is-disabled");const R=x("div",{className:"sound-picker__header"}),z=x("div",{className:"sound-picker__label"},r),j=o??`${UD(i)} - Max ${GD(l)}`,q=x("div",{className:"sound-picker__hint"},j);R.append(z,q);const U=x("div",{className:"sound-picker__zone",role:"button",tabIndex:E?-1:0,"aria-disabled":String(E)}),ce=x("div",{className:"sound-picker__zone-text"}),W=x("div",{className:"sound-picker__zone-title"},"Drop audio files here"),te=x("div",{className:"sound-picker__zone-subtitle"},"or click to browse");ce.append(W,te);const ne=kt({label:a?"Choose files":"Choose file",size:"sm",onClick:v=>{v.preventDefault(),E||ie.click();},disabled:E});ne.classList.add("sound-picker__pick");const ie=x("input",{className:"sound-picker__input",type:"file",accept:i,multiple:a?true:void 0,disabled:E,tabIndex:-1});U.append(ce,ne,ie);const ee=x("div",{className:"sound-picker__status",role:"status","aria-live":"polite"}),H=x("div",{className:"sound-picker__list",role:"list"});S.append(R,U,ee,H);function K(v,L="info"){const G=v??"";ee.textContent=G,ee.classList.toggle("is-error",L==="error");}function D(v){b?.(v),K(v.message,"error");}function B(){for(const v of A.values())try{v.destroy();}catch{}A.clear();}function Q(v){const L=T.get(v.id);if(L)return L;const G=v.file.__sourceUrl;if(G)return T.set(v.id,G),G;const V=URL.createObjectURL(v.file);return T.set(v.id,V),V}function ae(v){const L=T.get(v);L&&(L.startsWith("blob:")&&URL.revokeObjectURL(L),T.delete(v));}function le(){F?.(),F=null,P&&(P.pause(),P.currentTime=0),P=null,O=null;}function ve(){H.querySelectorAll(".sound-picker__item").forEach(L=>{const G=L.dataset.id,V=L.querySelector(".sound-picker__item-btn--play");if(!G||!V)return;const Z=!!P&&O===G&&!P.paused;V.textContent=Z?"Stop":"Play",L.classList.toggle("is-playing",Z);});}function Ie(v){if(E)return;if(O===v.id){le(),ve();return}le();const L=Q(v),G=new Audio(L);P=G,O=v.id;const V=()=>{O===v.id&&(le(),ve());},Z=()=>{O===v.id&&(le(),ve(),D({code:"type",file:v.file,message:`Unable to play ${v.name}`}));};G.addEventListener("ended",V),G.addEventListener("error",Z),F=()=>{G.removeEventListener("ended",V),G.removeEventListener("error",Z);},G.play().then(()=>{ve();}).catch(()=>{le(),ve(),D({code:"type",file:v.file,message:`Unable to play ${v.name}`});});}function Be(){if(B(),H.classList.toggle("is-scrollable",g.length>BD),!g.length){const L=x("div",{className:"sound-picker__empty"});L.append(typeof c=="string"?document.createTextNode(c):c),H.replaceChildren(L);return}const v=g.map(L=>bt(L));if(H.replaceChildren(...v),_){const L=A.get(_);L&&requestAnimationFrame(()=>L.focus());}ve();}function bt(v){const L=_===v.id,G=x("div",{className:"sound-picker__item",role:"listitem","data-id":v.id}),V=x("div",{className:"sound-picker__item-top"});x("div",{className:"sound-picker__item-bottom"});const Z=x("div",{className:"sound-picker__item-name"});if(L&&!E){const Ce=od({value:v.name,blockGameKeys:true,onEnter:be=>{jt(v.id,be);}});Ce.root.classList.add("sound-picker__rename"),Ce.input.classList.add("input--sm"),Ce.input.setAttribute("aria-label","Rename sound"),Ce.input.addEventListener("keydown",be=>{be.key==="Escape"&&(be.preventDefault(),on());}),Ce.input.addEventListener("blur",()=>{if(C){C=false;return}jt(v.id,Ce.getValue());}),A.set(v.id,Ce),Z.appendChild(Ce.root);}else {const Ce=x("div",{className:"sound-picker__item-label",title:v.name},v.name);Z.appendChild(Ce);}const ue=x("div",{className:"sound-picker__item-actions","aria-label":"Sound actions"});if(L&&!E){const Ce=x("button",{className:"sound-picker__item-btn",type:"button",disabled:E},"Save");Ce.addEventListener("click",()=>{const Se=A.get(v.id);jt(v.id,Se?.getValue()??v.name);});const be=x("button",{className:"sound-picker__item-btn",type:"button",disabled:E},"Cancel");be.addEventListener("pointerdown",()=>{C=true;}),be.addEventListener("click",()=>on()),ue.append(Ce,be);}else {const Ce=x("button",{className:"sound-picker__item-btn sound-picker__item-btn--play",type:"button",disabled:E},O===v.id?"Stop":"Play");Ce.addEventListener("click",()=>Ie(v));const be=x("button",{className:"sound-picker__item-btn",type:"button",disabled:E},"Rename");be.addEventListener("click",()=>{E||(_=v.id,Be());});const Se=x("button",{className:"sound-picker__item-btn sound-picker__item-btn--danger",type:"button",disabled:E},"Remove");Se.addEventListener("click",()=>at(v.id)),ue.append(Ce,be,Se);}return V.append(Z,ue),G.append(V),G}function Qt(){return g.slice()}function gt(v){const L=v.slice(),G=new Set(L.map(V=>V.id));for(const V of Array.from(T.keys()))G.has(V)||ae(V);O&&!G.has(O)&&le(),g=L,_=null,Be(),p?.(Qt());}function Rt(v){if(E)return;const L=Array.from(v??[]);if(!L.length)return;const G=[],V=[];for(const Se of L){if(i&&!HD(Se,i)){V.push({code:"type",file:Se,message:`Unsupported file type: ${Se.name}`});continue}if(Number.isFinite(l)&&Se.size>l){V.push({code:"size",file:Se,maxSizeBytes:l,message:`File too large: ${Se.name}`});continue}G.push({id:zD(),file:Se,name:jD(Se),size:Se.size,type:Se.type});}if(!G.length){V.length&&D(V[0]);return}const Z=a?g.slice():[],ue=Number.isFinite(M)?Math.max(0,M-Z.length):G.length;if(ue<=0){D({code:"limit",message:`Maximum of ${Math.max(1,M)} files reached`});return}const Ce=G.slice(0,ue),be=a?Z.concat(Ce):Ce.slice(0,1);gt(be),K(null),m?.(Ce.slice()),V.length&&D(V[0]);}function rn(v,L){const G=L.trim();if(!G){D({code:"name",message:"Name cannot be empty"});return}const V=g.map(Z=>Z.id===v?{...Z,name:G}:Z);gt(V),K(null);}function jt(v,L){const G=L.trim();if(!G){D({code:"name",message:"Name cannot be empty"});return}rn(v,G);}function on(){_=null,K(null),Be();}function at(v){const L=g.filter(G=>G.id!==v);gt(L),K(null);}function je(){le(),gt([]),K(null);}function Ln(v){E=!!v,S.classList.toggle("is-disabled",E),U.setAttribute("aria-disabled",String(E)),U.tabIndex=E?-1:0,ie.disabled=E,ne.setDisabled(E),E&&le(),Be();}function Rn(){E||ie.click();}const yt=v=>{if(E)return;const L=v.target;L&&L.closest(".sound-picker__pick")||ie.click();},Tt=v=>{E||(v.key==="Enter"||v.key===" ")&&(v.preventDefault(),ie.click());},an=v=>{E||!v.dataTransfer||!v.dataTransfer.types.includes("Files")||(v.preventDefault(),w+=1,U.classList.add("is-dragover"));},Wn=v=>{E||!v.dataTransfer||!v.dataTransfer.types.includes("Files")||(v.preventDefault(),v.dataTransfer.dropEffect="copy");},mn=v=>{E||U.classList.contains("is-dragover")&&(v.preventDefault(),w=Math.max(0,w-1),w<=0&&(w=0,U.classList.remove("is-dragover")));},I=v=>{E||!v.dataTransfer||!v.dataTransfer.files.length||(v.preventDefault(),w=0,U.classList.remove("is-dragover"),Rt(v.dataTransfer.files));},h=()=>{if(E){ie.value="";return}ie.files&&Rt(ie.files),ie.value="";};return U.addEventListener("click",yt),U.addEventListener("keydown",Tt),U.addEventListener("dragenter",an),U.addEventListener("dragover",Wn),U.addEventListener("dragleave",mn),U.addEventListener("drop",I),ie.addEventListener("change",h),Be(),{root:S,getItems:Qt,setItems:gt,addFiles:Rt,renameItem:rn,removeItem:at,clear:je,setDisabled:Ln,openPicker:Rn,setStatus:K,destroy(){B(),le();for(const v of Array.from(T.keys()))ae(v);U.removeEventListener("click",yt),U.removeEventListener("keydown",Tt),U.removeEventListener("dragenter",an),U.removeEventListener("dragover",Wn),U.removeEventListener("dragleave",mn),U.removeEventListener("drop",I),ie.removeEventListener("change",h),S.remove();}}}const Jb={shop:{"one-shot":"Play sound once when item appears",loop:"Loop sound while item is available in shop"},pet:{"one-shot":"Play sound once when pet event occurs",loop:"Loop sound while pet event is active"},weather:{"one-shot":"Play sound once when weather occurs",loop:"Loop sound while weather is active"}};function VD(e){let t="";for(const n of e)n.length>t.length&&(t=n);return t}function qD(e,t){const n=e.getRootNode(),r=n instanceof ShadowRoot?n:document.body||document.documentElement;if(!r)return 0;const o=x("div",{className:"select"});for(const c of Array.from(e.classList))c.startsWith("select--")&&o.classList.add(c);o.style.position="absolute",o.style.visibility="hidden",o.style.pointerEvents="none",o.style.left="-9999px",o.style.top="-9999px",o.style.minWidth="0";const i=x("button",{className:"select-trigger",type:"button"});i.style.width="auto",i.style.minWidth="0",i.style.whiteSpace="nowrap";const a=e.querySelector(".select-caret")?.textContent||"v",s=x("span",{className:"select-value"},t),l=x("span",{className:"select-caret"},a);i.append(s,l),o.appendChild(i),r.appendChild(o);const d=Math.ceil(i.getBoundingClientRect().width);return o.remove(),d}function XD(e,t){const n=VD(t);if(!n)return;let r=0;const o=6,i=()=>{if(r+=1,!e.isConnected){r<o&&requestAnimationFrame(i);return}const a=qD(e,n);a>0&&(e.style.width=`${a}px`,e.style.minWidth=`${a}px`);};requestAnimationFrame(i);}function KD(e){let t=null,n=null,r=null;const o=new Map,i=new Map,a=new Map;let s=null,l=null,d=null;function c(){d?.(),d=null,s&&(s.pause(),s.currentTime=0),s=null,l=null;}function p(){if(!r)return;r.querySelectorAll(".notification-item").forEach(A=>{const T=A.dataset.type,M=A.querySelector(".notification-item-play");if(!T||!M)return;const S=!!s&&l===T&&!s.paused;M.textContent=S?"Stop":"Play",A.classList.toggle("is-playing",S);});}async function m(F){if(l===F){c(),p();return}c();const A=Ne.getNotificationConfig(F),T=Ne.getById(A.soundId);if(!T){console.error(`[SettingCard] Sound not found: ${A.soundId}`);return}const M=new Audio(T.source);M.volume=A.volume/100,s=M,l=F;const S=()=>{l===F&&(c(),p());},R=()=>{l===F&&(c(),p(),console.error(`[SettingCard] Failed to play sound: ${T.name}`));};M.addEventListener("ended",S),M.addEventListener("error",R),d=()=>{M.removeEventListener("ended",S),M.removeEventListener("error",R);};try{await M.play(),p();}catch(z){c(),p(),console.error("[SettingCard] Failed to play sound:",z);}}function b(F,A){if(F.startsWith("data:"))try{const T=F.split(","),M=T[0].match(/:(.*?);/)?.[1]||"audio/mpeg",S=atob(T[1]),R=S.length,z=new Uint8Array(R);for(let j=0;j<R;j++)z[j]=S.charCodeAt(j);return new File([z],A,{type:M})}catch(T){return console.error("[SettingCard] Failed to convert data URL to File:",T),new File([],A,{type:"audio/mpeg"})}return new File([],A,{type:"audio/mpeg"})}function g(){const A=Ne.getAll().map(T=>({value:T.id,label:T.name}));for(const[T,M]of o){const S=Ne.getNotificationConfig(T);M.setOptions(A),M.setValue(S.soundId);}}function w(F,A,T){const M=x("div",{className:"notification-item","data-type":F}),S=x("div",{className:"notification-item-label"},A);M.appendChild(S);const R=x("div",{className:"notification-item-description"},T);M.appendChild(R);const z=x("div",{className:"notification-item-controls"}),j=Ne.getNotificationConfig(F),U=Ne.getAll().map(K=>({value:K.id,label:K.name})),ce=Io({value:j.soundId,options:U,size:"sm",onChange:K=>{const D=Ne.getNotificationConfig(F);Ne.setNotificationConfig(F,{soundId:K,volume:D.volume,mode:D.mode});}});o.set(F,ce);const W=x("button",{className:"notification-item-play",type:"button",title:"Test sound"},"Play");W.addEventListener("click",()=>{m(F);}),z.appendChild(ce.root),z.appendChild(W),M.appendChild(z);const te=lg({min:0,max:100,step:1,value:j.volume,showValue:true,onChange:K=>{const D=Ne.getNotificationConfig(F);Ne.setNotificationConfig(F,{soundId:D.soundId,volume:K,mode:D.mode});}});a.set(F,te),M.appendChild(te.root);const ne=x("div",{className:"notification-mode-row"}),ie=[{value:"one-shot",label:"One-shot"},{value:"loop",label:"Loop"}],ee=Io({value:j.mode,options:ie,size:"sm",onChange:K=>{const D=Ne.getNotificationConfig(F);Ne.setNotificationConfig(F,{soundId:D.soundId,volume:D.volume,mode:K}),_(F);}});i.set(F,ee),ee.root.classList.add("shrink"),XD(ee.root,ie.map(K=>K.label)),ne.appendChild(ee.root);const H=x("div",{className:"notification-mode-description"},Jb[F][j.mode]);return ne.appendChild(H),M.appendChild(ne),M}function _(F){if(!r)return;const A=r.querySelector(`[data-type="${F}"]`);if(!A)return;const T=Ne.getNotificationConfig(F),M=A.querySelector(".notification-mode-description");M&&(M.textContent=Jb[F][T.mode]);}function C(){const F=x("div",{className:"alerts-settings-body"});Ne.init(),r=x("div",{className:"notification-settings"}),r.appendChild(w("shop","Shops restock","Default sound for shop restock alerts")),r.appendChild(w("pet","Pet events","Default sound for pet event alerts")),r.appendChild(w("weather","Weather events","Default sound for weather event alerts")),F.appendChild(r);const A=x("div",{className:"alerts-settings-divider"});F.appendChild(A);const T=Ne.getAll().map(M=>{const S=b(M.source,M.name);return S.__sourceUrl=M.source,{id:M.id,file:S,name:M.name,size:0,type:M.type}});return n=WD({label:"Notification sounds",hint:"Upload or drop audio files for alerts",maxItems:Ai.MAX_SOUNDS,maxSizeBytes:Ai.MAX_SIZE_BYTES,multiple:true,onItemsChange:M=>{E(M),g();},onFilesAdded:M=>{P(M),setTimeout(()=>{g();},100);}}),n.setItems(T),F.appendChild(n.root),t=ft({id:"alerts-settings-card",title:"Settings",subtitle:"Manage notification sounds",expandable:true,defaultExpanded:e?.defaultExpanded??true,stateKey:"settings",variant:"soft",padding:"none",divider:false,onExpandChange:e?.onExpandChange},F),t}function E(F){const A=new Set(Ne.getAll().map(S=>S.id)),T=new Set(F.map(S=>S.id)),M=[];for(const S of A)if(!T.has(S)){M.push(S);try{Ne.remove(S);}catch(R){console.error(`[SettingCard] Failed to remove sound ${S}:`,R);}}if(M.length>0){const S=["shop","pet","weather"];for(const R of S){const z=Ne.getNotificationConfig(R);if(M.includes(z.soundId)){Ne.setNotificationConfig(R,{soundId:"default-notification",volume:z.volume,mode:z.mode});const j=a.get(R);j&&j.setValue(z.volume);}}}for(const S of F)if(A.has(S.id)){const R=Ne.getById(S.id);if(R&&R.name!==S.name)try{Ne.update(S.id,{name:S.name});}catch(z){console.error(`[SettingCard] Failed to rename sound ${S.id}:`,z);}}}function P(F){for(const A of F)if(!Ne.getById(A.id)){const T=new FileReader;T.onload=M=>{const S=M.target?.result;try{const R=Ne.add(A.name,S,"upload");if(n&&R.id!==A.id){const z=n.getItems().map(j=>j.id===A.id?{...j,id:R.id}:j);n.setItems(z);}}catch(R){console.error(`[SettingCard] Failed to add sound ${A.name}:`,R);}},T.onerror=()=>{console.error(`[SettingCard] Failed to read file ${A.name}`);},T.readAsDataURL(A.file);}}function O(){c(),n&&(n.destroy(),n=null);for(const F of o.values())F.destroy();o.clear();for(const F of i.values())F.destroy();i.clear(),a.clear(),t=null;}return {root:C(),destroy:O}}function YD(e){try{const t=we.get("weather");if(!t||typeof t!="object")return e;const n=t[e];return !n||typeof n!="object"?e:n.name||e}catch{return e}}function JD(e){try{const t=we.get("weather");if(!t||typeof t!="object")return null;const n=t[e];return !n||typeof n!="object"?null:n.spriteId||null}catch{return null}}function QD(e){try{const t=we.get("weather");if(!t||typeof t!="object")return "No effects";const n=t[e];if(!n||typeof n!="object")return "No effects";const r=n.mutator;if(!r||typeof r!="object")return "No effects";const o=r.mutation;if(!o)return "No effects";const i=we.get("mutations");if(!i||typeof i!="object")return o;const a=i[o];return !a||typeof a!="object"?o:a.name||o}catch{return "No effects"}}function Qb(){const e=we.get("weather");if(!e||typeof e!="object")return [];const t=Mi.getTrackedWeathers(),n=new Set(t),r=[];for(const o of Object.keys(e)){if(o==="Sunny")continue;const i={weatherId:o,weatherName:YD(o),spriteId:JD(o),effects:QD(o),isTracked:n.has(o),hasCustomSound:Ne.hasItemCustomSound("weather",o)};r.push(i);}return r.sort((o,i)=>o.weatherName.localeCompare(i.weatherName)),r}const ZD=500,Zb=10,e$=800;function t$(e){const{rows:t}=e;let n=null,r=false;const o=new Map;let i=null,a=null,s=null,l=null,d=null,c=false;function p(W,te){te?W.classList.add("has-custom-sound"):W.classList.remove("has-custom-sound");}function m(W){return Ne.hasItemCustomSound("weather",W)}function b(W){if(!n)return null;const te=n.root.querySelectorAll(".lg-tr-body");for(const ne of te)if(ne.dataset.id===W)return ne;return null}function g(W,te){const ne=b(W);if(!ne)return;const ie=te??m(W);p(ne,ie);}function w(){if(!n)return;n.root.querySelectorAll(".lg-tr-body").forEach(te=>{const ne=te.dataset.id;ne&&p(te,m(ne));});}function _(){r||(r=true,requestAnimationFrame(()=>{r=false,w();}));}function C(W){o.clear();for(const te of W)o.set(te.weatherId,te);}function E(W){return Ne.hasItemCustomSound("weather",W)}function P(W){if(!Ne.hasItemCustomSound("weather",W))return;Ne.removeItemCustomSound("weather",W);const te=o.get(W);te&&(te.hasCustomSound=false),g(W,false),_();}function O(){a!==null&&(window.clearTimeout(a),a=null),i=null;}function F(W){i=W,a!==null&&window.clearTimeout(a),a=window.setTimeout(()=>{a=null,i=null;},e$);}function A(){s!==null&&(window.clearTimeout(s),s=null),l=null,d=null,c=false;}if(n=id({columns:[{key:"weather",header:"Weather",width:"1fr",align:"left",sortable:true,sortFn:(W,te)=>W.weatherName.localeCompare(te.weatherName,void 0,{numeric:true,sensitivity:"base"}),render:W=>{const te=x("div",{className:"weather-item-cell"}),ne=x("div",{className:"weather-item-icon"});if(W.spriteId){const ee=ye.toCanvas(W.spriteId);ee?(ee.className="weather-item-sprite",ne.appendChild(ee)):ne.textContent=ev(W.weatherId);}else ne.textContent=ev(W.weatherId);const ie=x("div",{className:"weather-item-name"});return ie.textContent=W.weatherName,te.appendChild(ne),te.appendChild(ie),te}},{key:"effects",header:"Effects",width:"120px",align:"center",sortable:false,render:W=>{const te=x("div",{className:"weather-item-effects"});return te.textContent=W.effects,te}},{key:"notify",header:"Notify",width:"60px",align:"center",sortable:false,render:W=>{const te=x("div",{className:"weather-item-notify"}),ne=Xr({checked:W.isTracked,disabled:false,size:"sm",onChange:ie=>{W.isTracked=ie,ie?Mi.addTrackedWeather(W.weatherId):Mi.removeTrackedWeather(W.weatherId);}});return te.appendChild(ne.root),te}}],data:t,maxHeight:280,stickyHeader:true,zebra:true,compact:true,getRowId:W=>W.weatherId,onSortChange:()=>{_();},onRowClick:(W,te,ne)=>{const ie=W.weatherId;if(i){if(i===ie){O();return}O();}ne.target.closest(".weather-item-notify")||uC({entityType:"weather",entityId:W.weatherId,entityName:W.weatherName,spriteId:W.spriteId,onSave:H=>{H===null?(Ne.removeItemCustomSound("weather",W.weatherId),W.hasCustomSound=false,g(ie,false)):(Ne.setItemCustomSound("weather",W.weatherId,H),W.hasCustomSound=true,g(ie,true));}});}}),!n)throw new Error("[WeatherCard] Failed to create weather table");C(t);const M=n.root,S=W=>{const te=W.target;if(te.closest(".weather-item-notify"))return;const ie=te.closest(".lg-tr-body")?.dataset.id;!ie||!E(ie)||(W.preventDefault(),W.stopPropagation(),F(ie),P(ie));},R=W=>{if(W.pointerType==="mouse"||W.button!==0)return;const te=W.target;if(te.closest(".weather-item-notify"))return;const ie=te.closest(".lg-tr-body")?.dataset.id;!ie||!E(ie)||(A(),l=ie,d={x:W.clientX,y:W.clientY},s=window.setTimeout(()=>{s=null,l&&(c=true,F(l),P(l));},ZD));},z=W=>{if(!d||!l||c)return;const te=W.clientX-d.x,ne=W.clientY-d.y;te*te+ne*ne>Zb*Zb&&A();},j=()=>{A();},q=()=>{A();};M.addEventListener("contextmenu",S),M.addEventListener("pointerdown",R),M.addEventListener("pointermove",z),M.addEventListener("pointerup",j),M.addEventListener("pointercancel",q);const U=n.setData.bind(n);n.setData=W=>{C(W),U(W),_();},_();const ce=n.destroy.bind(n);return n.destroy=()=>{M.removeEventListener("contextmenu",S),M.removeEventListener("pointerdown",R),M.removeEventListener("pointermove",z),M.removeEventListener("pointerup",j),M.removeEventListener("pointercancel",q),A(),O(),o.clear(),ce();},n}function ev(e){return {Sunny:"☀️",Rain:"🌧️",Frost:"❄️",Dawn:"🌅",AmberMoon:"🌕"}[e]||"🌤️"}function n$(e){let t=null,n=[];const r={tableHandle:null};let o=0;function i(){n=Qb(),o=n.length;const l=x("div");r.tableHandle=t$({rows:n}),l.appendChild(r.tableHandle.root);const d=x("div",{className:"weather-card-hint"}),c=x("span",{className:"weather-card-hint-desktop"},"Click a weather to set a custom sound alert. Right-click to reset"),p=x("span",{className:"weather-card-hint-mobile"},"Tap a weather to set a custom sound alert. Long-press to reset");return d.append(c,p),l.appendChild(d),t=ft({id:"weather-card",title:"Weather events",subtitle:"Get notified when specific weather appears",expandable:true,defaultExpanded:e?.defaultExpanded??true,stateKey:"weather",variant:"soft",padding:"none",divider:false,onExpandChange:e?.onExpandChange},l),t}function a(){const l=Qb(),d=l.length;d!==o&&(o=d,n=l,r.tableHandle?.setData(l));}function s(){r.tableHandle&&(r.tableHandle.destroy(),r.tableHandle=null),t=null;}return {root:i(),refresh:a,destroy:s}}function r$(e){let t=null,n=null;function r(){const i=x("div",{className:"pet-card-body"}),a=x("div",{className:"pet-card-row"}),s=Tf({text:"Hunger alert",hint:"Notifies when active pets drop below 5% hunger",variant:"text"});return n=Xr({checked:ms.isEnabled(),onChange:l=>{ms.setEnabled(l);}}),a.appendChild(s.root),a.appendChild(n.root),i.appendChild(a),t=ft({id:"pet-hunger-card",title:"Pet events",subtitle:"Get notified about pet-related events",expandable:true,defaultExpanded:e?.defaultExpanded??true,stateKey:"pet",variant:"soft",padding:"sm",divider:false,onExpandChange:e?.onExpandChange},i),t}function o(){n&&(n.destroy(),n=null),t=null;}return {root:r(),destroy:o}}class o$ extends Tr{constructor(){super({id:"tab-alerts",label:"Alerts"});de(this,"sectionElement",null);de(this,"state",null);de(this,"settingCard",null);de(this,"shopsCard",null);de(this,"weatherCard",null);de(this,"petCard",null);}async build(n){this.state=await hD();const r=n.getRootNode();vt(r,fD,"alerts-styles");const o=this.createGrid("12px");o.id="alerts-section",this.sectionElement=o;const{MGData:i}=await Pn(async()=>{const{MGData:d}=await Promise.resolve().then(()=>Sh);return {MGData:d}},void 0),a=["plants","items","eggs","decor","weather","mutations"],s=await Promise.allSettled(a.map(d=>i.waitFor(d))),l=a.filter((d,c)=>s[c]?.status==="rejected");l.length>0&&console.warn("[AlertsSection] MGData incomplete, building with empty tables:",l.join(", ")),this.buildParts(),n.appendChild(o);}render(n){const r=this.shopsCard,o=this.weatherCard,i=this.petCard,a=this.settingCard;this.settingCard=null,this.shopsCard=null,this.weatherCard=null,this.petCard=null,super.render(n),this.shopsCard=r,this.weatherCard=o,this.petCard=i,this.settingCard=a;}buildParts(){if(!this.sectionElement||!this.state)return;const n=this.state.get();this.shopsCard=ND({defaultExpanded:n.ui.expandedCards.shops,onExpandChange:r=>this.state.setCardExpanded("shops",r)}),this.sectionElement.appendChild(this.shopsCard.root),this.petCard=r$({defaultExpanded:n.ui.expandedCards.pet,onExpandChange:r=>this.state.setCardExpanded("pet",r)}),this.sectionElement.appendChild(this.petCard.root),this.weatherCard=n$({defaultExpanded:n.ui.expandedCards.weather,onExpandChange:r=>this.state.setCardExpanded("weather",r)}),this.sectionElement.appendChild(this.weatherCard.root),this.settingCard=KD({defaultExpanded:n.ui.expandedCards.settings,onExpandChange:r=>this.state.setCardExpanded("settings",r)}),this.sectionElement.appendChild(this.settingCard.root);}async destroy(){this.settingCard&&(this.settingCard.destroy(),this.settingCard=null),this.shopsCard&&(this.shopsCard.destroy(),this.shopsCard=null),this.petCard&&(this.petCard.destroy(),this.petCard=null),this.weatherCard&&(this.weatherCard.destroy(),this.weatherCard=null),this.sectionElement=null;}}const i$={Store:{select:et.select.bind(et),set:et.set.bind(et),subscribe:et.subscribe.bind(et),subscribeImmediate:et.subscribeImmediate.bind(et)},Globals:Ge,Modules:{Version:Of,Assets:Fo,Manifest:Sr,Data:we,Environment:Wt,CustomModal:si,Sprite:ye,Tile:Er,Pixi:hd,RiveLoader:_i,Audio:Et,Cosmetic:fh,Calculators:Rx,ShopActions:mo},Features:{AutoFavorite:Ux,Journal:Bt,BulkFavorite:Up,Achievements:JL,Tracker:x5,AntiAfk:ui,Pets:w5,PetTeam:ze,XPTracker:qp,CropValueIndicator:lc,CropSizeIndicator:uc,ShopNotifier:Ro,WeatherNotifier:Mi,PetHungerNotifier:ms,AriesAPI:Yc,HarvestLocker:tn,EggLocker:Hr,DecorLocker:Ur},WebSocket:{chat:FI,emote:NI,wish:DI,kickPlayer:$I,setPlayerData:yd,usurpHost:BI,reportSpeakingStart:zI,setSelectedGame:jI,voteForGame:GI,requestGame:HI,restartGame:UI,ping:WI,checkWeatherStatus:XI,move:VI,playerPosition:wx,teleport:qI,moveInventoryItem:KI,dropObject:YI,pickupObject:JI,toggleFavoriteItem:xd,putItemInStorage:ah,retrieveItemFromStorage:sh,moveStorageItem:QI,logItems:ZI,plantSeed:eP,waterPlant:tP,harvestCrop:nP,sellAllCrops:rP,purchaseDecor:lh,purchaseEgg:ch,purchaseTool:dh,purchaseSeed:uh,plantEgg:oP,hatchEgg:iP,plantGardenPlant:aP,potPlant:sP,mutationPotion:lP,pickupDecor:cP,placeDecor:dP,removeGardenObject:uP,placePet:Cx,feedPet:pP,petPositions:fP,swapPet:Sx,storePet:kx,namePet:hP,sellPet:gP},_internal:{getGlobals:br,initGlobals:Dx,destroyGlobals:K2}};function a$(){const e=he;e.Gemini=i$,e.MGSprite=ye,e.MGData=we,e.MGPixi=hd,e.MGRiveLoader=_i,e.MGAssets=Fo,e.MGEnvironment=Wt;}const s$=`
    /* === Container === */
    .avatar-builder {
        display: flex;
        flex-direction: column;
        gap: 12px;
        width: 100%;
        font-family: inherit;
    }

    /* === Preview Area === */
    .avatar-builder-preview-area {
        position: relative;
        background: color-mix(in oklab, var(--soft) 80%, transparent);
        border: 1px solid var(--border);
        border-radius: 16px;
        overflow: visible;
        padding: 8px 20px 12px;
        cursor: grab;
        user-select: none;
        -webkit-user-select: none;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
    }

    .avatar-builder-preview-area:active {
        cursor: grabbing;
    }

    /* === Avatar Wrapper (holds preview container + arrows) === */
    .avatar-builder-avatar-wrapper {
        position: relative;
        width: 260px;
        height: 260px;
        flex-shrink: 0;
    }

    /* === Preview Container (Layers) === */
    .avatar-builder-preview-container {
        width: 260px;
        height: 260px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.15s cubic-bezier(0.4, 0, 0.2, 1),
                    opacity 0.15s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* === Avatar Layers === */
    .avatar-builder-layer {
        position: absolute;
        width: 100%;
        height: 100%;
        object-fit: contain;
        pointer-events: none;
    }

    /* === Rive Canvas === */
    .avatar-builder-rive-canvas {
        position: absolute;
        width: 100%;
        height: 100%;
        pointer-events: none;
    }

    /* === Arrow Buttons === */
    .avatar-builder-arrow {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 36px;
        height: 36px;
        border: none;
        background: color-mix(in oklab, var(--fg) 8%, transparent);
        color: var(--fg);
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.15s ease, transform 0.15s ease;
        z-index: 100;
    }

    .avatar-builder-arrow:hover {
        background: color-mix(in oklab, var(--fg) 18%, transparent);
        transform: translateY(-50%) scale(1.1);
    }

    .avatar-builder-arrow:active {
        transform: translateY(-50%) scale(0.92);
    }

    .avatar-builder-arrow-left {
        left: 4px;
    }

    .avatar-builder-arrow-right {
        right: 4px;
    }

    /* === Item Name === */
    .avatar-builder-item-name {
        margin-top: 6px;
        background: color-mix(in oklab, var(--soft) 80%, transparent);
        color: var(--fg);
        padding: 6px 12px;
        border-radius: 999px;
        font-size: 13px;
        font-weight: 600;
        white-space: nowrap;
        max-width: 80%;
        overflow: hidden;
        text-overflow: ellipsis;
        box-shadow: 0 2px 8px color-mix(in oklab, var(--shadow) 40%, transparent);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
    }

    /* === Dots Indicator === */
    .avatar-builder-dots-indicator {
        margin-top: 4px;
        margin-bottom: 4px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
    }

    .dots-text {
        font-size: 12px;
        color: color-mix(in oklab, var(--fg) 70%, transparent);
        font-weight: 500;
    }

    .dots-container {
        display: flex;
        gap: 6px;
        align-items: center;
    }

    .dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: var(--border);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .dot.active {
        background: var(--accent);
        transform: scale(1.5);
        box-shadow: 0 0 8px var(--accent);
    }

    /* === Category Row === */
    .avatar-builder-category-row {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
        width: 100%;
    }

    .avatar-builder-category-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 16px;
        background: color-mix(in oklab, var(--soft) 80%, transparent);
        border: 2px solid var(--border);
        border-radius: 20px;
        color: var(--fg);
        cursor: pointer;
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        min-height: 72px;
        position: relative;
        overflow: hidden;
    }

    .avatar-builder-category-btn::before {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(135deg, color-mix(in oklab, var(--accent) 15%, transparent), transparent);
        opacity: 0;
        transition: opacity 0.3s ease;
        border-radius: 18px;
    }

    .avatar-builder-category-btn:hover {
        background: color-mix(in oklab, var(--muted) 100%, transparent);
        transform: translateY(-2px) scale(1.02);
        box-shadow: 0 4px 16px color-mix(in oklab, var(--shadow) 40%, transparent);
        border-color: color-mix(in oklab, var(--accent) 40%, var(--border));
    }

    .avatar-builder-category-btn:hover::before {
        opacity: 1;
    }

    .avatar-builder-category-btn.active {
        background: color-mix(in oklab, var(--accent) 12%, transparent);
        border-color: var(--accent);
        box-shadow: 0 0 20px color-mix(in oklab, var(--accent) 35%, transparent),
                    0 4px 16px color-mix(in oklab, var(--shadow) 40%, transparent);
        transform: scale(1.03);
    }

    .avatar-builder-category-btn.active::before {
        opacity: 1;
    }

    .category-icon {
        width: 48px;
        height: 48px;
        object-fit: contain;
        opacity: 0.7;
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .avatar-builder-category-btn:hover .category-icon {
        opacity: 0.9;
        transform: scale(1.1);
    }

    .avatar-builder-category-btn.active .category-icon {
        opacity: 1;
        filter: drop-shadow(0 2px 6px color-mix(in oklab, var(--accent) 50%, transparent));
        transform: scale(1.12);
    }

    /* === Responsive (Mobile) === */
    @media (max-width: 640px) {
        .avatar-builder-preview-area {
            padding: 8px 14px 12px;
        }

        .avatar-builder-avatar-wrapper {
            width: 240px;
            height: 240px;
        }

        .avatar-builder-preview-container {
            width: 240px;
            height: 240px;
        }

        .avatar-builder-item-name {
            font-size: 11px;
            padding: 4px 8px;
        }

        .avatar-builder-category-row {
            grid-template-columns: repeat(2, 1fr);
        }

        .avatar-builder-category-btn {
            min-height: 64px;
            padding: 12px;
            border-radius: 16px;
        }

        .category-icon {
            width: 40px;
            height: 40px;
        }
    }

    /* === Responsive (Tablet) === */
    @media (min-width: 641px) and (max-width: 1024px) {
        .avatar-builder-avatar-wrapper,
        .avatar-builder-preview-container {
            width: 260px;
            height: 260px;
        }

        .avatar-builder-category-row {
            grid-template-columns: repeat(4, 1fr);
        }
    }

    /* === Touch-friendly === */
    @media (hover: none) and (pointer: coarse) {
        .avatar-builder-arrow {
            width: 32px;
            height: 80px;
        }

        .avatar-builder-category-btn {
            min-height: 56px;
        }
    }

    /* === Focus states (accessibility) === */
    .avatar-builder-arrow:focus-visible,
    .avatar-builder-category-btn:focus-visible {
        outline: 2px solid var(--accent);
        outline-offset: 2px;
    }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
        .avatar-builder-layer,
        .avatar-builder-arrow,
        .avatar-builder-category-btn,
        .dot {
            transition: none !important;
            animation: none !important;
        }

        .avatar-builder-preview-container {
            transition: opacity 0.15s ease !important;
        }
    }
`,l$="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEEAAAA2CAYAAACY0PQ8AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAKnSURBVHgB7ZuPddMwEMY/9zFAmAAxAWUCzASwAWGDbsDrBs0EJBMAE9SdAHeCqBOQDcQdkuu8Ngk6ubbPcn7v3VP0LCe5zyfJ+ldgBJxzC0oWh64VRWExMAVeiOCYIbsM6Rt4Rw1ahw1k7ILZkOf0IaRsNYm2Q0eSRSCn2dmS7ANax8eARajJ7sgqEqVC35DzhuzW6WVLZiQ+iSOBfwTjPfVYLEXE29jCFxBAApTQLwDD0XoZW1gkAnz9mwqL2IKi6uB8D/AH0+B1bM8hioTwpRb6sZKuU1odmDvo515SOEWEGvqpJIVTRLDQTyUpnPKeYCjZQjHUHoj8EkdCGOBo7iorCEmpDoxmEUSNIpMqgubGUfzfUkV4gF4shKSKYKGXwSLBQidJkyy5iZDUYOfWO4h7BiZJhDEmQyOxSCA1EpJ/sGcsEugigkYGbRMYC30MLoJGziKkNti5RUISZxGQmQhhNlxMbpEwuAgGmXCOBOLVfiasNZYha+GXuu2Rew30cVKEMElchiwPu+unBb4dWer+TbZ8UnbhdLI84HjpvG/bA+WvuEyxp9D/ptEt2ZpsE/Iap92/0tNdO99LLMk+oX3yx3jfiPA93BSDDVZCHxze/OpcCu5ZNSLwSnNSo5IBu8JNa7m9F7iLnGsEPMIiTGn3SS9chCnqKSy390XdvDH+wnzZNL0Dtwvc78+tfbBkH/9FQqgS15gf1zwseBxAUeaGkhXmw4rfLvnDsx0dVDX4whfkzYYEWDaZZ0PpcDHniFjtC3ASHmHx67TLB/blClKc39G+dtPnhxPufM9JjFvnJ4pOIt3bbCj5DN9wRu8iH5gKftftTeyGjS4nXwz8uJ0nLsY++VLBO/4zZRXqJc9AGbRnoN6Fz411Zf8sFNs92jNQFh35C3Y0hc/7VYYmAAAAAElFTkSuQmCC",c$="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADoAAAA/CAYAAACxdtubAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAKfSURBVHgB7ZuPdZswEMY//DqAuwGdwM4EJRPUG9TdoCM0G7QT1NkgmSB0gngDkwnKBvQ+W+LJBJCUxnnoyO89/hgL0McdJ50sZxigaZpcNgekRy3LpyzLavfgYuSEr0iTpSzb7sFsqLRYlNbMkSZ7seiVe6DXoiJyi3RFkrVoKNwDQ66bqtu6bNwPz1w34SDU5Swo9Vl0Cx0wKLVW7ROqwW0tn+3OmeuK265l8wg91OK6H7nTtWgBXSxt9O0K/QJ9HN/TVqgo58tbQB8rrlyLrqETdh6WrtANdEJPzV2hK+ilmIPrktVRqGk/l9DL2lpUs0jSBiPNbkvaYJRDOVao5oh7ZIGZMDvX1R51T/motKMNlDO7d1Q9sxNaQTnvFtWGFfoE5Vihe+hmPxehT3MRWh6Fml+cSuildJuXP9BJJYbcu0JL6KTkqhUqqkvoFHvP1aLvoCLotnfc6Qrd4fSTuBZKu3Mm1ETfX9DDjd3pm6zBYRVO1kh9eOVeDDc8h0GRVb+7H4bStJ9IO6PZicEq98DYFLlCNg9ID3rkVVfoYOJt2tUUXfimK5JkvrPEsrRqgTSgy37r+yJEKKMv5x7lmDYVTi7b2w/wjhmZE68x/eB0OySSBA2OGZ+fenYzmlPHjAJOPTmvxr70vqOWqc8TFK8b1RJsUSavmG6Hv/QViB3Anmoa561XrNAdpsmdr0CUUNNbqhBHFViuNmVjg17Z1xPq8gHxMMf7HVi2kuWaFTEdjxzP0z+WsU2YndP/iPA08RaXgt3CJowfeAE8L/D6l20F+NRl+eupxIv/aUHrU4Tn+rx/jksjN9k0w2IP/1sJ8zAPI0K3eCsGKvPwWk/aXH/XY8noucXBPSNPhdhrymFGxfHKmAfHpTb3iO64/AONOretDlUMVwAAAABJRU5ErkJggg==",d$="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEEAAAA8CAYAAAA5S9daAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAKgSURBVHgB7ZvvdYIwEMBPXr/XTtBs0I5gJ+kI7QbtCI7QTXSD4gTiBLJBmoMEA1wC+CSpF37vReEAIZfL/ckTAA9Syg/VzvL+Oar25ernyqMAob6OwIun1WpVdoWZ54I18ENQQp8SSuAH2adFCeDxCQh6FGCE8gdkf7OB6zhZg7MvixJgWAlJsPgE8FiC6v8rMEMngD1SS5bIgc2mXnDnCEqYTb3gzhGU0KeEZ+CHoISpWcILJUxNCaSzJ5WgQskaeEaHNRUmXZbAMTIYeoObjT2REb0BTtESRFfgUsIL8KUX+pfpAItjrOiVljo8noE3raV3yhIE8EfYO4sSYFFCRapKaKUA2dAJTHmydyglcM4RDK2BpkIkqxVmF/bKc8sSOK4wu7BL6u50SGEqGJoBz1wHEqAZ8K4SBKSD0xI4rjC7eDQb/8ES3nQLTWMJrRCpPCZWj6Gdo0lcQleupYqS1b0bS4i0wpxjSavL2gLC0qw829MhRmQ4Wds5hKca9KwrCIzd8QOEpxr42JaQO7ZDIfDDVkKM6rGwtmMooUoJYk4HdIhNx9V2AeH/KBZ9OlAjX0BYojvGw0jZnAj8qJQQqYQuCFlwv4C5grGE2OHRJ5ubV6OE2OHRJ5ubdSxLyKmXLyKlz40lhM4RTp5joa3hMZoleI75FDQH0XxCfuWxOWiiwx7CUniO7SEsF6WreLlRbSfnZ3DxRIZ5DXGn2sb1AEK1b1m/SzjLzUco4VfOw1HWfRvvA2WtkE9Za+1Wo7Mdcd8feRvwmXey7oNw3e/B9zC6stvqZtLrDdQ5N4ZV3J8aWYoR5+A8fYdpmBwDr8UaZG9XqT4eYAL6R1s/LGvTQmUI3XD/WX93Gz7ofvhOrXuUcCmxC2v/BJdOl3rAruIPOjGfbeyq8HcAAAAASUVORK5CYII=",u$="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABACAYAAACNx/A2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEh0lEQVR42u3cX2iVdRzH8bPV2tIJGhYzU4iCpJssUsLQpASVyqALLS0M0lC7qFTIBL0ISugmmERFKlZKClLeLIqlTU2kWOKfUmeaEzd109zcdua2s3NeQZybDu6fZ+fsOTvPG763Pz7PGx5+z++c7+8bmf32c5FsFgowGjOwAhuwDVWowWW0Ig7oRgsu4k9UYhPW4zU8ijuT62e9siVtBKZhNb5CFY7gLC7iGqKI651utOEKLuA0fkclPsEyPIjCnBeIIkzFamzBPlxADPFkJUjWwEggWeLJiuIvfI+P8ToeyDmBGIvpWIVKNCOWrITMkkAM3ajDDryBx1AaaIEoxSNYh1PoQMzQkUAnojiE5OutJHACcRfW4BSiiAsWMbSiGotREgiBKMQi7EUj4oJNN+qxG7OGTCAKcT8+wh/ollt04RDexZisCkQxZuEbROUucTTiU0xHUcYFohjP4iC6DA/asRdzUZwxgSjGfJw0/IjjBF7CiEEXiBIsxt+GN7VYhlGDJhC3YQFq5AdnsAQjB0vgbFTLL05gIe5ISyAex0/yk2rMvWWBGI8v5TcVmHyrAtehTX4Tx+coG5BAzMNpIdCElf0WiLHYLQQAjmBGfwWuQqOQVLaiqFeBuBf7hdyM81jSl8D30SykJypQfFOBGIvfhPRGA1b0JPBNXBHSF1UouZnAPcH/RVkQqMOL/xOIh1ArpD+0Y3uqwHdwVRr0eKJJgwDnOYl7/hOIAnyHG+kGzUTogGZqxKtJgcbgbLpBgyIyS3mi2J4U6ClcHw4Cs5znJEojWInraYTNSOjg59GEKRFsRHSgYUOBmrA0ggp05KvANDK1YUMER9Ad8LB95hmCTB34NoLzSIQCB0wMhyO4FvzXRRAzJVAXQWfwwwrqV0FbBLEcChy0PIkIrufIh2sQ88QjOId4pgOnc9hPY91MC4xGUIVOSEdiph4yE+sbHBI438tJJH2RAJkWmEamdOjCvggWoEUGyJrAoaEd5RGMQx0gFNh/mjE/GcB2tAFySqKhow5lyRCeQQNSCaxMQ0sHdqX+K1clIKTKEjwa8HSqwPm4JKQvurCrp9aOLegQ0hvH8URPAifhgJCeuIzVfbW3zcujjvyB0IqNGN2fDtWlqBcC0IkdmDSQHum3wk0FdGI3pgy0yfx2LMcZJOQnHdiKSbd6T2QkFuBAnnVuJXAJH+K+dG8qFWMGtuRJ73QC+7EMZYN5W3Mc1uJgjt8T7o0abMY0FGbivnABJmMbatEu94nhIvbgZZRm48p/EWZiJ+rRkmMbTQJRNOBnvIJRWR06gUKU4UmsxzE040ZAN5w4bqAV51COOZiI4qEee3I3pmEpPsNRtKILsSESGkcMXWjFcWzCcszEhKBOLhqP57EWm1GJGrQgnubYp1RSxz91I45/cBw/4Au8hxcwMbCTi3oZFTAZS1COCvyKYziLelxDG7oQ7+dop3Y04TJqcQqH8Qt24QMsxMO4I6dmZ/U9PsAEzMEKbMDX+BHVOIeraEUsZWLbVdTiKPZhJ8qxBoswFaNRkM1n+he4a3+KgaBGGQAAAABJRU5ErkJggg==",tv={expression:{label:"Expression",type:"Expression",icon:u$},top:{label:"Top",type:"Top",icon:l$},mid:{label:"Mid",type:"Mid",icon:c$},bottom:{label:"Bottom",type:"Bottom",icon:d$}},p$={expression:"Expression_Default.png",top:"Top_DefaultGray.png",mid:"Mid_DefaultGray.png",bottom:"Bottom_DefaultGray.png"};function f$(e={}){const{initialOutfit:t={},onChange:n,width:r="100%",useRiveAnimation:o=false}=e;let i={...p$,...t},a="bottom",s={expression:[],top:[],mid:[],bottom:[]},l={expression:0,top:0,mid:0,bottom:0},d,c,p,m={},b=false,g=0,w=0,_=null,C=null;const E=[],P=x("div",{className:"avatar-builder"});P.style.width=r;const O=x("style");O.textContent=s$,P.appendChild(O);const F=x("div",{className:"avatar-builder-preview-area"});P.appendChild(F);const A=x("div",{className:"avatar-builder-avatar-wrapper"});F.appendChild(A),d=x("div",{className:"avatar-builder-preview-container"}),A.appendChild(d);const T=x("button",{className:"avatar-builder-arrow avatar-builder-arrow-left",onclick:()=>W(-1)});T.innerHTML='<svg width="18" height="18" viewBox="0 0 14 14" fill="none"><path d="M9 2L4 7L9 12" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>',A.appendChild(T);const M=x("button",{className:"avatar-builder-arrow avatar-builder-arrow-right",onclick:()=>W(1)});M.innerHTML='<svg width="18" height="18" viewBox="0 0 14 14" fill="none"><path d="M5 2L10 7L5 12" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>',A.appendChild(M),d.addEventListener("mousedown",ne),d.addEventListener("touchstart",ne,{passive:true}),E.push(()=>{d.removeEventListener("mousedown",ne),d.removeEventListener("touchstart",ne);}),c=x("div",{className:"avatar-builder-item-name"},"Loading..."),F.appendChild(c),p=x("div",{className:"avatar-builder-dots-indicator"}),F.appendChild(p);const S=x("div",{className:"avatar-builder-category-row"});P.appendChild(S),Object.entries(tv).forEach(([D,B])=>{const Q=D,ae=x("button",{className:`avatar-builder-category-btn ${Q===a?"active":""}`,onclick:()=>ce(Q),title:B.label}),le=x("img",{src:B.icon,alt:B.label,className:"category-icon"});ae.appendChild(le),m[Q]=ae,S.appendChild(ae);}),R().then(()=>{z(),q(),U();});async function R(){const D=["expression","top","mid","bottom"];await Promise.all(D.map(async B=>{const Q=await tx({type:tv[B].type});s[B]=Q;const ae=i[B],le=Q.findIndex(ve=>ve.filename===ae);l[B]=le>=0?le:0;}));}function z(){if(o)_?_i.updateOutfit(_,i).catch(D=>{console.error("[AvatarBuilder] Failed to update Rive outfit:",D);}):j();else {d.innerHTML="";const D=$o();[{slot:"bottom",zIndex:1},{slot:"mid",zIndex:2},{slot:"top",zIndex:3},{slot:"expression",zIndex:4}].forEach(({slot:Q,zIndex:ae})=>{const le=i[Q];if(!le)return;const ve=le===Zy;if(le.includes("_Blank.png")||ve)return;const Be=x("img",{src:`${D}${le}`,className:`avatar-builder-layer ${Q===a?"active":""}`,style:{zIndex:String(ae)},onerror:()=>Be.style.display="none"});d.appendChild(Be);});}}async function j(){if(!(!o||_))try{d.innerHTML="",C=x("canvas",{className:"avatar-builder-rive-canvas",width:260,height:260}),d.appendChild(C),_=await _i.createInstance({canvas:C,outfit:i,autoplay:!0}),console.log("[AvatarBuilder] Rive animation initialized");}catch(D){console.error("[AvatarBuilder] Failed to initialize Rive:",D),console.warn("[AvatarBuilder] Falling back to static images"),C&&(C.remove(),C=null),_=null,z();}}function q(){const D=s[a],B=l[a];if(!D||D.length===0){c.textContent="Loading...";return}const Q=D[B];c.textContent=Q?.displayName||"Unknown";}function U(){const D=s[a],B=l[a],Q=D.length;if(Q===0){p.innerHTML="";return}p.innerHTML=`<span class="dots-text">${B+1} / ${Q}</span>`;const ae=Math.min(Q,10),le=x("div",{className:"dots-container"}),ve=Q>1?Math.round(B/(Q-1)*(ae-1)):0;for(let Ie=0;Ie<ae;Ie++){const Be=x("span",{className:`dot ${Ie===ve?"active":""}`});le.appendChild(Be);}p.appendChild(le);}function ce(D){a=D,Object.entries(m).forEach(([B,Q])=>{Q.classList.toggle("active",B===D);}),z(),q(),U();}function W(D){const B=s[a];if(!B||B.length===0)return;let Q=l[a]+D;Q<0&&(Q=B.length-1),Q>=B.length&&(Q=0),l[a]=Q;const ae=B[Q];i[a]=ae.filename,n&&n({slot:a,item:ae}),te(D>0?"left":"right"),z(),q(),U();}function te(D){const B=D==="left"?-20:20;d.style.transform=`translateX(${B}px)`,d.style.opacity="0.5",setTimeout(()=>{d.style.transform="translateX(0)",d.style.opacity="1";},150);}function ne(D){b=true,g="touches"in D?D.touches[0].clientX:D.clientX,w=0;const B=ae=>{if(!b)return;w=("touches"in ae?ae.touches[0].clientX:ae.clientX)-g,d.style.transform=`translateX(${w*.3}px)`;},Q=()=>{if(b){if(b=false,d.style.transform="translateX(0)",Math.abs(w)>50){const ae=w>0?-1:1;W(ae);}document.removeEventListener("mousemove",B),document.removeEventListener("mouseup",Q),document.removeEventListener("touchmove",B),document.removeEventListener("touchend",Q);}};document.addEventListener("mousemove",B),document.addEventListener("mouseup",Q),document.addEventListener("touchmove",B),document.addEventListener("touchend",Q);}function ie(){return {...i}}function ee(D){i={...i,...D},Object.entries(D).forEach(([B,Q])=>{const ae=B;if(!Q||!s[ae])return;const le=s[ae].findIndex(ve=>ve.filename===Q);le>=0&&(l[ae]=le);}),z(),q(),U();}function H(D){ce(D);}function K(){_&&(_.destroy(),_=null),C&&(C.remove(),C=null),E.forEach(D=>D()),E.length=0,P.remove();}return {root:P,getOutfit:ie,setOutfit:ee,setCategory:H,destroy:K}}const h$={lastSelectedSlot:"bottom",builderExpanded:true,outfitsExpanded:true,loadoutsExpanded:true};async function g$(){const e=await Kr("tab-avatar-ui",{version:1,defaults:h$}),t=[];return {get:()=>e.get(),update:n=>{e.update(n);const r=e.get();t.forEach(o=>o(r));},subscribe:n=>(t.push(n),()=>{const r=t.indexOf(n);r!==-1&&t.splice(r,1);})}}const m$=`
.outfits-loadout-empty {
    padding: 4px 0 2px;
    text-align: center;
    font-size: 13px;
    color: color-mix(in oklab, var(--fg) 50%, transparent);
}

/* Horizontal carousel (used inside builder) */
.outfits-loadout-carousel {
    display: flex;
    gap: 8px;
    overflow-x: auto;
    padding: 2px 2px 8px;
    cursor: grab;
    user-select: none;
    -webkit-user-select: none;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
}
.outfits-loadout-carousel:active {
    cursor: grabbing;
}
.outfits-loadout-carousel::-webkit-scrollbar {
    height: 6px;
}
.outfits-loadout-carousel::-webkit-scrollbar-track {
    background: transparent;
}
.outfits-loadout-carousel::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 3px;
}
.outfits-loadout-carousel::-webkit-scrollbar-thumb:hover {
    background: color-mix(in oklab, var(--border) 70%, var(--fg) 30%);
}

/* Vertical grid (used in standalone loadouts card) */
.outfits-loadout-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, 72px);
    gap: 8px;
    max-height: 232px; /* 3 rows × 72px + 2 gaps × 8px */
    overflow-y: auto;
    padding: 2px 2px 4px;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
}
.outfits-loadout-grid::-webkit-scrollbar {
    width: 6px;
}
.outfits-loadout-grid::-webkit-scrollbar-track {
    background: transparent;
}
.outfits-loadout-grid::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 3px;
}
.outfits-loadout-grid::-webkit-scrollbar-thumb:hover {
    background: color-mix(in oklab, var(--border) 70%, var(--fg) 30%);
}

.outfits-loadout-hint {
    margin-top: 8px;
    padding-top: 8px;
    border-top: 1px solid color-mix(in oklab, var(--border) 50%, transparent);
    font-size: 11px;
    color: color-mix(in oklab, var(--fg) 40%, transparent);
    text-align: center;
    line-height: 1.6;
}
.outfits-loadout-hint__mobile {
    display: none;
}
@media (hover: none) and (pointer: coarse) {
    .outfits-loadout-hint__desktop {
        display: none;
    }
    .outfits-loadout-hint__mobile {
        display: block;
    }
}

.outfits-loadout-card {
    position: relative;
    flex-shrink: 0;
    width: 72px;
    height: 72px;
    border-radius: 10px;
    background: color-mix(in oklab, var(--soft) 80%, transparent);
    border: 2px solid transparent;
    cursor: pointer;
    transition: border-color 0.15s ease, background 0.15s ease;
    overflow: hidden;
}
.outfits-loadout-card:hover {
    border-color: color-mix(in oklab, var(--accent) 40%, transparent);
    background: color-mix(in oklab, var(--muted) 100%, transparent);
}
.outfits-loadout-card:active {
    opacity: 0.7;
}

.outfits-loadout-preview {
    position: relative;
    width: 100%;
    height: 100%;
    pointer-events: none;
}
.outfits-loadout-layer {
    position: absolute;
    width: 100%;
    height: 100%;
    object-fit: contain;
}
`,b$=500,nv=10,v$=800;function fC(e={}){const{onApply:t,layout:n="carousel"}=e;let r=null;function o(){if(!r)return;r.innerHTML="";const c=_o.get();if(c.length===0){r.appendChild(x("div",{className:"outfits-loadout-empty"},"No saved outfits yet."));return}const p=$o();if(n==="grid"){const m=x("div",{className:"outfits-loadout-grid"});c.forEach(b=>{m.appendChild(i(b,p));}),r.appendChild(m);}else {const m=x("div",{className:"outfits-loadout-carousel"});c.forEach(b=>{m.appendChild(i(b,p));}),a(m),r.appendChild(m);}}function i(c,p){const m=x("div",{className:"outfits-loadout-card"});let b=false,g=null;const w=()=>{b=true,g&&clearTimeout(g),g=setTimeout(()=>{b=false;},v$),_o.delete(c.id);};m.addEventListener("click",()=>{b||(t?t(c):Ex.set({top:c.top,mid:c.mid,bottom:c.bottom,expression:c.expression}));}),m.addEventListener("contextmenu",A=>{A.preventDefault(),A.stopPropagation(),w();});let _=null,C=null,E=false;const P=()=>{_&&(clearTimeout(_),_=null),C=null,E=false;};m.addEventListener("pointerdown",A=>{A.pointerType!=="mouse"&&A.button===0&&(P(),C={x:A.clientX,y:A.clientY},_=setTimeout(()=>{_=null,C&&(E=true,w());},b$));}),m.addEventListener("pointermove",A=>{if(!C||E)return;const T=A.clientX-C.x,M=A.clientY-C.y;T*T+M*M>nv*nv&&P();}),m.addEventListener("pointerup",P),m.addEventListener("pointercancel",P);const O=x("div",{className:"outfits-loadout-preview"});return [c.bottom,c.mid,c.top,c.expression].forEach((A,T)=>{if(!A||A.includes("_Blank"))return;const M=x("img",{className:"outfits-loadout-layer",style:{zIndex:String(T+1)}});M.src=`${p}${A}`,M.onerror=()=>M.remove(),O.appendChild(M);}),m.appendChild(O),m}function a(c){let p=false,m=0,b=0;const g=C=>{p=true,m=("touches"in C?C.touches[0].clientX:C.clientX)-c.offsetLeft,b=c.scrollLeft;},w=C=>{if(!p)return;C.preventDefault();const E=("touches"in C?C.touches[0].clientX:C.clientX)-c.offsetLeft;c.scrollLeft=b-(E-m);},_=()=>{p=false;};c.addEventListener("mousedown",g),c.addEventListener("touchstart",g,{passive:true}),c.addEventListener("mousemove",w),c.addEventListener("touchmove",w,{passive:false}),c.addEventListener("mouseup",_),c.addEventListener("mouseleave",_),c.addEventListener("touchend",_);}const s=x("style");s.textContent=m$,r=x("div"),o();const l=x("div");l.appendChild(s),l.appendChild(r);const d=_o.subscribe(()=>o());return {root:l,destroy(){d(),r=null;}}}function y$(e={}){const{title:t="Outfits",defaultExpanded:n=true,onExpandChange:r,onApply:o,layout:i,showHint:a=false}=e,s=fC({onApply:o,layout:i}),l=ft({title:t,variant:"soft",expandable:true,defaultExpanded:n,onExpandChange:r}),d=l.querySelector(".card-body");if(d&&(d.appendChild(s.root),a)){const c=x("div",{className:"outfits-loadout-hint"});c.innerHTML=`
                <span class="outfits-loadout-hint__desktop">Click to apply · Right-click to delete</span>
                <span class="outfits-loadout-hint__mobile">Tap to apply · Hold to delete</span>
            `,d.appendChild(c);}return {root:l,destroy:()=>s.destroy()}}const x$=`
    .avatar-outfits-divider {
        margin: 10px 0 8px;
        border: none;
        border-top: 1px solid var(--border);
    }

    .avatar-save-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        width: 100%;
        padding: 10px 16px;
        border-radius: 10px;
        border: 1px solid color-mix(in oklab, var(--accent) 30%, transparent);
        background: color-mix(in oklab, var(--accent) 10%, transparent);
        color: var(--accent);
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.15s ease, border-color 0.15s ease;
        margin: 10px 0 0;
    }
    .avatar-save-btn:hover {
        background: color-mix(in oklab, var(--accent) 18%, transparent);
        border-color: color-mix(in oklab, var(--accent) 50%, transparent);
    }
    .avatar-save-btn:active {
        background: color-mix(in oklab, var(--accent) 26%, transparent);
    }
`;class w$ extends Tr{constructor(){super({id:"tab-avatar",label:"Avatar"});de(this,"avatarBuilder",null);de(this,"uiState",null);}async build(n){_o.init(),this.uiState=await g$();const r=await gd().catch(()=>({top:"Top_DefaultGray.png",mid:"Mid_DefaultGray.png",bottom:"Bottom_DefaultGray.png",expression:"Expression_Default.png",color:"Red"})),o={top:r.top,mid:r.mid,bottom:r.bottom,expression:r.expression},i=this.createContainer("avatar-section");n.appendChild(i);const a=x("style");a.textContent=x$,i.appendChild(a);const s=ft({title:"Avatar editor",variant:"glass",expandable:true,defaultExpanded:this.uiState.get().builderExpanded,onExpandChange:c=>{this.uiState?.update({builderExpanded:c});}});this.avatarBuilder=f$({initialOutfit:o,useRiveAnimation:true});const l=s.querySelector(".card-body");if(l){l.appendChild(this.avatarBuilder.root);const c=x("button",{className:"avatar-save-btn"});c.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg> Save this outfit',c.addEventListener("click",()=>this.handleSave()),l.appendChild(c),l.appendChild(x("hr",{className:"avatar-outfits-divider"}));const p=fC({onApply:m=>this.avatarBuilder?.setOutfit(m)});l.appendChild(p.root),this.addCleanup(()=>p.destroy());}i.appendChild(s);const d=y$({title:"Outfits loadout",defaultExpanded:this.uiState.get().loadoutsExpanded,onExpandChange:c=>{this.uiState?.update({loadoutsExpanded:c});},layout:"grid",showHint:true});d.root.style.marginTop="12px",i.appendChild(d.root),this.addCleanup(()=>d.destroy());}async handleSave(){if(!this.avatarBuilder)return;const n=this.avatarBuilder.getOutfit(),o=`Outfit ${_o.get().length+1}`;await _o.save(o,n);}async destroy(){this.avatarBuilder&&(this.avatarBuilder.destroy(),this.avatarBuilder=null),super.destroy();}}const gf={ui:{expandedCards:{public:true}}};async function C$(){const e=await Kr("tab-room",{version:1,defaults:gf,sanitize:o=>({ui:{expandedCards:Ci(gf.ui.expandedCards,o.ui?.expandedCards)}})});function t(o){const i=e.get();e.update({ui:{...i.ui,...o,expandedCards:Ci(i.ui.expandedCards,o.expandedCards)}});}function n(o,i){const a=e.get();e.update({ui:{...a.ui,expandedCards:{...a.ui.expandedCards,[o]:!!i}}});}function r(o){const i=e.get();n(o,!i.ui.expandedCards[o]);}return {get:e.get,set:e.set,save:e.save,setUI:t,setCardExpanded:n,toggleCard:r}}const S$=`
/* Container */
.rooms-list {
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

/* Header Bar (Filter + Refresh) */
.rooms-list__header-bar {
  display: flex;
  align-items: center;
  gap: 12px;
  padding-bottom: 8px;
}

.rooms-list__header-bar > * {
  flex: 1;
  min-width: 0;
}

/* Scrollable Container (max 4 items visible) */
.rooms-list__container {
  display: flex;
  flex-direction: column;
  gap: 10px;
  max-height: 360px;
  overflow-y: auto;
  overflow-x: hidden;
  padding-right: 4px;
  position: relative;
}

/* Loading Overlay */
.rooms-list__loading-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: color-mix(in srgb, var(--bg) 80%, transparent);
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
  border-radius: 6px;
  z-index: 10;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.rooms-list__loading-overlay svg {
  color: var(--accent);
  filter: drop-shadow(0 2px 4px color-mix(in srgb, var(--shadow) 20%, transparent));
}

/* Custom scrollbar */
.rooms-list__container::-webkit-scrollbar {
  width: 6px;
}

.rooms-list__container::-webkit-scrollbar-track {
  background: color-mix(in srgb, var(--muted) 20%, transparent);
  border-radius: 3px;
}

.rooms-list__container::-webkit-scrollbar-thumb {
  background: var(--accent);
  border-radius: 3px;
  opacity: 0.7;
}

.rooms-list__container::-webkit-scrollbar-thumb:hover {
  background: var(--accent);
  opacity: 1;
}

/* Room Item (Compact Vertical Layout) */
.rooms-list__item {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 12px 14px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  transition: all 0.2s ease;
}

.rooms-list__item:hover {
  border-color: var(--accent);
  box-shadow: 0 2px 6px color-mix(in srgb, var(--shadow) 15%, transparent);
}

/* Top Row (Badge + ID + Copy) */
.rooms-list__top-row {
  display: flex;
  align-items: center;
  gap: 10px;
}

/* Platform Badge (uses theme accent color) */
.rooms-list__badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 3px 8px;
  border-radius: 4px;
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.3px;
  border: 1px solid;
  flex-shrink: 0;
  background: color-mix(in srgb, var(--accent) 15%, transparent);
  color: var(--accent);
  border-color: color-mix(in srgb, var(--accent) 30%, transparent);
}

/* Room ID */
.rooms-list__id {
  font-family: 'Courier New', monospace;
  font-size: 12px;
  color: var(--fg);
  opacity: 0.75;
  font-weight: 500;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  flex: 1;
  min-width: 0;
}

.rooms-list__copy-btn {
  background: transparent;
  border: none;
  padding: 6px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 4px;
  transition: all 0.15s ease;
  color: var(--fg);
  opacity: 0.6;
  flex-shrink: 0;
}

.rooms-list__copy-btn:hover {
  background: color-mix(in srgb, var(--accent) 15%, transparent);
  color: var(--accent);
  opacity: 1;
}

.rooms-list__copy-btn:active {
  transform: scale(0.9);
}

/* Bottom Row (Avatars + Count + Join) */
.rooms-list__bottom-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}

/* Left section (Avatars + Count) */
.rooms-list__bottom-left {
  display: flex;
  align-items: center;
  gap: 10px;
}

/* Avatars */
.rooms-list__avatars {
  display: flex;
  gap: 4px;
  align-items: center;
}

.rooms-list__avatar {
  width: 26px;
  height: 26px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 11px;
  transition: all 0.2s ease;
  flex-shrink: 0;
  overflow: hidden;
}

.rooms-list__avatar--filled {
  background: linear-gradient(135deg,
    color-mix(in srgb, var(--accent) 40%, transparent),
    color-mix(in srgb, var(--accent) 20%, transparent)
  );
  border: 1.5px solid var(--accent);
  color: var(--fg);
}

.rooms-list__avatar--empty {
  background: color-mix(in srgb, var(--shadow) 25%, transparent);
  border: 1.5px dashed color-mix(in srgb, var(--border) 50%, transparent);
  opacity: 0.4;
}

/* Player Count (Next to Avatars) */
.rooms-list__count {
  font-size: 13px;
  font-weight: 600;
  color: var(--fg);
  opacity: 0.8;
  white-space: nowrap;
  flex-shrink: 0;
}

/* Empty State */
.rooms-list__empty {
  padding: 24px 16px;
  text-align: center;
  color: var(--fg);
  opacity: 0.6;
  font-size: 13px;
  font-style: italic;
}

/* Footer (Powered by Aries + Timestamp) */
.rooms-list__footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 4px 0 4px;
  gap: 12px;
}

.rooms-list__aries-badge {
  font-size: 10px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--accent);
  opacity: 0.7;
  white-space: nowrap;
}

.rooms-list__timestamp {
  font-size: 11px;
  color: var(--fg);
  opacity: 0.6;
  font-style: italic;
  white-space: nowrap;
}

/* Responsive */
@media (max-width: 640px) {
  .rooms-list__item {
    padding: 10px 12px;
    gap: 8px;
  }

  .rooms-list__badge {
    font-size: 9px;
    padding: 2px 8px;
    min-width: 60px;
  }

  .rooms-list__id {
    font-size: 11px;
  }

  .rooms-list__avatar {
    width: 24px;
    height: 24px;
    font-size: 11px;
  }

  .rooms-list__count {
    font-size: 12px;
  }

  .rooms-list__container {
    max-height: 260px;
  }
}

/* Touch Targets */
.rooms-list__copy-btn {
  min-height: 32px;
  min-width: 32px;
}

@media (hover: hover) {
  .rooms-list__avatar--filled:hover {
    transform: scale(1.15);
    box-shadow: 0 2px 6px color-mix(in srgb, var(--accent) 35%, transparent);
  }
}
`;function k$(e){return /^I-\d+-GC-\d+-\d+$/.test(e)?"discord":"web"}function _$(e){const t=x("span",{className:`rooms-list__badge rooms-list__badge--${e}`});return t.textContent=e==="discord"?"Discord":"Web",t}function A$(e,t=16){return e.length<=t?e:`${e.slice(0,t)}...`}function E$(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");return e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("width","14"),e.setAttribute("height","14"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.innerHTML=`
    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
  `,e}function T$(e,t){const n=t==="all"?e:e.filter(r=>r.playerCount<r.maxPlayers);switch(t){case "5-6":return n.filter(r=>r.playerCount>=5);case "4":return n.filter(r=>r.playerCount===4);case "1-3":return n.filter(r=>r.playerCount>=1&&r.playerCount<=3);default:return n}}function I$(e){const t=l=>l.toString().padStart(2,"0"),n=t(e.getHours()),r=t(e.getMinutes()),o=t(e.getSeconds()),i=t(e.getDate()),a=t(e.getMonth()+1),s=e.getFullYear();return `${i}/${a}/${s} ${n}:${r}:${o}`}function P$(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");return e.setAttribute("viewBox","0 0 50 50"),e.setAttribute("width","50"),e.setAttribute("height","50"),e.innerHTML=`
    <circle cx="25" cy="25" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-dasharray="31.4 31.4">
      <animateTransform attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="1s" repeatCount="indefinite"/>
    </circle>
  `,e}function M$(e={}){const{rooms:t=[],onJoinRoom:n,onCopyRoomId:r,onRefresh:o,emptyMessage:i="No rooms available",joinEnabled:a=false,initialFilter:s="5-6",onFilterChange:l}=e;let d=s,c=t;const p=x("div",{className:"rooms-list"}),m=x("style");m.textContent=S$,p.appendChild(m);const b=x("div",{className:"rooms-list__header-bar"}),w=Io({options:[{value:"5-6",label:"5-6 players"},{value:"4",label:"4 players"},{value:"1-3",label:"1-3 players"},{value:"all",label:"All"}],value:s,onChange:q=>{d=q,l?.(d),z(c);}});b.appendChild(w.root);const _=kt({label:"Refresh rooms",variant:"default",size:"sm",iconLeft:"",onClick:()=>{o?.();}});b.appendChild(_),p.appendChild(b);const C=x("div",{style:"position: relative;"}),E=x("div",{className:"rooms-list__container"});C.appendChild(E);const P=x("div",{className:"rooms-list__loading-overlay"});P.style.display="none";const O=P$();P.appendChild(O),C.appendChild(P),p.appendChild(C);const F=x("div",{className:"rooms-list__footer"}),A=x("div",{className:"rooms-list__aries-badge"});A.textContent="Powered by Aries",F.appendChild(A);const T=x("div",{className:"rooms-list__timestamp"});T.style.display="none",F.appendChild(T),p.appendChild(F);const M=[w,{remove:()=>_.remove()}],S=[];function R(q){const U=k$(q.id),ce=x("div",{className:"rooms-list__item"}),W=x("div",{className:"rooms-list__top-row"}),te=_$(U);W.appendChild(te);const ne=x("span",{className:"rooms-list__id"});ne.textContent=A$(q.id,20),ne.title=q.id,W.appendChild(ne);const ie=E$(),ee=x("button",{className:"rooms-list__copy-btn"});ee.type="button",ee.title="Copy room ID",ee.appendChild(ie),ee.addEventListener("click",le=>{le.stopPropagation(),r?.(q.id);}),W.appendChild(ee),ce.appendChild(W);const H=x("div",{className:"rooms-list__bottom-row"}),K=x("div",{className:"rooms-list__bottom-left"}),D=x("div",{className:"rooms-list__avatars"});for(let le=0;le<q.maxPlayers;le++){const ve=x("div",{className:`rooms-list__avatar ${le<q.playerCount?"rooms-list__avatar--filled":"rooms-list__avatar--empty"}`});if(q.playerAvatars&&q.playerAvatars[le]){const Ie=q.playerAvatars[le];if(Ie.avatarUrl){const Be=x("img",{src:Ie.avatarUrl,alt:Ie.name});Be.style.width="100%",Be.style.height="100%",Be.style.objectFit="cover",ve.appendChild(Be);}else ve.textContent="👤";ve.title=Ie.name;}else le<q.playerCount&&(ve.textContent="👤");D.appendChild(ve);}K.appendChild(D);const B=x("span",{className:"rooms-list__count"});B.textContent=`${q.playerCount}/${q.maxPlayers}`,K.appendChild(B),H.appendChild(K);const Q=q.playerCount>=q.maxPlayers,ae=kt({label:"Join",variant:"primary",size:"sm",disabled:!a||Q,onClick:()=>{n?.(q.id);}});return S.push(ae),H.appendChild(ae),ce.appendChild(H),ce}function z(q){E.innerHTML="",S.forEach(ce=>{ce.destroy?ce.destroy():ce.remove&&ce.remove();}),S.length=0;const U=T$(q,d);if(U.length===0){const ce=x("div",{className:"rooms-list__empty"});ce.textContent=i,E.appendChild(ce);}else U.forEach(ce=>{const W=R(ce);E.appendChild(W);});}return z(t),{root:p,setRooms(q){c=q,z(q);},setFilter(q){d=q,w.setValue(q),z(c);},setLastUpdated(q){T.textContent=I$(q),T.style.display="block";},setLoading(q){q?(P.style.display="flex",P.style.opacity="0",P.offsetWidth,P.style.opacity="1"):(P.style.opacity="0",setTimeout(()=>{P.style.display="none";},300));},destroy(){S.forEach(q=>{q.destroy?q.destroy():q.remove&&q.remove();}),S.length=0,M.forEach(q=>{q.destroy?q.destroy():q.remove&&q.remove();}),M.length=0,p.remove();}}}async function L$(e){const{state:t,defaultExpanded:n=true,onExpandChange:r}=e;let o=null,i=false;const a=!Wt.isDiscord(),s=Wt.isDiscord(),d=Wt.detect().origin;async function c(){try{return (await Yc.fetchRooms(1e3)).map(w=>({id:w.id,playerCount:w.playersCount,maxPlayers:6,playerAvatars:w.userSlots?.map(_=>({name:_.name,avatarUrl:_.avatarUrl}))}))}catch(g){return console.error("[Room] Failed to fetch rooms:",g),[]}}async function p(){if(!(i||!o)){i=true,o.setLoading(true);try{const g=await c(),w=new Date;o.setRooms(g),o.setLastUpdated(w),console.log(`[Room] Fetched ${g.length} rooms from Aries API`);}catch(g){console.error("[Room] Failed to refresh rooms:",g);}finally{i=false,o.setLoading(false);}}}const m=x("div",{style:"display: flex; flex-direction: column; gap: 12px;"});o=M$({rooms:[],joinEnabled:a,onJoinRoom:g=>{const w=`${d}/r/${g}`;window.open(w,"_blank"),console.log(`[Room] Opening room: ${w}`);},onCopyRoomId:g=>{navigator.clipboard.writeText(g).then(()=>{console.log(`[Room] Room ID copied to clipboard: ${g}`);}).catch(w=>{console.error("[Room] Failed to copy room ID:",w);});},onRefresh:()=>{p();},emptyMessage:"No public rooms available",initialFilter:"5-6"}),m.appendChild(o.root);const b=ft({title:"Public",subtitle:s?"List of available public rooms (view only on Discord)":"List of available public rooms",padding:"lg",expandable:true,defaultExpanded:n,onExpandChange:g=>{r?.(g),t.setCardExpanded("public",g),g&&!i&&p();}},m);return n&&p(),{root:b,destroy(){o&&(o.destroy(),o=null);}}}class R$ extends Tr{constructor(n){super({id:"tab-room",label:"Room"});de(this,"publicCardHandle",null);this.deps=n;}destroy(){this.publicCardHandle&&(this.publicCardHandle.destroy(),this.publicCardHandle=null);}async build(n){const r=this.createGrid("12px");r.id="room",n.appendChild(r);let o;try{o=await C$();}catch{o={get:()=>gf,set:()=>{},save:()=>{},setUI:()=>{},setCardExpanded:()=>{},toggleCard:()=>{}};}const i=o.get();this.publicCardHandle=await L$({state:o,defaultExpanded:!!i.ui.expandedCards.public}),r.appendChild(this.publicCardHandle.root);}}const O$=10,F$=16;function N$(e){const{selectedSpecies:t,onChange:n,placeholder:r="Search plants...",speciesRuleCount:o={},onSearchChange:i}=e;let a=t??null,s=[],l=[];const d=[],c=new Map;let p=null;const m=x("div",{className:"plant-selector"}),b=vs({placeholder:r,blockGameKeys:true,withClear:true,debounceMs:150,onChange:S=>P(S)});m.appendChild(b.root),d.push(()=>{const S=b.root.__cleanup;S&&S();});const g=x("div",{className:"plant-selector__grid"});m.appendChild(g),d.push(()=>{p!==null&&(cancelAnimationFrame(p),p=null),c.clear();});function w(S,R){if(ye.isReady())try{const z=ye.toCanvas(S,{boundsMode:"padded"});z&&(z.style.maxWidth="40px",z.style.maxHeight="40px",z.style.width="auto",z.style.height="auto",z.style.display="block",R.replaceChildren(z));}catch(z){console.warn("[PlantSelector] Failed to load sprite:",z);}}function _(){if(c.size===0){p=null;return}const S=[],R=c.entries();for(let z=0;z<O$;z++){const j=R.next();if(j.done)break;S.push(j.value);}for(const[z,j]of S)w(j,z),c.delete(z);c.size>0?p=requestAnimationFrame(()=>{setTimeout(_,F$);}):p=null;}function C(){p===null&&(p=requestAnimationFrame(()=>{_();}));}function E(){try{const S=we.get("plants");if(!S){console.warn("[PlantSelector] No plants data available");return}s=Object.entries(S).filter(([,R])=>R&&typeof R=="object"&&"crop"in R).map(([R,z])=>({name:R,spriteId:z.crop?.spriteId||null})),l=[...s],O();}catch(S){console.error("[PlantSelector] Failed to load plants:",S);}}function P(S){if(!S.trim())l=[...s];else {const R=S.toLowerCase();l=s.filter(z=>z.name.toLowerCase().includes(R));}i?.(S),O();}function O(){const S=g.scrollTop;if(p!==null&&(cancelAnimationFrame(p),p=null),c.clear(),g.replaceChildren(),l.length===0){const z=x("div",{className:"plant-selector__empty"},"No plants found");g.appendChild(z);return}const R=document.createDocumentFragment();l.forEach(z=>{const j=F(z);R.appendChild(j);}),g.appendChild(R),g.scrollTop=S,c.size>0&&C();}function F(S){const R=o[S.name]??0,z=x("div",{className:`plant-selector__item ${a===S.name?"plant-selector__item--selected":""}`});if(R>0){const ce=x("div",{className:"plant-selector__badge"},String(R));z.appendChild(ce);}z.addEventListener("click",()=>{a=S.name,n(S.name),O();});const j=x("div",{className:"plant-selector__sprite"}),q=x("div",{style:"width: 40px; height: 40px; background: color-mix(in oklab, var(--fg) 8%, transparent); border-radius: 4px;"});j.appendChild(q),S.spriteId&&ye.isReady()&&c.set(j,S.spriteId),z.appendChild(j);const U=x("div",{className:"plant-selector__name"},S.name);return z.appendChild(U),z}E();function A(){return a}function T(S){a=S,O();}function M(){d.forEach(S=>S()),d.length=0;}return {root:m,getSelected:A,setSelected:T,destroy:M}}function Ud(e,t,n){const{size:r,mutations:o}=n;if(!ye.isReady()){t.appendChild(Ea(r));return}try{const s=we.get("plants")?.[e]?.crop?.spriteId;if(!s){t.appendChild(Ea(r));return}const l=ye.toCanvas(s,{mutations:o&&o.length>0?o:void 0,boundsMode:"padded"});l?(hC(l,r),t.appendChild(l)):t.appendChild(Ea(r));}catch(i){console.warn(`[SpriteRenderer] Failed to render plant sprite for ${e}:`,i),t.appendChild(Ea(r));}}function D$(e,t,n){if(!ye.isReady()){t.appendChild(Nl(e,n));return}try{const i=we.get("mutations")?.[e]?.spriteId;if(!i){t.appendChild(Nl(e,n));return}const a=ye.toCanvas(i,{boundsMode:"padded"});a?(hC(a,n),t.appendChild(a)):t.appendChild(Nl(e,n));}catch(r){console.warn(`[SpriteRenderer] Failed to render mutation sprite for ${e}:`,r),t.appendChild(Nl(e,n));}}function Ea(e){return x("div",{style:`
            width: ${e}px;
            height: ${e}px;
            background: color-mix(in oklab, var(--accent) 20%, transparent);
            border-radius: 4px;
        `})}function $$(e){return x("div",{style:`
            width: ${e}px;
            height: ${e}px;
            background: linear-gradient(135deg, color-mix(in oklab, var(--fg) 8%, transparent) 0%, color-mix(in oklab, var(--fg) 15%, transparent) 100%);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: ${Math.round(e*.56)}px;
            font-weight: 300;
            color: color-mix(in oklab, var(--fg) 40%, transparent);
        `},"—")}function Nl(e,t){return e==="Gold"?x("div",{style:`
                width: ${t}px;
                height: ${t}px;
                background: #FFD700;
                border-radius: 4px;
            `}):e==="Rainbow"?x("div",{style:`
                width: ${t}px;
                height: ${t}px;
                background: linear-gradient(135deg, #ff0000 0%, #ff7700 16%, #ffff00 33%, #00ff00 50%, #0099ff 66%, #9966ff 83%, #ff0088 100%);
                border-radius: 4px;
            `}):Ea(t)}function hC(e,t){e.style.maxWidth=`${t}px`,e.style.maxHeight=`${t}px`,e.style.width="auto",e.style.height="auto",e.style.display="block";}const Br=["none","Gold","Rainbow"],nd={wet:["Wet","Chilled","Frozen"],lunar:["Dawnlit","Ambershine","Dawncharged","Ambercharged"]};function gC(){if(!ye.isReady())return console.warn("[MutationData] MGSprite not ready yet"),[];try{return ye.getMutationNames().filter(t=>t!=="Gold"&&t!=="Rainbow")}catch(e){return console.error("[MutationData] Failed to get mutation names:",e),[]}}function mC(e){if(e==="none")return "Normal";try{return we.get("mutations")?.[e]?.name||e}catch{return e}}function B$(e){return e.map(t=>t==="none"?"none":mC(t).toLowerCase()).join(", ")}function z$(){return gC()}function Ko(e){const n=z$().indexOf(e);return n===-1?1/0:n}function mf(e){return nd.wet.includes(e)}function bf(e){return nd.lunar.includes(e)}function j$(e){const t=e.filter(o=>mf(o)),n=e.filter(o=>bf(o)),r=[];return t.length>0&&r.push(t[0]),n.length>0&&r.length<2&&r.push(n[0]),r}function Dl(e){const t=[e.mode];if(e.sizeCondition?.enabled&&t.push(`size:${e.sizeCondition.minPercentage}`),e.mutationCondition?.enabled){const n=[...e.mutationCondition.mutations].sort();t.push(`mut:${e.mutationCondition.matchMode}:${n.join(",")}`);}return t.join("|")}const G$=32;function bC(e){const{mutationId:t,isSelected:n,onToggle:r,size:o=G$}=e;let i=n,a=false;const s=x("div",{style:`
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.15s ease;
        `});p(),s.addEventListener("click",r),s.addEventListener("mouseenter",()=>{!i&&!a&&(s.style.background="color-mix(in oklab, var(--fg) 10%, transparent)");}),s.addEventListener("mouseleave",()=>{!i&&!a&&(s.style.background="color-mix(in oklab, var(--fg) 5%, transparent)");});const l=x("div",{style:"display: flex; align-items: center; justify-content: center;"});t==="none"?l.appendChild($$(o)):D$(t,l,o),s.appendChild(l);const d=e.label??mC(t),c=x("div",{style:`
            font-size: 10px;
            color: var(--fg);
            text-align: center;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        `},d);s.appendChild(c);function p(){i?(s.style.background="color-mix(in oklab, var(--accent) 20%, transparent)",s.style.border="1px solid var(--accent)"):(s.style.background="color-mix(in oklab, var(--fg) 5%, transparent)",s.style.border="1px solid color-mix(in oklab, var(--fg) 10%, transparent)");}function m(g){i=g,p();}function b(g){a=g,s.style.opacity=a?"0.35":"1",s.style.pointerEvents=a?"none":"",s.style.cursor=a?"default":"pointer";}return {root:s,setSelected:m,setDisabled:b}}function H$(e){const{enabled:t,percentage:n,sizeMode:r,ruleMode:o,onEnabledChange:i,onPercentageChange:a,onSizeModeChange:s,expanded:l=false,onExpandChange:d}=e;let c=t,p=n,m=r,b=o,g=null,w=null,_=null;const C=x("div",{style:"display: flex; flex-direction: column; gap: 12px;"}),E=x("div",{style:`
            font-size: 10px;
            font-weight: 600;
            color: var(--accent);
            background: color-mix(in oklab, var(--accent) 12%, transparent);
            border: 1px solid color-mix(in oklab, var(--accent) 30%, transparent);
            border-radius: 10px;
            padding: 1px 6px;
            display: none;
        `},"Enabled");O();const P=ft({title:"Size",subtitle:"Growth size threshold",actions:[E],variant:"soft",padding:"md",expandable:true,defaultExpanded:l,onExpandChange:d},C);function O(){C.replaceChildren(),E.style.display=c?"":"none";const M=x("div",{style:"display: flex; align-items: center; gap: 12px;"}),S=zd({checked:c,label:"Enable",size:"md",onChange:W=>{c=W,i(W),O();}});M.appendChild(S.root),c&&(g=x("div",{style:"font-size: 12px; color: color-mix(in oklab, var(--fg) 70%, transparent); line-height: 1.4;"},F()),M.appendChild(g)),C.appendChild(M);const R=x("div",{style:c?"":"opacity: 0.4; pointer-events: none; transition: opacity 0.2s ease;"}),z=x("div",{style:"display: flex; justify-content: center;"}),j=jo({segments:[{id:"min",label:"Minimum"},{id:"max",label:"Maximum"}],selected:m,onChange:W=>{m=W,s(m),O();}});z.appendChild(j),R.appendChild(z),_=x("div",{style:"display: flex; flex-direction: column; gap: 4px;"});const q=x("div",{style:"display: flex; justify-content: space-between; align-items: center;"}),U=x("div",{style:"font-size: 12px; color: var(--fg); font-weight: 500;"},"Size Threshold");w=x("span",{style:"font-size: 12px; font-weight: 600; color: var(--accent);"},`${p}%`),q.appendChild(U),q.appendChild(w),_.appendChild(q);const ce=lg({min:50,max:100,step:1,value:p,showValue:false,onInput:W=>{p=W,w&&(w.textContent=`${W}%`),g&&(g.textContent=F());},onChange:W=>{p=W,a(W);}});_.appendChild(ce.root),R.appendChild(_),C.appendChild(R);}function F(){const M=m==="min"?"at most":"at least";return b==="lock"?`Lock plants ${M} ${p}% grown`:`Allow plants ${M} ${p}% grown`}function A(M){b=M,g&&(g.textContent=F());}function T(){g=null,w=null,_=null;}return {root:P,setRuleMode:A,destroy:T}}function U$(e){const{enabled:t,selected:n,ruleMode:r,onEnabledChange:o,onSelectionChange:i,expanded:a=false,onExpandChange:s}=e;let l=t,d=[...n],c=r,p=null;const m=[],b=x("div",{style:"display: flex; flex-direction: column; gap: 12px;"}),g=x("div",{style:`
            font-size: 10px;
            font-weight: 600;
            color: var(--accent);
            background: color-mix(in oklab, var(--accent) 12%, transparent);
            border: 1px solid color-mix(in oklab, var(--accent) 30%, transparent);
            border-radius: 10px;
            padding: 1px 6px;
            display: none;
        `},"Enabled");_();const w=ft({title:"Color Mutation",subtitle:"Gold / Rainbow color variants",actions:[g],variant:"soft",padding:"md",expandable:true,defaultExpanded:a,onExpandChange:s},b);function _(){b.replaceChildren(),m.length=0,g.style.display=l?"":"none";const M=x("div",{style:"display: flex; align-items: center; gap: 12px;"}),S=zd({checked:l,label:"Enable",size:"md",onChange:j=>{l=j,o(j),_();}});M.appendChild(S.root),l&&(p=x("div",{style:"font-size: 12px; color: color-mix(in oklab, var(--fg) 70%, transparent); line-height: 1.4;"},O()),M.appendChild(p)),b.appendChild(M);const R=x("div",{style:l?"":"opacity: 0.4; pointer-events: none; transition: opacity 0.2s ease;"}),z=x("div",{style:`
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
                gap: 8px;
            `});Br.forEach(j=>{const q=d.includes(j),U=bC({mutationId:j,isSelected:q,onToggle:()=>C(j)});m.push(U),z.appendChild(U.root);}),R.appendChild(z),b.appendChild(R);}function C(M){if(d.includes(M)){const R=d.filter(z=>z!==M);if(R.length===0)return;d=R;}else {if(d.length>=3)return;d=[...d,M];}i(d),E(),P();}function E(){p&&(p.textContent=O());}function P(){Br.forEach((M,S)=>{const R=m[S];R&&R.setSelected(d.includes(M));});}function O(){const M=d.map(S=>S==="none"?"normal":S.toLowerCase()).join(", ");return c==="lock"?`Lock ${M} plants`:`Allow ${M} plants`}function F(M){c=M,E();}function A(){return [...d]}function T(){p=null,m.length=0;}return {root:w,setRuleMode:F,getSelection:A,destroy:T}}function W$(e){const{enabled:t,selected:n,matchMode:r,ruleMode:o,onEnabledChange:i,onSelectionChange:a,onMatchModeChange:s,expanded:l=false,onExpandChange:d}=e;let c=t,p=[...n],m=r,b=o,g=null;const w=new Map,_=x("div",{style:"display: flex; flex-direction: column; gap: 12px;"}),C=x("div",{style:`
            font-size: 10px;
            font-weight: 600;
            color: var(--accent);
            background: color-mix(in oklab, var(--accent) 12%, transparent);
            border: 1px solid color-mix(in oklab, var(--accent) 30%, transparent);
            border-radius: 10px;
            padding: 1px 6px;
            display: none;
        `},"Enabled");P();const E=ft({title:"Weather Mutation",subtitle:"Weather-based mutation variants",actions:[C],variant:"soft",padding:"md",expandable:true,defaultExpanded:l,onExpandChange:d},_);function P(){_.replaceChildren(),w.clear(),C.style.display=c?"":"none";const j=x("div",{style:"display: flex; align-items: center; gap: 12px;"}),q=zd({checked:c,label:"Enable",size:"md",onChange:ee=>{c=ee,i(ee),P();}});j.appendChild(q.root),c&&(g=x("div",{style:"font-size: 12px; color: color-mix(in oklab, var(--fg) 70%, transparent); line-height: 1.4;"}),p.length>0&&(g.textContent=T()),j.appendChild(g)),_.appendChild(j);const U=x("div",{style:(c?"":"opacity: 0.4; pointer-events: none;")+" display: flex; flex-direction: column; gap: 12px; transition: opacity 0.2s ease;"}),ce=x("div",{style:"display: flex; justify-content: center;"}),W=jo({segments:[{id:"any",label:"Any"},{id:"all",label:"All"}],selected:m,onChange:ee=>{m=ee,ee==="all"&&(p=j$(p),a(p)),s(m),P();}});ce.appendChild(W),U.appendChild(ce);const ne=["none",...gC()],ie=x("div",{style:`
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(85px, 1fr));
                gap: 8px;
                max-height: 300px;
                overflow-y: auto;
            `});ne.forEach(ee=>{const H=p.includes(ee),K=bC({mutationId:ee,isSelected:H,onToggle:()=>O(ee),label:ee==="none"?"None":void 0});w.set(ee,K),ie.appendChild(K.root);}),U.appendChild(ie),_.appendChild(U);}function O(j){if(m==="all")if(j==="none")p.length===1&&p[0]==="none"?p=[]:p=["none"];else {if(p.includes("none"))return;p.includes(j)?p=p.filter(q=>q!==j):(mf(j)?p=p.filter(q=>!mf(q)):bf(j)&&(p=p.filter(q=>!bf(q))),p=[...p,j]);}else p.includes(j)?p=p.filter(q=>q!==j):p=[...p,j];a(p),F(),A();}function F(){g&&(g.textContent=p.length>0?T():"");}function A(){const j=m==="all"&&p.includes("none");w.forEach((q,U)=>{q.setSelected(p.includes(U)),q.setDisabled(j&&U!=="none");});}function T(){const j=B$(p),q=m==="all"?"AND":"OR";return b==="lock"?`Lock ${j} plants (${q})`:`Allow ${j} plants (${q})`}function M(j){b=j,F();}function S(){return [...p]}function R(){return m}function z(){g=null,w.clear();}return {root:E,setRuleMode:M,getSelection:S,getMatchMode:R,destroy:z}}const V$=60;function q$(e){let t={...e},n=null,r=null;const o=x("div",{style:"display: flex; flex-direction: column; gap: 8px;"}),i=x("div",{style:"display: flex; justify-content: center;"}),a=x("div",{className:"harvest-locker-preview-grid"});o.appendChild(i),o.appendChild(a);const s=x("div",{style:`
            font-size: 10px;
            font-weight: 600;
            color: var(--accent);
            background: color-mix(in oklab, var(--accent) 12%, transparent);
            border: 1px solid color-mix(in oklab, var(--accent) 30%, transparent);
            border-radius: 10px;
            padding: 1px 6px;
            display: none;
        `});t.sizeEnabled&&t.sizePercentage!==void 0&&(s.textContent=`size ${(t.sizeMode??"max")==="max"?"≥":"≤"} ${t.sizePercentage}%`,s.style.display="");const l=ft({title:"Preview",subtitle:c(),actions:[s],variant:"soft",padding:"md",expandable:true,defaultExpanded:true},o),d=l.querySelector(".card-subtitle");p();function c(){return t.ruleMode==="lock"?"Preview of plants that will be blocked from harvesting":"Preview of plants that will be harvestable"}function p(){n!==null&&(cancelAnimationFrame(n),n=null),d&&(d.textContent=c()),t.sizeEnabled&&t.sizePercentage!==void 0?(s.textContent=`size ${(t.sizeMode??"max")==="max"?"≥":"≤"} ${t.sizePercentage}%`,s.style.display=""):s.style.display="none";const C=t.colorEnabled?Br.filter(E=>t.colorMutations.includes(E)):[];if(C.length>=2){r&&!C.includes(r)&&(r=C[0]),r||(r=C[0]),i.replaceChildren();const E=jo({segments:C.map(P=>({id:P,label:P==="none"?"Normal":P})),selected:r,onChange:P=>{r=P,p();}});i.appendChild(E);}else r=null,i.replaceChildren();a.replaceChildren(),n=requestAnimationFrame(()=>{m().forEach(P=>{a.appendChild(P);});});}function m(){const C=[],E=t.species||"Starweaver";if(!(t.sizeEnabled||t.colorEnabled||t.weatherEnabled))return C.push(g(E,[])),C;const O=b();if(O.sort((A,T)=>{const M=Math.max(0,...A.map(j=>Br.indexOf(j))),S=Math.max(0,...T.map(j=>Br.indexOf(j)));if(M!==S)return M-S;const R=A.filter(j=>!Br.includes(j)).sort((j,q)=>Ko(j)-Ko(q)),z=T.filter(j=>!Br.includes(j)).sort((j,q)=>Ko(j)-Ko(q));if(R.length!==z.length)return R.length-z.length;for(let j=0;j<R.length;j++){const q=Ko(R[j])-Ko(z[j]);if(q!==0)return q}return 0}),O.length===0){const A=x("div",{style:"padding: 12px; text-align: center; color: #ef4444; font-size: 12px;"},"Invalid mutation combination");return C.push(A),C}return (r?O.filter(A=>{const T=A.filter(M=>Br.includes(M)&&M!=="none");return r==="none"?T.length===0:T.includes(r)}):O).forEach(A=>{C.push(g(E,A));}),C}function b(){const C=[],E=t.weatherEnabled?t.weatherMutations.filter(j=>j!=="none"):[],P=t.colorEnabled?t.colorMutations.filter(j=>j!=="none"):[],O=t.weatherEnabled&&t.weatherMutations.includes("none"),F=t.colorEnabled&&t.colorMutations.includes("none");if(E.length===0&&P.length===0||!t.weatherEnabled&&!t.colorEnabled)return C.push([]),C;const A=E.filter(j=>nd.wet.includes(j)),T=E.filter(j=>nd.lunar.includes(j)),M=(j,q)=>{j.length===0&&q.length===0?C.push([]):j.length===0?q.forEach(U=>{C.push([...U]);}):q.length===0?j.forEach(U=>{C.push([...U]);}):j.forEach(U=>{q.forEach(ce=>{C.push([...U,...ce]);});});},S=[];if(O&&S.push([]),t.weatherMatchMode==="all"&&E.length>0){const j=A.length>1,q=T.length>1;if(j||q)return [];S.push(E);}else t.weatherMatchMode==="any"&&E.length>0&&(E.forEach(j=>{S.push([j]);}),A.forEach(j=>{T.forEach(q=>{S.push([j,q]);});}));const R=[];return F&&R.push([]),P.forEach(j=>{R.push([j]);}),M(S,R),Array.from(new Set(C.map(j=>j.sort().join(",")))).map(j=>j.split(",").filter(Boolean))}function g(C,E){const P=x("div",{style:"flex-shrink: 0;"});return Ud(C,P,{size:V$,mutations:E}),P}function w(C){t={...t,...C},p();}function _(){n!==null&&(cancelAnimationFrame(n),n=null),a.replaceChildren();}return {root:l,update:w,destroy:_}}function rv(e){const{mode:t,species:n,ruleId:r,initialData:o,onSave:i,onDelete:a,onCancel:s}=e;let l=o?.name??"",d=o?.ruleMode??"lock",c=o?.sizeCondition?.enabled??false,p=o?.sizeCondition?.minPercentage??75,m=o?.sizeCondition?.sizeMode??"max";const b=o?.mutationCondition?.mutations??[],g=b.filter(D=>["none","Gold","Rainbow"].includes(D));let w=g.length>0,_=g.length>0?g:["none"];const C=b.filter(D=>!["none","Gold","Rainbow"].includes(D));let E=C.length>0,P=C.length>0?C:["none"],O=o?.mutationCondition?.matchMode??"any",F=null,A=null,T=null,M=null,S=null,R=null,z=null;const j=ce(),q=te();z=sg({title:U(),content:j,footer:q,size:"lg",closeOnBackdrop:true,closeOnEscape:true,onClose:()=>{s?.();}});function U(){if(t!=="species"||!n)return r?"Edit Overall Rule":"Create Overall Rule";const D=x("div",{style:"display: flex; align-items: center; gap: 10px;"}),B=x("div",{style:"width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;"});Ud(n,B,{size:24}),D.appendChild(B);const Q=x("span",{},`${n} — Override Rule`);return D.appendChild(Q),D}function ce(){const D=x("div",{style:"display: flex; flex-direction: column; gap: 16px;"});if(t==="species"){const B=x("div",{style:"font-size: 12px; color: color-mix(in oklab, var(--fg) 60%, transparent); padding: 8px 10px; background: color-mix(in oklab, var(--accent) 8%, transparent); border-radius: 6px; border-left: 3px solid var(--accent);"},"Global rules still apply. This override takes priority for this species only.");D.appendChild(B);}return D.appendChild(W()),F=H$({enabled:c,percentage:p,sizeMode:m,ruleMode:d,onEnabledChange:B=>{c=B,ie(),ee();},onPercentageChange:B=>{p=B,ee();},onSizeModeChange:B=>{m=B,ee();}}),D.appendChild(F.root),A=U$({enabled:w,selected:_,ruleMode:d,onEnabledChange:B=>{w=B,ie(),ee();},onSelectionChange:B=>{_=B,ee();}}),D.appendChild(A.root),T=W$({enabled:E,selected:P,matchMode:O,ruleMode:d,onEnabledChange:B=>{E=B,ie(),ee();},onSelectionChange:B=>{P=B,ee();},onMatchModeChange:B=>{O=B,ee();}}),D.appendChild(T.root),M=q$({species:t==="overall"?"Carrot":n,ruleMode:d,sizeEnabled:c,sizePercentage:p,sizeMode:m,colorEnabled:w,colorMutations:_,weatherEnabled:E,weatherMutations:P,weatherMatchMode:O}),D.appendChild(M.root),D}function W(){const D=x("div",{style:"display: flex; flex-direction: column; gap: 12px;"}),B=x("div",{style:"display: flex; gap: 12px; align-items: flex-start;"}),Q=x("div",{style:"flex: 1; display: flex; flex-direction: column; gap: 6px;"}),ae=x("label",{style:"font-size: 12px; font-weight: 500; color: var(--fg);"},"Rule Name");Q.appendChild(ae),S=od({placeholder:"e.g., Lock Large Frozen",value:l,maxLength:30,blockGameKeys:true,onChange:Be=>{l=Be,ie();}}),Q.appendChild(S.root),B.appendChild(Q);const le=x("div",{style:"display: flex; flex-direction: column; gap: 6px;"}),ve=x("label",{style:"font-size: 12px; font-weight: 500; color: var(--fg);"},"Mode");le.appendChild(ve);const Ie=jo({segments:[{id:"lock",label:"Lock"},{id:"allow",label:"Allow"}],selected:d,onChange:Be=>{d=Be,F?.setRuleMode(d),A?.setRuleMode(d),T?.setRuleMode(d),ee();}});return le.appendChild(Ie),B.appendChild(le),D.appendChild(B),D}function te(){const D=x("div",{style:"display: flex; gap: 8px; justify-content: space-between; width: 100%;"}),B=x("div",{style:"display: flex; gap: 8px;"});if(r&&a){const ve=kt({label:"Delete Rule",variant:"danger",onClick:()=>{a(),K();}});B.appendChild(ve);}D.appendChild(B);const Q=x("div",{style:"display: flex; gap: 8px;"}),ae=kt({label:"Cancel",variant:"default",onClick:()=>{s?.(),K();}});Q.appendChild(ae);const le=kt({label:"Save",variant:"primary",disabled:!ne(),onClick:H});return R=le,Q.appendChild(le),D.appendChild(Q),D}function ne(){return !(!l.trim()||!c&&!w&&!E)}function ie(){R&&(R.disabled=!ne());}function ee(){M?.update({ruleMode:d,sizeEnabled:c,sizePercentage:p,sizeMode:m,colorEnabled:w,colorMutations:_,weatherEnabled:E,weatherMutations:P,weatherMatchMode:O});}function H(){if(!ne())return;const D={name:l.trim(),ruleMode:d};c&&(D.sizeCondition={enabled:true,minPercentage:p,sizeMode:m});const B=[];E&&B.push(...P),w&&B.push(..._),B.length>0&&(D.mutationCondition={enabled:true,mutations:B,matchMode:O}),i(D),K();}function K(){F?.destroy(),A?.destroy(),T?.destroy(),M?.destroy(),S?.destroy(),z?.destroy(),F=null,A=null,T=null,M=null,S=null,R=null,z=null;}return {root:z.root,destroy:K}}function X$(e){const{species:t,existingRules:n,onSelect:r}=e;let o=null;const i=l(),a=d();o=sg({title:s(),subtitle:"Select a rule to assign to this species",content:i,footer:a,size:"md",closeOnBackdrop:true,closeOnEscape:true,onClose:()=>{}});function s(){const g=x("div",{style:"display: flex; align-items: center; gap: 10px;"}),w=x("div",{style:"width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;"});return Ud(t,w,{size:24}),g.appendChild(w),g.appendChild(x("span",{},`${t} — Assign Rule`)),g}function l(){const g=x("div",{style:"display: flex; flex-direction: column; gap: 8px;"});if(n.length===0){const w=x("div",{style:"padding: 20px; text-align: center; color: var(--muted); font-size: 14px;"},"No overall rules available");g.appendChild(w);}else n.forEach(w=>{g.appendChild(c(w));});return g}function d(){const g=x("div",{style:"display: flex; gap: 8px; justify-content: flex-end;"}),w=kt({label:"Cancel",variant:"default",onClick:()=>{b();}});return g.appendChild(w),g}function c(g){const w=x("div",{className:"harvest-locker-rule-item",style:"flex-direction: column; align-items: flex-start; gap: 8px;"});w.addEventListener("click",()=>{tn.cloneRuleToSpecies(g.id,t),r(g.id),b();});const _=x("div",{style:"display: flex; align-items: center; justify-content: space-between; width: 100%;"});_.appendChild(x("div",{className:"harvest-locker-rule-item__name"},g.name)),_.appendChild(x("div",{className:"harvest-locker-rule-item__badge"},g.mode)),w.appendChild(_);const C=p(g);return C.childNodes.length>0&&w.appendChild(C),w}function p(g){const w=x("div",{style:"display: flex; flex-wrap: wrap; gap: 4px;"});return g.sizeCondition?.enabled&&w.appendChild(m(`Size ≥ ${g.sizeCondition.minPercentage}%`)),g.mutationCondition?.enabled&&g.mutationCondition.mutations.forEach(_=>{w.appendChild(m(_==="none"?"Normal":_));}),w}function m(g){return x("div",{style:`
                padding: 2px 8px;
                border-radius: 10px;
                font-size: 11px;
                font-weight: 500;
                color: color-mix(in oklab, var(--fg) 75%, transparent);
                background: color-mix(in oklab, var(--fg) 8%, transparent);
                border: 1px solid color-mix(in oklab, var(--border) 60%, transparent);
            `},g)}function b(){o?.destroy(),o=null;}return {root:o.root,destroy:b}}const K$={ui:{harvestLockerMode:"overall",selectedSpecies:null,searchQuery:"",harvestLockerExpanded:true,eggLockerExpanded:true,decorLockerExpanded:true}};let oi=null,ep=null;async function Y$(){return oi||(ep||(ep=Kr("tab-locker",{version:1,defaults:K$,sanitize:e=>({ui:{harvestLockerMode:e.ui?.harvestLockerMode==="bySpecies"?"bySpecies":"overall",selectedSpecies:typeof e.ui?.selectedSpecies=="string"?e.ui.selectedSpecies:null,searchQuery:typeof e.ui?.searchQuery=="string"?e.ui.searchQuery:"",harvestLockerExpanded:typeof e.ui?.harvestLockerExpanded=="boolean"?e.ui.harvestLockerExpanded:true,eggLockerExpanded:typeof e.ui?.eggLockerExpanded=="boolean"?e.ui.eggLockerExpanded:true,decorLockerExpanded:typeof e.ui?.decorLockerExpanded=="boolean"?e.ui.decorLockerExpanded:true}})})),oi=await ep,oi)}function kr(){if(!oi)throw new Error("[LockerState] State not initialized. Call initLockerState() first.");return oi}function J$(e){const t=kr();t.update({ui:{...t.get().ui,harvestLockerMode:e}});}function Q$(e){const t=kr();t.update({ui:{...t.get().ui,selectedSpecies:e}});}function Z$(e){const t=kr();t.update({ui:{...t.get().ui,searchQuery:e}});}function e4(e){const t=kr();t.update({ui:{...t.get().ui,harvestLockerExpanded:e}});}function t4(e){const t=kr();t.update({ui:{...t.get().ui,eggLockerExpanded:e}});}function n4(e){const t=kr();t.update({ui:{...t.get().ui,decorLockerExpanded:e}});}function r4(e={}){let t=e.defaultMode??"overall",n=e.defaultSelectedSpecies??null,r=[],o=null,i=null,a=null,s=null,l=null,d=null;const c=[];o=p();function p(){const R=x("div",{className:"harvest-locker-card-wrapper"});i=x("div",{className:"harvest-locker-card__mode-container"}),R.appendChild(i),a=x("div",{className:"harvest-locker-card__content"}),R.appendChild(a);const z=ft({title:"Crop Harvest",subtitle:"Prevent harvesting specific crops",expandable:true,defaultExpanded:e.defaultExpanded??true,onExpandChange:e.onExpandChange},R);return m(),g(),b(),z}function m(){t==="overall"?r=tn.getOverallRules():r=n?tn.getSpeciesRules(n):[];}function b(){a&&(a.replaceChildren(),t==="bySpecies"&&(w(),n&&_()),C(),P());}function g(){if(i){if(!s){s=jo({segments:[{id:"overall",label:"Overall"},{id:"bySpecies",label:"By Species"}],selected:t,onChange:R=>{t=R,J$(t),m(),b();}}),i.appendChild(s);return}s.getSelected()!==t&&s.select(t);}}function w(){if(!a)return;const R=we.get("plants");if(!R||Object.keys(R).length===0){const U=x("div",{className:"harvest-locker-card__message harvest-locker-card__message--compact"},"No species available");a.appendChild(U);return}const z=tn.getConfig(),j={};Object.entries(z.speciesRules).forEach(([U,ce])=>{j[U]=ce.length;}),l=N$({selectedSpecies:n??void 0,placeholder:"Search plants...",speciesRuleCount:j,onChange:U=>{n=U,Q$(U),m(),b();},onSearchChange:U=>{Z$(U);}});const q=x("div",{className:"harvest-locker-card__control"});q.appendChild(l.root),a.appendChild(q);}function _(){if(!a||!n)return;const R=x("div",{className:"harvest-locker-card__species-section-header"}),z=x("div",{className:"harvest-locker-card__species-section-sprite"});Ud(n,z,{size:36}),R.appendChild(z);const j=x("div",{className:"harvest-locker-card__species-section-text"}),q=x("div",{className:"harvest-locker-card__species-section-name"},n);j.appendChild(q);const U=x("div",{className:"harvest-locker-card__species-section-label"},"SELECTED");j.appendChild(U),R.appendChild(j),a.appendChild(R);}function C(){if(!a)return;if(t==="bySpecies"&&!n){const U=x("div",{className:"harvest-locker-card__message"},"Select a species to view and manage rules");a.appendChild(U);return}const R=x("div",{className:"harvest-locker-card__rules-section"}),z=x("div",{className:"harvest-locker-card__rules-section-label"},"Rules");if(R.appendChild(z),r.length===0){const U=x("div",{className:"harvest-locker-card__empty"},"No rules yet");R.appendChild(U),a.appendChild(R);return}const j=x("div",{className:"harvest-locker-card__list"});r.forEach(U=>{const ce=E(U);j.appendChild(ce);}),R.appendChild(j);const q=x("div",{className:"harvest-locker-card__rules-hint"});q.appendChild(x("span",{className:"harvest-locker-card__rules-hint--desktop"},"Click to edit · Right-click to delete")),q.appendChild(x("span",{className:"harvest-locker-card__rules-hint--mobile"},"Tap to edit · Long-press to delete")),R.appendChild(q),a.appendChild(R);}function E(R){const z=x("div",{className:"harvest-locker-rule-item"}),j=x("div",{className:"harvest-locker-rule-item__name"},R.name);z.appendChild(j);const q=x("div",{className:"harvest-locker-rule-item__badge"},R.mode);z.appendChild(q),z.addEventListener("contextmenu",W=>{W.preventDefault(),A(R.id);});let U=null,ce=false;return z.addEventListener("touchstart",()=>{ce=false,U=window.setTimeout(()=>{ce=true,A(R.id),navigator.vibrate&&navigator.vibrate(50);},500);}),z.addEventListener("touchend",()=>{U&&(clearTimeout(U),U=null),ce||F(R);}),z.addEventListener("touchmove",()=>{U&&(clearTimeout(U),U=null);}),z.addEventListener("click",()=>{F(R);}),z}function P(){if(!a||t==="bySpecies"&&!n)return;const R=x("div",{className:"harvest-locker-card__actions"});if(t==="bySpecies"&&n){const z=tn.getOverallRules();if(z.length>0){const j=tn.getSpeciesRules(n),q=new Set(j.map(W=>Dl(W))),U=z.filter(W=>!q.has(Dl(W))),ce=kt({label:"Add Existing Rule",variant:"default",disabled:U.length===0,onClick:()=>T()});R.appendChild(ce);}}d=kt({label:t==="bySpecies"?"Create Override Rule":"Create Rule",variant:"primary",onClick:()=>O()}),R.appendChild(d),a.appendChild(R);}function O(){rv({mode:t==="overall"?"overall":"species",species:n,onSave:R=>{t==="overall"?tn.addNewOverallRule(R.name,R.ruleMode,R.sizeCondition,R.mutationCondition):n&&tn.addNewSpeciesRule(n,R.name,R.ruleMode,R.sizeCondition,R.mutationCondition),m(),b();}});}function F(R){rv({mode:t==="overall"?"overall":"species",species:n,ruleId:R.id,initialData:{name:R.name,ruleMode:R.mode,sizeCondition:R.sizeCondition,mutationCondition:R.mutationCondition},onSave:z=>{tn.modifyRule(R.id,{name:z.name,mode:z.ruleMode,sizeCondition:z.sizeCondition,mutationCondition:z.mutationCondition}),m(),b();},onDelete:()=>{A(R.id);}});}function A(R){tn.removeRule(R),m(),b();}function T(){if(t!=="bySpecies"||!n)return;const R=tn.getOverallRules();if(R.length===0)return;const z=tn.getSpeciesRules(n),j=new Set(z.map(U=>Dl(U))),q=R.filter(U=>!j.has(Dl(U)));q.length!==0&&X$({species:n,existingRules:q,onSelect:()=>{m(),b();}});}function M(){m(),g(),b();}function S(){c.forEach(R=>R()),c.length=0,s?.destroy?.(),s=null,l?.destroy?.(),l=null,d=null,i=null,a=null,o=null;}return {root:o,render:M,destroy:S}}class o4{constructor(t={}){de(this,"handle",null);de(this,"options");this.options=t;}build(){return this.handle||(this.handle=r4(this.options)),this.handle.root}render(){this.handle?.render();}destroy(){this.handle?.destroy(),this.handle=null;}}const i4=`
.harvest-locker-card-wrapper {
    display: flex;
    flex-direction: column;
    gap: 12px;
    max-width: 100%;
    overflow: clip;
}

.harvest-locker-card__mode-container {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
}

.harvest-locker-card__content {
    display: flex;
    flex-direction: column;
    gap: 12px;
    width: 100%;
}

.harvest-locker-card__message,
.harvest-locker-card__empty {
    padding: 24px;
    text-align: center;
    font-size: 14px;
}

.harvest-locker-card__message {
    color: var(--muted);
}

.harvest-locker-card__empty {
    color: var(--fg);
}

.harvest-locker-card__message--compact {
    padding: 12px;
}

.harvest-locker-card__control {
    margin-bottom: 16px;
}

/* ═══════════════════════════════════════════════════════════════════════════
   SPECIES SECTION HEADER (Title with divider)
   ═══════════════════════════════════════════════════════════════════════════ */

.harvest-locker-card__species-section-header {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 0;
    margin-bottom: 16px;
    border-top: 1px solid var(--border);
}

.harvest-locker-card__species-section-sprite {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    background: var(--soft);
    border-radius: 4px;
}

.harvest-locker-card__species-section-text {
    flex: 1;
    display: flex;
    align-items: baseline;
    gap: 8px;
}

.harvest-locker-card__species-section-name {
    font-size: 14px;
    font-weight: 600;
    color: var(--fg);
}

.harvest-locker-card__species-section-label {
    font-size: 10px;
    font-weight: 700;
    color: var(--accent);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* ═══════════════════════════════════════════════════════════════════════════
   RULES SECTION FRAME (cadran)
   ═══════════════════════════════════════════════════════════════════════════ */

.harvest-locker-card__rules-section {
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
    background: color-mix(in oklab, var(--bg) 60%, transparent);
}

.harvest-locker-card__rules-section-label {
    padding: 8px 12px;
    font-size: 11px;
    font-weight: 600;
    color: var(--accent);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-bottom: 1px solid var(--border);
    background: color-mix(in oklab, var(--fg) 4%, transparent);
}

.harvest-locker-card__rules-section .harvest-locker-card__empty {
    padding: 16px;
}

.harvest-locker-card__list {
    display: flex;
    flex-direction: column;
    gap: 8px;
    padding: 8px;
    max-height: 272px; /* ~4 items visible, scrollable après */
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
}

.harvest-locker-card__list::-webkit-scrollbar {
    width: 6px;
}

.harvest-locker-card__list::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 3px;
}

.harvest-locker-card__list::-webkit-scrollbar-track {
    background: transparent;
}

.harvest-locker-card__rules-hint {
    padding: 6px 8px 4px;
    text-align: center;
}

.harvest-locker-card__rules-hint--desktop,
.harvest-locker-card__rules-hint--mobile {
    font-size: 11px;
    color: color-mix(in oklab, var(--fg) 40%, transparent);
    font-style: italic;
}

.harvest-locker-card__rules-hint--mobile {
    display: none;
}

@media (hover: none) and (pointer: coarse) {
    .harvest-locker-card__rules-hint--desktop {
        display: none;
    }
    .harvest-locker-card__rules-hint--mobile {
        display: inline;
    }
}

.harvest-locker-card__actions {
    display: flex;
    gap: 8px;
    justify-content: center;
    width: 100%;
}

/* ═══════════════════════════════════════════════════════════════════════════
   RULE ITEM
   ═══════════════════════════════════════════════════════════════════════════ */

.harvest-locker-rule-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.harvest-locker-rule-item:hover {
    background: var(--soft);
    border-color: var(--accent);
}

.harvest-locker-rule-item__name {
    flex: 1;
    font-size: 14px;
    font-weight: 500;
    color: var(--fg);
}

.harvest-locker-rule-item__badge {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    background: color-mix(in oklab, var(--accent) 20%, transparent);
    color: var(--accent);
    border: 1px solid color-mix(in oklab, var(--accent) 30%, transparent);
}

/* ═══════════════════════════════════════════════════════════════════════════
   RULE EDITOR MODAL
   ═══════════════════════════════════════════════════════════════════════════ */

.harvest-locker-modal {
    scrollbar-gutter: stable;
}

.harvest-locker-modal::-webkit-scrollbar {
    width: 10px;
}

.harvest-locker-modal::-webkit-scrollbar-thumb {
    background: var(--muted);
    border-radius: 8px;
}

.harvest-locker-modal::-webkit-scrollbar-track {
    background: transparent;
}

/* ═══════════════════════════════════════════════════════════════════════════
   PREVIEW GRID
   ═══════════════════════════════════════════════════════════════════════════ */

.harvest-locker-preview-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    width: 100%;
    justify-content: flex-start;
    align-items: flex-start;
}

@media (max-width: 768px) {
    .harvest-locker-rule-item {
        padding: 10px;
    }

    .harvest-locker-rule-item__name {
        font-size: 13px;
    }
}

@media (max-width: 480px) {
    .harvest-locker-rule-item {
        gap: 8px;
        padding: 8px;
    }

    .harvest-locker-card__list {
        max-height: 300px;
    }
}
`;function a4(e){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.setAttribute("stroke","currentColor"),t.setAttribute("stroke-width","2"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-linejoin","round"),t.innerHTML=e?'<rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/>':'<rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 9.9-1"/>',t}function s4(e,t,n){if(!ye.isReady()){t.appendChild($l(n));return}try{const o=we.get("eggs")?.[e]?.spriteId;if(!o){t.appendChild($l(n));return}const i=ye.toCanvas(o,{boundsMode:"padded"});i?(i.style.maxWidth=`${n}px`,i.style.maxHeight=`${n}px`,i.style.width="auto",i.style.height="auto",i.style.display="block",t.appendChild(i)):t.appendChild($l(n));}catch{t.appendChild($l(n));}}function $l(e){return x("div",{style:`width:${e}px;height:${e}px;background:color-mix(in oklab, var(--accent) 20%, transparent);border-radius:6px;`})}function l4(e={}){let t=null,n=null;n=r();function r(){return t=x("div",{className:"egg-locker-card__wrapper"}),o(),ft({title:"Egg Hatching",subtitle:"Prevent hatching specific eggs",expandable:true,defaultExpanded:e.defaultExpanded??true,onExpandChange:e.onExpandChange},t)}function o(){if(!t)return;t.replaceChildren();const l=Hr.getAvailableEggs();if(l.length===0){t.appendChild(x("div",{className:"egg-locker-card__empty"},"No eggs available"));return}const d=new Set(Hr.getBlockedEggs()),c=we.get("eggs"),p=x("div",{className:"egg-locker-card__grid"});for(const m of l){const b=c?.[m]?.name??m;p.appendChild(i(m,d.has(m),b));}t.appendChild(p);}function i(l,d,c){const p=x("div",{className:"egg-locker-item"+(d?" egg-locker-item--locked":"")}),m=x("div",{className:"egg-locker-item__sprite"});s4(l,m,48),p.appendChild(m),p.appendChild(x("div",{className:"egg-locker-item__name"},c));const b=x("div",{className:"egg-locker-item__lock"+(d?" egg-locker-item__lock--locked":"")});return b.appendChild(a4(d)),p.appendChild(b),p.addEventListener("click",()=>{d?Hr.unblockEgg(l):Hr.blockEgg(l),o();}),p}function a(){o();}function s(){t=null,n=null;}return {root:n,render:a,destroy:s}}class c4{constructor(t={}){de(this,"handle",null);de(this,"options");this.options=t;}build(){return this.handle||(this.handle=l4(this.options)),this.handle.root}render(){this.handle?.render();}destroy(){this.handle?.destroy(),this.handle=null;}}const d4=`
/* ═══════════════════════════════════════════════════════════════════════════
   GRID
   ═══════════════════════════════════════════════════════════════════════════ */

.egg-locker-card__wrapper {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.egg-locker-card__empty {
    padding: 24px;
    text-align: center;
    color: color-mix(in oklab, var(--fg) 50%, #9ca3af);
    font-size: 14px;
}

.egg-locker-card__grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(96px, 1fr));
    gap: 10px;
}

/* ═══════════════════════════════════════════════════════════════════════════
   EGG ITEM
   ═══════════════════════════════════════════════════════════════════════════ */

.egg-locker-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    padding: 14px 8px 12px;
    background: var(--bg);
    border: 1.5px solid var(--border);
    border-radius: 12px;
    cursor: pointer;
    -webkit-tap-highlight-color: transparent;
    transition: border-color 0.2s ease, background 0.2s ease, box-shadow 0.2s ease;
}

.egg-locker-item:hover {
    border-color: color-mix(in oklab, var(--fg) 30%, var(--border));
    background: color-mix(in oklab, var(--fg) 4%, var(--bg));
}

.egg-locker-item--locked {
    border-color: var(--accent);
    background: color-mix(in oklab, var(--accent) 8%, var(--bg));
    box-shadow: 0 0 6px color-mix(in oklab, var(--accent) 20%, transparent);
}

.egg-locker-item--locked:hover {
    box-shadow: 0 0 10px color-mix(in oklab, var(--accent) 30%, transparent);
}

/* ═══════════════════════════════════════════════════════════════════════════
   SPRITE + LABEL
   ═══════════════════════════════════════════════════════════════════════════ */

.egg-locker-item__sprite {
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.egg-locker-item__name {
    font-size: 12px;
    font-weight: 500;
    color: var(--fg);
    text-align: center;
    line-height: 1.3;
    max-width: 88px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

/* ═══════════════════════════════════════════════════════════════════════════
   LOCK ICON
   ═══════════════════════════════════════════════════════════════════════════ */

.egg-locker-item__lock {
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.egg-locker-item__lock svg {
    width: 18px;
    height: 18px;
    color: color-mix(in oklab, var(--fg) 50%, transparent);
    transition: color 0.2s ease;
}

.egg-locker-item__lock--locked svg {
    color: var(--accent);
}

/* ═══════════════════════════════════════════════════════════════════════════
   RESPONSIVE
   ═══════════════════════════════════════════════════════════════════════════ */

@media (max-width: 480px) {
    .egg-locker-card__grid {
        grid-template-columns: repeat(auto-fill, minmax(78px, 1fr));
        gap: 8px;
    }

    .egg-locker-item {
        padding: 10px 6px;
    }

    .egg-locker-item__sprite {
        width: 40px;
        height: 40px;
    }

    .egg-locker-item__name {
        font-size: 11px;
        max-width: 72px;
    }
}
`;function u4(e={}){let t=null,n=null,r=null,o=null;const i=[];n=a();function a(){t=x("div",{className:"decor-locker-card__wrapper",style:"display: flex; flex-direction: column; gap: 16px;"}),s();const c=ft({title:"Decor Pickup",subtitle:"Prevent decor pickups",expandable:true,defaultExpanded:e.defaultExpanded??true,onExpandChange:e.onExpandChange},t),p=()=>l();return window.addEventListener(xt.DECOR_LOCKER_LOCKS_UPDATED,p),i.push(()=>window.removeEventListener(xt.DECOR_LOCKER_LOCKS_UPDATED,p)),c}function s(){if(!t)return;const c=Ur.getAvailableDecors().length,m=Ur.getBlockedDecors().length===c&&c>0;if(r)r.setChecked(m,true),o&&(o.textContent=m?"Decors Unpickable":"Decors Pickable");else {t.replaceChildren();const b=x("div",{style:`
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                    padding: 12px;
                    background: color-mix(in oklab, var(--accent) 10%, transparent);
                    border-radius: 8px;
                `});o=x("div",{style:"font-size: 14px; font-weight: 500;"},m?"Decors Unpickable":"Decors Pickable"),r=Xr({checked:m,size:"md",onChange:g=>{g?Ur.blockAllDecors():Ur.unblockAllDecors();}}),i.push(()=>r?.destroy()),b.appendChild(o),b.appendChild(r.root),t.appendChild(b);}}function l(){s();}function d(){i.forEach(c=>c()),i.length=0,t=null,n=null;}return {root:n,render:l,destroy:d}}class p4{constructor(t={}){de(this,"handle",null);de(this,"options");this.options=t;}build(){return this.handle||(this.handle=u4(this.options)),this.handle.root}render(){this.handle?.render();}destroy(){this.handle?.destroy(),this.handle=null;}}const f4=`
.plant-selector {
    display: flex;
    flex-direction: column;
    gap: 8px;
    width: 100%;
}

.plant-selector__grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
    gap: 8px;
    max-height: 240px;
    overflow-y: auto;
    padding: 4px;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
}

.plant-selector__grid::-webkit-scrollbar {
    width: 6px;
}

.plant-selector__grid::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 3px;
}

.plant-selector__grid::-webkit-scrollbar-track {
    background: transparent;
}

.plant-selector__empty {
    grid-column: 1 / -1;
    padding: 24px;
    text-align: center;
    color: var(--fg);
    font-size: 14px;
}

.plant-selector__item {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    padding: 8px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.plant-selector__item:hover {
    background: var(--soft);
    border-color: var(--accent);
}

.plant-selector__item--selected {
    background: color-mix(in oklab, var(--accent) 15%, transparent);
    border-color: var(--accent);
}

.plant-selector__badge {
    position: absolute;
    top: -4px;
    right: -4px;
    min-width: 14px;
    height: 14px;
    border-radius: 7px;
    background-color: var(--accent);
    color: white;
    font-size: 9px;
    font-weight: 700;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 2px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    z-index: 1;
}

.plant-selector__sprite {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.plant-selector__name {
    font-size: 10px;
    color: var(--fg);
    text-align: center;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
    font-weight: 500;
}

/* Responsive */
@media (max-width: 768px) {
    .plant-selector__item {
        padding: 6px;
    }

    .plant-selector__name {
        font-size: 9px;
    }
}

@media (max-width: 480px) {
    .plant-selector__grid {
        grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
        gap: 6px;
        max-height: 250px;
    }

    .plant-selector__item {
        gap: 2px;
        padding: 4px;
    }

    .plant-selector__sprite {
        width: 36px;
        height: 36px;
    }

    .plant-selector__name {
        font-size: 8px;
    }
}
`;class h4 extends Tr{constructor(){super({id:"tab-locker",label:"Locker"});de(this,"harvestLockerCardPart",null);de(this,"eggLockerCardPart",null);de(this,"decorLockerCardPart",null);}async preload(){await Y$();}build(n){const r=n.getRootNode();vt(r,i4,"harvest-locker-card-styles"),vt(r,f4,"plant-selector-styles"),vt(r,d4,"egg-locker-card-styles");const o=this.createGrid("12px");o.id="locker",n.appendChild(o),this.initializeHarvestLockerCardPart(o),this.initializeEggLockerCardPart(o),this.initializeDecorLockerCardPart(o);}render(n){const r=this.harvestLockerCardPart,o=this.eggLockerCardPart,i=this.decorLockerCardPart;this.harvestLockerCardPart=null,this.eggLockerCardPart=null,this.decorLockerCardPart=null,super.render(n),this.harvestLockerCardPart=r,this.eggLockerCardPart=o,this.decorLockerCardPart=i;}destroy(){this.harvestLockerCardPart&&(this.harvestLockerCardPart.destroy(),this.harvestLockerCardPart=null),this.eggLockerCardPart&&(this.eggLockerCardPart.destroy(),this.eggLockerCardPart=null),this.decorLockerCardPart&&(this.decorLockerCardPart.destroy(),this.decorLockerCardPart=null);}initializeHarvestLockerCardPart(n){if(!this.harvestLockerCardPart){const o=kr();this.harvestLockerCardPart=new o4({defaultExpanded:o.get().ui.harvestLockerExpanded,defaultMode:o.get().ui.harvestLockerMode,defaultSelectedSpecies:o.get().ui.selectedSpecies,defaultSearchQuery:o.get().ui.searchQuery,onExpandChange:e4});}const r=this.harvestLockerCardPart.build();n.appendChild(r),this.harvestLockerCardPart.render();}initializeEggLockerCardPart(n){if(!this.eggLockerCardPart){const o=kr();this.eggLockerCardPart=new c4({defaultExpanded:o.get().ui.eggLockerExpanded,onExpandChange:t4});}const r=this.eggLockerCardPart.build();n.appendChild(r),this.eggLockerCardPart.render();}initializeDecorLockerCardPart(n){if(!this.decorLockerCardPart){const o=kr();this.decorLockerCardPart=new p4({defaultExpanded:o.get().ui.decorLockerExpanded,onExpandChange:n4});}const r=this.decorLockerCardPart.build();n.appendChild(r),this.decorLockerCardPart.render();}}let tp=null,np=null,rp=null;function g4(){return tp||(tp=new dM),tp}function vC(){return np||(np=new o$),np}function yC(){return rp||(rp=new h4),rp}function m4(e){return [new k1(e),new S5,vC(),new N5(e),new pD(e),new w$,new R$(e),yC()]}async function b4(){const e=vC(),t=yC(),n=g4();await Promise.all([e.preload(),t.preload(),n.preload()]);}function v4(e){const{shadow:t,initialOpen:n}=e,r=x("div",{className:"gemini-panel",id:"panel",ariaHidden:String(!n)}),o=x("div",{className:"gemini-tabbar"}),i=x("div",{className:"gemini-content",id:"content"}),a=x("div",{className:"gemini-resizer",title:"Resize"}),s=x("button",{className:"gemini-close",title:"Fermer",ariaLabel:"Fermer"},"✕");r.append(o,i,a);const l=x("div",{className:"gemini-wrapper"},r);return t.append(l),{panel:r,tabbar:o,content:i,resizer:a,closeButton:s,wrapper:l}}function y4(e){const{resizer:t,host:n,shadow:r,onWidthChange:o,initialWidth:i,minWidth:a,maxWidth:s}=e;let l=a,d=s;function c(){const O=Wt.detect(),F=Math.round(he.visualViewport?.width??he.innerWidth??0);if(O.platform==="mobile"||O.os==="ios"||O.os==="android"){const A=getComputedStyle(r.host),T=parseFloat(A.getPropertyValue("--inset-l"))||0,M=parseFloat(A.getPropertyValue("--inset-r"))||0,S=Math.max(280,F-Math.round(T+M));l=280,d=S;}else l=a,d=s;return {min:l,max:d}}function p(O){return Math.max(l,Math.min(d,Number(O)||i))}function m(O){const F=p(O);n.style.setProperty("--w",`${F}px`),o(F);}c();const b=Wt.detect(),g=!(b.platform==="mobile"||b.os==="ios"||b.os==="android");let w=false;const _=O=>{if(!w)return;O.preventDefault();const F=Math.round(he.innerWidth-O.clientX);m(F);},C=()=>{w&&(w=false,document.body.style.cursor="",he.removeEventListener("mousemove",_),he.removeEventListener("mouseup",C));},E=O=>{g&&(O.preventDefault(),w=true,document.body.style.cursor="ew-resize",he.addEventListener("mousemove",_),he.addEventListener("mouseup",C));};t.addEventListener("mousedown",E);function P(){t.removeEventListener("mousedown",E),he.removeEventListener("mousemove",_),he.removeEventListener("mouseup",C);}return {calculateResponsiveBounds:c,constrainWidthToLimits:p,setHudWidth:m,destroy:P}}function x4(e){const{panel:t,onToggle:n,onClose:r,toggleCombo:o=l=>l.ctrlKey&&l.shiftKey&&l.key.toLowerCase()==="u",closeOnEscape:i=true}=e;function a(l){const d=t.classList.contains("open");if(i&&l.key==="Escape"&&d){r();return}o(l)&&(l.preventDefault(),l.stopPropagation(),n());}document.addEventListener("keydown",a,{capture:true});function s(){document.removeEventListener("keydown",a,{capture:true});}return {destroy:s}}const w4=`
@layer hud {
  /* Root container */
  .gemini-wrapper {
    position: relative;
    pointer-events: auto;
  }

  /* ---- HUD panel ---- */
  .gemini-panel {
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    width: var(--w);
    max-width: 100vw;
    height: 100dvh;
    display: flex;
    flex-direction: column;
    background-color: var(--bg);
    color: var(--fg);
    border-left: 1px solid var(--border);
    box-shadow: -20px 0 60px var(--shadow);
    transform: translateX(100%);
    transition: transform .28s cubic-bezier(.2,.8,.2,1),
                background-color .28s ease, color .28s ease,
                border-color .28s ease, box-shadow .28s ease;
    overflow: hidden;
    pointer-events: auto;
    backdrop-filter: blur(var(--glass-blur));
    -webkit-backdrop-filter: blur(var(--glass-blur));
  }
  .gemini-panel.open {
    transform: translateX(0);
  }

  /* ---- Resizer (desktop only) ---- */
  .gemini-resizer {
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 8px;
    cursor: ew-resize;
    background: transparent;
  }
  .gemini-resizer:hover {
    background: color-mix(in oklab, var(--accent) 15%, transparent);
  }

  /* ---- TABBAR (grid: tabs that stretch + close button) ---- */
  .gemini-tabbar {
    position: relative;
    height: var(--tab-h);
    display: grid;
    grid-template-columns: minmax(0,1fr) auto;
    align-items: center;
    gap: 14px;
    padding: 12px max(12px, var(--inset-l)) 12px max(12px, var(--inset-r));
    background-color: color-mix(in oklab, var(--bg) 92%, transparent);
    transition: background-color .28s ease, border-color .28s ease;
  }

  /* ---- CLOSE BUTTON (in tabbar, auto column) ---- */
  .gemini-close {
    position: static;
    inline-size: 34px;
    block-size: 34px;
    border-radius: 999px;
    border: 1px solid color-mix(in oklab, var(--border) 70%, transparent);
    background: linear-gradient(
      180deg,
      color-mix(in oklab, var(--soft) 85%, transparent) 0%,
      color-mix(in oklab, var(--soft) 60%, transparent) 100%
    );
    color: var(--fg);
    font: 16px/1 ui-monospace, SFMono-Regular, Menlo, Consolas;
    display: grid;
    place-items: center;
    cursor: pointer;
    box-shadow: 0 6px 18px color-mix(in oklab, var(--shadow) 35%, transparent);
    transition: transform .05s, border-color .2s, background .2s, color .2s, opacity .2s;
  }
  .gemini-close:hover {
    border-color: color-mix(in oklab, var(--accent) 40%, var(--border));
  }
  .gemini-close:active {
    transform: scale(.98);
  }

  /* Responsive tweaks for tabbar and close button */
  @media (max-width: 720px) {
    .gemini-tabbar {
      gap: 12px;
      padding: 10px max(10px, var(--inset-l)) 10px max(10px, var(--inset-r));
    }
    .gemini-close {
      inline-size: 30px;
      block-size: 30px;
      font-size: 15px;
    }
  }
  @media (max-width: 480px) {
    .gemini-tabbar {
      gap: 10px;
      padding: 10px max(8px, var(--inset-l)) 10px max(8px, var(--inset-r));
    }
    .gemini-close {
      inline-size: 28px;
      block-size: 28px;
      font-size: 14px;
    }
  }

  /* ---- Content area ---- */
  .gemini-content {
    padding: calc(var(--pad) + var(--inset-t)) var(--pad) calc(var(--pad) + var(--inset-b));
    overflow: auto;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    height: calc(100dvh - var(--tab-h));
    scrollbar-gutter: stable;
  }
  .gemini-content::-webkit-scrollbar {
    width: 10px;
  }
  .gemini-content::-webkit-scrollbar-thumb {
    background: var(--muted);
    border-radius: 8px;
  }
}
`,C4=`
@layer tokens {
  /* --- Animatable properties --- */
  @property --bg{        syntax:'<color>';inherits:true;initial-value:rgba(10,12,18,.6)}
  @property --fg{        syntax:'<color>';inherits:true;initial-value:#e5e7eb}
  @property --muted{     syntax:'<color>';inherits:true;initial-value:rgba(229,231,235,.08)}
  @property --soft{      syntax:'<color>';inherits:true;initial-value:rgba(229,231,235,.05)}
  @property --accent{    syntax:'<color>';inherits:true;initial-value:#60a5fa}
  @property --border{    syntax:'<color>';inherits:true;initial-value:rgba(148,163,184,.2)}
  @property --tab-bg{    syntax:'<color>';inherits:true;initial-value:#fff}
  @property --tab-fg{    syntax:'<color>';inherits:true;initial-value:#0f172a}
  @property --pill-from{ syntax:'<color>';inherits:true;initial-value:#6366f1}
  @property --pill-to{   syntax:'<color>';inherits:true;initial-value:#06b6d4}
  @property --divider{   syntax:'<color>';inherits:true;initial-value:color-mix(in oklab, var(--accent) 55%, var(--border))}

  :host{
    all: initial;

    /* Default theme */
    --bg:rgba(10,12,18,.6);
    --fg:#e5e7eb;
    --muted:rgba(229,231,235,.08);
    --soft:rgba(229,231,235,.05);
    --accent:#60a5fa;
    --border:rgba(148,163,184,.2);
    --shadow:rgba(0,0,0,.45);
    --tab-bg:#fff;
    --tab-fg:#0f172a;
    --pill-from:#6366f1;
    --pill-to:#06b6d4;
    --divider: color-mix(in oklab, var(--accent) 55%, var(--border));

    /* Layout tokens */
    --w:480px;
    --radius:18px;
    --pad:14px;
    --tab-h:64px;
    --glass-blur:14px;

    /* Safe areas */
    --inset-t: env(safe-area-inset-top, 0px);
    --inset-r: env(safe-area-inset-right, 0px);
    --inset-b: env(safe-area-inset-bottom, 0px);
    --inset-l: env(safe-area-inset-left, 0px);

    /* Badges */
    --badge-py:6px;
    --badge-px:12px;
    --badge-fs:13px;
    --badge-radius:12px;

    /* Cards */
    --card-accent-w: 3px;

    /* Buttons (tokens only, not the component style) */
    --btn-py: 10px;
    --btn-px: 14px;
    --btn-minh: 40px;
    --btn-radius: 12px;
    --btn-fg: var(--fg);
    --btn-border: color-mix(in oklab, var(--border) 70%, transparent);
    --btn-border-hover: color-mix(in oklab, var(--accent) 40%, var(--border));
    --btn-shadow: 0 6px 18px color-mix(in oklab, var(--shadow) 35%, transparent);
    --btn-bg-start: color-mix(in oklab, var(--soft) 85%, transparent);
    --btn-bg-end:   color-mix(in oklab, var(--soft) 60%, transparent);
    --btn-primary-fg: var(--fg);
    --btn-primary-border: color-mix(in oklab, var(--accent) 55%, var(--border));
    --btn-primary-bg-start: color-mix(in oklab, var(--accent) 30%, transparent);
    --btn-primary-bg-end:   color-mix(in oklab, var(--accent) 45%, transparent);

    /* Table tokens */
    --lg-cols: 1fr;
    --lg-row-min-h: 36px;
    --lg-row-h: 70px;
    --tbl-max-h: auto;

    /* Font */
    --font-ui: system-ui, -apple-system, "Segoe UI", Roboto, Inter,
               "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
    font-family: var(--font-ui);
  }

  :host *, :host *::before, :host *::after { font-family: inherit; }

  /* Theme transitions */
  :host(.theme-anim){
    transition:
      --bg .28s ease, --fg .28s ease, --muted .28s ease, --soft .28s ease,
      --accent .28s ease, --border .28s ease, --divider .28s ease,
      --tab-bg .28s ease, --tab-fg .28s ease,
      --pill-from .28s ease, --pill-to .28s ease;
  }
  @supports not (property: --bg) {
    :host(.theme-anim){ transition:filter .22s ease; filter:saturate(108%) brightness(1.02); }
  }

  /* Global smooth font rendering */
  :host, * { -webkit-font-smoothing: antialiased; }

  /* Responsive tweaks via tokens (no structural changes here) */
  @media (max-width: 1024px){
    :host{ --w: min(92vw, 560px); }
  }
  @media (max-width: 720px){
    :host{ --w: 100vw; --tab-h:56px; }
  }
  @media (max-width: 480px){
    :host{ --w: 100vw; --tab-h:52px; --pad:12px; }
  }
  @media (max-width: 360px){
    :host{ --tab-h:48px; }
  }
}
`,S4=`
@layer primitives {
  /* Section container */
  .gemini-section { display: block; }

  /* ---- Key-value grid ---- */
  .kv > * { min-width: 0; }
  .kv {
    display: grid;
    grid-template-columns: minmax(110px, 160px) 1fr;
    gap: 10px 14px;
    align-items: center;
  }

  /* ---- Input wrapper ---- */
  .gemini-input-wrap {
    display: flex;
    align-items: center;
    gap: 10px;
    width: 100%;
  }
  .gemini-input-label {
    min-width: 160px;
    opacity: 0.85;
    font-weight: 600;
  }

  /* ---- Basic input ---- */
  .input {
    all: unset;
    display: inline-flex;
    align-items: center;
    width: 100%;
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 10px 12px;
    box-sizing: border-box;
    background-color: color-mix(in oklab, var(--soft) 80%, transparent);
    color: var(--fg);
    font-size: 13px;
    min-height: 36px;
    line-height: 1.2;
    transition: background-color 0.28s ease, border-color 0.28s ease, color 0.28s ease;
  }
  .input:focus {
    outline: 2px solid color-mix(in oklab, var(--accent) 45%, transparent);
  }
  .input:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  /* ---- Labels ---- */
  .gemini-label-wrap {
    display: flex;
    flex-direction: column;
    gap: 6px;
    min-width: 0;
  }
  .gemini-label {
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--fg);
    font-weight: 600;
    line-height: 1.2;
    white-space: nowrap;
  }
  .gemini-label-icon {
    opacity: 0.9;
    font-size: 1em;
    line-height: 1;
  }
  .gemini-label-text {
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* ---- Responsive ---- */
  @media (max-width: 480px) {
    .kv {
      grid-template-columns: 1fr;
    }
    .kv.kv--inline-mobile {
      grid-template-columns: minmax(110px, 160px) 1fr;
      align-items: center;
    }
    .gemini-input-wrap {
      flex-direction: column;
      align-items: stretch;
      gap: 6px;
    }
    .gemini-input-label {
      min-width: 0;
    }
  }
}
`,k4=`
@layer utilities {
  /* Generic utilities, without component styling */

  /* Accessibility */
  .sr-only{
    position:absolute !important;
    width:1px;height:1px;
    padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;
  }

  /* Quick layout helpers */
  .u-flex{ display:flex !important; }
  .u-grid{ display:grid !important; }
  .u-center{ display:flex !important; align-items:center !important; justify-content:center !important; }
  .u-grid-center{ display:grid !important; place-items:center !important; }
  .u-col{ display:flex !important; flex-direction:column !important; }
  .u-flex-1{ flex:1 1 auto !important; }
  .u-row{ display:flex !important; flex-direction:row !important; }
  .u-align-center{ align-items:center !important; }
  .u-justify-between{ justify-content:space-between !important; }
  .u-justify-start{ justify-content:flex-start !important; }
  .u-justify-center{ justify-content:center !important; }
  .u-full{ width:100% !important; }
  .u-h-full{ height:100% !important; }
  .u-minh-0{ min-height:0 !important; }
  .u-nowrap{ white-space:nowrap !important; }
  .u-ellipsis{ overflow:hidden !important; text-overflow:ellipsis !important; white-space:nowrap !important; }
  .u-gap-6{ gap:6px !important; }
  .u-gap-8{ gap:8px !important; }
  .u-gap-12{ gap:12px !important; }
  .u-gap-10{ gap:10px !important; }
  .u-mb-8{ margin-bottom:8px !important; }
  .u-mt-12{ margin-top:12px !important; }

  /* Behaviors */
  .u-scroll-y{ overflow-y:auto !important; }
  .u-no-select{ user-select:none !important; }
  .u-pointer{ cursor:pointer !important; }

  /* Small grouped action areas (e.g., to the right of a read-only value) */
  .kv-actions{ display:inline-flex; gap:6px; }

  /* Compact read-only values (shared primitive) */
  .ro{
    display:inline-flex; align-items:center; width:100%;
    border:1px solid var(--border); border-radius:12px; padding:8px 10px; box-sizing:border-box;
    background-color:color-mix(in oklab, var(--soft) 80%, transparent);
    color:var(--fg); font: 12.5px/1.35 var(--font-ui);
    white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  }

  /* Small circular help icon */
  .u-help-ico{
    display:inline-flex; align-items:center; justify-content:center;
    width:20px; height:20px; border:1px solid var(--border); border-radius:999px;
    font: 12px/1 ui-monospace, SFMono-Regular, Menlo, Consolas;
    opacity:.9; cursor:help; user-select:none;
    background: linear-gradient(
      180deg,
      color-mix(in oklab, var(--soft) 85%, transparent) 0%,
      color-mix(in oklab, var(--soft) 60%, transparent) 100%
    );
  }
}
`,_4=`
@layer components {
  /* ===== Card (base) ===== */
  .card{
    border:1px solid var(--border);
    border-radius:16px;
    padding:12px;
    background-color: color-mix(in oklab, var(--bg) 88%, transparent);
    box-shadow:0 10px 24px color-mix(in oklab, var(--shadow) 40%, transparent);
    transition:
      background-color .28s ease,
      border-color .28s ease,
      box-shadow .28s ease,
      color .28s ease;
    border-left-color: var(--border);
  }

  .card--expandable{
    overflow:hidden;
  }
  .card--expandable.card--expanded{
    overflow:visible;
  }

  .card-collapse{
    display:block;
    overflow:hidden;
    transition:
      height .24s cubic-bezier(.2,.8,.2,1),
      opacity .2s ease;
  }
  .card-collapse--animating{
    pointer-events:none;
    will-change: height, opacity;
    overflow:hidden !important;
  }
  .card--expanded .card-collapse{
    overflow:visible;
  }

  /* —— Sous-structure —— */
  .card-header{
    margin-bottom:8px;
    display:flex;
    align-items:center;
    gap:12px;
    justify-content:space-between;
  }
  .card-body{ display:block; }
  .card-footer{
    margin-top:10px;
    display:flex;
    gap:8px;
    align-items:center;
    justify-content:flex-end;
  }

  .card--collapsed .card-header{
    margin-bottom:0;
  }
  .card--collapsed .card-header--expandable{
    margin:-6px -8px 0;
  }

  .card-header--expandable{
    cursor:pointer;
    user-select:none;
    border-radius:12px;
    padding:6px 8px;
    margin:-6px -8px 8px;
    transition: background-color .2s ease, color .2s ease;
  }
  .card-header--expandable:hover{
    background: color-mix(in oklab, var(--soft) 82%, transparent);
  }
  .card-header--expandable:active{
    background: color-mix(in oklab, var(--soft) 72%, transparent);
  }

  .card-toggle{
    appearance:none;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    padding:2px 4px;
    border:none;
    background:transparent;
    color: var(--fg);
    font: 700 14px/1 var(--font-ui, system-ui);
    cursor:pointer;
    transition: color .2s ease, transform .12s ease;
  }
  .card-toggle:hover{
    color: color-mix(in oklab, var(--accent) 45%, var(--fg));
  }
  .card-toggle:active{
    transform: translateY(1px);
  }

  /* Media block flowing inside the card */
  .card-media img,
  .card-media video,
  .card-media canvas{
    display:block;
    width:100%;
    border-radius:12px;
  }

  /* Divider tinted by the theme */
  .card-divider{
    height:1px;
    margin:8px -2px;
    border-radius:1px;
    background: linear-gradient(
      90deg,
      color-mix(in oklab, var(--pill-from) 52%, var(--border)),
      color-mix(in oklab, var(--pill-to) 48%, var(--border))
    );
    box-shadow: 0 0 0 1px color-mix(in oklab, var(--border) 55%, transparent) inset;
  }

  /* ===== Appearance variants ===== */
  .card--soft {
    background: color-mix(in oklab, var(--bg) 82%, transparent);
  }
  .card--glass {
    background: color-mix(in oklab, var(--bg) 70%, transparent);
    backdrop-filter: blur(var(--glass-blur));
    -webkit-backdrop-filter: blur(var(--glass-blur));
  }
  .card--outline {
    background: transparent;
    border-style: dashed;
  }

  /* Padding variants (control body padding) */
  .card--p-none .card-body { padding: 0; }
  .card--p-sm   .card-body { padding: 8px; }
  .card--p-md   .card-body { padding: 12px; }
  .card--p-lg   .card-body { padding: 16px; }

  /* Lateral accent on hover (if interactive) */
  .card--interactive {
    transition: transform .04s, box-shadow .2s;
    cursor: pointer;
  }
  .card--interactive:hover {
    box-shadow: 0 12px 28px color-mix(in oklab, var(--shadow) 45%, transparent);
    border-left-color: var(--divider);
  }

  /* Optional explicit accent bar */
  .card-accent { display:none; }

  /* Explicit tones (force the accent color) */
  .card--tone-info{
    border-left-width: var(--card-accent-w, 4px);
    border-left-color: var(--info);
  }
  .card--tone-success{
    border-left-width: var(--card-accent-w, 4px);
    border-left-color: var(--high);
  }
  .card--tone-warning{
    border-left-width: var(--card-accent-w, 4px);
    border-left-color: var(--medium);
  }
  .card--tone-danger{
    border-left-width: var(--card-accent-w, 4px);
    border-left-color: var(--low);
  }
}
  
`,A4=`
.btn{
  appearance:none;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:8px;

  padding: var(--btn-py, 10px) var(--btn-px, 14px);
  min-height: var(--btn-minh, 40px);
  border-radius: var(--btn-radius, 12px);

  border:1px solid var(--btn-border, color-mix(in oklab, var(--border) 70%, transparent));
  background: linear-gradient(
    180deg,
    var(--btn-bg-start, color-mix(in oklab, var(--soft) 85%, transparent)) 0%,
    var(--btn-bg-end,   color-mix(in oklab, var(--soft) 60%, transparent)) 100%
  );

  color: var(--btn-fg, var(--fg));
  font: 500 13px/1 var(--font-ui, system-ui);
  letter-spacing:.2px;
  cursor:pointer;

  transition:
    transform .05s,
    box-shadow .2s,
    background .2s,
    border-color .28s ease,
    color .28s ease;

  box-shadow: var(--btn-shadow, 0 6px 18px color-mix(in oklab, var(--shadow) 35%, transparent));
  position: relative;
  isolation: isolate;
  -webkit-tap-highlight-color: transparent;
}

.btn:hover{
  border-color: var(--btn-border-hover, color-mix(in oklab, var(--accent) 40%, var(--border)));
}

.btn:active{
  transform: translateY(1px);
}

.btn:focus-visible{
  outline: none;
  box-shadow:
    0 0 0 2px color-mix(in oklab, var(--accent) 45%, transparent),
    var(--btn-shadow, 0 6px 18px color-mix(in oklab, var(--shadow) 35%, transparent));
}

.btn:disabled,
.btn[disabled],
.btn[aria-busy="true"]{
  opacity:.6;
  cursor:not-allowed;
  filter:saturate(92%);
}

/* Inner content */
.btn .btn-label{
  display:inline-flex;
  align-items:center;
  line-height:1;
}

.btn-ico{
  display:inline-flex;
  align-items:center;
  line-height:0;
}
.btn-ico--left{ margin-right:2px; }
.btn-ico--right{ margin-left:2px; }

/* Variants */
.btn.primary{
  background: linear-gradient(
    180deg,
    var(--btn-primary-bg-start, color-mix(in oklab, var(--accent) 30%, transparent)) 0%,
    var(--btn-primary-bg-end,   color-mix(in oklab, var(--accent) 45%, transparent)) 100%
  );
  border-color: var(--btn-primary-border, color-mix(in oklab, var(--accent) 55%, var(--border)));
  color: var(--btn-primary-fg, var(--fg));
}
.btn.primary:hover{
  border-color: color-mix(in oklab, var(--accent) 65%, var(--border));
  filter: brightness(1.02);
}
.btn.primary:active{
  transform: translateY(1px);
  filter: brightness(.98);
}

/* Sizes */
.btn--sm{
  padding:6px 10px;
  min-height:32px;
  border-radius:10px;
  font-size:12px;
}
.btn--lg{
  padding:12px 16px;
  min-height:44px;
  border-radius:14px;
  font-size:14px;
}

/* Icon-only */
.btn.btn--icon{
  padding:8px;
  min-width:36px;
  min-height:36px;
}
.btn.btn--icon.btn--sm{
  min-width:32px;
  min-height:32px;
  padding:6px;
}

/* Full width */
.btn--full{ width:100%; }

/* Busy: external spinner controls visibility,
   but ensure hidden icons can still be revealed */
.btn[aria-busy="true"] svg[aria-hidden="true"]{
  display:inline-block !important;
}

/* In a .kv container (aligned with your inputs) */
.kv .btn--full{ width:100%; }
`,E4=`
/* Optional wrapper for labels + field */
.lg-input-wrap{
  display:flex;
  align-items:center;
  gap:10px;
  width:100%;
  min-width:0; /* autorise le shrink */
}

/* Label on the left (uses a token for min width) */
.lg-input-label{
  min-width: var(--input-label-minw, 160px);
  opacity:.85;
  font-weight:600;
  color: var(--fg);
  white-space: nowrap;
}

/* Champ */
.input{
  all:unset;
  display:inline-flex;
  align-items:center;
  width:100%;
  min-width:0;

  box-sizing:border-box;
  padding: var(--input-py, 10px) var(--input-px, 12px);
  min-height: var(--input-minh, 36px);
  line-height:1.2;
  font-size: var(--input-fs, 13px);

  border:1px solid var(--border);
  border-radius: var(--input-radius, 12px);

  background-color: color-mix(in oklab, var(--soft) 80%, transparent);
  color: var(--fg);

  transition:
    background-color .28s ease,
    border-color .28s ease,
    color .28s ease,
    box-shadow .2s ease;
  -webkit-tap-highlight-color: transparent;
}

/* Placeholder lisible sans hurler */
.input::placeholder{
  color: color-mix(in oklab, var(--fg) 70%, #9ca3af);
  opacity:.9;
}

/* Focus accessible */
.input:focus,
.input:focus-visible{
  outline: 2px solid color-mix(in oklab, var(--accent) 45%, transparent);
  outline-offset: 0; /* le contour remplace la box-shadow */
}

/* Disabled */
.input:disabled,
.input[disabled]{
  opacity:.6;
  cursor:not-allowed;
}

/* Tailles */
.input--sm{
  --input-py: 8px;
  --input-px: 10px;
  --input-minh: 32px;
  --input-radius: 10px;
  --input-fs: 12px;
}

.input--lg{
  --input-py: 12px;
  --input-px: 14px;
  --input-minh: 44px;
  --input-radius: 14px;
  --input-fs: 14px;
}

/* Pleine largeur utilitaire */
.input--full{ width:100%; }

/* Automatic label shrinking on small screens */
@media (max-width: 720px){
  .lg-input-label{ min-width: var(--input-label-minw-sm, 120px); }
}

/* Vertical stack for very small screens (when used with .kv elsewhere) */
@media (max-width: 480px){
  .lg-input-wrap{
    flex-direction:column;
    align-items:stretch;
    gap:6px;
  }
  .lg-input-label{
    min-width:0;
  }
}
`,T4=`
.lg-label-wrap{
  display:flex;
  flex-direction:column;
  gap:6px;
  min-width:0;
}

/* Ligne principale du label */
.lg-label{
  display:flex;
  align-items:center;
  gap:8px;
  color: var(--fg);
  font-weight:600;
  line-height:1.2;
  white-space:nowrap;
  transition: color .28s ease, opacity .2s ease;
}

/* Optional icon on the left */
.lg-label-ico{
  opacity:.9;
  font-size:1em;
  line-height:1;
}

/* Label text, neatly truncated */
.lg-label-text{
  overflow:hidden;
  text-overflow:ellipsis;
}

/* Required asterisk */
.lg-label-req{
  color: color-mix(in oklab, #ef4444 70%, var(--fg));
  font-weight:700;
}

/* Suffix slot on the right (badge, help, actions) */
.lg-label-suffix{
  margin-left:auto;
  display:inline-flex;
  align-items:center;
  gap:6px;
}

/* Hint sous le label */
.lg-label-hint{
  font-size:12px;
  opacity:.8;
  color: color-mix(in oklab, var(--fg) 80%, #9ca3af);
  line-height:1.25;
  white-space:normal;
}

/* Tones (couleurs de texte) */
.lg-label--default .lg-label{ color: var(--fg); }
.lg-label--muted   .lg-label{ color: color-mix(in oklab, var(--fg) 72%, #9ca3af); }
.lg-label--info    .lg-label{ color: color-mix(in oklab, #38bdf8 72%, var(--fg)); }
.lg-label--success .lg-label{ color: color-mix(in oklab, #22c55e 72%, var(--fg)); }
.lg-label--warning .lg-label{ color: color-mix(in oklab, #f59e0b 80%, var(--fg)); }
.lg-label--danger  .lg-label{ color: color-mix(in oklab, #ef4444 80%, var(--fg)); }

/* Disabled (sur un conteneur parent) */
.is-disabled .lg-label{ opacity:.6; cursor:not-allowed; }

/* Tailles */
.lg-label--sm .lg-label{ font-size:12px; }
.lg-label--md .lg-label{ font-size:13px; }
.lg-label--lg .lg-label{ font-size:14px; }

/* “Stacked” variant (forces title no-wrap) */
.lg-label--stacked .lg-label{ white-space:nowrap; }

/* Variant: title (plus gros, comme un titre compact) */
.lg-label--title .lg-label{
  font-size:16px;
  font-weight:700;
  line-height:1.25;
}

/* Small screens: give the suffix some room if needed */
@media (max-width: 480px){
  .lg-label{ gap:6px; }
  .lg-label-suffix{ gap:4px; }
}
`,I4=`
/* Bar container (provided by the HUD, also useful when NavTabs is standalone) */
.lg-tabbar{
  position: relative;
  height: var(--tab-h);
  display: grid;
  grid-template-columns: minmax(0, 1fr) auto; /* tabs that stretch + action slot on the right */
  align-items: center;
  gap: 20px;
  padding: 12px 12px;
  background-color: color-mix(in oklab, var(--bg) 92%, transparent);
  transition: background-color .28s ease, border-color .28s ease;
}

/* Wrapper containing arrows + tabs container */
.lg-tabs-wrapper{
  position: relative;
  display: flex;
  align-items: center;
  gap: 8px;
  min-width: 0;
  width: 100%;
}

/* Ribbon containing the tabs */
.lg-tabs{
  position: relative;
  display: flex;
  align-items: center;
  gap: 2px;

  min-width: 0;       /* allow shrink */
  flex: 1 1 auto;
  max-width: none;

  background-color: var(--tab-bg);
  color: var(--tab-fg);
  border-radius: 999px;
  padding: 6px;

  box-shadow: 0 4px 12px color-mix(in oklab, var(--shadow) 32%, transparent);

  overflow: hidden;
  scrollbar-width: none;
  transition: background-color .28s ease, color .28s ease;
  scroll-behavior: smooth;
}
.lg-tabs::-webkit-scrollbar{ display:none; }

/* Scroll arrow buttons */
.lg-tabs-arrow{
  position: relative;
  flex: 0 0 32px;
  height: 32px;
  border-radius: 8px;
  border: 1px solid color-mix(in oklab, var(--border) 60%, transparent);
  background: linear-gradient(180deg,
    color-mix(in oklab, var(--soft) 75%, transparent) 0%,
    color-mix(in oklab, var(--soft) 65%, transparent) 100%
  );
  color: var(--fg);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;

  transition: all .2s cubic-bezier(.2,.8,.2,1);
  opacity: 1;
  box-shadow: 0 2px 6px color-mix(in oklab, var(--shadow) 12%, transparent);
}

.lg-tabs-arrow svg{
  width: 16px;
  height: 16px;
  stroke: currentColor;
}

.lg-tabs-arrow:hover:not(.disabled){
  background: linear-gradient(180deg,
    color-mix(in oklab, var(--soft) 88%, transparent) 0%,
    color-mix(in oklab, var(--soft) 78%, transparent) 100%
  );
  border-color: color-mix(in oklab, var(--accent) 50%, var(--border));
  box-shadow: 0 4px 12px color-mix(in oklab, var(--accent) 25%, transparent);
  transform: translateY(-2px);
}

.lg-tabs-arrow:active:not(.disabled){
  transform: scale(.96) translateY(0);
  box-shadow: 0 1px 3px color-mix(in oklab, var(--shadow) 20%, transparent);
}

.lg-tabs-arrow.disabled{
  opacity: .35;
  cursor: not-allowed;
  box-shadow: none;
}

/* Tab button */
.lg-tab{
  position: relative;
  z-index: 1;
  flex: 0 0 auto;
  padding: 10px 18px;
  border-radius: 999px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;

  background: transparent;
  border: none;
  color: inherit;
  opacity: .85;

  white-space: nowrap;
  transition: opacity .15s, transform .05s;
}
.lg-tab:hover{ opacity: 1; }
.lg-tab:active{ transform: translateY(1px); }

/* Animated pill behind the active tab (managed in JS) */
.lg-pill{
  position: absolute;
  z-index: 0;
  top: 6px;
  left: 0;
  height: calc(100% - 12px);
  width: 0;
  border-radius: 999px;

  background: linear-gradient(135deg, var(--pill-from), var(--pill-to));
  box-shadow: 0 8px 22px rgba(0,0,0,.18);

  transition: transform .25s cubic-bezier(.2,.8,.2,1), width .25s cubic-bezier(.2,.8,.2,1);
  will-change: transform, width;
}

/* Density and responsive */
@media (max-width: 720px){
  .lg-tabbar{
    padding: 8px max(8px, var(--inset-l)) 8px max(8px, var(--inset-r));
    gap: 12px;
  }
  .lg-tabs-wrapper{ gap: 6px; }
  .lg-tabs-arrow{
    flex: 0 0 28px;
    height: 28px;
    border-radius: 7px;
  }
  .lg-tabs-arrow svg{ width: 15px; height: 15px; }
  .lg-tabs{ padding: 5px; }
  .lg-tab{ padding: 9px 14px; font-size: 13.5px; }
  .lg-pill{ top: 5px; height: calc(100% - 10px); }
}

/* Mobile: hide arrows, enable swipe with better feedback */
@media (max-width: 480px){
  .lg-tabbar{
    padding: 12px max(10px, var(--inset-l)) 12px max(10px, var(--inset-r));
    gap: 12px;
  }
  .lg-tabs-wrapper{
    gap: 0;
  }
  /* Hide arrow buttons on mobile completely */
  .lg-tabs-arrow{
    display: none !important;
  }
  .lg-tabs{
    border-radius: 14px;
    padding: 4px;
    /* Enable native touch scrolling behavior with momentum */
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
    /* Improve touch responsiveness */
    touch-action: pan-x;
  }
  .lg-tab{
    padding: 8px 12px;
    font-size: 13px;
    /* Slightly larger touch target on mobile */
    min-width: 60px;
  }
  .lg-pill{
    top: 4px;
    height: calc(100% - 8px);
  }
}

@media (max-width: 360px){
  .lg-tab{
    padding: 6px 10px;
    font-size: 12px;
    min-width: 50px;
  }
}
`,P4=`
/* ==================== SearchBar ==================== */
.search{
  display:flex;
  align-items:stretch;
  gap:8px;
  width:100%;
}

.search-field{
  position:relative;
  flex:1 1 auto;
  display:flex;
  align-items:center;
  min-width:0;
}

/* Inherits global .input styles for visual consistency */
.search-input{
  all:unset;
  display:inline-flex;
  align-items:center;
  width:100%;
  border:1px solid var(--border);
  border-radius:12px;
  padding:10px 12px;
  box-sizing:border-box;
  background-color: color-mix(in oklab, var(--soft) 80%, transparent);
  color: var(--fg);
  font-size:13px;
  min-height:40px;
  line-height:1.2;
  transition: background-color .28s ease, border-color .28s ease, color .28s ease;

  /* Space for left icon + actions on the right */
  padding-left:36px;
  padding-right:82px;
}

.search-input:focus{
  outline:2px solid color-mix(in oklab, var(--accent) 45%, transparent);
}

/* Sizes */
.search--sm .search-input{ min-height:36px; font-size:12.5px; }
.search--lg .search-input{ min-height:44px; font-size:14px; }

/* Icons */
.search-ico{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  display:inline-flex;
  align-items:center;
  justify-content:center;
  color: color-mix(in oklab, var(--fg) 82%, #9ca3af);
  opacity:.95;
  pointer-events:none;
  user-select:none;
  font: 12px/1 ui-monospace, SFMono-Regular, Menlo, Consolas;
}

.search-ico--left{ left: 10px; }
.search-ico--right{ right: 46px; }

.search--sm .search-ico,
.search--sm .search-clear,
.search--sm .search-spinner{ transform: translateY(-50%) scale(.95); }

.search--lg .search-ico,
.search--lg .search-clear,
.search--lg .search-spinner{ transform: translateY(-50%) scale(1.05); }

/* Spinner on the right */
.search-spinner{
  position:absolute;
  top:50%;
  right:24px;
  transform:translateY(-50%);
  opacity:.9;
}
.search.is-loading .search-ico--right{ opacity:.35; }

/* Clear button */
.search-clear{
  position:absolute;
  top:50%;
  right:6px;
  transform:translateY(-50%);
  width:28px;
  height:28px;
  border-radius:999px;
  display:inline-grid;
  place-items:center;

  border:1px solid color-mix(in oklab, var(--border) 70%, transparent);
  background: linear-gradient(
    180deg,
    color-mix(in oklab, var(--soft) 85%, transparent) 0%,
    color-mix(in oklab, var(--soft) 62%, transparent) 100%
  );
  color: color-mix(in oklab, var(--fg) 86%, #a3a3a3);

  font: 14px/1 var(--font-ui);
  cursor:pointer;
  box-shadow:0 6px 16px color-mix(in oklab, var(--shadow) 35%, transparent);
  transition: border-color .2s ease, background .2s ease, transform .05s, color .2s ease;
}
.search-clear:hover{
  border-color: color-mix(in oklab, var(--accent) 40%, var(--border));
  color: var(--fg);
}
.search-clear:active{ transform: translateY(-50%) scale(.98); }

/* Slot bouton submit (optionnel) */
.search-submit{ flex: 0 0 auto; }

/* Disabled */
.search.disabled .search-input{ opacity:.6; cursor:not-allowed; }
.search.disabled .search-clear{ opacity:.6; pointer-events:none; }

/* KV grid integration */
.kv .search{ width:100%; }
.kv.kv-tight{ grid-template-columns: minmax(110px,160px) 1fr; }
.kv.kv-tight .lg-label-wrap{ margin-right:0; }
.kv.kv-tight .search-field .search-input{
  border-top-left-radius: 0;
  border-bottom-left-radius: 0;
}
.kv.kv-tight .lg-label-wrap .lg-label{
  border:1px solid var(--border);
  border-right:none;
  padding:10px 12px;
  border-top-left-radius:12px;
  border-bottom-left-radius:12px;
  background: color-mix(in oklab, var(--soft) 82%, transparent);
}

/* Final responsive tweak */
@media (max-width: 480px){
  .search-input{ min-height:44px; }
}
`,M4=`
/* ==================== Select ==================== */
.select{
  position:relative;
  display:inline-block;
  min-width:180px;
}

.select.sm { min-width: 160px; }
.select.md { min-width: 180px; } /* default value */
.select.lg { min-width: 220px; }

.select.shrink { min-width: 0; }

.select.disabled{
  opacity:.6;
  pointer-events:none;
}

/* Trigger */
.select-trigger{
  appearance:none;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;

  width:100%;
  padding:10px 12px;
  min-height:40px;
  line-height:1;

  border-radius:12px;
  border:1px solid color-mix(in oklab, var(--border) 70%, transparent);
  background:linear-gradient(
    180deg,
    color-mix(in oklab, var(--soft) 85%, transparent) 0%,
    color-mix(in oklab, var(--soft) 60%, transparent) 100%
  );
  color:var(--fg);
  font-size:13px;
  font-weight:550;
  letter-spacing:.2px;

  cursor:pointer;
  transition:transform .05s, box-shadow .2s, background .2s,
             border-color .28s ease, color .28s ease;
  box-shadow:0 6px 18px color-mix(in oklab, var(--shadow) 35%, transparent);
}
.select-trigger:hover{
  border-color:color-mix(in oklab, var(--accent) 40%, var(--border));
}
.select-trigger:active{
  transform:translateY(1px);
}
.select-caret{
  opacity:.8;
  font:12px/1 ui-monospace,SFMono-Regular,Menlo,Consolas;
}

/* Sizes */
.select--sm .select-trigger{
  padding:6px 10px;
  min-height:36px;
  border-radius:10px;
  font-size:12px;
}
.select--lg .select-trigger{
  padding:12px 14px;
  min-height:44px;
  font-size:14px;
}

/* Menu */
.select-menu{
  position:absolute;
  left:0;
  top:calc(100% + 6px);
  z-index:20;

  display:none;
  max-height:240px;
  overflow:auto;

  padding:6px;
  border-radius:12px;
  border:1px solid var(--border);
  background-color:color-mix(in oklab, var(--bg) 88%, transparent);
  box-shadow:0 10px 24px color-mix(in oklab, var(--shadow) 40%, transparent);
  backdrop-filter:blur(var(--glass-blur));
  -webkit-backdrop-filter:blur(var(--glass-blur));

  transition:background-color .28s ease, border-color .28s ease,
             color .28s ease, box-shadow .28s ease;
}
.select.open .select-menu{ display:block; }

/* Options */
.select-option{
  width:100%;
  text-align:left;

  padding:8px 10px;
  border-radius:10px;
  border:1px solid transparent;

  background:transparent;
  color:var(--fg);
  font-size:13px;
  font-weight:550;
  line-height:1.15;

  cursor:pointer;
  transition:background-color .15s, border-color .15s, color .15s;
}
.select-option:hover,
.select-option.active{
  background:color-mix(in oklab, var(--soft) 85%, transparent);
  border-color:color-mix(in oklab, var(--border) 60%, transparent);
}
.select-option.selected{
  background:color-mix(in oklab, var(--accent) 22%, transparent);
  border-color:color-mix(in oklab, var(--accent) 50%, var(--border));
}
.select-option.disabled{
  opacity:.5;
  cursor:not-allowed;
}

/* KV integration */
.kv .select{ width:100%; }

/* Mobile tweaks */
@media (max-width: 480px){
  .select{ min-width:0; width:100%; }
  .select-menu{
    left:0;
    right:0;
    min-width:100%;
    max-height:min(50dvh, 360px);
  }
}
`,L4=`
/* ==================== Switch ==================== */

.lg-switch-wrap{
  display:inline-flex;
  align-items:center;
  gap:10px;
}

/* Track */
.lg-switch{
  --sw-w: 44px;
  --sw-h: 24px;
  --sw-gap: 2px;

  --sw-border: var(--border);
  --sw-off: color-mix(in oklab, var(--soft) 82%, transparent);
  --sw-on:  color-mix(in oklab, var(--accent) 38%, transparent);
  --thumb: var(--switch-thumb);

  position:relative;
  width: var(--sw-w);
  height: var(--sw-h);
  border-radius: 999px;
  border:1px solid var(--sw-border);
  background: var(--sw-off);
  cursor:pointer;
  transition: background .18s ease, border-color .18s ease, box-shadow .18s ease;
  box-shadow: 0 4px 14px color-mix(in oklab, var(--shadow) 30%, transparent);
}

/* On state */
.lg-switch.on{
  background: var(--sw-on);
  border-color: color-mix(in oklab, var(--accent) 55%, var(--border));
}

/* Thumb */
.lg-switch-thumb{
  position:absolute;
  top:50%;
  left: var(--sw-gap);
  width: calc(var(--sw-h) - 2*var(--sw-gap));
  height: calc(var(--sw-h) - 2*var(--sw-gap));
  border-radius: 999px;
  background: var(--thumb);
  transform: translate(0, -50%);
  transition: left .18s ease, background .18s ease, box-shadow .18s ease;
  box-shadow: 0 2px 8px color-mix(in oklab, var(--shadow) 40%, transparent);
}

.lg-switch.on .lg-switch-thumb{
  left: calc(100% - var(--sw-gap) - (var(--sw-h) - 2*var(--sw-gap)));
}

/* Sizes */
.lg-switch--sm{
  --sw-w: 36px;
  --sw-h: 20px;
  --sw-gap: 2px;
}
.lg-switch--md{
  --sw-w: 44px;
  --sw-h: 24px;
  --sw-gap: 2px;
}
.lg-switch--lg{
  --sw-w: 56px;
  --sw-h: 30px;
  --sw-gap: 3px;
}

/* Disabled (if you manage a state) */
.lg-switch[aria-disabled="true"],
.lg-switch.disabled{
  opacity:.6;
  cursor:not-allowed;
  filter:saturate(92%);
}
`,R4=`
/* ==================== Checkbox ==================== */

.lg-checkbox-wrap {
  display: inline-flex;
  align-items: center;
  gap: 10px;
  position: relative;
}

.lg-checkbox {
  --cb-size: 20px;
  --cb-border: var(--border);
  --cb-bg: var(--soft);
  --cb-checked-bg: var(--accent);
  --cb-checked-border: var(--accent);
  --cb-checkmark: #fff;

  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  width: var(--cb-size);
  height: var(--cb-size);
  border-radius: 4px;
  border: 1px solid var(--cb-border);
  background: var(--cb-bg);
  cursor: pointer;
  transition: background 0.18s ease, border-color 0.18s ease, box-shadow 0.18s ease;
  box-shadow: 0 2px 8px color-mix(in oklab, var(--shadow) 20%, transparent);
  flex-shrink: 0;
  padding: 0;
  margin: 0;
  position: relative;
}

.lg-checkbox:hover:not(:disabled) {
  border-color: color-mix(in oklab, var(--accent) 40%, var(--border));
  box-shadow: 0 2px 8px color-mix(in oklab, var(--shadow) 30%, transparent);
}

.lg-checkbox:focus-visible {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}

.lg-checkbox:checked {
  background: var(--cb-checked-bg);
  border-color: var(--cb-checked-border);
}

.lg-checkbox:checked::after {
  content: '';
  position: absolute;
  top: 45%;
  left: 50%;
  transform: translate(-40%, -50%) rotate(45deg);
  width: 5px;
  height: 9px;
  border: solid var(--cb-checkmark);
  border-width: 0 2px 2px 0;
  opacity: 1;
}

.lg-checkbox:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  filter: saturate(92%);
}

.lg-checkbox-label {
  font-size: 14px;
  color: var(--fg);
  user-select: none;
  cursor: pointer;
}

.lg-checkbox:disabled ~ .lg-checkbox-label {
  opacity: 0.6;
  cursor: not-allowed;
}

/* Sizes */
.lg-checkbox--sm {
  --cb-size: 16px;
}

.lg-checkbox--md {
  --cb-size: 20px;
}

.lg-checkbox--lg {
  --cb-size: 24px;
}

.lg-checkbox--sm:checked::after {
  width: 3px;
  height: 7px;
  border-width: 0 1.5px 1.5px 0;
}

.lg-checkbox--lg:checked::after {
  width: 7px;
  height: 11px;
  border-width: 0 2.5px 2.5px 0;
}
`,O4=`
/* ==================== Table ==================== */

.lg-table-wrap{
  border:1px solid var(--border);
  border-radius:16px;
  background: color-mix(in oklab, var(--bg) 88%, transparent);
  box-shadow:0 10px 24px color-mix(in oklab, var(--shadow) 40%, transparent);
  overflow:hidden;
  display:grid;
}

/* Structure principale: header / body scrollable / footer */
.lg-table{
  display:grid;
  grid-template-rows:auto 1fr auto;
  min-width:0;
  min-height:0; /* autorise le scroll interne */
}

/* Head & Body strictly share the same column grid */
.lg-thead,
.lg-tbody{
  display:grid;
  grid-template-columns: var(--lg-cols);
  min-width:0;
}

/* Sticky header optionnel (activer via .lg-table-wrap.sticky) */
.lg-table-wrap.sticky .lg-thead{
  position:sticky;
  top:0;
  z-index:1;
  background: color-mix(in oklab, var(--bg) 92%, transparent);
}

/* Les <tr> ne doivent pas casser la grille */
.lg-tr{ display:contents; }

/* Cellules (header + body) */
.lg-th, .lg-td{
  min-width:0;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
  padding:10px 12px;
  display:flex;
  align-items:center;
  align-self:stretch;
  box-sizing:border-box;
  gap:8px;
  min-height: var(--lg-row-min-h, 36px);
  justify-content: var(--col-justify, flex-start);
  text-align: center; /* Fallback for text-only cells */
  border-bottom:1px solid color-mix(in oklab, var(--border) 80%, transparent);
}

/* Header: reset + chevrons de tri */
.lg-th{
  appearance:none;
  border:0;
  background: color-mix(in oklab, var(--bg) 92%, transparent);
  font: inherit;
  font-weight:700;
  color:var(--fg);
  position:relative;
  cursor:default;
  border-bottom:1px solid var(--border);
}
.lg-th:focus{ outline:none; }
.lg-th::-moz-focus-inner{ border:0; padding:0; }
.lg-th.sortable{ cursor:pointer; }

/* Sort icons (CSS triangles) */
.lg-th::after{
  content:"";
  position:absolute;
  right:8px;
  top:50%;
  transform:translateY(-50%);
  opacity:0;
  border:5px solid transparent;
  transition:opacity .15s, transform .15s;
}
.lg-th[data-sort="asc"]::after{
  opacity:.95;
  border-bottom-color: currentColor;
  transform:translateY(-40%);
}
.lg-th[data-sort="desc"]::after{
  opacity:.95;
  border-top-color: currentColor;
  transform:translateY(-60%);
}

/* Body: scroll interne fiable */
.lg-tbody{
  grid-auto-rows: var(--lg-row-h, 44px);
  max-height: var(--tbl-max-h, auto);
  overflow:auto;
  overflow-y:auto;
  overflow-x:auto;
  scrollbar-gutter:stable;
  min-height:0; /* key so scrolling does not jump */
}
.lg-tbody::-webkit-scrollbar {
  width: 10px;
}
.lg-tbody::-webkit-scrollbar-track {
  background: transparent;
}
.lg-tbody::-webkit-scrollbar-thumb {
  background: var(--muted);
  border-radius: 8px;
}
.lg-tbody::-webkit-scrollbar-thumb:hover {
  background: color-mix(in oklab, var(--muted) 150%, transparent);
}

/* Hover & clickable rows */
.lg-tr-body.clickable{ cursor:pointer; }
.lg-tr-body:hover .lg-td{
  background: color-mix(in oklab, var(--soft) 85%, transparent);
}

/* Zebra */
.lg-table-wrap.zebra .lg-tbody .lg-tr-body:nth-child(even) .lg-td{
  background: color-mix(in oklab, var(--soft) 80%, transparent);
}

/* Mode compact */
.lg-table-wrap.compact .lg-td,
.lg-table-wrap.compact .lg-th{
  padding:8px 10px;
}

/* Selection column (checkbox) */
.lg-table-wrap.selectable .lg-th-check,
.lg-table-wrap.selectable .lg-td-check{
  width: var(--check-w, 36px);
  min-width: var(--check-w, 36px);
  display:flex;
  justify-content:center;
  align-items:center;
  grid-column:1;
}

/* Normalisation du contenu interne des cellules */
.lg-th > *, .lg-td > *{ margin:0; }
.lg-td input, .lg-td button, .lg-td select{ margin:0; line-height:1; }
.lg-td .select-trigger, .lg-td .switch{ align-self:center; line-height:1; }

/* Footer (pager) */
.lg-tfoot{
  padding:8px 10px;
  border-top:1px solid var(--border);
  background: color-mix(in oklab, var(--bg) 92%, transparent);
}
.lg-pager{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:10px;
}
.lg-pager .btn{ padding:6px 10px; border-radius:10px; font-size:12px; }
.lg-pager-info{ opacity:.9; font-weight:600; }

/* Responsive arrondis et paddings plus doux */
@media (max-width:520px){
  .lg-table-wrap{ border-radius:12px; }
  .lg-td, .lg-th{ padding:8px 10px; }
  .lg-pager .btn{ padding:5px 8px; }
}

/* Animatable rows (when you insert/delete) */
.lg-tr-body.is-animating .lg-td {
  will-change: transform, opacity;
  transition: transform .18s ease, opacity .18s ease;
}
@media (prefers-reduced-motion: reduce) {
  .lg-tr-body.is-animating .lg-td { transition: none !important; }
}
`,F4=`
@keyframes teamClick {
  0% {
    transform: scale(1);
  }
  50% {
    transform: scale(0.98);
  }
  100% {
    transform: scale(1);
  }
}

.team-list-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  background-color: var(--soft);
  border: 1px solid var(--border);
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.15s ease, transform 0.2s ease;
  position: relative;
}

.team-list-item--clicked {
  animation: teamClick 0.3s ease;
}

/* In manage mode, disable drag cursor */
.team-list-item.team-list-item--manage {
  cursor: auto;
}

.team-list-item:not(:last-child) {
  margin-bottom: 4px;
}

.team-list-item:hover {
  background-color: var(--tab-bg);
}

.team-list-item--dragging {
  opacity: 0.5;
  cursor: grabbing;
  transform: scale(1.02);
  box-shadow: 0 4px 12px color-mix(in oklab, var(--shadow) 30%, transparent);
}

.team-list-item--drag-over {
  border-color: var(--accent);
  background-color: color-mix(in oklab, var(--accent) 10%, var(--soft));
}

.team-list-item--grabbing {
  cursor: grabbing;
}

.team-list-item__indicator {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
  transition: background-color 0.2s ease, opacity 0.2s ease;
}

.team-list-item__indicator--active {
  background-color: var(--complete);
  opacity: 1;
}

.team-list-item__indicator--inactive {
  background-color: var(--muted);
  opacity: 0.5;
}

.team-list-item__name {
  flex: 1;
  font-size: 14px;
  color: var(--fg);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  min-width: 0;
}

.team-list-item__name--active {
  font-weight: 600;
}

.team-list-item__name--inactive {
  font-weight: 400;
}

/* Input in manage mode */
.team-list-item__name-input {
  flex: 1;
  min-width: 0;
}

.team-list-item__name-input .input {
  font-size: 14px;
  color: var(--fg);
  padding: 4px 8px;
  width: 100%;
}

.team-list-item__sprites {
  display: flex;
  gap: 4px;
  align-items: center;
  flex-shrink: 0;
}

.team-list-item__sprite-slot {
  width: 32px;
  height: 32px;
  border-radius: 8px;
  background: linear-gradient(
    135deg,
    color-mix(in oklab, var(--bg) 50%, transparent) 0%,
    color-mix(in oklab, var(--bg) 80%, transparent) 100%
  );
  border: 1px solid color-mix(in oklab, var(--border) 40%, transparent);
  box-shadow:
    inset 0 2px 4px color-mix(in oklab, var(--shadow) 25%, transparent),
    inset 0 -1px 2px color-mix(in oklab, var(--bg) 20%, transparent);
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  flex-shrink: 0;
  position: relative;
  transition: all 0.2s ease;
}

/* Manage mode - empty slot (accent color for addition) */
.team-list-item__sprite-slot--empty {
  border: 1.5px solid var(--accent);
  background: color-mix(in oklab, var(--accent) 8%, var(--bg));
  box-shadow: inset 0 2px 4px color-mix(in oklab, var(--accent) 10%, transparent);
}

.team-list-item__sprite-slot--empty svg {
  width: 18px;
  height: 18px;
  flex-shrink: 0;
}

/* Manage mode - filled slot (danger color for removal) */
.team-list-item__sprite-slot.team-list-item__sprite-slot--filled {
  border: 1.5px solid var(--low) !important;
  box-shadow: inset 0 2px 4px color-mix(in oklab, var(--low) 15%, transparent);
}

.team-list-item__sprite-slot-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: color-mix(in oklab, var(--low) 25%, transparent);
  border-radius: 6px;
  pointer-events: none;
  z-index: 1;
}

.team-list-item__sprite-placeholder {
  font-size: 16px;
  opacity: 0.5;
}

.team-list-item__drag-handle {
  font-size: 16px;
  color: var(--fg);
  opacity: 0.6;
  cursor: grab;
  user-select: none;
  line-height: 1;
  padding: 0 4px;
  flex-shrink: 0;
  transition: opacity 0.2s ease;
}

.team-list-item:hover .team-list-item__drag-handle {
  opacity: 1;
}

.team-list-item__drag-handle:active,
.team-list-item--grabbing .team-list-item__drag-handle {
  cursor: grabbing;
}

.team-list-item--placeholder {
  border-style: dashed !important;
  border-color: color-mix(in oklab, var(--accent) 58%, var(--border)) !important;
  background: color-mix(in oklab, var(--accent) 22%, transparent) !important;
  box-shadow: none !important;
  opacity: 1;
  pointer-events: none;
  visibility: visible !important;
}

.team-list-item--placeholder * {
  visibility: hidden;
}
`,N4=`
/* ==================== TimeRangePicker ==================== */

.time-range{
  display: grid;
  grid-template-columns: 1fr;
  row-gap: 10px;
  color: var(--fg);
  width: 100%;
}

/* Inline variant: do not stretch to full width */

.time-range.time-range--inline{
  display: grid;
  width: 100%;             /* always occupy the available width */
  justify-items: stretch;  /* stretch inner elements */
  align-items: start;
}

/* Inline wrapper for picker + summary (composed variant) */
.trp-inline{ display:flex; align-items:center; gap:10px; width:100%; }
.trp-inline > .time-range{ flex:1 1 auto; min-width:0; }
.trp-summary{ display:flex; flex-direction:column; align-items:center; gap:6px; flex:0 0 auto; }
.trp-clock{ display:flex; align-items:center; justify-content:center; width:72px; min-width:72px; aspect-ratio:1; color:var(--accent); }
.trp-clock-svg{ width:100%; height:auto; display:block; }
.trp-clock-face{ fill: color-mix(in oklab, var(--soft) 80%, transparent); stroke: color-mix(in oklab, var(--border) 90%, transparent); stroke-width: 1.5; }
.trp-clock-ticks{ pointer-events:none; }
.trp-clock-tick{ stroke: color-mix(in oklab, var(--fg) 35%, transparent); stroke-width: 1.3; stroke-linecap:round; opacity:.65; }
.trp-clock-tick--major{ stroke-width: 1.8; opacity:.8; }
.trp-clock-arcs{ pointer-events:none; }
.trp-clock-arc{
  fill:none;
  stroke: color-mix(in oklab, var(--accent) 85%, white 15%);
  stroke-width:6;
  stroke-linecap:round;
  opacity:.62;
  mix-blend-mode:multiply;
  transition: stroke .28s ease, opacity .28s ease;
}
.trp-clock-arc[data-pass="1"]{
  opacity:.82;
  stroke: color-mix(in oklab, var(--accent) 70%, black 30%);
}
.trp-clock-arc[data-pass="2"]{
  opacity:.94;
  stroke: color-mix(in oklab, var(--accent) 55%, black 45%);
}
.trp-clock-arc[data-pass="3"]{
  opacity:1;
  stroke: color-mix(in oklab, var(--accent) 40%, black 60%);
}
.trp-clock-arc--full{ stroke-linecap:butt; }
.trp-clock-center{ fill: color-mix(in oklab, var(--fg) 70%, transparent); }
.trp-clock-duration{ font-weight:600; font-size:13px; letter-spacing:.01em; color: color-mix(in oklab, var(--fg) 92%, transparent); }
.trp-clock-pointers{ pointer-events:none; }
.trp-clock-pointer{ transform-origin:50px 50px; transition: transform .25s ease; }
.trp-clock-pointer-line{
  stroke: currentColor;
  stroke-width: 2.8;
  stroke-linecap: round;
  opacity:.88;
}
.trp-clock-pointer-tip{
  fill: currentColor;
  stroke: color-mix(in oklab, currentColor 75%, black 25%);
  stroke-width: .6;
  opacity:.96;
}
.trp-clock-pointer--start{ color: color-mix(in oklab, var(--accent) 70%, white 30%); }
.trp-clock-pointer--end{ color: color-mix(in oklab, var(--fg) 75%, var(--accent) 25%); }
@media (hover: hover) and (pointer: fine){
  .trp-clock-arc{
    stroke: color-mix(in oklab, var(--accent) 88%, white 12%);
    opacity:.7;
  }
  .trp-clock-arc[data-pass="1"]{
    stroke: color-mix(in oklab, var(--accent) 68%, black 32%);
    opacity:.88;
  }
  .trp-clock-arc[data-pass="2"]{
    stroke: color-mix(in oklab, var(--accent) 50%, black 50%);
    opacity:1;
  }
  .trp-clock-arc[data-pass="3"]{
    stroke: color-mix(in oklab, var(--accent) 35%, black 65%);
  }
  .trp-clock-pointer--start{ color: color-mix(in oklab, var(--accent) 65%, white 35%); }
  .trp-clock-pointer--end{ color: color-mix(in oklab, var(--fg) 82%, var(--accent) 18%); }
}
@media (hover: none) and (pointer: coarse){
  .trp-clock-arc{
    stroke: color-mix(in oklab, var(--accent) 82%, white 18%);
    opacity:.78;
    mix-blend-mode:normal;
  }
  .trp-clock-arc[data-pass="1"]{
    stroke: color-mix(in oklab, var(--accent) 60%, black 40%);
    opacity:.95;
  }
  .trp-clock-arc[data-pass="2"]{
    stroke: color-mix(in oklab, var(--accent) 45%, black 55%);
    opacity:1;
  }
  .trp-clock-arc[data-pass="3"]{
    stroke: color-mix(in oklab, var(--accent) 30%, black 70%);
  }
  .trp-clock-pointer--start{ color: color-mix(in oklab, var(--accent) 68%, white 32%); }
  .trp-clock-pointer--end{ color: color-mix(in oklab, var(--fg) 80%, var(--accent) 20%); }
}
@media (max-width: 480px){
  .trp-inline{ gap:12px; }
  .trp-summary{
    flex:0 0 auto;
    flex-direction:column;
    align-items:center;
    justify-content:flex-start;
    gap:6px;
  }
  .trp-clock{ width:60px; min-width:60px; }
  .trp-clock-duration{ font-size:12px; }
}
.time-range.time-range--inline .time-range-field{ width: 100%; }
.time-range.time-range--inline .time-picker{ width: 100%; }
.time-range.time-range--inline .time-range-input{ width: 100%; }
.time-range.time-range--inline .time-range-field .time-picker,
.time-range.time-range--inline .time-range-field .time-range-input{
  flex: 1 1 auto;
}
.time-range.time-range--inline .time-picker .select-trigger{
  width: 100%;
  inline-size: 100%;
}

/* Row: label on the left, control on the right */
.time-range-field{
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 10px;
  width: 100%;
}

/* Label on the left, stable width for alignment */
.time-range-label{
  min-width: var(--trp-label-w, 35px);
  width: var(--trp-label-w, 35px);
  text-align: right;
  white-space: nowrap;
  font-weight: 600;
  opacity: .9;
}

/* The control takes all remaining space */
.time-range-field .time-picker,
.time-range-field .time-range-input{
  flex: 1 1 auto;
  min-width: 0; /* avoid overflows in grids/flex */
}

/* ---------- Custom picker (HH, MM, AM/PM) ---------- */

.time-picker{
  display: inline-flex;
  align-items: center;
  gap: 16px; /* visual space for ":" */
  width: 100%;
}

/* Inner selects remain fluid */
.time-picker .select{
  min-width: 0;
  flex: 1 1 0;
  width: auto;
}
.time-picker .select-trigger{
  width: 100%;
  inline-size: 100%;
  border-color: var(--border);
  background: linear-gradient(
    180deg,
    color-mix(in oklab, var(--soft) 85%, transparent) 0%,
    color-mix(in oklab, var(--soft) 60%, transparent) 100%
  );
  color: var(--fg);
}
.time-picker .select.open .select-menu{
  min-width: auto;
  background-color: color-mix(in oklab, var(--bg) 88%, transparent);
  border: 1px solid var(--border);
}

/* Compact variant */
.time-picker-compact .select-trigger{
  padding: 4px 8px;
  min-height: 32px;
}
.time-picker-compact .select-value{
  min-width: calc(var(--min-ch, 2) * 1ch);
  text-align: center;
}

/* HH and MM stretch, AM/PM stays compact */
.time-picker .select:nth-child(1),
.time-picker .select:nth-child(2){
  flex: 1 1 0;
}
.time-picker .select:last-child{
  flex: 0 0 auto;
}

/* ":" separator between HH and MM */
.time-picker > .select:first-child{ position: relative; }
.time-picker > .select:first-child::after{
  content: ":";
  position: absolute;
  right: -10px;
  top: 50%;
  transform: translateY(-50%);
  opacity: .9;
  pointer-events: none;
}

/* ---------- Natif <input type="time"> ---------- */

.time-range-input{
  width: 100%;
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 10px 12px;
  background-color: color-mix(in oklab, var(--soft) 80%, transparent);
  color: var(--fg);
  font-size: 13px;
  min-height: 36px;
  line-height: 1.2;
  transition: background-color .28s ease, border-color .28s ease, color .28s ease;
}
.time-range-input:focus{
  outline: 2px solid color-mix(in oklab, var(--accent) 45%, transparent);
}

/* Disabled */
.time-range.is-disabled,
.time-picker .is-disabled{
  opacity: .6;
  pointer-events: none;
}

/* Integration in .kv: fluid control */
.kv .time-range .time-picker,
.kv .time-range .time-range-input{
  flex: 1 1 auto;
  min-width: 0;
}

/* ---------- Responsive ---------- */
@media (max-width: 420px){
  /* Mobile: keep the label on the left (not above) */
  .time-range-field{
    flex-direction: row;
    align-items: center;
    gap: 8px;
  }
  .time-range-label{
    /* shrink the label and align it left */
    --trp-label-w: 64px;
    width: var(--trp-label-w);
    min-width: var(--trp-label-w);
    text-align: left;
  }
}
`,D4=`
.lg-tip{
  position: fixed; /* positioned via JS (viewport rect) */
  z-index: 2147483647; /* above the HUD */
  max-width: 320px;
  padding: 8px 10px;
  border-radius: 10px;

  background-color: color-mix(in oklab, var(--bg) 96%, transparent);
  color: var(--fg);
  border: 1px solid var(--border);
  box-shadow: 0 10px 30px color-mix(in oklab, var(--shadow) 45%, transparent);
  backdrop-filter: blur(var(--glass-blur));
  -webkit-backdrop-filter: blur(var(--glass-blur));

  font: 12.5px/1.25 var(--font-ui);
  pointer-events: none; /* non-interactive by default */
  opacity: 0;
  transform: translateY(2px);
  transition: opacity .16s ease, transform .16s ease,
              background-color .28s ease, color .28s ease, border-color .28s ease;
}

.lg-tip.is-open{ opacity: 1; transform: translateY(0); }

/* Arrow (small rotated square) */
.lg-tip::after{
  content: "";
  position: absolute;
  width: 9px; height: 9px;
  background: inherit;
  border: inherit;
  border-left: none; border-top: none;
  transform: rotate(45deg);
  box-shadow: 3px 3px 12px color-mix(in oklab, var(--shadow) 35%, transparent);
}

/* Placements (also handled in TS for coords) */
.lg-tip.is-top::after{
  bottom: -5px; left: 16px;
}
.lg-tip.is-bottom::after{
  top: -5px; left: 16px;
}
.lg-tip.is-left::after{
  right: -5px; top: 12px;
}
.lg-tip.is-right::after{
  left: -5px; top: 12px;
}

/* Accented variant (optional) */
.lg-tip--accent{
  border-color: color-mix(in oklab, var(--accent) 55%, var(--border));
}

@media (max-width: 480px){
  .lg-tip{ max-width: min(86vw, 320px); }
}
`,$4=`
.slider{ display:flex; flex-direction:column; gap:8px; width:100%; }
.slider-row{ display:flex; align-items:center; gap:10px; width:100%; }

/* Passive track */
.slider-track{
  position: relative;
  width: 100%;
  height: 6px;
  border-radius: 999px;
  background: color-mix(in oklab, var(--soft) 80%, transparent);
  border: 1px solid var(--border);
  box-shadow: inset 0 1px 2px color-mix(in oklab, var(--shadow) 30%, transparent);
  overflow: visible;          /* no thumb clipping */
  pointer-events: none;       /* never events on the track */
  z-index: 0;
}

/* Fill (passive) */
.slider-range{
  position: absolute; left: 0; top: 0; height: 100%;
  background: linear-gradient(90deg, var(--pill-from), var(--pill-to));
  pointer-events: none;
  z-index: 0;
  will-change: left, width;
}

/* Input range: only interactive element */
.slider input[type="range"]{
  -webkit-appearance: none; appearance: none;
  width: 100%;
  height: 16px;
  background: transparent; outline: none; margin: 0; padding: 0;
  cursor: pointer;
  position: absolute;
  left: 0; right: 0; top: 50%;
  transform: translateY(-50%);
  pointer-events: auto;
  z-index: 2;                  /* above track/fill */
  touch-action: none;          /* avoid scrolling during drag */
}

/* If handles are visually close, keep a bring-to-front */
.slider input[type="range"].is-active,
.slider:focus-within input[type="range"]:focus{
  z-index: 4;
}

/* WebKit thumb */
.slider input[type="range"]::-webkit-slider-thumb{
  -webkit-appearance: none;
  width: 18px; height: 18px; border-radius: 50%;
  background: var(--fg);
  box-shadow: 0 1px 3px color-mix(in oklab, var(--shadow) 40%, transparent);
  border: 2px solid var(--bg);
  margin-top: -6px;            /* center vs track (18 vs 6) */
  position: relative;
  z-index: 3;
  cursor: pointer;
}

/* Visual WebKit track (transparent) */
.slider input[type="range"]::-webkit-slider-runnable-track{
  height: 6px; background: transparent;
}

/* Firefox */
.slider input[type="range"]::-moz-range-thumb{
  width: 18px; height: 18px; border-radius: 50%;
  background: var(--fg);
  box-shadow: 0 1px 3px color-mix(in oklab, var(--shadow) 40%, transparent);
  border: 2px solid var(--bg);
  margin-top: -6px;
  position: relative;
  z-index: 3;
  cursor: pointer;
}
.slider input[type="range"]::-moz-range-track{
  height: 6px; background: transparent;
}

/* Labels/values */
.slider-label{ font-weight: 600; font-size: 13px; color: var(--text); }
.slider-value{ font-variant-numeric: tabular-nums; font-size: 14px; color: var(--text-dim); }
.slider-value-range{ display:flex; align-items:center; gap:6px; white-space:nowrap; }

.slider--range{ position:relative; }
.slider--range .slider-range{ pointer-events:none; }
.slider--range input[type="range"]{
  pointer-events:none;
}
.slider--range input[type="range"]::-webkit-slider-thumb{
  pointer-events:all;
}
.slider--range input[type="range"]::-moz-range-thumb{
  pointer-events:all;
}
.slider--range input[type="range"][data-handle="min"]{ z-index:3; }
.slider--range input[type="range"][data-handle="max"]{ z-index:4; }
.slider--range.is-disabled{ opacity:.55; }

@media (max-width: 480px){
  .slider{ gap:6px; }
  .slider-label{ font-size:12px; }
  .slider-value{ font-size:13px; }
  .slider input[type="range"]::-webkit-slider-thumb{ width:14px; height:14px; margin-top:-4px; }
  .slider input[type="range"]::-moz-range-thumb{ width:14px; height:14px; margin-top:-4px; }
}
`,B4=`
.reorderable-list{
  --rl-gap: 12px;
  --rl-item-radius: 14px;
  --rl-item-pad-y: 12px;
  --rl-item-pad-x: 16px;
  --rl-item-bg: color-mix(in oklab, var(--soft) 88%, transparent);
  --rl-item-border: color-mix(in oklab, var(--border) 78%, transparent);
  --rl-item-shadow: 0 6px 18px color-mix(in oklab, var(--shadow) 18%, transparent);
  --rl-tone-w: var(--card-accent-w, 3px);
  display:flex;
  flex-direction:column;
  gap: var(--rl-gap);
  min-width:0;
}

.reorderable-list[data-density="compact"]{
  --rl-gap: 8px;
  --rl-item-pad-y: 8px;
  --rl-item-pad-x: 14px;
  --rl-item-radius: 12px;
}

.reorderable-list[data-density="loose"]{
  --rl-gap: 16px;
  --rl-item-pad-y: 16px;
  --rl-item-pad-x: 20px;
  --rl-item-radius: 16px;
}

.reorderable-list[data-variant="surface"]{
  --rl-item-bg: color-mix(in oklab, var(--bg) 86%, transparent);
  --rl-item-border: color-mix(in oklab, var(--border) 70%, transparent);
}

.reorderable-list[data-variant="ghost"]{
  --rl-item-bg: color-mix(in oklab, var(--soft) 55%, transparent);
  --rl-item-border: color-mix(in oklab, var(--border) 60%, transparent);
  --rl-item-shadow: none;
}

.reorderable-track{
  display:flex;
  flex-direction:column;
  gap: var(--rl-gap);
  position:relative;
}

.reorderable-list.is-empty .reorderable-track{
  gap: 0;
}

.rl-empty{
  padding: var(--rl-item-pad-y) var(--rl-item-pad-x);
  border-radius: var(--rl-item-radius);
  border: 1px dashed color-mix(in oklab, var(--border) 80%, transparent);
  background: color-mix(in oklab, var(--soft) 70%, transparent);
  color: color-mix(in oklab, var(--fg) 70%, #94a3b8);
  font-size: 12px;
  text-align:center;
}

.rl-item{
  position:relative;
  display:flex;
  align-items:center;
  gap: 12px;
  padding: var(--rl-item-pad-y) var(--rl-item-pad-x);
  border-radius: var(--rl-item-radius);
  background: var(--rl-item-bg);
  border: 1px solid var(--rl-item-border);
  box-shadow: var(--rl-item-shadow);
  transition:
    transform .16s ease,
    box-shadow .2s ease,
    background .2s ease,
    border-color .2s ease,
    opacity .2s ease,
    filter .2s ease;
}

.reorderable-list:not(.is-reordering) .rl-item:hover{
  border-color: color-mix(in oklab, var(--accent) 35%, var(--rl-item-border));
  filter: brightness(1.03);
}

.reorderable-list[data-grab="item"] .rl-item{
  cursor: grab;
}

.rl-item.is-disabled{
  opacity: .55;
  cursor: default;
  box-shadow: none;
}

.rl-item.is-dragging{
  box-shadow:
    0 18px 32px color-mix(in oklab, var(--shadow) 38%, transparent),
    0 0 0 1px color-mix(in oklab, var(--accent) 32%, transparent);
  filter: brightness(1.05);
}

.reorderable-list.is-reordering .rl-item:not(.is-dragging){
  transition: transform .14s ease;
}

.rl-item::before{
  content:"";
  position:absolute;
  inset: 8px auto 8px 0;
  width: var(--rl-tone-w);
  border-radius: 999px;
  opacity: 0;
  transition: opacity .2s ease;
  background: transparent;
}

.rl-item[data-tone="accent"]::before{
  opacity: 1;
  background: color-mix(in oklab, var(--accent) 75%, transparent);
}

.rl-item[data-tone="info"]::before{
  opacity: 1;
  background: color-mix(in oklab, #38bdf8 70%, transparent);
}

.rl-item[data-tone="success"]::before{
  opacity: 1;
  background: color-mix(in oklab, #34d399 72%, transparent);
}

.rl-item[data-tone="warning"]::before{
  opacity: 1;
  background: color-mix(in oklab, #fbbf24 72%, transparent);
}

.rl-item[data-tone="danger"]::before{
  opacity: 1;
  background: color-mix(in oklab, #f87171 72%, transparent);
}

.rl-handle{
  inline-size: 32px;
  block-size: 32px;
  border-radius: 10px;
  border: 1px solid color-mix(in oklab, var(--border) 80%, transparent);
  background: color-mix(in oklab, var(--soft) 75%, transparent);
  color: var(--fg);
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:0;
  cursor: grab;
  transition:
    background .2s ease,
    border-color .2s ease,
    transform .16s ease,
    box-shadow .2s ease;
}

.rl-handle:focus-visible{
  outline: none;
  box-shadow:
    0 0 0 2px color-mix(in oklab, var(--accent) 45%, transparent),
    0 6px 16px color-mix(in oklab, var(--shadow) 26%, transparent);
}

.rl-handle:hover{
  border-color: color-mix(in oklab, var(--accent) 55%, var(--border));
}

.rl-handle:active{
  cursor: grabbing;
  transform: translateY(1px);
}

.rl-handle svg{
  width: 12px;
  height: 12px;
  fill: currentColor;
  opacity: .82;
}

.rl-body{
  display:flex;
  align-items:center;
  flex:1 1 auto;
  gap: 12px;
  min-width:0;
}

.rl-leading{
  width: 32px;
  height: 32px;
  border-radius: 10px;
  background: color-mix(in oklab, var(--soft) 58%, transparent);
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
  color: var(--fg);
  flex:0 0 auto;
}

.rl-leading img,
.rl-leading svg{
  max-width: 100%;
  max-height: 100%;
}

.rl-text{
  display:flex;
  flex-direction:column;
  gap:4px;
  min-width:0;
  flex:1 1 auto;
}

.rl-title{
  font-size: 14px;
  font-weight: 600;
  color: var(--fg);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.rl-subtitle{
  font-size: 12px;
  color: color-mix(in oklab, var(--fg) 70%, #94a3b8);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.rl-meta{
  margin-left: auto;
  font-size: 12px;
  color: color-mix(in oklab, var(--fg) 72%, #94a3b8);
  display:flex;
  align-items:center;
  gap:6px;
}

.rl-trailing{
  flex:0 0 auto;
  display:flex;
  align-items:center;
  gap:6px;
}

.rl-index{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  min-width: 24px;
  padding: 2px 6px;
  border-radius: 999px;
  font-size: 12px;
  font-weight: 600;
  color: color-mix(in oklab, var(--fg) 82%, #e2e8f0);
  background: color-mix(in oklab, var(--soft) 66%, transparent);
  flex:0 0 auto;
}

.rl-placeholder{
  border-style: dashed;
  border-width: 1px;
  border-color: color-mix(in oklab, var(--accent) 58%, var(--border));
  background: color-mix(in oklab, var(--accent) 22%, transparent);
  box-shadow: none;
  opacity: .65;
}

.reorderable-list[data-grab="item"] .rl-handle[aria-hidden="true"]{
  pointer-events:none;
  border-style: dotted;
  opacity:.65;
}

.reorderable-list[data-grab="item"] .rl-item:active{
  cursor: grabbing;
}
`,z4=`
@layer components {
  .color-picker{
    --cp-checkerboard: repeating-conic-gradient(#ebeef5 0 25%, transparent 0 50%) 0 0 / 12px 12px;
  }

  .color-picker__header{
    align-items:center;
    gap:12px;
  }

  .color-picker__preview{
    position:relative;
    inline-size:32px;
    block-size:32px;
    border-radius:10px;
    border:1px solid color-mix(in oklab, var(--border) 80%, transparent);
    background: color-mix(in oklab, var(--soft) 92%, transparent);
    padding:0;
    cursor:pointer;
    outline:none;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    transition:border-color .2s ease, box-shadow .2s ease, transform .12s ease;
  }
  .color-picker__preview::after{
    content:"";
    position:absolute;
    inset:0;
    border-radius:inherit;
    background: var(--cp-preview-color, transparent);
    box-shadow: inset 0 1px 2px color-mix(in oklab, #ffffff 70%, transparent);
  }
  .color-picker__preview:focus-visible{
    box-shadow:0 0 0 2px color-mix(in oklab, var(--accent) 45%, transparent);
  }
  .color-picker__preview:active{
    transform:scale(.97);
  }

  .color-picker__body{
    display:flex;
    flex-direction:column;
    gap:14px;
    padding:0;
  }

  .color-picker__main{
    display:flex;
    gap:12px;
    align-items:stretch;
  }

  .color-picker__palette{
    position:relative;
    flex:1 1 auto;
    min-inline-size:0;
    border-radius:12px;
    background:
      linear-gradient(0deg, rgba(0,0,0,1) 0%, rgba(0,0,0,0) 100%),
      linear-gradient(90deg, #fff 0%, var(--cp-palette-hue, #ff0000) 100%);
    box-shadow:inset 0 1px 3px color-mix(in oklab, #000 12%, transparent);
    cursor:crosshair;
    aspect-ratio: 4 / 3;
    overflow:hidden;
    touch-action:none;
  }

  .color-picker__palette-cursor{
    position:absolute;
    width:12px;
    height:12px;
    border-radius:999px;
    border:2px solid #fff;
    box-shadow:0 1px 4px #0004, inset 0 0 2px #0002;
    pointer-events:none;
    transform:translate(-50%, -50%);
  }

  .color-picker__alpha{
    position:relative;
    flex:0 0 18px;
    border-radius:12px;
    background: color-mix(in oklab, var(--soft) 92%, transparent);
    overflow:hidden;
    cursor:pointer;
    touch-action:none;
  }
  .color-picker__alpha::after{
    content:"";
    position:absolute;
    inset:0;
    background: var(--cp-alpha-gradient, linear-gradient(180deg, rgba(255,0,0,1) 0%, rgba(255,0,0,0) 100%));
    z-index:0;
  }
  .color-picker__alpha-thumb{
    position:absolute;
    left:2px;
    right:2px;
    height:6px;
    border-radius:6px;
    border:1px solid color-mix(in oklab, #000 18%, transparent);
    box-shadow:0 1px 3px #0004;
    transform:translateY(-50%);
    background:#fff;
    opacity:1;
    pointer-events:none;
    z-index:1;
  }

  .color-picker__hue{
    position:relative;
    block-size:16px;
    border-radius:999px;
    background: linear-gradient(
      90deg,
      #ff0000 0%,
      #ffff00 16.6%,
      #00ff00 33.3%,
      #00ffff 50%,
      #0000ff 66.6%,
      #ff00ff 83.3%,
      #ff0000 100%
    );
    box-shadow:inset 0 1px 3px color-mix(in oklab, #000 12%, transparent);
    cursor:pointer;
    touch-action:none;
  }
  .color-picker__hue-thumb{
    position:absolute;
    top:2px;
    bottom:2px;
    width:6px;
    border-radius:6px;
    border:1px solid color-mix(in oklab, #000 16%, transparent);
    box-shadow:0 1px 3px #0003;
    transform:translateX(-50%);
    pointer-events:none;
    background: color-mix(in oklab, #ffffff 88%, transparent);
    z-index:1;
  }

  .color-picker__hex-row{
    display:flex;
    align-items:center;
    gap:8px;
    justify-content:flex-start;
  }

  .color-picker__hex-wrap{
    flex:1 1 auto;
    min-inline-size:0;
    gap:6px;
  }

  .color-picker__hex-wrap .input{
    flex:1 1 auto;
    min-inline-size:0;
  }

  .color-picker__mode-btn{
    flex:0 0 auto;
    border:1px solid var(--border);
    border-radius:10px;
    padding:8px 12px;
    min-width:62px;
    background: color-mix(in oklab, var(--soft) 90%, transparent);
    color:var(--fg);
    font:600 11px/1 var(--font-ui, system-ui);
    letter-spacing:.6px;
    text-transform:uppercase;
    cursor:pointer;
    transition:border-color .2s ease, background .2s ease, box-shadow .2s ease, color .2s ease;
  }
  .color-picker__mode-btn:hover{
    border-color: color-mix(in oklab, var(--accent) 40%, var(--border));
    background: color-mix(in oklab, var(--soft) 70%, transparent);
  }
  .color-picker__mode-btn:focus-visible{
    outline:none;
    box-shadow:0 0 0 2px color-mix(in oklab, var(--accent) 45%, transparent);
  }
  .color-picker__mode-btn.is-alt{
    background: color-mix(in oklab, var(--accent) 24%, transparent);
    color: color-mix(in oklab, var(--fg) 96%, var(--accent));
    border-color: color-mix(in oklab, var(--accent) 45%, var(--border));
  }

  .color-picker__hex-input{
    flex:1 1 auto;
    min-inline-size:0;
    border:1px solid var(--border);
    border-radius:12px;
    padding:10px 12px;
    background: color-mix(in oklab, var(--soft) 82%, transparent);
    color:var(--fg);
    font:600 13px/1.2 var(--font-ui, system-ui);
    letter-spacing:.4px;
    text-transform:uppercase;
    outline:none;
    transition:border-color .2s ease, box-shadow .2s ease;
  }
  .color-picker__hex-input:focus{
    border-color: color-mix(in oklab, var(--accent) 55%, var(--border));
    box-shadow:0 0 0 2px color-mix(in oklab, var(--accent) 40%, transparent);
  }

  .color-picker__native{
    display:none;
  }

  .color-picker--mobile .card{
    padding:12px;
  }
  .color-picker--mobile .card-collapse{
    display:none !important;
  }
  .color-picker--mobile .color-picker__preview{
    pointer-events:auto;
  }
}
`,j4=`
@layer components {
  .log{
    display:block;
    border:1px solid var(--border);
    border-radius:12px;
    background: color-mix(in oklab, var(--soft) 80%, transparent);
    color: var(--fg);
    box-shadow: 0 8px 20px color-mix(in oklab, var(--shadow) 35%, transparent);
    transition: background-color .28s ease, color .28s ease, border-color .28s ease, box-shadow .28s ease;
    overflow: hidden;
    min-height: 120px;
  }

  .log-viewport{
    block-size: 100%;
    max-block-size: 100%;
    overflow: auto;
    padding: 10px 12px 14px; /* extra bottom padding to avoid last-line clipping */
    background: color-mix(in oklab, var(--bg) 88%, transparent);
    scrollbar-gutter: stable;
  }
  .log-viewport::-webkit-scrollbar{ width:10px; height:10px; }
  .log-viewport::-webkit-scrollbar-thumb{ background:var(--muted); border-radius:8px; }

  .log-lines{ display:block; font: 12px/1.45 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; white-space: pre; }
  .log--wrap .log-lines{ white-space: pre-wrap; word-break: break-word; }
  .log-lines::after{ content: ""; display:block; height: 6px; }

  /* Groups */
  .log-group{ border:1px solid color-mix(in oklab, var(--border) 70%, transparent); border-radius:10px; margin:8px 0; overflow:hidden; background: color-mix(in oklab, var(--soft) 80%, transparent); }
  .log-group-header{
    display:flex; align-items:center; gap:8px;
    padding:6px 10px; cursor:pointer; user-select:none;
    background: color-mix(in oklab, var(--soft) 85%, transparent);
    color: var(--fg);
    position:relative;
  }
  .log-group-header::before{
    content: '▾';
    display:inline-block; width:1em; text-align:center; opacity:.9;
    transform-origin:center; transition: transform .18s ease;
  }
  .log-group.is-collapsed .log-group-header::before{ transform: rotate(-90deg); }
  .log-group-body{ padding:6px 8px; }
  .log-group.is-collapsed .log-group-body{ display:none; }

  .log-line{
    display:grid;
    grid-template-columns: auto 1fr;
    gap: 10px;
    align-items: start;
    padding-block: 2px;
    border-left: 3px solid transparent;
  }

  .log-time{
    opacity:.7;
    color: color-mix(in oklab, var(--fg) 75%, #9ca3af);
    font-variant-numeric: tabular-nums; 
    user-select: none;
    min-inline-size: 64px;
  }

  .log-text{ color: var(--fg); }

  /* Level accents */
  .log-level--debug{ border-left-color: color-mix(in oklab, #64748b 70%, var(--border)); }
  .log-level--info { border-left-color: color-mix(in oklab, #3b82f6 70%, var(--border)); }
  .log-level--warn { border-left-color: color-mix(in oklab, #f59e0b 80%, var(--border)); }
  .log-level--error{ border-left-color: color-mix(in oklab, #ef4444 80%, var(--border)); }

  /* Syntax tokens */
  .tok{ font: inherit; }
  .tok-kw{   color: color-mix(in oklab, var(--accent) 75%, var(--fg)); font-weight: 600; }
  .tok-str{  color: color-mix(in oklab, #22c55e 78%, var(--fg)); }
  .tok-num{  color: color-mix(in oklab, #a78bfa 78%, var(--fg)); }
  .tok-comm{ color: color-mix(in oklab, var(--fg) 65%, #9ca3af); font-style: italic; }
  .tok-lit{  color: color-mix(in oklab, #f472b6 78%, var(--fg)); }
}
`,G4=`
.sg-root {
  display: inline-flex;
  align-items: center;
  width: auto;
}

.sg-container {
  position: relative;
  display: flex;
  align-items: center;
  gap: 0;

  padding: 4px;
  background-color: var(--soft);
  border: 1px solid var(--border);
  border-radius: 10px;

  transition: background-color 0.15s ease, border-color 0.15s ease;
}

/* Animated indicator background */
.sg-indicator {
  position: absolute;
  top: 4px;
  left: 0;
  height: calc(100% - 8px);
  border-radius: 8px;
  width: 70px;

  background: linear-gradient(
    135deg,
    color-mix(in oklab, var(--accent) 35%, transparent) 0%,
    color-mix(in oklab, var(--accent) 50%, transparent) 100%
  );

  box-shadow: inset 0 1px 2px color-mix(in oklab, var(--accent) 20%, transparent);

  transition: transform 0.25s cubic-bezier(0.2, 0.8, 0.2, 1),
              width 0.25s cubic-bezier(0.2, 0.8, 0.2, 1);

  pointer-events: none;
  z-index: 0;
  will-change: transform, width;
}

/* Individual segment buttons */
.sg-btn {
  position: relative;
  z-index: 1;

  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;

  padding: 7px 16px;
  min-height: 32px;
  min-width: 70px;

  background: transparent;
  border: none;
  border-radius: 7px;
  cursor: pointer;

  color: var(--fg);
  font-size: 13px;
  font-weight: 500;
  letter-spacing: 0px;
  line-height: 1.2;
  white-space: nowrap;

  transition: color 0.15s ease;
  appearance: none;
  -webkit-tap-highlight-color: transparent;
}

.sg-btn:hover:not(:disabled):not(.active) {
  color: var(--accent);
}

.sg-btn.active {
  color: var(--tab-fg);
  font-weight: 600;
}

.sg-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  color: var(--muted);
}

.sg-btn:focus-visible {
  outline: none;
  box-shadow: inset 0 0 0 2px color-mix(in oklab, var(--accent) 45%, transparent);
}

/* Icon styling */
.sg-icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  line-height: 0;
  font-size: 16px;
}

/* Label styling */
.sg-label {
  display: inline-flex;
  align-items: center;
  line-height: 1;
}

/* Size variations */
.sg--sm .sg-btn {
  padding: 5px 12px;
  min-height: 28px;
  font-size: 12px;
  min-width: 60px;
}

.sg--sm .sg-container {
  padding: 3px;
}

.sg--sm .sg-indicator {
  top: 3px;
  height: calc(100% - 6px);
}

.sg--lg .sg-btn {
  padding: 9px 18px;
  min-height: 36px;
  font-size: 14px;
  gap: 8px;
  min-width: 80px;
}

.sg--lg .sg-container {
  padding: 4px;
}

.sg--lg .sg-indicator {
  top: 4px;
  height: calc(100% - 8px);
}

/* Full width mode */
.sg-root[style*="width: 100%"] .sg-btn {
  flex: 1;
  min-width: 0;
}

/* Icon-only mode (when label is hidden via CSS class) */
.sg-btn.sg--icon-only {
  min-width: 40px;
  padding: 8px;
}

.sg--sm .sg-btn.sg--icon-only {
  min-width: 36px;
  padding: 6px;
}

.sg--lg .sg-btn.sg--icon-only {
  min-width: 44px;
  padding: 10px;
}

/* Hover state on container */
.sg-container:hover {
  border-color: color-mix(in oklab, var(--accent) 25%, var(--border));
}

/* Responsive: stack on very small screens if needed */
@media (max-width: 360px) {
  .sg-btn {
    padding: 6px 10px;
    min-height: 32px;
    font-size: 12px;
  }

  .sg-container {
    padding: 3px;
  }

  .sg-icon {
    font-size: 14px;
  }
}
`,H4=`
.sound-picker{
  display:flex;
  flex-direction:column;
  gap:0px;
  min-width:0;
}

.sound-picker__header{
  display:flex;
  flex-direction:column;
  gap:4px;
}

.sound-picker__label{
  font-size:13px;
  font-weight:600;
  color: var(--fg);
}

.sound-picker__hint{
  font-size:12px;
  color: color-mix(in oklab, var(--fg) 70%, #9ca3af);
}

.sound-picker__zone{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  margin-top:12px;
  padding:16px;
  min-height:72px;
  border-radius:16px;
  border:1px dashed color-mix(in oklab, var(--border) 80%, transparent);
  background: color-mix(in oklab, var(--soft) 70%, transparent);
  transition: border-color .2s ease, background .2s ease, box-shadow .2s ease, transform .08s ease;
  cursor:pointer;
}

.sound-picker__zone:focus-visible{
  outline: none;
  box-shadow:
    0 0 0 2px color-mix(in oklab, var(--accent) 40%, transparent),
    0 8px 20px color-mix(in oklab, var(--shadow) 22%, transparent);
}

.sound-picker__zone:hover{
  border-color: color-mix(in oklab, var(--accent) 45%, var(--border));
}

.sound-picker__zone.is-dragover{
  border-color: color-mix(in oklab, var(--accent) 70%, var(--border));
  background: color-mix(in oklab, var(--accent) 10%, var(--soft));
  box-shadow: 0 12px 26px color-mix(in oklab, var(--shadow) 25%, transparent);
  transform: translateY(-1px);
}

.sound-picker.is-disabled .sound-picker__zone{
  opacity:.6;
  cursor:not-allowed;
}

.sound-picker__zone-text{
  display:flex;
  flex-direction:column;
  gap:4px;
  min-width:0;
}

.sound-picker__zone-title{
  font-size:13px;
  font-weight:600;
  color: var(--fg);
}

.sound-picker__zone-subtitle{
  font-size:12px;
  color: color-mix(in oklab, var(--fg) 70%, #9ca3af);
}

.sound-picker__pick{
  flex:0 0 auto;
  min-height:44px;
}

.sound-picker__input{
  display:none;
}

.sound-picker__status{
  min-height:16px;
  font-size:12px;
  color: color-mix(in oklab, var(--fg) 70%, #9ca3af);
}

.sound-picker__status.is-error{
  color: color-mix(in oklab, #f87171 75%, var(--fg));
}

.sound-picker__list{
  --sp-gap: 8px;
  --sp-row-h: 44px;
  display:flex;
  flex-direction:column;
  gap: var(--sp-gap);
}

.sound-picker__list.is-scrollable{
  max-height: calc((var(--sp-row-h) * 3) + (var(--sp-gap) * 2));
  overflow-y: auto;
  padding-right: 4px;
  scrollbar-gutter: stable;
}

.sound-picker__list.is-scrollable::-webkit-scrollbar {
  width: 10px;
}
.sound-picker__list.is-scrollable::-webkit-scrollbar-track {
  background: transparent;
}
.sound-picker__list.is-scrollable::-webkit-scrollbar-thumb {
  background: var(--muted);
  border-radius: 8px;
}
.sound-picker__list.is-scrollable::-webkit-scrollbar-thumb:hover {
  background: color-mix(in oklab, var(--muted) 150%, transparent);
}

.sound-picker__empty{
  padding:10px 12px;
  border-radius:12px;
  border:1px dashed color-mix(in oklab, var(--border) 80%, transparent);
  background: color-mix(in oklab, var(--soft) 70%, transparent);
  color: color-mix(in oklab, var(--fg) 70%, #94a3b8);
  font-size:12px;
  text-align:center;
}

.sound-picker__item{
  display:flex;
  flex-direction:column;
  align-items:stretch;
  justify-content:center;
  gap:6px;
  padding:6px 10px;
  border-radius:12px;
  border:1px solid color-mix(in oklab, var(--border) 75%, transparent);
  background: color-mix(in oklab, var(--soft) 72%, transparent);
  min-height: var(--sp-row-h);
  min-width:0;
}

.sound-picker__item-top{
  display:grid;
  grid-template-columns: minmax(0, 1fr) auto;
  align-items:center;
  column-gap:10px;
  min-width:0;
  width:100%;
}

.sound-picker__item.is-playing{
  border-color: color-mix(in oklab, var(--accent) 45%, var(--border));
  box-shadow: 0 10px 22px color-mix(in oklab, var(--shadow) 18%, transparent);
}

.sound-picker__item-name{
  display:block;
  min-width:0;
  overflow:hidden;
}

.sound-picker__item-label{
  font-size:13px;
  font-weight:600;
  color: var(--fg);
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
  line-height:1.2;
  display:block;
}

.sound-picker__rename{
  flex:1 1 auto;
  min-width:0;
}

.sound-picker__item-actions{
  display:flex;
  align-items:center;
  gap:6px;
  flex-wrap: nowrap;
  flex:0 0 auto;
  white-space:nowrap;
  justify-self:end;
}

.sound-picker__item-btn{
  appearance:none;
  border:1px solid color-mix(in oklab, var(--border) 70%, transparent);
  background: color-mix(in oklab, var(--soft) 78%, transparent);
  color: var(--fg);
  border-radius:10px;
  min-height:32px;
  padding:0 8px;
  font-size:11.5px;
  font-weight:600;
  cursor:pointer;
  transition: border-color .2s ease, background .2s ease, transform .05s ease;
}

.sound-picker__item-btn--play{
  min-width:48px;
  text-align:center;
}

.sound-picker__item-btn:hover{
  border-color: color-mix(in oklab, var(--accent) 45%, var(--border));
}

.sound-picker__item-btn:active{
  transform: translateY(1px);
}

.sound-picker__item-btn:disabled{
  opacity:.6;
  cursor:not-allowed;
}

.sound-picker__item-btn--danger{
  border-color: color-mix(in oklab, #f87171 45%, var(--border));
  background: color-mix(in oklab, #f87171 18%, var(--soft));
}

.sound-picker__item-btn--danger:hover{
  border-color: color-mix(in oklab, #f87171 70%, var(--border));
}

@media (max-width: 560px){
  .sound-picker__zone{
    flex-direction:column;
    align-items:stretch;
  }
  .sound-picker__pick{
    width:100%;
  }
  .sound-picker__item-btn{
    min-height:44px;
    padding:0 12px;
    font-size:12px;
  }
}
`,U4=`
@layer settings-section {
  /* Theme color picker grid */
  .settings-theme-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 16px;
  }

  @media (max-width: 640px) {
    .settings-theme-grid {
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
    }
  }

  @media (max-width: 480px) {
    .settings-theme-grid {
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
    }
  }

  .settings-theme-row {
    margin-bottom: 16px;
  }

  .settings-color-row {
    display: flex;
    flex-direction: column;
    width: 100%;
  }

  .settings-color-block {
    display: flex;
    flex-direction: column;
    gap: 8px;
    align-items: stretch;
    width: 100%;
  }
}
`,W4={all:"initial",position:"fixed",top:"0",right:"0",zIndex:"2147483647",pointerEvents:"auto",fontFamily:'system-ui, -apple-system, "Segoe UI", Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif',fontSize:"13px",lineHeight:"1.35"};function V4(e="gemini-root"){const t=document.createElement("div");t.id=e,Object.assign(t.style,W4),(document.body||document.documentElement).appendChild(t);const n=t.attachShadow({mode:"open"});return {host:t,shadow:n}}function q4(){return new Promise(e=>{typeof requestIdleCallback<"u"?requestIdleCallback(()=>e(),{timeout:16}):setTimeout(e,0);})}async function X4(e){const{hostId:t="gemini-hud-root",initialWidth:n,initialOpen:r,onWidthChange:o,onOpenChange:i,themes:a,initialTheme:s,onThemeChange:l,buildSections:d,initialTab:c,onTabChange:p,toggleCombo:m=ae=>ae.ctrlKey&&ae.shiftKey&&ae.key.toLowerCase()==="u",closeOnEscape:b=true,minWidth:g=420,maxWidth:w=720}=e,{host:_,shadow:C}=V4(t),E=[[C4,"variables"],[S4,"primitives"],[k4,"utilities"],[w4,"hud"],[_4,"card"],[ng,"badge"],[A4,"button"],[R4,"checkbox"],[E4,"input"],[T4,"label"],[I4,"navTabs"],[P4,"searchBar"],[M4,"select"],[L4,"switch"],[O4,"table"],[F4,"teamListItem"],[N4,"timeRangePicker"],[D4,"tooltip"],[$4,"slider"],[B4,"reorderableList"],[z4,"colorPicker"],[j4,"log"],[G4,"segmentedControl"],[H4,"soundPicker"],[U4,"settings"],[rC,"teamCard"],[Bx,"autoFavoriteSettings"]];for(let ae=0;ae<E.length;ae++){const[le,ve]=E[ae];vt(C,le,ve),ae%5===4&&await q4();}const{panel:P,tabbar:O,content:F,resizer:A,closeButton:T,wrapper:M}=v4({shadow:C,initialOpen:r});function S(ae){P.dispatchEvent(new CustomEvent("gemini:hud-open-change",{detail:{isOpen:ae},bubbles:true})),i?.(ae);}function R(ae){const le=P.classList.contains("open");P.classList.toggle("open",ae),P.setAttribute("aria-hidden",ae?"false":"true"),ae!==le&&S(ae);}R(r),T.addEventListener("click",ae=>{ae.preventDefault(),ae.stopPropagation(),R(false);});const z=b1({host:_,themes:a,initialTheme:s,onThemeChange:l}),j=y4({resizer:A,host:_,shadow:C,onWidthChange:o||(()=>{}),initialWidth:n,minWidth:g,maxWidth:w});j.setHudWidth(n);const q=d({applyTheme:z.applyTheme,initialTheme:s,getCurrentTheme:z.getCurrentTheme,setHUDWidth:j.setHudWidth,setHUDOpen:R}),U=new yS(q,F,{applyTheme:z.applyTheme,getCurrentTheme:z.getCurrentTheme}),ce=q.map(ae=>({id:ae.id,label:ae.label})),W=c&&q.some(ae=>ae.id===c)?c:ce[0]?.id||"",te=vS(ce,W,ae=>{U.activate(ae),p?.(ae);});te.root.style.flex="1 1 auto",te.root.style.minWidth="0",O.append(te.root,T);const ne={"tab-auto-favorite":"autoFavorite","tab-pets":"pets","tab-locker":"locker","tab-trackers":"trackers","tab-alerts":"alerts","tab-avatar":"avatar","tab-room":"room"};function ie(){const ae=tt(ut.CONFIG,{autoFavorite:{enabled:true},pets:{enabled:true},locker:{enabled:true},trackers:{enabled:true},alerts:{enabled:true},avatar:{enabled:true},room:{enabled:true}});for(const[le,ve]of Object.entries(ne))ae[ve]?.enabled??true?te.showTab(le):te.hideTab(le);}function ee(ae){const{key:le}=ae.detail;(le===ut.CONFIG||le==="feature:config")&&ie();}window.addEventListener(xt.STORAGE_CHANGE,ee),ie();let H=W;if(!te.isTabVisible(W)){const ae=te.getVisibleTabs();ae.length>0&&(H=ae[0]);}H&&U.activate(H);const K=x4({panel:P,onToggle:()=>R(!P.classList.contains("open")),onClose:()=>R(false),toggleCombo:m,closeOnEscape:b}),D=()=>{te.recalc();const ae=parseInt(getComputedStyle(_).getPropertyValue("--w"))||n;j.calculateResponsiveBounds(),j.setHudWidth(ae);};he.addEventListener("resize",D);const B=ae=>{const le=ae.detail?.width;le?j.setHudWidth(le):j.setHudWidth(n),te.recalc();};_.addEventListener("gemini:layout-resize",B);function Q(){window.removeEventListener(xt.STORAGE_CHANGE,ee),K.destroy(),j.destroy(),he.removeEventListener("resize",D),_.removeEventListener("gemini:layout-resize",B);}return {host:_,shadow:C,wrapper:M,panel:P,content:F,setOpen:R,setWidth:j.setHudWidth,sections:q,manager:U,nav:te,destroy:Q}}const ii={isOpen:"gemini.hud.isOpen",width:"gemini.hud.width",theme:"gemini.hud.theme",activeTab:"gemini.hud.activeTab"},Ta={isOpen:false,width:480,theme:"dark",activeTab:"tab-settings"};function K4(){return {isOpen:tt(ii.isOpen,Ta.isOpen),width:tt(ii.width,Ta.width),theme:tt(ii.theme,Ta.theme),activeTab:tt(ii.activeTab,Ta.activeTab)}}function Bl(e,t){rt(ii[e],t);}function Y4(e,t){return tt(ii[e],t)}const J4="https://i.imgur.com/IMkhMur.png",Q4="Stats";function Z4(e){let t=e.iconUrl||J4;const n=e.ariaLabel||"Open MGH";let r=null,o=null,i=null,a=false,s=null,l=null;const d=["Chat","Leaderboard","Stats","Open Activity Log"],c=F=>{try{return typeof CSS<"u"&&CSS&&typeof CSS.escape=="function"?CSS.escape(F):F.replace(/"/g,'\\"')}catch{return F}};function p(){const F=document.querySelector(d.map(T=>`button[aria-label="${c(T)}"]`).join(","));if(!F)return null;let A=F.parentElement;for(;A&&A!==document.body;){if(d.reduce((M,S)=>M+A.querySelectorAll(`button[aria-label="${c(S)}"]`).length,0)>=2)return A;A=A.parentElement;}return null}function b(F){const A=Array.from(F.querySelectorAll("button[aria-label]"));if(!A.length)return {refBtn:null,refWrapper:null};const T=A.filter(U=>U.dataset.mghBtn!=="true"&&(U.getAttribute("aria-label")||"")!==(e.ariaLabel||"Open MGH")),M=T.length?T:A,S=M.find(U=>(U.getAttribute("aria-label")||"").toLowerCase()===Q4.toLowerCase())||null,R=M.length>=2?M.length-2:M.length-1,z=S||M[R],j=z.parentElement,q=j&&j.parentElement===F&&j.tagName==="DIV"?j:null;return {refBtn:z,refWrapper:q}}function g(F,A,T){const M=F.cloneNode(false);M.type="button",M.setAttribute("aria-label",A),M.title=A,M.dataset.mghBtn="true",M.style.pointerEvents="auto",M.removeAttribute("id");const S=document.createElement("img");return S.src=T,S.alt="MGH",S.style.pointerEvents="none",S.style.userSelect="none",S.style.width="76%",S.style.height="76%",S.style.objectFit="contain",S.style.display="block",S.style.margin="auto",M.appendChild(S),M.addEventListener("click",R=>{R.preventDefault(),R.stopPropagation();try{e.onClick?.();}catch{}}),M}function w(){if(a)return  false;a=true;let F=false;try{const A=p();if(!A)return !1;s!==A&&(s=A);const{refBtn:T,refWrapper:M}=b(A);if(!T)return !1;o=A.querySelector('div[data-mgh-wrapper="true"]'),!o&&M&&(o=M.cloneNode(!1),o.dataset.mghWrapper="true",o.removeAttribute("id"),F=!0);const S=o?.querySelector('button[data-mgh-btn="true"]')||null;r||(r=S),r||(r=g(T,n,t),o?o.appendChild(r):r.parentElement!==A&&A.appendChild(r),F=!0),o&&o.parentElement!==A&&(A.appendChild(o),F=!0);const R=A;if(R&&R!==l){try{P.disconnect();}catch{}l=R,P.observe(l,{childList:!0,subtree:!0});}return F}finally{a=false;}}const _=document.getElementById("App")||document.body;let C=null,E=false;const P=new MutationObserver(()=>{E&&r&&document.contains(r)||(r&&!document.contains(r)&&(console.warn("[ToolbarButton] Button was removed from DOM, will retry"),E=false,r=null,o=null),C===null&&(C=window.setTimeout(()=>{if(C=null,w()&&r&&document.contains(r)&&(E=true,console.log("[ToolbarButton] Successfully mounted (via observer)"),o)){const A=o.parentElement;A&&A.lastElementChild!==o&&A.appendChild(o);}},100)));});return w()&&r&&document.contains(r)?(E=true,console.log("[ToolbarButton] Successfully mounted (initial)")):console.log("[ToolbarButton] Initial mount failed, will retry via observer"),P.observe(_,{childList:true,subtree:true}),i=()=>P.disconnect(),()=>{try{i?.();}catch{}try{o?.remove();}catch{}}}const xC=[];function eB(){return xC.slice()}function ov(e){xC.push(e);}function tB(e){if(e!=null){if(typeof e=="object"){const t=e;if(typeof t.type=="string")return t.type;if(typeof t.Type=="string")return t.Type;if(typeof t.kind=="string")return t.kind;if(typeof t.messageType=="string")return t.messageType}if(Array.isArray(e)&&typeof e[0]=="string")return e[0]}}function nB(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}const op=Symbol.for("ariesmod.ws.handlers.patched");function zt(e,t){if(typeof e=="string"){const o=e,i={match:a=>a.kind==="message"&&a.type===o,handle:t};return ov(i),i}const n=e,r={match:o=>o.kind==="close"&&o.code===n,handle:t};return ov(r),r}function rB(e,t=eB(),n={}){const r=n.pageWindow??window,o=!!n.debug;if(e[op])return ()=>{};e[op]=true;const i={ws:e,pageWindow:r,debug:o},a=p=>{for(const m of t)try{if(!m.match(p))continue;if(m.handle(p,i)===!0)return}catch(b){o&&console.error("[WS] handler error",b,p);}},s=p=>{const m=nB(p.data),b=tB(m);a({kind:"message",raw:p.data,data:m,type:b});},l=p=>{a({kind:"close",code:p.code,reason:p.reason,wasClean:p.wasClean,event:p});},d=p=>a({kind:"open",event:p}),c=p=>a({kind:"error",event:p});return e.addEventListener("message",s),e.addEventListener("close",l),e.addEventListener("open",d),e.addEventListener("error",c),()=>{try{e.removeEventListener("message",s);}catch{}try{e.removeEventListener("close",l);}catch{}try{e.removeEventListener("open",d);}catch{}try{e.removeEventListener("error",c);}catch{}try{delete e[op];}catch{}}}(function(){try{const t=({ url: (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('__entry.js', document.baseURI).href) }),n=t.glob?.("./**/*.ts",{eager:!0})??t.glob?.("./**/*.js",{eager:!0});if(!n)return}catch{}})();zt(Gn.AuthenticationFailure,(e,t)=>{t.debug&&console.log("[WS][Close] Auth failure",e.code,e.reason);});zt(Gn.ConnectionSuperseded,(e,t)=>{t.debug&&console.log("[WS][Close] Superseded",e.code,e.reason);});zt(Gn.HeartbeatExpired,(e,t)=>{t.debug&&console.log("[WS][Close] Heartbeat expired",e.code,e.reason);});zt(Gn.PlayerKicked,(e,t)=>{t.debug&&console.log("[WS][Close] Player kicked",e.code,e.reason);});zt(Gn.PlayerLeftVoluntarily,(e,t)=>{t.debug&&console.log("[WS][Close] Player left voluntarily",e.code,e.reason);});zt(Gn.ReconnectInitiated,(e,t)=>{t.debug&&console.log("[WS][Close] Reconnect initiated",e.code,e.reason);});zt(Gn.ServerDisposed,(e,t)=>{t.debug&&console.log("[WS][Close] Server disposed",e.code,e.reason);});zt(Gn.UserSessionSuperseded,(e,t)=>{t.debug&&console.log("[WS][Close] User session superseded",e.code,e.reason);});zt(Gn.VersionExpired,(e,t)=>{t.debug&&console.log("[WS][Close] Version expired",e.code,e.reason);});zt(Gn.VersionMismatch,(e,t)=>{t.debug&&console.log("[WS][Close] Version mismatch",e.code,e.reason);});zt(Ir.Config,(e,t)=>{t.debug&&console.log("[WS][STC] Config",e.data);});zt(Ir.CurrencyTransaction,(e,t)=>{t.debug&&console.log("[WS][STC] CurrencyTransaction",e.data);});zt(Ir.Emote,(e,t)=>{t.debug&&console.log("[WS][STC] Emote",e.data);});zt(Ir.InappropriateContentRejected,(e,t)=>{t.debug&&console.log("[WS][STC] InappropriateContentRejected",e.data);});zt(Ir.PartialState,(e,t)=>{t.debug&&console.log("[WS][STC] PartialState",e.data);});zt(Ir.Pong,(e,t)=>{t.debug&&console.log("[WS][STC] Pong",e.data);});zt(Ir.ServerErrorMessage,(e,t)=>{t.debug&&console.log("[WS][STC] ServerErrorMessage",e.data);});zt(Ir.Welcome,(e,t)=>{t.debug&&console.log("[WS][STC] Welcome",e.data);});Re(ge.PlantSeed,(e,t)=>(t.debug&&console.log("[MW][Garden] PlantSeed"),true));Re(ge.WaterPlant,(e,t)=>(t.debug&&console.log("[MW][Garden] WaterPlant"),true));Re(ge.HarvestCrop,(e,t)=>(t.debug&&console.log("[MW][Garden] HarvestCrop"),true));Re(ge.SellAllCrops,(e,t)=>(t.debug&&console.log("[MW][Garden] SellAllCrops"),true));Re(ge.PurchaseSeed,(e,t)=>(t.debug&&console.log("[MW][Garden] PurchaseSeed"),true));Re(ge.PurchaseEgg,(e,t)=>(t.debug&&console.log("[MW][Garden] PurchaseEgg"),true));Re(ge.PurchaseTool,(e,t)=>(t.debug&&console.log("[MW][Garden] PurchaseTool"),true));Re(ge.PurchaseDecor,(e,t)=>(t.debug&&console.log("[MW][Garden] PurchaseDecor"),true));Re(ge.PlantEgg,(e,t)=>(t.debug&&console.log("[MW][Garden] PlantEgg"),true));Re(ge.HatchEgg,(e,t)=>(t.debug&&console.log("[MW][Garden] HatchEgg"),true));Re(ge.PlantGardenPlant,(e,t)=>(t.debug&&console.log("[MW][Garden] PlantGardenPlant"),true));Re(ge.PotPlant,(e,t)=>(t.debug&&console.log("[MW][Garden] PotPlant"),true));Re(ge.MutationPotion,(e,t)=>(t.debug&&console.log("[MW][Garden] MutationPotion"),true));Re(ge.PickupDecor,(e,t)=>(t.debug&&console.log("[MW][Garden] PickupDecor"),true));Re(ge.PlaceDecor,(e,t)=>(t.debug&&console.log("[MW][Garden] PlaceDecor"),true));Re(ge.RemoveGardenObject,(e,t)=>(t.debug&&console.log("[MW][Garden] RemoveGardenObject"),true));Re(ge.MoveInventoryItem,(e,t)=>(t.debug&&console.log("[MW][Inventory] MoveInventoryItem"),true));Re(ge.DropObject,(e,t)=>(t.debug&&console.log("[MW][Inventory] DropObject"),true));Re(ge.PickupObject,(e,t)=>(t.debug&&console.log("[MW][Inventory] PickupObject"),true));Re(ge.ToggleFavoriteItem,(e,t)=>(t.debug&&console.log("[MW][Inventory] ToggleFavoriteItem"),true));Re(ge.PutItemInStorage,(e,t)=>(t.debug&&console.log("[MW][Inventory] PutItemInStorage"),true));Re(ge.RetrieveItemFromStorage,(e,t)=>(t.debug&&console.log("[MW][Inventory] RetrieveItemFromStorage"),true));Re(ge.MoveStorageItem,(e,t)=>(t.debug&&console.log("[MW][Inventory] MoveStorageItem"),true));Re(ge.LogItems,(e,t)=>(t.debug&&console.log("[MW][Inventory] LogItems"),true));Re(ge.PlacePet,(e,t)=>(t.debug&&console.log("[MW][Pets] PlacePet"),true));Re(ge.FeedPet,(e,t)=>(t.debug&&console.log("[MW][Pets] FeedPet"),true));Re(ge.PetPositions,(e,t)=>(t.debug&&console.log("[MW][Pets] PetPositions"),true));Re(ge.SwapPet,(e,t)=>(t.debug&&console.log("[MW][Pets] SwapPet"),true));Re(ge.StorePet,(e,t)=>(t.debug&&console.log("[MW][Pets] StorePet"),true));Re(ge.NamePet,(e,t)=>(t.debug&&console.log("[MW][Pets] NamePet"),true));Re(ge.SellPet,(e,t)=>(t.debug&&console.log("[MW][Pets] SellPet"),true));console.log("[WS] TESTTEST");Re(ge.SetSelectedGame,(e,t)=>(t.debug&&console.log("[MW][Session] SetSelectedGame"),true));Re(ge.VoteForGame,(e,t)=>(t.debug&&console.log("[MW][Session] VoteForGame"),true));Re(ge.RequestGame,(e,t)=>(t.debug&&console.log("[MW][Session] RequestGame"),true));Re(ge.RestartGame,(e,t)=>(t.debug&&console.log("[MW][Session] RestartGame"),true));Re(ge.Ping,(e,t)=>(t.debug&&console.log("[MW][Session] Ping"),true));Re(ge.PlayerPosition,(e,t)=>(t.debug&&console.log("[MW][Session] PlayerPosition"),true));Re(ge.Teleport,(e,t)=>(t.debug&&console.log("[MW][Session] Teleport"),true));Re(ge.CheckWeatherStatus,(e,t)=>(t.debug&&console.log("[MW][Session] CheckWeatherStatus"),true));Re(ge.Chat,(e,t)=>(t.debug&&console.log("[MW][Social] Chat"),true));Re(ge.Dev,(e,t)=>(t.debug&&console.log("[MW][Social] Dev"),true));Re(ge.Emote,(e,t)=>(t.debug&&console.log("[MW][Social] Emote"),true));Re(ge.Wish,(e,t)=>(t.debug&&console.log("[MW][Social] Wish"),true));Re(ge.KickPlayer,(e,t)=>(t.debug&&console.log("[MW][Social] KickPlayer"),true));Re(ge.ReportSpeakingStart,(e,t)=>(t.debug&&console.log("[MW][Voice] ReportSpeakingStart"),true));Re(ge.SetPlayerData,(e,t)=>(t.debug&&console.log("[MW][Social] SetPlayerData"),true));Re(ge.UsurpHost,(e,t)=>(t.debug&&console.log("[MW][Social] UsurpHost"),true));function oB(e={}){const t=e.pageWindow??he,n=e.pollMs??500,r=!!e.debug,o=[];o.push(TI(t,{debug:r})),o.push(mN({pageWindow:t,middlewares:e.middlewares,debug:r}));let i=null;const a=s=>{if(i){try{i();}catch{}i=null;}s&&(i=rB(s,e.handlers,{debug:r,pageWindow:t}));};return a(Nc(t).ws),o.push(xx(s=>a(s.ws),{intervalMs:n,debug:r,pageWindow:t})),{getWs:()=>Nc(t).ws,dispose:()=>{for(let s=o.length-1;s>=0;s--)try{o[s]();}catch{}if(i){try{i();}catch{}i=null;}}}}let zl=null;function iB(e={}){return zl||(zl=oB(e),zl)}const wC=768,iv=6,ip=62,ap=50,aB=.5,sB=.4,jl=36,Gl=28,lB=6,vf=4,cB=8,dB=100,uB=200,av=14,sv=3,pB=40,fB=50,lv=2147483646,Ia="gemini-bulk-favorite-sidebar",hB="gemini-bulk-favorite-top-row",gB="gemini-bulk-favorite-bottom-row",yf="gemini-qol-bulkFavorite-styles",mB=`
/* Desktop: vertical scrollable list next to inventory */
#${Ia} {
  display: flex;
  flex-direction: column;
  gap: ${lB}px;
  pointer-events: auto;
  padding: 4px;
  border-radius: 8px;
  background: rgba(0, 0, 0, 0.6);
  z-index: ${lv};
  overflow-y: auto;
}

/* Mobile: horizontal scrollable rows */
.gemini-qol-bulkFavorite-row {
  display: flex;
  flex-direction: row;
  gap: ${vf}px;
  pointer-events: auto;
  padding: 4px;
  position: fixed;
  z-index: ${lv};
  overflow-x: auto;
  overflow-y: hidden;
  max-width: 100vw;
}

.gemini-qol-bulkFavorite-row::-webkit-scrollbar {
  height: 3px;
}

.gemini-qol-bulkFavorite-row::-webkit-scrollbar-track {
  background: rgba(0, 0, 0, 0.2);
  border-radius: 2px;
}

.gemini-qol-bulkFavorite-row::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.3);
  border-radius: 2px;
}

#${Ia}::-webkit-scrollbar {
  width: 4px;
}

#${Ia}::-webkit-scrollbar-track {
  background: rgba(0, 0, 0, 0.2);
  border-radius: 2px;
}

#${Ia}::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.3);
  border-radius: 2px;
}

/* Individual species button */
.gemini-qol-bulkFavorite-btn {
  position: relative;
  width: ${ip}px;
  height: ${ip}px;
  min-width: ${ip}px;
  background: rgba(0, 0, 0, 0.85);
  border-radius: 6px;
  border: none;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
  padding: 4px;
  gap: 2px;
}

/* Mobile: smaller buttons */
.gemini-qol-bulkFavorite-btn.mobile {
  width: ${ap}px;
  height: ${ap}px;
  min-width: ${ap}px;
}

.gemini-qol-bulkFavorite-btn:hover {
  transform: scale(1.08);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
}

.gemini-qol-bulkFavorite-btn:active {
  transform: scale(0.96);
}

/* Sprite image */
.gemini-qol-bulkFavorite-sprite {
  width: ${jl}px;
  height: ${jl}px;
  object-fit: contain;
  image-rendering: pixelated;
}

.gemini-qol-bulkFavorite-btn.mobile .gemini-qol-bulkFavorite-sprite {
  width: ${Gl}px;
  height: ${Gl}px;
}

/* Heart indicator */
.gemini-qol-bulkFavorite-heart {
  position: absolute;
  top: ${sv}px;
  right: ${sv}px;
  width: ${av}px;
  height: ${av}px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
  line-height: 1;
}

.gemini-qol-bulkFavorite-heart.filled {
  color: #ff4d4d;
}

.gemini-qol-bulkFavorite-heart.outline {
  color: #ffffff;
  opacity: 0.85;
}

/* Species label */
.gemini-qol-bulkFavorite-label {
  color: #ffffff;
  font-size: 9px;
  font-weight: 600;
  text-align: center;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.9);
  max-width: 100%;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  line-height: 1.1;
}

.gemini-qol-bulkFavorite-btn.mobile .gemini-qol-bulkFavorite-label {
  font-size: 8px;
}

/* Fallback sprite (letter) */
.gemini-qol-bulkFavorite-fallback {
  width: ${jl}px;
  height: ${jl}px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  color: #fff;
  background: rgba(255, 255, 255, 0.15);
  border-radius: 4px;
}

.gemini-qol-bulkFavorite-btn.mobile .gemini-qol-bulkFavorite-fallback {
  width: ${Gl}px;
  height: ${Gl}px;
  font-size: 14px;
}
`,bB='<svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>',vB='<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>';function yB(e){const{species:t,itemCount:n,isFavorited:r,isMobile:o,onClick:i}=e,a=x("button",{className:`gemini-qol-bulkFavorite-btn${o?" mobile":""}`,title:`${r?"Unfavorite":"Favorite"} all ${n} ${t}`});return a.dataset.species=t,a.appendChild(xB(t,o)),a.appendChild(wB(r)),a.appendChild(CB(t)),a.addEventListener("click",async s=>{s.preventDefault(),s.stopPropagation(),i();}),a}function xB(e,t){try{if(!ye.isReady()||!ye.has("plant",e))return cv(e);const n=t?sB:aB,r=ye.toCanvas("plant",e,{scale:n});return r.className="gemini-qol-bulkFavorite-sprite",r}catch(n){return console.warn(`[BulkFavorite] Failed to load sprite for ${e}:`,n),cv(e)}}function cv(e){return x("div",{className:"gemini-qol-bulkFavorite-fallback"},e.charAt(0).toUpperCase())}function wB(e){const t=x("span",{className:`gemini-qol-bulkFavorite-heart ${e?"filled":"outline"}`});return t.innerHTML=e?bB:vB,t}function CB(e){return x("span",{className:"gemini-qol-bulkFavorite-label"},e)}let er=null,tr=null,Zn=null,xc=false,Va=null,Pa=false,xi=null;const xf=[];function Hl(e){xf.push(e);}function SB(){for(const e of xf)try{e();}catch(t){console.warn("[BulkFavorite] Cleanup error:",t);}xf.length=0;}function CC(){return window.innerWidth<=wC}function kB(e){return new Promise(t=>setTimeout(t,e))}function SC(){if(xc)return;if(document.getElementById(yf)){xc=true;return}const e=document.createElement("style");e.id=yf,e.textContent=mB,document.head.appendChild(e),xc=true;}function _B(){document.getElementById(yf)?.remove(),xc=false;}function AB(){const e=Hn().get();if(!e?.items)return [];const t=new Set(e.favoritedItemIds??[]),n=new Map;for(const o of e.items){const i=o;if(i.itemType!=="Produce")continue;const a=i.species,s=i.id;if(!a||!s)continue;const l=n.get(a);l?l.push(s):n.set(a,[s]);}const r=[];for(const[o,i]of n){const a=i.length>0&&i.every(s=>t.has(s));r.push({species:o,itemIds:i,allFavorited:a});}return r.sort((o,i)=>o.species.localeCompare(i.species)),r}async function EB(e){const t=Hn().get();if(!t?.items)return;const n=new Set(t.favoritedItemIds??[]),r=[];for(const a of t.items){const s=a;if(s.itemType!=="Produce"||s.species!==e)continue;const l=s.id;l&&r.push({id:l,favorited:n.has(l)});}if(r.length===0)return;const o=r.every(a=>a.favorited),i=o?r.filter(a=>a.favorited):r.filter(a=>!a.favorited);console.log(`🔄 [BulkFavorite] ${o?"Unfavoriting":"Favoriting"} ${i.length}/${r.length} ${e}`);for(const a of i)xd(a.id),await kB(pB);}function wf(e,t){const{species:n,itemIds:r,allFavorited:o}=e;return yB({species:n,itemCount:r.length,isFavorited:o,isMobile:t,onClick:()=>EB(n)})}function TB(e){const t=x("div",{id:Ia}),n=e.getBoundingClientRect(),r=Math.max(window.innerHeight-dB,uB);return t.style.maxHeight=`${r}px`,t.style.position="fixed",t.style.left=`${n.right+cB}px`,t.style.top=`${n.top}px`,t}function dv(e,t,n){const r=x("div",{id:e,className:"gemini-qol-bulkFavorite-row"}),o=t.getBoundingClientRect();return n==="top"?r.style.bottom=`${window.innerHeight-o.top+vf}px`:r.style.top=`${o.bottom+vf}px`,r.style.left=`${o.left}px`,r.style.maxWidth=`${o.width}px`,r}function uv(){const e=AB();CC()?PB(e):IB(e);}function IB(e){if(er){if(er.innerHTML="",e.length===0){er.style.display="none";return}er.style.display="flex";for(const t of e)er.appendChild(wf(t,false));console.log(`🎯 [BulkFavorite] Desktop: Rendered ${e.length} produce types`);}}function PB(e){if(!tr||!Zn)return;if(tr.innerHTML="",Zn.innerHTML="",e.length===0){tr.style.display="none",Zn.style.display="none";return}tr.style.display="flex";const t=e.slice(0,iv),n=e.slice(iv);for(const r of t)tr.appendChild(wf(r,true));if(n.length>0){Zn.style.display="flex";for(const r of n)Zn.appendChild(wf(r,true));}else Zn.style.display="none";console.log(`🎯 [BulkFavorite] Mobile: Rendered ${e.length} types`);}function MB(){const e=document.querySelector(".McGrid");if(!e)return console.log("⚠️ [BulkFavorite] No .McGrid found"),null;const t=e.getBoundingClientRect();if(window.innerWidth<=wC)return console.log(`🎯 [BulkFavorite] Mobile mode - using McGrid: ${Math.round(t.width)}x${Math.round(t.height)}`),e;const r=window.innerWidth/2;let o=null,i=0;const a=e.querySelectorAll(".McFlex, .McGrid");for(const s of a){const l=s.getBoundingClientRect();if(l.width<200||l.height<200||l.width>window.innerWidth-100)continue;const d=l.left+l.width/2,c=1-Math.abs(d-r)/r,m=l.width*l.height*c;m>i&&(o=s,i=m);}if(o){const s=o.getBoundingClientRect();return console.log(`🎯 [BulkFavorite] Found desktop container: ${Math.round(s.width)}x${Math.round(s.height)} @ (${Math.round(s.left)}, ${Math.round(s.top)})`),o}return console.log(`🎯 [BulkFavorite] Fallback to McGrid: ${Math.round(t.width)}x${Math.round(t.height)}`),e}let wi=null;function Cf(){wi&&clearTimeout(wi),wi=setTimeout(()=>{LB();},fB);}function LB(){const e=MB();if(!e)return;console.log("🎯 [BulkFavorite] Found inventory modal container"),qa(),SC(),Va=e,CC()?(tr=dv(hB,e,"top"),Zn=dv(gB,e,"bottom"),document.body.appendChild(tr),document.body.appendChild(Zn)):(er=TB(e),document.body.appendChild(er)),uv(),xi&&xi(),xi=Hn().subscribeFavorites(()=>{Pa&&uv();});}function qa(){wi&&(clearTimeout(wi),wi=null),xi&&(xi(),xi=null),er?.remove(),er=null,tr?.remove(),tr=null,Zn?.remove(),Zn=null,Va=null;}function RB(){qa();}async function Sf(){if(!Rs().enabled){console.log("⚠️ [BulkFavorite] Feature disabled");return}SC();const t=await dd.onChangeNow(o=>{const i=o==="inventory";i!==Pa&&(Pa=i,i?Cf():qa());}),n=Dd(".McGrid",()=>{Pa&&(er||tr||Cf());}),r=$d(".McGrid",o=>{Va&&Va===o&&qa();});Hl(()=>t()),Hl(()=>n.disconnect()),Hl(()=>r.disconnect()),Hl(()=>{qa(),Pa=false,Va=null;}),console.log("✅ [BulkFavorite] Started (State-driven + DOM observation)");}function kf(){SB(),_B(),console.log("🛑 [BulkFavorite] Stopped");}function OB(e){const t=Rs();t.enabled=e,e?Sf():kf();}let Ul=false;const FB={init(){Ul||(Sf(),Ul=true);},destroy(){Ul&&(kf(),Ul=false);},isEnabled(){return p0()},renderButton:Cf,removeButton:RB,startWatching:Sf,stopWatching:kf,setEnabled:OB},NB=`
  <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
    <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
  </svg>
`,DB=`
@keyframes bellRing {
  0%, 100% { transform: rotate(0deg); }
  10%, 30% { transform: rotate(-10deg); }
  20%, 40% { transform: rotate(10deg); }
  50% { transform: rotate(-5deg); }
  60% { transform: rotate(5deg); }
  70% { transform: rotate(0deg); }
}

.alert-btn-ringing {
  animation: bellRing 0.6s ease-in-out;
}
`;let pv=false;function $B(){if(pv)return;pv=true;const e=document.createElement("style");e.textContent=DB,document.head.appendChild(e);}const fv=["Chat","Leaderboard","Stats","Open Activity Log","Open MGH"],hv=e=>{try{return typeof CSS<"u"&&CSS&&typeof CSS.escape=="function"?CSS.escape(e):e.replace(/"/g,'\\"')}catch{return e}};function BB(){const e=document.querySelector(fv.map(n=>`button[aria-label="${hv(n)}"]`).join(","));if(!e)return null;let t=e.parentElement;for(;t&&t!==document.body;){if(fv.reduce((r,o)=>r+t.querySelectorAll(`button[aria-label="${hv(o)}"]`).length,0)>=2)return t;t=t.parentElement;}return null}function zB(e){const t=Array.from(e.querySelectorAll("button[aria-label]"));if(!t.length)return {refBtn:null,refWrapper:null};const n=t.filter(s=>s.dataset.alertBtn!=="true"&&(s.getAttribute("aria-label")||"")!=="Alerts"),r=n.length?n:t,o=r[r.length-1]||null,i=o?.parentElement,a=i&&i.parentElement===e&&i.tagName==="DIV"?i:null;return {refBtn:o,refWrapper:a}}function jB(e,t,n){const r=e.cloneNode(false);r.type="button",r.setAttribute("aria-label",t),r.title=t,r.dataset.alertBtn="true",r.style.pointerEvents="auto",r.style.position="relative",r.removeAttribute("id");const o=document.createElement("div");return o.innerHTML=n,o.dataset.alertIcon="true",o.style.pointerEvents="none",o.style.userSelect="none",o.style.width="76%",o.style.height="76%",o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",o.style.margin="auto",r.appendChild(o),r}function GB(){const e=document.createElement("span");return e.className="alert-badge",e.style.position="absolute",e.style.top="-4px",e.style.right="-4px",e.style.minWidth="18px",e.style.height="18px",e.style.borderRadius="9px",e.style.backgroundColor="#EF4444",e.style.color="white",e.style.fontSize="10px",e.style.fontWeight="700",e.style.display="none",e.style.alignItems="center",e.style.justifyContent="center",e.style.padding="0 4px",e.style.pointerEvents="none",e.style.boxShadow="0 2px 4px rgba(0,0,0,0.2)",e.style.zIndex="1",e.textContent="0",e}function HB(e){$B();const t=e.iconUrl?`<img src="${e.iconUrl}" alt="Alert" style="width:100%;height:100%;object-fit:contain;"/>`:NB,n=e.ariaLabel||"Alerts";let r=null,o=null,i=null,a=null,s=false,l=null,d=null,c=null;function p(){if(s)return  false;s=true;let C=false;try{const E=BB();if(!E)return !1;l!==E&&(l=E);const{refBtn:P,refWrapper:O}=zB(E);if(!P)return !1;o=E.querySelector('div[data-alert-wrapper="true"]'),!o&&O&&(o=O.cloneNode(!1),o.dataset.alertWrapper="true",o.removeAttribute("id"),C=!0);const F=o?.querySelector('button[data-alert-btn="true"]')||null;r||(r=F),r||(r=jB(P,n,t),r.addEventListener("click",T=>{T.preventDefault(),T.stopPropagation();try{e.onClick?.();}catch{}}),i=GB(),r.appendChild(i),o?o.appendChild(r):r.parentElement!==E&&E.appendChild(r),C=!0),o&&o.parentElement!==E&&(E.appendChild(o),C=!0);const A=E;if(A&&A!==d){try{w.disconnect();}catch{}d=A,w.observe(d,{childList:!0,subtree:!0});}return C}finally{s=false;}}const m=document.getElementById("App")||document.body;let b=null,g=false;const w=new MutationObserver(()=>{g&&r&&document.contains(r)||(r&&!document.contains(r)&&(g=false,r=null,i=null,o=null),b===null&&(b=window.setTimeout(()=>{if(b=null,p()&&r&&document.contains(r)&&(g=true,o)){const E=o.parentElement;E&&E.lastElementChild!==o&&E.appendChild(o);}},100)));});return p()&&r&&document.contains(r)&&(g=true),w.observe(m,{childList:true,subtree:true}),a=()=>w.disconnect(),{get root(){return r},updateBadge(C){i&&(C>0?(i.textContent=String(C),i.style.display="flex"):i.style.display="none");},ring(){if(!r)return;const C=r.querySelector('[data-alert-icon="true"]');C&&(C.classList.add("alert-btn-ringing"),setTimeout(()=>{C?.classList.remove("alert-btn-ringing");},600));},startRinging(){r&&(c!==null&&clearInterval(c),this.ring(),c=window.setInterval(()=>{this.ring();},3e3));},stopRinging(){if(c!==null&&(clearInterval(c),c=null),r){const C=r.querySelector('[data-alert-icon="true"]');C&&C.classList.remove("alert-btn-ringing");}},destroy(){this.stopRinging();try{a?.();}catch{}try{o?.remove();}catch{}}}}const UB=`
  /* ============================================
     Alert Overlay Container
     ============================================ */
  .alert-overlay {
    position: fixed;
    width: 340px;
    max-width: calc(100vw - 16px);
    max-height: min(480px, calc(100vh - 100px));
    background: var(--bg, rgba(10, 12, 18, 0.95));
    border: 1px solid var(--border, rgba(148, 163, 184, 0.3));
    border-radius: 12px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    z-index: 10000;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    font-family: var(--font-ui, system-ui, -apple-system, "Segoe UI", Roboto, sans-serif);
    color: var(--fg, #e5e7eb);
    isolation: isolate;
  }

  /* ============================================
     Header
     ============================================ */
  .alert-overlay-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 14px 16px;
    border-bottom: 1px solid var(--border, rgba(148, 163, 184, 0.2));
    flex-shrink: 0;
  }

  .alert-overlay-title {
    font-size: 15px;
    font-weight: 700;
    color: var(--fg, #e5e7eb);
    user-select: none;
  }

  .alert-overlay-close {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
    background: transparent;
    color: var(--fg, rgba(229, 231, 235, 0.7));
    font-size: 18px;
    cursor: pointer;
    border-radius: 6px;
    transition: all 0.15s ease;
    padding: 0;
    flex-shrink: 0;
  }

  .alert-overlay-close:hover {
    background: var(--soft, rgba(229, 231, 235, 0.1));
    color: var(--fg, #e5e7eb);
  }

  .alert-overlay-close:active {
    background: var(--muted, rgba(229, 231, 235, 0.15));
  }

  /* ============================================
     Items List
     ============================================ */
  .alert-overlay-list {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: thin;
    scrollbar-color: rgba(148, 163, 184, 0.3) transparent;
  }

  .alert-overlay-list::-webkit-scrollbar {
    width: 8px;
  }

  .alert-overlay-list::-webkit-scrollbar-track {
    background: transparent;
  }

  .alert-overlay-list::-webkit-scrollbar-thumb {
    background: var(--border, rgba(148, 163, 184, 0.3));
    border-radius: 4px;
  }

  .alert-overlay-list::-webkit-scrollbar-thumb:hover {
    background: var(--border, rgba(148, 163, 184, 0.5));
  }

  /* ============================================
     Item Row
     ============================================ */
  .alert-item-row {
    display: grid;
    grid-template-columns: 56px 1fr auto;
    gap: 12px;
    align-items: center;
    padding: 12px 16px;
    border-bottom: 1px solid var(--border, rgba(148, 163, 184, 0.1));
    transition: background 0.15s ease;
  }

  .alert-item-row:hover {
    background: var(--soft, rgba(229, 231, 235, 0.05));
  }

  .alert-item-row:last-child {
    border-bottom: none;
  }

  /* ============================================
     Sprite Column
     ============================================ */
  .alert-item-sprite {
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--soft, rgba(229, 231, 235, 0.05));
    border-radius: 8px;
    flex-shrink: 0;
  }

  .alert-item-sprite canvas {
    max-width: 100%;
    max-height: 100%;
    image-rendering: pixelated;
    image-rendering: crisp-edges;
  }

  /* ============================================
     Info Column
     ============================================ */
  .alert-item-info {
    display: flex;
    flex-direction: column;
    gap: 4px;
    min-width: 0;
  }

  .alert-item-name {
    font-size: 14px;
    font-weight: 600;
    color: var(--fg, #e5e7eb);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .alert-item-remaining {
    font-size: 12px;
    color: var(--fg, rgba(229, 231, 235, 0.7));
    opacity: 0.7;
  }

  /* ============================================
     Actions Column
     ============================================ */
  .alert-item-actions {
    display: flex;
    gap: 6px;
    flex-shrink: 0;
  }

  .alert-item-btn {
    padding: 8px 12px;
    font-size: 12px;
    font-weight: 600;
    border-radius: 6px;
    border: 1px solid var(--border, rgba(148, 163, 184, 0.3));
    background: var(--soft, rgba(229, 231, 235, 0.08));
    color: var(--fg, #e5e7eb);
    cursor: pointer;
    transition: all 0.15s ease;
    min-height: 32px;
    white-space: nowrap;
  }

  .alert-item-btn:hover:not(:disabled) {
    background: var(--muted, rgba(229, 231, 235, 0.12));
    border-color: var(--accent, rgba(96, 165, 250, 0.4));
  }

  .alert-item-btn:active:not(:disabled) {
    background: var(--muted, rgba(229, 231, 235, 0.16));
  }

  .alert-item-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }

  .alert-item-btn--buy {
    /* Specific styles for Buy button (optional) */
  }

  .alert-item-btn--buy-all {
    /* Specific styles for Buy All button (optional) */
  }

  /* ============================================
     Empty State
     ============================================ */
  .alert-overlay-empty {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 48px 24px;
    text-align: center;
    color: var(--fg, rgba(229, 231, 235, 0.6));
    opacity: 0.6;
  }

  .alert-overlay-empty-icon {
    font-size: 48px;
    margin-bottom: 12px;
    opacity: 0.5;
  }

  .alert-overlay-empty-text {
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 6px;
  }

  .alert-overlay-empty-subtext {
    font-size: 12px;
    opacity: 0.8;
  }

  /* ============================================
     Responsive - Mobile
     ============================================ */
  @media (max-width: 480px) {
    .alert-overlay {
      width: calc(100vw - 16px);
      max-height: calc(100vh - 80px);
    }

    .alert-item-row {
      grid-template-columns: 44px 1fr auto;
      gap: 8px;
      padding: 10px 12px;
    }

    .alert-item-actions {
      grid-column: auto;
      justify-content: flex-end;
    }

    .alert-item-btn {
      flex: 0 0 auto;
      min-height: 36px;
    }

    .alert-overlay-header {
      padding: 12px 14px;
    }

    .alert-item-sprite {
      width: 40px;
      height: 40px;
    }
  }

  /* ============================================
     Touch-friendly targets (minimum 44px)
     ============================================ */
  @media (pointer: coarse) {
    .alert-overlay-close {
      min-width: 44px;
      min-height: 44px;
    }

    .alert-item-btn {
      min-height: 44px;
      padding: 10px 14px;
    }
  }

  /* ============================================
     Accessibility - Focus states
     ============================================ */
  .alert-item-btn:focus-visible {
    outline: 2px solid var(--accent, #60a5fa);
    outline-offset: 2px;
  }

  /* ============================================
     Animation - Fade in
     ============================================ */
  @keyframes alertOverlayFadeIn {
    from {
      opacity: 0;
      transform: translateY(-8px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .alert-overlay {
    animation: alertOverlayFadeIn 0.2s ease-out;
  }
`;function WB(e,t){const n=x("div",{className:"alert-item-row"}),r=x("div",{className:"alert-item-sprite"});if(e.spriteId)try{const d=ye.toCanvas(e.spriteId,{scale:.35});d?r.appendChild(d):r.textContent="?";}catch{r.textContent="?";}else r.textContent="?";const o=x("div",{className:"alert-item-info"}),i=x("div",{className:"alert-item-name"},e.itemName),a=x("div",{className:"alert-item-remaining"},`${e.remaining} remaining`);o.appendChild(i),o.appendChild(a);const s=x("div",{className:"alert-item-actions"}),l=x("button",{className:"alert-item-btn alert-item-btn--buy-all",type:"button",title:`Buy all ${e.remaining} available`},"Buy All");return l.addEventListener("click",d=>{d.stopPropagation(),t?.(e);}),s.appendChild(l),n.appendChild(r),n.appendChild(o),n.appendChild(s),n}function VB(){const e=x("div",{className:"alert-overlay-empty"}),t=x("div",{className:"alert-overlay-empty-icon"},"🔔"),n=x("div",{className:"alert-overlay-empty-text"},"No items available"),r=x("div",{className:"alert-overlay-empty-subtext"},"Tracked items will appear here when in stock");return e.appendChild(t),e.appendChild(n),e.appendChild(r),e}function gv(e,t){const n=t.getBoundingClientRect(),r=340,o=8;e.style.position="fixed",e.style.top="",e.style.bottom="",e.style.left="",e.style.right="";let i=n.bottom+o,a=window.innerWidth-n.right;const s=i+480>window.innerHeight,l=n.right-r<o;s?(e.style.bottom=`${window.innerHeight-n.top+o}px`,e.style.top="auto"):e.style.top=`${i}px`,e.style.right=`${a}px`,l&&(e.style.right="auto",e.style.left=`${o}px`);}function qB(e){const{items:t,anchorElement:n,onClose:r,onBuyAll:o}=e,i=x("div",{className:"alert-overlay"}),a=Y4("theme",Ta.theme),s=ai[a];let l="";s&&(l=`.alert-overlay {
    ${Object.entries(s).map(([E,P])=>`${E}: ${P};`).join(`
    `)}
  }

`);const d=document.createElement("style");d.textContent=l+UB,i.appendChild(d);const c=x("div",{className:"alert-overlay-header"}),p=x("div",{className:"alert-overlay-title"},"Available Items"),m=x("button",{className:"alert-overlay-close",type:"button",title:"Close"},"✕");m.addEventListener("click",C=>{C.stopPropagation(),r?.();}),c.appendChild(p),c.appendChild(m);const b=x("div",{className:"alert-overlay-list"});i.appendChild(c),i.appendChild(b);const g=C=>{if(b.replaceChildren(),C.length===0)b.appendChild(VB());else for(const E of C){const P=WB(E,o);b.appendChild(P);}};g(t),gv(i,n);const w=()=>{gv(i,n);};window.addEventListener("resize",w);const _=C=>{const E=C.target;!i.contains(E)&&!n.contains(E)&&r?.();};return document.addEventListener("click",_,{capture:true}),{root:i,updateItems:g,destroy(){window.removeEventListener("resize",w),document.removeEventListener("click",_,{capture:true}),i.remove();}}}const XB={seed:"plants",tool:"items",egg:"eggs",decor:"decor"},KB={seed:"seed",tool:null,egg:null,decor:null};function kC(e,t,n){try{const r=XB[t],o=we.get(r);if(!o||typeof o!="object")return null;const i=o[e];if(!i||typeof i!="object")return null;const a=KB[t],s=a?i[a]:i;return !s||typeof s!="object"?null:s[n]??null}catch{return null}}function YB(e,t){return kC(e,t,"spriteId")}function JB(e,t){return kC(e,t,"name")??e}function QB(e,t){const n=Ro.getTrackedItems(),r=new Set(n.filter(i=>i.shopType===e).map(i=>i.itemId));return r.size===0?[]:t.items.filter(i=>{const a=r.has(i.id),s=i.isAvailable;return a&&s}).map(i=>({shopType:e,itemId:i.id,itemName:JB(i.id,e),spriteId:YB(i.id,e),remaining:i.remaining,price:i.price}))}function Ma(){const t=$i().get(),n=["seed","tool","egg","decor"],r=[];for(const o of n){const i=t.byType[o];if(i){const a=QB(o,i);r.push(...a);}}return r}function ZB(e){return $i().subscribeStable(()=>{const r=Ma();e(r);})}function e8(){let e=null,t=null,n=null,r=false,o=[],i=[],a="",s=0,l=0,d=false,c=null,p=[],m=0,b=false;const g=()=>{try{return Et.CustomSounds.getNotificationConfig("shop")}catch{return null}},w=(H,K)=>{try{const D=Ne.getItemCustomSound("shop",H,K);return D?{soundId:D.soundId,volume:D.volume,mode:D.mode}:null}catch{return null}},_=H=>`${H.soundId}:${H.volume}`,C=(H,K,D,B)=>{K.has(D)||(H.push({soundId:D,volume:B}),K.add(D));},E=(H,K)=>{const D=[],B=new Set;let Q=false;const ae=[];for(const le of H){const ve=w(le.itemId,le.shopType);ve?ve.mode==="one-shot"&&ae.push({soundId:ve.soundId,volume:ve.volume}):K?.mode==="one-shot"&&(Q=true);}Q&&K&&C(D,B,K.soundId,K.volume);for(const le of ae)C(D,B,le.soundId,le.volume);return D},P=(H,K)=>{const D=[],B=new Set;let Q=false;const ae=[];for(const le of H){const ve=w(le.itemId,le.shopType);ve?ve.mode==="loop"&&ae.push({soundId:ve.soundId,volume:ve.volume}):K?.mode==="loop"&&(Q=true);}Q&&K&&C(D,B,K.soundId,K.volume);for(const le of ae)C(D,B,le.soundId,le.volume);return D},O=(H,K,D,B=false)=>{if(!D())return;const Q=Ne.getById(H.soundId);if(!Q){K();return}B&&(c=Q.source),Et.playCustom(Q.source,{volume:H.volume/100}).then(ae=>{if(!D())return;const le=ae.audio,ve=()=>{D()&&K();};le.addEventListener("ended",ve,{once:true});}).catch(()=>{D()&&K();});},F=()=>{if(!d||i.length===0)return;const H=i[s];s=(s+1)%i.length;const K=l,D=()=>d&&l===K;O(H,()=>{D()&&F();},D,true);},A=()=>{d||i.length===0||(d=true,s>=i.length&&(s=0),F());},T=()=>{if(d){l+=1,d=false;try{const H=Et.getCustomHandle();(!c||H&&H.url===c)&&Et.CustomSounds.stop();}catch{}c=null;}},M=()=>{T(),i=[],a="",s=0,c=null;},S=()=>{if(p.length===0){b=false,A();return}b=true;const H=p.shift(),K=m,D=()=>b&&m===K;O(H,()=>{D()&&S();},D);},R=(H,K)=>{const D=K??g(),B=E(H,D);if(B.length===0)return;const Q=new Set(p.map(ae=>ae.soundId));for(const ae of B)Q.has(ae.soundId)||(p.push(ae),Q.add(ae.soundId));b||(m+=1,T(),S());},z=(H,K)=>{const D=K??g(),B=P(H,D);if(B.length===0){M();return}const Q=B.map(_).join("|"),ae=Q!==a;i=B,a=Q,ae&&(s=0,d&&T()),!b&&(d||A());},j=H=>{const K=o.length>0,D=H.length>0;o=H,e?.updateBadge(H.length),D?K||e?.startRinging():K&&e?.stopRinging();},q=()=>{if(r||!e?.root)return;const H=Ma();t=qB({items:H,anchorElement:e.root,onClose:U,onBuyAll:K=>{switch(K.shopType){case "seed":mo.seed.buyAll(K.itemId);break;case "egg":mo.egg.buyAll(K.itemId);break;case "decor":mo.decor.buyAll(K.itemId);break;case "tool":mo.tool.buyAll(K.itemId);break}}}),document.body.appendChild(t.root),r=true;},U=()=>{!r||!t||(t.destroy(),t=null,r=false);},ce=()=>{r?U():q();},W=H=>{if(j(H),r&&t&&t.updateItems(H),z(H),H.length>0){const K=new CustomEvent("gemini:alert-available",{detail:{items:H}});window.dispatchEvent(K);}},te=()=>{const H=Ma(),K=new Set(o.map(ae=>`${ae.shopType}:${ae.itemId}`)),D=H.filter(ae=>!K.has(`${ae.shopType}:${ae.itemId}`)),B=D.length>0;j(H),r&&t&&t.updateItems(H);const Q=g();z(H,Q),B&&R(D,Q);};e=HB({onClick:ce,ariaLabel:"Alerts"}),n=ZB(W),window.addEventListener("gemini:tracked-items-changed",te);const ne=H=>{const K=H,{shopType:D,items:B}=K.detail;if(!B||B.length===0)return;const Q=B.map(ae=>({itemId:ae.itemId,shopType:D}));R(Q,g());};window.addEventListener("gemini:shop-restock-tracked",ne);const ie=H=>{if(H.detail?.entityType!=="shop")return;const D=Ma();z(D,g());};window.addEventListener(xt.CUSTOM_SOUND_CHANGE,ie);const ee=(H=1,K=10)=>{if($i().get().all.some(ae=>ae.items.length>0)||H>=K){const ae=Ma();j(ae);const le=g();z(ae,le),ae.length>0&&R(ae,le);}else setTimeout(()=>ee(H+1,K),500);};return ee(),{destroy(){U(),n?.(),n=null,window.removeEventListener("gemini:tracked-items-changed",te),window.removeEventListener("gemini:shop-restock-tracked",ne),window.removeEventListener(xt.CUSTOM_SOUND_CHANGE,ie),e?.destroy(),e=null,p=[],m+=1,b=false,M();}}}const t8=`
  .gemini-qol-storageValue {
    display: inline-flex;
    align-items: center;
    justify-content: flex-start;
    gap: 6px;
    padding-left: 2px;
  }

  .gemini-qol-storageValue-sprite {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    flex-shrink: 0;
  }

  .gemini-qol-storageValue-text {
    font-size: 14px;
    color: var(--accent);
    font-weight: 700;
    white-space: nowrap;
  }

  @media (max-width: 768px) {
    .gemini-qol-storageValue {
      gap: 4px;
    }

    .gemini-qol-storageValue-sprite {
      width: 16px;
      height: 16px;
    }

    .gemini-qol-storageValue-text {
      font-size: 12px;
    }
  }
`,sp={seed:"SeedSilo",pet:"PetHutch",decor:"DecorShed"};function mv(e){return Array.isArray(e)?e.filter(t=>typeof t=="object"&&t!==null&&"items"in t):[]}function n8(e){if(typeof e=="string")return e;if(e&&typeof e=="object"&&"decorId"in e){const t=e.decorId;return typeof t=="string"?t:null}return null}function lp(e,t){return e.filter(r=>n8(r.decorId)===t).flatMap(r=>r.items??[])}function bv(e){if(!e.length)return 0;const t=we.get("plants");return t?e.reduce((n,r)=>{const i=t[r.species]?.seed?.coinPrice??0;return n+i*(r.quantity??0)},0):0}function vv(e){if(!e.length)return 0;const t=we.get("decor");return t?e.reduce((n,r)=>{const i=t[r.decorId]?.coinPrice??0;return n+i*(r.quantity??0)},0):0}function r8(e){const t=we.get("pets");if(!t)return 0;const n=t[e.petSpecies],r=n?.maturitySellPrice??n?.sellPrice??0,o=Ss(e.petSpecies,e.targetScale),i=ks(e.petSpecies,e.xp,o),s=Mx(i,o)*e.targetScale,l=hh(e.mutations??[]);return Math.round(r*s*l)}function yv(e){return e.length?e.reduce((t,n)=>t+r8(n),0):0}function o8(){return {async start(e){const t=[],n=(l,d)=>{const c=lp(l,sp.seed).filter(g=>g.itemType==="Seed"),p=bv(c),m=d.filter(g=>g.itemType==="Seed"),b=bv(m);e({kind:"seed",storageValue:p,inventoryValue:b,totalValue:p+b});},r=(l,d)=>{const c=lp(l,sp.decor).filter(g=>g.itemType==="Decor"),p=vv(c),m=d.filter(g=>g.itemType==="Decor"),b=vv(m);e({kind:"decor",storageValue:p,inventoryValue:b,totalValue:p+b});},o=(l,d)=>{const c=lp(l,sp.pet).filter(g=>g.itemType==="Pet"),p=yv(c),m=d.filter(g=>g.itemType==="Pet"),b=yv(m);e({kind:"pet",storageValue:p,inventoryValue:b,totalValue:p+b});},i=l=>{const d=mv(l?.storages??[]),c=l?.items??[];n(d,c),r(d,c),o(d,c);},a=l=>{const d=mv(l);n(d,[]),r(d,[]),o(d,[]);};let s=null;try{s=await et.subscribeImmediate("myInventoryAtom",i);}catch(l){console.warn("[StorageValueIndicator] Failed to subscribe myInventoryAtom",l);try{s=await et.subscribeImmediate("myItemStoragesAtom",a);}catch(d){console.warn("[StorageValueIndicator] Failed to subscribe myItemStoragesAtom",d);}}return s&&t.push(s),()=>{for(const l of t)try{l();}catch{}t.length=0;}}}}const i8={seed:"Seeds in Silo",pet:"Pets in Hutch",decor:"Decor in Shed"},xv="gemini-qol-storageValue-styles",a8="gemini-qol-storageValue",_C="gemini-qol-storageValue-text",s8={seedSilo:"seed",petHutch:"pet",decorShed:"decor"};let _r=Vt(),bs=false,wc=false,Oo=null,_f=null,Tn=null,Xa="",Wl=null,Ar={seed:{storage:0,inventory:0,total:0},pet:{storage:0,inventory:0,total:0},decor:{storage:0,inventory:0,total:0}},So=null;function AC(){if(wc)return;if(document.getElementById(xv)){wc=true;return}const e=document.createElement("style");e.id=xv,e.textContent=t8,document.head.appendChild(e),_r.add(()=>e.remove()),wc=true;}function cg(){Tn?.remove(),Tn=null,_f=null,Xa="";}function Af(e){if(!Tn)return;const t=Tn.querySelector(`.${_C}`);t&&(t.textContent=TC(e),Tn.dataset.rawValue=String(Math.round(e)),Tn.title=`${e.toLocaleString()} coins`);}function Cc(){if(!Tn||!Oo)return;const e=Ar[Oo];Tn.dataset.rawValue=String(Math.round(e.total)),Tn.title=`${e.storage.toLocaleString()} + ${e.inventory.toLocaleString()}`;}function EC(){const e=Ar.seed,t=Ar.pet,n=Ar.decor;return `${e.storage}|${e.inventory}|${e.total}|${t.storage}|${t.inventory}|${t.total}|${n.storage}|${n.inventory}|${n.total}`}function l8(e){const t=document.createElement("div");t.className=a8,t.dataset.rawValue=String(Math.round(e)),t.title=`${e.toLocaleString()} coins`;const n=document.createElement("div");n.className="gemini-qol-storageValue-sprite";const r=document.createElement("canvas");r.width=20,r.height=20,n.appendChild(r);const o=document.createElement("div");o.className=_C,o.textContent=TC(e),t.appendChild(n),t.appendChild(o);try{const i=ye.toCanvas("ui","Coin");if(i){const a=r.getContext("2d");if(a){const s=Math.min(r.width/i.width,r.height/i.height),l=i.width*s,d=i.height*s,c=(r.width-l)/2,p=(r.height-d)/2;a.drawImage(i,c,p,l,d);}}}catch(i){console.warn("[StorageValueIndicator] Failed to render coin sprite:",i);}return t}function TC(e){const t=Math.round(e);if(t>=1e15)return `${(t/1e15).toFixed(2)}Q`;if(t>=1e12)return `${(t/1e12).toFixed(2)}T`;if(t>=1e9)return `${(t/1e9).toFixed(2)}B`;if(t>=1e6)return `${(t/1e6).toFixed(2)}M`;if(t>=1e3){const n=t/1e3;return n>=100?`${Math.round(n)}K`:`${n.toFixed(1)}K`}return String(t)}function Sc(e){const t=i8[e],n=document.querySelectorAll(".chakra-text, p, span");for(const r of n){if(r.textContent?.trim()!==t||!r.offsetParent)continue;const i=r.closest(".McGrid");if(!(!i||!i.querySelector(".McFlex")))return i}return null}function IC(){return Sc("seed")?"seed":Sc("pet")?"pet":Sc("decor")?"decor":null}function c8(e){const t=Sc(e);if(!t)return;const n=EC();if(t===_f&&Tn?.isConnected){n!==Xa&&(Xa=n,Af(Ar[e].total),Cc()),Af(Ar[e].total),Cc();return}cg(),_f=t;const r=l8(Ar[e].total);Tn=r,Xa=n,Cc();const o=document.createElement("div");o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="flex-start",o.style.position="relative",o.style.minHeight="20px",o.appendChild(r),t.insertBefore(o,t.firstChild),_r.add(()=>o.remove());}function Ef(e){if(e!==Oo){if(Oo=e,!e){cg();return}AC(),c8(e);}}async function d8(){if(Wl)return;Wl=await o8().start(({kind:t,storageValue:n,inventoryValue:r,totalValue:o})=>{Ar[t]={storage:n,inventory:r,total:o},Oo===t&&Tn&&(Xa=EC(),Af(o),Cc());}),_r.add(()=>{Wl?.(),Wl=null;});}function kc(){const e=Oo??IC();Ef(e);}function u8(){So!==null&&clearTimeout(So),So=window.setTimeout(()=>{So=null,Bi()||lr(()=>kc());},200);}function p8(){setTimeout(kc,100),setTimeout(kc,400),setTimeout(kc,800);const e=new MutationObserver(()=>{Bi()||u8();});e.observe(document.body,{childList:true,subtree:true}),zo(_r,e),_r.add(()=>{So!==null&&(clearTimeout(So),So=null);});}function f8(){bs||(bs=true,AC(),d8(),dd.onChangeNow(e=>{const t=e?s8[String(e)]??null:null;if(t){Ef(t);return}const n=IC();Ef(n);}).then(e=>{_r.add(()=>e());}),p8());}function h8(){bs&&(bs=false,cg(),_r.run(),_r.clear(),_r=Vt(),wc=false,Oo=null,Ar={seed:{storage:0,inventory:0,total:0},pet:{storage:0,inventory:0,total:0},decor:{storage:0,inventory:0,total:0}});}function g8(){return bs}const m8={init:f8,destroy:h8,isEnabled:g8};function b8(e){e.logStep("WebSocket","Capturing WebSocket...");let t=null;return t=xx(n=>{n.ws&&(e.logStep("WebSocket","WebSocket captured","success"),t?.(),t=null);},{intervalMs:250}),iB({debug:false}),()=>{t?.(),t=null;}}async function v8(e){e.logStep("Atoms","Prewarming Jotai store...");try{await _y(),await jf({timeoutMs:8e3,intervalMs:50}),e.logStep("Atoms","Jotai store ready","success");}catch(t){e.logStep("Atoms","Jotai store not captured yet","error"),console.warn("[Bootstrap] Jotai store wait failed",t);}}function y8(e){e.logStep("Globals","Initializing global variables...");try{Dx(),e.logStep("Globals","Global variables ready","success");}catch(t){e.logStep("Globals","Failed to initialize global variables","error"),console.warn("[Bootstrap] Global variables init failed",t);}}function x8(e){e.logStep("API","Exposing Gemini API...");try{a$(),e.logStep("API","Gemini API ready","success");}catch(t){e.logStep("API","Failed to expose API","error"),console.warn("[Bootstrap] API init failed",t);}}function cp(){return new Promise(e=>{typeof requestIdleCallback<"u"?requestIdleCallback(()=>e(),{timeout:50}):setTimeout(e,0);})}async function w8(e){e.logStep("HUD","Loading HUD preferences..."),await cp();const t=K4();await cp();const n=await X4({hostId:"gemini-hud-root",initialWidth:t.width,initialOpen:t.isOpen,onWidthChange:r=>Bl("width",r),onOpenChange:r=>Bl("isOpen",r),themes:ai,initialTheme:t.theme,onThemeChange:r=>Bl("theme",r),buildSections:r=>m4({applyTheme:r.applyTheme,initialTheme:r.initialTheme,getCurrentTheme:r.getCurrentTheme,setHUDWidth:r.setHUDWidth,setHUDOpen:r.setHUDOpen}),initialTab:t.activeTab,onTabChange:r=>Bl("activeTab",r)});return await cp(),e.logStep("HUD","HUD ready","success"),n}async function C8(e){e.setSubtitle("Activating Gemini modules...");let t=0,n=0;await $x(r=>{r.status==="start"?n++:r.status==="success"?(t++,e.logStep("Modules",`Loading modules... (${t}/${n})`)):r.status==="error"&&e.logStep("Modules",`Loading modules... (${t}/${n}) - ${r.name} failed`,"error");}),e.logStep("Modules",`All modules loaded (${n}/${n})`,"success");}async function S8(e){try{ye.isReady()||await ye.init(),we.resolveSprites();const t=[],n=we.get("plants");if(n)for(const l of Object.values(n))l?.seed?.spriteId&&t.push(l.seed.spriteId),l?.plant?.spriteId&&t.push(l.plant.spriteId),l?.crop?.spriteId&&t.push(l.crop.spriteId);const r=we.get("pets");if(r)for(const l of Object.values(r))l?.spriteId&&t.push(l.spriteId);const o=we.get("items");if(o)for(const l of Object.values(o))l?.spriteId&&t.push(l.spriteId);const i=we.get("eggs");if(i)for(const l of Object.values(i))l?.spriteId&&t.push(l.spriteId);const a=we.get("decor");if(a)for(const l of Object.values(a))l?.spriteId&&t.push(l.spriteId);const s=[...new Set(t)];s.length>0&&await ye.warmup(s,()=>{},5);}catch(t){console.warn("[Bootstrap] Sprite warmup failed",t);}}async function k8(e){e.logStep("Sections","Preloading UI sections...");try{await b4(),e.logStep("Sections","Sections preloaded","success");}catch(t){e.logStep("Sections","Sections preload failed","error"),console.warn("[Bootstrap] Sections preload failed",t);}}function _8(e){e.logStep("Features","Initializing features...");const t=[{name:"AntiAfk",init:ui.init.bind(ui)},{name:"PetTeam",init:ze.init.bind(ze)},{name:"BulkFavorite",init:Up.init.bind(Up)},{name:"XPTracker",init:qp.init.bind(qp)},{name:"CropValueIndicator",init:lc.init.bind(lc)},{name:"CropSizeIndicator",init:uc.init.bind(uc)},{name:"ShopNotifier",init:Ro.init.bind(Ro)},{name:"WeatherNotifier",init:Mi.init.bind(Mi)},{name:"PetHungerNotifier",init:ms.init.bind(ms)},{name:"AriesAPI",init:Yc.init.bind(Yc)},{name:"HarvestLocker",init:tn.init.bind(tn)},{name:"EggLocker",init:Hr.init.bind(Hr)},{name:"DecorLocker",init:Ur.init.bind(Ur)},{name:"MissingVariantsIndicator",init:Vu.init.bind(Vu)},{name:"Journal",init:Bt.init.bind(Bt)}];let n=0;for(const r of t)try{r.init(),n++,e.logStep("Features",`Initializing features... (${n}/${t.length})`,"info");}catch(o){e.logStep("Features",`Initializing features... (${n}/${t.length}) - ${r.name} failed`,"error"),console.warn(`[Bootstrap] Feature ${r.name} init failed`,o);}e.logStep("Features",`All features initialized (${t.length}/${t.length})`,"success"),e.logStep("Injections","Initializing QOL injections...");try{const r=Tc();r.register({id:"bulkFavoriteInject",name:"Bulk Favorite Inject",description:"Quick favorite/unfavorite multiple mutations",injection:FB,storageKey:ut.BULK_FAVORITE,defaultEnabled:!1}),r.register({id:"cropValueIndicator",name:"Crop Price",description:"Shows coin value in crop tooltips",injection:lc.render,storageKey:ut.CROP_VALUE_INDICATOR,defaultEnabled:!1}),r.register({id:"cropSizeIndicator",name:"Crop Size",description:"Shows size percentage in crop tooltips",injection:uc.render,storageKey:ut.CROP_SIZE_INDICATOR,defaultEnabled:!1}),r.register({id:"missingVariantsIndicator",name:"Missing Variants",description:"Shows colored letters for unlogged crop variants",injection:Vu.render,storageKey:ut.MISSING_VARIANTS_INDICATOR,defaultEnabled:!1}),r.register({id:"storageValueIndicator",name:"Storage Value",description:"Shows total coin value for storage modals",injection:m8,storageKey:Dr.STORAGE_VALUE_INDICATOR,defaultEnabled:!0}),r.initAll(),e.logStep("Injections","QOL injections registered and initialized","success");}catch(r){e.logStep("Injections","QOL injections initialization failed","error"),console.warn("[Bootstrap] Injections init failed",r);}}Uv();yA();(async function(){AS();const e=mS({title:"Gemini is loading",subtitle:"Connecting and preparing modules..."});let t=null;try{t=b8(e),await v8(e),y8(e),x8(e),await C8(e),await Promise.all([(async()=>{_8(e);})(),(async()=>{await S8(e);})()]),await k8(e),e.succeed("Gemini is ready!");}catch(r){e.fail("Failed to initialize the mod.",r);}finally{t?.();}const n=await w8(e);Z4({onClick:()=>n.setOpen(true)}),e8();})();

})();