// ==UserScript==
// @name         Gemini
// @namespace    Gemini
// @version      1.0.1
// @author
// @match        https://1227719606223765687.discordsays.com/*
// @match        https://magiccircle.gg/r/*
// @match        https://magicgarden.gg/r/*
// @match        https://starweaver.org/r/*
// @resource     ICON  https://imgur.com/a/nf1ZKbp
// @connect      i.imgur.com
// @connect      raw.githubusercontent.com
// @connect      ariesmod-api.ariedam.fr
// @connect      xjuvryjgrjchbhjixwzh.supabase.co
// @connect      magicgarden.gg
// @grant        GM_getValue
// @grant        GM_info
// @grant        GM_openInTab
// @grant        GM_registerMenuCommand
// @grant        GM_setValue
// @grant        GM_xmlhttpRequest
// @grant        unsafeWindow
// @inject-into  page
// @run-at       document-start
// ==/UserScript==

(function () {
  'use strict';

  var _documentCurrentScript = typeof document !== 'undefined' ? document.currentScript : null;
  var gA=Object.defineProperty;var mA=(e,t,n)=>t in e?gA(e,t,{enumerable:true,configurable:true,writable:true,value:n}):e[t]=n;var de=(e,t,n)=>mA(e,typeof t!="symbol"?t+"":t,n);function x(e,t=null,...n){const r=document.createElement(e);for(const[o,i]of Object.entries(t||{}))i!=null&&(o==="style"?typeof i=="string"?r.setAttribute("style",i):typeof i=="object"&&Object.assign(r.style,i):o.startsWith("on")&&typeof i=="function"?r[o.toLowerCase()]=i:o in r?r[o]=i:r.setAttribute(o,String(i)));for(const o of n)o==null||o===false||r.appendChild(typeof o=="string"||typeof o=="number"?document.createTextNode(String(o)):o);return r}const zc="https://i.imgur.com/k5WuC32.png",oy="gemini-loader-style",oi="gemini-loader",Cx=80;function bA(){if(document.getElementById(oy))return;const e=document.createElement("style");e.id=oy,e.textContent=`
    /* ===== Loader Variables ===== */
    #${oi} {
      --loader-bg: rgba(10, 12, 18, 0.6);
      --loader-card-bg: rgba(10, 12, 18, 0.82);
      --loader-fg: #e5e7eb;
      --loader-muted: rgba(229, 231, 235, 0.08);
      --loader-soft: rgba(229, 231, 235, 0.05);
      --loader-accent: #60a5fa;
      --loader-border: rgba(148, 163, 184, 0.2);
      --loader-shadow: rgba(0, 0, 0, 0.45);
      --loader-blur: 14px;
      --loader-radius: 18px;
      --loader-pill-from: #6366f1;
      --loader-pill-to: #06b6d4;

      --loader-info: #60a5fa;
      --loader-success: #4ade80;
      --loader-error: #f87171;
    }

    /* ===== Overlay ===== */
    #${oi} {
      position: fixed;
      inset: 0;
      z-index: 2147483000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 28px 18px;
      background: var(--loader-bg);
      backdrop-filter: blur(var(--loader-blur));
      -webkit-backdrop-filter: blur(var(--loader-blur));
      color: var(--loader-fg);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Inter, sans-serif;
      -webkit-font-smoothing: antialiased;
    }

    /* ===== Card ===== */
    .gemini-loader__card {
      position: relative;
      z-index: 1;
      width: min(480px, 94vw);
      background: var(--loader-card-bg);
      border: 1px solid var(--loader-border);
      border-radius: var(--loader-radius);
      padding: 20px;
      box-shadow: 0 20px 60px var(--loader-shadow);
      backdrop-filter: blur(var(--loader-blur));
      -webkit-backdrop-filter: blur(var(--loader-blur));
    }

    /* ===== Header ===== */
    .gemini-loader__header {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 16px;
    }

    /* ===== Spinner ===== */
    .gemini-loader__spinner {
      position: relative;
      width: 48px;
      height: 48px;
      border-radius: 50%;
      border: 2px solid var(--loader-muted);
      border-top-color: var(--loader-pill-from);
      border-right-color: var(--loader-pill-to);
      animation: gemini-loader-spin 1s linear infinite;
      box-shadow: 0 0 20px color-mix(in oklab, var(--loader-pill-from) 40%, transparent);
      flex-shrink: 0;
    }

    .gemini-loader__spinner-icon {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 70px;
      height: 70px;
      border-radius: 50%;
      object-fit: cover;
      animation: gemini-loader-spin-reverse 1s linear infinite;
    }

    /* ===== Titles ===== */
    .gemini-loader__titles {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .gemini-loader__title {
      font-size: 17px;
      font-weight: 600;
      color: var(--loader-fg);
    }

    .gemini-loader__subtitle {
      font-size: 13px;
      color: color-mix(in oklab, var(--loader-fg) 70%, transparent);
      line-height: 1.4;
    }

    /* ===== Logs container ===== */
    .gemini-loader__logs {
      background: var(--loader-soft);
      border: 1px solid var(--loader-border);
      border-radius: 12px;
      padding: 10px 12px;
      max-height: 240px;
      overflow: auto;
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-family: ui-monospace, SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
      font-size: 12px;
      color: var(--loader-fg);
    }

    .gemini-loader__logs::-webkit-scrollbar {
      width: 8px;
    }
    .gemini-loader__logs::-webkit-scrollbar-thumb {
      background: var(--loader-muted);
      border-radius: 8px;
    }

    /* ===== Log entry ===== */
    .gemini-loader__log {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      line-height: 1.4;
      word-break: break-word;
    }

    .gemini-loader__dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-top: 4px;
      flex-shrink: 0;
      box-shadow: 0 0 8px currentColor;
    }

    .gemini-loader__log.info { color: color-mix(in oklab, var(--loader-info) 85%, var(--loader-fg)); }
    .gemini-loader__log.info .gemini-loader__dot { background: var(--loader-info); color: var(--loader-info); }

    .gemini-loader__log.success { color: color-mix(in oklab, var(--loader-success) 85%, var(--loader-fg)); }
    .gemini-loader__log.success .gemini-loader__dot { background: var(--loader-success); color: var(--loader-success); }

    .gemini-loader__log.error { color: color-mix(in oklab, var(--loader-error) 85%, var(--loader-fg)); }
    .gemini-loader__log.error .gemini-loader__dot { background: var(--loader-error); color: var(--loader-error); }

    /* ===== Actions (error state) ===== */
    .gemini-loader__actions {
      display: none;
      margin-top: 14px;
      justify-content: flex-end;
    }

    #${oi}.gemini-loader--error .gemini-loader__actions {
      display: flex;
    }

    .gemini-loader__button {
      appearance: none;
      border: 1px solid color-mix(in oklab, var(--loader-error) 50%, var(--loader-border));
      background: linear-gradient(
        180deg,
        color-mix(in oklab, var(--loader-error) 25%, transparent) 0%,
        color-mix(in oklab, var(--loader-error) 35%, transparent) 100%
      );
      color: var(--loader-fg);
      padding: 8px 14px;
      border-radius: 10px;
      font-weight: 600;
      font-size: 13px;
      cursor: pointer;
      box-shadow: 0 8px 20px color-mix(in oklab, var(--loader-error) 25%, transparent);
      transition: transform 0.08s ease, box-shadow 0.15s ease, border-color 0.15s ease;
    }

    .gemini-loader__button:hover {
      border-color: var(--loader-error);
      box-shadow: 0 10px 24px color-mix(in oklab, var(--loader-error) 35%, transparent);
    }

    .gemini-loader__button:active {
      transform: scale(0.98);
    }

    /* ===== States ===== */
    #${oi}.gemini-loader--closing {
      animation: gemini-loader-fade-out 0.4s ease forwards;
      pointer-events: none;
    }

    #${oi}.gemini-loader--error .gemini-loader__spinner {
      animation: none;
      border-color: color-mix(in oklab, var(--loader-error) 30%, var(--loader-muted));
      border-top-color: var(--loader-error);
      border-right-color: var(--loader-error);
      box-shadow: 0 0 20px color-mix(in oklab, var(--loader-error) 40%, transparent);
    }

    /* ===== Animations ===== */
    @keyframes gemini-loader-spin {
      to { transform: rotate(360deg); }
    }

    @keyframes gemini-loader-spin-reverse {
      from { transform: translate(-50%, -50%) rotate(0deg); }
      to { transform: translate(-50%, -50%) rotate(-360deg); }
    }

    @keyframes gemini-loader-fade-out {
      to { opacity: 0; visibility: hidden; }
    }

    /* ===== Responsive ===== */
    @media (max-width: 520px) {
      #${oi} { padding: 16px 10px; }
      .gemini-loader__card { padding: 16px; }
      .gemini-loader__header { gap: 12px; }
      .gemini-loader__spinner { width: 42px; height: 42px; }
      .gemini-loader__spinner-icon { width: 56px; height: 56px; }
      .gemini-loader__title { font-size: 16px; }
    }
  `;const t=document.head||document.documentElement||document.body;if(t){t.appendChild(e);return}const n=()=>{(document.head||document.documentElement||document.body)?.appendChild(e);};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n,{once:true}):setTimeout(n,0);}function Uc(e,t,n){const r=x("div",{className:`gemini-loader__log ${n}`},x("div",{className:"gemini-loader__dot"}),x("div",{textContent:t}));for(e.appendChild(r);e.childElementCount>Cx;)e.firstElementChild?.remove();e.scrollTop=e.scrollHeight;}function vA(){return new Promise(e=>{if(typeof GM_xmlhttpRequest>"u"){e(zc);return}GM_xmlhttpRequest({method:"GET",url:zc,responseType:"blob",onload:t=>{const n=t.response,r=new FileReader;r.onloadend=()=>e(r.result),r.onerror=()=>e(zc),r.readAsDataURL(n);},onerror:()=>e(zc)});})}function yA(e={}){const t=Number.isFinite(e.blurPx)?Math.max(4,Number(e.blurPx)):14;bA();const n=x("div",{className:"gemini-loader__subtitle",textContent:e.subtitle??"Initializing the mod..."}),r=x("div",{className:"gemini-loader__logs"}),o=x("img",{className:"gemini-loader__spinner-icon",alt:"Gemini"}),i=x("div",{className:"gemini-loader__spinner"},o);vA().then(S=>{o.src=S;});const a=x("div",{className:"gemini-loader__card"},x("div",{className:"gemini-loader__header"},i,x("div",{className:"gemini-loader__titles"},x("div",{className:"gemini-loader__title",textContent:e.title??"Gemini is loading"}),n)),r),s=x("div",{id:oi},a);(document.body||document.documentElement).appendChild(s);const l=x("div",{className:"gemini-loader__actions"},x("button",{className:"gemini-loader__button",textContent:"Close loader",onclick:()=>s.remove()}));a.appendChild(l),s.style.setProperty("--loader-blur",`${t}px`);const c=S=>{n.textContent=S;},d=new Map,u=(S,C)=>{S.className=`gemini-loader__log ${C}`;};return {log:(S,C="info")=>Uc(r,S,C),logStep:(S,C,_="info")=>{const E=String(S||"").trim();if(!E){Uc(r,C,_);return}const P=d.get(E);if(P){P.el.lastElementChild&&(P.el.lastElementChild.textContent=C),P.tone!==_&&(u(P.el,_),P.tone=_);return}const O=x("div",{className:`gemini-loader__log ${_}`},x("div",{className:"gemini-loader__dot"}),x("div",{textContent:C}));for(d.set(E,{el:O,tone:_}),r.appendChild(O);r.childElementCount>Cx;){const k=r.firstElementChild;if(!k)break;const I=Array.from(d.entries()).find(([,R])=>R.el===k)?.[0];I&&d.delete(I),k.remove();}r.scrollTop=r.scrollHeight;},setSubtitle:c,succeed:(S,C=600)=>{S&&Uc(r,S,"success"),s.classList.add("gemini-loader--closing"),setTimeout(()=>s.remove(),C);},fail:(S,C)=>{Uc(r,S,"error"),c("Something went wrong. Check the console for details."),s.classList.add("gemini-loader--error"),console.error("[Gemini loader]",S,C);}}}const iy=150,wA=30;function xA(e,t,n){const r=x("div",{className:"lg-pill",id:"pill"}),o=e.map(A=>{const L=x("button",{className:"lg-tab"},A.label);return L.setAttribute("data-target",A.id),L}),i=x("div",{className:"lg-tabs",id:"lg-tabs-row"},r,...o),a=new Map(e.map(A=>[A.id,true])),s=new Map(o.map((A,L)=>[e[L].id,A]));function l(A){const L=document.createElementNS("http://www.w3.org/2000/svg","svg");L.setAttribute("viewBox","0 0 24 24"),L.setAttribute("fill","none"),L.setAttribute("stroke","currentColor"),L.setAttribute("stroke-width","2"),L.setAttribute("stroke-linecap","round"),L.setAttribute("stroke-linejoin","round");const F=document.createElementNS("http://www.w3.org/2000/svg","polyline");return F.setAttribute("points",A==="left"?"15 18 9 12 15 6":"9 18 15 12 9 6"),L.appendChild(F),L}const c=x("button",{className:"lg-tabs-arrow lg-tabs-arrow-left",ariaLabel:"Scroll left"});c.appendChild(l("left"));const d=x("button",{className:"lg-tabs-arrow lg-tabs-arrow-right",ariaLabel:"Scroll right"});d.appendChild(l("right"));const f=x("div",{className:"lg-tabs-wrapper"},c,i,d);let g=0,h=0,y=false;function S(){const A=i.scrollLeft>0,L=i.scrollLeft<i.scrollWidth-i.clientWidth-1;c.classList.toggle("disabled",!A),d.classList.toggle("disabled",!L);}c.addEventListener("click",()=>{i.scrollBy({left:-iy,behavior:"smooth"}),setTimeout(S,300);}),d.addEventListener("click",()=>{i.scrollBy({left:iy,behavior:"smooth"}),setTimeout(S,300);}),i.addEventListener("wheel",A=>{Math.abs(A.deltaY)>Math.abs(A.deltaX)&&(A.preventDefault(),i.scrollLeft+=A.deltaY,S());},{passive:false});let C=0;i.addEventListener("touchstart",A=>{const L=A.touches[0];g=L.clientX,h=L.clientY,y=false,C=i.scrollLeft;},{passive:true}),i.addEventListener("touchmove",A=>{if(y)return;const L=A.touches[0],F=L.clientX-g,G=L.clientY-h;if(Math.abs(G)>Math.abs(F)){y=true;return}Math.abs(F)>wA&&(A.preventDefault(),i.scrollLeft=C-F);},{passive:false}),i.addEventListener("touchend",()=>{S();},{passive:true}),i.addEventListener("scroll",S,{passive:true});function _(A){const L=o.find(F=>F.dataset.target===A)||o[0];L&&requestAnimationFrame(()=>{const F=L.offsetLeft,G=L.offsetWidth;r.style.width=`${G}px`,r.style.transform=`translateX(${F}px)`;const q=i.scrollLeft,H=q,ce=q+i.clientWidth,W=F-12,te=F+G+12;W<H?i.scrollTo({left:W,behavior:"smooth"}):te>ce&&i.scrollTo({left:te-i.clientWidth,behavior:"smooth"}),setTimeout(S,300);});}function E(){for(const[A,L]of a)if(L)return A;return null}function P(A){const L=s.get(A);if(L)if(a.set(A,false),L.style.display="none",I===A){const F=E();F&&R(F);}else k();}function O(A){const L=s.get(A);L&&(a.set(A,true),L.style.display="",k());}function k(){_(I),S();}let I=t||(e[0]?.id??"");function R(A){a.get(A)&&(I=A,o.forEach(L=>L.classList.toggle("active",L.dataset.target===A)),_(A),n(A));}return o.forEach(A=>A.addEventListener("click",()=>R(A.dataset.target))),queueMicrotask(()=>{_(I),S();}),{root:f,activate:R,recalc:k,getActive:()=>I,showTab:O,hideTab:P,isTabVisible:A=>a.get(A)??false,getVisibleTabs:()=>[...a.entries()].filter(([A,L])=>L).map(([A])=>A)}}class pr{constructor(t){de(this,"id");de(this,"label");de(this,"container",null);de(this,"cleanupFunctions",[]);de(this,"preloadedContent",null);de(this,"preloadPromise",null);this.id=t.id,this.label=t.label;}destroy(){}async preload(){if(this.preloadedContent||this.preloadPromise)return;const t=x("div");this.preloadPromise=(async()=>{const n=this.build(t);n instanceof Promise&&await n,this.preloadedContent=t,this.preloadPromise=null;})(),await this.preloadPromise;}isPreloaded(){return this.preloadedContent!==null}render(t){for(this.container!==null&&this.unmount();t.firstChild;)t.removeChild(t.firstChild);if(this.container=t,this.preloadedContent){for(;this.preloadedContent.firstChild;)t.appendChild(this.preloadedContent.firstChild);this.preloadedContent=null;}else {const r=this.build(t);r instanceof Promise&&r.catch(o=>{console.error(`[Gemini] Error building section ${this.id}:`,o);});}const n=t.firstElementChild;n&&n.classList.contains("gemini-section")&&n.classList.add("active");}unmount(){const t=this.destroy();t instanceof Promise&&t.catch(n=>{console.error(`[Gemini] Destroy error in section ${this.id}:`,n);}),this.executeCleanup(),this.container=null;}createContainer(t,n){const r=n?`gemini-section ${n}`:"gemini-section";return x("section",{id:t,className:r})}addCleanup(t){this.cleanupFunctions.push(t);}createGrid(t="12px"){const n=x("div");return n.style.display="grid",n.style.gap=t,n}executeCleanup(){for(const t of this.cleanupFunctions)try{t();}catch(n){console.error(`[Gemini] Cleanup error in section ${this.id}:`,n);}this.cleanupFunctions=[];}}class CA{constructor(t,n,r){de(this,"sections");de(this,"activeId",null);de(this,"container");de(this,"theme");this.sections=new Map(t.map(o=>[o.id,o])),this.container=n,this.theme=r;}get ids(){return Array.from(this.sections.keys())}get all(){return Array.from(this.sections.values())}get active(){return this.activeId}activate(t){if(this.activeId!==t){if(!this.sections.has(t))throw new Error(`[Gemini] Unknown section: ${t}`);if(this.activeId&&this.sections.get(this.activeId).unmount(),this.activeId=t,this.sections.get(t).render(this.container),this.theme){const n=this.theme.getCurrentTheme();this.theme.applyTheme(n);}}}}const Tr="gemini:",SA={STATE:"hud:state",THEME:"hud:theme"},_A={ALL:"sections",SETTINGS:"sections:settings",TEST:"sections:test",AVATAR_LOADOUTS:"sections:avatar:loadouts"},kA={AUDIO_CUSTOM_SOUNDS:"module:audio:customSounds",AUDIO_NOTIFICATION_SETTINGS:"module:audio:notificationSettings"},EA={MY_PETS_ABILITY_LOGS:"global:myPets:abilityLogs"},lt={AUTO_FAVORITE:"feature:autoFavorite:config",AUTO_FAVORITE_UI:"feature:autoFavorite:ui",JOURNAL_CHECKER:"feature:journalChecker:config",BULK_FAVORITE:"feature:bulkFavorite:config",ACHIEVEMENTS:"feature:achievements:data",TRACKER_STATS:"feature:tracker:stats",ANTI_AFK:"feature:antiAfk:config",CONFIG:"feature:config",PET_TEAM:"feature:petTeam:config",XP_TRACKER:"feature:xpTracker:config",CROP_VALUE_INDICATOR:"feature:cropValueIndicator:config",CROP_SIZE_INDICATOR:"feature:cropSizeIndicator:config",SHOP_NOTIFIER:"feature:shopNotifier:config",WEATHER_NOTIFIER:"feature:weatherNotifier:config",PET_HUNGER_NOTIFIER:"feature:petHungerNotifier:config",ARIES_API:"feature:ariesAPI:config",HARVEST_LOCKER:"feature:harvestLocker:config",EGG_LOCKER:"feature:eggLocker:config",DECOR_LOCKER:"feature:decorLocker:config",MISSING_VARIANTS_INDICATOR:"feature:missingVariantsIndicator:config",JOURNAL:"feature:journal:config",SHOP_RESTOCK:"feature:shopRestock:config",SHOP_RESTOCK_HISTORY:"feature:shopRestock:history",SHOP_RESTOCK_SHOPKEEPER_HISTORY:"feature:shopRestock:history:shopkeeper",SKIN_CHANGER:"feature:skinChanger:config"},pn={ABILITIES_INJECT:"inject:abilitiesInject:config",JOURNAL_HINTS:"inject:journalHints:config",JOURNAL_FILTER_SORT:"inject:journalFilterSort:config",JOURNAL_ALL_TAB:"inject:journalAllTab:config",STORAGE_VALUE_INDICATOR:"inject:storageValueIndicator:config",JOURNAL_GUIDE:"inject:journalGuide:config",WEATHER_TRACKING_CONFIG:"inject:weatherTracking:config",WEATHER_TRACKING:"inject:weatherTracking:data"},AA={AUTO_RELOAD:"dev:auto-reload"},hn={HUD:SA,SECTION:_A,MODULE:kA,GLOBAL:EA,FEATURE:lt,INJECT:pn,DEV:AA},Me={STORAGE_CHANGE:"gemini:storage:change",JOURNAL_UPDATED:"gemini:journal-updated",HUD_OPEN_CHANGE:"gemini:hud-open-change",LAYOUT_RESIZE:"gemini:layout-resize",CUSTOM_SOUND_CHANGE:"gemini:custom-sound-change",TOGGLE_MANUAL_HMR:"gemini:toggle-manual-hmr",UPDATE_PENDING:"gemini:update-pending",FORCE_RELOAD:"gemini:force-reload",SHOP_RESTOCK_RECORDED:"gemini:shop-restock-recorded",SHOP_RESTOCK_TRACKED_CHANGED:"gemini:shop-restock-tracked-changed",SHOP_RESTOCK_HISTORY_UPDATED:"gemini:shop-restock-history-updated",SHOP_RESTOCK_META_UPDATED:"gemini:shop-restock-meta-updated",WEATHER_TRANSITION:"gemini:weather-transition",SHOP_RESTOCK_SIMULATE:"gemini:shop-restock-simulate",SHOP_RESTOCK_TRACKED:"gemini:shop-restock-tracked",HARVEST_LOCKER_LOCKS_UPDATED:"gemini:harvestLocker-locks-updated",EGG_LOCKER_LOCKS_UPDATED:"gemini:eggLocker-locks-updated",DECOR_LOCKER_LOCKS_UPDATED:"gemini:decorLocker-locks-updated"};function Xe(e,t){try{const n=e.startsWith(Tr)?e:Tr+e,r=GM_getValue(n);return r==null?t:typeof r=="string"?JSON.parse(r):r}catch(n){return console.error(`[Gemini Storage] Failed to read key "${e}":`,n),t}}function Ye(e,t){try{const n=e.startsWith(Tr)?e:Tr+e,r=e.startsWith(Tr)?e.slice(Tr.length):e,o=JSON.stringify(t);GM_setValue(n,o),window.dispatchEvent(new CustomEvent(Me.STORAGE_CHANGE,{detail:{key:r,value:t}}));}catch(n){console.error(`[Gemini Storage] Failed to write key "${e}":`,n);}}function TA(e){try{const t=e.startsWith(Tr)?e:Tr+e;GM_setValue(t,void 0);}catch(t){console.error(`[Gemini Storage] Failed to remove key "${e}":`,t);}}function IA(e){try{const t=e.startsWith(Tr)?e:Tr+e,n=GM_getValue(t);return n!=null}catch(t){return console.error(`[Gemini Storage] Failed to check key "${e}":`,t),false}}function PA(){try{const e="gemini:",t=[];for(let o=0;o<localStorage.length;o++){const i=localStorage.key(o);i&&i.startsWith(e)&&t.push(i);}for(const o of t)try{const i=localStorage.getItem(o);if(i!==null){const a=JSON.parse(i),s=o.slice(e.length);Ye(s,a),console.log(`[Gemini Storage] Migrated key: ${o}`);}}catch(i){console.warn(`[Gemini Storage] Failed to migrate key "${o}":`,i);}const n="gemini.sections",r=GM_getValue(n);r!=null&&(Ye("sections",r),GM_setValue(n,void 0),console.log("[Gemini Storage] Migrated: gemini.sections → gemini:sections")),t.length>0&&console.log(`[Gemini Storage] Migration complete. ${t.length} keys migrated from localStorage to GM_* storage.`);}catch(e){console.error("[Gemini Storage] Migration failed:",e);}}const Sx="gemini.sections";function _x(){const e=Xe(Sx,{});return e&&typeof e=="object"&&!Array.isArray(e)?e:{}}function RA(e){Ye(Sx,e);}async function MA(e){return _x()[e]}function LA(e,t){const n=_x();RA({...n,[e]:t});}function $a(e,t){return {...e,...t??{}}}async function OA(e){const t=await MA(e.path);let n;e.migrate?n=e.migrate(t):n=t??{},n=Object.assign((c=>JSON.parse(JSON.stringify(c)))(e.defaults),n),e.sanitize&&(n=e.sanitize(n));function o(){LA(e.path,n);}function i(){return n}function a(c){n=e.sanitize?e.sanitize(c):c,o();}function s(c){const u=Object.assign((f=>JSON.parse(JSON.stringify(f)))(n),{});typeof c=="function"?c(u):Object.assign(u,c),n=e.sanitize?e.sanitize(u):u,o();}function l(){o();}return {get:i,set:a,update:s,save:l}}async function co(e,t){const{path:n=e,...r}=t;return OA({path:n,...r})}let NA=0;const Hc=new Map;function dt(e={},...t){const{id:n,className:r,variant:o="default",padding:i="md",interactive:a=false,expandable:s=false,defaultExpanded:l=true,onExpandChange:c,mediaTop:d,title:u,subtitle:f,badge:g,actions:h,footer:y,divider:S=false,tone:C="neutral",stateKey:_}=e,E=x("div",{className:"card",id:n,tabIndex:a?0:void 0});E.classList.add(`card--${o}`,`card--p-${i}`),a&&E.classList.add("card--interactive"),C!=="neutral"&&E.classList.add(`card--tone-${C}`),r&&E.classList.add(...r.split(" ").filter(Boolean)),s&&E.classList.add("card--expandable");const P=s?_??n??(typeof u=="string"?`title:${u}`:null):null;let O=!s||l;P&&Hc.has(P)&&(O=!!Hc.get(P));let k=null,I=null,R=null,A=null,L=null;const F=n?`${n}-collapse`:`card-collapse-${++NA}`,G=()=>{if(A!==null&&(cancelAnimationFrame(A),A=null),L){const ne=L;L=null,ne();}},q=(ne,ie)=>{if(!R)return;G();const ee=R;if(ee.setAttribute("aria-hidden",String(!ne)),!ie){ee.classList.remove("card-collapse--animating"),ee.style.display=ne?"":"none",ee.style.height="",ee.style.opacity="";return}if(ee.classList.add("card-collapse--animating"),ee.style.display="",ne){ee.style.height="auto";const j=ee.scrollHeight;if(!j){ee.classList.remove("card-collapse--animating"),ee.style.display="",ee.style.height="",ee.style.opacity="";return}ee.style.height="0px",ee.style.opacity="0",ee.offsetHeight,A=requestAnimationFrame(()=>{A=null,ee.style.height=`${j}px`,ee.style.opacity="1";});}else {const j=ee.scrollHeight;if(!j){ee.classList.remove("card-collapse--animating"),ee.style.display="none",ee.style.height="",ee.style.opacity="";return}ee.style.height=`${j}px`,ee.style.opacity="1",ee.offsetHeight,A=requestAnimationFrame(()=>{A=null,ee.style.height="0px",ee.style.opacity="0";});}const U=()=>{ee.classList.remove("card-collapse--animating"),ee.style.height="",ne||(ee.style.display="none"),ee.style.opacity="";};let X=null;const D=j=>{j.target===ee&&(X!==null&&(clearTimeout(X),X=null),ee.removeEventListener("transitionend",D),ee.removeEventListener("transitioncancel",D),L=null,U());};L=()=>{X!==null&&(clearTimeout(X),X=null),ee.removeEventListener("transitionend",D),ee.removeEventListener("transitioncancel",D),L=null,U();},ee.addEventListener("transitionend",D),ee.addEventListener("transitioncancel",D),X=window.setTimeout(()=>{L?.();},420);};function H(ne){const ie=document.createElementNS("http://www.w3.org/2000/svg","svg");return ie.setAttribute("viewBox","0 0 24 24"),ie.setAttribute("width","16"),ie.setAttribute("height","16"),ie.innerHTML=ne==="up"?'<path d="M7 14l5-5 5 5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>':'<path d="M7 10l5 5 5-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>',ie}function ce(ne,ie=true,ee=true){O=ne,E.classList.toggle("card--collapsed",!O),E.classList.toggle("card--expanded",O),k&&(k.dataset.expanded=String(O),k.setAttribute("aria-expanded",String(O))),I&&(I.setAttribute("aria-expanded",String(O)),I.classList.toggle("card-toggle--collapsed",!O),I.setAttribute("aria-label",O?"Replier le contenu":"Deplier le contenu"),I.replaceChildren(H(O?"up":"down"))),s?q(O,ee):R&&(R.style.display="",R.style.height="",R.style.opacity="",R.setAttribute("aria-hidden","false")),ie&&c&&c(O),P&&Hc.set(P,O);}if(d){const ne=x("div",{className:"card-media"});ne.append(d),E.appendChild(ne);}const W=!!(u||f||g||h&&h.length||s);if(W){k=x("div",{className:"card-header"});const ne=x("div",{className:"card-headline",style:"min-width:0;display:flex;flex-direction:column;gap:2px;"});if(u){const U=x("h3",{className:"card-title",style:"margin:0;font-size:15px;font-weight:700;line-height:1.25;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:flex;align-items:center;gap:8px;color:var(--fg);"},u);g&&U.append(typeof g=="string"?x("span",{className:"badge"},g):g),ne.appendChild(U);}if(f){const U=x("div",{className:"card-subtitle",style:"opacity:.85;font-size:12px;color:color-mix(in oklab, var(--fg) 80%, #9ca3af)"},f);ne.appendChild(U);}(ne.childNodes.length||s)&&k.appendChild(ne);const ie=x("div",{className:"card-header-right",style:"display:flex;gap:8px;flex:0 0 auto;align-items:center;"}),ee=x("div",{className:"card-actions",style:"display:flex;gap:8px;flex:0 0 auto;align-items:center;"});h?.forEach(U=>ee.appendChild(U)),ee.childNodes.length&&ie.appendChild(ee),s&&(I=x("button",{className:"card-toggle",type:"button",ariaExpanded:String(O),ariaControls:F,ariaLabel:O?"Replier le contenu":"Deplier le contenu"}),I.textContent=O?"▲":"▼",I.addEventListener("click",U=>{U.preventDefault(),U.stopPropagation(),ce(!O);}),ie.appendChild(I),k.classList.add("card-header--expandable"),k.addEventListener("click",U=>{const X=U.target;X?.closest(".card-actions")||X?.closest(".card-toggle")||ce(!O);})),ie.childNodes.length&&k.appendChild(ie),E.appendChild(k);}R=x("div",{className:"card-collapse",id:F,ariaHidden:s?String(!O):"false"}),E.appendChild(R),S&&W&&R.appendChild(x("div",{className:"card-divider"}));const te=x("div",{className:"card-body"});if(te.append(...t),R.appendChild(te),y){S&&R.appendChild(x("div",{className:"card-divider"}));const ne=x("div",{className:"card-footer"});ne.append(y),R.appendChild(ne);}return I&&I.setAttribute("aria-controls",F),ce(O,false,false),P&&Hc.set(P,O),E}let ku=false;const Eu=new Set,Un=e=>{const t=document.activeElement;for(const n of Eu)if(t&&(t===n||n.contains(t))){e.stopImmediatePropagation(),e.stopPropagation();return}};function $A(){ku||(ku=true,window.addEventListener("keydown",Un,true),window.addEventListener("keypress",Un,true),window.addEventListener("keyup",Un,true),document.addEventListener("keydown",Un,true),document.addEventListener("keypress",Un,true),document.addEventListener("keyup",Un,true));}function DA(){ku&&(Eu.size>0||(ku=false,window.removeEventListener("keydown",Un,true),window.removeEventListener("keypress",Un,true),window.removeEventListener("keyup",Un,true),document.removeEventListener("keydown",Un,true),document.removeEventListener("keypress",Un,true),document.removeEventListener("keyup",Un,true)));}let ui=null;const Uh=e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),ui!==null&&(window.clearTimeout(ui),ui=null),document.removeEventListener("click",Uh,true);};function FA(){document.addEventListener("click",Uh,true),ui!==null&&window.clearTimeout(ui),ui=window.setTimeout(()=>{document.removeEventListener("click",Uh,true),ui=null;},500);}function Ri(e){const{id:t,value:n=null,options:r,placeholder:o="Select...",size:i="md",disabled:a=false,blockGameKeys:s=true,onChange:l,onOpenChange:c}=e,d=x("div",{className:"select",id:t}),u=x("button",{className:"select-trigger",type:"button"}),f=x("span",{className:"select-value"},o),g=x("span",{className:"select-caret"},"▾");u.append(f,g);const h=x("div",{className:"select-menu",role:"listbox",tabindex:"-1","aria-hidden":"true"});d.classList.add(`select--${i}`);let y=false,S=n,C=null,_=!!a;function E(U){return U==null?o:(e.options||r).find(D=>D.value===U)?.label??o}function P(U){f.textContent=E(U),h.querySelectorAll(".select-option").forEach(X=>{const D=X.dataset.value,j=U!=null&&D===U;X.classList.toggle("selected",j),X.setAttribute("aria-selected",String(j));});}function O(U){h.replaceChildren(),U.forEach(X=>{const D=x("button",{className:"select-option"+(X.disabled?" disabled":""),type:"button",role:"option","data-value":X.value,"aria-selected":String(X.value===S),tabindex:"-1"},X.label);X.value===S&&D.classList.add("selected"),X.disabled||D.addEventListener("pointerdown",j=>{j.preventDefault(),j.stopPropagation(),j.pointerType&&j.pointerType!=="mouse"&&FA(),F(X.value,{notify:true}),A();},{capture:true}),h.appendChild(D);});}function k(){u.setAttribute("aria-expanded",String(y)),h.setAttribute("aria-hidden",String(!y));}function I(){const U=u.getBoundingClientRect();Object.assign(h.style,{minWidth:`${U.width}px`});}function R(){y||_||(y=true,d.classList.add("open"),k(),I(),document.addEventListener("mousedown",W,true),document.addEventListener("scroll",te,true),window.addEventListener("resize",ne),h.focus({preventScroll:true}),s&&($A(),Eu.add(d),C=()=>{Eu.delete(d),DA();}),c?.(true));}function A(){y&&(y=false,d.classList.remove("open"),k(),document.removeEventListener("mousedown",W,true),document.removeEventListener("scroll",te,true),window.removeEventListener("resize",ne),u.focus({preventScroll:true}),C?.(),C=null,c?.(false));}function L(){y?A():R();}function F(U,X={}){const D=S;S=U,P(S),X.notify!==false&&D!==U&&l?.(U);}function G(){return S}function q(U){const X=Array.from(h.querySelectorAll(".select-option:not(.disabled)"));if(!X.length)return;const D=X.findIndex(Q=>Q.classList.contains("active")),j=X[(D+(U===1?1:X.length-1))%X.length];X.forEach(Q=>Q.classList.remove("active")),j.classList.add("active"),j.focus({preventScroll:true}),j.scrollIntoView({block:"nearest"});}function H(U){(U.key===" "||U.key==="Enter"||U.key==="ArrowDown")&&(U.preventDefault(),R());}function ce(U){if(U.key==="Escape"){U.preventDefault(),A();return}if(U.key==="Enter"||U.key===" "){const X=h.querySelector(".select-option.active")||h.querySelector(".select-option.selected");X&&!X.classList.contains("disabled")&&(U.preventDefault(),F(X.dataset.value,{notify:true}),A());return}if(U.key==="ArrowDown"){U.preventDefault(),q(1);return}if(U.key==="ArrowUp"){U.preventDefault(),q(-1);return}}function W(U){d.contains(U.target)||A();}function te(){y&&I();}function ne(){y&&I();}function ie(U){_=!!U,u.disabled=_,d.classList.toggle("disabled",_),_&&A();}function ee(U){e.options=U,O(U),U.some(X=>X.value===S)||(S=null,P(null));}return d.append(u,h),u.addEventListener("pointerdown",U=>{U.preventDefault(),U.stopPropagation(),L();},{capture:true}),u.addEventListener("keydown",H),h.addEventListener("keydown",ce),O(r),n!=null?(S=n,P(S)):P(null),k(),ie(_),{root:d,open:R,close:A,toggle:L,getValue:G,setValue:F,setOptions:ee,setDisabled:ie,destroy(){document.removeEventListener("mousedown",W,true),document.removeEventListener("scroll",te,true),window.removeEventListener("resize",ne),C?.(),C=null;}}}function km(e={}){const{id:t,text:n="",htmlFor:r,tone:o="default",size:i="md",layout:a="inline",variant:s="text",required:l=false,disabled:c=false,tooltip:d,hint:u,icon:f,suffix:g,onClick:h}=e,y=x("div",{className:"lg-label-wrap",id:t}),S=x("label",{className:"lg-label",...r?{htmlFor:r}:{},...d?{title:d}:{}});if(f){const F=typeof f=="string"?x("span",{className:"lg-label-ico"},f):f;F.classList?.add?.("lg-label-ico"),S.appendChild(F);}const C=x("span",{className:"lg-label-text"},n);S.appendChild(C);const _=x("span",{className:"lg-label-req",ariaHidden:"true"}," *");l&&S.appendChild(_);let E=null;if(g!=null){E=typeof g=="string"?document.createTextNode(g):g;const F=x("span",{className:"lg-label-suffix"});F.appendChild(E),S.appendChild(F);}const P=u?x("div",{className:"lg-label-hint"},u):null;y.classList.add(`lg-label--${a}`),y.classList.add(`lg-label--${i}`),s==="title"&&y.classList.add("lg-label--title"),O(o),c&&y.classList.add("is-disabled"),y.appendChild(S),P&&y.appendChild(P),h&&S.addEventListener("click",h);function O(F){y.classList.remove("lg-label--default","lg-label--muted","lg-label--info","lg-label--success","lg-label--warning","lg-label--danger"),y.classList.add(`lg-label--${F}`);}function k(F){C.textContent=F;}function I(F){O(F);}function R(F){F&&!_.isConnected&&S.appendChild(_),!F&&_.isConnected&&_.remove(),F?S.setAttribute("aria-required","true"):S.removeAttribute("aria-required");}function A(F){y.classList.toggle("is-disabled",!!F);}function L(F){!F&&P&&P.isConnected?P.remove():F&&P?P.textContent=F:F&&!P&&y.appendChild(x("div",{className:"lg-label-hint"},F));}return {root:y,labelEl:S,hintEl:P,setText:k,setTone:I,setRequired:R,setDisabled:A,setHint:L}}function Ds(e){return e==null?null:typeof e=="string"?document.createTextNode(e):e}function Wc(e,t){const n=document.createElement("span");n.className=`btn-ico btn-ico--${t}`;const r=Ds(e);return r&&n.appendChild(r),n}function BA(){const e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"svg");t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("width","16"),t.setAttribute("height","16"),t.setAttribute("aria-hidden","true"),t.style.marginRight="6px",t.style.display="none",t.style.flexShrink="0";const n=document.createElementNS(e,"circle");n.setAttribute("cx","12"),n.setAttribute("cy","12"),n.setAttribute("r","9"),n.setAttribute("fill","none"),n.setAttribute("stroke","currentColor"),n.setAttribute("stroke-width","3"),n.setAttribute("stroke-linecap","round");const r=document.createElementNS(e,"animate");r.setAttribute("attributeName","stroke-dasharray"),r.setAttribute("values","1,150;90,150;90,150"),r.setAttribute("dur","1.5s"),r.setAttribute("repeatCount","indefinite");const o=document.createElementNS(e,"animateTransform");return o.setAttribute("attributeName","transform"),o.setAttribute("attributeType","XML"),o.setAttribute("type","rotate"),o.setAttribute("from","0 12 12"),o.setAttribute("to","360 12 12"),o.setAttribute("dur","1s"),o.setAttribute("repeatCount","indefinite"),n.appendChild(r),n.appendChild(o),t.appendChild(n),t}function Ct(e={}){const{label:t="",id:n,variant:r="default",size:o="md",iconLeft:i,iconRight:a,loading:s=false,tooltip:l,type:c="button",onClick:d,disabled:u=false,fullWidth:f=false}=e,g=x("button",{className:"btn",id:n});g.type=c,r==="primary"&&g.classList.add("primary"),r==="danger"&&g.classList.add("danger"),o==="sm"&&g.classList.add("btn--sm"),l&&(g.title=l),f&&(g.style.width="100%");const h=BA(),y=i?Wc(i,"left"):null,S=a?Wc(a,"right"):null,C=document.createElement("span");C.className="btn-label";const _=Ds(t);_&&C.appendChild(_),!_&&(y||S)&&g.classList.add("btn--icon"),g.appendChild(h),y&&g.appendChild(y),g.appendChild(C),S&&g.appendChild(S);const E=u||s;g.disabled=E,g.setAttribute("aria-busy",String(!!s)),h.style.display=s?"inline-block":"none",d&&g.addEventListener("click",d);const P=g;return P.setLoading=O=>{g.setAttribute("aria-busy",String(!!O)),h.style.display=O?"inline-block":"none",g.disabled=O||u;},P.setDisabled=O=>{g.disabled=O||g.getAttribute("aria-busy")==="true";},P.setLabel=O=>{C.replaceChildren();const k=Ds(O);k&&C.appendChild(k),!k&&(y||S)?g.classList.add("btn--icon"):g.classList.remove("btn--icon");},P.setIconLeft=O=>{if(O==null){y?.remove();return}y?y.replaceChildren(Ds(O)):g.insertBefore(Wc(O,"left"),C);},P.setIconRight=O=>{if(O==null){S?.remove();return}S?S.replaceChildren(Ds(O)):g.appendChild(Wc(O,"right"));},P.setVariant=O=>{g.classList.remove("primary","danger"),O==="primary"&&g.classList.add("primary"),O==="danger"&&g.classList.add("danger");},P}function ao(e={}){const{id:t,checked:n=false,disabled:r=false,size:o="md",label:i,labelSide:a="right",onChange:s}=e,l=x("div",{className:"lg-switch-wrap"}),c=x("button",{className:`lg-switch lg-switch--${o}`,id:t,type:"button",role:"switch","aria-checked":String(!!n),"aria-disabled":String(!!r),title:i??"Basculer"}),d=x("span",{className:"lg-switch-track"}),u=x("span",{className:"lg-switch-thumb"});c.append(d,u);let f=null;i&&a!=="none"&&(f=x("span",{className:"lg-switch-label"},i)),f&&a==="left"?l.append(f,c):f&&a==="right"?l.append(c,f):l.append(c);let g=!!n,h=!!r;function y(){c.classList.toggle("on",g),c.setAttribute("aria-checked",String(g)),c.disabled=h,c.setAttribute("aria-disabled",String(h));}function S(A=false){h||(g=!g,y(),A||s?.(g));}function C(A){A.preventDefault(),S();}function _(A){h||((A.key===" "||A.key==="Enter")&&(A.preventDefault(),S()),A.key==="ArrowLeft"&&(A.preventDefault(),P(false)),A.key==="ArrowRight"&&(A.preventDefault(),P(true)));}c.addEventListener("click",C),c.addEventListener("keydown",_);function E(){return g}function P(A,L=false){g=!!A,y(),L||s?.(g);}function O(A){h=!!A,y();}function k(A){if(!A){f&&(f.remove(),f=null);return}f?f.textContent=A:(f=x("span",{className:"lg-switch-label"},A),l.append(f));}function I(){c.focus();}function R(){c.removeEventListener("click",C),c.removeEventListener("keydown",_);}return y(),{root:l,button:c,isChecked:E,setChecked:P,setDisabled:O,setLabel:k,focus:I,destroy:R}}let kx=null,Em=null;function jA(){return kx}function GA(e){kx=e,Em=null;}function Ex(){return Em}function zA(e){Em=e;}function UA(){try{const e=window.visualViewport,t=Math.round((e?.width??window.innerWidth)||0),n=Math.round((e?.height??window.innerHeight)||0);if(t&&n)return t>=n?"landscape":"portrait"}catch{}return "unknown"}function Ax(){const e=navigator.userAgent||"",t=navigator.platform||"",n=navigator.userAgentData;if(n&&typeof n.platform=="string"){const o=n.platform.toLowerCase();if(o.includes("windows"))return "windows";if(o.includes("mac"))return "mac";if(o.includes("android"))return "android";if(o.includes("chrome os")||o.includes("cros"))return "chromeos";if(o.includes("linux"))return "linux";if(o.includes("ios"))return "ios"}return /iPhone|iPad|iPod/i.test(e)||t==="MacIntel"&&(navigator.maxTouchPoints??0)>1?"ios":/Android/i.test(e)?"android":/CrOS/i.test(e)?"chromeos":/Win/i.test(e)?"windows":/Mac/i.test(e)?"mac":/Linux/i.test(e)?"linux":"unknown"}function Tx(){const e=navigator.userAgent||"",t=navigator.userAgentData;if(t&&Array.isArray(t.brands)){const n=t.brands.map(a=>String(a.brand||a.brandName||a.brandVersion||a)),r=n.some(a=>/Edge/i.test(a)||/Microsoft Edge/i.test(a)),o=n.some(a=>/Opera/i.test(a)||/OPR/i.test(a)),i=n.some(a=>/Chrome|Chromium/i.test(a));if(r)return "Edge";if(o)return "Opera";if(i)return "Chrome";if(navigator.brave)return "Brave"}return /FxiOS/i.test(e)?"Firefox":/CriOS/i.test(e)?"Chrome":/EdgiOS/i.test(e)?"Edge":/OPiOS|OPR|Opera Mini|Opera/i.test(e)?"Opera":/Edg\//i.test(e)?"Edge":/OPR\//i.test(e)||/Opera/i.test(e)?"Opera":/Firefox/i.test(e)?"Firefox":/Safari/i.test(e)&&!/Chrome|Chromium|Edg|OPR/i.test(e)?"Safari":/Brave/i.test(e)||window.Brave||navigator.brave?"Brave":/Chrome|Chromium/i.test(e)?"Chrome":"Unknown"}function HA(){const e=jA();if(e)return e;const t=navigator.userAgent||"",n=navigator.userAgentData;return n&&typeof n.mobile=="boolean"?n.mobile?"mobile":"desktop":/Android|iPhone|iPad|iPod|Mobile/i.test(t)?"mobile":"desktop"}function WA(e){if(!e)return null;try{return new URL(e).hostname}catch{return null}}function Ix(){try{return window.top!==window.self}catch{return  true}}function VA(){const e=Ix(),t=WA(document.referrer);return e&&!!t&&/(^|\.)discord(app)?\.com$/i.test(t)?"discord":"web"}function pp(){const e=Ex();if(e)return e;const t=VA(),n=HA(),r=Ax(),o=Tx(),i=Ix(),a=window.screen||{},s=window.visualViewport,l=Math.round(window.innerWidth||document.documentElement.clientWidth||0),c=Math.round(window.innerHeight||document.documentElement.clientHeight||0),d=Math.round(s?.width??l),u=Math.round(s?.height??c),f=Math.round(a.width||0),g=Math.round(a.height||0),h=Math.round(a.availWidth||f),y=Math.round(a.availHeight||g),S=Number.isFinite(window.devicePixelRatio)?window.devicePixelRatio:1,C={surface:t,host:location.hostname,origin:location.origin,isInIframe:i,platform:n,browser:o,os:r,viewportWidth:l,viewportHeight:c,visualViewportWidth:d,visualViewportHeight:u,screenWidth:f,screenHeight:g,availScreenWidth:h,availScreenHeight:y,dpr:S,orientation:UA()};return zA(C),C}function qA(){return pp().surface==="discord"}function KA(){return pp().platform==="mobile"}function XA(){pp();}function YA(){return Ex()!==null}const Vt={init:XA,isReady:YA,detect:pp,isDiscord:qA,isMobile:KA,detectOS:Ax,detectBrowser:Tx,setPlatformOverride:GA};let Au=false;const Fs=new Set;function JA(e=document){let t=e.activeElement||null;for(;t&&t.shadowRoot&&t.shadowRoot.activeElement;)t=t.shadowRoot.activeElement;return t}const Hn=e=>{const t=JA();if(t){for(const n of Fs)if(t===n||n.contains(t)){e.stopImmediatePropagation(),e.stopPropagation();return}}};function QA(){Au||(Au=true,window.addEventListener("keydown",Hn,true),window.addEventListener("keypress",Hn,true),window.addEventListener("keyup",Hn,true),document.addEventListener("keydown",Hn,true),document.addEventListener("keypress",Hn,true),document.addEventListener("keyup",Hn,true));}function ZA(){Au&&(Au=false,window.removeEventListener("keydown",Hn,true),window.removeEventListener("keypress",Hn,true),window.removeEventListener("keyup",Hn,true),document.removeEventListener("keydown",Hn,true),document.removeEventListener("keypress",Hn,true),document.removeEventListener("keyup",Hn,true));}function eT(e){return Fs.size===0&&QA(),Fs.add(e),()=>{Fs.delete(e),Fs.size===0&&ZA();}}function tT(e,t,n,r){let o;switch(e){case "digits":o="0-9";break;case "alpha":o="\\p{L}";break;case "alphanumeric":o="\\p{L}0-9";break;default:return null}return t&&(o+=" "),n&&(o+="\\-"),r&&(o+="_"),new RegExp(`[^${o}]`,"gu")}function nT(e,t){return t?e.replace(t,""):e}function rT(e,t=0){if(!t)return e;let n;return((...r)=>{clearTimeout(n),n=setTimeout(()=>e(...r),t);})}function ic(e={}){const{id:t,placeholder:n="",value:r="",mode:o="any",allowSpaces:i=false,allowDashes:a=false,allowUnderscore:s=false,maxLength:l,blockGameKeys:c=true,debounceMs:d=0,onChange:u,onEnter:f,label:g}=e,h=x("div",{className:"lg-input-wrap"}),y=x("input",{className:"input",id:t,placeholder:n});if(typeof l=="number"&&l>0&&(y.maxLength=l),r&&(y.value=r),g){const F=x("div",{className:"lg-input-label"},g);h.appendChild(F);}h.appendChild(y);const S=tT(o,i,a,s),C=()=>{const F=y.selectionStart??y.value.length,G=y.value.length,q=nT(y.value,S);if(q!==y.value){y.value=q;const H=G-q.length,ce=Math.max(0,F-H);y.setSelectionRange(ce,ce);}},_=rT(()=>u?.(y.value),d);y.addEventListener("input",()=>{C(),_();}),y.addEventListener("paste",()=>queueMicrotask(()=>{C(),_();})),y.addEventListener("keydown",F=>{F.key==="Enter"&&f?.(y.value);});const E=c?eT(y):()=>{};function P(){return y.value}function O(F){y.value=F??"",C(),_();}function k(){y.focus();}function I(){y.blur();}function R(F){y.disabled=!!F;}function A(){return document.activeElement===y}function L(){E();}return {root:h,input:y,getValue:P,setValue:O,focus:k,blur:I,setDisabled:R,isFocused:A,destroy:L}}function Qt(e,t,n){return Math.min(n,Math.max(t,e))}function al({h:e,s:t,v:n,a:r}){const o=(e%360+360)%360/60,i=n*t,a=i*(1-Math.abs(o%2-1));let s=0,l=0,c=0;switch(Math.floor(o)){case 0:s=i,l=a;break;case 1:s=a,l=i;break;case 2:l=i,c=a;break;case 3:l=a,c=i;break;case 4:s=a,c=i;break;default:s=i,c=a;break}const u=n-i,f=Math.round((s+u)*255),g=Math.round((l+u)*255),h=Math.round((c+u)*255);return {r:Qt(f,0,255),g:Qt(g,0,255),b:Qt(h,0,255),a:Qt(r,0,1)}}function Px({r:e,g:t,b:n,a:r}){const o=Qt(e,0,255)/255,i=Qt(t,0,255)/255,a=Qt(n,0,255)/255,s=Math.max(o,i,a),l=Math.min(o,i,a),c=s-l;let d=0;c!==0&&(s===o?d=60*((i-a)/c%6):s===i?d=60*((a-o)/c+2):d=60*((o-i)/c+4)),d<0&&(d+=360);const u=s===0?0:c/s;return {h:d,s:u,v:s,a:Qt(r,0,1)}}function Am({r:e,g:t,b:n}){const r=o=>Qt(Math.round(o),0,255).toString(16).padStart(2,"0");return `#${r(e)}${r(t)}${r(n)}`.toUpperCase()}function oT({r:e,g:t,b:n,a:r}){const o=Qt(Math.round(r*255),0,255);return `${Am({r:e,g:t,b:n})}${o.toString(16).padStart(2,"0")}`.toUpperCase()}function Bs({r:e,g:t,b:n,a:r}){const o=Math.round(r*1e3)/1e3;return `rgba(${e}, ${t}, ${n}, ${o})`}function fa(e){let t=e.trim();if(!t||(t.startsWith("#")&&(t=t.slice(1)),![3,4,6,8].includes(t.length))||!/^[0-9a-fA-F]+$/.test(t))return null;(t.length===3||t.length===4)&&(t=t.split("").map(a=>a+a).join(""));let n=255;t.length===8&&(n=parseInt(t.slice(6,8),16),t=t.slice(0,6));const r=parseInt(t.slice(0,2),16),o=parseInt(t.slice(2,4),16),i=parseInt(t.slice(4,6),16);return {r,g:o,b:i,a:n/255}}function Hh(e){if(!e)return null;const t=e.trim();if(t.startsWith("#"))return fa(t);const n=t.match(/^rgba?\(([^)]+)\)$/i);if(n){const r=n[1].split(",").map(l=>l.trim());if(r.length<3)return null;const o=Number(r[0]),i=Number(r[1]),a=Number(r[2]),s=r[3]!=null?Number(r[3]):1;return [o,i,a,s].some(l=>Number.isNaN(l))?null:{r:o,g:i,b:a,a:s}}return null}function iT(e,t){const n=Hh(e)??fa(e??"")??{r:244,g:67,b:54,a:1};return typeof t=="number"&&(n.a=Qt(t,0,1)),Px(n)}function aT(e){return `#${e.trim().replace(/[^0-9a-fA-F#]/g,"").replace(/#/g,"")}`.slice(0,9).toUpperCase()}function sT(e){let t=e.trim();return t&&(/^rgba?\s*\(/i.test(t)?t=t.replace(/^rgba?/i,"rgba"):(t=t.replace(/^\(?(.*)\)?$/,"$1"),t=`rgba(${t})`),t=t.replace(/\s*\(\s*/,"("),t=t.replace(/\s*\)\s*$/,")"),t=t.replace(/\s*,\s*/g,", "),t)}function Ko(e){const t=al(e),n=al({...e,a:1});return {hsva:{...e},hex:Am(n),hexa:oT(t),rgba:Bs(t),alpha:e.a}}function lT(e={}){const{id:t,label:n="Color",value:r,alpha:o,defaultExpanded:i=false,detectMobile:a,onInput:s,onChange:l}=e,d=a?a():Vt.detect().platform==="mobile";let u=iT(r,o);const f=dt({id:t,className:"color-picker",title:n,padding:d?"md":"lg",variant:"soft",expandable:!d,defaultExpanded:!d&&i});f.classList.add(d?"color-picker--mobile":"color-picker--desktop");const g=f.querySelector(".card-header");g&&g.classList.add("color-picker__header");const h=g?.querySelector(".card-title"),y=x("button",{className:"color-picker__preview",type:"button",title:`Preview ${n}`,"aria-label":`Change ${n}`});h?h.prepend(y):g?g.prepend(y):f.prepend(y);const S=f.querySelector(".card-toggle");!d&&S&&y.addEventListener("click",()=>{f.classList.contains("card--collapsed")&&S.click();});const C=f.querySelector(".card-collapse");let _=null,E=null,P=null,O=null,k=null,I=null,R=null,A=null,L=null,F="hex";function G(te){const ne=Ko(u);te==="input"?s?.(ne):l?.(ne);}function q(){const te=Ko(u);if(y.style.setProperty("--cp-preview-color",te.rgba),y.setAttribute("aria-label",`${n}: ${te.hexa}`),!d&&_&&E&&P&&O&&k&&I&&R){const ne=al({...u,s:1,v:1,a:1}),ie=Bs(ne);_.style.setProperty("--cp-palette-hue",ie),E.style.left=`${u.s*100}%`,E.style.top=`${(1-u.v)*100}%`,P.style.setProperty("--cp-alpha-gradient",`linear-gradient(180deg, ${Bs({...ne,a:1})} 0%, ${Bs({...ne,a:0})} 100%)`),O.style.top=`${(1-u.a)*100}%`,k.style.setProperty("--cp-hue-color",Bs(al({...u,v:1,s:1,a:1}))),I.style.left=`${u.h/360*100}%`;const ee=u.a===1?te.hex:te.hexa,U=te.rgba,X=F==="hex"?ee:U;R!==document.activeElement&&(R.value=X),R.setAttribute("aria-label",`${F.toUpperCase()} code for ${n}`),R.placeholder=F==="hex"?"#RRGGBB or #RRGGBBAA":"rgba(0, 0, 0, 1)",F==="hex"?R.maxLength=9:R.removeAttribute("maxLength"),R.dataset.mode=F,A&&(A.textContent=F.toUpperCase(),A.setAttribute("aria-label",F==="hex"?"Passer en saisie RGBA":"Revenir en saisie HEX"),A.setAttribute("aria-pressed",F==="rgba"?"true":"false"),A.classList.toggle("is-alt",F==="rgba"));}L&&L!==document.activeElement&&(L.value=te.hex);}function H(te,ne=null){u={h:(te.h%360+360)%360,s:Qt(te.s,0,1),v:Qt(te.v,0,1),a:Qt(te.a,0,1)},q(),ne&&G(ne);}function ce(te,ne=null){H(Px(te),ne);}function W(te,ne,ie){te.addEventListener("pointerdown",ee=>{ee.preventDefault();const U=ee.pointerId,X=j=>{j.pointerId===U&&ne(j);},D=j=>{j.pointerId===U&&(document.removeEventListener("pointermove",X),document.removeEventListener("pointerup",D),document.removeEventListener("pointercancel",D),ie?.(j));};ne(ee),document.addEventListener("pointermove",X),document.addEventListener("pointerup",D),document.addEventListener("pointercancel",D);});}if(!d&&C){const te=C.querySelector(".card-body");if(te){te.classList.add("color-picker__body"),E=x("div",{className:"color-picker__palette-cursor"}),_=x("div",{className:"color-picker__palette"},E),O=x("div",{className:"color-picker__alpha-thumb"}),P=x("div",{className:"color-picker__alpha"},O),I=x("div",{className:"color-picker__hue-thumb"}),k=x("div",{className:"color-picker__hue"},I);const ne=x("div",{className:"color-picker__main"},_,P),ie=x("div",{className:"color-picker__hue-row"},k),ee=ic({blockGameKeys:true});R=ee.input,R.classList.add("color-picker__hex-input"),R.value="",R.maxLength=9,R.spellcheck=false,R.inputMode="text",R.setAttribute("aria-label",`Hex code for ${n}`),A=x("button",{type:"button",className:"color-picker__mode-btn",textContent:"HEX","aria-pressed":"false","aria-label":"Passer en saisie RGBA"}),ee.root.classList.add("color-picker__hex-wrap");const U=x("div",{className:"color-picker__hex-row"},A,ee.root);te.replaceChildren(ne,ie,U),W(_,D=>{if(!_||!E)return;const j=_.getBoundingClientRect(),Q=Qt((D.clientX-j.left)/j.width,0,1),ae=Qt((D.clientY-j.top)/j.height,0,1);H({...u,s:Q,v:1-ae},"input");},()=>G("change")),W(P,D=>{if(!P)return;const j=P.getBoundingClientRect(),Q=Qt((D.clientY-j.top)/j.height,0,1);H({...u,a:1-Q},"input");},()=>G("change")),W(k,D=>{if(!k)return;const j=k.getBoundingClientRect(),Q=Qt((D.clientX-j.left)/j.width,0,1);H({...u,h:Q*360},"input");},()=>G("change")),A.addEventListener("click",()=>{if(F=F==="hex"?"rgba":"hex",R){const D=Ko(u);R.value=F==="hex"?u.a===1?D.hex:D.hexa:D.rgba;}q(),R?.focus(),R?.select();}),R.addEventListener("input",()=>{if(F==="hex"){const D=aT(R.value);if(D!==R.value){const j=R.selectionStart??D.length;R.value=D,R.setSelectionRange(j,j);}}});const X=()=>{const D=R.value;if(F==="hex"){const j=fa(D);if(!j){R.value=u.a===1?Ko(u).hex:Ko(u).hexa;return}const Q=D.startsWith("#")?D.slice(1):D,ae=Q.length===4||Q.length===8;j.a=ae?j.a:u.a,ce(j,"change");}else {const j=sT(D),Q=Hh(j);if(!Q){R.value=Ko(u).rgba;return}ce(Q,"change");}};R.addEventListener("change",X),R.addEventListener("blur",X),R.addEventListener("keydown",D=>{D.key==="Enter"&&(X(),R.blur());});}}return d&&(C&&C.remove(),L=x("input",{className:"color-picker__native",type:"color",value:Am(al({...u,a:1}))}),y.addEventListener("click",()=>L.click()),L.addEventListener("input",()=>{const te=fa(L.value);te&&(te.a=u.a,ce(te,"input"),G("change"));}),f.appendChild(L)),q(),{root:f,isMobile:d,getValue:()=>Ko(u),setValue:(te,ne)=>{const ie=Hh(te)??fa(te)??fa("#FFFFFF");ie&&(typeof ne=="number"&&(ie.a=ne),ce(ie,null));}}}const Tm=window;function cT(){if(typeof unsafeWindow<"u"&&unsafeWindow)return unsafeWindow;const e=window.wrappedJSObject;return e&&e!==window?e:Tm}const Im=cT(),ge=Im,dT=Im!==Tm;function Da(e,t){const n=r=>{try{const o=r.CustomEvent||CustomEvent;r.dispatchEvent(new o(e,t!==void 0?{detail:t}:void 0));}catch{}};n(Im),dT&&n(Tm);}function uT(e){try{return !!e.isSecureContext}catch{return  false}}function Pm(e){const t=e?.getRootNode?.();return t&&(t instanceof Document||t.host)?t:document}function Rx(){const e=navigator.platform||"",t=navigator.userAgent||"";return /Mac|iPhone|iPad|iPod/i.test(e)||/Mac OS|iOS/i.test(t)}async function pT(){try{const e=await navigator.permissions?.query?.({name:"clipboard-write"});return e?e.state==="granted"||e.state==="prompt":!0}catch{return  true}}function fT(e,t){const n=document.createElement("textarea");return n.value=e,n.setAttribute("readonly","true"),n.style.position="fixed",n.style.opacity="0",n.style.pointerEvents="none",n.style.top="0",t.appendChild?t.appendChild(n):document.body.appendChild(n),n}function hT(e){try{const t=window.getSelection?.();if(!t)return !1;const n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),!0}catch{return  false}}async function gT(e){if(!("clipboard"in navigator))return {ok:false,method:"clipboard-write"};if(!uT(ge))return {ok:false,method:"clipboard-write"};if(!await pT())return {ok:false,method:"clipboard-write"};try{return await navigator.clipboard.writeText(e),{ok:!0,method:"clipboard-write"}}catch{return {ok:false,method:"clipboard-write"}}}function mT(e,t){try{const n=t||Pm(),r=fT(e,n);r.focus(),r.select(),r.setSelectionRange(0,r.value.length);let o=!1;try{o=document.execCommand("copy");}catch{o=!1;}return r.remove(),{ok:o,method:"execCommand"}}catch{return {ok:false,method:"execCommand"}}}function bT(e,t){if(!t)return {ok:false,method:"selection"};const n=t.textContent??"";let r=false;if(n!==e)try{t.textContent=e,r=!0;}catch{}const o=hT(t);r&&setTimeout(()=>{try{t.textContent=n;}catch{}},80);const i=Rx()?"⌘C pour copier":"Ctrl+C pour copier";return {ok:o,method:"selection",hint:i}}async function vT(e,t={}){const n=(e??"").toString();if(!n.length)return {ok:false,method:"noop"};const r=await gT(n);if(r.ok)return r;const o=t.injectionRoot||Pm(t.valueNode||void 0),i=mT(n,o);if(i.ok)return i;const a=bT(n,t.valueNode||null);if(a.ok)return a;if(!t.disablePromptFallback)try{return window.prompt(Vt.isDiscord()?"Copie manuelle (Discord bloque clipboard):":"Copie manuelle:",n),{ok:!0,method:"prompt"}}catch{}return {ok:false,method:"noop"}}function yT(e,t,n={}){const r=o=>{if(n.showTip){n.showTip(o);return}try{e.setAttribute("aria-label",o);const i=document.createElement("div");i.textContent=o,i.style.position="absolute",i.style.top="-28px",i.style.right="0",i.style.padding="4px 8px",i.style.borderRadius="8px",i.style.fontSize="12px",i.style.background="color-mix(in oklab, var(--bg) 85%, transparent)",i.style.border="1px solid var(--border)",i.style.color="var(--fg)",i.style.pointerEvents="none",i.style.opacity="0",i.style.transition="opacity .12s";const a=Pm(e);a.appendChild?a.appendChild(i):document.body.appendChild(i);const s=e.getBoundingClientRect();i.style.left=`${s.right-8}px`,i.style.top=`${s.top-28}px`,requestAnimationFrame(()=>i.style.opacity="1"),setTimeout(()=>{i.style.opacity="0",setTimeout(()=>i.remove(),150);},1200);}catch{}};e.addEventListener("click",async o=>{o.stopPropagation();const i=(t()??"").toString(),a=await vT(i,{valueNode:n.valueNode??null,injectionRoot:n.injectionRoot??null,disablePromptFallback:n.disablePromptFallback??false});n.onResult?.(a),a.ok?a.method==="clipboard-write"||a.method==="execCommand"||a.method==="prompt"?r("Copié"):a.method==="selection"&&r(a.hint||(Rx()?"⌘C pour copier":"Ctrl+C pour copier")):r("Impossible de copier");});}const wa={light:{"--bg":"rgba(255,255,255,0.7)","--fg":"#0f172a","--muted":"rgba(15,23,42,0.06)","--soft":"rgba(15,23,42,0.04)","--accent":"#2563eb","--border":"rgba(15,23,42,0.12)","--shadow":"rgba(2,6,23,.2)","--paper":"#FDFBF7","--tab-bg":"#ffffff","--tab-fg":"#0f172a","--pill-from":"#4f46e5","--pill-to":"#06b6d4","--low":"#dc2626","--medium":"#f59e0b","--high":"#16a34a","--complete":"#15803d","--info":"#2563eb","--xp-fill":"#0febff","--accent-1":"#16a34a","--accent-2":"#7c3aed","--mut-rainbow":"#FF00FF","--mut-gold":"#EBC800","--mut-wet":"#5FFFFF","--mut-chilled":"#B4E6FF","--mut-frozen":"#B9C8FF","--mut-dawnlit":"#F59BE1","--mut-dawncharged":"#C896FF","--mut-ambershine":"#FFB478","--mut-ambercharged":"#FA8C4B","--rarity-common":"#E7E7E7","--rarity-uncommon":"#67BD4D","--rarity-rare":"#0071C6","--rarity-legendary":"#FFC734","--rarity-mythical":"#9944A7","--rarity-divine":"#FF7835","--rarity-celestial":"#FF00FF","--rainbow-text-gradient":"linear-gradient(90deg, #b000b0, #d00000, #b08000, #008000, #0000b0, #4b0082, #9400d3)","--switch-thumb":"#ffffff","--journal-ink":"#333333"},dark:{"--bg":"rgba(10,12,18,0.6)","--fg":"#e5e7eb","--muted":"rgba(229,231,235,0.08)","--soft":"rgba(229,231,235,0.05)","--accent":"#60a5fa","--border":"rgba(148,163,184,0.2)","--shadow":"rgba(0,0,0,.45)","--paper":"#1a1d24","--tab-bg":"rgba(255,255,255,0.08)","--tab-fg":"#e5e7eb","--pill-from":"#6366f1","--pill-to":"#06b6d4","--low":"#ef4444","--medium":"#f59e0b","--high":"#22c55e","--complete":"#16a34a","--info":"#3b82f6","--xp-fill":"#0febff","--accent-1":"#22c55e","--accent-2":"#a855f7","--mut-rainbow":"#FF00FF","--mut-gold":"#EBC800","--mut-wet":"#5FFFFF","--mut-chilled":"#B4E6FF","--mut-frozen":"#B9C8FF","--mut-dawnlit":"#F59BE1","--mut-dawncharged":"#C896FF","--mut-ambershine":"#FFB478","--mut-ambercharged":"#FA8C4B","--rarity-common":"#E7E7E7","--rarity-uncommon":"#67BD4D","--rarity-rare":"#0071C6","--rarity-legendary":"#FFC734","--rarity-mythical":"#9944A7","--rarity-divine":"#FF7835","--rarity-celestial":"#FF00FF","--rainbow-text-gradient":"linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #00ffff, #ff00ff)","--switch-thumb":"#ffffff","--journal-ink":"#ffffff"},sepia:{"--bg":"rgba(247,242,231,0.72)","--fg":"#3b2f2f","--muted":"rgba(59,47,47,0.06)","--soft":"rgba(59,47,47,0.04)","--accent":"#b07d62","--border":"rgba(59,47,47,0.14)","--shadow":"rgba(0,0,0,.18)","--paper":"#F5E6D3","--tab-bg":"#fff","--tab-fg":"#3b2f2f","--pill-from":"#b07d62","--pill-to":"#d4a373","--low":"#c2410c","--medium":"#d97706","--high":"#15803d","--complete":"#166534","--info":"#1d4ed8","--accent-1":"#15803d","--accent-2":"#6b21a8","--mut-rainbow":"#FF00FF","--mut-gold":"#EBC800","--mut-wet":"#5FFFFF","--mut-chilled":"#B4E6FF","--mut-frozen":"#B9C8FF","--mut-dawnlit":"#F59BE1","--mut-dawncharged":"#C896FF","--mut-ambershine":"#FFB478","--mut-ambercharged":"#FA8C4B","--rarity-common":"#E7E7E7","--rarity-uncommon":"#67BD4D","--rarity-rare":"#0071C6","--rarity-legendary":"#FFC734","--rarity-mythical":"#9944A7","--rarity-divine":"#FF7835","--rarity-celestial":"#FF00FF","--rainbow-text-gradient":"linear-gradient(90deg, #b000b0, #d00000, #b08000, #008000, #0000b0, #4b0082, #9400d3)","--switch-thumb":"#ffffff","--journal-ink":"#3b2f2f"},forest:{"--bg":"rgba(14,24,18,0.62)","--fg":"#e7f5e9","--muted":"rgba(231,245,233,0.08)","--soft":"rgba(231,245,233,0.05)","--accent":"#34d399","--border":"rgba(231,245,233,0.16)","--shadow":"rgba(0,0,0,.5)","--paper":"#1e2820","--tab-bg":"rgba(255,255,255,0.06)","--tab-fg":"#e7f5e9","--pill-from":"#10b981","--pill-to":"#84cc16","--low":"#dc2626","--medium":"#eab308","--high":"#22c55e","--complete":"#16a34a","--info":"#06b6d4","--accent-1":"#22c55e","--accent-2":"#8b5cf6","--mut-rainbow":"#FF00FF","--mut-gold":"#EBC800","--mut-wet":"#5FFFFF","--mut-chilled":"#B4E6FF","--mut-frozen":"#B9C8FF","--mut-dawnlit":"#F59BE1","--mut-dawncharged":"#C896FF","--mut-ambershine":"#FFB478","--mut-ambercharged":"#FA8C4B","--rarity-common":"#E7E7E7","--rarity-uncommon":"#67BD4D","--rarity-rare":"#0071C6","--rarity-legendary":"#FFC734","--rarity-mythical":"#9944A7","--rarity-divine":"#FF7835","--rarity-celestial":"#FF00FF","--rainbow-text-gradient":"linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #00ffff, #ff00ff)","--switch-thumb":"#ffffff","--journal-ink":"#ffffff"},violet:{"--bg":"rgba(23, 16, 42, 0.68)","--fg":"#f5f3ff","--muted":"rgba(245,243,255,0.08)","--soft":"rgba(245,243,255,0.05)","--accent":"#a855f7","--border":"rgba(216,180,254,0.22)","--shadow":"rgba(12,3,30,.55)","--paper":"#1a1424","--tab-bg":"rgba(255,255,255,0.08)","--tab-fg":"#ede9fe","--pill-from":"#a855f7","--pill-to":"#f472b6","--low":"#f43f5e","--medium":"#fbbf24","--high":"#4ade80","--complete":"#22c55e","--info":"#60a5fa","--accent-1":"#4ade80","--accent-2":"#c084fc","--mut-rainbow":"#FF00FF","--mut-gold":"#EBC800","--mut-wet":"#5FFFFF","--mut-chilled":"#B4E6FF","--mut-frozen":"#B9C8FF","--mut-dawnlit":"#F59BE1","--mut-dawncharged":"#C896FF","--mut-ambershine":"#FFB478","--mut-ambercharged":"#FA8C4B","--rarity-common":"#E7E7E7","--rarity-uncommon":"#67BD4D","--rarity-rare":"#0071C6","--rarity-legendary":"#FFC734","--rarity-mythical":"#9944A7","--rarity-divine":"#FF7835","--rarity-celestial":"#FF00FF","--rainbow-text-gradient":"linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #00ffff, #ff00ff)","--switch-thumb":"#ffffff","--journal-ink":"#ffffff"},ocean:{"--bg":"rgba(10, 34, 46, 0.66)","--fg":"#e0f7ff","--muted":"rgba(224,247,255,0.07)","--soft":"rgba(224,247,255,0.05)","--accent":"#38bdf8","--border":"rgba(125, 211, 252, 0.22)","--shadow":"rgba(0, 16, 32, .52)","--paper":"#0f2027","--tab-bg":"rgba(56,189,248,0.14)","--tab-fg":"#e0f7ff","--pill-from":"#0ea5e9","--pill-to":"#14b8a6","--low":"#f43f5e","--medium":"#fbbf24","--high":"#34d399","--complete":"#10b981","--info":"#38bdf8","--accent-1":"#22c55e","--accent-2":"#a78bfa","--mut-rainbow":"#FF00FF","--mut-gold":"#EBC800","--mut-wet":"#5FFFFF","--mut-chilled":"#B4E6FF","--mut-frozen":"#B9C8FF","--mut-dawnlit":"#F59BE1","--mut-dawncharged":"#C896FF","--mut-ambershine":"#FFB478","--mut-ambercharged":"#FA8C4B","--rarity-common":"#E7E7E7","--rarity-uncommon":"#67BD4D","--rarity-rare":"#0071C6","--rarity-legendary":"#FFC734","--rarity-mythical":"#9944A7","--rarity-divine":"#FF7835","--rarity-celestial":"#FF00FF","--rainbow-text-gradient":"linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #00ffff, #ff00ff)","--switch-thumb":"#ffffff","--journal-ink":"#ffffff"},ember:{"--bg":"rgba(34,18,10,0.64)","--fg":"#fff7ed","--muted":"rgba(255,247,237,0.08)","--soft":"rgba(255,247,237,0.05)","--accent":"#f97316","--border":"rgba(255, 159, 92, 0.24)","--shadow":"rgba(16,6,2,.52)","--paper":"#1a1210","--tab-bg":"rgba(255,247,237,0.09)","--tab-fg":"#fff7ed","--pill-from":"#fb923c","--pill-to":"#facc15","--low":"#dc2626","--medium":"#f59e0b","--high":"#22c55e","--complete":"#16a34a","--info":"#38bdf8","--accent-1":"#22c55e","--accent-2":"#c084fc","--mut-rainbow":"#FF00FF","--mut-gold":"#EBC800","--mut-wet":"#5FFFFF","--mut-chilled":"#B4E6FF","--mut-frozen":"#B9C8FF","--mut-dawnlit":"#F59BE1","--mut-dawncharged":"#C896FF","--mut-ambershine":"#FFB478","--mut-ambercharged":"#FA8C4B","--rarity-common":"#E7E7E7","--rarity-uncommon":"#67BD4D","--rarity-rare":"#0071C6","--rarity-legendary":"#FFC734","--rarity-mythical":"#9944A7","--rarity-divine":"#FF7835","--rarity-celestial":"#FF00FF","--rainbow-text-gradient":"linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #00ffff, #ff00ff)","--switch-thumb":"#ffffff","--journal-ink":"#ffffff"},magicGarden:{"--bg":"#201D1D","--fg":"#F5F5F5","--muted":"rgba(255,255,255,0.6)","--soft":"rgba(0,0,0,0.3)","--accent":"#FFF27D","--border":"rgba(255,255,255,0.1)","--border-accent":"#4A3B2E","--shadow":"rgba(0,0,0,0.5)","--paper":"#FDFBF7","--card-shadow":"0 4px 10px rgba(0, 0, 0, 0.5)","--tab-bg":"#10725A","--tab-fg":"#F5F5F5","--section-title":"#10725A","--group-title":"#5EB292","--item-label":"#F5F5F5","--item-desc":"rgba(255,255,255,0.6)","--item-value":"#FFF27D","--card-bg":"rgba(0,0,0,0.3)","--card-radius":"12px","--card-border":"#4A3B2E","--pill-from":"#FFF27D","--pill-to":"#5EB292","--scrollbar-thumb":"rgba(255,255,255,0.2)","--scrollbar-thumb-hover":"rgba(255,255,255,0.3)","--low":"#F98B4B","--medium":"#F3D32B","--high":"#5EAC46","--complete":"#0B893F","--info":"#38bdf8","--accent-1":"#4caf50","--accent-2":"#9c27b0","--mut-rainbow":"#FF00FF","--mut-gold":"#EBC800","--mut-wet":"#5FFFFF","--mut-chilled":"#B4E6FF","--mut-frozen":"#B9C8FF","--mut-dawnlit":"#F59BE1","--mut-dawncharged":"#C896FF","--mut-ambershine":"#FFB478","--mut-ambercharged":"#FA8C4B","--rarity-common":"#E7E7E7","--rarity-uncommon":"#67BD4D","--rarity-rare":"#0071C6","--rarity-legendary":"#FFC734","--rarity-mythical":"#9944A7","--rarity-divine":"#FF7835","--rarity-celestial":"#FF00FF","--rainbow-text-gradient":"linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #00ffff, #ff00ff)","--switch-thumb":"#ffffff","--journal-ink":"#000000"}};function wT(e){const{host:t,themes:n,initialTheme:r,onThemeChange:o}=e;let i=r,a=null,s=false;function l(d){const u=n[d]||n[i]||{};t.setAttribute("data-theme",d),s&&t.classList.add("theme-anim");for(const[f,g]of Object.entries(u))t.style.setProperty(f,g);s?(a!==null&&clearTimeout(a),a=ge.setTimeout(()=>{t.classList.remove("theme-anim"),a=null;},320)):s=true,i=d,o?.(d);}function c(){return i}return l(r),{applyTheme:l,getCurrentTheme:c}}const Wh={ui:{expandedCards:{style:false,hudSections:false,enhancements:false,journal:false,system:false,restock:false}}};async function xT(){const e=await co("tab-settings",{version:2,defaults:Wh,sanitize:o=>({ui:{expandedCards:$a(Wh.ui.expandedCards,o.ui?.expandedCards)}})});function t(o){const i=e.get();e.update({ui:{...i.ui,...o,expandedCards:$a(i.ui.expandedCards,o.expandedCards)}});}function n(o,i){const a=e.get();e.update({ui:{...a.ui,expandedCards:{...a.ui.expandedCards,[o]:!!i}}});}function r(o){const i=e.get();n(o,!i.ui.expandedCards[o]);}return {get:e.get,set:e.set,save:e.save,setUI:t,setCardExpanded:n,toggleCard:r}}const Mx={seed:3e5,egg:9e5,decor:36e5},Vh=lt.SHOP_RESTOCK,Lx=lt.SHOP_RESTOCK_HISTORY,Xi={enabled:true,trackedItems:[],communityDataEnabled:true,communitySource:"supabase",supabaseUrl:"https://xjuvryjgrjchbhjixwzh.supabase.co",supabaseAnonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhqdXZyeWpncmpjaGJoaml4d3poIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAxMDYyODMsImV4cCI6MjA4NTY4MjI4M30.MqQCBG-UMR4HYJU44Tz2orHUj9gMgJTMJtxpb_MHeps",debug:{enabled:false,mockLatencyMs:0}},Ox={DEBUG_SIMULATE:"gemini:shop-restock-simulate"};let Yt=null,js=null;function Nx(e){return JSON.parse(JSON.stringify(e))}function fr(){if(Yt)return Yt;const e=Xe(Vh,Xi);return Yt={...Xi,...e,trackedItems:Array.isArray(e?.trackedItems)?e.trackedItems:[],debug:{...Xi.debug,...e?.debug??{}}},(!("supabaseUrl"in e)||!Yt.supabaseUrl)&&(Yt.supabaseUrl=Xi.supabaseUrl),(!("supabaseAnonKey"in e)||!Yt.supabaseAnonKey)&&(Yt.supabaseAnonKey=Xi.supabaseAnonKey),Yt.communitySource!=="supabase"&&Yt.communitySource!=="vps"&&(Yt.communitySource=Xi.communitySource),(!("communitySource"in e)||e.communityDataEnabled!==Yt.communityDataEnabled||e.enabled!==Yt.enabled||e.supabaseUrl!==Yt.supabaseUrl||e.supabaseAnonKey!==Yt.supabaseAnonKey)&&Ye(Vh,Yt),Yt}function Tu(e){Yt=Nx(e),Ye(Vh,Yt);}function Rm(){return fr().enabled}function CT(e){const t=fr();t.enabled!==e&&Tu({...t,enabled:e});}function ST(){if(js)return js;const e=Xe(Lx,{});return js=e&&typeof e=="object"?Nx(e):{},js}function Mm(e){js=e,Ye(Lx,e);}function zt(e,t){fr().debug.enabled&&(t!==void 0?console.log(`[ShopRestock] ${e}`,t):console.log(`[ShopRestock] ${e}`));}const fp=e=>new Promise(t=>setTimeout(t,e)),cr=e=>{try{return e()}catch{return}},Ir=(e,t,n)=>Math.max(t,Math.min(n,e)),_T=e=>Ir(e,0,1);async function ay(e,t,n){const r=performance.now();for(;performance.now()-r<t;){const o=await Promise.race([e,fp(50).then(()=>null)]);if(o!==null)return o}throw new Error(`${n} timeout`)}let Lm=null;function $x(){return Lm}function kT(e){Lm=e;}function Dx(){return Lm!==null}const ET=/\/(?:r\/\d+\/)?version\/([^/]+)/,AT=15e3,TT=50;function IT(){return ge?.document??(typeof document<"u"?document:null)}function Om(e={}){if(Dx())return;const t=e.doc??IT();if(!t)return;const n=t.scripts;for(let r=0;r<n.length;r++){const i=n.item(r)?.src;if(!i)continue;const a=i.match(ET);if(a?.[1]){kT(a[1]);return}}}function PT(){return Om(),$x()}function RT(){return Dx()}async function MT(e={}){const t=e.timeoutMs??AT,n=performance.now();for(;performance.now()-n<t;){Om();const r=$x();if(r)return r;await fp(TT);}throw new Error("MGVersion timeout (gameVersion not found)")}const Nm={init:Om,isReady:RT,get:PT,wait:MT},LT=ge?.location?.origin||"https://magicgarden.gg";function Fx(){return typeof GM_xmlhttpRequest=="function"}function Bx(e,t="text"){return new Promise((n,r)=>{GM_xmlhttpRequest({method:"GET",url:e,responseType:t,onload:o=>o.status>=200&&o.status<300?n(o):r(new Error(`HTTP ${o.status} for ${e}`)),onerror:()=>r(new Error(`Network error for ${e}`)),ontimeout:()=>r(new Error(`Timeout for ${e}`))});})}async function $m(e){if(Fx())return JSON.parse((await Bx(e,"text")).responseText);const t=await fetch(e);if(!t.ok)throw new Error(`HTTP ${t.status} for ${e}`);return t.json()}async function jx(e){if(Fx())return (await Bx(e,"blob")).response;const t=await fetch(e);if(!t.ok)throw new Error(`HTTP ${t.status} for ${e}`);return t.blob()}function OT(e){return new Promise((t,n)=>{const r=URL.createObjectURL(e),o=ge?.Image||Image,i=new o;i.decoding="async",i.onload=()=>{URL.revokeObjectURL(r),t(i);},i.onerror=()=>{URL.revokeObjectURL(r),n(new Error("Image decode failed"));},i.src=r;})}const Qr=(e,t)=>e.replace(/\/?$/,"/")+String(t||"").replace(/^\//,""),NT=e=>e.lastIndexOf("/")>=0?e.slice(0,e.lastIndexOf("/")+1):"",sy=(e,t)=>String(t||"").startsWith("/")?String(t).slice(1):NT(e)+String(t||"");let Dm=null,Gx=null;function zx(){return Dm}function $T(){return Gx}function DT(e){Dm=e;}function FT(e){Gx=e;}function Ux(){return Dm!==null}const BT=15e3;async function jT(e={}){Ux()||await Fm(e);}async function Fm(e={}){const t=zx();if(t)return t;const n=$T();if(n)return n;const r=(async()=>{const o=e.gameVersion??await Nm.wait({timeoutMs:BT}),i=`${LT}/version/${o}/assets/`;return DT(i),i})();return FT(r),r}async function GT(e){const t=await Fm();return Qr(t,e)}function zT(){return Ux()}const Bi={init:jT,isReady:zT,base:Fm,url:GT},Hx=new Map;function UT(e){return Hx.get(e)}function HT(e,t){Hx.set(e,t);}const Wx="manifest.json";let qh=null;async function WT(){qh||(qh=await Vx());}function VT(){return qh!==null}async function Vx(e={}){const t=e.baseUrl??await Bi.base(),n=UT(t);if(n)return n;const r=$m(Qr(t,Wx));return HT(t,r),r}function qT(e,t){return e.bundles.find(n=>n.name===t)??null}function KT(e){if(!e)return [];const t=new Set;for(const n of e.assets)for(const r of n.src??[])typeof r=="string"&&r.endsWith(".json")&&r!==Wx&&t.add(r);return Array.from(t)}const Zr={init:WT,isReady:VT,load:Vx,getBundle:qT,listJsonFromBundle:KT},XT=ge,sr=XT.Object??Object,hp=sr.keys,Iu=sr.values,Pu=sr.entries,ly=new WeakSet;function YT(){return {data:{items:null,decor:null,mutations:null,eggs:null,pets:null,abilities:null,plants:null,weather:null},isHookInstalled:false,scanInterval:null,scanAttempts:0,weatherPollingTimer:null,weatherPollAttempts:0,colorPollingTimer:null,colorPollAttempts:0}}const $e=YT(),Xo={items:["WateringCan","PlanterPot","Shovel"],decor:["SmallRock","MediumRock","LargeRock","WoodBench","StoneBench","MarbleBench"],mutations:["Gold","Rainbow","Wet","Chilled","Frozen"],eggs:["CommonEgg","UncommonEgg","RareEgg"],pets:["Worm","Snail","Bee","Chicken","Bunny"],abilities:["ProduceScaleBoost","DoubleHarvest","SeedFinderI","CoinFinderI"],plants:["Carrot","Strawberry","Aloe","Blueberry","Apple"]},JT=["Rain","Frost","Thunderstorm","Dawn","AmberMoon"],cy=/main-[^/]+\.js(\?|$)/,QT=6,ZT=150,eI=2e3,tI=200,nI=50,rI=10,oI=1e3,Kh="ProduceScaleBoost",Yo=(e,t)=>t.every(n=>e.includes(n));function Jo(e,t){$e.data[e]==null&&($e.data[e]=t,Ru()&&Xx());}function Ru(){return Object.values($e.data).every(e=>e!=null)}function qx(e,t){if(!e||typeof e!="object"||ly.has(e))return;ly.add(e);let n;try{n=hp(e);}catch{return}if(!n||n.length===0)return;const r=e;let o;if(!$e.data.items&&Yo(n,Xo.items)&&(o=r.WateringCan,o&&typeof o=="object"&&"coinPrice"in o&&"creditPrice"in o&&Jo("items",r)),!$e.data.decor&&Yo(n,Xo.decor)&&(o=r.SmallRock,o&&typeof o=="object"&&"coinPrice"in o&&"creditPrice"in o&&Jo("decor",r)),!$e.data.mutations&&Yo(n,Xo.mutations)&&(o=r.Gold,o&&typeof o=="object"&&"baseChance"in o&&"coinMultiplier"in o&&Jo("mutations",r)),!$e.data.eggs&&Yo(n,Xo.eggs)&&(o=r.CommonEgg,o&&typeof o=="object"&&"faunaSpawnWeights"in o&&"secondsToHatch"in o&&Jo("eggs",r)),!$e.data.pets&&Yo(n,Xo.pets)&&(o=r.Worm,o&&typeof o=="object"&&"coinsToFullyReplenishHunger"in o&&"diet"in o&&Array.isArray(o.diet)&&Jo("pets",r)),!$e.data.abilities&&Yo(n,Xo.abilities)&&(o=r.ProduceScaleBoost,o&&typeof o=="object"&&"trigger"in o&&"baseParameters"in o&&Jo("abilities",r)),!$e.data.plants&&Yo(n,Xo.plants)&&(o=r.Carrot,o&&typeof o=="object"&&"seed"in o&&"plant"in o&&"crop"in o&&Jo("plants",r)),!(t>=QT))for(const i of n){let a;try{a=r[i];}catch{continue}a&&typeof a=="object"&&qx(a,t+1);}}function zd(e){try{qx(e,0);}catch{}}function Kx(){if(!$e.isHookInstalled){if(sr.__MG_HOOKED__){$e.isHookInstalled=true;return}sr.__MG_HOOKED__=true,$e.isHookInstalled=true;try{sr.keys=function(t){return zd(t),hp.apply(this,arguments)},Iu&&(sr.values=function(t){return zd(t),Iu.apply(this,arguments)}),Pu&&(sr.entries=function(t){return zd(t),Pu.apply(this,arguments)});}catch{}}}function Xx(){if($e.isHookInstalled){try{sr.keys=hp,Iu&&(sr.values=Iu),Pu&&(sr.entries=Pu);}catch{}$e.isHookInstalled=false;}}function iI(){if($e.scanInterval||Ru())return;const e=()=>{if(Ru()||$e.scanAttempts>ZT){Yx();return}$e.scanAttempts++;try{hp(ge).forEach(t=>{try{zd(ge[t]);}catch{}});}catch{}};e(),$e.scanInterval=setInterval(e,eI);}function Yx(){$e.scanInterval&&(clearInterval($e.scanInterval),$e.scanInterval=null);}const dy=ge;function aI(){try{for(const e of dy.document?.scripts||[]){const t=e?.src?String(e.src):"";if(cy.test(t))return t}}catch{}try{for(const e of dy.performance?.getEntriesByType?.("resource")||[]){const t=e?.name?String(e.name):"";if(cy.test(t))return t}}catch{}return null}function sI(e,t){const n=[];let r=e.indexOf(t);for(;r!==-1;)n.push(r),r=e.indexOf(t,r+t.length);return n}function gp(e,t){let n=0,r="",o=false;for(let i=t;i<e.length;i++){const a=e[i];if(r){if(o){o=false;continue}if(a==="\\"){o=true;continue}a===r&&(r="");continue}if(a==='"'||a==="'"||a==="`"){r=a;continue}if(a==="{")n++;else if(a==="}"&&--n===0)return e.slice(t,i+1)}return null}function lI(e,t){const n=Math.max(e.lastIndexOf("const ",t),e.lastIndexOf("let ",t),e.lastIndexOf("var ",t));if(n<0)return null;const r=e.indexOf("=",n);if(r<0||r>t)return null;const o=e.indexOf("{",r);return o<0||o>t?null:gp(e,o)}let Of=null,ys=null;async function Jx(){return Of||ys||(ys=(async()=>{const e=aI();if(!e)return null;try{const t=await fetch(e,{credentials:"include"});if(!t.ok)return null;const n=await t.text();return Of=n,n}catch{return null}finally{ys=null;}})(),ys)}function cI(e){const t={};let n=false;for(const r of JT){const o=e?.[r];if(!o||typeof o!="object")continue;const i=o.iconSpriteKey||null,{iconSpriteKey:a,...s}=o;t[r]={weatherId:r,spriteId:i,...s},n=true;}return t.Sunny||(t.Sunny={weatherId:"Sunny",name:"Sunny",spriteId:"sprite/ui/SunnyIcon",type:"primary"}),!n||t.Rain&&t.Rain.mutator?.mutation!=="Wet"?null:t}function dI(e,t){const n=Math.max(0,t-3e3),r=e.substring(n,t),o=/Rain:\{/,i=r.match(o);if(!i||i.index===void 0)return null;const a=n+i.index;let s=-1;for(let l=a-1;l>=Math.max(0,a-200);l--)if(e[l]==="{"){s=l;break}return s<0?null:gp(e,s)}function uI(e){return e.replace(/\[([A-Za-z_$][\w$]*\.)(Rain|Frost|Dawn|AmberMoon|Thunderstorm)\]/g,'"$2"').replace(/\b[A-Za-z_$][\w$]*\.(Hydro|Lunar)\b/g,'"$1"').replace(/\$t\.(Rain|Frost|Dawn|AmberMoon|Thunderstorm)\b/g,'"$1"').replace(/\b[A-Za-z_$][\w$]*\.(Rain|Frost|Dawn|AmberMoon|Thunderstorm)\b/g,'"$1"')}async function pI(){if($e.data.weather)return  true;const e=await Jx();if(!e)return  false;let t=e.indexOf("mutator");if(t<0&&(t=e.indexOf('name:"Amber Moon"')),t<0)return  false;const n=lI(e,t)??dI(e,t);if(!n)return  false;const r=uI(n);let o;try{o=Function('"use strict";return('+r+")")();}catch{return  false}const i=cI(o);return i?($e.data.weather=i,true):false}function fI(){if($e.weatherPollingTimer)return;$e.weatherPollAttempts=0;const e=setInterval(async()=>{(await pI()||++$e.weatherPollAttempts>tI)&&(clearInterval(e),$e.weatherPollingTimer=null);},nI);$e.weatherPollingTimer=e;}function hI(){$e.weatherPollingTimer&&(clearInterval($e.weatherPollingTimer),$e.weatherPollingTimer=null);}const gI={bg:"rgba(100, 100, 100, 0.9)",hover:"rgba(150, 150, 150, 1)"};function mI(e){const t=sI(e,Kh);if(!t.length)return null;for(const n of t){const r=Math.max(0,n-4e3),o=Math.min(e.length,n+4e3),a=e.slice(r,o).lastIndexOf("switch(");if(a===-1)continue;const s=r+a,l=e.indexOf("{",s);if(l===-1)continue;const c=gp(e,l);if(c&&c.includes(Kh)&&(c.includes('bg:"')||c.includes("bg:'")))return c}return null}function bI(e){const t={},n=[],r=/case\s*(['"])([^'"]+)\1\s*:|default\s*:|return\s*\{/g,o=(a,s)=>{const l=new RegExp(`${s}\\s*:\\s*(['"])([\\s\\S]*?)\\1`),c=a.match(l);return c?c[2]:null};let i;for(;(i=r.exec(e))!==null;){if(i[2]){n.push(i[2]);continue}const a=i[0];if(a.startsWith("default")){n.length=0;continue}if(!a.startsWith("return"))continue;const s=e.indexOf("{",i.index);if(s===-1){n.length=0;continue}const l=gp(e,s);if(!l){n.length=0;continue}const c=o(l,"bg");if(!c){n.length=0;continue}const d=o(l,"hover")||c;for(const u of n)t[u]||(t[u]={bg:c,hover:d});n.length=0;}return Object.keys(t).length?t:null}async function vI(){const e=await Jx();if(!e)return null;const t=mI(e);return t?bI(t):null}function yI(e){const t=e[Kh];return t!=null&&typeof t=="object"&&"color"in t}async function wI(){if(!$e.data.abilities)return  false;const e=$e.data.abilities;if(yI(e))return  true;const t=await vI();if(!t)return  false;const n={};for(const[r,o]of Object.entries(e)){const i=t[r]||gI;n[r]={...o,color:{bg:i.bg,hover:i.hover}};}return $e.data.abilities=n,console.log("[MGData] Enriched abilities with colors"),true}function xI(){if($e.colorPollingTimer)return;$e.colorPollAttempts=0;const e=setInterval(async()=>{(await wI()||++$e.colorPollAttempts>rI)&&(clearInterval(e),$e.colorPollingTimer=null);},oI);$e.colorPollingTimer=e;}function CI(){$e.colorPollingTimer&&(clearInterval($e.colorPollingTimer),$e.colorPollingTimer=null);}function SI(){return {ready:false,app:null,renderer:null,ctors:null,baseUrl:null,textures:new Map,animations:new Map,live:new Set,defaultParent:null,overlay:null,categoryIndex:null,keyToAtlasJson:new Map}}function _I(){return {lru:new Map,cost:0,srcCanvas:new Map}}function kI(){return {cache:new Map,maxEntries:200}}const EI={enabled:true,maxEntries:200,maxCost:800,srcCanvasMax:100},AI={enabled:true,maxEntries:200},Jt=SI(),TI=_I(),II={...EI},PI=kI(),RI={...AI};function Mt(){return Jt}function Fa(){return TI}function El(){return II}function Al(){return PI}function Xh(){return RI}function Qx(){return Jt.ready}const uy=Function.prototype.bind,ct={_bindPatched:false,engine:null,tos:null,app:null,renderer:null,ticker:null,stage:null};let Zx,eC,tC;const MI=new Promise(e=>{Zx=e;}),LI=new Promise(e=>{eC=e;}),OI=new Promise(e=>{tC=e;});function NI(e){return !!(e&&typeof e=="object"&&typeof e.start=="function"&&typeof e.destroy=="function"&&e.app&&e.app.stage&&e.app.renderer&&e.systems&&typeof e.systems.values=="function")}function $I(e){try{for(const t of e.systems.values()){const n=t?.system;if(n?.name==="tileObject")return n}}catch{}return null}function DI(e){ct.engine=e,ct.tos=$I(e)||null,ct.app=e.app||null,ct.renderer=e.app?.renderer||null,ct.ticker=e.app?.ticker||null,ct.stage=e.app?.stage||null;try{Zx(e);}catch{}try{ct.app&&eC(ct.app);}catch{}try{ct.renderer&&tC(ct.renderer);}catch{}}function Bm(){return ct.engine?true:(ct._bindPatched||(ct._bindPatched=true,Function.prototype.bind=function(e,...t){const n=uy.call(this,e,...t);try{!ct.engine&&NI(e)&&(Function.prototype.bind=uy,ct._bindPatched=!1,DI(e));}catch{}return n}),false)}Bm();async function FI(e=15e3){const t=performance.now();for(;performance.now()-t<e;){if(ct.engine)return  true;Bm(),await fp(50);}throw new Error("MGPixiHooks: engine capture timeout")}async function BI(e=15e3){return ct.engine||await FI(e),true}function jI(){return ct.engine&&ct.app?{ok:true,engine:ct.engine,tos:ct.tos,app:ct.app}:(Bm(),{ok:false,engine:ct.engine,tos:ct.tos,app:ct.app,note:"Not captured. Wait for room, or reload."})}const Vn={engineReady:MI,appReady:LI,rendererReady:OI,engine:()=>ct.engine,tos:()=>ct.tos,app:()=>ct.app,renderer:()=>ct.renderer,ticker:()=>ct.ticker,stage:()=>ct.stage,PIXI:()=>ge.PIXI||null,init:BI,hook:jI,ready:()=>!!ct.engine};function Mu(e){const t=String(e||"").trim();return t?t.startsWith("sprite/")||t.startsWith("sprites/")?t:t.includes("/")?`sprite/${t}`:t:""}function ac(e,t){const n=String(e||"").trim().replace(/^sprites?\//,"").replace(/^\/+|\/+$/g,""),r=String(t||"").trim();return r.includes("/")||!n?Mu(r):`sprite/${n}/${r}`}function Tl(e,t,n,r){const o=ac(e,t);if(n.has(o)||r.has(o))return o;const i=String(t||"").trim();if(n.has(i)||r.has(i))return i;const a=Mu(i);return n.has(a)||r.has(a)?a:o}function GI(e,t,n=25e3){const r=[e],o=new Set;let i=0;for(;r.length&&i++<n;){const a=r.pop();if(!a||o.has(a))continue;if(o.add(a),t(a))return a;const s=a.children;if(Array.isArray(s))for(let l=s.length-1;l>=0;l--)r.push(s[l]);}return null}function zI(e){const t=ge.PIXI;if(t?.Texture&&t?.Sprite&&t?.Container&&t?.Rectangle)return {Container:t.Container,Sprite:t.Sprite,Texture:t.Texture,Rectangle:t.Rectangle,AnimatedSprite:t.AnimatedSprite||null};const n=e?.stage,r=GI(n,o=>o?.texture?.frame&&o?.constructor&&o?.texture?.constructor&&o?.texture?.frame?.constructor);if(!r)throw new Error("No Sprite found yet (constructors).");return {Container:n.constructor,Sprite:r.constructor,Texture:r.texture.constructor,Rectangle:r.texture.frame.constructor,AnimatedSprite:t?.AnimatedSprite||null}}async function UI(e,t=15e3){const n=performance.now();for(;performance.now()-n<t;)try{return zI(e)}catch{await fp(50);}throw new Error("Constructors timeout")}const Qo=(...e)=>{try{console.log("[MGSprite]",...e);}catch{}};function HI(e){return e&&typeof e=="object"&&e.frames&&e.meta&&typeof e.meta.image=="string"}function Nf(e,t,n,r,o){return new e(t,n,r,o)}function WI(e,t,n,r,o,i,a){let s;try{s=new e({source:t.source,frame:n,orig:r,trim:o||void 0,rotate:i||0});}catch{s=new e(t.baseTexture||t,n,r,o||void 0,i||0);}if(a)if(s.defaultAnchor?.set)try{s.defaultAnchor.set(a.x,a.y);}catch{}else s.defaultAnchor?(s.defaultAnchor.x=a.x,s.defaultAnchor.y=a.y):s.defaultAnchor={x:a.x,y:a.y};try{s.updateUvs?.();}catch{}return s}function VI(e,t,n,r){const{Texture:o,Rectangle:i}=r;for(const[a,s]of Object.entries(e.frames)){const l=s.frame,c=!!s.rotated,d=c?2:0,u=c?l.h:l.w,f=c?l.w:l.h,g=Nf(i,l.x,l.y,u,f),h=s.sourceSize||{w:l.w,h:l.h},y=Nf(i,0,0,h.w,h.h);let S=null;if(s.trimmed&&s.spriteSourceSize){const C=s.spriteSourceSize;S=Nf(i,C.x,C.y,C.w,C.h);}n.set(a,WI(o,t,g,y,S,d,s.anchor||null));}}function qI(e,t,n){if(!(!e.animations||typeof e.animations!="object"))for(const[r,o]of Object.entries(e.animations)){if(!Array.isArray(o))continue;const i=o.map(a=>t.get(a)).filter(Boolean);i.length>=2&&n.set(r,i);}}function KI(e,t){const n=(r,o)=>{const i=String(r||"").trim(),a=String(o||"").trim();!i||!a||(t.has(i)||t.set(i,new Set),t.get(i).add(a));};for(const r of Object.keys(e.frames||{})){const o=/^sprite\/([^/]+)\/(.+)$/.exec(r);o&&n(o[1],o[2]);}}async function nC(e,t,n){const r=await Zr.load({baseUrl:e}),o=Zr.getBundle(r,"default");if(!o)throw new Error("No default bundle in manifest");const i=Zr.listJsonFromBundle(o),a=n?.onlyJsonPaths?.map(h=>String(h||"").trim()).filter(Boolean)??null,s=a&&a.length?i.filter(h=>a.includes(h)):i,l=new Set,c=new Map,d=new Map,u=new Map,f=new Map;async function g(h){if(l.has(h))return;l.add(h);const y=await $m(Qr(e,h));if(!HI(y))return;const S=y.meta?.related_multi_packs;if(Array.isArray(S))for(const P of S)await g(sy(h,P));const C=sy(h,y.meta.image),_=await OT(await jx(Qr(e,C))),E=t.Texture.from(_);VI(y,E,c,t),qI(y,c,d),KI(y,u);try{for(const P of Object.keys(y.frames||{}))typeof P=="string"&&P.startsWith("sprite/")&&f.set(P,h);}catch{}}for(const h of s)await g(h);return {textures:c,animations:d,categoryIndex:u,keyToAtlasJson:f}}let Vc=null;async function XI(){return Jt.ready?true:Vc||(Vc=(async()=>{const e=performance.now();Qo("init start");const t=await ay(Vn.appReady,15e3,"PIXI app");Qo("app ready");const n=await ay(Vn.rendererReady,15e3,"PIXI renderer");Qo("renderer ready"),Jt.app=t,Jt.renderer=n||t?.renderer||null,Jt.ctors=await UI(t),Qo("constructors resolved"),Jt.baseUrl=await Bi.base(),Qo("base url",Jt.baseUrl);const{textures:r,animations:o,categoryIndex:i,keyToAtlasJson:a}=await nC(Jt.baseUrl,Jt.ctors);return Jt.textures=r,Jt.animations=o,Jt.categoryIndex=i,Jt.keyToAtlasJson=a,Qo("atlases loaded","textures",Jt.textures.size,"animations",Jt.animations.size,"categories",Jt.categoryIndex?.size??0),Jt.ready=true,Qo("ready in",Math.round(performance.now()-e),"ms"),true})(),Vc)}const Ba={Gold:{overlayTall:null,tallIconOverride:null},Rainbow:{overlayTall:null,tallIconOverride:null,angle:130,angleTall:0},Wet:{overlayTall:"sprite/mutation-overlay/WetTallPlant",tallIconOverride:"sprite/mutation/Puddle"},Chilled:{overlayTall:"sprite/mutation-overlay/ChilledTallPlant",tallIconOverride:null},Frozen:{overlayTall:"sprite/mutation-overlay/FrozenTallPlant",tallIconOverride:null},Thunderstruck:{overlayTall:"sprite/mutation-overlay/ThunderstruckTallPlant",tallIconOverride:"sprite/mutation/ThunderstruckGround"},Dawnlit:{overlayTall:null,tallIconOverride:null},Ambershine:{overlayTall:null,tallIconOverride:null},Dawncharged:{overlayTall:null,tallIconOverride:null},Ambercharged:{overlayTall:null,tallIconOverride:null}},rC=Object.keys(Ba),YI=["Gold","Rainbow","Wet","Chilled","Frozen","Thunderstruck","Ambershine","Dawnlit","Dawncharged","Ambercharged"],py=new Map(YI.map((e,t)=>[e,t]));function Lu(e){return [...new Set(e.filter(Boolean))].sort((n,r)=>(py.get(n)??1/0)-(py.get(r)??1/0))}const JI=["Wet","Chilled","Frozen","Thunderstruck"],QI=new Set(["Dawnlit","Ambershine","Dawncharged","Ambercharged"]),ZI={Banana:.68,Beet:.65,Carrot:.6,Sunflower:.5,Starweaver:.5,FavaBean:.25,BurrosTail:.2},eP={Pepper:.6,Banana:.6},tP=256,nP=.5,rP=2;function oC(e){if(!e.length)return {muts:[],overlayMuts:[],selectedMuts:[],sig:""};const t=Lu(e),n=oP(e),r=iP(e);return {muts:n,overlayMuts:r,selectedMuts:t,sig:`${t.join(",")}|${n.join(",")}|${r.join(",")}`}}function oP(e){const t=e.filter((o,i,a)=>Ba[o]&&a.indexOf(o)===i);if(!t.length)return [];if(t.includes("Gold"))return ["Gold"];if(t.includes("Rainbow"))return ["Rainbow"];const n=["Ambershine","Dawnlit","Dawncharged","Ambercharged"];return t.some(o=>n.includes(o))?Lu(t.filter(o=>!JI.includes(o))):Lu(t)}function iP(e){const t=e.filter((n,r,o)=>Ba[n]?.overlayTall&&o.indexOf(n)===r);return Lu(t)}function $f(e,t){return e.map(n=>({name:n,meta:Ba[n],overlayTall:Ba[n]?.overlayTall??null,isTall:t}))}const aP={Gold:{op:"source-atop",colors:["rgb(235,200,0)"],a:.7},Rainbow:{op:"color",colors:["#FF1744","#FF9100","#FFEA00","#00E676","#2979FF","#D500F9"],ang:130,angTall:0,masked:true},Wet:{op:"source-atop",colors:["rgb(50,180,200)"],a:.25},Chilled:{op:"source-atop",colors:["rgb(100,160,210)"],a:.45},Frozen:{op:"source-atop",colors:["rgb(100,130,220)"],a:.5},Thunderstruck:{op:"source-atop",colors:["rgb(16, 141, 163)"],a:.4},Dawnlit:{op:"source-atop",colors:["rgb(209,70,231)"],a:.5},Ambershine:{op:"source-atop",colors:["rgb(190,100,40)"],a:.5},Dawncharged:{op:"source-atop",colors:["rgb(140,80,200)"],a:.5},Ambercharged:{op:"source-atop",colors:["rgb(170,60,25)"],a:.5}},qc=(()=>{try{const t=document.createElement("canvas").getContext("2d");if(!t)return new Set;const n=["color","hue","saturation","luminosity","overlay","screen","lighter","source-atop"],r=new Set;for(const o of n)t.globalCompositeOperation=o,t.globalCompositeOperation===o&&r.add(o);return r}catch{return new Set}})();function sP(e){return qc.has(e)?e:qc.has("overlay")?"overlay":qc.has("screen")?"screen":qc.has("lighter")?"lighter":"source-atop"}function lP(e,t,n,r,o=false){const i=(r-90)*Math.PI/180,a=t/2,s=n/2;if(!o){const u=Math.min(t,n)/2;return e.createLinearGradient(a-Math.cos(i)*u,s-Math.sin(i)*u,a+Math.cos(i)*u,s+Math.sin(i)*u)}const l=Math.cos(i),c=Math.sin(i),d=Math.abs(l)*t/2+Math.abs(c)*n/2;return e.createLinearGradient(a-l*d,s-c*d,a+l*d,s+c*d)}function fy(e,t,n,r,o=false){const i=r.colors?.length?r.colors:["#fff"],a=r.ang!=null?lP(e,t,n,r.ang,o):e.createLinearGradient(0,0,0,n);i.length===1?(a.addColorStop(0,i[0]),a.addColorStop(1,i[0])):i.forEach((s,l)=>a.addColorStop(l/(i.length-1),s)),e.fillStyle=a,e.fillRect(0,0,t,n);}function cP(e,t,n,r){const o=aP[n];if(!o)return;const i={...o};n==="Rainbow"&&r&&i.angTall!=null&&(i.ang=i.angTall);const a=n==="Rainbow"&&r,s=t.width,l=t.height;e.save();const c=i.masked?sP(i.op):"source-in";if(e.globalCompositeOperation=c,i.a!=null&&(e.globalAlpha=i.a),i.masked){const d=document.createElement("canvas");d.width=s,d.height=l;const u=d.getContext("2d");u.imageSmoothingEnabled=false,fy(u,s,l,i,a),u.globalCompositeOperation="destination-in",u.drawImage(t,0,0),e.drawImage(d,0,0);}else fy(e,s,l,i,a);e.restore();}function dP(e){return /tallplant/i.test(e)}function jm(e){const t=String(e||"").split("/");return t[t.length-1]||""}function iC(e){switch(e){case "Ambershine":return ["Ambershine","Amberlit"];case "Dawncharged":return ["Dawncharged","Dawnbound"];case "Ambercharged":return ["Ambercharged","Amberbound"];case "Thunderstruck":return ["Thunderstruck","ThunderstruckGround"];default:return [e]}}function uP(e,t){const n=String(e||"").toLowerCase();for(const r of t.keys()){const o=/sprite\/mutation-overlay\/([A-Za-z0-9]+)TallPlant/i.exec(String(r));if(!o||!o[1])continue;if(o[1].toLowerCase()===n){const a=t.get(r);if(a)return {tex:a,key:r}}}return null}function pP(e,t,n,r){if(!t)return null;const o=jm(e),i=iC(t);for(const a of i){const s=[`sprite/mutation/${a}${o}`,`sprite/mutation/${a}-${o}`,`sprite/mutation/${a}_${o}`,`sprite/mutation/${a}/${o}`,`sprite/mutation/${a}`];for(const l of s){const c=n.get(l);if(c)return {tex:c,key:l}}{const l=`sprite/mutation-overlay/${a}TallPlant`,c=n.get(l);if(c)return {tex:c,key:l};const d=`sprite/mutation-overlay/${a}`,u=n.get(d);if(u)return {tex:u,key:d};const f=uP(t,n);if(f)return f}}return null}function fP(e,t,n,r){if(!t)return null;const o=Ba[t];if(n&&o?.tallIconOverride){const s=r.get(o.tallIconOverride);if(s)return s}const i=jm(e),a=iC(t);for(const s of a){const l=[`sprite/mutation/${s}Icon`,`sprite/mutation/${s}`,`sprite/mutation/${s}${i}`,`sprite/mutation/${s}-${i}`,`sprite/mutation/${s}_${i}`,`sprite/mutation/${s}/${i}`];for(const c of l){const d=r.get(c);if(d)return d}if(n){const c=`sprite/mutation-overlay/${s}TallPlantIcon`,d=r.get(c);if(d)return d;const u=`sprite/mutation-overlay/${s}TallPlant`,f=r.get(u);if(f)return f}}return null}function hP(e,t,n){const r=e?.orig?.width??e?.frame?.width??e?.width??1,o=e?.orig?.height??e?.frame?.height??e?.height??1,i=e?.defaultAnchor?.x??0,a=e?.defaultAnchor?.y??0;let s=eP[t]??i;const l=o>r*1.5;let c=ZI[t]??(l?a:.4);const d={x:(s-i)*r,y:(c-a)*o},u=Math.min(r,o),f=Math.min(1.5,u/tP);let g=nP*f;return n&&(g*=rP),{width:r,height:o,anchorX:i,anchorY:a,offset:d,iconScale:g}}function aC(e,t){return `${t.sig}::${e}`}function sC(e){return e?e.isAnim?e.frames?.length||0:e.tex?1:0:0}function gP(e,t,n){e.lru.delete(t),e.lru.set(t,n);}function mP(e,t){if(t.enabled)for(;e.lru.size>t.maxEntries||e.cost>t.maxCost;){const n=e.lru.keys().next().value;if(n===void 0)break;const r=e.lru.get(n);e.lru.delete(n),e.cost=Math.max(0,e.cost-sC(r??null));}}function lC(e,t){const n=e.lru.get(t);return n?(gP(e,t,n),n):null}function cC(e,t,n,r){e.lru.set(t,n),e.cost+=sC(n),mP(e,r);}function bP(e){e.lru.clear(),e.cost=0,e.srcCanvas.clear();}function vP(e,t){return e.srcCanvas.get(t)??null}function yP(e,t,n,r){if(e.srcCanvas.set(t,n),e.srcCanvas.size>r.srcCanvasMax){const o=e.srcCanvas.keys().next().value;o!==void 0&&e.srcCanvas.delete(o);}}function mp(e,t,n,r,o){const i=vP(r,e);if(i)return i;let a=null;const s=t?.resolution??1;try{if(t?.extract?.canvas){const l=new n.Sprite(e),c=t.extract.canvas(l);if(l.destroy?.({children:!0,texture:!1,baseTexture:!1}),s>1&&c){const d=Math.round(c.width/s),u=Math.round(c.height/s);a=document.createElement("canvas"),a.width=d,a.height=u;const f=a.getContext("2d");f&&(f.imageSmoothingEnabled=!1,f.drawImage(c,0,0,d,u));}else a=c;}}catch{}if(!a){const l=e?.frame||e?._frame,c=e?.orig||e?._orig,d=e?.trim||e?._trim,u=e?.rotate||e?._rotate||0,f=e?.baseTexture?.resource?.source||e?.baseTexture?.resource||e?.source?.resource?.source||e?.source?.resource||e?._source?.resource?.source||null;if(!l||!f)throw new Error("textureToCanvas fail");a=document.createElement("canvas");const g=Math.max(1,(c?.width??l.width)|0),h=Math.max(1,(c?.height??l.height)|0),y=d?.x??0,S=d?.y??0;a.width=g,a.height=h;const C=a.getContext("2d");C.imageSmoothingEnabled=false,u===true||u===2||u===8?(C.save(),C.translate(y+l.height/2,S+l.width/2),C.rotate(-Math.PI/2),C.drawImage(f,l.x,l.y,l.width,l.height,-l.width/2,-l.height/2,l.width,l.height),C.restore()):C.drawImage(f,l.x,l.y,l.width,l.height,y,S,l.width,l.height);}return yP(r,e,a,o),a}function wP(e,t,n,r,o,i,a,s){const{w:l,h:c,aX:d,aY:u,basePos:f}=t,g=[];for(const h of n){const y=new r.Sprite(e);y.anchor?.set?.(d,u),y.position.set(f.x,f.y),y.zIndex=1;const S=document.createElement("canvas");S.width=l,S.height=c;const C=S.getContext("2d");C.imageSmoothingEnabled=false,C.save(),C.translate(l*d,c*u),C.drawImage(mp(e,o,r,i,a),-l*d,-c*u),C.restore(),cP(C,S,h.name,h.isTall);const _=r.Texture.from(S,{resolution:e.resolution??1});s.push(_),y.texture=_,g.push(y);}return g}function xP(e,t,n,r,o,i,a,s,l,c){const{aX:d,basePos:u}=t,f=[];for(const g of n){const h=g.overlayTall&&r.get(g.overlayTall)&&{tex:r.get(g.overlayTall),key:g.overlayTall}||pP(e,g.name,r);if(!h?.tex)continue;const y=mp(h.tex,i,o,a,s);if(!y)continue;const S=y.width,C={x:0,y:0},_={x:u.x-d*S,y:0},E=document.createElement("canvas");E.width=S,E.height=y.height;const P=E.getContext("2d");if(!P)continue;P.imageSmoothingEnabled=false,P.drawImage(y,0,0),P.globalCompositeOperation="destination-in",P.drawImage(l,-_.x,-0);const O=o.Texture.from(E,{resolution:h.tex.resolution??1});c.push(O);const k=new o.Sprite(O);k.anchor?.set?.(C.x,C.y),k.position.set(_.x,_.y),k.scale.set(1),k.alpha=1,k.zIndex=3,f.push(k);}return f}function CP(e,t,n,r,o,i){const{basePos:a}=t,s=[];for(const l of n){if(l.name==="Gold"||l.name==="Rainbow")continue;const c=fP(e,l.name,l.isTall,r);if(!c)continue;const d=new o.Sprite(c),u=c?.defaultAnchor?.x??.5,f=c?.defaultAnchor?.y??.5;d.anchor?.set?.(u,f),d.position.set(a.x+i.offset.x,a.y+i.offset.y),d.scale.set(i.iconScale),l.isTall&&(d.zIndex=-1),QI.has(l.name)&&(d.zIndex=10),d.zIndex||(d.zIndex=2),s.push(d);}return s}function dC(e,t,n,r){try{if(!e||!r.renderer||!r.ctors?.Container||!r.ctors?.Sprite||!r.ctors?.Texture)return null;const{Container:o,Sprite:i,Texture:a}=r.ctors,s=e?.orig?.width??e?.frame?.width??e?.width??1,l=e?.orig?.height??e?.frame?.height??e?.height??1,c=e?.defaultAnchor?.x??.5,d=e?.defaultAnchor?.y??.5,u={x:s*c,y:l*d},f=mp(e,r.renderer,r.ctors,r.cacheState,r.cacheConfig),g=new o;g.sortableChildren=!0;const h=new i(e);h.anchor?.set?.(c,d),h.position.set(u.x,u.y),h.zIndex=0,g.addChild(h);const y=dP(t),S=$f(n.muts,y),C=$f(n.overlayMuts,y),_=$f(n.selectedMuts,y),E=[],P={w:s,h:l,aX:c,aY:d,basePos:u},O=jm(t),k=hP(e,O,y);wP(e,P,S,r.ctors,r.renderer,r.cacheState,r.cacheConfig,E).forEach(H=>g.addChild(H)),y&&xP(t,P,C,r.textures,r.ctors,r.renderer,r.cacheState,r.cacheConfig,f,E).forEach(ce=>g.addChild(ce)),CP(t,P,_,r.textures,r.ctors,k).forEach(H=>g.addChild(H));let A={x:0,y:0,width:s,height:l};try{const H=g.getLocalBounds?.()||g.getBounds?.(!0);H&&Number.isFinite(H.width)&&Number.isFinite(H.height)&&(A={x:H.x,y:H.y,width:H.width,height:H.height});}catch{}const{Rectangle:L}=r.ctors,F=L?new L(0,0,s,l):void 0;let G=null;if(typeof r.renderer.generateTexture=="function"?G=r.renderer.generateTexture(g,{resolution:1,region:F}):r.renderer.textureGenerator?.generateTexture&&(G=r.renderer.textureGenerator.generateTexture({target:g,resolution:1,region:F})),!G)throw new Error("no render texture");const q=G instanceof a?G:a.from(r.renderer.extract.canvas(G));try{q.__mg_base={baseX:-A.x,baseY:-A.y,baseW:s,baseH:l,texW:A.width,texH:A.height};}catch{}G&&G!==q&&G.destroy?.(!0),g.destroy({children:!0,texture:!1,baseTexture:!1});try{q.__mg_gen=!0,q.label=`${t}|${n.sig}`;}catch{}return q}catch{return null}}function SP(e,t,n,r){if(!e||e.length<2)return null;const o=[];for(const i of e){const a=dC(i,t,n,r);a&&o.push(a);}return o.length>=2?o:null}function uC(e,t,n,r,o){const i=t.scale??1,a=t.frameIndex??0,s=t.mutations?.slice().sort().join(",")||"",l=t.anchorX??.5,c=t.anchorY??.5;return `${e}|s${i}|f${a}|m${s}|ax${l}|ay${c}|bm${n}|bp${o}|p${r}`}function _P(e,t){const n=e.cache.get(t);return n?(n.lastAccess=performance.now(),n.canvas):null}function kP(e,t,n,r){if(t.enabled){if(e.cache.size>=t.maxEntries){let o=null,i=1/0;for(const[a,s]of e.cache)s.lastAccess<i&&(i=s.lastAccess,o=a);o&&e.cache.delete(o);}e.cache.set(n,{canvas:r,lastAccess:performance.now()});}}function hy(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");return n&&n.drawImage(e,0,0),t}function EP(e){e.cache.clear();}function AP(e){return {size:e.cache.size,maxEntries:e.maxEntries}}function TP(){return new Promise(e=>{typeof requestIdleCallback<"u"?requestIdleCallback(()=>e(),{timeout:50}):setTimeout(e,0);})}async function IP(e,t,n,r,o,i,a,s=5,l=0){if(!t.ready||!i.enabled)return 0;const c=e.length;let d=0;a?.(0,c);for(let u=0;u<c;u+=s){const f=e.slice(u,u+s);for(const g of f)try{const h=Tl(null,g,t.textures,t.animations),y={scale:1},S=fC(y),C=hC(S,y),_=mC(S,y.boundsPadding),E=uC(h,y,S,C,_);o.cache.has(E)||Yh(t,n,r,null,g,y,o,i),d++;}catch{d++;}a?.(d,c),u+s<c&&await TP();}return d}function PP(e){if(e.overlay)return e.overlay;const t=new e.ctors.Container;t.sortableChildren=true,t.zIndex=99999999;try{e.app.stage.sortableChildren=!0;}catch{}return e.app.stage.addChild(t),e.overlay=t,t}function RP(e){const t=e.defaultParent;if(!t)return null;try{return typeof t=="function"?t():t}catch{return null}}function Gm(e,t,n,r,o,i){if(!n.length)return t;const a=oC(n);if(!a.sig)return t;const s=aC(e,a),l=lC(o,s);if(l?.tex)return l.tex;const c=dC(t,e,a,{renderer:r.renderer,ctors:r.ctors,textures:r.textures,cacheState:o,cacheConfig:i});return c?(cC(o,s,{isAnim:false,tex:c},i),c):t}function pC(e,t,n,r,o,i){if(!n.length)return t;const a=oC(n);if(!a.sig)return t;const s=aC(e,a),l=lC(o,s);if(l?.isAnim&&l.frames?.length)return l.frames;const c=SP(t,e,a,{renderer:r.renderer,ctors:r.ctors,textures:r.textures,cacheState:o,cacheConfig:i});return c?(cC(o,s,{isAnim:true,frames:c},i),c):t}function gy(e,t,n,r,o,i={}){if(!e.ready)throw new Error("MGSprite not ready yet");const a=Tl(r,o,e.textures,e.animations),s=i.mutations||[],l=i.parent||RP(e)||PP(e),c=e.renderer?.width||e.renderer?.view?.width||innerWidth,d=e.renderer?.height||e.renderer?.view?.height||innerHeight,u=i.center?c/2:i.x??c/2,f=i.center?d/2:i.y??d/2;let g;const h=e.animations.get(a);if(h&&h.length>=2){const C=pC(a,h,s,e,t,n),_=e.ctors.AnimatedSprite;if(_)g=new _(C),g.animationSpeed=i.fps?i.fps/60:i.speed??.15,g.loop=i.loop??true,g.play();else {const E=new e.ctors.Sprite(C[0]),O=1e3/Math.max(1,i.fps||8);let k=0,I=0;const R=A=>{const L=e.app.ticker?.deltaMS??A*16.666666666666668;if(k+=L,k<O)return;const F=k/O|0;k%=O,I=(I+F)%C.length,E.texture=C[I];};E.__mgTick=R,e.app.ticker?.add?.(R),g=E;}}else {const C=e.textures.get(a);if(!C)throw new Error(`Unknown sprite/anim key: ${a}`);const _=Gm(a,C,s,e,t,n);g=new e.ctors.Sprite(_);}const y=i.anchorX??g.texture?.defaultAnchor?.x??.5,S=i.anchorY??g.texture?.defaultAnchor?.y??.5;return g.anchor?.set?.(y,S),g.position.set(u,f),g.scale.set(i.scale??1),g.alpha=i.alpha??1,g.rotation=i.rotation??0,g.zIndex=i.zIndex??999999,l.addChild(g),e.live.add(g),g.__mgDestroy=()=>{try{g.__mgTick&&e.app.ticker?.remove?.(g.__mgTick);}catch{}try{g.destroy?.({children:!0,texture:!1,baseTexture:!1});}catch{try{g.destroy?.();}catch{}}e.live.delete(g);},g}function MP(e,t){const n=e.renderer;if(n?.extract?.canvas)return n.extract.canvas(t);if(n?.plugins?.extract?.canvas)return n.plugins.extract.canvas(t);throw new Error("No extract.canvas available on renderer")}function LP(e,t){const n=e.width,r=e.height;if(!n||!r)return e;const o=e.getContext("2d");if(!o)return e;let i=n,a=r,s=-1,l=-1;const d=o.getImageData(0,0,n,r).data;for(let S=0;S<r;S++){const C=S*n*4;for(let _=0;_<n;_++)d[C+_*4+3]!==0&&(_<i&&(i=_),S<a&&(a=S),_>s&&(s=_),S>l&&(l=S));}if(s<0||l<0)return e;const u=ia(t);if(i=Math.max(0,i-u),a=Math.max(0,a-u),s=Math.min(n-1,s+u),l=Math.min(r-1,l+u),i===0&&a===0&&s===n-1&&l===r-1)return e;const f=Math.max(1,s-i+1),g=Math.max(1,l-a+1),h=document.createElement("canvas");h.width=f,h.height=g;const y=h.getContext("2d");return y&&(y.imageSmoothingEnabled=false,y.drawImage(e,-i,-a)),h}const my=new Map;function fC(e){return e.boundsMode?e.boundsMode:(e.mutations&&e.mutations.length>0,"mutations")}function hC(e,t){return e==="mutations"?t.pad??2:t.pad??0}function ia(e){return Number.isFinite(e)?Math.max(0,e):0}function gC(e){if(typeof e=="number"){const t=ia(e);return {top:t,right:t,bottom:t,left:t}}return e?{top:ia(e.top??0),right:ia(e.right??0),bottom:ia(e.bottom??0),left:ia(e.left??0)}:{top:0,right:0,bottom:0,left:0}}function mC(e,t){if(e==="mutations")return "0,0,0,0";if(e==="padded"&&t==null)return "auto";const n=gC(t);return `${n.top},${n.right},${n.bottom},${n.left}`}function bC(e){const t=e?.orig?.width??e?.frame?.width??e?.width??1,n=e?.orig?.height??e?.frame?.height??e?.height??1;return {w:t,h:n}}function vC(e,t,n){const r=e?.__mg_base;return r&&Number.isFinite(r.baseX)&&Number.isFinite(r.baseY)&&Number.isFinite(r.baseW)&&Number.isFinite(r.baseH)&&Number.isFinite(r.texW)&&Number.isFinite(r.texH)?r:{baseX:0,baseY:0,baseW:t,baseH:n,texW:t,texH:n}}function OP(e,t,n,r,o,i){const a=`${e}|f${t}`,s=my.get(a);if(s)return s;const l=bC(n),c={top:0,right:0,bottom:0,left:0};for(const d of rC){const u=Gm(e,n,[d],r,o,i),f=vC(u,l.w,l.h),g=Math.max(0,f.baseX),h=Math.max(0,f.baseY),y=Math.max(0,f.texW-f.baseX-f.baseW),S=Math.max(0,f.texH-f.baseY-f.baseH);g>c.left&&(c.left=g),h>c.top&&(c.top=h),y>c.right&&(c.right=y),S>c.bottom&&(c.bottom=S);}return my.set(a,c),c}function Yh(e,t,n,r,o,i={},a,s){if(!e.ready)throw new Error("MGSprite not ready yet");const l=Tl(r,o,e.textures,e.animations),c=fC(i),d=hC(c,i),u=mC(c,i.boundsPadding),f=a&&s?.enabled?uC(l,i,c,d,u):null;if(f&&a&&s?.enabled){const E=_P(a,f);if(E)return hy(E)}const g=i.mutations||[],h=e.animations.get(l),y=Math.max(0,(i.frameIndex??0)|0);let S,C;if(h?.length)if(S=h[y%h.length],g.length){const E=pC(l,h,g,e,t,n);C=E[y%E.length];}else C=S;else {const E=e.textures.get(l);if(!E)throw new Error(`Unknown sprite/anim key: ${l}`);S=E,C=Gm(l,E,g,e,t,n);}let _;if(c==="mutations"){const E=new e.ctors.Sprite(C),P=i.anchorX??E.texture?.defaultAnchor?.x??.5,O=i.anchorY??E.texture?.defaultAnchor?.y??.5;E.anchor?.set?.(P,O),E.scale.set(i.scale??1);const k=new e.ctors.Container;k.addChild(E);try{k.updateTransform?.();}catch{}const I=E.getBounds?.(true)||{x:0,y:0,width:E.width,height:E.height};E.position.set(-I.x,-I.y),_=MP(e,k),_=LP(_,d);try{k.destroy?.({children:!0});}catch{}}else {const E=i.scale??1;let P=gC(i.boundsPadding);c==="padded"&&i.boundsPadding==null&&(P=OP(l,y,S,e,t,n)),d&&(P={top:P.top+d,right:P.right+d,bottom:P.bottom+d,left:P.left+d});const O=bC(S),k=vC(C,O.w,O.h),I=Math.max(1,Math.ceil((O.w+P.left+P.right)*E)),R=Math.max(1,Math.ceil((O.h+P.top+P.bottom)*E));_=document.createElement("canvas"),_.width=I,_.height=R;const A=_.getContext("2d");if(A){A.imageSmoothingEnabled=false;const L=mp(C,e.renderer,e.ctors,t,n),F=(P.left-k.baseX)*E,G=(P.top-k.baseY)*E;A.drawImage(L,F,G,L.width*E,L.height*E);}}return f&&a&&s?.enabled?(kP(a,s,f,_),hy(_)):_}function NP(e){for(const t of Array.from(e.live))t.__mgDestroy?.();}function $P(e,t){return e.defaultParent=t,true}function DP(e,t){return e.defaultParent=t,true}function ji(){if(!Qx())throw new Error("MGSprite not ready yet")}function FP(e,t,n){return typeof t=="string"?gy(Mt(),Fa(),El(),e,t,n||{}):gy(Mt(),Fa(),El(),null,e,t||{})}function BP(e,t,n){return typeof t=="string"?Yh(Mt(),Fa(),El(),e,t,n||{},Al(),Xh()):Yh(Mt(),Fa(),El(),null,e,t||{},Al(),Xh())}function jP(){NP(Mt());}function GP(e){return $P(Mt(),e)}function zP(e){return DP(Mt(),e)}function UP(e,t){const n=Mt(),r=typeof t=="string"?Tl(e,t,n.textures,n.animations):Tl(null,e,n.textures,n.animations);return n.textures.has(r)||n.animations.has(r)}function HP(){ji();const e=Mt().categoryIndex;return e?Array.from(e.keys()).sort((t,n)=>t.localeCompare(n)):[]}function WP(e){ji();const t=String(e||"").trim();if(!t)return [];const n=Mt().categoryIndex;return n?Array.from(n.get(t)?.values()||[]):[]}function VP(e,t){ji();const n=String(e||"").trim(),r=String(t||"").trim();if(!n||!r)return  false;const o=Mt().categoryIndex;if(!o)return  false;const i=n.toLowerCase(),a=r.toLowerCase();for(const[s,l]of o.entries())if(s.toLowerCase()===i){for(const c of l.values())if(c.toLowerCase()===a)return  true}return  false}function qP(e){ji();const t=Mt().categoryIndex;if(!t)return [];const n=String(e||"").trim().toLowerCase(),r=[];for(const[o,i]of t.entries())for(const a of i.values()){const s=ac(o,a);(!n||s.toLowerCase().startsWith(n))&&r.push(s);}return r.sort((o,i)=>o.localeCompare(i))}function KP(e){ji();const t=String(e||"").trim();if(!t)return null;const n=Mu(t),r=/^sprite\/([^/]+)\/(.+)$/.exec(n);if(!r)return null;const o=r[1],i=r[2],a=Mt().categoryIndex,s=o.toLowerCase(),l=i.toLowerCase();let c=o,d=i;if(a){const u=Array.from(a.keys()).find(h=>h.toLowerCase()===s);if(!u)return null;c=u;const f=a.get(u);if(!f)return null;const g=Array.from(f.values()).find(h=>h.toLowerCase()===l);if(!g)return null;d=g;}return {category:c,id:d,key:ac(c,d)}}function XP(e,t){ji();const n=String(e||"").trim(),r=String(t||"").trim();if(!n||!r)throw new Error("getIdPath(category, id) requires both category and id");const o=Mt().categoryIndex;if(!o)throw new Error("Sprite categories not indexed");const i=n.toLowerCase(),a=r.toLowerCase(),s=Array.from(o.keys()).find(d=>d.toLowerCase()===i)||n,l=o.get(s);if(!l)throw new Error(`Unknown sprite category: ${n}`);const c=Array.from(l.values()).find(d=>d.toLowerCase()===a)||r;if(!l.has(c))throw new Error(`Unknown sprite id: ${n}/${r}`);return ac(s,c)}function YP(){bP(Fa());}function JP(){EP(Al());}function QP(){return AP(Al())}function ZP(){return [...rC]}async function eR(e,t,n=10,r=0){return ji(),IP(e,Mt(),Fa(),El(),Al(),Xh(),t,n,r)}const me={init:XI,isReady:Qx,show:FP,toCanvas:BP,clear:jP,attach:GP,attachProvider:zP,has:UP,key:(e,t)=>ac(e,t),getCategories:HP,getCategoryId:WP,hasId:VP,listIds:qP,getIdInfo:KP,getIdPath:XP,clearMutationCache:YP,clearToCanvasCache:JP,getToCanvasCacheStats:QP,getMutationNames:ZP,warmup:eR,_internal:{getTexture:e=>{const t=String(e||"").trim();return t&&Mt().textures.get(t)||null},setTexture:(e,t)=>{const n=String(e||"").trim();if(!n)throw new Error("MGSprite._internal.setTexture: empty spriteId");Mt().textures.set(n,t);},hasTexture:e=>{const t=String(e||"").trim();return t?Mt().textures.has(t):false},getTextureSize:e=>{const t=String(e||"").trim();if(!t)return null;const n=Mt().textures.get(t);if(!n)return null;const r=n.frame,o=n.orig,i=Number(o?.width??r?.width??0),a=Number(o?.height??r?.height??0);return !Number.isFinite(i)||!Number.isFinite(a)||i<=0||a<=0?null:{w:i,h:a}},listLoadedKeys:()=>{const e=Mt(),t=new Set;for(const n of e.textures.keys())t.add(n);for(const n of e.animations.keys())t.add(n);return [...t.values()].sort((n,r)=>n.localeCompare(r))},ensureLoadedKeys:async e=>{const t=Array.isArray(e)?e.map(c=>String(c||"").trim()).filter(Boolean):[];if(!t.length)return 0;const n=Mt(),r=n.baseUrl,o=n.ctors,i=n.keyToAtlasJson;if(!r||!o||!i)return 0;const a=t.filter(c=>!n.textures.has(c)&&!n.animations.has(c));if(!a.length)return 0;const s=new Set;for(const c of a){const d=i.get(c);d&&s.add(d);}const l=await nC(r,o,s.size?{onlyJsonPaths:[...s]}:void 0);for(const[c,d]of l.textures)n.textures.set(c,d);for(const[c,d]of l.animations)n.animations.set(c,d);for(const[c,d]of l.categoryIndex){n.categoryIndex||(n.categoryIndex=new Map),n.categoryIndex.has(c)||n.categoryIndex.set(c,new Set);const u=n.categoryIndex.get(c);for(const f of d.values())u.add(f);}for(const[c,d]of l.keyToAtlasJson)i.set(c,d);return s.size||1}}};function tR(e){return String(e||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^A-Za-z0-9]/g,"").trim()}function nR(e,t=[]){const n=new Set,r=o=>{const i=String(o||"").trim();i&&n.add(i);};r(e);for(const o of t)r(o);for(const o of Array.from(n.values()))o.endsWith("s")?r(o.slice(0,-1)):r(`${o}s`),o.endsWith("es")&&r(o.slice(0,-2));return Array.from(n.values()).filter(Boolean)}function yC(e,t,n,r=[],o=[]){if(!me)return console.warn("[MGData] MGSprite not available in pickSpriteId"),null;const i=nR(e,r);if(!i.length)return null;const a=[t,...o].filter(d=>typeof d=="string"),s=d=>{const u=String(d||"").trim();if(!u)return null;for(const f of i)try{if(me.has(f,u))return me.getIdPath(f,u)}catch{}return null};for(const d of a){const u=s(d);if(u)return u}const l=tR(n||""),c=s(l||n||"");if(c)return c;try{for(const d of i){const u=me.listIds(`sprite/${d}/`),f=a.map(h=>String(h||"").toLowerCase()),g=String(n||l||"").toLowerCase();for(const h of u){const S=(h.split("/").pop()||"").toLowerCase();if(f.some(C=>C&&C===S)||S===g)return h}for(const h of u){const S=(h.split("/").pop()||"").toLowerCase();if(f.some(C=>C&&(S.includes(C)||C.includes(S)))||g&&(S.includes(g)||g.includes(S)))return h}}}catch{}return null}function zn(e,t,n,r,o=[],i=[]){if(!e||typeof e!="object")return;const a=e.tileRef;if(!a||typeof a!="object")return;const s=String(a.spritesheet||t||"").trim(),l=yC(s,n,r,o,i);if(l)try{e.spriteId=l;}catch{}const c=e.rotationVariants;if(c&&typeof c=="object")for(const d of Object.values(c))zn(d,s,n,r);if(e.immatureTileRef){const d={tileRef:e.immatureTileRef};zn(d,s,n,r),d.spriteId&&(e.immatureSpriteId=d.spriteId);}if(e.topmostLayerTileRef){const d={tileRef:e.topmostLayerTileRef};zn(d,s,n,r),d.spriteId&&(e.topmostLayerSpriteId=d.spriteId);}e.activeState&&typeof e.activeState=="object"&&zn(e.activeState,s,n,e.activeState?.name||r);}function rR(e,t,n,r=[]){if(!Array.isArray(t)||t.length===0)return null;const o=t[0],i=t.slice(1);return yC(e,o,n??null,r,i)}function oR(e){for(const[t,n]of Object.entries(e.items||{}))zn(n,"items",t,n?.name,["item"]);for(const[t,n]of Object.entries(e.decor||{}))zn(n,"decor",t,n?.name);for(const[t,n]of Object.entries(e.mutations||{})){zn(n,"mutations",t,n?.name,["mutation"]);const r=rR("mutation-overlay",[`${t}TallPlant`,`${t}TallPlantIcon`,t],n?.name,["mutation-overlay"]);if(r)try{n.overlaySpriteId=r;}catch{}}for(const[t,n]of Object.entries(e.eggs||{}))zn(n,"pets",t,n?.name,["pet"]);for(const[t,n]of Object.entries(e.pets||{}))zn(n,"pets",t,n?.name,["pet"]);for(const[t,n]of Object.entries(e.plants||{})){const r=n;r.seed&&zn(r.seed,r.seed?.tileRef?.spritesheet||"seeds",`${t}Seed`,r.seed?.name||`${t} Seed`,["seed","plant","plants"],[t]),r.plant&&zn(r.plant,r.plant?.tileRef?.spritesheet||"plants",`${t}Plant`,r.plant?.name||`${t} Plant`,["plant","plants","tallplants"],[t]),r.crop&&zn(r.crop,r.crop?.tileRef?.spritesheet||"plants",t,r.crop?.name||t,["plant","plants"],[`${t}Crop`]);}}function iR(){try{console.log("[MGData] Resolving sprites..."),oR($e.data),console.log("[MGData] Sprite resolution complete");}catch(e){try{console.warn("[MGData] sprite resolution failed",e);}catch{}}}const wC=5e3,xC=50;function CC(e){return new Promise(t=>setTimeout(t,e))}function aR(e){return $e.data[e]}function sR(){return {...$e.data}}function lR(e){return $e.data[e]!=null}async function cR(e,t=wC,n=xC){const r=Date.now();for(;Date.now()-r<t;){const o=$e.data[e];if(o!=null)return o;await CC(n);}throw new Error(`MGData.waitFor: timeout waiting for "${e}"`)}async function dR(e=wC,t=xC){const n=Date.now();for(;Date.now()-n<e;){if(Object.values($e.data).some(r=>r!=null))return {...$e.data};await CC(t);}throw new Error("MGData.waitForAnyData: timeout")}const SC=["CoinFinderI","CoinFinderII","CoinFinderIII","SeedFinderI","SeedFinderII","SeedFinderIII","SeedFinderIV","HungerRestore","HungerRestoreII","DoubleHarvest","DoubleHatch","ProduceEater","PetHatchSizeBoost","PetHatchSizeBoostII","PetAgeBoost","PetAgeBoostII","PetRefund","PetRefundII","ProduceRefund","SellBoostI","SellBoostII","SellBoostIII","SellBoostIV","GoldGranter","RainbowGranter","RainDance","PetXpBoost","PetXpBoostII","EggGrowthBoost","EggGrowthBoostII_NEW","EggGrowthBoostII","PlantGrowthBoost","PlantGrowthBoostII","ProduceScaleBoost","ProduceScaleBoostII"];function _C(e){return SC.includes(e)}function kC(e){return e.filter(t=>_C(t.action))}function by(e){const t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=Math.floor(e%60);return t>0?`${t}h ${n}m`:n>0?`${n}m ${r}s`:`${r}s`}function Df(e){return e?.name||e?.petSpecies||"Unknown Pet"}function EC(e){const{action:t,parameters:n}=e,r=n;switch(t){case "CoinFinderI":case "CoinFinderII":case "CoinFinderIII":return `Found ${r.coinsFound||0} coins`;case "SeedFinderI":case "SeedFinderII":case "SeedFinderIII":case "SeedFinderIV":return `Found 1× ${r.speciesId||"Unknown"} seed`;case "HungerRestore":case "HungerRestoreII":{const o=Df(r.targetPet),i=r.hungerRestoreAmount||0,s=r.pet?.id===r.targetPet?.id?"itself":o;return `Restored ${i} hunger to ${s}`}case "DoubleHarvest":return `Double harvested ${r.harvestedCrop?.species||"Unknown"}`;case "DoubleHatch":return `Double hatched ${r.extraPet?.petSpecies||"Unknown"}`;case "ProduceEater":{const o=r.growSlot?.species||"Unknown",i=r.sellPrice||0;return `Ate ${o} for ${i} coins`}case "PetHatchSizeBoost":case "PetHatchSizeBoostII":{const o=Df(r.targetPet),i=r.strengthIncrease||0;return `Boosted ${o}'s size by +${i.toFixed(0)}`}case "PetAgeBoost":case "PetAgeBoostII":{const o=Df(r.targetPet);return `Gave +${r.bonusXp||0} XP to ${o}`}case "PetRefund":case "PetRefundII":return `Refunded 1× ${r.eggId||"Unknown Egg"}`;case "ProduceRefund":{const o=r.cropsRefunded?.length||0;return `Refunded ${o} ${o===1?"crop":"crops"}`}case "SellBoostI":case "SellBoostII":case "SellBoostIII":case "SellBoostIV":return `Gave +${r.bonusCoins||0} bonus coins`;case "GoldGranter":case "RainbowGranter":case "RainDance":{const o=r.mutation||"Unknown";return `Made ${r.growSlot?.species||"Unknown"} turn ${o}`}case "PetXpBoost":case "PetXpBoostII":{const o=r.bonusXp||0,i=r.petsAffected?.length||0;return `Gave +${o} XP to ${i} ${i===1?"pet":"pets"}`}case "EggGrowthBoost":case "EggGrowthBoostII_NEW":case "EggGrowthBoostII":{const o=r.secondsReduced||0,i=r.eggsAffected?.length||0,a=by(o);return `Reduced ${i} ${i===1?"egg":"eggs"} growth by ${a}`}case "PlantGrowthBoost":case "PlantGrowthBoostII":{const o=r.secondsReduced||0,i=r.numPlantsAffected||0,a=by(o);return `Reduced ${i} ${i===1?"plant":"plants"} growth by ${a}`}case "ProduceScaleBoost":case "ProduceScaleBoostII":{const o=r.scaleIncreasePercentage||0,i=r.numPlantsAffected||0;return `Boosted ${i} ${i===1?"crop":"crops"} size by +${o.toFixed(0)}%`}default:return `Unknown ability: ${t}`}}const ue={async init(){Kx(),iI(),fI(),xI();},isReady:Ru,get:aR,getAll:sR,has:lR,waitFor:cR,waitForAny:dR,resolveSprites:iR,cleanup(){Xx(),Yx(),hI(),CI();}},uR=new Map;function pR(){return uR}function Jh(){return ge.jotaiAtomCache?.cache}function Lo(e){const t=pR(),n=t.get(e);if(n)return n;const r=Jh();if(!r)return null;for(const o of r.values())if((o?.debugLabel||o?.label||"")===e)return t.set(e,o),o;return null}function fR(){const e=ge;if(e.__REACT_DEVTOOLS_GLOBAL_HOOK__)return;const t=new Map,n=new Map;e.__REACT_DEVTOOLS_GLOBAL_HOOK__={renderers:t,supportsFiber:true,inject:r=>{const o=t.size+1;return t.set(o,r),n.set(o,new Set),o},onCommitFiberRoot:(r,o)=>{const i=n.get(r);i&&i.add(o);},onCommitFiberUnmount:()=>{},onPostCommitFiberRoot:()=>{},getFiberRoots:r=>n.get(r),checkDCE:()=>{},isDisabled:false};}const hR={baseStore:null,captureInProgress:false,captureError:null,lastCapturedVia:null,mirror:void 0};function Ja(){return hR}const gR="__JOTAI_STORE_READY__";let vy=false;const Qh=new Set;function Kc(){if(!vy){vy=true;for(const e of Qh)try{e();}catch{}try{const e=ge.CustomEvent||CustomEvent;ge.dispatchEvent?.(new e(gR));}catch{}}}function mR(e){Qh.add(e);const t=eg();if(t.via&&!t.polyfill)try{e();}catch{}return ()=>{Qh.delete(e);}}async function zm(e={}){const{timeoutMs:t=6e3,intervalMs:n=50}=e,r=eg();if(!(r.via&&!r.polyfill))return new Promise((o,i)=>{let a=false;const s=mR(()=>{a||(a=true,s(),o());}),l=Date.now();(async()=>{for(;!a&&Date.now()-l<t;){const d=eg();if(d.via&&!d.polyfill){if(a)return;a=true,s(),o();return}await Il(n);}a||(a=true,s(),i(new Error("Store not captured within timeout")));})();})}const Il=e=>new Promise(t=>setTimeout(t,e));function AC(){try{const e=ge.Event||Event;ge.dispatchEvent?.(new e("visibilitychange"));}catch{}}function Zh(e){return e&&typeof e=="object"&&typeof e.get=="function"&&typeof e.set=="function"&&typeof e.sub=="function"}function Ff(e,t=0,n=new WeakSet){if(t>3||!e||typeof e!="object"||n.has(e))return null;try{n.add(e);}catch{return null}if(Zh(e))return e;const r=["store","value","current","state","s","baseStore"];for(const o of r)try{const i=e[o];if(Zh(i))return i}catch{}return null}function TC(){const e=Ja(),t=ge.__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!t?.renderers?.size)return null;let n=0;for(const[r]of t.renderers){const o=t.getFiberRoots?.(r);o&&(n+=o.size||0);}if(n===0)return null;for(const[r]of t.renderers){const o=t.getFiberRoots?.(r);if(o)for(const i of o){const a=new Set,s=[i.current];for(;s.length;){const l=s.pop();if(!(!l||a.has(l))){a.add(l);try{const c=l?.pendingProps?.value;if(Zh(c))return e.lastCapturedVia="fiber",c}catch{}try{let c=l?.memoizedState,d=0;for(;c&&d<15;){d++;const u=Ff(c);if(u)return e.lastCapturedVia="fiber",u;const f=Ff(c.memoizedState);if(f)return e.lastCapturedVia="fiber",f;c=c.next;}}catch{}try{if(l?.stateNode){const c=Ff(l.stateNode);if(c)return e.lastCapturedVia="fiber",c}}catch{}l.child&&s.push(l.child),l.sibling&&s.push(l.sibling),l.alternate&&s.push(l.alternate);}}}}return null}function IC(){return {get:()=>{throw new Error("Store not captured: get unavailable")},set:()=>{throw new Error("Store not captured: set unavailable")},sub:()=>()=>{},__polyfill:true}}async function bR(e=5e3){const t=Date.now();let n=Jh();for(;!n&&Date.now()-t<e;)await Il(100),n=Jh();if(!n)throw new Error("jotaiAtomCache.cache not found");const r=Ja();let o=null,i=null;const a=[],s=()=>{for(const c of a)try{c.__origWrite&&(c.write=c.__origWrite,delete c.__origWrite);}catch{}};for(const c of n.values()){if(!c||typeof c.write!="function"||c.__origWrite)continue;const d=c.write;c.__origWrite=d,c.write=function(u,f,...g){return i||(o=u,i=f,s()),d.call(this,u,f,...g)},a.push(c);}AC();const l=Date.now();for(;!i&&Date.now()-l<e;)await Il(50);return i?(r.lastCapturedVia="write",{get:c=>o(c),set:(c,d)=>i(c,d),sub:(c,d)=>{let u;try{u=o(c);}catch{}const f=setInterval(()=>{let g;try{g=o(c);}catch{return}if(g!==u){u=g;try{d();}catch{}}},100);return ()=>clearInterval(f)}}):(s(),r.lastCapturedVia="polyfill",IC())}async function vR(e=1e4){const t=Ja();AC();const n=Date.now();for(;Date.now()-n<e;){const r=TC();if(r)return r;await Il(50);}return t.lastCapturedVia="polyfill",IC()}async function Um(){const e=Ja();if(e.baseStore&&!e.baseStore.__polyfill)return Kc(),e.baseStore;if(e.captureInProgress){const t=Date.now(),n=2500;for(;!e.baseStore&&Date.now()-t<n;)await Il(25);if(e.baseStore)return e.baseStore.__polyfill||Kc(),e.baseStore}e.captureInProgress=true;try{const t=TC();if(t)return e.baseStore=t,Kc(),t;try{const r=await bR(5e3);return e.baseStore=r,r.__polyfill||Kc(),r}catch(r){e.captureError=r;}const n=await vR();return e.baseStore=n,n}catch(t){throw e.captureError=t,t}finally{e.captureInProgress=false;}}function eg(){const e=Ja();return {via:e.lastCapturedVia,polyfill:!!e.baseStore?.__polyfill,error:e.captureError}}async function yR(){const e=await Um(),t=new WeakMap,n=async o=>{let i=t.get(o);if(i)return i;i={last:void 0,has:false,subs:new Set},t.set(o,i);try{i.last=e.get(o),i.has=!0;}catch{}const a=e.sub(o,()=>{let s;try{s=e.get(o);}catch{return}const l=i.last,c=!Object.is(s,l)||!i.has;if(i.last=s,i.has=true,c)for(const d of i.subs)try{d(s,l);}catch{}});return i.unsubUpstream=a,i};return {async get(o){const i=await n(o);if(i.has)return i.last;const a=e.get(o);return i.last=a,i.has=true,a},async set(o,i){await e.set(o,i);const a=await n(o);a.last=i,a.has=true;},async sub(o,i){const a=await n(o);if(a.subs.add(i),a.has)try{i(a.last,a.last);}catch{}return ()=>{a.subs.delete(i);}},getShadow(o){return t.get(o)?.last},hasShadow(o){return !!t.get(o)?.has},async ensureWatch(o){await n(o);},async asStore(){return {get:o=>this.get(o),set:(o,i)=>this.set(o,i),sub:(o,i)=>{let a=null;return this.sub(o,()=>i()).then(s=>a=s),()=>a?.()}}}}}async function Ud(){const e=Ja();return e.mirror||(e.mirror=await yR()),e.mirror}const rt={async select(e){const t=await Ud(),n=Lo(e);if(!n)throw new Error(`[Store] Atom not found: "${e}"`);return t.get(n)},async set(e,t){const n=await Ud(),r=Lo(e);if(!r)throw new Error(`[Store] Atom not found: "${e}"`);await n.set(r,t);},async subscribe(e,t){const n=await Ud(),r=Lo(e);if(!r)throw new Error(`[Store] Atom not found: "${e}"`);return n.sub(r,o=>{try{t(o);}catch{}})},async subscribeImmediate(e,t){const n=await rt.select(e);try{t(n);}catch{}return rt.subscribe(e,t)}};async function PC(){await Ud();}const sc=Object.freeze(Object.defineProperty({__proto__:null,Store:rt,prewarm:PC,waitForStore:zm},Symbol.toStringTag,{value:"Module"}));function Hm(e){return e?Array.isArray(e)?e.slice():e.split(".").map(t=>t.match(/^\d+$/)?Number(t):t):[]}function Pl(e,t){const n=Hm(t);let r=e;for(const o of n){if(r==null)return;r=r[o];}return r}function wR(e,t,n){const r=Hm(t);if(!r.length)return n;const o=Array.isArray(e)?[...e]:{...e??{}};let i=o;for(let a=0;a<r.length-1;a++){const s=r[a],l=i[s],c=typeof l=="object"&&l!==null?Array.isArray(l)?[...l]:{...l}:{};i[s]=c,i=c;}return i[r[r.length-1]]=n,o}function yy(e,t){const n={};for(const r of t)n[r]=r.includes(".")?Pl(e,r):e?.[r];try{return JSON.stringify(n)}catch{return String(n)}}function xR(e,t,n){const r=n.mode??"auto";function o(c){const d=t?Pl(c,t):c,u=new Map;if(d==null)return {signatures:u,keys:[]};const f=Array.isArray(d);if((r==="array"||r==="auto"&&f)&&f)for(let h=0;h<d.length;h++){const y=d[h],S=n.key?n.key(y,h,c):h,C=n.sig?n.sig(y,h,c):n.fields?yy(y,n.fields):JSON.stringify(y);u.set(S,C);}else for(const[h,y]of Object.entries(d)){const S=n.key?n.key(y,h,c):h,C=n.sig?n.sig(y,h,c):n.fields?yy(y,n.fields):JSON.stringify(y);u.set(S,C);}return {signatures:u,keys:Array.from(u.keys())}}function i(c,d){if(c===d)return  true;if(!c||!d||c.size!==d.size)return  false;for(const[u,f]of c)if(d.get(u)!==f)return  false;return  true}async function a(c){let d=null;return rt.subscribeImmediate(e,u=>{const f=t?Pl(u,t):u,{signatures:g}=o(f);if(!i(d,g)){const h=new Set([...d?Array.from(d.keys()):[],...Array.from(g.keys())]),y=[];for(const S of h){const C=d?.get(S)??"__NONE__",_=g.get(S)??"__NONE__";C!==_&&y.push(S);}d=g,c({value:f,changedKeys:y});}})}async function s(c,d){return a(({value:u,changedKeys:f})=>{f.includes(c)&&d({value:u});})}async function l(c,d){const u=new Set(c);return a(({value:f,changedKeys:g})=>{const h=g.filter(y=>u.has(y));h.length&&d({value:f,changedKeys:h});})}return {sub:a,subKey:s,subKeys:l}}const ha=new Map;function CR(e,t){const n=ha.get(e);if(n)try{n();}catch{}return ha.set(e,t),()=>{try{t();}catch{}ha.get(e)===t&&ha.delete(e);}}function gt(e,t={}){const{path:n,write:r="replace"}=t,o=n?`${e}:${Hm(n).join(".")}`:e;async function i(){const u=await rt.select(e);return n?Pl(u,n):u}async function a(u){if(typeof r=="function"){const h=await rt.select(e),y=r(u,h);return rt.set(e,y)}const f=await rt.select(e),g=n?wR(f,n,u):u;return r==="merge-shallow"&&!n&&f&&typeof f=="object"&&typeof u=="object"?rt.set(e,{...f,...u}):rt.set(e,g)}async function s(u){const f=await i(),g=u(f);return await a(g),g}async function l(u,f,g){let h;const y=C=>{const _=n?Pl(C,n):C;if(typeof h>"u"||!g(h,_)){const E=h;h=_,f(_,E);}},S=u?await rt.subscribeImmediate(e,y):await rt.subscribe(e,y);return CR(o,S)}function c(){const u=ha.get(o);if(u){try{u();}catch{}ha.delete(o);}}function d(u){return xR(e,u?.path??n,u)}return {label:o,get:i,set:a,update:s,onChange:(u,f=Object.is)=>l(false,u,f),onChangeNow:(u,f=Object.is)=>l(true,u,f),asSignature:d,stopOnChange:c}}function oe(e){return gt(e)}oe("positionAtom");oe("lastPositionInMyGardenAtom");oe("playerDirectionAtom");oe("stateAtom");oe("quinoaDataAtom");oe("currentTimeAtom");oe("actionAtom");oe("isPressAndHoldActionAtom");oe("mapAtom");oe("tileSizeAtom");gt("mapAtom",{path:"cols"});gt("mapAtom",{path:"rows"});gt("mapAtom",{path:"spawnTiles"});gt("mapAtom",{path:"locations.seedShop.spawnTileIdx"});gt("mapAtom",{path:"locations.eggShop.spawnTileIdx"});gt("mapAtom",{path:"locations.toolShop.spawnTileIdx"});gt("mapAtom",{path:"locations.decorShop.spawnTileIdx"});gt("mapAtom",{path:"locations.sellCropsShop.spawnTileIdx"});gt("mapAtom",{path:"locations.sellPetShop.spawnTileIdx"});gt("mapAtom",{path:"locations.collectorsClub.spawnTileIdx"});gt("mapAtom",{path:"locations.wishingWell.spawnTileIdx"});gt("mapAtom",{path:"locations.shopsCenter.spawnTileIdx"});oe("playerAtom");oe("myDataAtom");oe("myUserSlotIdxAtom");oe("isSpectatingAtom");oe("myCoinsCountAtom");oe("numPlayersAtom");gt("playerAtom",{path:"id"});gt("myDataAtom",{path:"activityLogs"});oe("userSlotsAtom");oe("filteredUserSlotsAtom");oe("myUserSlotAtom");oe("spectatorsAtom");gt("stateAtom",{path:"child"});gt("stateAtom",{path:"child.data"});gt("stateAtom",{path:"child.data.shops"});const SR=gt("stateAtom",{path:"child.data.userSlots"}),_R=gt("stateAtom",{path:"data.players"}),kR=gt("stateAtom",{path:"data.hostPlayerId"});oe("myInventoryAtom");oe("myInventoryItemsAtom");oe("isMyInventoryAtMaxLengthAtom");oe("myFavoritedItemIdsAtom");oe("myCropInventoryAtom");oe("mySeedInventoryAtom");oe("myToolInventoryAtom");oe("myEggInventoryAtom");oe("myDecorInventoryAtom");oe("myPetInventoryAtom");gt("myInventoryAtom",{path:"favoritedItemIds"});oe("itemTypeFiltersAtom");oe("myItemStoragesAtom");oe("myPetHutchStoragesAtom");oe("myPetHutchItemsAtom");oe("myPetHutchPetItemsAtom");oe("myNumPetHutchItemsAtom");oe("myValidatedSelectedItemIndexAtom");oe("isSelectedItemAtomSuspended");oe("mySelectedItemAtom");oe("mySelectedItemNameAtom");oe("mySelectedItemRotationsAtom");oe("mySelectedItemRotationAtom");oe("setSelectedIndexToEndAtom");oe("myPossiblyNoLongerValidSelectedItemIndexAtom");oe("myCurrentGlobalTileIndexAtom");oe("myCurrentGardenTileAtom");oe("myCurrentGardenObjectAtom");oe("myOwnCurrentGardenObjectAtom");oe("myOwnCurrentDirtTileIndexAtom");oe("myCurrentGardenObjectNameAtom");oe("isInMyGardenAtom");oe("myGardenBoardwalkTileObjectsAtom");const ER=gt("myDataAtom",{path:"garden"});gt("myDataAtom",{path:"garden.tileObjects"});gt("myOwnCurrentGardenObjectAtom",{path:"objectType"});oe("myCurrentStablePlantObjectInfoAtom");oe("myCurrentSortedGrowSlotIndicesAtom");oe("myCurrentGrowSlotIndexAtom");oe("myCurrentGrowSlotsAtom");oe("myCurrentGrowSlotAtom");oe("secondsUntilCurrentGrowSlotMaturesAtom");oe("isCurrentGrowSlotMatureAtom");oe("numGrowSlotsAtom");oe("myCurrentEggAtom");oe("petInfosAtom");oe("myPetInfosAtom");oe("myPetSlotInfosAtom");oe("myPrimitivePetSlotsAtom");oe("myNonPrimitivePetSlotsAtom");oe("expandedPetSlotIdAtom");oe("myPetsProgressAtom");oe("myActiveCropMutationPetsAtom");oe("totalPetSellPriceAtom");oe("selectedPetHasNewVariantsAtom");const AR=oe("shopsAtom"),TR=oe("myShopPurchasesAtom");oe("seedShopAtom");oe("seedShopInventoryAtom");oe("seedShopRestockSecondsAtom");oe("seedShopCustomRestockInventoryAtom");oe("eggShopAtom");oe("eggShopInventoryAtom");oe("eggShopRestockSecondsAtom");oe("eggShopCustomRestockInventoryAtom");oe("toolShopAtom");oe("toolShopInventoryAtom");oe("toolShopRestockSecondsAtom");oe("toolShopCustomRestockInventoryAtom");oe("decorShopAtom");oe("decorShopInventoryAtom");oe("decorShopRestockSecondsAtom");oe("decorShopCustomRestockInventoryAtom");oe("isDecorShopAboutToRestockAtom");gt("shopsAtom",{path:"seed"});gt("shopsAtom",{path:"tool"});gt("shopsAtom",{path:"egg"});gt("shopsAtom",{path:"decor"});oe("myCropItemsAtom");oe("myCropItemsToSellAtom");oe("totalCropSellPriceAtom");oe("friendBonusMultiplierAtom");oe("myJournalAtom");oe("myCropJournalAtom");oe("myPetJournalAtom");oe("myStatsAtom");oe("myActivityLogsAtom");oe("newLogsAtom");oe("hasNewLogsAtom");oe("newCropLogsFromSellingAtom");oe("hasNewCropLogsFromSellingAtom");oe("myCompletedTasksAtom");oe("myActiveTasksAtom");oe("isWelcomeToastVisibleAtom");oe("shouldCloseWelcomeToastAtom");oe("isInitialMoveToDirtPatchToastVisibleAtom");oe("isFirstPlantSeedActiveAtom");oe("isThirdSeedPlantActiveAtom");oe("isThirdSeedPlantCompletedAtom");oe("isDemoTouchpadVisibleAtom");oe("areShopAnnouncersEnabledAtom");oe("arePresentablesEnabledAtom");oe("isEmptyDirtTileHighlightedAtom");oe("isPlantTileHighlightedAtom");oe("isItemHiglightedInHotbarAtom");oe("isItemHighlightedInModalAtom");oe("isMyGardenButtonHighlightedAtom");oe("isSellButtonHighlightedAtom");oe("isShopButtonHighlightedAtom");oe("isInstaGrowButtonHiddenAtom");oe("isActionButtonHighlightedAtom");oe("isGardenItemInfoCardHiddenAtom");oe("isSeedPurchaseButtonHighlightedAtom");oe("isFirstSeedPurchaseActiveAtom");oe("isFirstCropHarvestActiveAtom");oe("isWeatherStatusHighlightedAtom");oe("weatherAtom");const bp=oe("activeModalAtom");oe("hotkeyBeingPressedAtom");oe("avatarTriggerAnimationAtom");oe("avatarDataAtom");oe("emoteDataAtom");oe("otherUserSlotsAtom");oe("otherPlayerPositionsAtom");oe("otherPlayerSelectedItemsAtom");oe("otherPlayerLastActionsAtom");oe("traderBunnyPlayerId");oe("npcPlayersAtom");oe("npcQuinoaUsersAtom");oe("numNpcAvatarsAtom");oe("traderBunnyEmoteTimeoutAtom");oe("traderBunnyEmoteAtom");oe("unsortedLeaderboardAtom");oe("currentGardenNameAtom");oe("quinoaEngineAtom");oe("quinoaInitializationErrorAtom");oe("avgPingAtom");oe("serverClientTimeOffsetAtom");oe("isEstablishingShotRunningAtom");oe("isEstablishingShotCompleteAtom");const ot={initialized:false,activeModal:null,isCustom:false,shadow:null,patchedAtoms:new Set,originalReads:new Map,unsubscribes:[],listeners:{onOpen:new Set,onClose:new Set}};function vp(){return ot}function IR(){return ot.initialized}function Gi(){return ot.isCustom&&ot.activeModal!==null}function Mi(){return ot.activeModal}function RC(e){return !ot.shadow||ot.shadow.modal!==e?null:ot.shadow.data}function PR(e){ot.initialized=e;}function Wm(e){ot.activeModal=e;}function Vm(e){ot.isCustom=e;}function MC(e,t){ot.shadow={modal:e,data:t,timestamp:Date.now()};}function LC(){ot.shadow=null;}function wy(e,t){ot.patchedAtoms.add(e),ot.originalReads.set(e,t);}function RR(e){return ot.originalReads.get(e)}function tg(e){return ot.patchedAtoms.has(e)}function MR(e){ot.patchedAtoms.delete(e),ot.originalReads.delete(e);}function LR(e){ot.unsubscribes.push(e);}function OR(){for(const e of ot.unsubscribes)try{e();}catch{}ot.unsubscribes.length=0;}function NR(e){return ot.listeners.onOpen.add(e),()=>ot.listeners.onOpen.delete(e)}function OC(e){return ot.listeners.onClose.add(e),()=>ot.listeners.onClose.delete(e)}function NC(e){for(const t of Array.from(ot.listeners.onOpen))try{t(e);}catch{}}function qm(e){for(const t of Array.from(ot.listeners.onClose))try{t(e);}catch{}}function $R(){OR(),ot.initialized=false,ot.activeModal=null,ot.isCustom=false,ot.shadow=null,ot.patchedAtoms.clear(),ot.originalReads.clear(),ot.listeners.onOpen.clear(),ot.listeners.onClose.clear();}const Km={inventory:{atoms:[{atomLabel:"myInventoryAtom",dataKey:"_full",transform:e=>{const t=e;return {items:t.items??[],storages:t.storages??[],favoritedItemIds:t.favoritedItemIds??[]}}}],derivedAtoms:[{atomLabel:"myCropInventoryAtom",sourceKey:"items",deriveFn:e=>Array.isArray(e)?e.filter(t=>t.itemType==="Produce"):[]},{atomLabel:"mySeedInventoryAtom",sourceKey:"items",deriveFn:e=>Array.isArray(e)?e.filter(t=>t.itemType==="Seed"):[]},{atomLabel:"myToolInventoryAtom",sourceKey:"items",deriveFn:e=>Array.isArray(e)?e.filter(t=>t.itemType==="Tool"):[]},{atomLabel:"myEggInventoryAtom",sourceKey:"items",deriveFn:e=>Array.isArray(e)?e.filter(t=>t.itemType==="Egg"):[]},{atomLabel:"myDecorInventoryAtom",sourceKey:"items",deriveFn:e=>Array.isArray(e)?e.filter(t=>t.itemType==="Decor"):[]},{atomLabel:"myPetInventoryAtom",sourceKey:"items",deriveFn:e=>Array.isArray(e)?e.filter(t=>t.itemType==="Pet"):[]}]},journal:{atoms:[{atomLabel:"myJournalAtom",dataKey:"_full"}],derivedAtoms:[{atomLabel:"myCropJournalAtom",sourceKey:"produce",deriveFn:e=>e??{}},{atomLabel:"myPetJournalAtom",sourceKey:"pets",deriveFn:e=>e??{}}]},stats:{atoms:[{atomLabel:"myStatsAtom",dataKey:"_full"}]},activityLog:{atoms:[{atomLabel:"myActivityLogsAtom",dataKey:"logs"}]},seedShop:{atoms:[{atomLabel:"seedShopInventoryAtom",dataKey:"inventory"},{atomLabel:"seedShopRestockSecondsAtom",dataKey:"secondsUntilRestock",transform:e=>e??0}]},eggShop:{atoms:[{atomLabel:"eggShopInventoryAtom",dataKey:"inventory"},{atomLabel:"eggShopRestockSecondsAtom",dataKey:"secondsUntilRestock",transform:e=>e??0}]},toolShop:{atoms:[{atomLabel:"toolShopInventoryAtom",dataKey:"inventory"},{atomLabel:"toolShopRestockSecondsAtom",dataKey:"secondsUntilRestock",transform:e=>e??0}]},decorShop:{atoms:[{atomLabel:"decorShopInventoryAtom",dataKey:"inventory"},{atomLabel:"decorShopRestockSecondsAtom",dataKey:"secondsUntilRestock",transform:e=>e??0}]},leaderboard:{atoms:[{atomLabel:"unsortedLeaderboardAtom",dataKey:"entries"}]},petHutch:{atoms:[{atomLabel:"myPetHutchItemsAtom",dataKey:"items"},{atomLabel:"myPetHutchPetItemsAtom",dataKey:"petItems"}]}};function $C(e){return Km[e]}function DR(e){const t=Km[e],n=[];for(const r of t.atoms)n.push(r.atomLabel);if(t.derivedAtoms)for(const r of t.derivedAtoms)n.push(r.atomLabel);return n}const FR=new Set(["inventory","journal","stats","activityLog","petHutch"]),BR=new Set(["seedShop","eggShop","toolShop","decorShop"]),jR=new Set(["leaderboard"]);function GR(e,t,n,r){return function(i){const a=Gi(),s=Mi();if(a&&s===r){const l=RC(r);if(l!==null){let c;if(n.dataKey==="_full"?c=l:c=l[n.dataKey],c!==void 0)return t(i),n.transform?n.transform(c):c}}return t(i)}}function zR(e,t,n,r,o){return function(a){if(Gi()&&Mi()===o){const s=RC(o);if(s!==null){const l=s[n];if(l!==void 0)return t(a),r(l)}}return t(a)}}function UR(e){const t=$C(e);for(const n of t.atoms){const r=Lo(n.atomLabel);if(!r||tg(n.atomLabel))continue;const o=r.read;if(typeof o!="function")continue;const i=GR(n.atomLabel,o,n,e);r.read=i,wy(n.atomLabel,o);}if(t.derivedAtoms)for(const n of t.derivedAtoms){const r=Lo(n.atomLabel);if(!r||tg(n.atomLabel))continue;const o=r.read;if(typeof o!="function")continue;const i=zR(n.atomLabel,o,n.sourceKey,n.deriveFn,e);r.read=i,wy(n.atomLabel,o);}}async function yp(e){const t=$C(e);for(const r of t.atoms)xy(r.atomLabel);if(t.derivedAtoms)for(const r of t.derivedAtoms)xy(r.atomLabel);const n=await Um();await DC(n,e);}async function HR(e){const t=await Um();await DC(t,e);const n=DR(e);for(const r of n){const o=Lo(r);if(o)try{t.get(o);}catch{}}}function xy(e){if(!tg(e))return;const t=Lo(e),n=RR(e);t&&n&&(t.read=n),MR(e);}async function DC(e,t){const n=FR.has(t),r=BR.has(t),o=jR.has(t);if(!n&&!r&&!o)return;const i=Lo("stateAtom");if(i)try{const a=e.get(i);if(!a||typeof a!="object")return;let s=null;if(n||r){const l=a.child,c=l?.data;if(l&&c&&typeof c=="object"){let d=null;if(n&&Array.isArray(c.userSlots)){const u=c.userSlots.map(f=>{if(!f||typeof f!="object")return f;const g=f,h=g.data,y=h&&typeof h=="object"?{...h}:h;return {...g,data:y}});d={...d??c,userSlots:u};}if(r&&c.shops&&typeof c.shops=="object"&&(d={...d??c,shops:{...c.shops}}),d){const u={...l,data:d};s={...a,child:u};}}}if(o){const l=a.data;if(l&&Array.isArray(l.players)){const c={...l,players:[...l.players]};s={...s??a,data:c};}}if(!s)return;await e.set(i,s);}catch{}}async function WR(){for(const e of Object.keys(Km))await yp(e);}let Xc=null,sl=null;async function VR(){if(vp().initialized)return;sl=await rt.select("activeModalAtom"),Xc=setInterval(async()=>{try{const n=await rt.select("activeModalAtom"),r=sl;r!==n&&(sl=n,qR(n,r));}catch{}},50),LR(()=>{Xc&&(clearInterval(Xc),Xc=null);}),PR(true);}function qR(e,t){const n=Gi(),r=Mi();e===null&&t!==null&&(n&&r===t?KR("native"):n||qm({modal:t,wasCustom:false,closedBy:"native"})),e!==null&&!n&&NC({modal:e,isCustom:false});}async function KR(e){const t=Mi();t&&(LC(),Vm(false),Wm(null),await yp(t),qm({modal:t,wasCustom:true,closedBy:e}));}async function XR(e,t){if(!vp().initialized)throw new Error("[MGCustomModal] Not initialized. Call init() first.");Gi()&&await FC(),MC(e,t),Vm(true),Wm(e),UR(e),await HR(e),await bp.set(e),sl=e,NC({modal:e,isCustom:true});}function YR(e,t){const n=vp();if(!n.isCustom||n.activeModal!==e||!n.shadow)return;const o={...n.shadow.data,...t};MC(e,o);}async function FC(){const e=vp();if(!e.isCustom||!e.activeModal)return;const t=e.activeModal;LC(),Vm(false),Wm(null),await bp.set(null),sl=null,await yp(t),qm({modal:t,wasCustom:true,closedBy:"api"});}function JR(){return new Promise(e=>{if(!Gi()){e();return}const t=OC(()=>{t(),e();});})}async function QR(){if(Gi()){const e=Mi();e&&await yp(e);}await WR(),$R();}const eo={async init(){return VR()},isReady(){return IR()},async show(e,t){return XR(e,t)},update(e,t){return YR(e,t)},async close(){return FC()},isOpen(){return Mi()!==null},isCustomOpen(){return Gi()},getActiveModal(){return Mi()},waitForClose(){return JR()},onOpen(e){return NR(e)},onClose(e){return OC(e)},async destroy(){return QR()}};function ZR(){return {ready:false,xform:null,xformAt:0}}const qn=ZR();function BC(){return qn.ready}function Qa(e){try{if(typeof structuredClone=="function")return structuredClone(e)}catch{}try{return JSON.parse(JSON.stringify(e))}catch{}return e}function lc(){return Vn.tos()}function Xm(){return Vn.engine()}function e2(){const e=lc()?.map?.cols;return Number.isFinite(e)&&e>0?e:null}function Ym(e,t){const n=e2();return n?t*n+e|0:null}let Yc=null;async function t2(e=15e3){return qn.ready?true:Yc||(Yc=(async()=>{if(await Vn.init(e),!lc())throw new Error("MGTile: engine captured but tileObject system not found");return qn.ready=true,true})(),Yc)}function _i(e,t,n=true){const r=lc(),o=Ym(e,t);if(!r||o==null)return {gidx:null,tv:null};let i=r.tileViews?.get?.(o)||null;if(!i&&n&&typeof r.getOrCreateTileView=="function")try{i=r.getOrCreateTileView(o);}catch{}return {gidx:o,tv:i||null}}function Bf(e,t){if("startTime"in t&&(e.startTime=Number(t.startTime)),"endTime"in t&&(e.endTime=Number(t.endTime)),"targetScale"in t&&(e.targetScale=Number(t.targetScale)),"mutations"in t){if(!Array.isArray(t.mutations))throw new Error("MGTile: mutations must be an array of strings");e.mutations=t.mutations.slice();}}function Jm(e,t){if(!e)throw new Error("MGTile: no tileObject on this tile");if(e.objectType!==t)throw new Error(`MGTile: expected objectType "${t}", got "${e.objectType}"`)}function xa(e,t,n,r={}){const o=r.ensureView!==false,i=r.forceUpdate!==false,a=Xm(),{gidx:s,tv:l}=_i(Number(e),Number(t),o);if(s==null)throw new Error("MGTile: cols unavailable (engine/TOS not ready)");if(!l)throw new Error("MGTile: TileView unavailable (not instantiated)");const c=l.tileObject;if(typeof l.onDataChanged!="function")throw new Error("MGTile: tileView.onDataChanged not found (different API?)");if(l.onDataChanged(n),i&&a?.reusableContext&&typeof l.update=="function")try{l.update(a.reusableContext);}catch{}return {ok:true,tx:Number(e),ty:Number(t),gidx:s,before:c,after:l.tileObject}}function wp(e,t,n={}){const r=n.ensureView!==false,o=n.clone!==false,{gidx:i,tv:a}=_i(Number(e),Number(t),r);if(i==null)throw new Error("MGTile: cols unavailable (engine not ready)");if(!a)return {tx:Number(e),ty:Number(t),gidx:i,tileView:null,tileObject:void 0};const s=a.tileObject;return {tx:Number(e),ty:Number(t),gidx:i,tileView:a,tileObject:o?Qa(s):s}}function n2(e,t,n={}){return xa(e,t,null,n)}function r2(e,t,n,r={}){const i=wp(e,t,{...r,clone:false}).tileView?.tileObject;Jm(i,"plant");const a=Qa(i);if(Array.isArray(a.slots)||(a.slots=[]),"plantedAt"in n&&(a.plantedAt=Number(n.plantedAt)),"maturedAt"in n&&(a.maturedAt=Number(n.maturedAt)),"species"in n&&(a.species=String(n.species)),"slotIdx"in n&&"slotPatch"in n){const s=Number(n.slotIdx)|0;if(!a.slots[s])throw new Error(`MGTile: plant slot ${s} doesn't exist`);return Bf(a.slots[s],n.slotPatch),xa(e,t,a,r)}if("slots"in n){const s=n.slots;if(Array.isArray(s)){for(let l=0;l<s.length;l++)if(s[l]!=null){if(!a.slots[l])throw new Error(`MGTile: plant slot ${l} doesn't exist`);Bf(a.slots[l],s[l]);}}else if(s&&typeof s=="object")for(const l of Object.keys(s)){const c=Number(l)|0;if(Number.isFinite(c)){if(!a.slots[c])throw new Error(`MGTile: plant slot ${c} doesn't exist`);Bf(a.slots[c],s[c]);}}else throw new Error("MGTile: patch.slots must be array or object map");return xa(e,t,a,r)}return xa(e,t,a,r)}function o2(e,t,n,r={}){const i=wp(e,t,{...r,clone:false}).tileView?.tileObject;Jm(i,"decor");const a=Qa(i);return "rotation"in n&&(a.rotation=Number(n.rotation)),xa(e,t,a,r)}function i2(e,t,n,r={}){const i=wp(e,t,{...r,clone:false}).tileView?.tileObject;Jm(i,"egg");const a=Qa(i);return "plantedAt"in n&&(a.plantedAt=Number(n.plantedAt)),"maturedAt"in n&&(a.maturedAt=Number(n.maturedAt)),xa(e,t,a,r)}function a2(e,t,n,r={}){const o=r.ensureView!==false,i=r.forceUpdate!==false,a=Xm(),{gidx:s,tv:l}=_i(Number(e),Number(t),o);if(s==null)throw new Error("MGTile: cols unavailable (engine not ready)");if(!l)throw new Error("MGTile: TileView unavailable");const c=l.tileObject,d=typeof n=="function"?n(Qa(c)):n;if(l.onDataChanged(d),i&&a?.reusableContext&&typeof l.update=="function")try{l.update(a.reusableContext);}catch{}return {ok:true,tx:Number(e),ty:Number(t),gidx:s,before:c,after:l.tileObject}}function s2(e,t,n={}){const r=n.ensureView!==false,{gidx:o,tv:i}=_i(Number(e),Number(t),r);if(o==null)throw new Error("MGTile: cols unavailable");if(!i)return {ok:true,tx:Number(e),ty:Number(t),gidx:o,tv:null,tileObject:void 0};const a=n.clone!==false,s=i.tileObject;return {ok:true,tx:Number(e),ty:Number(t),gidx:o,objectType:s?.objectType??null,tileObject:a?Qa(s):s,tvKeys:Object.keys(i||{}).sort(),tileView:i}}function jf(e){if(!e)return null;const t=o=>o&&(typeof o.getGlobalPosition=="function"||typeof o.toGlobal=="function"),n=["container","root","view","tile","ground","base","floor","bg","background","baseSprite","tileSprite","displayObject","gfx","graphics","sprite"];for(const o of n)if(t(e[o]))return e[o];if(t(e))return e;const r=[e.container,e.root,e.view,e.displayObject,e.tileSprite,e.gfx,e.graphics,e.sprite];for(const o of r)if(t(o))return o;try{for(const o of Object.keys(e))if(t(e[o]))return e[o]}catch{}return null}function Hd(e){const t=cr(()=>e?.getGlobalPosition?.());if(t&&Number.isFinite(t.x)&&Number.isFinite(t.y))return {x:t.x,y:t.y};const n=cr(()=>e?.toGlobal?.({x:0,y:0}));return n&&Number.isFinite(n.x)&&Number.isFinite(n.y)?{x:n.x,y:n.y}:null}function l2(e){try{if(!e?.getBounds)return "center";const t=e.getBounds(),n=Hd(e);if(!n||!t||!Number.isFinite(t.width)||!Number.isFinite(t.height))return "center";const r=t.x+t.width/2,o=t.y+t.height/2;return Math.hypot(n.x-r,n.y-o)<Math.hypot(n.x-t.x,n.y-t.y)?"center":"topleft"}catch{return "center"}}function c2(){const e=lc(),t=e?.map?.cols,n=e?.map?.rows;if(!e||!Number.isFinite(t)||t<=1)return null;const r=Number.isFinite(n)&&n>1?n:null,o=[[0,0],[1,1],[Math.min(2,t-2),0],[0,1]];r&&r>2&&o.push([Math.floor(t/2),Math.floor(r/2)]);for(const[i,a]of o){if(i<0||a<0||i>=t||r&&a>=r)continue;const s=_i(i,a,true).tv,l=i+1<t?_i(i+1,a,true).tv:null,c=_i(i,a+1,true).tv,d=jf(s),u=jf(l),f=jf(c);if(!d||!u||!f)continue;const g=Hd(d),h=Hd(u),y=Hd(f);if(!g||!h||!y)continue;const S={x:h.x-g.x,y:h.y-g.y},C={x:y.x-g.x,y:y.y-g.y},_=S.x*C.y-S.y*C.x;if(!Number.isFinite(_)||Math.abs(_)<1e-6)continue;const E=1/_,P={a:C.y*E,b:-C.x*E,c:-S.y*E,d:S.x*E},O={x:g.x-i*S.x-a*C.x,y:g.y-i*S.y-a*C.y},k=l2(d),I=k==="center"?O:{x:O.x+.5*(S.x+C.x),y:O.y+.5*(S.y+C.y)};return {ok:true,cols:t,rows:r,vx:S,vy:C,inv:P,anchorMode:k,originCenter:I}}return null}function jC(){return qn.xform=c2(),qn.xformAt=Date.now(),{ok:!!qn.xform?.ok,xform:qn.xform}}function d2(e,t={}){if(!e||!Number.isFinite(e.x)||!Number.isFinite(e.y))return null;const n=Number.isFinite(t.maxAgeMs)?Number(t.maxAgeMs):1500;(!qn.xform?.ok||t.forceRebuild||Date.now()-qn.xformAt>n)&&jC();const r=qn.xform;if(!r?.ok)return null;const o=e.x-r.originCenter.x,i=e.y-r.originCenter.y,a=r.inv.a*o+r.inv.b*i,s=r.inv.c*o+r.inv.d*i,l=Math.floor(a),c=Math.floor(s),d=[[l,c],[l+1,c],[l,c+1],[l+1,c+1]];let u=null,f=1/0;for(const[g,h]of d){if(g<0||h<0||g>=r.cols||Number.isFinite(r.rows)&&r.rows!==null&&h>=r.rows)continue;const y=r.originCenter.x+g*r.vx.x+h*r.vy.x,S=r.originCenter.y+g*r.vx.y+h*r.vy.y,C=(e.x-y)**2+(e.y-S)**2;C<f&&(f=C,u={tx:g,ty:h,fx:a,fy:s,x:e.x,y:e.y,gidx:null});}return u?(u.gidx=Ym(u.tx,u.ty),u):null}function u2(e,t){const n=qn.xform;return n?.ok?{x:n.originCenter.x+e*n.vx.x+t*n.vy.x,y:n.originCenter.y+e*n.vx.y+t*n.vy.y}:null}function er(){if(!BC())throw new Error("MGTile: not ready. Call MGTile.init() first.")}function p2(){return ["MGTile.init()","MGTile.hook()","MGTile.getTileObject(tx,ty) / inspect(tx,ty)","MGTile.setTileEmpty(tx,ty)","MGTile.setTilePlant(tx,ty,{...}) / setTileDecor / setTileEgg","MGTile.setTileObjectRaw(tx,ty,objOrFn)","MGTile.rebuildTransform() / pointToTile({x,y})","MGTile.tileToPoint(tx,ty)"].join(`
`)}const so={init:t2,isReady:BC,hook:Vn.hook,engine:Xm,tos:lc,gidx:(e,t)=>Ym(Number(e),Number(t)),getTileObject:(e,t,n={})=>(er(),wp(e,t,n)),inspect:(e,t,n={})=>(er(),s2(e,t,n)),setTileEmpty:(e,t,n={})=>(er(),n2(e,t,n)),setTilePlant:(e,t,n,r={})=>(er(),r2(e,t,n,r)),setTileDecor:(e,t,n,r={})=>(er(),o2(e,t,n,r)),setTileEgg:(e,t,n,r={})=>(er(),i2(e,t,n,r)),setTileObjectRaw:(e,t,n,r={})=>(er(),a2(e,t,n,r)),rebuildTransform:()=>(er(),jC()),pointToTile:(e,t={})=>(er(),d2(e,t)),tileToPoint:(e,t)=>(er(),u2(e,t)),getTransform:()=>(er(),qn.xform),help:p2};function f2(){return {ready:false,app:null,renderer:null,stage:null,ticker:null,tileSets:new Map,highlights:new Map,watches:new Map,fades:new Map,fadeWatches:new Map}}const Oe=f2();function GC(){return Oe.ready}async function h2(e=15e3){if(Oe.ready)return ng(),true;if(await Vn.init(e),Oe.app=Vn.app(),Oe.ticker=Vn.ticker(),Oe.renderer=Vn.renderer(),Oe.stage=Vn.stage(),!Oe.app||!Oe.ticker)throw new Error("MGPixi: PIXI app/ticker not found");return Oe.ready=true,ng(),true}function ng(){const e=ge;return e.$PIXI=e.PIXI||null,e.$app=Oe.app||null,e.$renderer=Oe.renderer||null,e.$stage=Oe.stage||null,e.$ticker=Oe.ticker||null,e.__MG_PIXI__={PIXI:e.$PIXI,app:e.$app,renderer:e.$renderer,stage:e.$stage,ticker:e.$ticker,ready:Oe.ready},e.__MG_PIXI__}function Qm(e){return !!e&&typeof e=="object"&&!Array.isArray(e)}function rg(e){return !!(e&&typeof e.getBounds=="function"&&("parent"in e||"children"in e))}function Ou(e){return !!(e&&typeof e.tint=="number")}function Li(e){return !!(e&&typeof e.alpha=="number")}function Wd(e,t,n){return e+(t-e)*n}function g2(e,t,n){const r=e>>16&255,o=e>>8&255,i=e&255,a=t>>16&255,s=t>>8&255,l=t&255,c=Wd(r,a,n)|0,d=Wd(o,s,n)|0,u=Wd(i,l,n)|0;return c<<16|d<<8|u}function m2(e,t=900){const n=[],r=[e];for(;r.length&&n.length<t;){const o=r.pop();if(!o)continue;Ou(o)&&n.push(o);const i=o.children;if(Array.isArray(i))for(let a=i.length-1;a>=0;a--)r.push(i[a]);}return n}function b2(e,t=25e3){const n=[],r=[e];let o=0;for(;r.length&&o++<t;){const i=r.pop();if(!i)continue;Li(i)&&n.push(i);const a=i.children;if(Array.isArray(a))for(let s=a.length-1;s>=0;s--)r.push(a[s]);}return n}const v2=["plantVisual","cropVisual","slotVisual","slotView","displayObject","view","container","root","sprite","gfx","graphics"];function og(e){if(!e)return null;if(rg(e))return e;if(!Qm(e))return null;for(const t of v2){const n=e[t];if(rg(n))return n}return null}function y2(e,t){const n=[{o:e,d:0}],r=new Set,o=6;for(;n.length;){const{o:i,d:a}=n.shift();if(!(!i||a>o)&&!r.has(i)){if(r.add(i),Array.isArray(i)){if(i.length===t){const s=new Array(t);let l=true;for(let c=0;c<t;c++){const d=og(i[c]);if(!d){l=false;break}s[c]=d;}if(l)return s}for(const s of i)n.push({o:s,d:a+1});continue}if(Qm(i)){const s=i;for(const l of Object.keys(s))n.push({o:s[l],d:a+1});}}}return null}function zC(e){if(!Array.isArray(e))return [];const t=new Set,n=[];for(const r of e){let o,i;if(Array.isArray(r))o=r[0],i=r[1];else if(Qm(r))o=r.x??r.tx,i=r.y??r.ty;else continue;if(o=Number(o),i=Number(i),!Number.isFinite(o)||!Number.isFinite(i))continue;o|=0,i|=0;const a=`${o},${i}`;t.has(a)||(t.add(a),n.push({x:o,y:i}));}return n}function w2(e,t){const n=String(e||"").trim();if(!n)throw new Error("MGPixi.defineTileSet: empty name");const r=zC(t);return Oe.tileSets.set(n,r),{ok:true,name:n,count:r.length}}function x2(e){return Oe.tileSets.delete(String(e||"").trim())}function C2(){return Array.from(Oe.tileSets.keys()).sort((e,t)=>e.localeCompare(t))}function UC(e){return !!(e&&(e.tileSet!=null||Array.isArray(e.tiles)))}function Zm(e){const n=so.tos?.()?.tileViews;if(!n?.entries)throw new Error("MGPixi: TOS.tileViews not found");if(!UC(e))return {entries:Array.from(n.entries()),gidxSet:null};let r=[];if(e.tileSet!=null){const i=String(e.tileSet||"").trim(),a=Oe.tileSets.get(i);if(!a)throw new Error(`MGPixi: tileSet not found "${i}"`);r=a;}else r=zC(e.tiles||[]);const o=new Map;for(const i of r){const a=so.getTileObject(i.x,i.y,{ensureView:true,clone:false});a?.tileView&&a.gidx!=null&&o.set(a.gidx,a.tileView);}return {entries:Array.from(o.entries()),gidxSet:new Set(o.keys())}}function eb(e){const t=Oe.highlights.get(e);if(!t)return  false;cr(()=>Oe.ticker?.remove(t.tick)),t.root&&t.baseAlpha!=null&&Li(t.root)&&cr(()=>{t.root.alpha=t.baseAlpha;});for(const n of t.tint)n.o&&Ou(n.o)&&cr(()=>{n.o.tint=n.baseTint;});return Oe.highlights.delete(e),true}function HC(e=null){for(const t of Array.from(Oe.highlights.keys()))e&&!String(t).startsWith(e)||eb(t);return  true}function WC(e,t={}){if(!rg(e))throw new Error("MGPixi.highlightPulse: invalid root");const n=String(t.key||`hl:${Math.random().toString(16).slice(2)}`);if(Oe.highlights.has(n))return n;const r=Li(e)?Number(e.alpha):null,o=Ir(Number(t.minAlpha??.12),0,1),i=Ir(Number(t.maxAlpha??1),0,1),a=Number(t.speed??1.25),s=(t.tint??8386303)>>>0,l=Ir(Number(t.tintMix??.85),0,1),c=t.deepTint!==false,d=[];if(c)for(const g of m2(e))d.push({o:g,baseTint:g.tint});else Ou(e)&&d.push({o:e,baseTint:e.tint});const u=performance.now(),f=()=>{const g=(performance.now()-u)/1e3,h=(Math.sin(g*Math.PI*2*a)+1)/2,y=h*h*(3-2*h);r!=null&&Li(e)&&(e.alpha=Ir(Wd(o,i,y)*r,0,1));const S=y*l;for(const C of d)C.o&&Ou(C.o)&&(C.o.tint=g2(C.baseTint,s,S));};return Oe.ticker?.add(f),Oe.highlights.set(n,{root:e,tick:f,baseAlpha:r,tint:d}),n}function S2(e,t){const n=e?.mutations;if(!Array.isArray(n))return  false;for(const r of n)if(String(r||"").toLowerCase()===t)return  true;return  false}function VC(e,t={}){const n=String(e||"").trim().toLowerCase();if(!n)throw new Error("MGPixi.highlightMutation: empty mutation");const{entries:r,gidxSet:o}=Zm(t),i=`hlmut:${n}:`;if(t.clear===true)if(!o)HC(i);else for(const u of Array.from(Oe.highlights.keys())){if(!u.startsWith(i))continue;const f=u.split(":"),g=Number(f[2]);o.has(g)&&eb(u);}const a={tint:(t.tint??8386303)>>>0,minAlpha:Number(t.minAlpha??.12),maxAlpha:Number(t.maxAlpha??1),speed:Number(t.speed??1.25),tintMix:Number(t.tintMix??.85),deepTint:t.deepTint!==false};let s=0,l=0,c=0,d=0;for(const[u,f]of r){const g=f?.tileObject;if(!g||g.objectType!=="plant")continue;const h=g.slots;if(!Array.isArray(h)||h.length===0)continue;let y=false;const S=[];for(let E=0;E<h.length;E++)S2(h[E],n)&&(S.push(E),y=true);if(!y)continue;s++,l+=S.length;const C=f?.childView?.plantVisual||f?.childView||f,_=y2(C,h.length);if(!_){d+=S.length;continue}for(const E of S){const P=_[E];if(!P){d++;continue}const O=`${i}${u}:${E}`;Oe.highlights.has(O)||(WC(P,{key:O,...a}),c++);}}return {ok:true,mutation:n,filtered:!!o,plantsMatched:s,matchedSlots:l,newHighlights:c,failedSlots:d}}function _2(e,t={}){const n=String(e||"").trim().toLowerCase();if(!n)throw new Error("MGPixi.watchMutation: empty mutation");const r=`watchmut:${n}:${t.tileSet?`set:${t.tileSet}`:t.tiles?"tiles":"all"}`,o=Number.isFinite(t.intervalMs)?t.intervalMs:1e3,i=Oe.watches.get(r);i&&clearInterval(i);const a=setInterval(()=>{cr(()=>VC(n,{...t,clear:!1}));},o);return Oe.watches.set(r,a),{ok:true,key:r,mutation:n,intervalMs:o}}function k2(e){const t=String(e||"").trim();if(!t)return  false;if(!t.startsWith("watchmut:")){const r=t.toLowerCase();let o=0;for(const[i,a]of Array.from(Oe.watches.entries()))i.startsWith(`watchmut:${r}:`)&&(clearInterval(a),Oe.watches.delete(i),o++);return o>0}const n=Oe.watches.get(t);return n?(clearInterval(n),Oe.watches.delete(t),true):false}function E2(e){const t=e?.childView?.plantVisual||e?.childView?.cropVisual||e?.childView||e?.displayObject||e;return og(t)||og(e?.displayObject)||null}function qC(e){const t=Oe.fades.get(e);if(!t)return  false;for(const n of t.targets)n.o&&Li(n.o)&&Number.isFinite(n.baseAlpha)&&cr(()=>{n.o.alpha=n.baseAlpha;});return Oe.fades.delete(e),true}function ig(e=null){for(const t of Array.from(Oe.fades.keys()))e&&!String(t).startsWith(e)||qC(t);return  true}function KC(e,t={}){const n=String(e||"").trim().toLowerCase();if(!n)throw new Error("MGPixi.clearSpeciesFade: empty species");const r=`fade:${n}:`;if(!UC(t))return ig(r);const{gidxSet:o}=Zm(t);if(!o)return ig(r);for(const i of Array.from(Oe.fades.keys())){if(!i.startsWith(r))continue;const a=Number(i.slice(r.length));o.has(a)&&qC(i);}return  true}function XC(e,t={}){const n=String(e||"").trim().toLowerCase();if(!n)throw new Error("MGPixi.fadeSpecies: empty species");const r=Ir(Number(t.alpha??.2),0,1),o=t.deep===true,{entries:i,gidxSet:a}=Zm(t),s=`fade:${n}:`;t.clear===true&&KC(n,t);let l=0,c=0,d=0,u=0;for(const[f,g]of i){const h=g?.tileObject;if(!h||h.objectType!=="plant")continue;l++;const y=String(h.species||"").trim().toLowerCase();if(!y||y!==n)continue;c++;const S=E2(g);if(!S||!Li(S)){u++;continue}const C=`${s}${f}`;if(Oe.fades.has(C)){cr(()=>{S.alpha=r;}),d++;continue}const _=o?b2(S):[S],E=[];for(const P of _)Li(P)&&E.push({o:P,baseAlpha:Number(P.alpha)});for(const P of E)cr(()=>{P.o.alpha=r;});Oe.fades.set(C,{targets:E}),d++;}return {ok:true,species:n,alpha:r,deep:o,filtered:!!a,plantsSeen:l,matchedPlants:c,applied:d,failed:u,totalFades:Oe.fades.size}}function A2(e,t={}){const n=String(e||"").trim().toLowerCase();if(!n)throw new Error("MGPixi.watchFadeSpecies: empty species");const r=`watchfade:${n}:${t.tileSet?`set:${t.tileSet}`:t.tiles?"tiles":"all"}`,o=Number.isFinite(t.intervalMs)?t.intervalMs:1e3,i=Oe.fadeWatches.get(r);i&&clearInterval(i);const a=setInterval(()=>{cr(()=>XC(n,{...t,clear:!1}));},o);return Oe.fadeWatches.set(r,a),{ok:true,key:r,species:n,intervalMs:o}}function T2(e){const t=String(e||"").trim();if(!t)return  false;if(!t.startsWith("watchfade:")){const r=t.toLowerCase();let o=0;for(const[i,a]of Array.from(Oe.fadeWatches.entries()))i.startsWith(`watchfade:${r}:`)&&(clearInterval(a),Oe.fadeWatches.delete(i),o++);return o>0}const n=Oe.fadeWatches.get(t);return n?(clearInterval(n),Oe.fadeWatches.delete(t),true):false}function I2(e){const t=Array.isArray(e?.slots)?e.slots:[];return {objectType:"plant",species:e?.species??null,plantedAt:e?.plantedAt??null,maturedAt:e?.maturedAt??null,slotCount:t.length,slots:t.map((n,r)=>({idx:r,mutations:Array.isArray(n?.mutations)?n.mutations.slice():[]}))}}function P2(e,t,n={}){const r=Number(e)|0,o=Number(t)|0,i=n.ensureView!==false,a=so.getTileObject(r,o,{ensureView:i,clone:false}),s=a?.tileView||null,l=s?.tileObject,c={ok:true,tx:r,ty:o,gidx:a?.gidx??so.gidx?.(r,o)??null,hasTileView:!!s,objectType:l?.objectType??null,tileObject:l??null,summary:l?.objectType==="plant"?I2(l):l?{objectType:l.objectType??null}:null,display:s?s.childView?.plantVisual||s.childView||s.displayObject||s:null};return n.log!==false&&cr(()=>console.log("[MGPixi.inspectTile]",c)),c}function R2(e,t,n){const r=ge.PIXI;if(!r)return;let o=Oe.stage.getChildByName("gemini-overlay");o||(o=new r.Container,o.name="gemini-overlay",Oe.stage.addChild(o));const i=n.key;let a=o.getChildByName(i);a||(a=new r.Graphics,a.name=i,o.addChild(a));const s=so.tileToPoint(e,t);if(!s)return;a.clear(),a.lineStyle(2,n.tint??65280,n.alpha??1),a.beginFill(n.tint??65280,(n.alpha??1)*.2);const l=so.getTransform(),c=l?Math.hypot(l.vx.x,l.vx.y):32,d=l?Math.hypot(l.vy.x,l.vy.y):32;a.drawRect(0,0,c,d),a.endFill(),a.x=s.x,a.y=s.y,l&&(a.rotation=Math.atan2(l.vx.y,l.vx.x));}function M2(e){const t=Oe.stage?.getChildByName("gemini-overlay");if(!t)return  false;const n=t.getChildByName(e);return n?(t.removeChild(n),n.destroy?.(),true):false}function rn(){if(!GC())throw new Error("MGPixi: call MGPixi.init() first")}const xp={init:h2,isReady:GC,expose:ng,get app(){return Oe.app},get renderer(){return Oe.renderer},get stage(){return Oe.stage},get ticker(){return Oe.ticker},get PIXI(){return ge.PIXI||null},defineTileSet:(e,t)=>(rn(),w2(e,t)),deleteTileSet:e=>(rn(),x2(e)),listTileSets:()=>(rn(),C2()),highlightPulse:(e,t)=>(rn(),WC(e,t)),stopHighlight:e=>(rn(),eb(e)),clearHighlights:e=>(rn(),HC(e)),drawOverlayBox:(e,t,n)=>(rn(),R2(e,t,n)),stopOverlay:e=>(rn(),M2(e)),highlightMutation:(e,t)=>(rn(),VC(e,t)),watchMutation:(e,t)=>(rn(),_2(e,t)),stopWatchMutation:e=>(rn(),k2(e)),inspectTile:(e,t,n)=>(rn(),P2(e,t,n)),fadeSpecies:(e,t)=>(rn(),XC(e,t)),clearSpeciesFade:(e,t)=>(rn(),KC(e,t)),clearFades:e=>(rn(),ig(e)),watchFadeSpecies:(e,t)=>(rn(),A2(e,t)),stopWatchFadeSpecies:e=>(rn(),T2(e))},L2=["Top","Mid","Bottom","DiscordAvatarPlaceholder"],Vd={AVATAR:/avatarelements[^"']*\.riv/,EMOTES:/emotes[^"']*\.riv/,UI:/(giftbox|currency|bread|donut|streak)[^"']*\.riv/},YC=new Map;let JC=[],QC=false;function O2(e){return YC.get(e)}function N2(e,t){YC.set(e,t);}function $2(){return [...JC]}function D2(e){JC=e;}function F2(){return QC}function Cy(e){QC=e;}async function ZC(){const t=Vt.detect().origin,n=Array.from(document.scripts),r=[];for(const i of n){const a=i.textContent||"",s=Sy(a,t);r.push(...s);}for(const i of n)if(i.src)try{if(new URL(i.src).origin!==t)continue;const s=await fetch(i.src);if(!s.ok)continue;const l=await s.text(),c=Sy(l,t);r.push(...c);}catch(a){console.debug("[MGRiveLoader] Failed to fetch script:",i.src,a);}const o=Array.from(new Map(r.map(i=>[i.url,i])).values());return D2(o),console.log(`[MGRiveLoader] Discovered ${o.length} .riv files:`,o),o}function Sy(e,t){const n=[];return Object.entries(Vd).forEach(([r,o])=>{const i=new RegExp(`["']([^"']*\\.riv)["']`,"g");let a;for(;(a=i.exec(e))!==null;){const s=a[1];if(!o.test(s))continue;const l=s.startsWith("/")?`${t}${s}`:s,c=B2(s);n.push({name:j2(s),url:l,type:c});}}),n}function B2(e){return Vd.AVATAR.test(e)?"avatar":Vd.EMOTES.test(e)?"emote":Vd.UI.test(e)?"ui":"other"}function j2(e){const t=e.split("/");return t[t.length-1].replace(/-[a-zA-Z0-9]+\.riv$/,"")}async function eS(){const t=(await ZC()).find(n=>n.type==="avatar");return t||(console.warn("[MGRiveLoader] Could not find avatar .riv file"),null)}var qd={exports:{}},G2=qd.exports,_y;function z2(){return _y||(_y=1,(function(e,t){(function(r,o){e.exports=o();})(G2,()=>(()=>{var n=[,((a,s,l)=>{l.r(s),l.d(s,{default:()=>d});var c=(()=>{var u=typeof document<"u"?document.currentScript?.src:void 0;return(function(f={}){var g,h=f,y,S,C=new Promise((p,m)=>{y=p,S=m;}),_=typeof window=="object",E=typeof importScripts=="function";function P(){function p(K){const Y=T;w=m=0,T=new Map,Y.forEach(se=>{try{se(K);}catch(re){console.error(re);}}),this.ob(),$&&$.Qb();}let m=0,w=0,T=new Map,$=null,B=null;this.requestAnimationFrame=function(K){m||(m=requestAnimationFrame(p.bind(this)));const Y=++w;return T.set(Y,K),Y},this.cancelAnimationFrame=function(K){T.delete(K),m&&T.size==0&&(cancelAnimationFrame(m),m=0);},this.Ob=function(K){B&&(document.body.remove(B),B=null),K||(B=document.createElement("div"),B.style.backgroundColor="black",B.style.position="fixed",B.style.right=0,B.style.top=0,B.style.color="white",B.style.padding="4px",B.innerHTML="RIVE FPS",K=function(Y){B.innerHTML="RIVE FPS "+Y.toFixed(1);},document.body.appendChild(B)),$=new function(){let Y=0,se=0;this.Qb=function(){var re=performance.now();se?(++Y,re-=se,1e3<re&&(K(1e3*Y/re),Y=se=0)):(se=re,Y=0);};};},this.Lb=function(){B&&(document.body.remove(B),B=null),$=null;},this.ob=function(){};}function O(p){console.assert(true);const m=new Map;let w=-1/0;this.push=function(T){return T=T+((1<<p)-1)>>p,m.has(T)&&clearTimeout(m.get(T)),m.set(T,setTimeout(function(){m.delete(T),m.length==0?w=-1/0:T==w&&(w=Math.max(...m.keys()),console.assert(w<T));},1e3)),w=Math.max(T,w),w<<p};}const k=h.onRuntimeInitialized;h.onRuntimeInitialized=function(){k&&k();let p=h.decodeAudio;h.decodeAudio=function($,B){$=p($),B($);};let m=h.decodeFont;h.decodeFont=function($,B){$=m($),B($);};const w=h.FileAssetLoader;h.ptrToAsset=$=>{let B=h.ptrToFileAsset($);return B.isImage?h.ptrToImageAsset($):B.isFont?h.ptrToFontAsset($):B.isAudio?h.ptrToAudioAsset($):B},h.CustomFileAssetLoader=w.extend("CustomFileAssetLoader",{__construct:function({loadContents:$}){this.__parent.__construct.call(this),this.Eb=$;},loadContents:function($,B){return $=h.ptrToAsset($),this.Eb($,B)}}),h.CDNFileAssetLoader=w.extend("CDNFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this);},loadContents:function($){let B=h.ptrToAsset($);return $=B.cdnUuid,$===""?false:((function(K,Y){var se=new XMLHttpRequest;se.responseType="arraybuffer",se.onreadystatechange=function(){se.readyState==4&&se.status==200&&Y(se);},se.open("GET",K,true),se.send(null);})(B.cdnBaseUrl+"/"+$,K=>{B.decode(new Uint8Array(K.response));}),true)}}),h.FallbackFileAssetLoader=w.extend("FallbackFileAssetLoader",{__construct:function(){this.__parent.__construct.call(this),this.kb=[];},addLoader:function($){this.kb.push($);},loadContents:function($,B){for(let K of this.kb)if(K.loadContents($,B))return  true;return  false}});let T=h.computeAlignment;h.computeAlignment=function($,B,K,Y,se=1){return T.call(this,$,B,K,Y,se)};};const I="createConicGradient createImageData createLinearGradient createPattern createRadialGradient getContextAttributes getImageData getLineDash getTransform isContextLost isPointInPath isPointInStroke measureText".split(" "),R=new function(){function p(){if(!m){let Ke=function(et,ke,mt){if(ke=he.createShader(ke),he.shaderSource(ke,mt),he.compileShader(ke),mt=he.getShaderInfoLog(ke),0<(mt||"").length)throw mt;he.attachShader(et,ke);};var J=document.createElement("canvas"),xe={alpha:1,depth:0,stencil:0,antialias:0,premultipliedAlpha:1,preserveDrawingBuffer:0,powerPreference:"high-performance",failIfMajorPerformanceCaveat:0,enableExtensionsByDefault:1,explicitSwapControl:1,renderViaOffscreenBackBuffer:1};let he;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(he=J.getContext("webgl",xe),w=1,!he)return console.log("No WebGL support. Image mesh will not be drawn."),false}else if(he=J.getContext("webgl2",xe))w=2;else if(he=J.getContext("webgl",xe))w=1;else return console.log("No WebGL support. Image mesh will not be drawn."),false;if(he=new Proxy(he,{get(et,ke){if(et.isContextLost()){if(se||(console.error("Cannot render the mesh because the GL Context was lost. Tried to invoke ",ke),se=true),typeof et[ke]=="function")return function(){}}else return typeof et[ke]=="function"?function(...mt){return et[ke].apply(et,mt)}:et[ke]},set(et,ke,mt){if(et.isContextLost())se||(console.error("Cannot render the mesh because the GL Context was lost. Tried to set property "+ke),se=true);else return et[ke]=mt,true}}),T=Math.min(he.getParameter(he.MAX_RENDERBUFFER_SIZE),he.getParameter(he.MAX_TEXTURE_SIZE)),J=he.createProgram(),Ke(J,he.VERTEX_SHADER,`attribute vec2 vertex;
                attribute vec2 uv;
                uniform vec4 mat;
                uniform vec2 translate;
                varying vec2 st;
                void main() {
                    st = uv;
                    gl_Position = vec4(mat2(mat) * vertex + translate, 0, 1);
                }`),Ke(J,he.FRAGMENT_SHADER,`precision highp float;
                uniform sampler2D image;
                varying vec2 st;
                void main() {
                    gl_FragColor = texture2D(image, st);
                }`),he.bindAttribLocation(J,0,"vertex"),he.bindAttribLocation(J,1,"uv"),he.linkProgram(J),xe=he.getProgramInfoLog(J),0<(xe||"").trim().length)throw xe;$=he.getUniformLocation(J,"mat"),B=he.getUniformLocation(J,"translate"),he.useProgram(J),he.bindBuffer(he.ARRAY_BUFFER,he.createBuffer()),he.enableVertexAttribArray(0),he.enableVertexAttribArray(1),he.bindBuffer(he.ELEMENT_ARRAY_BUFFER,he.createBuffer()),he.uniform1i(he.getUniformLocation(J,"image"),0),he.pixelStorei(he.UNPACK_PREMULTIPLY_ALPHA_WEBGL,true),m=he;}return  true}let m=null,w=0,T=0,$=null,B=null,K=0,Y=0,se=false;p(),this.bc=function(){return p(),T},this.Kb=function(J){m.deleteTexture&&m.deleteTexture(J);},this.Jb=function(J){if(!p())return null;const xe=m.createTexture();return xe?(m.bindTexture(m.TEXTURE_2D,xe),m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,J),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.LINEAR),w==2?(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.LINEAR_MIPMAP_LINEAR),m.generateMipmap(m.TEXTURE_2D)):m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.LINEAR),xe):null};const re=new O(8),ve=new O(8),Ee=new O(10),Ae=new O(10);this.Nb=function(J,xe,he,Ke,et){if(p()){var ke=re.push(J),mt=ve.push(xe);if(m.canvas){(m.canvas.width!=ke||m.canvas.height!=mt)&&(m.canvas.width=ke,m.canvas.height=mt),m.viewport(0,mt-xe,J,xe),m.disable(m.SCISSOR_TEST),m.clearColor(0,0,0,0),m.clear(m.COLOR_BUFFER_BIT),m.enable(m.SCISSOR_TEST),he.sort((st,xr)=>xr.vb-st.vb),ke=Ee.push(Ke),K!=ke&&(m.bufferData(m.ARRAY_BUFFER,8*ke,m.DYNAMIC_DRAW),K=ke),ke=0;for(var Xt of he)m.bufferSubData(m.ARRAY_BUFFER,ke,Xt.Ta),ke+=4*Xt.Ta.length;console.assert(ke==4*Ke);for(var Pn of he)m.bufferSubData(m.ARRAY_BUFFER,ke,Pn.Bb),ke+=4*Pn.Bb.length;console.assert(ke==8*Ke),ke=Ae.push(et),Y!=ke&&(m.bufferData(m.ELEMENT_ARRAY_BUFFER,2*ke,m.DYNAMIC_DRAW),Y=ke),Xt=0;for(var Wo of he)m.bufferSubData(m.ELEMENT_ARRAY_BUFFER,Xt,Wo.indices),Xt+=2*Wo.indices.length;console.assert(Xt==2*et),Wo=0,Pn=true,ke=Xt=0;for(const st of he){st.image.Ja!=Wo&&(m.bindTexture(m.TEXTURE_2D,st.image.Ia||null),Wo=st.image.Ja),st.hc?(m.scissor(st.Za,mt-st.$a-st.jb,st.uc,st.jb),Pn=true):Pn&&(m.scissor(0,mt-xe,J,xe),Pn=false),he=2/J;const xr=-2/xe;m.uniform4f($,st.ha[0]*he*st.Aa,st.ha[1]*xr*st.Ba,st.ha[2]*he*st.Aa,st.ha[3]*xr*st.Ba),m.uniform2f(B,st.ha[4]*he*st.Aa+he*(st.Za-st.cc*st.Aa)-1,st.ha[5]*xr*st.Ba+xr*(st.$a-st.dc*st.Ba)+1),m.vertexAttribPointer(0,2,m.FLOAT,false,0,ke),m.vertexAttribPointer(1,2,m.FLOAT,false,0,ke+4*Ke),m.drawElements(m.TRIANGLES,st.indices.length,m.UNSIGNED_SHORT,Xt),ke+=4*st.Ta.length,Xt+=2*st.indices.length;}console.assert(ke==4*Ke),console.assert(Xt==2*et);}}},this.canvas=function(){return p()&&m.canvas};},A=h.onRuntimeInitialized;h.onRuntimeInitialized=function(){function p(fe){switch(fe){case re.srcOver:return "source-over";case re.screen:return "screen";case re.overlay:return "overlay";case re.darken:return "darken";case re.lighten:return "lighten";case re.colorDodge:return "color-dodge";case re.colorBurn:return "color-burn";case re.hardLight:return "hard-light";case re.softLight:return "soft-light";case re.difference:return "difference";case re.exclusion:return "exclusion";case re.multiply:return "multiply";case re.hue:return "hue";case re.saturation:return "saturation";case re.color:return "color";case re.luminosity:return "luminosity"}}function m(fe){return "rgba("+((16711680&fe)>>>16)+","+((65280&fe)>>>8)+","+((255&fe)>>>0)+","+((4278190080&fe)>>>24)/255+")"}function w(){0<mt.length&&(R.Nb(ke.drawWidth(),ke.drawHeight(),mt,Xt,Pn),mt=[],Pn=Xt=0,ke.reset(512,512));for(const fe of et){for(const _e of fe.I)_e();fe.I=[];}et.clear();}A&&A();var T=h.RenderPaintStyle;const $=h.RenderPath,B=h.RenderPaint,K=h.Renderer,Y=h.StrokeCap,se=h.StrokeJoin,re=h.BlendMode,ve=T.fill,Ee=T.stroke,Ae=h.FillRule.evenOdd;let J=1;var xe=h.RenderImage.extend("CanvasRenderImage",{__construct:function({la:fe,wa:_e}={}){this.__parent.__construct.call(this),this.Ja=J,J=J+1&2147483647||1,this.la=fe,this.wa=_e;},__destruct:function(){this.Ia&&(R.Kb(this.Ia),URL.revokeObjectURL(this.Wa)),this.__parent.__destruct.call(this);},decode:function(fe){var _e=this;_e.wa&&_e.wa(_e);var tt=new Image;_e.Wa=URL.createObjectURL(new Blob([fe],{type:"image/png"})),tt.onload=function(){_e.Db=tt,_e.Ia=R.Jb(tt),_e.size(tt.width,tt.height),_e.la&&_e.la(_e);},tt.src=_e.Wa;}}),he=$.extend("CanvasRenderPath",{__construct:function(){this.__parent.__construct.call(this),this.U=new Path2D;},rewind:function(){this.U=new Path2D;},addPath:function(fe,_e,tt,Je,pt,nt,Qe){var ht=this.U,Cr=ht.addPath;fe=fe.U;const Ot=new DOMMatrix;Ot.a=_e,Ot.b=tt,Ot.c=Je,Ot.d=pt,Ot.e=nt,Ot.f=Qe,Cr.call(ht,fe,Ot);},fillRule:function(fe){this.Va=fe;},moveTo:function(fe,_e){this.U.moveTo(fe,_e);},lineTo:function(fe,_e){this.U.lineTo(fe,_e);},cubicTo:function(fe,_e,tt,Je,pt,nt){this.U.bezierCurveTo(fe,_e,tt,Je,pt,nt);},close:function(){this.U.closePath();}}),Ke=B.extend("CanvasRenderPaint",{color:function(fe){this.Xa=m(fe);},thickness:function(fe){this.Gb=fe;},join:function(fe){switch(fe){case se.miter:this.Ha="miter";break;case se.round:this.Ha="round";break;case se.bevel:this.Ha="bevel";}},cap:function(fe){switch(fe){case Y.butt:this.Ga="butt";break;case Y.round:this.Ga="round";break;case Y.square:this.Ga="square";}},style:function(fe){this.Fb=fe;},blendMode:function(fe){this.Cb=p(fe);},clearGradient:function(){this.ja=null;},linearGradient:function(fe,_e,tt,Je){this.ja={xb:fe,yb:_e,cb:tt,eb:Je,Qa:[]};},radialGradient:function(fe,_e,tt,Je){this.ja={xb:fe,yb:_e,cb:tt,eb:Je,Qa:[],ac:true};},addStop:function(fe,_e){this.ja.Qa.push({color:fe,stop:_e});},completeGradient:function(){},draw:function(fe,_e,tt,Je){let pt=this.Fb;var nt=this.Xa,Qe=this.ja;const ht=fe.globalCompositeOperation,Cr=fe.globalAlpha;if(fe.globalCompositeOperation=this.Cb,fe.globalAlpha=Je,Qe!=null){nt=Qe.xb;const Rn=Qe.yb,Bt=Qe.cb;var Ot=Qe.eb;Je=Qe.Qa,Qe.ac?(Qe=Bt-nt,Ot-=Rn,nt=fe.createRadialGradient(nt,Rn,0,nt,Rn,Math.sqrt(Qe*Qe+Ot*Ot))):nt=fe.createLinearGradient(nt,Rn,Bt,Ot);for(let qi=0,Gc=Je.length;qi<Gc;qi++)Qe=Je[qi],nt.addColorStop(Qe.stop,m(Qe.color));this.Xa=nt,this.ja=null;}switch(pt){case Ee:fe.strokeStyle=nt,fe.lineWidth=this.Gb,fe.lineCap=this.Ga,fe.lineJoin=this.Ha,fe.stroke(_e);break;case ve:fe.fillStyle=nt,fe.fill(_e,tt);}fe.globalCompositeOperation=ht,fe.globalAlpha=Cr;}});const et=new Set;let ke=null,mt=[],Xt=0,Pn=0;var Wo=h.CanvasRenderer=K.extend("Renderer",{__construct:function(fe){this.__parent.__construct.call(this),this.T=[1,0,0,1,0,0],this.G=[1],this.B=fe.getContext("2d"),this.Ua=fe,this.I=[];},save:function(){this.T.push(...this.T.slice(this.T.length-6)),this.G.push(this.G[this.G.length-1]),this.I.push(this.B.save.bind(this.B));},restore:function(){const fe=this.T.length-6;if(6>fe)throw "restore() called without matching save().";this.T.splice(fe),this.G.pop(),this.I.push(this.B.restore.bind(this.B));},transform:function(fe,_e,tt,Je,pt,nt){const Qe=this.T,ht=Qe.length-6;Qe.splice(ht,6,Qe[ht]*fe+Qe[ht+2]*_e,Qe[ht+1]*fe+Qe[ht+3]*_e,Qe[ht]*tt+Qe[ht+2]*Je,Qe[ht+1]*tt+Qe[ht+3]*Je,Qe[ht]*pt+Qe[ht+2]*nt+Qe[ht+4],Qe[ht+1]*pt+Qe[ht+3]*nt+Qe[ht+5]),this.I.push(this.B.transform.bind(this.B,fe,_e,tt,Je,pt,nt));},rotate:function(fe){const _e=Math.sin(fe);fe=Math.cos(fe),this.transform(fe,_e,-_e,fe,0,0);},modulateOpacity:function(fe){this.G[this.G.length-1]*=fe;},_drawPath:function(fe,_e){this.I.push(_e.draw.bind(_e,this.B,fe.U,fe.Va===Ae?"evenodd":"nonzero",Math.max(0,this.G[this.G.length-1])));},_drawRiveImage:function(fe,_e,tt,Je){var pt=fe.Db;if(pt){var nt=this.B,Qe=p(tt),ht=Math.max(0,Je*this.G[this.G.length-1]);this.I.push(function(){nt.globalCompositeOperation=Qe,nt.globalAlpha=ht,nt.drawImage(pt,0,0),nt.globalAlpha=1;});}},_getMatrix:function(fe){const _e=this.T,tt=_e.length-6;for(let Je=0;6>Je;++Je)fe[Je]=_e[tt+Je];},_drawImageMesh:function(fe,_e,tt,Je,pt,nt,Qe,ht,Cr,Ot,Rn){_e=this.B.canvas.width;var Bt=this.B.canvas.height;const qi=Ot-ht,Gc=Rn-Cr;ht=Math.max(ht,0),Cr=Math.max(Cr,0),Ot=Math.min(Ot,_e),Rn=Math.min(Rn,Bt);const bs=Ot-ht,vs=Rn-Cr;if(console.assert(bs<=Math.min(qi,_e)),console.assert(vs<=Math.min(Gc,Bt)),!(0>=bs||0>=vs)){Ot=bs<qi||vs<Gc,_e=Rn=1;var Vo=Math.ceil(bs*Rn),qo=Math.ceil(vs*_e);Bt=R.bc(),Vo>Bt&&(Rn*=Bt/Vo,Vo=Bt),qo>Bt&&(_e*=Bt/qo,qo=Bt),ke||(ke=new h.DynamicRectanizer(Bt),ke.reset(512,512)),Bt=ke.addRect(Vo,qo),0>Bt&&(w(),et.add(this),Bt=ke.addRect(Vo,qo),console.assert(0<=Bt));var ty=Bt&65535,ny=Bt>>16;mt.push({ha:this.T.slice(this.T.length-6),image:fe,Za:ty,$a:ny,cc:ht,dc:Cr,uc:Vo,jb:qo,Aa:Rn,Ba:_e,Ta:new Float32Array(pt),Bb:new Float32Array(nt),indices:new Uint16Array(Qe),hc:Ot,vb:fe.Ja<<1|(Ot?1:0)}),Xt+=pt.length,Pn+=Qe.length;var Ki=this.B,fA=p(tt),hA=Math.max(0,Je*this.G[this.G.length-1]);this.I.push(function(){Ki.save(),Ki.resetTransform(),Ki.globalCompositeOperation=fA,Ki.globalAlpha=hA;const ry=R.canvas();ry&&Ki.drawImage(ry,ty,ny,Vo,qo,ht,Cr,bs,vs),Ki.restore();});}},_clipPath:function(fe){this.I.push(this.B.clip.bind(this.B,fe.U,fe.Va===Ae?"evenodd":"nonzero"));},clear:function(){et.add(this),this.I.push(this.B.clearRect.bind(this.B,0,0,this.Ua.width,this.Ua.height));},flush:function(){},translate:function(fe,_e){this.transform(1,0,0,1,fe,_e);}});h.makeRenderer=function(fe){const _e=new Wo(fe),tt=_e.B;return new Proxy(_e,{get(Je,pt){if(typeof Je[pt]=="function")return function(...nt){return Je[pt].apply(Je,nt)};if(typeof tt[pt]=="function"){if(-1<I.indexOf(pt))throw Error("RiveException: Method call to '"+pt+"()' is not allowed, as the renderer cannot immediately pass through the return                 values of any canvas 2d context methods.");return function(...nt){_e.I.push(tt[pt].bind(tt,...nt));}}return Je[pt]},set(Je,pt,nt){if(pt in tt)return _e.I.push(()=>{tt[pt]=nt;}),true}})},h.decodeImage=function(fe,_e){new xe({la:_e}).decode(fe);},h.renderFactory={makeRenderPaint:function(){return new Ke},makeRenderPath:function(){return new he},makeRenderImage:function(){let fe=xr;return new xe({wa:()=>{fe.total++;},la:()=>{if(fe.loaded++,fe.loaded===fe.total){const _e=fe.ready;_e&&(_e(),fe.ready=null);}}})}};let st=h.load,xr=null;h.load=function(fe,_e,tt=true){const Je=new h.FallbackFileAssetLoader;return _e!==void 0&&Je.addLoader(_e),tt&&(_e=new h.CDNFileAssetLoader,Je.addLoader(_e)),new Promise(function(pt){let nt=null;xr={total:0,loaded:0,ready:function(){pt(nt);}},nt=st(fe,Je),xr.total==0&&pt(nt);})};let pA=h.RendererWrapper.prototype.align;h.RendererWrapper.prototype.align=function(fe,_e,tt,Je,pt=1){pA.call(this,fe,_e,tt,Je,pt);},T=new P,h.requestAnimationFrame=T.requestAnimationFrame.bind(T),h.cancelAnimationFrame=T.cancelAnimationFrame.bind(T),h.enableFPSCounter=T.Ob.bind(T),h.disableFPSCounter=T.Lb,T.ob=w,h.resolveAnimationFrame=w,h.cleanup=function(){ke&&ke.delete();};};var L=Object.assign({},h),F="./this.program",G="",q,H;(_||E)&&(E?G=self.location.href:typeof document<"u"&&document.currentScript&&(G=document.currentScript.src),u&&(G=u),G.startsWith("blob:")?G="":G=G.substr(0,G.replace(/[?#].*/,"").lastIndexOf("/")+1),E&&(H=p=>{var m=new XMLHttpRequest;return m.open("GET",p,false),m.responseType="arraybuffer",m.send(null),new Uint8Array(m.response)}),q=(p,m,w)=>{if(xn(p)){var T=new XMLHttpRequest;T.open("GET",p,true),T.responseType="arraybuffer",T.onload=()=>{T.status==200||T.status==0&&T.response?m(T.response):w();},T.onerror=w,T.send(null);}else fetch(p,{credentials:"same-origin"}).then($=>$.ok?$.arrayBuffer():Promise.reject(Error($.status+" : "+$.url))).then(m,w);});var ce=h.print||console.log.bind(console),W=h.printErr||console.error.bind(console);Object.assign(h,L),L=null,h.thisProgram&&(F=h.thisProgram);var te;h.wasmBinary&&(te=h.wasmBinary);var ne,ie=false,ee,U,X,D,j,Q,ae,le;function we(){var p=ne.buffer;h.HEAP8=ee=new Int8Array(p),h.HEAP16=X=new Int16Array(p),h.HEAPU8=U=new Uint8Array(p),h.HEAPU16=D=new Uint16Array(p),h.HEAP32=j=new Int32Array(p),h.HEAPU32=Q=new Uint32Array(p),h.HEAPF32=ae=new Float32Array(p),h.HEAPF64=le=new Float64Array(p);}var Ie=[],Ve=[],kt=[];function mn(){var p=h.preRun.shift();Ie.unshift(p);}var St=0,qt=null;function wn(p){throw h.onAbort?.(p),p="Aborted("+p+")",W(p),ie=true,p=new WebAssembly.RuntimeError(p+". Build with -sASSERTIONS for more info."),S(p),p}var nn=p=>p.startsWith("data:application/octet-stream;base64,"),xn=p=>p.startsWith("file://"),ft;function qe(p){if(p==ft&&te)return new Uint8Array(te);if(H)return H(p);throw "both async and sync fetching of the wasm failed"}function Qn(p){return te?Promise.resolve().then(()=>qe(p)):new Promise((m,w)=>{q(p,T=>m(new Uint8Array(T)),()=>{try{m(qe(p));}catch(T){w(T);}});})}function Zn(p,m,w){return Qn(p).then(T=>WebAssembly.instantiate(T,m)).then(w,T=>{W(`failed to asynchronously prepare wasm: ${T}`),wn(T);})}function Et(p,m){var w=ft;return te||typeof WebAssembly.instantiateStreaming!="function"||nn(w)||xn(w)||typeof fetch!="function"?Zn(w,p,m):fetch(w,{credentials:"same-origin"}).then(T=>WebAssembly.instantiateStreaming(T,p).then(m,function($){return W(`wasm streaming compile failed: ${$}`),W("falling back to ArrayBuffer instantiation"),Zn(w,p,m)}))}var Ft,Cn,br={490930:(p,m,w,T,$)=>{if(typeof window>"u"||(window.AudioContext||window.webkitAudioContext)===void 0)return 0;if(typeof window.h>"u"){window.h={za:0},window.h.J={},window.h.J.xa=p,window.h.J.capture=m,window.h.J.Ka=w,window.h.ga={},window.h.ga.stopped=T,window.h.ga.wb=$;let B=window.h;B.D=[],B.sc=function(K){for(var Y=0;Y<B.D.length;++Y)if(B.D[Y]==null)return B.D[Y]=K,Y;return B.D.push(K),B.D.length-1},B.Ab=function(K){for(B.D[K]=null;0<B.D.length&&B.D[B.D.length-1]==null;)B.D.pop();},B.Pc=function(K){for(var Y=0;Y<B.D.length;++Y)if(B.D[Y]==K)return B.Ab(Y)},B.qa=function(K){return B.D[K]},B.Sa=["touchend","click"],B.unlock=function(){for(var K=0;K<B.D.length;++K){var Y=B.D[K];Y!=null&&Y.L!=null&&Y.state===B.ga.wb&&Y.L.resume().then(()=>{Kv(Y.pb);},se=>{console.error("Failed to resume audiocontext",se);});}B.Sa.map(function(se){document.removeEventListener(se,B.unlock,true);});},B.Sa.map(function(K){document.addEventListener(K,B.unlock,true);});}return window.h.za+=1,1},493108:()=>{typeof window.h<"u"&&(window.h.Sa.map(function(p){document.removeEventListener(p,window.h.unlock,true);}),--window.h.za,window.h.za===0&&delete window.h);},493412:()=>navigator.mediaDevices!==void 0&&navigator.mediaDevices.getUserMedia!==void 0,493516:()=>{try{var p=new(window.AudioContext||window.webkitAudioContext),m=p.sampleRate;return p.close(),m}catch{return 0}},493687:(p,m,w,T,$,B)=>{if(typeof window.h>"u")return  -1;var K={},Y={};return p==window.h.J.xa&&w!=0&&(Y.sampleRate=w),K.L=new(window.AudioContext||window.webkitAudioContext)(Y),K.L.suspend(),K.state=window.h.ga.stopped,w=0,p!=window.h.J.xa&&(w=m),K.Z=K.L.createScriptProcessor(T,w,m),K.Z.onaudioprocess=function(se){if((K.ra==null||K.ra.length==0)&&(K.ra=new Float32Array(ae.buffer,$,T*m)),p==window.h.J.capture||p==window.h.J.Ka){for(var re=0;re<m;re+=1)for(var ve=se.inputBuffer.getChannelData(re),Ee=K.ra,Ae=0;Ae<T;Ae+=1)Ee[Ae*m+re]=ve[Ae];Xv(B,T,$);}if(p==window.h.J.xa||p==window.h.J.Ka)for(Yv(B,T,$),re=0;re<se.outputBuffer.numberOfChannels;++re)for(ve=se.outputBuffer.getChannelData(re),Ee=K.ra,Ae=0;Ae<T;Ae+=1)ve[Ae]=Ee[Ae*m+re];else for(re=0;re<se.outputBuffer.numberOfChannels;++re)se.outputBuffer.getChannelData(re).fill(0);},p!=window.h.J.capture&&p!=window.h.J.Ka||navigator.mediaDevices.getUserMedia({audio:true,video:false}).then(function(se){K.Ca=K.L.createMediaStreamSource(se),K.Ca.connect(K.Z),K.Z.connect(K.L.destination);}).catch(function(se){console.log("Failed to get user media: "+se);}),p==window.h.J.xa&&K.Z.connect(K.L.destination),K.pb=B,window.h.sc(K)},496564:p=>window.h.qa(p).L.sampleRate,496637:p=>{p=window.h.qa(p),p.Z!==void 0&&(p.Z.onaudioprocess=function(){},p.Z.disconnect(),p.Z=void 0),p.Ca!==void 0&&(p.Ca.disconnect(),p.Ca=void 0),p.L.close(),p.L=void 0,p.pb=void 0;},497037:p=>{window.h.Ab(p);},497087:p=>{p=window.h.qa(p),p.L.resume(),p.state=window.h.ga.wb;},497226:p=>{p=window.h.qa(p),p.L.suspend(),p.state=window.h.ga.stopped;}},Dn=p=>{for(;0<p.length;)p.shift()(h);};function M(){var p=j[+cs>>2];return cs+=4,p}var b=(p,m)=>{for(var w=0,T=p.length-1;0<=T;T--){var $=p[T];$==="."?p.splice(T,1):$===".."?(p.splice(T,1),w++):w&&(p.splice(T,1),w--);}if(m)for(;w;w--)p.unshift("..");return p},v=p=>{var m=p.charAt(0)==="/",w=p.substr(-1)==="/";return (p=b(p.split("/").filter(T=>!!T),!m).join("/"))||m||(p="."),p&&w&&(p+="/"),(m?"/":"")+p},N=p=>{var m=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(p).slice(1);return p=m[0],m=m[1],!p&&!m?".":(m&&(m=m.substr(0,m.length-1)),p+m)},z=p=>{if(p==="/")return "/";p=v(p),p=p.replace(/\/$/,"");var m=p.lastIndexOf("/");return m===-1?p:p.substr(m+1)},V=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return p=>crypto.getRandomValues(p);wn("initRandomDevice");},Z=p=>(Z=V())(p),pe=(...p)=>{for(var m="",w=false,T=p.length-1;-1<=T&&!w;T--){if(w=0<=T?p[T]:"/",typeof w!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!w)return "";m=w+"/"+m,w=w.charAt(0)==="/";}return m=b(m.split("/").filter($=>!!$),!w).join("/"),(w?"/":"")+m||"."},Ce=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,ye=(p,m,w)=>{var T=m+w;for(w=m;p[w]&&!(w>=T);)++w;if(16<w-m&&p.buffer&&Ce)return Ce.decode(p.subarray(m,w));for(T="";m<w;){var $=p[m++];if($&128){var B=p[m++]&63;if(($&224)==192)T+=String.fromCharCode(($&31)<<6|B);else {var K=p[m++]&63;$=($&240)==224?($&15)<<12|B<<6|K:($&7)<<18|B<<12|K<<6|p[m++]&63,65536>$?T+=String.fromCharCode($):($-=65536,T+=String.fromCharCode(55296|$>>10,56320|$&1023));}}else T+=String.fromCharCode($);}return T},Se=[],ut=p=>{for(var m=0,w=0;w<p.length;++w){var T=p.charCodeAt(w);127>=T?m++:2047>=T?m+=2:55296<=T&&57343>=T?(m+=4,++w):m+=3;}return m},vt=(p,m,w,T)=>{if(!(0<T))return 0;var $=w;T=w+T-1;for(var B=0;B<p.length;++B){var K=p.charCodeAt(B);if(55296<=K&&57343>=K){var Y=p.charCodeAt(++B);K=65536+((K&1023)<<10)|Y&1023;}if(127>=K){if(w>=T)break;m[w++]=K;}else {if(2047>=K){if(w+1>=T)break;m[w++]=192|K>>6;}else {if(65535>=K){if(w+2>=T)break;m[w++]=224|K>>12;}else {if(w+3>=T)break;m[w++]=240|K>>18,m[w++]=128|K>>12&63;}m[w++]=128|K>>6&63;}m[w++]=128|K&63;}}return m[w]=0,w-$};function it(p,m){var w=Array(ut(p)+1);return p=vt(p,w,0,w.length),m&&(w.length=p),w}var Kt=[];function Pt(p,m){Kt[p]={input:[],H:[],W:m},ff(p,An);}var An={open(p){var m=Kt[p.node.ya];if(!m)throw new Te(43);p.s=m,p.seekable=false;},close(p){p.s.W.pa(p.s);},pa(p){p.s.W.pa(p.s);},read(p,m,w,T){if(!p.s||!p.s.W.ib)throw new Te(60);for(var $=0,B=0;B<T;B++){try{var K=p.s.W.ib(p.s);}catch{throw new Te(29)}if(K===void 0&&$===0)throw new Te(6);if(K==null)break;$++,m[w+B]=K;}return $&&(p.node.timestamp=Date.now()),$},write(p,m,w,T){if(!p.s||!p.s.W.Na)throw new Te(60);try{for(var $=0;$<T;$++)p.s.W.Na(p.s,m[w+$]);}catch{throw new Te(29)}return T&&(p.node.timestamp=Date.now()),$}},Tn={ib(){e:{if(!Se.length){var p=null;if(typeof window<"u"&&typeof window.prompt=="function"&&(p=window.prompt("Input: "),p!==null&&(p+=`
`)),!p){p=null;break e}Se=it(p,true);}p=Se.shift();}return p},Na(p,m){m===null||m===10?(ce(ye(p.H,0)),p.H=[]):m!=0&&p.H.push(m);},pa(p){p.H&&0<p.H.length&&(ce(ye(p.H,0)),p.H=[]);},Yb(){return {Ac:25856,Cc:5,zc:191,Bc:35387,yc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},Zb(){return 0},$b(){return [24,80]}},Fn={Na(p,m){m===null||m===10?(W(ye(p.H,0)),p.H=[]):m!=0&&p.H.push(m);},pa(p){p.H&&0<p.H.length&&(W(ye(p.H,0)),p.H=[]);}};function Dr(p,m){var w=p.l?p.l.length:0;w>=m||(m=Math.max(m,w*(1048576>w?2:1.125)>>>0),w!=0&&(m=Math.max(m,256)),w=p.l,p.l=new Uint8Array(m),0<p.v&&p.l.set(w.subarray(0,p.v),0));}var We={O:null,V(){return We.createNode(null,"/",16895,0)},createNode(p,m,w,T){if((w&61440)===24576||(w&61440)===4096)throw new Te(63);return We.O||(We.O={dir:{node:{Y:We.j.Y,R:We.j.R,ka:We.j.ka,ua:We.j.ua,tb:We.j.tb,zb:We.j.zb,ub:We.j.ub,sb:We.j.sb,Da:We.j.Da},stream:{ba:We.m.ba}},file:{node:{Y:We.j.Y,R:We.j.R},stream:{ba:We.m.ba,read:We.m.read,write:We.m.write,Ya:We.m.Ya,lb:We.m.lb,nb:We.m.nb}},link:{node:{Y:We.j.Y,R:We.j.R,ma:We.j.ma},stream:{}},ab:{node:{Y:We.j.Y,R:We.j.R},stream:D1}}),w=xv(p,m,w,T),(w.mode&61440)===16384?(w.j=We.O.dir.node,w.m=We.O.dir.stream,w.l={}):(w.mode&61440)===32768?(w.j=We.O.file.node,w.m=We.O.file.stream,w.v=0,w.l=null):(w.mode&61440)===40960?(w.j=We.O.link.node,w.m=We.O.link.stream):(w.mode&61440)===8192&&(w.j=We.O.ab.node,w.m=We.O.ab.stream),w.timestamp=Date.now(),p&&(p.l[m]=w,p.timestamp=w.timestamp),w},Gc(p){return p.l?p.l.subarray?p.l.subarray(0,p.v):new Uint8Array(p.l):new Uint8Array(0)},j:{Y(p){var m={};return m.Ec=(p.mode&61440)===8192?p.id:1,m.Ic=p.id,m.mode=p.mode,m.Lc=1,m.uid=0,m.Hc=0,m.ya=p.ya,(p.mode&61440)===16384?m.size=4096:(p.mode&61440)===32768?m.size=p.v:(p.mode&61440)===40960?m.size=p.link.length:m.size=0,m.wc=new Date(p.timestamp),m.Kc=new Date(p.timestamp),m.Dc=new Date(p.timestamp),m.Hb=4096,m.xc=Math.ceil(m.size/m.Hb),m},R(p,m){if(m.mode!==void 0&&(p.mode=m.mode),m.timestamp!==void 0&&(p.timestamp=m.timestamp),m.size!==void 0&&(m=m.size,p.v!=m))if(m==0)p.l=null,p.v=0;else {var w=p.l;p.l=new Uint8Array(m),w&&p.l.set(w.subarray(0,Math.min(m,p.v))),p.v=m;}},ka(){throw pf[44]},ua(p,m,w,T){return We.createNode(p,m,w,T)},tb(p,m,w){if((p.mode&61440)===16384){try{var T=kc(m,w);}catch{}if(T)for(var $ in T.l)throw new Te(55)}delete p.parent.l[p.name],p.parent.timestamp=Date.now(),p.name=w,m.l[w]=p,m.timestamp=p.parent.timestamp;},zb(p,m){delete p.l[m],p.timestamp=Date.now();},ub(p,m){var w=kc(p,m),T;for(T in w.l)throw new Te(55);delete p.l[m],p.timestamp=Date.now();},sb(p){var m=[".",".."],w;for(w of Object.keys(p.l))m.push(w);return m},Da(p,m,w){return p=We.createNode(p,m,41471,0),p.link=w,p},ma(p){if((p.mode&61440)!==40960)throw new Te(28);return p.link}},m:{read(p,m,w,T,$){var B=p.node.l;if($>=p.node.v)return 0;if(p=Math.min(p.node.v-$,T),8<p&&B.subarray)m.set(B.subarray($,$+p),w);else for(T=0;T<p;T++)m[w+T]=B[$+T];return p},write(p,m,w,T,$,B){if(m.buffer===ee.buffer&&(B=false),!T)return 0;if(p=p.node,p.timestamp=Date.now(),m.subarray&&(!p.l||p.l.subarray)){if(B)return p.l=m.subarray(w,w+T),p.v=T;if(p.v===0&&$===0)return p.l=m.slice(w,w+T),p.v=T;if($+T<=p.v)return p.l.set(m.subarray(w,w+T),$),T}if(Dr(p,$+T),p.l.subarray&&m.subarray)p.l.set(m.subarray(w,w+T),$);else for(B=0;B<T;B++)p.l[$+B]=m[w+B];return p.v=Math.max(p.v,$+T),T},ba(p,m,w){if(w===1?m+=p.position:w===2&&(p.node.mode&61440)===32768&&(m+=p.node.v),0>m)throw new Te(28);return m},Ya(p,m,w){Dr(p.node,m+w),p.node.v=Math.max(p.node.v,m+w);},lb(p,m,w,T,$){if((p.node.mode&61440)!==32768)throw new Te(43);if(p=p.node.l,$&2||p.buffer!==ee.buffer){if((0<w||w+m<p.length)&&(p.subarray?p=p.subarray(w,w+m):p=Array.prototype.slice.call(p,w,w+m)),w=true,wn(),m=void 0,!m)throw new Te(48);ee.set(p,m);}else w=false,m=p.byteOffset;return {o:m,vc:w}},nb(p,m,w,T){return We.m.write(p,m,0,T,w,false),0}}},Fr=(p,m)=>{var w=0;return p&&(w|=365),m&&(w|=146),w},Bn=null,at={},jn=[],L1=1,ss=null,vv=true,Te=class{constructor(p){this.name="ErrnoError",this.aa=p;}},pf={},O1=class{constructor(){this.h={},this.node=null;}get flags(){return this.h.flags}set flags(p){this.h.flags=p;}get position(){return this.h.position}set position(p){this.h.position=p;}},N1=class{constructor(p,m,w,T){p||(p=this),this.parent=p,this.V=p.V,this.va=null,this.id=L1++,this.name=m,this.mode=w,this.j={},this.m={},this.ya=T;}get read(){return (this.mode&365)===365}set read(p){p?this.mode|=365:this.mode&=-366;}get write(){return (this.mode&146)===146}set write(p){p?this.mode|=146:this.mode&=-147;}};function zo(p,m={}){if(p=pe(p),!p)return {path:"",node:null};if(m=Object.assign({hb:true,Pa:0},m),8<m.Pa)throw new Te(32);p=p.split("/").filter(K=>!!K);for(var w=Bn,T="/",$=0;$<p.length;$++){var B=$===p.length-1;if(B&&m.parent)break;if(w=kc(w,p[$]),T=v(T+"/"+p[$]),w.va&&(!B||B&&m.hb)&&(w=w.va.root),!B||m.gb){for(B=0;(w.mode&61440)===40960;)if(w=F1(T),T=pe(N(T),w),w=zo(T,{Pa:m.Pa+1}).node,40<B++)throw new Te(32)}}return {path:T,node:w}}function yv(p){for(var m;;){if(p===p.parent)return p=p.V.mb,m?p[p.length-1]!=="/"?`${p}/${m}`:p+m:p;m=m?`${p.name}/${m}`:p.name,p=p.parent;}}function wv(p,m){for(var w=0,T=0;T<m.length;T++)w=(w<<5)-w+m.charCodeAt(T)|0;return (p+w>>>0)%ss.length}function kc(p,m){var w=(p.mode&61440)===16384?(w=Ec(p,"x"))?w:p.j.ka?0:2:54;if(w)throw new Te(w);for(w=ss[wv(p.id,m)];w;w=w.fc){var T=w.name;if(w.parent.id===p.id&&T===m)return w}return p.j.ka(p,m)}function xv(p,m,w,T){return p=new N1(p,m,w,T),m=wv(p.parent.id,p.name),p.fc=ss[m],ss[m]=p}function Cv(p){var m=["r","w","rw"][p&3];return p&512&&(m+="w"),m}function Ec(p,m){if(vv)return 0;if(!m.includes("r")||p.mode&292){if(m.includes("w")&&!(p.mode&146)||m.includes("x")&&!(p.mode&73))return 2}else return 2;return 0}function Sv(p,m){try{return kc(p,m),20}catch{}return Ec(p,"wx")}function go(p){if(p=jn[p],!p)throw new Te(8);return p}function _v(p,m=-1){if(p=Object.assign(new O1,p),m==-1)e:{for(m=0;4096>=m;m++)if(!jn[m])break e;throw new Te(33)}return p.X=m,jn[m]=p}function $1(p,m=-1){return p=_v(p,m),p.m?.Fc?.(p),p}var D1={open(p){p.m=at[p.node.ya].m,p.m.open?.(p);},ba(){throw new Te(70)}};function ff(p,m){at[p]={m};}function kv(p,m){var w=m==="/";if(w&&Bn)throw new Te(10);if(!w&&m){var T=zo(m,{hb:false});if(m=T.path,T=T.node,T.va)throw new Te(10);if((T.mode&61440)!==16384)throw new Te(54)}m={type:p,Nc:{},mb:m,ec:[]},p=p.V(m),p.V=m,m.root=p,w?Bn=p:T&&(T.va=m,T.V&&T.V.ec.push(m));}function hf(p,m,w){var T=zo(p,{parent:true}).node;if(p=z(p),!p||p==="."||p==="..")throw new Te(28);var $=Sv(T,p);if($)throw new Te($);if(!T.j.ua)throw new Te(63);return T.j.ua(T,p,m,w)}function Br(p){return hf(p,16895,0)}function Ac(p,m,w){typeof w>"u"&&(w=m,m=438),hf(p,m|8192,w);}function gf(p,m){if(!pe(p))throw new Te(44);var w=zo(m,{parent:true}).node;if(!w)throw new Te(44);m=z(m);var T=Sv(w,m);if(T)throw new Te(T);if(!w.j.Da)throw new Te(63);w.j.Da(w,m,p);}function F1(p){if(p=zo(p).node,!p)throw new Te(44);if(!p.j.ma)throw new Te(28);return pe(yv(p.parent),p.j.ma(p))}function Tc(p,m,w){if(p==="")throw new Te(44);if(typeof m=="string"){var T={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[m];if(typeof T>"u")throw Error(`Unknown file open mode: ${m}`);m=T;}if(w=m&64?(typeof w>"u"?438:w)&4095|32768:0,typeof p=="object")var $=p;else {p=v(p);try{$=zo(p,{gb:!(m&131072)}).node;}catch{}}if(T=false,m&64)if($){if(m&128)throw new Te(20)}else $=hf(p,w,0),T=true;if(!$)throw new Te(44);if(($.mode&61440)===8192&&(m&=-513),m&65536&&($.mode&61440)!==16384)throw new Te(54);if(!T&&(w=$?($.mode&61440)===40960?32:($.mode&61440)===16384&&(Cv(m)!=="r"||m&512)?31:Ec($,Cv(m)):44))throw new Te(w);if(m&512&&!T){if(w=$,w=typeof w=="string"?zo(w,{gb:true}).node:w,!w.j.R)throw new Te(63);if((w.mode&61440)===16384)throw new Te(31);if((w.mode&61440)!==32768)throw new Te(28);if(T=Ec(w,"w"))throw new Te(T);w.j.R(w,{size:0,timestamp:Date.now()});}return m&=-131713,$=_v({node:$,path:yv($),flags:m,seekable:true,position:0,m:$.m,tc:[],error:false}),$.m.open&&$.m.open($),!h.logReadFiles||m&1||(mf||(mf={}),p in mf||(mf[p]=1)),$}function Ev(p,m,w){if(p.X===null)throw new Te(8);if(!p.seekable||!p.m.ba)throw new Te(70);if(w!=0&&w!=1&&w!=2)throw new Te(28);p.position=p.m.ba(p,m,w),p.tc=[];}var Av;function ls(p,m,w){p=v("/dev/"+p);var T=Fr(!!m,!!w);Tv||(Tv=64);var $=Tv++<<8|0;ff($,{open(B){B.seekable=false;},close(){w?.buffer?.length&&w(10);},read(B,K,Y,se){for(var re=0,ve=0;ve<se;ve++){try{var Ee=m();}catch{throw new Te(29)}if(Ee===void 0&&re===0)throw new Te(6);if(Ee==null)break;re++,K[Y+ve]=Ee;}return re&&(B.node.timestamp=Date.now()),re},write(B,K,Y,se){for(var re=0;re<se;re++)try{w(K[Y+re]);}catch{throw new Te(29)}return se&&(B.node.timestamp=Date.now()),re}}),Ac(p,T,$);}var Tv,Uo={},mf,cs=void 0,Hi=(p,m)=>Object.defineProperty(m,"name",{value:p}),bf=[],jr=[],ze,vr=p=>{if(!p)throw new ze("Cannot use deleted val. handle = "+p);return jr[p]},yr=p=>{switch(p){case void 0:return 2;case null:return 4;case  true:return 6;case  false:return 8;default:const m=bf.pop()||jr.length;return jr[m]=p,jr[m+1]=1,m}},Iv=p=>{var m=Error,w=Hi(p,function(T){this.name=p,this.message=T,T=Error(T).stack,T!==void 0&&(this.stack=this.toString()+`
`+T.replace(/^Error(:[^\n]*)?\n/,""));});return w.prototype=Object.create(m.prototype),w.prototype.constructor=w,w.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},w},Pv,Rv,Rt=p=>{for(var m="";U[p];)m+=Rv[U[p++]];return m},ds=[],vf=()=>{for(;ds.length;){var p=ds.pop();p.g.fa=false,p.delete();}},us,Gr={},yf=(p,m)=>{if(m===void 0)throw new ze("ptr should not be undefined");for(;p.C;)m=p.na(m),p=p.C;return m},Ho={},Mv=p=>{p=qv(p);var m=Rt(p);return Ur(p),m},ps=(p,m)=>{var w=Ho[p];if(w===void 0)throw p=`${m} has unknown type ${Mv(p)}`,new ze(p);return w},Ic=()=>{},wf=false,Lv=(p,m,w)=>m===w?p:w.C===void 0?null:(p=Lv(p,m,w.C),p===null?null:w.Mb(p)),Ov={},B1=(p,m)=>(m=yf(p,m),Gr[m]),fs,Pc=(p,m)=>{if(!m.u||!m.o)throw new fs("makeClassHandle requires ptr and ptrType");if(!!m.K!=!!m.F)throw new fs("Both smartPtrType and smartPtr must be specified");return m.count={value:1},Wi(Object.create(p,{g:{value:m,writable:true}}))},Wi=p=>typeof FinalizationRegistry>"u"?(Wi=m=>m,p):(wf=new FinalizationRegistry(m=>{m=m.g,--m.count.value,m.count.value===0&&(m.F?m.K.P(m.F):m.u.i.P(m.o));}),Wi=m=>{var w=m.g;return w.F&&wf.register(m,{g:w},m),m},Ic=m=>{wf.unregister(m);},Wi(p)),Rc={},hs=p=>{for(;p.length;){var m=p.pop();p.pop()(m);}};function gs(p){return this.fromWireType(Q[p>>2])}var Vi={},Mc={},In=(p,m,w)=>{function T(Y){if(Y=w(Y),Y.length!==p.length)throw new fs("Mismatched type converter count");for(var se=0;se<p.length;++se)wr(p[se],Y[se]);}p.forEach(function(Y){Mc[Y]=m;});var $=Array(m.length),B=[],K=0;m.forEach((Y,se)=>{Ho.hasOwnProperty(Y)?$[se]=Ho[Y]:(B.push(Y),Vi.hasOwnProperty(Y)||(Vi[Y]=[]),Vi[Y].push(()=>{$[se]=Ho[Y],++K,K===B.length&&T($);}));}),B.length===0&&T($);};function j1(p,m,w={}){var T=m.name;if(!p)throw new ze(`type "${T}" must have a positive integer typeid pointer`);if(Ho.hasOwnProperty(p)){if(w.Wb)return;throw new ze(`Cannot register type '${T}' twice`)}Ho[p]=m,delete Mc[p],Vi.hasOwnProperty(p)&&(m=Vi[p],delete Vi[p],m.forEach($=>$()));}function wr(p,m,w={}){if(!("argPackAdvance"in m))throw new TypeError("registerType registeredInstance requires argPackAdvance");return j1(p,m,w)}var xf=p=>{throw new ze(p.g.u.i.name+" instance already deleted")};function Lc(){}var Cf=(p,m,w)=>{if(p[m].A===void 0){var T=p[m];p[m]=function(...$){if(!p[m].A.hasOwnProperty($.length))throw new ze(`Function '${w}' called with an invalid number of arguments (${$.length}) - expects one of (${p[m].A})!`);return p[m].A[$.length].apply(this,$)},p[m].A=[],p[m].A[T.ea]=T;}},Sf=(p,m,w)=>{if(h.hasOwnProperty(p)){if(w===void 0||h[p].A!==void 0&&h[p].A[w]!==void 0)throw new ze(`Cannot register public name '${p}' twice`);if(Cf(h,p,p),h.hasOwnProperty(w))throw new ze(`Cannot register multiple overloads of a function with the same number of arguments (${w})!`);h[p].A[w]=m;}else h[p]=m,w!==void 0&&(h[p].Mc=w);},G1=p=>{if(p===void 0)return "_unknown";p=p.replace(/[^a-zA-Z0-9_]/g,"$");var m=p.charCodeAt(0);return 48<=m&&57>=m?`_${p}`:p};function z1(p,m,w,T,$,B,K,Y){this.name=p,this.constructor=m,this.N=w,this.P=T,this.C=$,this.Rb=B,this.na=K,this.Mb=Y,this.qb=[];}var Oc=(p,m,w)=>{for(;m!==w;){if(!m.na)throw new ze(`Expected null or instance of ${w.name}, got an instance of ${m.name}`);p=m.na(p),m=m.C;}return p};function U1(p,m){if(m===null){if(this.Ma)throw new ze(`null is not a valid ${this.name}`);return 0}if(!m.g)throw new ze(`Cannot pass "${Af(m)}" as a ${this.name}`);if(!m.g.o)throw new ze(`Cannot pass deleted object as a pointer of type ${this.name}`);return Oc(m.g.o,m.g.u.i,this.i)}function H1(p,m){if(m===null){if(this.Ma)throw new ze(`null is not a valid ${this.name}`);if(this.ta){var w=this.Oa();return p!==null&&p.push(this.P,w),w}return 0}if(!m||!m.g)throw new ze(`Cannot pass "${Af(m)}" as a ${this.name}`);if(!m.g.o)throw new ze(`Cannot pass deleted object as a pointer of type ${this.name}`);if(!this.sa&&m.g.u.sa)throw new ze(`Cannot convert argument of type ${m.g.K?m.g.K.name:m.g.u.name} to parameter type ${this.name}`);if(w=Oc(m.g.o,m.g.u.i,this.i),this.ta){if(m.g.F===void 0)throw new ze("Passing raw pointer to smart pointer is illegal");switch(this.nc){case 0:if(m.g.K===this)w=m.g.F;else throw new ze(`Cannot convert argument of type ${m.g.K?m.g.K.name:m.g.u.name} to parameter type ${this.name}`);break;case 1:w=m.g.F;break;case 2:if(m.g.K===this)w=m.g.F;else {var T=m.clone();w=this.jc(w,yr(()=>T.delete())),p!==null&&p.push(this.P,w);}break;default:throw new ze("Unsupporting sharing policy")}}return w}function W1(p,m){if(m===null){if(this.Ma)throw new ze(`null is not a valid ${this.name}`);return 0}if(!m.g)throw new ze(`Cannot pass "${Af(m)}" as a ${this.name}`);if(!m.g.o)throw new ze(`Cannot pass deleted object as a pointer of type ${this.name}`);if(m.g.u.sa)throw new ze(`Cannot convert argument of type ${m.g.u.name} to parameter type ${this.name}`);return Oc(m.g.o,m.g.u.i,this.i)}function Nc(p,m,w,T,$,B,K,Y,se,re,ve){this.name=p,this.i=m,this.Ma=w,this.sa=T,this.ta=$,this.ic=B,this.nc=K,this.rb=Y,this.Oa=se,this.jc=re,this.P=ve,$||m.C!==void 0?this.toWireType=H1:(this.toWireType=T?U1:W1,this.M=null);}var Nv=(p,m,w)=>{if(!h.hasOwnProperty(p))throw new fs("Replacing nonexistent public symbol");h[p].A!==void 0&&w!==void 0?h[p].A[w]=m:(h[p]=m,h[p].ea=w);},$c=[],$v,_f=p=>{var m=$c[p];return m||(p>=$c.length&&($c.length=p+1),$c[p]=m=$v.get(p)),m},V1=(p,m,w=[])=>(p.includes("j")?(p=p.replace(/p/g,"i"),m=(0, h["dynCall_"+p])(m,...w)):m=_f(m)(...w),m),q1=(p,m)=>(...w)=>V1(p,m,w),cn=(p,m)=>{p=Rt(p);var w=p.includes("j")?q1(p,m):_f(m);if(typeof w!="function")throw new ze(`unknown function pointer with signature ${p}: ${m}`);return w},Dv,zr=(p,m)=>{function w(B){$[B]||Ho[B]||(Mc[B]?Mc[B].forEach(w):(T.push(B),$[B]=true));}var T=[],$={};throw m.forEach(w),new Dv(`${p}: `+T.map(Mv).join([", "]))};function K1(p){for(var m=1;m<p.length;++m)if(p[m]!==null&&p[m].M===void 0)return  true;return  false}function Dc(p,m,w,T,$){var B=m.length;if(2>B)throw new ze("argTypes array size mismatch! Must at least get return value and 'this' types!");var K=m[1]!==null&&w!==null,Y=K1(m),se=m[0].name!=="void",re=B-2,ve=Array(re),Ee=[],Ae=[];return Hi(p,function(...J){if(J.length!==re)throw new ze(`function ${p} called with ${J.length} arguments, expected ${re}`);if(Ae.length=0,Ee.length=K?2:1,Ee[0]=$,K){var xe=m[1].toWireType(Ae,this);Ee[1]=xe;}for(var he=0;he<re;++he)ve[he]=m[he+2].toWireType(Ae,J[he]),Ee.push(ve[he]);if(J=T(...Ee),Y)hs(Ae);else for(he=K?1:2;he<m.length;he++){var Ke=he===1?xe:ve[he-2];m[he].M!==null&&m[he].M(Ke);}return xe=se?m[0].fromWireType(J):void 0,xe})}var Fc=(p,m)=>{for(var w=[],T=0;T<p;T++)w.push(Q[m+4*T>>2]);return w},kf=p=>{p=p.trim();const m=p.indexOf("(");return m!==-1?p.substr(0,m):p},Fv=(p,m,w)=>{if(!(p instanceof Object))throw new ze(`${w} with invalid "this": ${p}`);if(!(p instanceof m.i.constructor))throw new ze(`${w} incompatible with "this" of type ${p.constructor.name}`);if(!p.g.o)throw new ze(`cannot call emscripten binding method ${w} on deleted object`);return Oc(p.g.o,p.g.u.i,m.i)},Ef=p=>{9<p&&--jr[p+1]===0&&(jr[p]=void 0,bf.push(p));},X1={name:"emscripten::val",fromWireType:p=>{var m=vr(p);return Ef(p),m},toWireType:(p,m)=>yr(m),argPackAdvance:8,readValueFromPointer:gs,M:null},Y1=(p,m,w)=>{switch(m){case 1:return w?function(T){return this.fromWireType(ee[T])}:function(T){return this.fromWireType(U[T])};case 2:return w?function(T){return this.fromWireType(X[T>>1])}:function(T){return this.fromWireType(D[T>>1])};case 4:return w?function(T){return this.fromWireType(j[T>>2])}:function(T){return this.fromWireType(Q[T>>2])};default:throw new TypeError(`invalid integer width (${m}): ${p}`)}},Af=p=>{if(p===null)return "null";var m=typeof p;return m==="object"||m==="array"||m==="function"?p.toString():""+p},J1=(p,m)=>{switch(m){case 4:return function(w){return this.fromWireType(ae[w>>2])};case 8:return function(w){return this.fromWireType(le[w>>3])};default:throw new TypeError(`invalid float width (${m}): ${p}`)}},Q1=(p,m,w)=>{switch(m){case 1:return w?T=>ee[T]:T=>U[T];case 2:return w?T=>X[T>>1]:T=>D[T>>1];case 4:return w?T=>j[T>>2]:T=>Q[T>>2];default:throw new TypeError(`invalid integer width (${m}): ${p}`)}},Bv=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Z1=(p,m)=>{for(var w=p>>1,T=w+m/2;!(w>=T)&&D[w];)++w;if(w<<=1,32<w-p&&Bv)return Bv.decode(U.subarray(p,w));for(w="",T=0;!(T>=m/2);++T){var $=X[p+2*T>>1];if($==0)break;w+=String.fromCharCode($);}return w},eA=(p,m,w)=>{if(w??(w=2147483647),2>w)return 0;w-=2;var T=m;w=w<2*p.length?w/2:p.length;for(var $=0;$<w;++$)X[m>>1]=p.charCodeAt($),m+=2;return X[m>>1]=0,m-T},tA=p=>2*p.length,nA=(p,m)=>{for(var w=0,T="";!(w>=m/4);){var $=j[p+4*w>>2];if($==0)break;++w,65536<=$?($-=65536,T+=String.fromCharCode(55296|$>>10,56320|$&1023)):T+=String.fromCharCode($);}return T},rA=(p,m,w)=>{if(w??(w=2147483647),4>w)return 0;var T=m;w=T+w-4;for(var $=0;$<p.length;++$){var B=p.charCodeAt($);if(55296<=B&&57343>=B){var K=p.charCodeAt(++$);B=65536+((B&1023)<<10)|K&1023;}if(j[m>>2]=B,m+=4,m+4>w)break}return j[m>>2]=0,m-T},oA=p=>{for(var m=0,w=0;w<p.length;++w){var T=p.charCodeAt(w);55296<=T&&57343>=T&&++w,m+=4;}return m},jv=(p,m,w)=>{var T=[];return p=p.toWireType(T,w),T.length&&(Q[m>>2]=yr(T)),p},iA={},Tf=p=>{var m=iA[p];return m===void 0?Rt(p):m},If=[],aA=p=>{var m=If.length;return If.push(p),m},sA=(p,m)=>{for(var w=Array(p),T=0;T<p;++T)w[T]=ps(Q[m+4*T>>2],"parameter "+T);return w},lA=Reflect.construct,ms=p=>p%4===0&&(p%100!==0||p%400===0),cA=[0,31,60,91,121,152,182,213,244,274,305,335],dA=[0,31,59,90,120,151,181,212,243,273,304,334],Pf=[],Rf={},Gv=()=>{if(!Mf){var p={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:F||"./this.program"},m;for(m in Rf)Rf[m]===void 0?delete p[m]:p[m]=Rf[m];var w=[];for(m in p)w.push(`${m}=${p[m]}`);Mf=w;}return Mf},Mf,zv=[31,29,31,30,31,30,31,31,30,31,30,31],Uv=[31,28,31,30,31,30,31,31,30,31,30,31],Hv=(p,m,w,T)=>{function $(J,xe,he){for(J=typeof J=="number"?J.toString():J||"";J.length<xe;)J=he[0]+J;return J}function B(J,xe){return $(J,xe,"0")}function K(J,xe){function he(et){return 0>et?-1:0<et?1:0}var Ke;return (Ke=he(J.getFullYear()-xe.getFullYear()))===0&&(Ke=he(J.getMonth()-xe.getMonth()))===0&&(Ke=he(J.getDate()-xe.getDate())),Ke}function Y(J){switch(J.getDay()){case 0:return new Date(J.getFullYear()-1,11,29);case 1:return J;case 2:return new Date(J.getFullYear(),0,3);case 3:return new Date(J.getFullYear(),0,2);case 4:return new Date(J.getFullYear(),0,1);case 5:return new Date(J.getFullYear()-1,11,31);case 6:return new Date(J.getFullYear()-1,11,30)}}function se(J){var xe=J.ca;for(J=new Date(new Date(J.da+1900,0,1).getTime());0<xe;){var he=J.getMonth(),Ke=(ms(J.getFullYear())?zv:Uv)[he];if(xe>Ke-J.getDate())xe-=Ke-J.getDate()+1,J.setDate(1),11>he?J.setMonth(he+1):(J.setMonth(0),J.setFullYear(J.getFullYear()+1));else {J.setDate(J.getDate()+xe);break}}return he=new Date(J.getFullYear()+1,0,4),xe=Y(new Date(J.getFullYear(),0,4)),he=Y(he),0>=K(xe,J)?0>=K(he,J)?J.getFullYear()+1:J.getFullYear():J.getFullYear()-1}var re=Q[T+40>>2];T={qc:j[T>>2],pc:j[T+4>>2],Ea:j[T+8>>2],Ra:j[T+12>>2],Fa:j[T+16>>2],da:j[T+20>>2],S:j[T+24>>2],ca:j[T+28>>2],Oc:j[T+32>>2],oc:j[T+36>>2],rc:re&&re?ye(U,re):""},w=w?ye(U,w):"",re={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var ve in re)w=w.replace(new RegExp(ve,"g"),re[ve]);var Ee="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),Ae="January February March April May June July August September October November December".split(" ");re={"%a":J=>Ee[J.S].substring(0,3),"%A":J=>Ee[J.S],"%b":J=>Ae[J.Fa].substring(0,3),"%B":J=>Ae[J.Fa],"%C":J=>B((J.da+1900)/100|0,2),"%d":J=>B(J.Ra,2),"%e":J=>$(J.Ra,2," "),"%g":J=>se(J).toString().substring(2),"%G":se,"%H":J=>B(J.Ea,2),"%I":J=>(J=J.Ea,J==0?J=12:12<J&&(J-=12),B(J,2)),"%j":J=>{for(var xe=0,he=0;he<=J.Fa-1;xe+=(ms(J.da+1900)?zv:Uv)[he++]);return B(J.Ra+xe,3)},"%m":J=>B(J.Fa+1,2),"%M":J=>B(J.pc,2),"%n":()=>`
`,"%p":J=>0<=J.Ea&&12>J.Ea?"AM":"PM","%S":J=>B(J.qc,2),"%t":()=>"	","%u":J=>J.S||7,"%U":J=>B(Math.floor((J.ca+7-J.S)/7),2),"%V":J=>{var xe=Math.floor((J.ca+7-(J.S+6)%7)/7);if(2>=(J.S+371-J.ca-2)%7&&xe++,xe)xe==53&&(he=(J.S+371-J.ca)%7,he==4||he==3&&ms(J.da)||(xe=1));else {xe=52;var he=(J.S+7-J.ca-1)%7;(he==4||he==5&&ms(J.da%400-1))&&xe++;}return B(xe,2)},"%w":J=>J.S,"%W":J=>B(Math.floor((J.ca+7-(J.S+6)%7)/7),2),"%y":J=>(J.da+1900).toString().substring(2),"%Y":J=>J.da+1900,"%z":J=>{J=J.oc;var xe=0<=J;return J=Math.abs(J)/60,(xe?"+":"-")+("0000"+(J/60*100+J%60)).slice(-4)},"%Z":J=>J.rc,"%%":()=>"%"},w=w.replace(/%%/g,"\0\0");for(ve in re)w.includes(ve)&&(w=w.replace(new RegExp(ve,"g"),re[ve](T)));return w=w.replace(/\0\0/g,"%"),ve=it(w,false),ve.length>m?0:(ee.set(ve,p),ve.length-1)};[44].forEach(p=>{pf[p]=new Te(p),pf[p].stack="<generic error, no stack>";}),ss=Array(4096),kv(We,"/"),Br("/tmp"),Br("/home"),Br("/home/web_user"),(function(){Br("/dev"),ff(259,{read:()=>0,write:(T,$,B,K)=>K}),Ac("/dev/null",259),Pt(1280,Tn),Pt(1536,Fn),Ac("/dev/tty",1280),Ac("/dev/tty1",1536);var p=new Uint8Array(1024),m=0,w=()=>(m===0&&(m=Z(p).byteLength),p[--m]);ls("random",w),ls("urandom",w),Br("/dev/shm"),Br("/dev/shm/tmp");})(),(function(){Br("/proc");var p=Br("/proc/self");Br("/proc/self/fd"),kv({V(){var m=xv(p,"fd",16895,73);return m.j={ka(w,T){var $=go(+T);return w={parent:null,V:{mb:"fake"},j:{ma:()=>$.path}},w.parent=w}},m}},"/proc/self/fd");})(),ze=h.BindingError=class extends Error{constructor(p){super(p),this.name="BindingError";}},jr.push(0,1,void 0,1,null,1,true,1,false,1),h.count_emval_handles=()=>jr.length/2-5-bf.length,Pv=h.PureVirtualError=Iv("PureVirtualError");for(var Wv=Array(256),Bc=0;256>Bc;++Bc)Wv[Bc]=String.fromCharCode(Bc);Rv=Wv,h.getInheritedInstanceCount=()=>Object.keys(Gr).length,h.getLiveInheritedInstances=()=>{var p=[],m;for(m in Gr)Gr.hasOwnProperty(m)&&p.push(Gr[m]);return p},h.flushPendingDeletes=vf,h.setDelayFunction=p=>{us=p,ds.length&&us&&us(vf);},fs=h.InternalError=class extends Error{constructor(p){super(p),this.name="InternalError";}},Object.assign(Lc.prototype,{isAliasOf:function(p){if(!(this instanceof Lc&&p instanceof Lc))return  false;var m=this.g.u.i,w=this.g.o;p.g=p.g;var T=p.g.u.i;for(p=p.g.o;m.C;)w=m.na(w),m=m.C;for(;T.C;)p=T.na(p),T=T.C;return m===T&&w===p},clone:function(){if(this.g.o||xf(this),this.g.ia)return this.g.count.value+=1,this;var p=Wi,m=Object,w=m.create,T=Object.getPrototypeOf(this),$=this.g;return p=p(w.call(m,T,{g:{value:{count:$.count,fa:$.fa,ia:$.ia,o:$.o,u:$.u,F:$.F,K:$.K}}})),p.g.count.value+=1,p.g.fa=false,p},delete(){if(this.g.o||xf(this),this.g.fa&&!this.g.ia)throw new ze("Object already scheduled for deletion");Ic(this);var p=this.g;--p.count.value,p.count.value===0&&(p.F?p.K.P(p.F):p.u.i.P(p.o)),this.g.ia||(this.g.F=void 0,this.g.o=void 0);},isDeleted:function(){return !this.g.o},deleteLater:function(){if(this.g.o||xf(this),this.g.fa&&!this.g.ia)throw new ze("Object already scheduled for deletion");return ds.push(this),ds.length===1&&us&&us(vf),this.g.fa=true,this}}),Object.assign(Nc.prototype,{Sb(p){return this.rb&&(p=this.rb(p)),p},bb(p){this.P?.(p);},argPackAdvance:8,readValueFromPointer:gs,fromWireType:function(p){function m(){return this.ta?Pc(this.i.N,{u:this.ic,o:w,K:this,F:p}):Pc(this.i.N,{u:this,o:p})}var w=this.Sb(p);if(!w)return this.bb(p),null;var T=B1(this.i,w);if(T!==void 0)return T.g.count.value===0?(T.g.o=w,T.g.F=p,T.clone()):(T=T.clone(),this.bb(p),T);if(T=this.i.Rb(w),T=Ov[T],!T)return m.call(this);T=this.sa?T.Ib:T.pointerType;var $=Lv(w,this.i,T.i);return $===null?m.call(this):this.ta?Pc(T.i.N,{u:T,o:$,K:this,F:p}):Pc(T.i.N,{u:T,o:$})}}),Dv=h.UnboundTypeError=Iv("UnboundTypeError");var Vv={__syscall_fcntl64:function(p,m,w){cs=w;try{var T=go(p);switch(m){case 0:var $=M();if(0>$)break;for(;jn[$];)$++;return $1(T,$).X;case 1:case 2:return 0;case 3:return T.flags;case 4:return $=M(),T.flags|=$,0;case 12:return $=M(),X[$+0>>1]=2,0;case 13:case 14:return 0}return -28}catch(B){if(typeof Uo>"u"||B.name!=="ErrnoError")throw B;return -B.aa}},__syscall_ioctl:function(p,m,w){cs=w;try{var T=go(p);switch(m){case 21509:return T.s?0:-59;case 21505:if(!T.s)return -59;if(T.s.W.Yb){p=[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var $=M();j[$>>2]=25856,j[$+4>>2]=5,j[$+8>>2]=191,j[$+12>>2]=35387;for(var B=0;32>B;B++)ee[$+B+17]=p[B]||0;}return 0;case 21510:case 21511:case 21512:return T.s?0:-59;case 21506:case 21507:case 21508:if(!T.s)return -59;if(T.s.W.Zb)for($=M(),p=[],B=0;32>B;B++)p.push(ee[$+B+17]);return 0;case 21519:return T.s?($=M(),j[$>>2]=0):-59;case 21520:return T.s?-28:-59;case 21531:if($=M(),!T.m.Xb)throw new Te(59);return T.m.Xb(T,m,$);case 21523:return T.s?(T.s.W.$b&&(B=[24,80],$=M(),X[$>>1]=B[0],X[$+2>>1]=B[1]),0):-59;case 21524:return T.s?0:-59;case 21515:return T.s?0:-59;default:return -28}}catch(K){if(typeof Uo>"u"||K.name!=="ErrnoError")throw K;return -K.aa}},__syscall_openat:function(p,m,w,T){cs=T;try{m=m?ye(U,m):"";var $=m;if($.charAt(0)==="/")m=$;else {var B=p===-100?"/":go(p).path;if($.length==0)throw new Te(44);m=v(B+"/"+$);}var K=T?M():0;return Tc(m,w,K).X}catch(Y){if(typeof Uo>"u"||Y.name!=="ErrnoError")throw Y;return -Y.aa}},_abort_js:()=>{wn("");},_embind_create_inheriting_constructor:(p,m,w)=>{p=Rt(p),m=ps(m,"wrapper"),w=vr(w);var T=m.i,$=T.N,B=T.C.N,K=T.C.constructor;return p=Hi(p,function(...Y){T.C.qb.forEach(function(se){if(this[se]===B[se])throw new Pv(`Pure virtual function ${se} must be implemented in JavaScript`)}.bind(this)),Object.defineProperty(this,"__parent",{value:$}),this.__construct(...Y);}),$.__construct=function(...Y){if(this===$)throw new ze("Pass correct 'this' to __construct");Y=K.implement(this,...Y),Ic(Y);var se=Y.g;if(Y.notifyOnDestruction(),se.ia=true,Object.defineProperties(this,{g:{value:se}}),Wi(this),Y=se.o,Y=yf(T,Y),Gr.hasOwnProperty(Y))throw new ze(`Tried to register registered instance: ${Y}`);Gr[Y]=this;},$.__destruct=function(){if(this===$)throw new ze("Pass correct 'this' to __destruct");Ic(this);var Y=this.g.o;if(Y=yf(T,Y),Gr.hasOwnProperty(Y))delete Gr[Y];else throw new ze(`Tried to unregister unregistered instance: ${Y}`)},p.prototype=Object.create($),Object.assign(p.prototype,w),yr(p)},_embind_finalize_value_object:p=>{var m=Rc[p];delete Rc[p];var w=m.Oa,T=m.P,$=m.fb,B=$.map(K=>K.Vb).concat($.map(K=>K.lc));In([p],B,K=>{var Y={};return $.forEach((se,re)=>{var ve=K[re],Ee=se.Tb,Ae=se.Ub,J=K[re+$.length],xe=se.kc,he=se.mc;Y[se.Pb]={read:Ke=>ve.fromWireType(Ee(Ae,Ke)),write:(Ke,et)=>{var ke=[];xe(he,Ke,J.toWireType(ke,et)),hs(ke);}};}),[{name:m.name,fromWireType:se=>{var re={},ve;for(ve in Y)re[ve]=Y[ve].read(se);return T(se),re},toWireType:(se,re)=>{for(var ve in Y)if(!(ve in re))throw new TypeError(`Missing field: "${ve}"`);var Ee=w();for(ve in Y)Y[ve].write(Ee,re[ve]);return se!==null&&se.push(T,Ee),Ee},argPackAdvance:8,readValueFromPointer:gs,M:T}]});},_embind_register_bigint:()=>{},_embind_register_bool:(p,m,w,T)=>{m=Rt(m),wr(p,{name:m,fromWireType:function($){return !!$},toWireType:function($,B){return B?w:T},argPackAdvance:8,readValueFromPointer:function($){return this.fromWireType(U[$])},M:null});},_embind_register_class:(p,m,w,T,$,B,K,Y,se,re,ve,Ee,Ae)=>{ve=Rt(ve),B=cn($,B),Y&&(Y=cn(K,Y)),re&&(re=cn(se,re)),Ae=cn(Ee,Ae);var J=G1(ve);Sf(J,function(){zr(`Cannot construct ${ve} due to unbound types`,[T]);}),In([p,m,w],T?[T]:[],xe=>{if(xe=xe[0],T)var he=xe.i,Ke=he.N;else Ke=Lc.prototype;xe=Hi(ve,function(...Xt){if(Object.getPrototypeOf(this)!==et)throw new ze("Use 'new' to construct "+ve);if(ke.$===void 0)throw new ze(ve+" has no accessible constructor");var Pn=ke.$[Xt.length];if(Pn===void 0)throw new ze(`Tried to invoke ctor of ${ve} with invalid number of parameters (${Xt.length}) - expected (${Object.keys(ke.$).toString()}) parameters instead!`);return Pn.apply(this,Xt)});var et=Object.create(Ke,{constructor:{value:xe}});xe.prototype=et;var ke=new z1(ve,xe,et,Ae,he,B,Y,re);if(ke.C){var mt;(mt=ke.C).oa??(mt.oa=[]),ke.C.oa.push(ke);}return he=new Nc(ve,ke,true,false,false),mt=new Nc(ve+"*",ke,false,false,false),Ke=new Nc(ve+" const*",ke,false,true,false),Ov[p]={pointerType:mt,Ib:Ke},Nv(J,xe),[he,mt,Ke]});},_embind_register_class_class_function:(p,m,w,T,$,B,K)=>{var Y=Fc(w,T);m=Rt(m),m=kf(m),B=cn($,B),In([],[p],se=>{function re(){zr(`Cannot call ${ve} due to unbound types`,Y);}se=se[0];var ve=`${se.name}.${m}`;m.startsWith("@@")&&(m=Symbol[m.substring(2)]);var Ee=se.i.constructor;return Ee[m]===void 0?(re.ea=w-1,Ee[m]=re):(Cf(Ee,m,ve),Ee[m].A[w-1]=re),In([],Y,Ae=>{if(Ae=Dc(ve,[Ae[0],null].concat(Ae.slice(1)),null,B,K),Ee[m].A===void 0?(Ae.ea=w-1,Ee[m]=Ae):Ee[m].A[w-1]=Ae,se.i.oa)for(const J of se.i.oa)J.constructor.hasOwnProperty(m)||(J.constructor[m]=Ae);return []}),[]});},_embind_register_class_class_property:(p,m,w,T,$,B,K,Y)=>{m=Rt(m),B=cn($,B),In([],[p],se=>{se=se[0];var re=`${se.name}.${m}`,ve={get(){zr(`Cannot access ${re} due to unbound types`,[w]);},enumerable:true,configurable:true};return ve.set=Y?()=>{zr(`Cannot access ${re} due to unbound types`,[w]);}:()=>{throw new ze(`${re} is a read-only property`)},Object.defineProperty(se.i.constructor,m,ve),In([],[w],Ee=>{Ee=Ee[0];var Ae={get(){return Ee.fromWireType(B(T))},enumerable:true};return Y&&(Y=cn(K,Y),Ae.set=J=>{var xe=[];Y(T,Ee.toWireType(xe,J)),hs(xe);}),Object.defineProperty(se.i.constructor,m,Ae),[]}),[]});},_embind_register_class_constructor:(p,m,w,T,$,B)=>{var K=Fc(m,w);$=cn(T,$),In([],[p],Y=>{Y=Y[0];var se=`constructor ${Y.name}`;if(Y.i.$===void 0&&(Y.i.$=[]),Y.i.$[m-1]!==void 0)throw new ze(`Cannot register multiple constructors with identical number of parameters (${m-1}) for class '${Y.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return Y.i.$[m-1]=()=>{zr(`Cannot construct ${Y.name} due to unbound types`,K);},In([],K,re=>(re.splice(1,0,null),Y.i.$[m-1]=Dc(se,re,null,$,B),[])),[]});},_embind_register_class_function:(p,m,w,T,$,B,K,Y)=>{var se=Fc(w,T);m=Rt(m),m=kf(m),B=cn($,B),In([],[p],re=>{function ve(){zr(`Cannot call ${Ee} due to unbound types`,se);}re=re[0];var Ee=`${re.name}.${m}`;m.startsWith("@@")&&(m=Symbol[m.substring(2)]),Y&&re.i.qb.push(m);var Ae=re.i.N,J=Ae[m];return J===void 0||J.A===void 0&&J.className!==re.name&&J.ea===w-2?(ve.ea=w-2,ve.className=re.name,Ae[m]=ve):(Cf(Ae,m,Ee),Ae[m].A[w-2]=ve),In([],se,xe=>(xe=Dc(Ee,xe,re,B,K),Ae[m].A===void 0?(xe.ea=w-2,Ae[m]=xe):Ae[m].A[w-2]=xe,[])),[]});},_embind_register_class_property:(p,m,w,T,$,B,K,Y,se,re)=>{m=Rt(m),$=cn(T,$),In([],[p],ve=>{ve=ve[0];var Ee=`${ve.name}.${m}`,Ae={get(){zr(`Cannot access ${Ee} due to unbound types`,[w,K]);},enumerable:true,configurable:true};return Ae.set=se?()=>zr(`Cannot access ${Ee} due to unbound types`,[w,K]):()=>{throw new ze(Ee+" is a read-only property")},Object.defineProperty(ve.i.N,m,Ae),In([],se?[w,K]:[w],J=>{var xe=J[0],he={get(){var et=Fv(this,ve,Ee+" getter");return xe.fromWireType($(B,et))},enumerable:true};if(se){se=cn(Y,se);var Ke=J[1];he.set=function(et){var ke=Fv(this,ve,Ee+" setter"),mt=[];se(re,ke,Ke.toWireType(mt,et)),hs(mt);};}return Object.defineProperty(ve.i.N,m,he),[]}),[]});},_embind_register_emval:p=>wr(p,X1),_embind_register_enum:(p,m,w,T)=>{function $(){}m=Rt(m),$.values={},wr(p,{name:m,constructor:$,fromWireType:function(B){return this.constructor.values[B]},toWireType:(B,K)=>K.value,argPackAdvance:8,readValueFromPointer:Y1(m,w,T),M:null}),Sf(m,$);},_embind_register_enum_value:(p,m,w)=>{var T=ps(p,"enum");m=Rt(m),p=T.constructor,T=Object.create(T.constructor.prototype,{value:{value:w},constructor:{value:Hi(`${T.name}_${m}`,function(){})}}),p.values[w]=T,p[m]=T;},_embind_register_float:(p,m,w)=>{m=Rt(m),wr(p,{name:m,fromWireType:T=>T,toWireType:(T,$)=>$,argPackAdvance:8,readValueFromPointer:J1(m,w),M:null});},_embind_register_function:(p,m,w,T,$,B)=>{var K=Fc(m,w);p=Rt(p),p=kf(p),$=cn(T,$),Sf(p,function(){zr(`Cannot call ${p} due to unbound types`,K);},m-1),In([],K,Y=>(Nv(p,Dc(p,[Y[0],null].concat(Y.slice(1)),null,$,B),m-1),[]));},_embind_register_integer:(p,m,w,T,$)=>{if(m=Rt(m),$===-1&&($=4294967295),$=Y=>Y,T===0){var B=32-8*w;$=Y=>Y<<B>>>B;}var K=m.includes("unsigned")?function(Y,se){return se>>>0}:function(Y,se){return se};wr(p,{name:m,fromWireType:$,toWireType:K,argPackAdvance:8,readValueFromPointer:Q1(m,w,T!==0),M:null});},_embind_register_memory_view:(p,m,w)=>{function T(B){return new $(ee.buffer,Q[B+4>>2],Q[B>>2])}var $=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][m];w=Rt(w),wr(p,{name:w,fromWireType:T,argPackAdvance:8,readValueFromPointer:T},{Wb:true});},_embind_register_std_string:(p,m)=>{m=Rt(m);var w=m==="std::string";wr(p,{name:m,fromWireType:function(T){var $=Q[T>>2],B=T+4;if(w)for(var K=B,Y=0;Y<=$;++Y){var se=B+Y;if(Y==$||U[se]==0){if(K=K?ye(U,K,se-K):"",re===void 0)var re=K;else re+="\0",re+=K;K=se+1;}}else {for(re=Array($),Y=0;Y<$;++Y)re[Y]=String.fromCharCode(U[B+Y]);re=re.join("");}return Ur(T),re},toWireType:function(T,$){$ instanceof ArrayBuffer&&($=new Uint8Array($));var B=typeof $=="string";if(!(B||$ instanceof Uint8Array||$ instanceof Uint8ClampedArray||$ instanceof Int8Array))throw new ze("Cannot pass non-string to std::string");var K=w&&B?ut($):$.length,Y=Lf(4+K+1),se=Y+4;if(Q[Y>>2]=K,w&&B)vt($,U,se,K+1);else if(B)for(B=0;B<K;++B){var re=$.charCodeAt(B);if(255<re)throw Ur(se),new ze("String has UTF-16 code units that do not fit in 8 bits");U[se+B]=re;}else for(B=0;B<K;++B)U[se+B]=$[B];return T!==null&&T.push(Ur,Y),Y},argPackAdvance:8,readValueFromPointer:gs,M(T){Ur(T);}});},_embind_register_std_wstring:(p,m,w)=>{if(w=Rt(w),m===2)var T=Z1,$=eA,B=tA,K=Y=>D[Y>>1];else m===4&&(T=nA,$=rA,B=oA,K=Y=>Q[Y>>2]);wr(p,{name:w,fromWireType:Y=>{for(var se=Q[Y>>2],re,ve=Y+4,Ee=0;Ee<=se;++Ee){var Ae=Y+4+Ee*m;(Ee==se||K(Ae)==0)&&(ve=T(ve,Ae-ve),re===void 0?re=ve:(re+="\0",re+=ve),ve=Ae+m);}return Ur(Y),re},toWireType:(Y,se)=>{if(typeof se!="string")throw new ze(`Cannot pass non-string to C++ string type ${w}`);var re=B(se),ve=Lf(4+re+m);return Q[ve>>2]=re/m,$(se,ve+4,re+m),Y!==null&&Y.push(Ur,ve),ve},argPackAdvance:8,readValueFromPointer:gs,M(Y){Ur(Y);}});},_embind_register_value_object:(p,m,w,T,$,B)=>{Rc[p]={name:Rt(m),Oa:cn(w,T),P:cn($,B),fb:[]};},_embind_register_value_object_field:(p,m,w,T,$,B,K,Y,se,re)=>{Rc[p].fb.push({Pb:Rt(m),Vb:w,Tb:cn(T,$),Ub:B,lc:K,kc:cn(Y,se),mc:re});},_embind_register_void:(p,m)=>{m=Rt(m),wr(p,{Jc:true,name:m,argPackAdvance:0,fromWireType:()=>{},toWireType:()=>{}});},_emscripten_get_now_is_monotonic:()=>1,_emscripten_memcpy_js:(p,m,w)=>U.copyWithin(p,m,m+w),_emscripten_throw_longjmp:()=>{throw 1/0},_emval_as:(p,m,w)=>(p=vr(p),m=ps(m,"emval::as"),jv(m,w,p)),_emval_call_method:(p,m,w,T,$)=>(p=If[p],m=vr(m),w=Tf(w),p(m,m[w],T,$)),_emval_decref:Ef,_emval_get_method_caller:(p,m,w)=>{var T=sA(p,m),$=T.shift();p--;var B=Array(p);return m=`methodCaller<(${T.map(K=>K.name).join(", ")}) => ${$.name}>`,aA(Hi(m,(K,Y,se,re)=>{for(var ve=0,Ee=0;Ee<p;++Ee)B[Ee]=T[Ee].readValueFromPointer(re+ve),ve+=T[Ee].argPackAdvance;return K=w===1?lA(Y,B):Y.apply(K,B),jv($,se,K)}))},_emval_get_module_property:p=>(p=Tf(p),yr(h[p])),_emval_get_property:(p,m)=>(p=vr(p),m=vr(m),yr(p[m])),_emval_incref:p=>{9<p&&(jr[p+1]+=1);},_emval_new_array:()=>yr([]),_emval_new_cstring:p=>yr(Tf(p)),_emval_new_object:()=>yr({}),_emval_run_destructors:p=>{var m=vr(p);hs(m),Ef(p);},_emval_set_property:(p,m,w)=>{p=vr(p),m=vr(m),w=vr(w),p[m]=w;},_emval_take_value:(p,m)=>(p=ps(p,"_emval_take_value"),p=p.readValueFromPointer(m),yr(p)),_gmtime_js:function(p,m,w){p=new Date(1e3*(m+2097152>>>0<4194305-!!p?(p>>>0)+4294967296*m:NaN)),j[w>>2]=p.getUTCSeconds(),j[w+4>>2]=p.getUTCMinutes(),j[w+8>>2]=p.getUTCHours(),j[w+12>>2]=p.getUTCDate(),j[w+16>>2]=p.getUTCMonth(),j[w+20>>2]=p.getUTCFullYear()-1900,j[w+24>>2]=p.getUTCDay(),j[w+28>>2]=(p.getTime()-Date.UTC(p.getUTCFullYear(),0,1,0,0,0,0))/864e5|0;},_localtime_js:function(p,m,w){p=new Date(1e3*(m+2097152>>>0<4194305-!!p?(p>>>0)+4294967296*m:NaN)),j[w>>2]=p.getSeconds(),j[w+4>>2]=p.getMinutes(),j[w+8>>2]=p.getHours(),j[w+12>>2]=p.getDate(),j[w+16>>2]=p.getMonth(),j[w+20>>2]=p.getFullYear()-1900,j[w+24>>2]=p.getDay(),j[w+28>>2]=(ms(p.getFullYear())?cA:dA)[p.getMonth()]+p.getDate()-1|0,j[w+36>>2]=-(60*p.getTimezoneOffset()),m=new Date(p.getFullYear(),6,1).getTimezoneOffset();var T=new Date(p.getFullYear(),0,1).getTimezoneOffset();j[w+32>>2]=(m!=T&&p.getTimezoneOffset()==Math.min(T,m))|0;},_tzset_js:(p,m,w,T)=>{var $=new Date().getFullYear(),B=new Date($,0,1),K=new Date($,6,1);$=B.getTimezoneOffset();var Y=K.getTimezoneOffset();Q[p>>2]=60*Math.max($,Y),j[m>>2]=+($!=Y),p=se=>se.toLocaleTimeString(void 0,{hour12:false,timeZoneName:"short"}).split(" ")[1],B=p(B),K=p(K),Y<$?(vt(B,U,w,17),vt(K,U,T,17)):(vt(B,U,T,17),vt(K,U,w,17));},emscripten_asm_const_int:(p,m,w)=>{Pf.length=0;for(var T;T=U[m++];){var $=T!=105;$&=T!=112,w+=$&&w%8?4:0,Pf.push(T==112?Q[w>>2]:T==105?j[w>>2]:le[w>>3]),w+=$?8:4;}return br[p](...Pf)},emscripten_date_now:()=>Date.now(),emscripten_get_now:()=>performance.now(),emscripten_resize_heap:p=>{var m=U.length;if(p>>>=0,2147483648<p)return  false;for(var w=1;4>=w;w*=2){var T=m*(1+.2/w);T=Math.min(T,p+100663296);var $=Math;T=Math.max(p,T);e:{$=($.min.call($,2147483648,T+(65536-T%65536)%65536)-ne.buffer.byteLength+65535)/65536;try{ne.grow($),we();var B=1;break e}catch{}B=void 0;}if(B)return  true}return  false},environ_get:(p,m)=>{var w=0;return Gv().forEach((T,$)=>{var B=m+w;for($=Q[p+4*$>>2]=B,B=0;B<T.length;++B)ee[$++]=T.charCodeAt(B);ee[$]=0,w+=T.length+1;}),0},environ_sizes_get:(p,m)=>{var w=Gv();Q[p>>2]=w.length;var T=0;return w.forEach($=>T+=$.length+1),Q[m>>2]=T,0},fd_close:function(p){try{var m=go(p);if(m.X===null)throw new Te(8);m.La&&(m.La=null);try{m.m.close&&m.m.close(m);}catch(w){throw w}finally{jn[m.X]=null;}return m.X=null,0}catch(w){if(typeof Uo>"u"||w.name!=="ErrnoError")throw w;return w.aa}},fd_read:function(p,m,w,T){try{e:{var $=go(p);p=m;for(var B,K=m=0;K<w;K++){var Y=Q[p>>2],se=Q[p+4>>2];p+=8;var re=$,ve=B,Ee=ee;if(0>se||0>ve)throw new Te(28);if(re.X===null)throw new Te(8);if((re.flags&2097155)===1)throw new Te(8);if((re.node.mode&61440)===16384)throw new Te(31);if(!re.m.read)throw new Te(28);var Ae=typeof ve<"u";if(!Ae)ve=re.position;else if(!re.seekable)throw new Te(70);var J=re.m.read(re,Ee,Y,se,ve);Ae||(re.position+=J);var xe=J;if(0>xe){var he=-1;break e}if(m+=xe,xe<se)break;typeof B<"u"&&(B+=xe);}he=m;}return Q[T>>2]=he,0}catch(Ke){if(typeof Uo>"u"||Ke.name!=="ErrnoError")throw Ke;return Ke.aa}},fd_seek:function(p,m,w,T,$){m=w+2097152>>>0<4194305-!!m?(m>>>0)+4294967296*w:NaN;try{if(isNaN(m))return 61;var B=go(p);return Ev(B,m,T),Cn=[B.position>>>0,(Ft=B.position,1<=+Math.abs(Ft)?0<Ft?+Math.floor(Ft/4294967296)>>>0:~~+Math.ceil((Ft-+(~~Ft>>>0))/4294967296)>>>0:0)],j[$>>2]=Cn[0],j[$+4>>2]=Cn[1],B.La&&m===0&&T===0&&(B.La=null),0}catch(K){if(typeof Uo>"u"||K.name!=="ErrnoError")throw K;return K.aa}},fd_write:function(p,m,w,T){try{e:{var $=go(p);p=m;for(var B,K=m=0;K<w;K++){var Y=Q[p>>2],se=Q[p+4>>2];p+=8;var re=$,ve=Y,Ee=se,Ae=B,J=ee;if(0>Ee||0>Ae)throw new Te(28);if(re.X===null)throw new Te(8);if((re.flags&2097155)===0)throw new Te(8);if((re.node.mode&61440)===16384)throw new Te(31);if(!re.m.write)throw new Te(28);re.seekable&&re.flags&1024&&Ev(re,0,2);var xe=typeof Ae<"u";if(!xe)Ae=re.position;else if(!re.seekable)throw new Te(70);var he=re.m.write(re,J,ve,Ee,Ae,void 0);xe||(re.position+=he);var Ke=he;if(0>Ke){var et=-1;break e}m+=Ke,typeof B<"u"&&(B+=Ke);}et=m;}return Q[T>>2]=et,0}catch(ke){if(typeof Uo>"u"||ke.name!=="ErrnoError")throw ke;return ke.aa}},invoke_vii:uA,isWindowsBrowser:function(){return  -1<navigator.platform.indexOf("Win")},strftime:Hv,strftime_l:(p,m,w,T)=>Hv(p,m,w,T)},xt=(function(){function p(w){return xt=w.exports,ne=xt.memory,we(),$v=xt.__indirect_function_table,Ve.unshift(xt.__wasm_call_ctors),St--,h.monitorRunDependencies?.(St),St==0&&qt&&(w=qt,qt=null,w()),xt}var m={env:Vv,wasi_snapshot_preview1:Vv};if(St++,h.monitorRunDependencies?.(St),h.instantiateWasm)try{return h.instantiateWasm(m,p)}catch(w){W(`Module.instantiateWasm callback failed with error: ${w}`),S(w);}return ft||(ft=nn("canvas_advanced.wasm")?"canvas_advanced.wasm":h.locateFile?h.locateFile("canvas_advanced.wasm",G):G+"canvas_advanced.wasm"),Et(m,function(w){p(w.instance);}).catch(S),{}})(),Ur=p=>(Ur=xt.free)(p),Lf=p=>(Lf=xt.malloc)(p),qv=p=>(qv=xt.__getTypeName)(p),Kv=h._ma_device__on_notification_unlocked=p=>(Kv=h._ma_device__on_notification_unlocked=xt.ma_device__on_notification_unlocked)(p);h._ma_malloc_emscripten=(p,m)=>(h._ma_malloc_emscripten=xt.ma_malloc_emscripten)(p,m),h._ma_free_emscripten=(p,m)=>(h._ma_free_emscripten=xt.ma_free_emscripten)(p,m);var Xv=h._ma_device_process_pcm_frames_capture__webaudio=(p,m,w)=>(Xv=h._ma_device_process_pcm_frames_capture__webaudio=xt.ma_device_process_pcm_frames_capture__webaudio)(p,m,w),Yv=h._ma_device_process_pcm_frames_playback__webaudio=(p,m,w)=>(Yv=h._ma_device_process_pcm_frames_playback__webaudio=xt.ma_device_process_pcm_frames_playback__webaudio)(p,m,w),Jv=(p,m)=>(Jv=xt.setThrew)(p,m),Qv=p=>(Qv=xt._emscripten_stack_restore)(p),Zv=()=>(Zv=xt.emscripten_stack_get_current)();h.dynCall_iiji=(p,m,w,T,$)=>(h.dynCall_iiji=xt.dynCall_iiji)(p,m,w,T,$),h.dynCall_jiji=(p,m,w,T,$)=>(h.dynCall_jiji=xt.dynCall_jiji)(p,m,w,T,$),h.dynCall_iiiji=(p,m,w,T,$,B)=>(h.dynCall_iiiji=xt.dynCall_iiiji)(p,m,w,T,$,B),h.dynCall_iij=(p,m,w,T)=>(h.dynCall_iij=xt.dynCall_iij)(p,m,w,T),h.dynCall_jii=(p,m,w)=>(h.dynCall_jii=xt.dynCall_jii)(p,m,w),h.dynCall_viijii=(p,m,w,T,$,B,K)=>(h.dynCall_viijii=xt.dynCall_viijii)(p,m,w,T,$,B,K),h.dynCall_iiiiij=(p,m,w,T,$,B,K)=>(h.dynCall_iiiiij=xt.dynCall_iiiiij)(p,m,w,T,$,B,K),h.dynCall_iiiiijj=(p,m,w,T,$,B,K,Y,se)=>(h.dynCall_iiiiijj=xt.dynCall_iiiiijj)(p,m,w,T,$,B,K,Y,se),h.dynCall_iiiiiijj=(p,m,w,T,$,B,K,Y,se,re)=>(h.dynCall_iiiiiijj=xt.dynCall_iiiiiijj)(p,m,w,T,$,B,K,Y,se,re);function uA(p,m,w){var T=Zv();try{_f(p)(m,w);}catch($){if(Qv(T),$!==$+0)throw $;Jv(1,0);}}var jc;qt=function p(){jc||ey(),jc||(qt=p);};function ey(){function p(){if(!jc&&(jc=true,h.calledRun=true,!ie)){if(h.noFSInit||Av||(Av=true,h.stdin=h.stdin,h.stdout=h.stdout,h.stderr=h.stderr,h.stdin?ls("stdin",h.stdin):gf("/dev/tty","/dev/stdin"),h.stdout?ls("stdout",null,h.stdout):gf("/dev/tty","/dev/stdout"),h.stderr?ls("stderr",null,h.stderr):gf("/dev/tty1","/dev/stderr"),Tc("/dev/stdin",0),Tc("/dev/stdout",1),Tc("/dev/stderr",1)),vv=false,Dn(Ve),y(h),h.onRuntimeInitialized&&h.onRuntimeInitialized(),h.postRun)for(typeof h.postRun=="function"&&(h.postRun=[h.postRun]);h.postRun.length;){var m=h.postRun.shift();kt.unshift(m);}Dn(kt);}}if(!(0<St)){if(h.preRun)for(typeof h.preRun=="function"&&(h.preRun=[h.preRun]);h.preRun.length;)mn();Dn(Ie),0<St||(h.setStatus?(h.setStatus("Running..."),setTimeout(function(){setTimeout(function(){h.setStatus("");},1),p();},1)):p());}}if(h.preInit)for(typeof h.preInit=="function"&&(h.preInit=[h.preInit]);0<h.preInit.length;)h.preInit.pop()();return ey(),g=C,g})})();const d=c;}),(a=>{a.exports=JSON.parse(`{"name":"@rive-app/canvas","version":"2.34.3","description":"Rive's canvas based web api.","main":"rive.js","homepage":"https://rive.app","repository":{"type":"git","url":"https://github.com/rive-app/rive-wasm/tree/master/js"},"keywords":["rive","animation"],"author":"Rive","contributors":["Luigi Rosso <luigi@rive.app> (https://rive.app)","Maxwell Talbot <max@rive.app> (https://rive.app)","Arthur Vivian <arthur@rive.app> (https://rive.app)","Umberto Sonnino <umberto@rive.app> (https://rive.app)","Matthew Sullivan <matt.j.sullivan@gmail.com> (mailto:matt.j.sullivan@gmail.com)"],"license":"MIT","files":["rive.js","rive.js.map","rive.wasm","rive_fallback.wasm","rive.d.ts","rive_advanced.mjs.d.ts"],"typings":"rive.d.ts","dependencies":{},"browser":{"fs":false,"path":false}}`);}),((a,s,l)=>{l.r(s),l.d(s,{Animation:()=>c.Animation});var c=l(4);}),((a,s,l)=>{l.r(s),l.d(s,{Animation:()=>c});var c=(function(){function d(u,f,g,h){this.animation=u,this.artboard=f,this.playing=h,this.loopCount=0,this.scrubTo=null,this.instance=new g.LinearAnimationInstance(u,f);}return Object.defineProperty(d.prototype,"name",{get:function(){return this.animation.name},enumerable:false,configurable:true}),Object.defineProperty(d.prototype,"time",{get:function(){return this.instance.time},set:function(u){this.instance.time=u;},enumerable:false,configurable:true}),Object.defineProperty(d.prototype,"loopValue",{get:function(){return this.animation.loopValue},enumerable:false,configurable:true}),Object.defineProperty(d.prototype,"needsScrub",{get:function(){return this.scrubTo!==null},enumerable:false,configurable:true}),d.prototype.advance=function(u){this.scrubTo===null?this.instance.advance(u):(this.instance.time=0,this.instance.advance(this.scrubTo),this.scrubTo=null);},d.prototype.apply=function(u){this.instance.apply(u);},d.prototype.cleanup=function(){this.instance.delete();},d})();}),((a,s,l)=>{l.r(s),l.d(s,{AudioAssetWrapper:()=>u.AudioAssetWrapper,AudioWrapper:()=>u.AudioWrapper,BLANK_URL:()=>d.BLANK_URL,CustomFileAssetLoaderWrapper:()=>u.CustomFileAssetLoaderWrapper,FileAssetWrapper:()=>u.FileAssetWrapper,FileFinalizer:()=>u.FileFinalizer,FontAssetWrapper:()=>u.FontAssetWrapper,FontWrapper:()=>u.FontWrapper,ImageAssetWrapper:()=>u.ImageAssetWrapper,ImageWrapper:()=>u.ImageWrapper,createFinalization:()=>u.createFinalization,finalizationRegistry:()=>u.finalizationRegistry,registerTouchInteractions:()=>c.registerTouchInteractions,sanitizeUrl:()=>d.sanitizeUrl});var c=l(6),d=l(7),u=l(8);}),((a,s,l)=>{l.r(s),l.d(s,{registerTouchInteractions:()=>u});var c=void 0,d=function(f,g,h){var y,S,C=[];if(["touchstart","touchmove"].indexOf(f.type)>-1&&(!((y=f.changedTouches)===null||y===void 0)&&y.length)){g||f.preventDefault();for(var _=0,E=h?f.changedTouches.length:1;_<E;){var P=f.changedTouches[_];C.push({clientX:P.clientX,clientY:P.clientY,identifier:P.identifier}),_++;}}else if(f.type==="touchend"&&(!((S=f.changedTouches)===null||S===void 0)&&S.length))for(var _=0,E=h?f.changedTouches.length:1;_<E;){var P=f.changedTouches[_];C.push({clientX:P.clientX,clientY:P.clientY,identifier:P.identifier}),_++;}else C.push({clientX:f.clientX,clientY:f.clientY,identifier:0});return C},u=function(f){var g=f.canvas,h=f.artboard,y=f.stateMachines,S=y===void 0?[]:y,C=f.renderer,_=f.rive,E=f.fit,P=f.alignment,O=f.isTouchScrollEnabled,k=O===void 0?false:O,I=f.dispatchPointerExit,R=I===void 0?true:I,A=f.enableMultiTouch,L=A===void 0?false:A,F=f.layoutScaleFactor,G=F===void 0?1:F;if(!g||!S.length||!C||!_||!h||typeof window>"u")return null;var q=null,H=false,ce=function(te){if(H&&te instanceof MouseEvent){te.type=="mouseup"&&(H=false);return}H=k&&te.type==="touchend"&&q==="touchstart",q=te.type;var ne=te.currentTarget.getBoundingClientRect(),ie=d(te,k,L),ee=_.computeAlignment(E,P,{minX:0,minY:0,maxX:ne.width,maxY:ne.height},h.bounds,G),U=new _.Mat2D;switch(ee.invert(U),ie.forEach(function(ft){var qe=ft.clientX,Qn=ft.clientY;if(!(!qe&&!Qn)){var Zn=qe-ne.left,Et=Qn-ne.top,Ft=new _.Vec2D(Zn,Et),Cn=_.mapXY(U,Ft),br=Cn.x(),Dn=Cn.y();ft.transformedX=br,ft.transformedY=Dn,Cn.delete(),Ft.delete();}}),U.delete(),ee.delete(),te.type){case "mouseout":for(var X=function(ft){R?ie.forEach(function(qe){ft.pointerExit(qe.transformedX,qe.transformedY,qe.identifier);}):ie.forEach(function(qe){ft.pointerMove(qe.transformedX,qe.transformedY,qe.identifier);});},D=0,j=S;D<j.length;D++){var Q=j[D];X(Q);}break;case "touchmove":case "mouseover":case "mousemove":{for(var ae=function(ft){ie.forEach(function(qe){ft.pointerMove(qe.transformedX,qe.transformedY,qe.identifier);});},le=0,we=S;le<we.length;le++){var Q=we[le];ae(Q);}break}case "touchstart":case "mousedown":{for(var Ie=function(ft){ie.forEach(function(qe){ft.pointerDown(qe.transformedX,qe.transformedY,qe.identifier);});},Ve=0,kt=S;Ve<kt.length;Ve++){var Q=kt[Ve];Ie(Q);}break}case "touchend":{for(var mn=function(ft){ie.forEach(function(qe){ft.pointerUp(qe.transformedX,qe.transformedY,qe.identifier),ft.pointerExit(qe.transformedX,qe.transformedY,qe.identifier);});},St=0,qt=S;St<qt.length;St++){var Q=qt[St];mn(Q);}break}case "mouseup":{for(var wn=function(ft){ie.forEach(function(qe){ft.pointerUp(qe.transformedX,qe.transformedY,qe.identifier);});},nn=0,xn=S;nn<xn.length;nn++){var Q=xn[nn];wn(Q);}break}}},W=ce.bind(c);return g.addEventListener("mouseover",W),g.addEventListener("mouseout",W),g.addEventListener("mousemove",W),g.addEventListener("mousedown",W),g.addEventListener("mouseup",W),g.addEventListener("touchmove",W,{passive:k}),g.addEventListener("touchstart",W,{passive:k}),g.addEventListener("touchend",W),function(){g.removeEventListener("mouseover",W),g.removeEventListener("mouseout",W),g.removeEventListener("mousemove",W),g.removeEventListener("mousedown",W),g.removeEventListener("mouseup",W),g.removeEventListener("touchmove",W),g.removeEventListener("touchstart",W),g.removeEventListener("touchend",W);}};}),((a,s,l)=>{l.r(s),l.d(s,{BLANK_URL:()=>y,sanitizeUrl:()=>_});var c=/^([^\w]*)(javascript|data|vbscript)/im,d=/&#(\w+)(^\w|;)?/g,u=/&(newline|tab);/gi,f=/[\u0000-\u001F\u007F-\u009F\u2000-\u200D\uFEFF]/gim,g=/^.+(:|&colon;)/gim,h=[".","/"],y="about:blank";function S(E){return h.indexOf(E[0])>-1}function C(E){var P=E.replace(f,"");return P.replace(d,function(O,k){return String.fromCharCode(k)})}function _(E){if(!E)return y;var P=C(E).replace(u,"").replace(f,"").trim();if(!P)return y;if(S(P))return P;var O=P.match(g);if(!O)return P;var k=O[0];return c.test(k)?y:P}}),((a,s,l)=>{l.r(s),l.d(s,{AudioAssetWrapper:()=>E,AudioWrapper:()=>h,CustomFileAssetLoaderWrapper:()=>S,FileAssetWrapper:()=>C,FileFinalizer:()=>d,FontAssetWrapper:()=>P,FontWrapper:()=>y,ImageAssetWrapper:()=>_,ImageWrapper:()=>g,createFinalization:()=>R,finalizationRegistry:()=>I});var c=(function(){var A=function(L,F){return A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(G,q){G.__proto__=q;}||function(G,q){for(var H in q)Object.prototype.hasOwnProperty.call(q,H)&&(G[H]=q[H]);},A(L,F)};return function(L,F){if(typeof F!="function"&&F!==null)throw new TypeError("Class extends value "+String(F)+" is not a constructor or null");A(L,F);function G(){this.constructor=L;}L.prototype=F===null?Object.create(F):(G.prototype=F.prototype,new G);}})(),d=(function(){function A(L){this.selfUnref=false,this._file=L;}return A.prototype.unref=function(){this._file&&this._file.unref();},A})(),u=(function(){function A(L){this._finalizableObject=L;}return A.prototype.unref=function(){this._finalizableObject.unref();},A})(),f=(function(){function A(){this.selfUnref=false;}return A.prototype.unref=function(){},A})(),g=(function(A){c(L,A);function L(F){var G=A.call(this)||this;return G._nativeImage=F,G}return Object.defineProperty(L.prototype,"nativeImage",{get:function(){return this._nativeImage},enumerable:false,configurable:true}),L.prototype.unref=function(){this.selfUnref&&this._nativeImage.unref();},L})(f),h=(function(A){c(L,A);function L(F){var G=A.call(this)||this;return G._nativeAudio=F,G}return Object.defineProperty(L.prototype,"nativeAudio",{get:function(){return this._nativeAudio},enumerable:false,configurable:true}),L.prototype.unref=function(){this.selfUnref&&this._nativeAudio.unref();},L})(f),y=(function(A){c(L,A);function L(F){var G=A.call(this)||this;return G._nativeFont=F,G}return Object.defineProperty(L.prototype,"nativeFont",{get:function(){return this._nativeFont},enumerable:false,configurable:true}),L.prototype.unref=function(){this.selfUnref&&this._nativeFont.unref();},L})(f),S=(function(){function A(L,F){this._assetLoaderCallback=F,this.assetLoader=new L.CustomFileAssetLoader({loadContents:this.loadContents.bind(this)});}return A.prototype.loadContents=function(L,F){var G;return L.isImage?G=new _(L):L.isAudio?G=new E(L):L.isFont&&(G=new P(L)),this._assetLoaderCallback(G,F)},A})(),C=(function(){function A(L){this._nativeFileAsset=L;}return A.prototype.decode=function(L){this._nativeFileAsset.decode(L);},Object.defineProperty(A.prototype,"name",{get:function(){return this._nativeFileAsset.name},enumerable:false,configurable:true}),Object.defineProperty(A.prototype,"fileExtension",{get:function(){return this._nativeFileAsset.fileExtension},enumerable:false,configurable:true}),Object.defineProperty(A.prototype,"uniqueFilename",{get:function(){return this._nativeFileAsset.uniqueFilename},enumerable:false,configurable:true}),Object.defineProperty(A.prototype,"isAudio",{get:function(){return this._nativeFileAsset.isAudio},enumerable:false,configurable:true}),Object.defineProperty(A.prototype,"isImage",{get:function(){return this._nativeFileAsset.isImage},enumerable:false,configurable:true}),Object.defineProperty(A.prototype,"isFont",{get:function(){return this._nativeFileAsset.isFont},enumerable:false,configurable:true}),Object.defineProperty(A.prototype,"cdnUuid",{get:function(){return this._nativeFileAsset.cdnUuid},enumerable:false,configurable:true}),Object.defineProperty(A.prototype,"nativeFileAsset",{get:function(){return this._nativeFileAsset},enumerable:false,configurable:true}),A})(),_=(function(A){c(L,A);function L(){return A!==null&&A.apply(this,arguments)||this}return L.prototype.setRenderImage=function(F){this._nativeFileAsset.setRenderImage(F.nativeImage);},L})(C),E=(function(A){c(L,A);function L(){return A!==null&&A.apply(this,arguments)||this}return L.prototype.setAudioSource=function(F){this._nativeFileAsset.setAudioSource(F.nativeAudio);},L})(C),P=(function(A){c(L,A);function L(){return A!==null&&A.apply(this,arguments)||this}return L.prototype.setFont=function(F){this._nativeFileAsset.setFont(F.nativeFont);},L})(C),O=(function(){function A(L){}return A.prototype.register=function(L){L.selfUnref=true;},A.prototype.unregister=function(L){},A})(),k=typeof FinalizationRegistry<"u"?FinalizationRegistry:O,I=new k(function(A){A?.unref();}),R=function(A,L){var F=new u(L);I.register(A,F);};})],r={};function o(a){var s=r[a];if(s!==void 0)return s.exports;var l=r[a]={exports:{}};return n[a](l,l.exports,o),l.exports}o.d=(a,s)=>{for(var l in s)o.o(s,l)&&!o.o(a,l)&&Object.defineProperty(a,l,{enumerable:true,get:s[l]});},o.o=(a,s)=>Object.prototype.hasOwnProperty.call(a,s),o.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:true});};var i={};return (()=>{o.r(i),o.d(i,{Alignment:()=>_,DataEnum:()=>we,DrawOptimizationOptions:()=>E,EventType:()=>H,Fit:()=>C,Layout:()=>P,LoopType:()=>ce,Rive:()=>ae,RiveEventType:()=>R,RiveFile:()=>Q,RuntimeLoader:()=>O,StateMachineInput:()=>I,StateMachineInputType:()=>k,Testing:()=>Ft,ViewModel:()=>le,ViewModelInstance:()=>Ve,ViewModelInstanceArtboard:()=>Qn,ViewModelInstanceAssetImage:()=>qe,ViewModelInstanceBoolean:()=>qt,ViewModelInstanceColor:()=>ft,ViewModelInstanceEnum:()=>nn,ViewModelInstanceList:()=>xn,ViewModelInstanceNumber:()=>St,ViewModelInstanceString:()=>mn,ViewModelInstanceTrigger:()=>wn,ViewModelInstanceValue:()=>kt,decodeAudio:()=>Cn,decodeFont:()=>Dn,decodeImage:()=>br});var a=o(1),s=o(2),l=o(3),c=o(5),d=(function(){var M=function(b,v){return M=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(N,z){N.__proto__=z;}||function(N,z){for(var V in z)Object.prototype.hasOwnProperty.call(z,V)&&(N[V]=z[V]);},M(b,v)};return function(b,v){if(typeof v!="function"&&v!==null)throw new TypeError("Class extends value "+String(v)+" is not a constructor or null");M(b,v);function N(){this.constructor=b;}b.prototype=v===null?Object.create(v):(N.prototype=v.prototype,new N);}})(),u=function(){return u=Object.assign||function(M){for(var b,v=1,N=arguments.length;v<N;v++){b=arguments[v];for(var z in b)Object.prototype.hasOwnProperty.call(b,z)&&(M[z]=b[z]);}return M},u.apply(this,arguments)},f=function(M,b,v,N){function z(V){return V instanceof v?V:new v(function(Z){Z(V);})}return new(v||(v=Promise))(function(V,Z){function pe(Se){try{ye(N.next(Se));}catch(ut){Z(ut);}}function Ce(Se){try{ye(N.throw(Se));}catch(ut){Z(ut);}}function ye(Se){Se.done?V(Se.value):z(Se.value).then(pe,Ce);}ye((N=N.apply(M,[])).next());})},g=function(M,b){var v={label:0,sent:function(){if(V[0]&1)throw V[1];return V[1]},trys:[],ops:[]},N,z,V,Z=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return Z.next=pe(0),Z.throw=pe(1),Z.return=pe(2),typeof Symbol=="function"&&(Z[Symbol.iterator]=function(){return this}),Z;function pe(ye){return function(Se){return Ce([ye,Se])}}function Ce(ye){if(N)throw new TypeError("Generator is already executing.");for(;Z&&(Z=0,ye[0]&&(v=0)),v;)try{if(N=1,z&&(V=ye[0]&2?z.return:ye[0]?z.throw||((V=z.return)&&V.call(z),0):z.next)&&!(V=V.call(z,ye[1])).done)return V;switch(z=0,V&&(ye=[ye[0]&2,V.value]),ye[0]){case 0:case 1:V=ye;break;case 4:return v.label++,{value:ye[1],done:!1};case 5:v.label++,z=ye[1],ye=[0];continue;case 7:ye=v.ops.pop(),v.trys.pop();continue;default:if(V=v.trys,!(V=V.length>0&&V[V.length-1])&&(ye[0]===6||ye[0]===2)){v=0;continue}if(ye[0]===3&&(!V||ye[1]>V[0]&&ye[1]<V[3])){v.label=ye[1];break}if(ye[0]===6&&v.label<V[1]){v.label=V[1],V=ye;break}if(V&&v.label<V[2]){v.label=V[2],v.ops.push(ye);break}V[2]&&v.ops.pop(),v.trys.pop();continue}ye=b.call(M,v);}catch(Se){ye=[6,Se],z=0;}finally{N=V=0;}if(ye[0]&5)throw ye[1];return {value:ye[0]?ye[1]:void 0,done:true}}},h=function(M,b,v){for(var N=0,z=b.length,V;N<z;N++)(V||!(N in b))&&(V||(V=Array.prototype.slice.call(b,0,N)),V[N]=b[N]);return M.concat(V||Array.prototype.slice.call(b))},y=(function(M){d(b,M);function b(){var v=M!==null&&M.apply(this,arguments)||this;return v.isHandledError=true,v}return b})(Error),S=function(M){return M&&M.isHandledError?M.message:"Problem loading file; may be corrupt!"},C;(function(M){M.Cover="cover",M.Contain="contain",M.Fill="fill",M.FitWidth="fitWidth",M.FitHeight="fitHeight",M.None="none",M.ScaleDown="scaleDown",M.Layout="layout";})(C||(C={}));var _;(function(M){M.Center="center",M.TopLeft="topLeft",M.TopCenter="topCenter",M.TopRight="topRight",M.CenterLeft="centerLeft",M.CenterRight="centerRight",M.BottomLeft="bottomLeft",M.BottomCenter="bottomCenter",M.BottomRight="bottomRight";})(_||(_={}));var E;(function(M){M.AlwaysDraw="alwaysDraw",M.DrawOnChanged="drawOnChanged";})(E||(E={}));var P=(function(){function M(b){var v,N,z,V,Z,pe,Ce;this.fit=(v=b?.fit)!==null&&v!==void 0?v:C.Contain,this.alignment=(N=b?.alignment)!==null&&N!==void 0?N:_.Center,this.layoutScaleFactor=(z=b?.layoutScaleFactor)!==null&&z!==void 0?z:1,this.minX=(V=b?.minX)!==null&&V!==void 0?V:0,this.minY=(Z=b?.minY)!==null&&Z!==void 0?Z:0,this.maxX=(pe=b?.maxX)!==null&&pe!==void 0?pe:0,this.maxY=(Ce=b?.maxY)!==null&&Ce!==void 0?Ce:0;}return M.new=function(b){var v=b.fit,N=b.alignment,z=b.minX,V=b.minY,Z=b.maxX,pe=b.maxY;return console.warn("This function is deprecated: please use `new Layout({})` instead"),new M({fit:v,alignment:N,minX:z,minY:V,maxX:Z,maxY:pe})},M.prototype.copyWith=function(b){var v=b.fit,N=b.alignment,z=b.layoutScaleFactor,V=b.minX,Z=b.minY,pe=b.maxX,Ce=b.maxY;return new M({fit:v??this.fit,alignment:N??this.alignment,layoutScaleFactor:z??this.layoutScaleFactor,minX:V??this.minX,minY:Z??this.minY,maxX:pe??this.maxX,maxY:Ce??this.maxY})},M.prototype.runtimeFit=function(b){if(this.cachedRuntimeFit)return this.cachedRuntimeFit;var v;return this.fit===C.Cover?v=b.Fit.cover:this.fit===C.Contain?v=b.Fit.contain:this.fit===C.Fill?v=b.Fit.fill:this.fit===C.FitWidth?v=b.Fit.fitWidth:this.fit===C.FitHeight?v=b.Fit.fitHeight:this.fit===C.ScaleDown?v=b.Fit.scaleDown:this.fit===C.Layout?v=b.Fit.layout:v=b.Fit.none,this.cachedRuntimeFit=v,v},M.prototype.runtimeAlignment=function(b){if(this.cachedRuntimeAlignment)return this.cachedRuntimeAlignment;var v;return this.alignment===_.TopLeft?v=b.Alignment.topLeft:this.alignment===_.TopCenter?v=b.Alignment.topCenter:this.alignment===_.TopRight?v=b.Alignment.topRight:this.alignment===_.CenterLeft?v=b.Alignment.centerLeft:this.alignment===_.CenterRight?v=b.Alignment.centerRight:this.alignment===_.BottomLeft?v=b.Alignment.bottomLeft:this.alignment===_.BottomCenter?v=b.Alignment.bottomCenter:this.alignment===_.BottomRight?v=b.Alignment.bottomRight:v=b.Alignment.center,this.cachedRuntimeAlignment=v,v},M})(),O=(function(){function M(){}return M.loadRuntime=function(){a.default({locateFile:function(){return M.wasmURL}}).then(function(b){var v;for(M.runtime=b;M.callBackQueue.length>0;)(v=M.callBackQueue.shift())===null||v===void 0||v(M.runtime);}).catch(function(b){var v={message:b?.message||"Unknown error",type:b?.name||"Error",wasmError:b instanceof WebAssembly.CompileError||b instanceof WebAssembly.RuntimeError,originalError:b};console.debug("Rive WASM load error details:",v);var N="https://cdn.jsdelivr.net/npm/".concat(s.name,"@").concat(s.version,"/rive_fallback.wasm");if(M.wasmURL.toLowerCase()!==N)console.warn("Failed to load WASM from ".concat(M.wasmURL," (").concat(v.message,"), trying jsdelivr as a backup")),M.setWasmUrl(N),M.loadRuntime();else {var z=["Could not load Rive WASM file from ".concat(M.wasmURL," or ").concat(N,"."),"Possible reasons:","- Network connection is down","- WebAssembly is not supported in this environment","- The WASM file is corrupted or incompatible",`
Error details:`,"- Type: ".concat(v.type),"- Message: ".concat(v.message),"- WebAssembly-specific error: ".concat(v.wasmError),`
To resolve, you may need to:`,"1. Check your network connection","2. Set a new WASM source via RuntimeLoader.setWasmUrl()","3. Call RuntimeLoader.loadRuntime() again"].join(`
`);console.error(z);}});},M.getInstance=function(b){M.isLoading||(M.isLoading=true,M.loadRuntime()),M.runtime?b(M.runtime):M.callBackQueue.push(b);},M.awaitInstance=function(){return new Promise(function(b){return M.getInstance(function(v){return b(v)})})},M.setWasmUrl=function(b){M.wasmURL=b;},M.getWasmUrl=function(){return M.wasmURL},M.isLoading=false,M.callBackQueue=[],M.wasmURL="https://unpkg.com/".concat(s.name,"@").concat(s.version,"/rive.wasm"),M})(),k;(function(M){M[M.Number=56]="Number",M[M.Trigger=58]="Trigger",M[M.Boolean=59]="Boolean";})(k||(k={}));var I=(function(){function M(b,v){this.type=b,this.runtimeInput=v;}return Object.defineProperty(M.prototype,"name",{get:function(){return this.runtimeInput.name},enumerable:false,configurable:true}),Object.defineProperty(M.prototype,"value",{get:function(){return this.runtimeInput.value},set:function(b){this.runtimeInput.value=b;},enumerable:false,configurable:true}),M.prototype.fire=function(){this.type===k.Trigger&&this.runtimeInput.fire();},M.prototype.delete=function(){this.runtimeInput=null;},M})(),R;(function(M){M[M.General=128]="General",M[M.OpenUrl=131]="OpenUrl";})(R||(R={}));var A=(function(){function M(b){this.isBindableArtboard=false,this.isBindableArtboard=b;}return M})(),L=(function(M){d(b,M);function b(v,N){var z=M.call(this,false)||this;return z.nativeArtboard=v,z.file=N,z}return b})(A),F=(function(M){d(b,M);function b(v){var N=M.call(this,true)||this;return N.selfUnref=false,N.nativeArtboard=v,N}return Object.defineProperty(b.prototype,"viewModel",{set:function(v){this.nativeViewModel=v.nativeInstance;},enumerable:false,configurable:true}),b.prototype.destroy=function(){var v;this.selfUnref&&(this.nativeArtboard.unref(),(v=this.nativeViewModel)===null||v===void 0||v.unref());},b})(A),G=(function(){function M(b,v,N,z){this.stateMachine=b,this.playing=N,this.artboard=z,this.inputs=[],this.instance=new v.StateMachineInstance(b,z),this.initInputs(v);}return Object.defineProperty(M.prototype,"name",{get:function(){return this.stateMachine.name},enumerable:false,configurable:true}),Object.defineProperty(M.prototype,"statesChanged",{get:function(){for(var b=[],v=0;v<this.instance.stateChangedCount();v++)b.push(this.instance.stateChangedNameByIndex(v));return b},enumerable:false,configurable:true}),M.prototype.advance=function(b){this.instance.advance(b);},M.prototype.advanceAndApply=function(b){this.instance.advanceAndApply(b);},M.prototype.reportedEventCount=function(){return this.instance.reportedEventCount()},M.prototype.reportedEventAt=function(b){return this.instance.reportedEventAt(b)},M.prototype.initInputs=function(b){for(var v=0;v<this.instance.inputCount();v++){var N=this.instance.input(v);this.inputs.push(this.mapRuntimeInput(N,b));}},M.prototype.mapRuntimeInput=function(b,v){if(b.type===v.SMIInput.bool)return new I(k.Boolean,b.asBool());if(b.type===v.SMIInput.number)return new I(k.Number,b.asNumber());if(b.type===v.SMIInput.trigger)return new I(k.Trigger,b.asTrigger())},M.prototype.cleanup=function(){this.inputs.forEach(function(b){b.delete();}),this.inputs.length=0,this.instance.delete();},M.prototype.bindViewModelInstance=function(b){b.runtimeInstance!=null&&this.instance.bindViewModelInstance(b.runtimeInstance);},M})(),q=(function(){function M(b,v,N,z,V){z===void 0&&(z=[]),V===void 0&&(V=[]),this.runtime=b,this.artboard=v,this.eventManager=N,this.animations=z,this.stateMachines=V;}return M.prototype.add=function(b,v,N){if(N===void 0&&(N=true),b=Et(b),b.length===0)this.animations.forEach(function(it){return it.playing=v}),this.stateMachines.forEach(function(it){return it.playing=v});else for(var z=this.animations.map(function(it){return it.name}),V=this.stateMachines.map(function(it){return it.name}),Z=0;Z<b.length;Z++){var pe=z.indexOf(b[Z]),Ce=V.indexOf(b[Z]);if(pe>=0||Ce>=0)pe>=0?this.animations[pe].playing=v:this.stateMachines[Ce].playing=v;else {var ye=this.artboard.animationByName(b[Z]);if(ye){var Se=new l.Animation(ye,this.artboard,this.runtime,v);Se.advance(0),Se.apply(1),this.animations.push(Se);}else {var ut=this.artboard.stateMachineByName(b[Z]);if(ut){var vt=new G(ut,this.runtime,v,this.artboard);this.stateMachines.push(vt);}}}}return N&&(v?this.eventManager.fire({type:H.Play,data:this.playing}):this.eventManager.fire({type:H.Pause,data:this.paused})),v?this.playing:this.paused},M.prototype.initLinearAnimations=function(b,v){for(var N=this.animations.map(function(Ce){return Ce.name}),z=0;z<b.length;z++){var V=N.indexOf(b[z]);if(V>=0)this.animations[V].playing=v;else {var Z=this.artboard.animationByName(b[z]);if(Z){var pe=new l.Animation(Z,this.artboard,this.runtime,v);pe.advance(0),pe.apply(1),this.animations.push(pe);}else console.error("Animation with name ".concat(b[z]," not found."));}}},M.prototype.initStateMachines=function(b,v){for(var N=this.stateMachines.map(function(Ce){return Ce.name}),z=0;z<b.length;z++){var V=N.indexOf(b[z]);if(V>=0)this.stateMachines[V].playing=v;else {var Z=this.artboard.stateMachineByName(b[z]);if(Z){var pe=new G(Z,this.runtime,v,this.artboard);this.stateMachines.push(pe);}else console.warn("State Machine with name ".concat(b[z]," not found.")),this.initLinearAnimations([b[z]],v);}}},M.prototype.play=function(b){return this.add(b,true)},M.prototype.advanceIfPaused=function(){this.stateMachines.forEach(function(b){b.playing||b.advanceAndApply(0);});},M.prototype.pause=function(b){return this.add(b,false)},M.prototype.scrub=function(b,v){var N=this.animations.filter(function(z){return b.includes(z.name)});return N.forEach(function(z){return z.scrubTo=v}),N.map(function(z){return z.name})},Object.defineProperty(M.prototype,"playing",{get:function(){return this.animations.filter(function(b){return b.playing}).map(function(b){return b.name}).concat(this.stateMachines.filter(function(b){return b.playing}).map(function(b){return b.name}))},enumerable:false,configurable:true}),Object.defineProperty(M.prototype,"paused",{get:function(){return this.animations.filter(function(b){return !b.playing}).map(function(b){return b.name}).concat(this.stateMachines.filter(function(b){return !b.playing}).map(function(b){return b.name}))},enumerable:false,configurable:true}),M.prototype.stop=function(b){var v=this;b=Et(b);var N=[];if(b.length===0)N=this.animations.map(function(Z){return Z.name}).concat(this.stateMachines.map(function(Z){return Z.name})),this.animations.forEach(function(Z){return Z.cleanup()}),this.stateMachines.forEach(function(Z){return Z.cleanup()}),this.animations.splice(0,this.animations.length),this.stateMachines.splice(0,this.stateMachines.length);else {var z=this.animations.filter(function(Z){return b.includes(Z.name)});z.forEach(function(Z){Z.cleanup(),v.animations.splice(v.animations.indexOf(Z),1);});var V=this.stateMachines.filter(function(Z){return b.includes(Z.name)});V.forEach(function(Z){Z.cleanup(),v.stateMachines.splice(v.stateMachines.indexOf(Z),1);}),N=z.map(function(Z){return Z.name}).concat(V.map(function(Z){return Z.name}));}return this.eventManager.fire({type:H.Stop,data:N}),N},Object.defineProperty(M.prototype,"isPlaying",{get:function(){return this.animations.reduce(function(b,v){return b||v.playing},false)||this.stateMachines.reduce(function(b,v){return b||v.playing},false)},enumerable:false,configurable:true}),Object.defineProperty(M.prototype,"isPaused",{get:function(){return !this.isPlaying&&(this.animations.length>0||this.stateMachines.length>0)},enumerable:false,configurable:true}),Object.defineProperty(M.prototype,"isStopped",{get:function(){return this.animations.length===0&&this.stateMachines.length===0},enumerable:false,configurable:true}),M.prototype.atLeastOne=function(b,v){v===void 0&&(v=true);var N;return this.animations.length===0&&this.stateMachines.length===0&&(this.artboard.animationCount()>0?this.add([N=this.artboard.animationByIndex(0).name],b,v):this.artboard.stateMachineCount()>0&&this.add([N=this.artboard.stateMachineByIndex(0).name],b,v)),N},M.prototype.handleLooping=function(){for(var b=0,v=this.animations.filter(function(z){return z.playing});b<v.length;b++){var N=v[b];N.loopValue===0&&N.loopCount?(N.loopCount=0,this.stop(N.name)):N.loopValue===1&&N.loopCount?(this.eventManager.fire({type:H.Loop,data:{animation:N.name,type:ce.Loop}}),N.loopCount=0):N.loopValue===2&&N.loopCount>1&&(this.eventManager.fire({type:H.Loop,data:{animation:N.name,type:ce.PingPong}}),N.loopCount=0);}},M.prototype.handleStateChanges=function(){for(var b=[],v=0,N=this.stateMachines.filter(function(V){return V.playing});v<N.length;v++){var z=N[v];b.push.apply(b,z.statesChanged);}b.length>0&&this.eventManager.fire({type:H.StateChange,data:b});},M.prototype.handleAdvancing=function(b){this.eventManager.fire({type:H.Advance,data:b});},M})(),H;(function(M){M.Load="load",M.LoadError="loaderror",M.Play="play",M.Pause="pause",M.Stop="stop",M.Loop="loop",M.Draw="draw",M.Advance="advance",M.StateChange="statechange",M.RiveEvent="riveevent",M.AudioStatusChange="audiostatuschange";})(H||(H={}));var ce;(function(M){M.OneShot="oneshot",M.Loop="loop",M.PingPong="pingpong";})(ce||(ce={}));var W=(function(){function M(b){b===void 0&&(b=[]),this.listeners=b;}return M.prototype.getListeners=function(b){return this.listeners.filter(function(v){return v.type===b})},M.prototype.add=function(b){this.listeners.includes(b)||this.listeners.push(b);},M.prototype.remove=function(b){for(var v=0;v<this.listeners.length;v++){var N=this.listeners[v];if(N.type===b.type&&N.callback===b.callback){this.listeners.splice(v,1);break}}},M.prototype.removeAll=function(b){var v=this;b?this.listeners.filter(function(N){return N.type===b}).forEach(function(N){return v.remove(N)}):this.listeners.splice(0,this.listeners.length);},M.prototype.fire=function(b){var v=this.getListeners(b.type);v.forEach(function(N){return N.callback(b)});},M})(),te=(function(){function M(b){this.eventManager=b,this.queue=[];}return M.prototype.add=function(b){this.queue.push(b);},M.prototype.process=function(){for(;this.queue.length>0;){var b=this.queue.shift();b?.action&&b.action(),b?.event&&this.eventManager.fire(b.event);}},M})(),ne;(function(M){M[M.AVAILABLE=0]="AVAILABLE",M[M.UNAVAILABLE=1]="UNAVAILABLE";})(ne||(ne={}));var ie=(function(M){d(b,M);function b(){var v=M!==null&&M.apply(this,arguments)||this;return v._started=false,v._enabled=false,v._status=ne.UNAVAILABLE,v}return b.prototype.delay=function(v){return f(this,void 0,void 0,function(){return g(this,function(N){return [2,new Promise(function(z){return setTimeout(z,v)})]})})},b.prototype.timeout=function(){return f(this,void 0,void 0,function(){return g(this,function(v){return [2,new Promise(function(N,z){return setTimeout(z,50)})]})})},b.prototype.reportToListeners=function(){this.fire({type:H.AudioStatusChange}),this.removeAll();},b.prototype.enableAudio=function(){return f(this,void 0,void 0,function(){return g(this,function(v){return this._enabled||(this._enabled=true,this._status=ne.AVAILABLE,this.reportToListeners()),[2]})})},b.prototype.testAudio=function(){return f(this,void 0,void 0,function(){return g(this,function(v){switch(v.label){case 0:if(!(this._status===ne.UNAVAILABLE&&this._audioContext!==null))return [3,4];v.label=1;case 1:return v.trys.push([1,3,,4]),[4,Promise.race([this._audioContext.resume(),this.timeout()])];case 2:return v.sent(),this.enableAudio(),[3,4];case 3:return v.sent(),[3,4];case 4:return [2]}})})},b.prototype._establishAudio=function(){return f(this,void 0,void 0,function(){return g(this,function(v){switch(v.label){case 0:return this._started?[3,5]:(this._started=true,typeof window>"u"?(this.enableAudio(),[3,5]):[3,1]);case 1:this._audioContext=new AudioContext,this.listenForUserAction(),v.label=2;case 2:return this._status!==ne.UNAVAILABLE?[3,5]:[4,this.testAudio()];case 3:return v.sent(),[4,this.delay(1e3)];case 4:return v.sent(),[3,2];case 5:return [2]}})})},b.prototype.listenForUserAction=function(){var v=this,N=function(){return f(v,void 0,void 0,function(){return g(this,function(z){return this.enableAudio(),[2]})})};document.addEventListener("pointerdown",N,{once:true});},b.prototype.establishAudio=function(){return f(this,void 0,void 0,function(){return g(this,function(v){return this._establishAudio(),[2]})})},Object.defineProperty(b.prototype,"systemVolume",{get:function(){return this._status===ne.UNAVAILABLE?(this.testAudio(),0):1},enumerable:false,configurable:true}),Object.defineProperty(b.prototype,"status",{get:function(){return this._status},enumerable:false,configurable:true}),b})(W),ee=new ie,U=(function(){function M(){}return M.prototype.observe=function(){},M.prototype.unobserve=function(){},M.prototype.disconnect=function(){},M})(),X=globalThis.ResizeObserver||U,D=(function(){function M(){var b=this;this._elementsMap=new Map,this._onObservedEntry=function(v){var N=b._elementsMap.get(v.target);N!==null?N.onResize(v.target.clientWidth==0||v.target.clientHeight==0):b._resizeObserver.unobserve(v.target);},this._onObserved=function(v){v.forEach(b._onObservedEntry);},this._resizeObserver=new X(this._onObserved);}return M.prototype.add=function(b,v){var N={onResize:v,element:b};return this._elementsMap.set(b,N),this._resizeObserver.observe(b),N},M.prototype.remove=function(b){this._resizeObserver.unobserve(b.element),this._elementsMap.delete(b.element);},M})(),j=new D,Q=(function(){function M(b){this.enableRiveAssetCDN=true,this.referenceCount=0,this.destroyed=false,this.selfUnref=false,this.bindableArtboards=[],this.src=b.src,this.buffer=b.buffer,b.assetLoader&&(this.assetLoader=b.assetLoader),this.enableRiveAssetCDN=typeof b.enableRiveAssetCDN=="boolean"?b.enableRiveAssetCDN:true,this.eventManager=new W,b.onLoad&&this.on(H.Load,b.onLoad),b.onLoadError&&this.on(H.LoadError,b.onLoadError);}return M.prototype.releaseFile=function(){var b;this.selfUnref&&((b=this.file)===null||b===void 0||b.unref()),this.file=null;},M.prototype.releaseBindableArtboards=function(){this.bindableArtboards.forEach(function(b){return b.destroy()});},M.prototype.initData=function(){return f(this,void 0,void 0,function(){var b,v,N,z,V;return g(this,function(Z){switch(Z.label){case 0:return this.src?(b=this,[4,Zn(this.src)]):[3,2];case 1:b.buffer=Z.sent(),Z.label=2;case 2:return this.destroyed?[2]:(this.assetLoader&&(N=new c.CustomFileAssetLoaderWrapper(this.runtime,this.assetLoader),v=N.assetLoader),z=this,[4,this.runtime.load(new Uint8Array(this.buffer),v,this.enableRiveAssetCDN)]);case 3:return z.file=Z.sent(),V=new c.FileFinalizer(this.file),c.finalizationRegistry.register(this,V),this.destroyed?(this.releaseFile(),[2]):(this.file!==null?this.eventManager.fire({type:H.Load,data:this}):this.fireLoadError(M.fileLoadErrorMessage),[2])}})})},M.prototype.init=function(){return f(this,void 0,void 0,function(){var b,v;return g(this,function(N){switch(N.label){case 0:if(!this.src&&!this.buffer)return this.fireLoadError(M.missingErrorMessage),[2];N.label=1;case 1:return N.trys.push([1,4,,5]),b=this,[4,O.awaitInstance()];case 2:return b.runtime=N.sent(),this.destroyed?[2]:[4,this.initData()];case 3:return N.sent(),[3,5];case 4:return v=N.sent(),this.fireLoadError(v instanceof Error?v.message:M.fileLoadErrorMessage),[3,5];case 5:return [2]}})})},M.prototype.fireLoadError=function(b){throw this.eventManager.fire({type:H.LoadError,data:b}),new Error(b)},M.prototype.on=function(b,v){this.eventManager.add({type:b,callback:v});},M.prototype.off=function(b,v){this.eventManager.remove({type:b,callback:v});},M.prototype.cleanup=function(){this.referenceCount-=1,this.referenceCount<=0&&(this.removeAllRiveEventListeners(),this.releaseFile(),this.releaseBindableArtboards(),this.destroyed=true);},M.prototype.removeAllRiveEventListeners=function(b){this.eventManager.removeAll(b);},M.prototype.getInstance=function(){if(this.file!==null)return this.referenceCount+=1,this.file},M.prototype.destroyIfUnused=function(){this.referenceCount<=0&&this.cleanup();},M.prototype.createBindableArtboard=function(b){if(b!=null){var v=new F(b);return (0, c.createFinalization)(v,v.nativeArtboard),this.bindableArtboards.push(v),v}return null},M.prototype.getArtboard=function(b){var v=this.file.artboardByName(b);if(v!=null)return new L(v,this)},M.prototype.getBindableArtboard=function(b){var v=this.file.bindableArtboardByName(b);return this.createBindableArtboard(v)},M.prototype.getDefaultBindableArtboard=function(){var b=this.file.bindableArtboardDefault();return this.createBindableArtboard(b)},M.prototype.internalBindableArtboardFromArtboard=function(b){var v=this.file.internalBindableArtboardFromArtboard(b);return this.createBindableArtboard(v)},M.prototype.viewModelByName=function(b){var v=this.file.viewModelByName(b);return v!==null?new le(v):null},M.missingErrorMessage="Rive source file or data buffer required",M.fileLoadErrorMessage="The file failed to load",M})(),ae=(function(){function M(b){var v=this,N,z;this.loaded=false,this.destroyed=false,this._observed=null,this.readyForPlaying=false,this.artboard=null,this.eventCleanup=null,this.shouldDisableRiveListeners=false,this.automaticallyHandleEvents=false,this.dispatchPointerExit=true,this.enableMultiTouch=false,this.enableRiveAssetCDN=true,this._volume=1,this._artboardWidth=void 0,this._artboardHeight=void 0,this._devicePixelRatioUsed=1,this._hasZeroSize=false,this._needsRedraw=false,this._currentCanvasWidth=0,this._currentCanvasHeight=0,this._audioEventListener=null,this._boundDraw=null,this._viewModelInstance=null,this._dataEnums=null,this.drawOptimization=E.DrawOnChanged,this.durations=[],this.frameTimes=[],this.frameCount=0,this.isTouchScrollEnabled=false,this.onCanvasResize=function(V){var Z=v._hasZeroSize!==V;v._hasZeroSize=V,V?(!v._layout.maxX||!v._layout.maxY)&&v.resizeToCanvas():Z&&v.resizeDrawingSurfaceToCanvas();},this.renderSecondTimer=0,this._boundDraw=this.draw.bind(this),this.canvas=b.canvas,b.canvas.constructor===HTMLCanvasElement&&(this._observed=j.add(this.canvas,this.onCanvasResize)),this._currentCanvasWidth=this.canvas.width,this._currentCanvasHeight=this.canvas.height,this.src=b.src,this.buffer=b.buffer,this.riveFile=b.riveFile,this.layout=(N=b.layout)!==null&&N!==void 0?N:new P,this.shouldDisableRiveListeners=!!b.shouldDisableRiveListeners,this.isTouchScrollEnabled=!!b.isTouchScrollEnabled,this.automaticallyHandleEvents=!!b.automaticallyHandleEvents,this.dispatchPointerExit=b.dispatchPointerExit===false?b.dispatchPointerExit:this.dispatchPointerExit,this.enableMultiTouch=!!b.enableMultiTouch,this.drawOptimization=(z=b.drawingOptions)!==null&&z!==void 0?z:this.drawOptimization,this.enableRiveAssetCDN=b.enableRiveAssetCDN===void 0?true:b.enableRiveAssetCDN,this.eventManager=new W,b.onLoad&&this.on(H.Load,b.onLoad),b.onLoadError&&this.on(H.LoadError,b.onLoadError),b.onPlay&&this.on(H.Play,b.onPlay),b.onPause&&this.on(H.Pause,b.onPause),b.onStop&&this.on(H.Stop,b.onStop),b.onLoop&&this.on(H.Loop,b.onLoop),b.onStateChange&&this.on(H.StateChange,b.onStateChange),b.onAdvance&&this.on(H.Advance,b.onAdvance),b.onload&&!b.onLoad&&this.on(H.Load,b.onload),b.onloaderror&&!b.onLoadError&&this.on(H.LoadError,b.onloaderror),b.onplay&&!b.onPlay&&this.on(H.Play,b.onplay),b.onpause&&!b.onPause&&this.on(H.Pause,b.onpause),b.onstop&&!b.onStop&&this.on(H.Stop,b.onstop),b.onloop&&!b.onLoop&&this.on(H.Loop,b.onloop),b.onstatechange&&!b.onStateChange&&this.on(H.StateChange,b.onstatechange),b.assetLoader&&(this.assetLoader=b.assetLoader),this.taskQueue=new te(this.eventManager),this.init({src:this.src,buffer:this.buffer,riveFile:this.riveFile,autoplay:b.autoplay,autoBind:b.autoBind,animations:b.animations,stateMachines:b.stateMachines,artboard:b.artboard,useOffscreenRenderer:b.useOffscreenRenderer});}return Object.defineProperty(M.prototype,"viewModelCount",{get:function(){return this.file.viewModelCount()},enumerable:false,configurable:true}),M.new=function(b){return console.warn("This function is deprecated: please use `new Rive({})` instead"),new M(b)},M.prototype.onSystemAudioChanged=function(){this.volume=this._volume;},M.prototype.init=function(b){var v=this,N=b.src,z=b.buffer,V=b.riveFile,Z=b.animations,pe=b.stateMachines,Ce=b.artboard,ye=b.autoplay,Se=ye===void 0?false:ye,ut=b.useOffscreenRenderer,vt=ut===void 0?false:ut,it=b.autoBind,Kt=it===void 0?false:it;if(!this.destroyed){if(this.src=N,this.buffer=z,this.riveFile=V,!this.src&&!this.buffer&&!this.riveFile)throw new y(M.missingErrorMessage);var Pt=Et(Z),An=Et(pe);this.loaded=false,this.readyForPlaying=false,O.awaitInstance().then(function(Tn){v.destroyed||(v.runtime=Tn,v.removeRiveListeners(),v.deleteRiveRenderer(),v.renderer=v.runtime.makeRenderer(v.canvas,vt),v.canvas.width||v.canvas.height||v.resizeDrawingSurfaceToCanvas(),v.initData(Ce,Pt,An,Se,Kt).then(function(Fn){if(Fn)return v.setupRiveListeners()}).catch(function(Fn){console.error(Fn);}));}).catch(function(Tn){console.error(Tn);});}},M.prototype.setupRiveListeners=function(b){var v=this;if(this.eventCleanup&&this.eventCleanup(),!this.shouldDisableRiveListeners){var N=(this.animator.stateMachines||[]).filter(function(pe){return pe.playing&&v.runtime.hasListeners(pe.instance)}).map(function(pe){return pe.instance}),z=this.isTouchScrollEnabled,V=this.dispatchPointerExit,Z=this.enableMultiTouch;b&&"isTouchScrollEnabled"in b&&(z=b.isTouchScrollEnabled),this.eventCleanup=(0, c.registerTouchInteractions)({canvas:this.canvas,artboard:this.artboard,stateMachines:N,renderer:this.renderer,rive:this.runtime,fit:this._layout.runtimeFit(this.runtime),alignment:this._layout.runtimeAlignment(this.runtime),isTouchScrollEnabled:z,dispatchPointerExit:V,enableMultiTouch:Z,layoutScaleFactor:this._layout.layoutScaleFactor});}},M.prototype.removeRiveListeners=function(){this.eventCleanup&&(this.eventCleanup(),this.eventCleanup=null);},M.prototype.initializeAudio=function(){var b=this,v;ee.status==ne.UNAVAILABLE&&!((v=this.artboard)===null||v===void 0)&&v.hasAudio&&this._audioEventListener===null&&(this._audioEventListener={type:H.AudioStatusChange,callback:function(){return b.onSystemAudioChanged()}},ee.add(this._audioEventListener),ee.establishAudio());},M.prototype.initArtboardSize=function(){this.artboard&&(this._artboardWidth=this.artboard.width=this._artboardWidth||this.artboard.width,this._artboardHeight=this.artboard.height=this._artboardHeight||this.artboard.height);},M.prototype.initData=function(b,v,N,z,V){return f(this,void 0,void 0,function(){var Z,pe,Ce,ye;return g(this,function(Se){switch(Se.label){case 0:return Se.trys.push([0,3,,4]),this.riveFile!=null?[3,2]:(Z=new Q({src:this.src,buffer:this.buffer,enableRiveAssetCDN:this.enableRiveAssetCDN,assetLoader:this.assetLoader}),this.riveFile=Z,[4,Z.init()]);case 1:if(Se.sent(),this.destroyed)return Z.destroyIfUnused(),[2,false];Se.label=2;case 2:return this.file=this.riveFile.getInstance(),this.initArtboard(b,v,N,z,V),this.initArtboardSize(),this.initializeAudio(),this.loaded=true,this.eventManager.fire({type:H.Load,data:(ye=this.src)!==null&&ye!==void 0?ye:"buffer"}),this.animator.advanceIfPaused(),this.readyForPlaying=true,this.taskQueue.process(),this.drawFrame(),[2,true];case 3:return pe=Se.sent(),Ce=S(pe),console.warn(Ce),this.eventManager.fire({type:H.LoadError,data:Ce}),[2,Promise.reject(Ce)];case 4:return [2]}})})},M.prototype.initArtboard=function(b,v,N,z,V){if(this.file){var Z=b?this.file.artboardByName(b):this.file.defaultArtboard();if(!Z){var pe="Invalid artboard name or no default artboard";console.warn(pe),this.eventManager.fire({type:H.LoadError,data:pe});return}this.artboard=Z,Z.volume=this._volume*ee.systemVolume,this.animator=new q(this.runtime,this.artboard,this.eventManager);var Ce;if(v.length>0||N.length>0?(Ce=v.concat(N),this.animator.initLinearAnimations(v,z),this.animator.initStateMachines(N,z)):Ce=[this.animator.atLeastOne(z,false)],this.taskQueue.add({event:{type:z?H.Play:H.Pause,data:Ce}}),V){var ye=this.file.defaultArtboardViewModel(Z);if(ye!==null){var Se=ye.defaultInstance();if(Se!==null){var ut=new Ve(Se,null);(0, c.createFinalization)(ut,ut.runtimeInstance),this.bindViewModelInstance(ut);}}}}},M.prototype.drawFrame=function(){var b,v;!((b=document?.timeline)===null||b===void 0)&&b.currentTime?this.loaded&&this.artboard&&!this.frameRequestId&&(this._boundDraw(document.timeline.currentTime),(v=this.runtime)===null||v===void 0||v.resolveAnimationFrame()):this.scheduleRendering();},M.prototype._canvasSizeChanged=function(){var b=false;return this.canvas&&(this.canvas.width!==this._currentCanvasWidth&&(this._currentCanvasWidth=this.canvas.width,b=true),this.canvas.height!==this._currentCanvasHeight&&(this._currentCanvasHeight=this.canvas.height,b=true)),b},M.prototype.draw=function(b,v){var N;this.frameRequestId=null;var z=performance.now();this.lastRenderTime||(this.lastRenderTime=b),this.renderSecondTimer+=b-this.lastRenderTime,this.renderSecondTimer>5e3&&(this.renderSecondTimer=0,v?.());var V=(b-this.lastRenderTime)/1e3;this.lastRenderTime=b;for(var Z=this.animator.animations.filter(function(jn){return jn.playing||jn.needsScrub}).sort(function(jn){return jn.needsScrub?-1:1}),pe=0,Ce=Z;pe<Ce.length;pe++){var ye=Ce[pe];ye.advance(V),ye.instance.didLoop&&(ye.loopCount+=1),ye.apply(1);}for(var Se=this.animator.stateMachines.filter(function(jn){return jn.playing}),ut=0,vt=Se;ut<vt.length;ut++){var it=vt[ut],Kt=it.reportedEventCount();if(Kt)for(var Pt=0;Pt<Kt;Pt++){var An=it.reportedEventAt(Pt);if(An)if(An.type===R.OpenUrl){if(this.eventManager.fire({type:H.RiveEvent,data:An}),this.automaticallyHandleEvents){var Tn=document.createElement("a"),Fn=An,Dr=Fn.url,We=Fn.target,Fr=(0, c.sanitizeUrl)(Dr);Dr&&Tn.setAttribute("href",Fr),We&&Tn.setAttribute("target",We),Fr&&Fr!==c.BLANK_URL&&Tn.click();}}else this.eventManager.fire({type:H.RiveEvent,data:An});}it.advanceAndApply(V);}this.animator.stateMachines.length==0&&this.artboard.advance(V);var Bn=this.renderer;this._hasZeroSize||(this.drawOptimization==E.AlwaysDraw||this.artboard.didChange()||this._needsRedraw||this._canvasSizeChanged())&&(Bn.clear(),Bn.save(),this.alignRenderer(),this.artboard.draw(Bn),Bn.restore(),Bn.flush(),this._needsRedraw=false),this.animator.handleLooping(),this.animator.handleStateChanges(),this.animator.handleAdvancing(V),this.frameCount++;var at=performance.now();for(this.frameTimes.push(at),this.durations.push(at-z);this.frameTimes[0]<=at-1e3;)this.frameTimes.shift(),this.durations.shift();(N=this._viewModelInstance)===null||N===void 0||N.handleCallbacks(),this.animator.isPlaying?this.scheduleRendering():this.animator.isPaused?this.lastRenderTime=0:this.animator.isStopped&&(this.lastRenderTime=0);},M.prototype.alignRenderer=function(){var b=this,v=b.renderer,N=b.runtime,z=b._layout,V=b.artboard;v.align(z.runtimeFit(N),z.runtimeAlignment(N),{minX:z.minX,minY:z.minY,maxX:z.maxX,maxY:z.maxY},V.bounds,this._devicePixelRatioUsed*z.layoutScaleFactor);},Object.defineProperty(M.prototype,"fps",{get:function(){return this.durations.length},enumerable:false,configurable:true}),Object.defineProperty(M.prototype,"frameTime",{get:function(){return this.durations.length===0?0:(this.durations.reduce(function(b,v){return b+v},0)/this.durations.length).toFixed(4)},enumerable:false,configurable:true}),M.prototype.cleanup=function(){var b,v;this.destroyed=true,this.stopRendering(),this.cleanupInstances(),this._observed!==null&&j.remove(this._observed),this.removeRiveListeners(),this.file&&((b=this.riveFile)===null||b===void 0||b.cleanup(),this.file=null),this.riveFile=null,this.deleteRiveRenderer(),this._audioEventListener!==null&&(ee.remove(this._audioEventListener),this._audioEventListener=null),(v=this._viewModelInstance)===null||v===void 0||v.cleanup(),this._viewModelInstance=null,this._dataEnums=null;},M.prototype.deleteRiveRenderer=function(){var b;(b=this.renderer)===null||b===void 0||b.delete(),this.renderer=null;},M.prototype.cleanupInstances=function(){this.eventCleanup!==null&&this.eventCleanup(),this.stop(),this.artboard&&(this.artboard.delete(),this.artboard=null);},M.prototype.retrieveTextRun=function(b){var v;if(!b){console.warn("No text run name provided");return}if(!this.artboard){console.warn("Tried to access text run, but the Artboard is null");return}var N=this.artboard.textRun(b);if(!N){console.warn("Could not access a text run with name '".concat(b,"' in the '").concat((v=this.artboard)===null||v===void 0?void 0:v.name,"' Artboard. Note that you must rename a text run node in the Rive editor to make it queryable at runtime."));return}return N},M.prototype.getTextRunValue=function(b){var v=this.retrieveTextRun(b);return v?v.text:void 0},M.prototype.setTextRunValue=function(b,v){var N=this.retrieveTextRun(b);N&&(N.text=v);},M.prototype.play=function(b,v){var N=this;if(b=Et(b),!this.readyForPlaying){this.taskQueue.add({action:function(){return N.play(b,v)}});return}this.animator.play(b),this.eventCleanup&&this.eventCleanup(),this.setupRiveListeners(),this.startRendering();},M.prototype.pause=function(b){var v=this;if(b=Et(b),!this.readyForPlaying){this.taskQueue.add({action:function(){return v.pause(b)}});return}this.eventCleanup&&this.eventCleanup(),this.animator.pause(b);},M.prototype.scrub=function(b,v){var N=this;if(b=Et(b),!this.readyForPlaying){this.taskQueue.add({action:function(){return N.scrub(b,v)}});return}this.animator.scrub(b,v||0),this.drawFrame();},M.prototype.stop=function(b){var v=this;if(b=Et(b),!this.readyForPlaying){this.taskQueue.add({action:function(){return v.stop(b)}});return}this.animator&&this.animator.stop(b),this.eventCleanup&&this.eventCleanup();},M.prototype.reset=function(b){var v,N,z=b?.artboard,V=Et(b?.animations),Z=Et(b?.stateMachines),pe=(v=b?.autoplay)!==null&&v!==void 0?v:false,Ce=(N=b?.autoBind)!==null&&N!==void 0?N:false;this.cleanupInstances(),this.initArtboard(z,V,Z,pe,Ce),this.taskQueue.process();},M.prototype.load=function(b){this.file=null,this.stop(),this.init(b);},Object.defineProperty(M.prototype,"layout",{get:function(){return this._layout},set:function(b){this._layout=b,(!b.maxX||!b.maxY)&&this.resizeToCanvas(),this.loaded&&!this.animator.isPlaying&&this.drawFrame();},enumerable:false,configurable:true}),M.prototype.resizeToCanvas=function(){this._layout=this.layout.copyWith({minX:0,minY:0,maxX:this.canvas.width,maxY:this.canvas.height});},M.prototype.resizeDrawingSurfaceToCanvas=function(b){if(this.canvas instanceof HTMLCanvasElement&&window){var v=this.canvas.getBoundingClientRect(),N=v.width,z=v.height,V=b||window.devicePixelRatio||1;if(this.devicePixelRatioUsed=V,this.canvas.width=V*N,this.canvas.height=V*z,this._needsRedraw=true,this.resizeToCanvas(),this.drawFrame(),this.layout.fit===C.Layout){var Z=this._layout.layoutScaleFactor;this.artboard.width=N/Z,this.artboard.height=z/Z;}}},Object.defineProperty(M.prototype,"source",{get:function(){return this.src},enumerable:false,configurable:true}),Object.defineProperty(M.prototype,"activeArtboard",{get:function(){return this.artboard?this.artboard.name:""},enumerable:false,configurable:true}),Object.defineProperty(M.prototype,"animationNames",{get:function(){if(!this.loaded||!this.artboard)return [];for(var b=[],v=0;v<this.artboard.animationCount();v++)b.push(this.artboard.animationByIndex(v).name);return b},enumerable:false,configurable:true}),Object.defineProperty(M.prototype,"stateMachineNames",{get:function(){if(!this.loaded||!this.artboard)return [];for(var b=[],v=0;v<this.artboard.stateMachineCount();v++)b.push(this.artboard.stateMachineByIndex(v).name);return b},enumerable:false,configurable:true}),M.prototype.stateMachineInputs=function(b){if(this.loaded){var v=this.animator.stateMachines.find(function(N){return N.name===b});return v?.inputs}},M.prototype.retrieveInputAtPath=function(b,v){if(!b){console.warn("No input name provided for path '".concat(v,"'"));return}if(!this.artboard){console.warn("Tried to access input: '".concat(b,"', at path: '").concat(v,"', but the Artboard is null"));return}var N=this.artboard.inputByPath(b,v);if(!N){console.warn("Could not access an input with name: '".concat(b,"', at path:'").concat(v,"'"));return}return N},M.prototype.setBooleanStateAtPath=function(b,v,N){var z=this.retrieveInputAtPath(b,N);z&&(z.type===k.Boolean?z.asBool().value=v:console.warn("Input with name: '".concat(b,"', at path:'").concat(N,"' is not a boolean")));},M.prototype.setNumberStateAtPath=function(b,v,N){var z=this.retrieveInputAtPath(b,N);z&&(z.type===k.Number?z.asNumber().value=v:console.warn("Input with name: '".concat(b,"', at path:'").concat(N,"' is not a number")));},M.prototype.fireStateAtPath=function(b,v){var N=this.retrieveInputAtPath(b,v);N&&(N.type===k.Trigger?N.asTrigger().fire():console.warn("Input with name: '".concat(b,"', at path:'").concat(v,"' is not a trigger")));},M.prototype.retrieveTextAtPath=function(b,v){if(!b){console.warn("No text name provided for path '".concat(v,"'"));return}if(!v){console.warn("No path provided for text '".concat(b,"'"));return}if(!this.artboard){console.warn("Tried to access text: '".concat(b,"', at path: '").concat(v,"', but the Artboard is null"));return}var N=this.artboard.textByPath(b,v);if(!N){console.warn("Could not access text with name: '".concat(b,"', at path:'").concat(v,"'"));return}return N},M.prototype.getTextRunValueAtPath=function(b,v){var N=this.retrieveTextAtPath(b,v);if(!N){console.warn("Could not get text with name: '".concat(b,"', at path:'").concat(v,"'"));return}return N.text},M.prototype.setTextRunValueAtPath=function(b,v,N){var z=this.retrieveTextAtPath(b,N);if(!z){console.warn("Could not set text with name: '".concat(b,"', at path:'").concat(N,"'"));return}z.text=v;},Object.defineProperty(M.prototype,"playingStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(b){return b.playing}).map(function(b){return b.name}):[]},enumerable:false,configurable:true}),Object.defineProperty(M.prototype,"playingAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(b){return b.playing}).map(function(b){return b.name}):[]},enumerable:false,configurable:true}),Object.defineProperty(M.prototype,"pausedAnimationNames",{get:function(){return this.loaded?this.animator.animations.filter(function(b){return !b.playing}).map(function(b){return b.name}):[]},enumerable:false,configurable:true}),Object.defineProperty(M.prototype,"pausedStateMachineNames",{get:function(){return this.loaded?this.animator.stateMachines.filter(function(b){return !b.playing}).map(function(b){return b.name}):[]},enumerable:false,configurable:true}),Object.defineProperty(M.prototype,"isPlaying",{get:function(){return this.animator.isPlaying},enumerable:false,configurable:true}),Object.defineProperty(M.prototype,"isPaused",{get:function(){return this.animator.isPaused},enumerable:false,configurable:true}),Object.defineProperty(M.prototype,"isStopped",{get:function(){var b,v;return (v=(b=this.animator)===null||b===void 0?void 0:b.isStopped)!==null&&v!==void 0?v:true},enumerable:false,configurable:true}),Object.defineProperty(M.prototype,"bounds",{get:function(){return this.artboard?this.artboard.bounds:void 0},enumerable:false,configurable:true}),M.prototype.on=function(b,v){this.eventManager.add({type:b,callback:v});},M.prototype.off=function(b,v){this.eventManager.remove({type:b,callback:v});},M.prototype.unsubscribe=function(b,v){console.warn("This function is deprecated: please use `off()` instead."),this.off(b,v);},M.prototype.removeAllRiveEventListeners=function(b){this.eventManager.removeAll(b);},M.prototype.unsubscribeAll=function(b){console.warn("This function is deprecated: please use `removeAllRiveEventListeners()` instead."),this.removeAllRiveEventListeners(b);},M.prototype.stopRendering=function(){this.loaded&&this.frameRequestId&&(this.runtime.cancelAnimationFrame?this.runtime.cancelAnimationFrame(this.frameRequestId):cancelAnimationFrame(this.frameRequestId),this.frameRequestId=null);},M.prototype.startRendering=function(){this.drawFrame();},M.prototype.scheduleRendering=function(){this.loaded&&this.artboard&&!this.frameRequestId&&(this.runtime.requestAnimationFrame?this.frameRequestId=this.runtime.requestAnimationFrame(this._boundDraw):this.frameRequestId=requestAnimationFrame(this._boundDraw));},M.prototype.enableFPSCounter=function(b){this.runtime.enableFPSCounter(b);},M.prototype.disableFPSCounter=function(){this.runtime.disableFPSCounter();},Object.defineProperty(M.prototype,"contents",{get:function(){if(this.loaded){for(var b={artboards:[]},v=0;v<this.file.artboardCount();v++){for(var N=this.file.artboardByIndex(v),z={name:N.name,animations:[],stateMachines:[]},V=0;V<N.animationCount();V++){var Z=N.animationByIndex(V);z.animations.push(Z.name);}for(var pe=0;pe<N.stateMachineCount();pe++){for(var Ce=N.stateMachineByIndex(pe),ye=Ce.name,Se=new this.runtime.StateMachineInstance(Ce,N),ut=[],vt=0;vt<Se.inputCount();vt++){var it=Se.input(vt);ut.push({name:it.name,type:it.type});}z.stateMachines.push({name:ye,inputs:ut});}b.artboards.push(z);}return b}},enumerable:false,configurable:true}),Object.defineProperty(M.prototype,"volume",{get:function(){return this.artboard&&this.artboard.volume!==this._volume&&(this._volume=this.artboard.volume),this._volume},set:function(b){this._volume=b,this.artboard&&(this.artboard.volume=b*ee.systemVolume);},enumerable:false,configurable:true}),Object.defineProperty(M.prototype,"artboardWidth",{get:function(){var b;return this.artboard?this.artboard.width:(b=this._artboardWidth)!==null&&b!==void 0?b:0},set:function(b){this._artboardWidth=b,this.artboard&&(this.artboard.width=b);},enumerable:false,configurable:true}),Object.defineProperty(M.prototype,"artboardHeight",{get:function(){var b;return this.artboard?this.artboard.height:(b=this._artboardHeight)!==null&&b!==void 0?b:0},set:function(b){this._artboardHeight=b,this.artboard&&(this.artboard.height=b);},enumerable:false,configurable:true}),M.prototype.resetArtboardSize=function(){this.artboard?(this.artboard.resetArtboardSize(),this._artboardWidth=this.artboard.width,this._artboardHeight=this.artboard.height):(this._artboardWidth=void 0,this._artboardHeight=void 0);},Object.defineProperty(M.prototype,"devicePixelRatioUsed",{get:function(){return this._devicePixelRatioUsed},set:function(b){this._devicePixelRatioUsed=b;},enumerable:false,configurable:true}),M.prototype.bindViewModelInstance=function(b){var v;this.artboard&&!this.destroyed&&b&&b.runtimeInstance&&(b.internalIncrementReferenceCount(),(v=this._viewModelInstance)===null||v===void 0||v.cleanup(),this._viewModelInstance=b,this.animator.stateMachines.length>0?this.animator.stateMachines.forEach(function(N){return N.bindViewModelInstance(b)}):this.artboard.bindViewModelInstance(b.runtimeInstance));},Object.defineProperty(M.prototype,"viewModelInstance",{get:function(){return this._viewModelInstance},enumerable:false,configurable:true}),M.prototype.viewModelByIndex=function(b){var v=this.file.viewModelByIndex(b);return v!==null?new le(v):null},M.prototype.viewModelByName=function(b){var v;return (v=this.riveFile)===null||v===void 0?void 0:v.viewModelByName(b)},M.prototype.enums=function(){if(this._dataEnums===null){var b=this.file.enums();this._dataEnums=b.map(function(v){return new we(v)});}return this._dataEnums},M.prototype.defaultViewModel=function(){if(this.artboard){var b=this.file.defaultArtboardViewModel(this.artboard);if(b)return new le(b)}return null},M.prototype.getArtboard=function(b){var v,N;return (N=(v=this.riveFile)===null||v===void 0?void 0:v.getArtboard(b))!==null&&N!==void 0?N:null},M.prototype.getBindableArtboard=function(b){var v,N;return (N=(v=this.riveFile)===null||v===void 0?void 0:v.getBindableArtboard(b))!==null&&N!==void 0?N:null},M.prototype.getDefaultBindableArtboard=function(){var b,v;return (v=(b=this.riveFile)===null||b===void 0?void 0:b.getDefaultBindableArtboard())!==null&&v!==void 0?v:null},M.missingErrorMessage="Rive source file or data buffer required",M.cleanupErrorMessage="Attempt to use file after calling cleanup.",M})(),le=(function(){function M(b){this._viewModel=b;}return Object.defineProperty(M.prototype,"instanceCount",{get:function(){return this._viewModel.instanceCount},enumerable:false,configurable:true}),Object.defineProperty(M.prototype,"name",{get:function(){return this._viewModel.name},enumerable:false,configurable:true}),M.prototype.instanceByIndex=function(b){var v=this._viewModel.instanceByIndex(b);if(v!==null){var N=new Ve(v,null);return (0, c.createFinalization)(N,v),N}return null},M.prototype.instanceByName=function(b){var v=this._viewModel.instanceByName(b);if(v!==null){var N=new Ve(v,null);return (0, c.createFinalization)(N,v),N}return null},M.prototype.defaultInstance=function(){var b=this._viewModel.defaultInstance();if(b!==null){var v=new Ve(b,null);return (0, c.createFinalization)(v,b),v}return null},M.prototype.instance=function(){var b=this._viewModel.instance();if(b!==null){var v=new Ve(b,null);return (0, c.createFinalization)(v,b),v}return null},Object.defineProperty(M.prototype,"properties",{get:function(){return this._viewModel.getProperties()},enumerable:false,configurable:true}),Object.defineProperty(M.prototype,"instanceNames",{get:function(){return this._viewModel.getInstanceNames()},enumerable:false,configurable:true}),M})(),we=(function(){function M(b){this._dataEnum=b;}return Object.defineProperty(M.prototype,"name",{get:function(){return this._dataEnum.name},enumerable:false,configurable:true}),Object.defineProperty(M.prototype,"values",{get:function(){return this._dataEnum.values},enumerable:false,configurable:true}),M})(),Ie;(function(M){M.Number="number",M.String="string",M.Boolean="boolean",M.Color="color",M.Trigger="trigger",M.Enum="enum",M.List="list",M.Image="image",M.Artboard="artboard";})(Ie||(Ie={}));var Ve=(function(){function M(b,v){this._parents=[],this._children=[],this._viewModelInstances=new Map,this._propertiesWithCallbacks=[],this._referenceCount=0,this.selfUnref=false,this._runtimeInstance=b,v!==null&&this._parents.push(v);}return Object.defineProperty(M.prototype,"runtimeInstance",{get:function(){return this._runtimeInstance},enumerable:false,configurable:true}),Object.defineProperty(M.prototype,"nativeInstance",{get:function(){return this._runtimeInstance},enumerable:false,configurable:true}),M.prototype.handleCallbacks=function(){this._propertiesWithCallbacks.length!==0&&(this._propertiesWithCallbacks.forEach(function(b){b.handleCallbacks();}),this._propertiesWithCallbacks.forEach(function(b){b.clearChanges();})),this._children.forEach(function(b){return b.handleCallbacks()});},M.prototype.addParent=function(b){this._parents.includes(b)||(this._parents.push(b),(this._propertiesWithCallbacks.length>0||this._children.length>0)&&b.addToViewModelCallbacks(this));},M.prototype.removeParent=function(b){var v=this._parents.indexOf(b);if(v!==-1){var N=this._parents[v];N.removeFromViewModelCallbacks(this),this._parents.splice(v,1);}},M.prototype.addToPropertyCallbacks=function(b){var v=this;this._propertiesWithCallbacks.includes(b)||(this._propertiesWithCallbacks.push(b),this._propertiesWithCallbacks.length>0&&this._parents.forEach(function(N){N.addToViewModelCallbacks(v);}));},M.prototype.removeFromPropertyCallbacks=function(b){var v=this;this._propertiesWithCallbacks.includes(b)&&(this._propertiesWithCallbacks=this._propertiesWithCallbacks.filter(function(N){return N!==b}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(N){N.removeFromViewModelCallbacks(v);}));},M.prototype.addToViewModelCallbacks=function(b){var v=this;this._children.includes(b)||(this._children.push(b),this._parents.forEach(function(N){N.addToViewModelCallbacks(v);}));},M.prototype.removeFromViewModelCallbacks=function(b){var v=this;this._children.includes(b)&&(this._children=this._children.filter(function(N){return N!==b}),this._children.length===0&&this._propertiesWithCallbacks.length===0&&this._parents.forEach(function(N){N.removeFromViewModelCallbacks(v);}));},M.prototype.clearCallbacks=function(){this._propertiesWithCallbacks.forEach(function(b){b.clearCallbacks();});},M.prototype.propertyFromPath=function(b,v){var N=b.split("/");return this.propertyFromPathSegments(N,0,v)},M.prototype.viewModelFromPathSegments=function(b,v){var N=this.internalViewModelInstance(b[v]);return N!==null?v==b.length-1?N:N.viewModelFromPathSegments(b,v++):null},M.prototype.propertyFromPathSegments=function(b,v,N){var z,V,Z,pe,Ce,ye,Se,ut,vt,it,Kt,Pt,An,Tn,Fn,Dr,We,Fr;if(v<b.length-1){var Bn=this.internalViewModelInstance(b[v]);return Bn!==null?Bn.propertyFromPathSegments(b,v+1,N):null}var at=null;switch(N){case Ie.Number:if(at=(V=(z=this._runtimeInstance)===null||z===void 0?void 0:z.number(b[v]))!==null&&V!==void 0?V:null,at!==null)return new St(at,this);break;case Ie.String:if(at=(pe=(Z=this._runtimeInstance)===null||Z===void 0?void 0:Z.string(b[v]))!==null&&pe!==void 0?pe:null,at!==null)return new mn(at,this);break;case Ie.Boolean:if(at=(ye=(Ce=this._runtimeInstance)===null||Ce===void 0?void 0:Ce.boolean(b[v]))!==null&&ye!==void 0?ye:null,at!==null)return new qt(at,this);break;case Ie.Color:if(at=(ut=(Se=this._runtimeInstance)===null||Se===void 0?void 0:Se.color(b[v]))!==null&&ut!==void 0?ut:null,at!==null)return new ft(at,this);break;case Ie.Trigger:if(at=(it=(vt=this._runtimeInstance)===null||vt===void 0?void 0:vt.trigger(b[v]))!==null&&it!==void 0?it:null,at!==null)return new wn(at,this);break;case Ie.Enum:if(at=(Pt=(Kt=this._runtimeInstance)===null||Kt===void 0?void 0:Kt.enum(b[v]))!==null&&Pt!==void 0?Pt:null,at!==null)return new nn(at,this);break;case Ie.List:if(at=(Tn=(An=this._runtimeInstance)===null||An===void 0?void 0:An.list(b[v]))!==null&&Tn!==void 0?Tn:null,at!==null)return new xn(at,this);break;case Ie.Image:if(at=(Dr=(Fn=this._runtimeInstance)===null||Fn===void 0?void 0:Fn.image(b[v]))!==null&&Dr!==void 0?Dr:null,at!==null)return new qe(at,this);break;case Ie.Artboard:if(at=(Fr=(We=this._runtimeInstance)===null||We===void 0?void 0:We.artboard(b[v]))!==null&&Fr!==void 0?Fr:null,at!==null)return new Qn(at,this);break}return null},M.prototype.internalViewModelInstance=function(b){var v;if(this._viewModelInstances.has(b))return this._viewModelInstances.get(b);var N=(v=this._runtimeInstance)===null||v===void 0?void 0:v.viewModel(b);if(N!==null){var z=new M(N,this);return (0, c.createFinalization)(z,N),z.internalIncrementReferenceCount(),this._viewModelInstances.set(b,z),z}return null},M.prototype.number=function(b){var v=this.propertyFromPath(b,Ie.Number);return v},M.prototype.string=function(b){var v=this.propertyFromPath(b,Ie.String);return v},M.prototype.boolean=function(b){var v=this.propertyFromPath(b,Ie.Boolean);return v},M.prototype.color=function(b){var v=this.propertyFromPath(b,Ie.Color);return v},M.prototype.trigger=function(b){var v=this.propertyFromPath(b,Ie.Trigger);return v},M.prototype.enum=function(b){var v=this.propertyFromPath(b,Ie.Enum);return v},M.prototype.list=function(b){var v=this.propertyFromPath(b,Ie.List);return v},M.prototype.image=function(b){var v=this.propertyFromPath(b,Ie.Image);return v},M.prototype.artboard=function(b){var v=this.propertyFromPath(b,Ie.Artboard);return v},M.prototype.viewModel=function(b){var v=b.split("/"),N=v.length>1?this.viewModelFromPathSegments(v.slice(0,v.length-1),0):this;return N!=null?N.internalViewModelInstance(v[v.length-1]):null},M.prototype.internalReplaceViewModel=function(b,v){var N;if(v.runtimeInstance!==null){var z=((N=this._runtimeInstance)===null||N===void 0?void 0:N.replaceViewModel(b,v.runtimeInstance))||false;if(z){v.internalIncrementReferenceCount();var V=this.internalViewModelInstance(b);V!==null&&(V.removeParent(this),this._children.includes(V)&&(this._children=this._children.filter(function(Z){return Z!==V})),V.cleanup()),this._viewModelInstances.set(b,v),v.addParent(this);}return z}return  false},M.prototype.replaceViewModel=function(b,v){var N,z=b.split("/"),V=z.length>1?this.viewModelFromPathSegments(z.slice(0,z.length-1),0):this;return (N=V?.internalReplaceViewModel(z[z.length-1],v))!==null&&N!==void 0?N:false},M.prototype.incrementReferenceCount=function(){var b;this._referenceCount++,(b=this._runtimeInstance)===null||b===void 0||b.incrementReferenceCount();},M.prototype.decrementReferenceCount=function(){var b;this._referenceCount--,(b=this._runtimeInstance)===null||b===void 0||b.decrementReferenceCount();},Object.defineProperty(M.prototype,"properties",{get:function(){var b;return ((b=this._runtimeInstance)===null||b===void 0?void 0:b.getProperties().map(function(v){return u({},v)}))||[]},enumerable:false,configurable:true}),M.prototype.internalIncrementReferenceCount=function(){this._referenceCount++;},M.prototype.cleanup=function(){var b=this,v;if(this._referenceCount--,this._referenceCount<=0){this.selfUnref&&((v=this._runtimeInstance)===null||v===void 0||v.unref()),this._runtimeInstance=null,this.clearCallbacks(),this._propertiesWithCallbacks=[],this._viewModelInstances.forEach(function(V){V.cleanup();}),this._viewModelInstances.clear();var N=h([],this._children);this._children.length=0;var z=h([],this._parents);this._parents.length=0,N.forEach(function(V){V.removeParent(b);}),z.forEach(function(V){V.removeFromViewModelCallbacks(b);});}},M})(),kt=(function(){function M(b,v){this.callbacks=[],this._viewModelInstanceValue=b,this._parentViewModel=v;}return M.prototype.on=function(b){this.callbacks.length===0&&this._viewModelInstanceValue.clearChanges(),this.callbacks.includes(b)||(this.callbacks.push(b),this._parentViewModel.addToPropertyCallbacks(this));},M.prototype.off=function(b){b?this.callbacks=this.callbacks.filter(function(v){return v!==b}):this.callbacks.length=0,this.callbacks.length===0&&this._parentViewModel.removeFromPropertyCallbacks(this);},M.prototype.internalHandleCallback=function(b){},M.prototype.handleCallbacks=function(){var b=this;this._viewModelInstanceValue.hasChanged&&this.callbacks.forEach(function(v){b.internalHandleCallback(v);});},M.prototype.clearChanges=function(){this._viewModelInstanceValue.clearChanges();},M.prototype.clearCallbacks=function(){this.callbacks.length=0;},Object.defineProperty(M.prototype,"name",{get:function(){return this._viewModelInstanceValue.name},enumerable:false,configurable:true}),M})(),mn=(function(M){d(b,M);function b(v,N){return M.call(this,v,N)||this}return Object.defineProperty(b.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(v){this._viewModelInstanceValue.value=v;},enumerable:false,configurable:true}),b.prototype.internalHandleCallback=function(v){v(this.value);},b})(kt),St=(function(M){d(b,M);function b(v,N){return M.call(this,v,N)||this}return Object.defineProperty(b.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(v){this._viewModelInstanceValue.value=v;},enumerable:false,configurable:true}),b.prototype.internalHandleCallback=function(v){v(this.value);},b})(kt),qt=(function(M){d(b,M);function b(v,N){return M.call(this,v,N)||this}return Object.defineProperty(b.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(v){this._viewModelInstanceValue.value=v;},enumerable:false,configurable:true}),b.prototype.internalHandleCallback=function(v){v(this.value);},b})(kt),wn=(function(M){d(b,M);function b(v,N){return M.call(this,v,N)||this}return b.prototype.trigger=function(){return this._viewModelInstanceValue.trigger()},b.prototype.internalHandleCallback=function(v){v();},b})(kt),nn=(function(M){d(b,M);function b(v,N){return M.call(this,v,N)||this}return Object.defineProperty(b.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(v){this._viewModelInstanceValue.value=v;},enumerable:false,configurable:true}),Object.defineProperty(b.prototype,"valueIndex",{get:function(){return this._viewModelInstanceValue.valueIndex},set:function(v){this._viewModelInstanceValue.valueIndex=v;},enumerable:false,configurable:true}),Object.defineProperty(b.prototype,"values",{get:function(){return this._viewModelInstanceValue.values},enumerable:false,configurable:true}),b.prototype.internalHandleCallback=function(v){v(this.value);},b})(kt),xn=(function(M){d(b,M);function b(v,N){return M.call(this,v,N)||this}return Object.defineProperty(b.prototype,"length",{get:function(){return this._viewModelInstanceValue.size},enumerable:false,configurable:true}),b.prototype.addInstance=function(v){v.runtimeInstance!=null&&(this._viewModelInstanceValue.addInstance(v.runtimeInstance),v.addParent(this._parentViewModel));},b.prototype.addInstanceAt=function(v,N){return v.runtimeInstance!=null&&this._viewModelInstanceValue.addInstanceAt(v.runtimeInstance,N)?(v.addParent(this._parentViewModel),true):false},b.prototype.removeInstance=function(v){v.runtimeInstance!=null&&(this._viewModelInstanceValue.removeInstance(v.runtimeInstance),v.removeParent(this._parentViewModel));},b.prototype.removeInstanceAt=function(v){this._viewModelInstanceValue.removeInstanceAt(v);},b.prototype.instanceAt=function(v){var N=this._viewModelInstanceValue.instanceAt(v);if(N!=null){var z=new Ve(N,this._parentViewModel);return (0, c.createFinalization)(z,N),z}return null},b.prototype.swap=function(v,N){this._viewModelInstanceValue.swap(v,N);},b.prototype.internalHandleCallback=function(v){v();},b})(kt),ft=(function(M){d(b,M);function b(v,N){return M.call(this,v,N)||this}return Object.defineProperty(b.prototype,"value",{get:function(){return this._viewModelInstanceValue.value},set:function(v){this._viewModelInstanceValue.value=v;},enumerable:false,configurable:true}),b.prototype.rgb=function(v,N,z){this._viewModelInstanceValue.rgb(v,N,z);},b.prototype.rgba=function(v,N,z,V){this._viewModelInstanceValue.argb(V,v,N,z);},b.prototype.argb=function(v,N,z,V){this._viewModelInstanceValue.argb(v,N,z,V);},b.prototype.alpha=function(v){this._viewModelInstanceValue.alpha(v);},b.prototype.opacity=function(v){this._viewModelInstanceValue.alpha(Math.round(Math.max(0,Math.min(1,v))*255));},b.prototype.internalHandleCallback=function(v){v(this.value);},b})(kt),qe=(function(M){d(b,M);function b(v,N){return M.call(this,v,N)||this}return Object.defineProperty(b.prototype,"value",{set:function(v){var N;this._viewModelInstanceValue.value((N=v?.nativeImage)!==null&&N!==void 0?N:null);},enumerable:false,configurable:true}),b.prototype.internalHandleCallback=function(v){v();},b})(kt),Qn=(function(M){d(b,M);function b(v,N){return M.call(this,v,N)||this}return Object.defineProperty(b.prototype,"value",{set:function(v){var N,z,V;v.isBindableArtboard?V=v:V=v.file.internalBindableArtboardFromArtboard(v.nativeArtboard),this._viewModelInstanceValue.value((N=V?.nativeArtboard)!==null&&N!==void 0?N:null),V?.nativeViewModel&&this._viewModelInstanceValue.viewModelInstance((z=V?.nativeViewModel)!==null&&z!==void 0?z:null);},enumerable:false,configurable:true}),b.prototype.internalHandleCallback=function(v){v();},b})(kt),Zn=function(M){return f(void 0,void 0,void 0,function(){var b,v,N;return g(this,function(z){switch(z.label){case 0:return b=new Request(M),[4,fetch(b)];case 1:return v=z.sent(),[4,v.arrayBuffer()];case 2:return N=z.sent(),[2,N]}})})},Et=function(M){return typeof M=="string"?[M]:M instanceof Array?M:[]},Ft={EventManager:W,TaskQueueManager:te},Cn=function(M){return f(void 0,void 0,void 0,function(){var b,v,N;return g(this,function(z){switch(z.label){case 0:return b=new Promise(function(V){return O.getInstance(function(Z){Z.decodeAudio(M,V);})}),[4,b];case 1:return v=z.sent(),N=new c.AudioWrapper(v),c.finalizationRegistry.register(N,v),[2,N]}})})},br=function(M){return f(void 0,void 0,void 0,function(){var b,v,N;return g(this,function(z){switch(z.label){case 0:return b=new Promise(function(V){return O.getInstance(function(Z){Z.decodeImage(M,V);})}),[4,b];case 1:return v=z.sent(),N=new c.ImageWrapper(v),c.finalizationRegistry.register(N,v),[2,N]}})})},Dn=function(M){return f(void 0,void 0,void 0,function(){var b,v,N;return g(this,function(z){switch(z.label){case 0:return b=new Promise(function(V){return O.getInstance(function(Z){Z.decodeFont(M,V);})}),[4,b];case 1:return v=z.sent(),N=new c.FontWrapper(v),c.finalizationRegistry.register(N,v),[2,N]}})})};})(),i})());})(qd)),qd.exports}var tb=z2();async function nb(e){const t=O2(e);if(t)return console.log(`[MGRiveLoader] Using cached RiveFile: ${e}`),t;console.log(`[MGRiveLoader] Loading RiveFile from: ${e}`);const n=await fetch(e);if(!n.ok)throw new Error(`Failed to load RiveFile: ${e} (${n.status})`);const r=await n.arrayBuffer(),o={};let i=null;if(await new Promise((s,l)=>{i=new tb.RiveFile({buffer:r,assetLoader:c=>c.isImage&&L2.includes(c.name)?(o[c.name]=c,console.log(`[MGRiveLoader] Captured image asset: ${c.name}`),true):false,onLoad:()=>{console.log(`[MGRiveLoader] RiveFile loaded: ${e}`),s();},onLoadError:c=>{console.error("[MGRiveLoader] RiveFile load error:",c),l(c);}}),i.init().catch(c=>{console.error("[MGRiveLoader] Failed to initialize RiveFile:",c),l(c);});}),!i)throw new Error(`[MGRiveLoader] Failed to create RiveFile for ${e}`);i.getInstance();const a={riveFile:i,imageAssets:o,url:e,loadedAt:Date.now()};return N2(e,a),a}const tS=[{id:"Top_DefaultGray.png",filename:"Top_DefaultGray.png",type:"Top",availability:"default",displayName:"Default",price:0,url:""},{id:"Mid_DefaultGray.png",filename:"Mid_DefaultGray.png",type:"Mid",availability:"default",displayName:"Default",price:0,url:""},{id:"Bottom_DefaultGray.png",filename:"Bottom_DefaultGray.png",type:"Bottom",availability:"default",displayName:"Default",price:0,url:""},{id:"Expression_Default.png",filename:"Expression_Default.png",type:"Expression",availability:"default",displayName:"Default",price:0,url:""},{id:"Top_Blank.png",filename:"Top_Blank.png",type:"Top",availability:"default",displayName:"None",price:0,url:""},{id:"Mid_Blank.png",filename:"Mid_Blank.png",type:"Mid",availability:"default",displayName:"None",price:0,url:""},{id:"Bottom_Blank.png",filename:"Bottom_Blank.png",type:"Bottom",availability:"default",displayName:"None",price:0,url:""},{id:"Expression_Blank.png",filename:"Expression_Blank.png",type:"Expression",availability:"default",displayName:"None",price:0,url:""}],U2=(function(){const t=typeof document<"u"&&document.createElement("link").relList;return t&&t.supports&&t.supports("modulepreload")?"modulepreload":"preload"})(),H2=function(e){return "/"+e},ky={},$n=function(t,n,r){let o=Promise.resolve();if(n&&n.length>0){let l=function(c){return Promise.all(c.map(d=>Promise.resolve(d).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),s=a?.nonce||a?.getAttribute("nonce");o=l(n.map(c=>{if(c=H2(c),c in ky)return;ky[c]=true;const d=c.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const f=document.createElement("link");if(f.rel=d?"stylesheet":U2,d||(f.as="script"),f.crossOrigin="",f.href=c,s&&f.setAttribute("nonce",s),document.head.appendChild(f),d)return new Promise((g,h)=>{f.addEventListener("load",g),f.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${c}`)));})}));}function i(a){const s=new Event("vite:preloadError",{cancelable:true});if(s.payload=a,window.dispatchEvent(s),!s.defaultPrevented)throw a}return o.then(a=>{for(const s of a||[])s.status==="rejected"&&i(s.reason);return t().catch(i)})},Jc={BOTTOM:0,MID:1,TOP:2,EXPRESSION:3},ag=["Bottom_DefaultGray.png","Mid_DefaultGray.png","Top_DefaultGray.png","Expression_Default.png"];async function nS(){try{const{Store:e}=await $n(async()=>{const{Store:o}=await Promise.resolve().then(()=>sc);return {Store:o}},void 0),t=await e.select("myDataAtom");if(!t||typeof t!="object")throw new Error("myDataAtom not available");const n=t.cosmetic,r=t.name;return {avatar:n?.avatar||[...ag],color:n?.color||"Red",name:r||"Player"}}catch(e){return console.error("[Avatar] Failed to get current avatar state:",e),{avatar:[...ag],color:"Red",name:"Player"}}}function rS(e,t){const n=t?[...t]:[...ag];return e.bottom&&(n[Jc.BOTTOM]=e.bottom),e.mid&&(n[Jc.MID]=e.mid),e.top&&(n[Jc.TOP]=e.top),e.expression&&(n[Jc.EXPRESSION]=e.expression),n}const oS="Expression_Stressed.png";function W2(){try{return Array.from(ge.document.querySelectorAll("script")).find(r=>r.src.includes("/version/"))?.src.match(/\/version\/([^/]+)\//)?.[1]||"669ccaa"}catch(e){return console.error("[Avatar API] Failed to get version hash:",e),"669ccaa"}}function V2(){return ge.location.pathname.split("/").pop()||"UNKNOWN"}async function q2(){try{const e=W2(),t=V2(),n=`https://magicgarden.gg/version/${e}/api/rooms/${t}/me/cosmetics`,r=await fetch(n,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error(`HTTP ${r.status}`);return await r.json()}catch(e){return console.error("[Avatar API] Failed to fetch owned cosmetics:",e),[]}}function Gf(){return  false}const xo={ownedFilenames:new Set,loaded:false,error:null},K2=[];function zf(){K2.forEach(e=>e());}async function iS(){try{await zm();const{Store:e}=await $n(async()=>{const{Store:r}=await Promise.resolve().then(()=>sc);return {Store:r}},void 0);if(!await e.select("isUserAuthenticatedAtom")){xo.loaded=!0,zf();return}const n=await q2();xo.ownedFilenames=new Set(n.map(r=>r.cosmeticFilename)),xo.loaded=!0,xo.error=null,zf();}catch(e){xo.error=e,xo.loaded=true,zf();}}function X2(e){return xo.ownedFilenames.has(e)}function Y2(){return xo.loaded}const sg=[];let Ey=false,Ay=false;function J2(){Ay||(Ay=true,tM().then(()=>{}).catch(()=>{}));}J2();let Ty=false;async function Q2(){Ty||(await iS(),Ty=true);}function zi(){try{const t=Array.from(ge.document.querySelectorAll("script")).find(n=>n.src.includes("/version/"));if(t){const n=t.src.match(/(https:\/\/.+?\/version\/[^/]+)/);if(n)return `${n[1]}/assets/cosmetic/`}return console.warn("[Avatar] Could not find versioned asset path, using fallback"),`${ge.location.origin}/assets/cosmetic/`}catch(e){return console.error("[Avatar] Failed to get asset base URL:",e),"https://magicgarden.gg/assets/cosmetic/"}}function Z2(e,t){if(!t)return e;let n=e;if(t.type){const r=Array.isArray(t.type)?t.type:[t.type];n=n.filter(o=>r.includes(o.type));}if(t.availability){const r=Array.isArray(t.availability)?t.availability:[t.availability];n=n.filter(o=>r.includes(o.availability));}if(t.search){const r=t.search.toLowerCase();n=n.filter(o=>o.displayName.toLowerCase().includes(r));}return n}function eM(e,t){return t?.includeUnowned?e:e.filter(n=>n.availability==="default"?true:X2(n.filename))}async function tM(){if(!Ey)try{const e=zi(),t=e.replace(/\/cosmetic\/$/,"/manifest.json"),n=await fetch(t);if(!n.ok)return;const i=((await n.json())?.bundles||[]).find(s=>s.name==="cosmetic"||s.name==="cosmetics");if(!i)return;const a=new Set(tS.map(s=>s.filename));for(const s of i.assets||[])for(const l of s.src||[]){if(typeof l!="string")continue;const c=/^(cosmetic|cosmetics)\/(.+)\.png$/i.exec(l);if(!c)continue;const d=c[1],u=c[2],f=`${u}.png`;if(a.has(f))continue;const g=u.split("_");if(g.length<2)continue;const h=g[0],y=g.slice(1).join(" ").replace(/([a-z])([A-Z])/g,"$1 $2");sg.push({id:f,filename:f,type:h,displayName:y,availability:"purchasable",price:0,url:`${e.replace(/\/cosmetic\/$/,`/${d}/`)}${f}`}),a.add(f);}Ey=!0,console.log(`[Avatar] Discovered ${sg.length} new items from manifest`);}catch(e){console.error("[Avatar] Discovery failed:",e);}}function cc(e){const t=zi(),n=sg.map(c=>({...c,url:c.url||`${t}${c.filename}`})),r=tS.map(c=>({...c,url:`${t}${c.filename}`})),o=new Set,i=[];for(const c of n)o.has(c.filename)||(i.push(c),o.add(c.filename));for(const c of r)o.has(c.filename)||(i.push(c),o.add(c.filename));const s=[...[],...i];let l=Z2(s,e);return l=eM(l,e),l}async function aS(e){return await Q2(),cc(e)}function nM(e){return cc(e).map(t=>t.url)}async function Cp(){const{avatar:e,color:t}=await nS();return {top:e[2],mid:e[1],bottom:e[0],expression:e[3],color:t,array:e}}async function rM(){const e=await nS(),t=await Cp(),n=cc(),r={};return n.forEach(o=>{r[o.type]=(r[o.type]||0)+1;}),{current:{avatar:e.avatar,color:e.color,parsed:{top:t.top,mid:t.mid,bottom:t.bottom,expression:t.expression}},counts:r,allItems:n,assetBaseUrl:zi()}}const oM="_Blank.png";let Qc=null;function iM(){if(Qc)return Promise.resolve(Qc);const e=document.createElement("canvas");return e.width=1,e.height=1,new Promise((t,n)=>{e.toBlob(r=>{if(!r){n(new Error("[MGRiveLoader] Failed to create transparent PNG"));return}r.arrayBuffer().then(o=>{Qc=new Uint8Array(o),t(Qc);},n);},"image/png");})}async function Uf(e,t,n){let r;if(t.includes(oM))r=await iM();else {const i=await fetch(`${n}${t}`).then(a=>a.arrayBuffer());r=new Uint8Array(i);}const o=await tb.decodeImage(r);e.setRenderImage(o),o.unref();}async function sS(e,t){const{imageAssets:n}=e,r=zi(),o=[];t.top&&n.Top&&o.push(Uf(n.Top,t.top,r).catch(i=>console.warn("[MGRiveLoader] Failed to load Top:",i))),t.mid&&n.Mid&&o.push(Uf(n.Mid,t.mid,r).catch(i=>console.warn("[MGRiveLoader] Failed to load Mid:",i))),t.bottom&&n.Bottom&&o.push(Uf(n.Bottom,t.bottom,r).catch(i=>console.warn("[MGRiveLoader] Failed to load Bottom:",i))),await Promise.all(o);}async function aM(e){const{canvas:t,outfit:n,riveUrl:r,stateMachine:o="State Machine 1",autoplay:i=true}=e;let a=r;if(!a){const d=await eS();if(!d)throw new Error("[MGRiveLoader] Could not find avatar .riv file");a=d.url;}console.log(`[MGRiveLoader] Creating Rive instance from: ${a}`);const s=await nb(a),l=new tb.Rive({riveFile:s.riveFile,canvas:t,autoplay:i,stateMachines:o});if(console.log("[MGRiveLoader] Rive instance created"),await sS(s,n),n.expression&&n.expression!=="Expression_Blank.png"){const u=["Expression_Default.png","Expression_Alarmed.png","Expression_Annoyed.png","Expression_Bashful.png","Expression_Calm3.png","Expression_Crying.png","Expression_Cute.png","Expression_Derpy.png","Expression_Happy.png","Expression_Mad.png","Expression_Pouty.png","Expression_Shocked.png","Expression_Thinking.png","Expression_Tired.png","Expression_Loopy.png","Expression_SoHappy.png","Expression_Vampire.png","Expression_Stressed.png"].indexOf(n.expression);if(u!==-1&&l.stateMachineInputs("State Machine 1")){const f=l.stateMachineInputs("State Machine 1").find(g=>g.name==="expression");f&&(f.value=u,console.log(`[MGRiveLoader] Set expression: ${n.expression} (index ${u})`),l.drawFrame());}}return console.log("[MGRiveLoader] Outfit applied"),{rive:l,cacheEntry:s,outfit:{...n},play(){l.play();},pause(){l.pause();},triggerAnimation(d){const u=l.stateMachineInputs(o);if(!u)return  false;const f=u.find(g=>g.name===d);return f?(typeof f.fire=="function"?f.fire():f.value=true,true):false},randomAnimation(){const d=l.stateMachineInputs(o);if(!d||d.length===0)return  false;const u=d.filter(g=>typeof g.fire=="function");return u.length===0?false:(u[Math.floor(Math.random()*u.length)].fire(),true)},destroy(){l.cleanup();}}}async function sM(e,t){if(console.log("[MGRiveLoader] Updating outfit"),await sS(e.cacheEntry,t),t.expression&&t.expression!=="Expression_Blank.png"){const r=["Expression_Default.png","Expression_Alarmed.png","Expression_Annoyed.png","Expression_Bashful.png","Expression_Calm3.png","Expression_Crying.png","Expression_Cute.png","Expression_Derpy.png","Expression_Happy.png","Expression_Mad.png","Expression_Pouty.png","Expression_Shocked.png","Expression_Thinking.png","Expression_Tired.png","Expression_Loopy.png","Expression_SoHappy.png","Expression_Vampire.png","Expression_Stressed.png"].indexOf(t.expression);if(r!==-1&&e.rive.stateMachineInputs("State Machine 1")){const o=e.rive.stateMachineInputs("State Machine 1").find(i=>i.name==="expression");o&&(o.value=r,console.log(`[MGRiveLoader] Set expression: ${t.expression} (index ${r})`),e.rive.drawFrame());}}e.outfit={...t},console.log("[MGRiveLoader] Outfit updated");}let Iy=false;async function lM(){if(!Iy){Iy=true;try{await ZC(),Cy(!0),console.log("[MGRiveLoader] Initialized");}catch(e){throw console.error("[MGRiveLoader] Initialization failed:",e),Cy(false),e}}}function cM(){return F2()}function dM(){return $2()}async function uM(e){return await nb(e)}async function pM(){const e=await eS();return e?await nb(e.url):null}async function fM(e){return await aM(e)}async function hM(e,t){return await sM(e,t)}const ja={init:lM,isReady:cM,list:dM,getRiveFile:uM,getAvatarRiveFile:pM,createInstance:fM,updateOutfit:hM};function gM(){return {ready:false,baseUrl:null,urls:{ambience:new Map,music:new Map},sfx:{mp3Url:null,atlasUrl:null,atlas:null,groups:new Map,buffer:null},tracks:{ambience:null,music:null},customAudio:{current:null,onEnd:void 0},ctx:null}}const Ge=gM();function lS(){return Ge.ready}const Py=ge??window;async function cS(){const e=Ge.ctx;if(e)return e;const t=Py.AudioContext||Py.webkitAudioContext;if(!t)throw new Error("WebAudio not supported");const n=new t;return Ge.ctx=n,n}async function dS(){if(Ge.ctx&&Ge.ctx.state==="suspended")try{await Ge.ctx.resume();}catch{}}const mM={sfx:"soundEffectsVolume",music:"musicVolume",ambience:"ambienceVolume"},bM={sfx:"soundEffectsVolumeAtom",music:"musicVolumeAtom",ambience:"ambienceVolumeAtom"},ll=.001,cl=.2;function Ry(e,t=NaN){try{const n=localStorage.getItem(e);if(n==null)return t;let r;try{r=JSON.parse(n);}catch{r=n;}if(typeof r=="number"&&Number.isFinite(r))return r;if(typeof r=="string"){const o=parseFloat(r);if(Number.isFinite(o))return o}}catch{}return t}function Rl(e){const t=mM[e],n=bM[e];if(!t)return {atom:cl,vol100:Zc(cl)};const r=Ry(t,NaN);if(Number.isFinite(r)){const i=Ir(r,0,1);return {atom:i,vol100:Zc(i)}}if(n){const i=Ry(n,NaN);if(Number.isFinite(i)){const a=Ir(i,0,1);return {atom:a,vol100:Zc(a)}}}const o=cl;return {atom:o,vol100:Zc(o)}}function vM(e){const t=Number(e);if(!Number.isFinite(t))return null;if(t<=0)return 0;const r=(Ir(t,1,100)-1)/99;return ll+r*(cl-ll)}function Zc(e){const t=Ir(Number(e),0,1);if(t<=ll)return 0;const n=(t-ll)/(cl-ll);return Math.round(1+n*99)}function uS(e,t){if(t==null)return Rl(e).atom;const n=vM(t);return n===null?Rl(e).atom:_T(n)}function yM(e){const t=new Map,n=(r,o)=>{t.has(r)||t.set(r,[]),t.get(r).push(o);};for(const r of Object.keys(e||{})){const o=/^(.*)_([A-Z])$/.exec(r);o?.[1]?n(o[1],r):n(r,r);}for(const[r,o]of Array.from(t.entries()))o.sort((i,a)=>i.localeCompare(a)),t.set(r,o);Ge.sfx.groups=t;}function wM(e){const t=Ge.sfx.atlas;if(!t)throw new Error("SFX atlas not loaded");if(t[e])return e;const n=Ge.sfx.groups.get(e);if(n?.length)return n[Math.random()*n.length|0];throw new Error(`Unknown sfx/group: ${e}`)}async function xM(){if(Ge.sfx.buffer)return Ge.sfx.buffer;if(!Ge.sfx.mp3Url)throw new Error("SFX mp3 url missing");const e=await cS();await dS();const n=await(await jx(Ge.sfx.mp3Url)).arrayBuffer(),r=await new Promise((o,i)=>{const a=e.decodeAudioData(n,o,i);a?.then&&a.then(o,i);});return Ge.sfx.buffer=r,r}async function CM(e,t={}){if(!Ge.ready)throw new Error("MGAudio not ready yet");const n=String(e||"").trim();if(!n)throw new Error("Missing sfx name");const r=wM(n),o=Ge.sfx.atlas[r];if(!o)throw new Error(`Missing segment for sfx: ${r}`);const i=await cS();await dS();const a=await xM(),s=Math.max(0,+o.start||0),l=Math.max(s,+o.end||s),c=Math.max(.01,l-s),d=uS("sfx",t.volume),u=i.createGain();u.gain.value=d,u.connect(i.destination);const f=i.createBufferSource();return f.buffer=a,f.connect(u),f.start(0,s,c),{name:r,source:f,start:s,end:l,duration:c,volume:d}}const Ga={MAX_SOUNDS:50,MAX_SIZE_BYTES:250*1024},SM={sounds:[],itemCustomSounds:[],version:1},Sr={shop:{soundId:"default-notification",volume:80,mode:"one-shot"},pet:{soundId:"default-notification",volume:80,mode:"one-shot"},weather:{soundId:"default-notification",volume:80,mode:"one-shot"}};class rb extends Error{constructor(t){super(t),this.name="CustomSoundError";}}class _M extends rb{constructor(){super(`Maximum number of sounds reached (${Ga.MAX_SOUNDS})`),this.name="SoundLimitError";}}class kM extends rb{constructor(t){super(`Sound size (${Math.round(t/1024)}KB) exceeds limit (${Ga.MAX_SIZE_BYTES/1024}KB)`),this.name="SoundSizeError";}}class EM extends rb{constructor(t){super(`Sound not found: ${t}`),this.name="SoundNotFoundError";}}function AM(e){const t={sounds:e.sounds??[],itemCustomSounds:e.itemCustomSounds??[],version:e.version??1};return e.itemCustomSounds||ob(t),t}function Sp(){const e=Xe(hn.MODULE.AUDIO_CUSTOM_SOUNDS,SM);return AM(e)}function ob(e){Ye(hn.MODULE.AUDIO_CUSTOM_SOUNDS,e);}function My(){return Sp().sounds}function _p(e){const t=Sp();t.sounds=e,ob(t);}function kp(){return Sp().itemCustomSounds}function pS(e){const t=Sp();t.itemCustomSounds=e,ob(t);}function TM(e){const t={shop:{soundId:e.shop?.soundId??Sr.shop.soundId,volume:e.shop?.volume??Sr.shop.volume,mode:e.shop?.mode??Sr.shop.mode},pet:{soundId:e.pet?.soundId??Sr.pet.soundId,volume:e.pet?.volume??Sr.pet.volume,mode:e.pet?.mode??Sr.pet.mode},weather:{soundId:e.weather?.soundId??Sr.weather.soundId,volume:e.weather?.volume??Sr.weather.volume,mode:e.weather?.mode??Sr.weather.mode}};return t!==e&&ab(t),t}function ib(){const e=Xe(hn.MODULE.AUDIO_NOTIFICATION_SETTINGS,Sr);return TM(e)}function ab(e){Ye(hn.MODULE.AUDIO_NOTIFICATION_SETTINGS,e);}const IM="https://cdn.pixabay.com/audio/2025/05/31/audio_b2dfcd42bb.mp3",fS=[{id:"default-notification",name:"Default",source:IM,type:"upload",createdAt:0}];function PM(e){const t=new Set(e.map(r=>r.id)),n=fS.filter(r=>!t.has(r.id));return n.length===0?e:[...e,...n]}function hS(e){return fS.some(t=>t.id===e)}function RM(e){if(!e.startsWith("data:"))return 0;const n=e.indexOf(",");if(n===-1)return 0;const o=e.slice(n+1).length*3/4;return Math.round(o)}function gS(e){if(!e||!e.trim())throw new Error("Sound source cannot be empty");const t=RM(e);if(t>0&&t>Ga.MAX_SIZE_BYTES)throw new kM(t)}function mS(e){if(!e||!e.trim())throw new Error("Sound name cannot be empty");if(e.length>100)throw new Error("Sound name too long (max 100 characters)")}function MM(e){if(e>=Ga.MAX_SOUNDS)throw new _M}let Yn=[],lg=false;function Nr(){lg||bS();}function LM(){return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=Math.random()*16|0;return (e==="x"?t:t&3|8).toString(16)})}function bS(){if(lg)return;let e=My();e=PM(e),e.length!==My().length&&_p(e),Yn=e,lg=true,console.log(`[CustomSounds] Initialized with ${Yn.length} sounds`);}function OM(){return Nr(),[...Yn]}function vS(e){return Nr(),Yn.find(t=>t.id===e)}function NM(e,t,n){Nr(),mS(e),gS(t),MM(Yn.length);const r={id:LM(),name:e.trim(),source:t.trim(),type:n,createdAt:Date.now()};return Yn.push(r),_p(Yn),console.log(`[CustomSounds] Added sound: ${r.name} (${r.id})`),r}function $M(e){if(Nr(),hS(e))throw new Error("Cannot remove default sounds");const t=Yn.findIndex(r=>r.id===e);if(t===-1)return  false;const n=Yn.splice(t,1)[0];return _p(Yn),console.log(`[CustomSounds] Removed sound: ${n.name} (${n.id})`),true}function DM(e,t){if(Nr(),hS(e))throw new Error("Cannot update default sounds");const n=Yn.find(r=>r.id===e);return n?(t.name!==void 0&&(mS(t.name),n.name=t.name.trim()),t.source!==void 0&&(gS(t.source),n.source=t.source.trim()),_p(Yn),console.log(`[CustomSounds] Updated sound: ${n.name} (${n.id})`),true):false}async function FM(e,t={}){Nr();const n=vS(e);if(!n)throw new EM(e);const{MGAudio:r}=await $n(async()=>{const{MGAudio:o}=await Promise.resolve().then(()=>CS);return {MGAudio:o}},void 0);try{await r.playCustom(n.source,{volume:t.volume??.5,loop:t.loop??!1}),console.log(`[CustomSounds] Playing: ${n.name} (${n.id})`);}catch(o){throw console.error(`[CustomSounds] Failed to play ${n.name}:`,o),o}}function BM(){$n(async()=>{const{MGAudio:e}=await Promise.resolve().then(()=>CS);return {MGAudio:e}},void 0).then(({MGAudio:e})=>{e.stopCustom(),console.log("[CustomSounds] Stopped current sound");});}function jM(){return ib()}function GM(e){return ib()[e]}function zM(e,t){const n=ib();n[e]=t,ab(n),console.log(`[CustomSounds] Updated notification config for ${e}:`,t);}function UM(e){ab(e),console.log("[CustomSounds] Updated all notification settings");}function za(e,t,n){return e==="shop"&&n?`${e}:${n}:${t}`:`${e}:${t}`}function yS(e,t,n){Nr();const r=kp(),o=za(e,t,n);return r.find(i=>za(i.entityType,i.entityId,i.shopType)===o)??null}function HM(e,t,n,r){Nr();const o=kp(),i=za(e,t,r),a=o.findIndex(l=>za(l.entityType,l.entityId,l.shopType)===i),s={entityType:e,entityId:t,shopType:r,soundId:n.soundId,volume:n.volume,mode:n.mode};a!==-1?o[a]=s:o.push(s),pS(o),console.log(`[CustomSounds] Set custom sound for ${e}:${t}`,n),window.dispatchEvent(new CustomEvent(Me.CUSTOM_SOUND_CHANGE,{detail:{action:"set",entityType:e,entityId:t,shopType:r,config:n}}));}function WM(e,t,n){Nr();const r=kp(),o=za(e,t,n),i=r.findIndex(a=>za(a.entityType,a.entityId,a.shopType)===o);return i===-1?false:(r.splice(i,1),pS(r),console.log(`[CustomSounds] Removed custom sound for ${e}:${t}`),window.dispatchEvent(new CustomEvent(Me.CUSTOM_SOUND_CHANGE,{detail:{action:"remove",entityType:e,entityId:t,shopType:n}})),true)}function VM(e,t,n){return yS(e,t,n)!==null}function qM(e){return Nr(),kp().filter(n=>n.entityType===e)}const Ue={init:bS,getAll:OM,getById:vS,add:NM,remove:$M,update:DM,play:FM,stop:BM,getNotificationSettings:jM,getNotificationConfig:GM,setNotificationConfig:zM,setNotificationSettings:UM,getItemCustomSound:yS,setItemCustomSound:HM,removeItemCustomSound:WM,hasItemCustomSound:VM,getItemCustomSoundsByType:qM};let ed=null;async function KM(){return Ge.ready?true:ed||(ed=(async()=>{Ge.baseUrl=await Bi.base();const e=await Zr.load({baseUrl:Ge.baseUrl}),t=Zr.getBundle(e,"audio");if(!t)throw new Error("No audio bundle in manifest");for(const n of t.assets||[])for(const r of n.src||[]){if(typeof r!="string")continue;const o=/^audio\/(ambience|music)\/(.+)\.mp3$/i.exec(r);if(o){const i=o[1].toLowerCase(),a=o[2];Ge.urls[i].set(a,Qr(Ge.baseUrl,r));continue}/^audio\/sfx\/sfx\.mp3$/i.test(r)&&(Ge.sfx.mp3Url=Qr(Ge.baseUrl,r)),/^audio\/sfx\/sfx\.json$/i.test(r)&&(Ge.sfx.atlasUrl=Qr(Ge.baseUrl,r));}if(!Ge.sfx.atlasUrl)throw new Error("Missing audio/sfx/sfx.json in manifest");return Ge.sfx.atlas=await $m(Ge.sfx.atlasUrl),yM(Ge.sfx.atlas),Ue.init(),Ge.ready=true,true})(),ed)}function wS(e){if(e!=="music"&&e!=="ambience")return  false;const t=Ge.tracks[e];if(t){try{t.pause();}catch{}try{t.src="";}catch{}}return Ge.tracks[e]=null,true}function XM(e,t,n={}){if(!Ge.ready)throw new Error("MGAudio not ready yet");if(e!=="music"&&e!=="ambience")throw new Error(`Invalid category: ${e}`);const r=Ge.urls[e].get(t);if(!r)throw new Error(`Unknown ${e}: ${t}`);wS(e);const o=new Audio(r);return o.loop=!!n.loop,o.volume=uS(e,n.volume),o.preload="auto",o.play().catch(()=>{}),Ge.tracks[e]=o,o}function YM(e,t={}){const n=String(e||"").trim();return n==="music"||n==="ambience"?Array.from(Ge.urls[n].keys()).sort():n==="sfx"?Ge.sfx.atlas?t.groups?Array.from(Ge.sfx.groups.keys()).sort():Object.keys(Ge.sfx.atlas).sort():[]:[]}function JM(){return ["sfx","music","ambience"]}function QM(){return Array.from(Ge.sfx.groups.keys()).sort((e,t)=>e.localeCompare(t))}function ZM(e,t){const n=String(e||"").trim().toLowerCase(),r=String(t||"").trim();if(!r||n!=="music"&&n!=="ambience")return  false;const o=Ge.urls[n],i=r.toLowerCase();for(const a of Array.from(o.keys()))if(a.toLowerCase()===i)return  true;return  false}function eL(e){const t=String(e||"").trim();if(!t)return  false;const n=t.toLowerCase();for(const r of Array.from(Ge.sfx.groups.keys()))if(r.toLowerCase()===n)return  true;return  false}function tL(e,t){const n=String(e||"").trim().toLowerCase(),r=String(t||"").trim();if(!r)throw new Error("getTrackUrl(category, name) missing name");if(n!=="music"&&n!=="ambience")throw new Error(`Invalid category: ${e}`);const o=Ge.urls[n],i=r.toLowerCase();for(const[a,s]of Array.from(o.entries()))if(a.toLowerCase()===i)return s;return null}function nL(){return Ge.tracks.music&&(Ge.tracks.music.volume=Rl("music").atom),Ge.tracks.ambience&&(Ge.tracks.ambience.volume=Rl("ambience").atom),true}let On=null;async function rL(e,t={}){xS();const n=new Audio(e);n.volume=t.volume??1,n.loop=t.loop??false,n.preload="auto";const r={audio:n,url:e,stop:()=>{n.loop?n.loop=false:(n.pause(),n.currentTime=0,On?.audio===n&&(On=null));},setVolume:o=>{n.volume=Math.max(0,Math.min(1,o));},isPlaying:()=>!n.paused&&!n.ended};On=r;try{await new Promise((o,i)=>{const a=setTimeout(()=>{i(new Error("Audio load timeout"));},5e3),s=()=>{clearTimeout(a),n.removeEventListener("canplay",l),n.removeEventListener("error",c);},l=()=>{s(),o();},c=()=>{s(),i(new Error(`Audio load error: ${n.error?.message}`));};n.readyState>=2?(clearTimeout(a),o()):(n.addEventListener("canplay",l,{once:!0}),n.addEventListener("error",c,{once:!0}));}),await n.play();}catch(o){throw On=null,o}return n.addEventListener("ended",()=>{On?.audio===n&&(On=null);}),r}function xS(){return On?(On.stop(),On=null,true):false}function oL(e){return On?(On.setVolume(e),true):false}function iL(){return On?.isPlaying()??false}function aL(){return On}function Sn(){if(!lS())throw new Error("MGAudio not ready yet")}async function sL(e,t,n={}){const r=String(e||"").trim(),o=String(t||"").trim();if(!r||!o)throw new Error("play(category, asset) missing args");if(r==="sfx")return CM(o,n);if(r==="music"||r==="ambience")return XM(r,o,n);throw new Error(`Unknown category: ${r}`)}const Dt={init:KM,isReady:lS,play:sL,stop:e=>(Sn(),wS(e)),list:(e,t)=>(Sn(),YM(e,t)),refreshVolumes:()=>(Sn(),nL()),categoryVolume:e=>(Sn(),Rl(e)),getCategories:()=>(Sn(),JM()),getGroups:()=>(Sn(),QM()),hasTrack:(e,t)=>(Sn(),ZM(e,t)),hasGroup:e=>(Sn(),eL(e)),getTrackUrl:(e,t)=>(Sn(),tL(e,t)),playCustom:async(e,t)=>(Sn(),rL(e,t)),stopCustom:()=>(Sn(),xS()),setCustomVolume:e=>(Sn(),oL(e)),isCustomPlaying:()=>(Sn(),iL()),getCustomHandle:()=>(Sn(),aL()),CustomSounds:Ue},CS=Object.freeze(Object.defineProperty({__proto__:null,MGAudio:Dt},Symbol.toStringTag,{value:"Module"}));function lL(){return {ready:false,baseUrl:null,byCat:new Map,byBase:new Map,overlay:null,live:new Set,defaultParent:null}}const bt=lL();function SS(){return bt.ready}let td=null;async function cL(){return bt.ready?true:td||(td=(async()=>{bt.baseUrl=await Bi.base();const e=await Zr.load({baseUrl:bt.baseUrl}),t=Zr.getBundle(e,"cosmetic");if(!t)throw new Error("No 'cosmetic' bundle in manifest");bt.byCat.clear(),bt.byBase.clear();for(const n of t.assets||[])for(const r of n.src||[]){if(typeof r!="string"||!/^cosmetic\/.+\.png$/i.test(r))continue;const i=r.split("/").pop().replace(/\.png$/i,""),a=i.indexOf("_");if(a<0)continue;const s=i.slice(0,a),l=i.slice(a+1),c=Qr(bt.baseUrl,r);bt.byBase.set(i,c),bt.byCat.has(s)||bt.byCat.set(s,new Map),bt.byCat.get(s).set(l,c);}return bt.ready=true,true})(),td)}function cg(e){let t=String(e||"").trim();return t?(t=t.replace(/^cosmetic\//i,""),t=t.replace(/\.png$/i,""),t):""}function dL(e,t){if(t===void 0){const i=cg(e),a=i.indexOf("_");return a<0?{cat:"",asset:i,base:i}:{cat:i.slice(0,a),asset:i.slice(a+1),base:i}}const n=String(e||"").trim(),r=cg(t),o=r.includes("_")?r:`${n}_${r}`;if(r.includes("_")&&!n){const i=r.indexOf("_");return {cat:r.slice(0,i),asset:r.slice(i+1),base:r}}return {cat:n,asset:r.replace(/^.+?_/,""),base:o}}function uL(){return Array.from(bt.byCat.keys()).sort((e,t)=>e.localeCompare(t))}function pL(e){const t=bt.byCat.get(String(e||"").trim());return t?Array.from(t.keys()).sort((n,r)=>n.localeCompare(r)):[]}function dg(e,t){const{cat:n,asset:r,base:o}=dL(e,t),i=bt.byBase.get(o);if(i)return i;const s=bt.byCat.get(n)?.get(r);if(s)return s;if(!bt.baseUrl)throw new Error("MGCosmetic not initialized");if(!o)throw new Error("Invalid cosmetic name");return Qr(bt.baseUrl,`cosmetic/${o}.png`)}const Ly=ge?.document??document;function fL(){if(bt.overlay)return bt.overlay;const e=Ly.createElement("div");return e.id="MG_COSMETIC_OVERLAY",e.style.cssText=["position:fixed","left:0","top:0","width:100vw","height:100vh","pointer-events:none","z-index:99999999"].join(";"),Ly.documentElement.appendChild(e),bt.overlay=e,e}function hL(){const e=bt.defaultParent;if(!e)return null;try{return typeof e=="function"?e():e}catch{return null}}function gL(e){return bt.defaultParent=e,true}const mL=ge?.document??document;function ug(e,t,n){if(!bt.ready)throw new Error("MGCosmetic not ready yet");let r,o;typeof t=="object"&&t!==null?(r=t,o=void 0):typeof t=="string"?(o=t,r=n||{}):(o=void 0,r=n||{});const i=o!==void 0?dg(e,o):dg(e),a=mL.createElement("img");if(a.decoding="async",a.loading="eager",a.src=i,a.alt=r.alt!=null?String(r.alt):cg(o??e),r.className&&(a.className=String(r.className)),r.width!=null&&(a.style.width=String(r.width)),r.height!=null&&(a.style.height=String(r.height)),r.opacity!=null&&(a.style.opacity=String(r.opacity)),r.style&&typeof r.style=="object")for(const[s,l]of Object.entries(r.style))try{a.style[s]=String(l);}catch{}return a}function bL(e,t,n){let r,o;typeof t=="object"&&t!==null?(r=t,o=void 0):typeof t=="string"?(o=t,r=n||{}):(o=void 0,r=n||{});const i=r.parent||hL()||fL(),a=o!==void 0?ug(e,o,r):ug(e,r);if(i===bt.overlay||r.center||r.x!=null||r.y!=null||r.absolute){a.style.position="absolute",a.style.pointerEvents="none",a.style.zIndex=String(r.zIndex??999999);const l=r.scale??1,c=r.rotation??0;if(r.center)a.style.left="50%",a.style.top="50%",a.style.transform=`translate(-50%, -50%) scale(${l}) rotate(${c}rad)`;else {const d=r.x??innerWidth/2,u=r.y??innerHeight/2;a.style.left=`${d}px`,a.style.top=`${u}px`,a.style.transform=`scale(${l}) rotate(${c}rad)`,r.anchor==="center"&&(a.style.transform=`translate(-50%, -50%) scale(${l}) rotate(${c}rad)`);}}return i.appendChild(a),bt.live.add(a),a.__mgDestroy=()=>{try{a.remove();}catch{}bt.live.delete(a);},a}function vL(){for(const e of Array.from(bt.live))e.__mgDestroy?.();}const yL=100,Hf=[];function pg(e,t,n){let r="";if(n&&typeof n=="object"){if(t==="PartialState"){const o=n.op||"",i=n.path||"";let a="";if("value"in n){const s=n.value;a=typeof s=="object"?`{${Object.keys(s||{}).slice(0,2).join(",")}}`:String(s);}if(o||i)r=`PartialState : ${o} ${i} ${a}`.trim();else {const s=Object.keys(n).filter(l=>l!=="type");s.length>0&&(r=`PartialState - {${s.join(", ")}}`);}}if(!r&&n.event&&(r+=`${n.event} `),!r&&n.op&&(r+=`op:${n.op} `),!r&&n.data){const o=Object.keys(n.data);o.length>0&&(r+=`{${o.slice(0,3).join(",")}${o.length>3?"...":""}}`);}else !r&&Array.isArray(n)&&(r+=`[${n.length} items]`);}else typeof n=="string"&&(r=n.slice(0,50));Hf.push({direction:e,type:String(t),timestamp:Date.now(),payload:n,summary:r.trim()||"-"}),Hf.length>yL&&Hf.shift();}const _n={nativeCtor:null,captured:[],latestOpen:null},Oy=Symbol.for("ariesmod.ws.capture.wrapped"),Ny=Symbol.for("ariesmod.ws.capture.native"),_S=1;function fg(e){return !!e&&e.readyState===_S}function wL(){if(fg(_n.latestOpen))return _n.latestOpen;for(let e=_n.captured.length-1;e>=0;e--){const t=_n.captured[e];if(fg(t))return t}return null}function xL(e,t){_n.captured.push(e),_n.captured.length>25&&_n.captured.splice(0,_n.captured.length-25);const n=()=>{_n.latestOpen=e,t&&console.log("[WS] captured socket opened",e.url);};e.addEventListener("open",n),e.addEventListener("close",()=>{_n.latestOpen===e&&(_n.latestOpen=null),t&&console.log("[WS] captured socket closed",e.url);}),e.addEventListener("message",r=>{try{const o=JSON.parse(r.data);pg("in",o.type||"unknown",o);}catch{pg("in","raw",r.data);}}),e.readyState===_S&&n();}function CL(e=ge,t={}){const n=!!t.debug,r=e?.WebSocket;if(typeof r!="function")return ()=>{};if(r[Oy])return _n.nativeCtor=r[Ny]??_n.nativeCtor??null,()=>{};const o=r;_n.nativeCtor=o;function i(a,s){const l=s!==void 0?new o(a,s):new o(a);try{xL(l,n);}catch{}return l}try{i.prototype=o.prototype;}catch{}try{Object.setPrototypeOf(i,o);}catch{}try{i.CONNECTING=o.CONNECTING,i.OPEN=o.OPEN,i.CLOSING=o.CLOSING,i.CLOSED=o.CLOSED;}catch{}i[Oy]=true,i[Ny]=o;try{e.WebSocket=i,n&&console.log("[WS] WebSocket capture installed");}catch{return ()=>{}}return ()=>{try{e.WebSocket===i&&(e.WebSocket=o);}catch{}}}function SL(e=ge){const t=e?.MagicCircle_RoomConnection?.currentWebSocket;return t&&typeof t=="object"?t:null}function Nu(e=ge){const t=wL();if(t)return {ws:t,source:"captured"};const n=SL(e);return n?{ws:n,source:"roomConnection"}:{ws:null,source:null}}function kS(e,t={}){const n=t.pageWindow??ge,r=t.intervalMs??500,o=!!t.debug;let i=null,a=null;const s=()=>{const c=Nu(n);(c.ws!==i||c.source!==a)&&(i=c.ws,a=c.source,o&&console.log("[WS] best socket changed:",c.source,c.ws),e(c));};s();const l=setInterval(s,r);return ()=>clearInterval(l)}function _L(e){if(typeof e=="string")return e;try{return JSON.stringify(e)}catch{return null}}function kL(e,t=ge){const n=t?.MagicCircle_RoomConnection;if(n&&typeof n.sendMessage=="function")try{return Array.isArray(e)?n.sendMessage(...e):n.sendMessage(e),{ok:!0}}catch(i){return {ok:false,reason:"error",error:i}}const{ws:r}=Nu(t);if(!r)return {ok:false,reason:"no-ws"};if(!fg(r))return {ok:false,reason:"not-open"};const o=_L(e);if(o==null)return {ok:false,reason:"error",error:new Error("Cannot stringify message")};try{const i=JSON.parse(o);pg("out",i.type||"unknown",i);}catch{}try{return r.send(o),{ok:!0}}catch(i){return {ok:false,reason:"error",error:i}}}function EL(e,t={},n=ge){return kL({type:e,...t},n)}const uo={Welcome:"Welcome",PartialState:"PartialState",ServerErrorMessage:"ServerErrorMessage",Config:"Config",InappropriateContentRejected:"InappropriateContentRejected",Emote:"Emote",CurrencyTransaction:"CurrencyTransaction",Pong:"Pong"},be={Chat:"Chat",Emote:"Emote",Wish:"Wish",KickPlayer:"KickPlayer",SetPlayerData:"SetPlayerData",UsurpHost:"UsurpHost",Dev:"Dev",SetSelectedGame:"SetSelectedGame",VoteForGame:"VoteForGame",RequestGame:"RequestGame",RestartGame:"RestartGame",Ping:"Ping",PlayerPosition:"PlayerPosition",Teleport:"Teleport",CheckWeatherStatus:"CheckWeatherStatus",MoveInventoryItem:"MoveInventoryItem",DropObject:"DropObject",PickupObject:"PickupObject",ToggleFavoriteItem:"ToggleFavoriteItem",PutItemInStorage:"PutItemInStorage",RetrieveItemFromStorage:"RetrieveItemFromStorage",MoveStorageItem:"MoveStorageItem",LogItems:"LogItems",PlantSeed:"PlantSeed",WaterPlant:"WaterPlant",HarvestCrop:"HarvestCrop",SellAllCrops:"SellAllCrops",PurchaseSeed:"PurchaseSeed",PurchaseEgg:"PurchaseEgg",PurchaseTool:"PurchaseTool",PurchaseDecor:"PurchaseDecor",PlantEgg:"PlantEgg",HatchEgg:"HatchEgg",PlantGardenPlant:"PlantGardenPlant",PotPlant:"PotPlant",MutationPotion:"MutationPotion",PickupDecor:"PickupDecor",PlaceDecor:"PlaceDecor",RemoveGardenObject:"RemoveGardenObject",PlacePet:"PlacePet",FeedPet:"FeedPet",PetPositions:"PetPositions",SwapPet:"SwapPet",StorePet:"StorePet",NamePet:"NamePet",SellPet:"SellPet",ReportSpeakingStart:"ReportSpeakingStart"};var hr=(e=>(e[e.ReconnectInitiated=4100]="ReconnectInitiated",e[e.PlayerLeftVoluntarily=4200]="PlayerLeftVoluntarily",e[e.UserSessionSuperseded=4250]="UserSessionSuperseded",e[e.ConnectionSuperseded=4300]="ConnectionSuperseded",e[e.ServerDisposed=4310]="ServerDisposed",e[e.HeartbeatExpired=4400]="HeartbeatExpired",e[e.PlayerKicked=4500]="PlayerKicked",e[e.VersionMismatch=4700]="VersionMismatch",e[e.VersionExpired=4710]="VersionExpired",e[e.AuthenticationFailure=4800]="AuthenticationFailure",e))(hr||{});new Set(Object.values(uo));new Set(Object.values(be));const AL=["Room","Quinoa"],TL={Room:["Room"],Quinoa:AL};function He(e,t={},n=ge){const r=t,{scopePath:o,scope:i,...a}=r,s=typeof o=="string"?o:i,l=Array.isArray(o)?o:s==="Room"||s==="Quinoa"?TL[s]:null;return EL(e,l?{scopePath:l,...a}:a,n)}function IL(e,t=ge){return He(be.Chat,{scope:"Room",message:e},t)}function PL(e,t=ge){return He(be.Emote,{scope:"Room",emoteType:e},t)}function RL(e,t=ge){return He(be.Wish,{scope:"Quinoa",wish:e},t)}function ML(e,t=ge){return He(be.KickPlayer,{scope:"Room",targetPlayerId:e},t)}function Ep(e,t=ge){const{name:n,cosmetic:r}=e;return He(be.SetPlayerData,{scope:"Room",name:n,cosmetic:r},t)}function LL(e=ge){return He(be.UsurpHost,{scope:"Quinoa"},e)}function OL(e=ge){return He(be.ReportSpeakingStart,{scope:"Quinoa"},e)}function NL(e,t=ge){return He(be.SetSelectedGame,{scope:"Room",gameId:e},t)}function $L(e,t=ge){return He(be.VoteForGame,{scope:"Room",gameId:e},t)}function DL(e,t=ge){return He(be.RequestGame,{scope:"Room",gameId:e},t)}function FL(e=ge){return He(be.RestartGame,{scope:"Room"},e)}function BL(e,t=ge){return He(be.Ping,{scope:"Quinoa",id:e},t)}function ES(e,t,n=ge){return He(be.PlayerPosition,{scope:"Quinoa",x:e,y:t},n)}const jL=ES;function GL(e,t,n=ge){return He(be.Teleport,{scope:"Quinoa",x:e,y:t},n)}function zL(e=ge){return He(be.CheckWeatherStatus,{scope:"Quinoa"},e)}function UL(e,t,n=ge){return He(be.MoveInventoryItem,{scope:"Quinoa",fromIndex:e,toIndex:t},n)}function HL(e,t=ge){return He(be.DropObject,{scope:"Quinoa",slotIndex:e},t)}function WL(e,t=ge){return He(be.PickupObject,{scope:"Quinoa",objectId:e},t)}function Ap(e,t=ge){return He(be.ToggleFavoriteItem,{scope:"Quinoa",itemId:e},t)}function sb(e,t="PetHutch",n=ge){return He(be.PutItemInStorage,{scope:"Quinoa",itemId:e,storageId:t},n)}function lb(e,t="PetHutch",n=ge){return He(be.RetrieveItemFromStorage,{scope:"Quinoa",itemId:e,storageId:t},n)}function VL(e,t,n=ge){return He(be.MoveStorageItem,{scope:"Quinoa",fromIndex:e,toIndex:t},n)}function qL(e=ge){return He(be.LogItems,{scope:"Quinoa"},e)}function KL(e,t,n,r=ge){return He(be.PlantSeed,{scope:"Quinoa",seedId:e,x:t,y:n},r)}function XL(e,t=ge){return He(be.WaterPlant,{scope:"Quinoa",plantId:e},t)}function YL(e,t=ge){return He(be.HarvestCrop,{scope:"Quinoa",cropId:e},t)}function JL(e=ge){return He(be.SellAllCrops,{scope:"Quinoa"},e)}function cb(e,t=ge){return He(be.PurchaseDecor,{scope:"Quinoa",decorId:e},t)}function db(e,t=ge){return He(be.PurchaseEgg,{scope:"Quinoa",eggId:e},t)}function ub(e,t=ge){return He(be.PurchaseTool,{scope:"Quinoa",toolId:e},t)}function pb(e,t=ge){return He(be.PurchaseSeed,{scope:"Quinoa",species:e},t)}function QL(e,t,n,r=ge){return He(be.PlantEgg,{scope:"Quinoa",eggId:e,x:t,y:n},r)}function ZL(e,t=ge){return He(be.HatchEgg,{scope:"Quinoa",eggId:e},t)}function eO(e,t,n,r=ge){return He(be.PlantGardenPlant,{scope:"Quinoa",plantId:e,x:t,y:n},r)}function tO(e,t,n=ge){return He(be.PotPlant,{scope:"Quinoa",plantId:e,potId:t},n)}function nO(e,t,n=ge){return He(be.MutationPotion,{scope:"Quinoa",potionId:e,targetId:t},n)}function rO(e,t=ge){return He(be.PickupDecor,{scope:"Quinoa",decorInstanceId:e},t)}function oO(e,t,n,r=ge){return He(be.PlaceDecor,{scope:"Quinoa",decorId:e,x:t,y:n},r)}function iO(e,t=ge){return He(be.RemoveGardenObject,{scope:"Quinoa",objectId:e},t)}function AS(e,t={x:0,y:0},n="Dirt",r=0,o=ge){return He(be.PlacePet,{scope:"Quinoa",itemId:e,position:t,tileType:n,localTileIndex:r},o)}function aO(e,t,n=ge){return He(be.FeedPet,{scope:"Quinoa",petId:e,foodItemId:t},n)}function sO(e,t=ge){return He(be.PetPositions,{scope:"Quinoa",positions:e},t)}function TS(e,t,n=ge){return He(be.SwapPet,{scope:"Quinoa",petSlotId:e,petInventoryId:t},n)}function IS(e,t=ge){return He(be.StorePet,{scope:"Quinoa",itemId:e},t)}function lO(e,t,n=ge){return He(be.NamePet,{scope:"Quinoa",petId:e,name:t},n)}function cO(e,t=ge){return He(be.SellPet,{scope:"Quinoa",petId:e},t)}async function PS(e){try{const t=await Cp(),n=[e.bottom!==void 0?e.bottom:t.bottom,e.mid!==void 0?e.mid:t.mid,e.top!==void 0?e.top:t.top,e.expression!==void 0?e.expression:t.expression],r=e.color!==void 0?e.color:t.color,o=Ep({cosmetic:{color:r,avatar:n}},ge);return console.log("[Avatar] Set outfit:",{outfit:e,finalAvatar:n,result:o}),!0}catch(t){return console.error("[Avatar] Failed to set outfit:",t),false}}async function dO(){return PS({top:"Top_DefaultGray.png",mid:"Mid_DefaultGray.png",bottom:"Bottom_DefaultGray.png",expression:"Expression_Default.png",color:"Red"})}const Gs=new Map;function uO(e){if(Gs.has(e))return Gs.get(e);const t=new Promise((n,r)=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>n(o),o.onerror=()=>{Gs.delete(e),r(new Error(`Failed to load image: ${e}`));},o.src=e;});return Gs.set(e,t),t}function pO(){Gs.clear();}function fO(e){return cc().find(r=>r.filename===e)?.url||""}async function hO(e,t={}){const n=document.createElement("canvas"),r=t.width||400,o=t.height||400,i=t.scale||1;n.width=r*i,n.height=o*i;const a=n.getContext("2d");if(!a)throw new Error("Failed to get canvas 2D context");if(a.imageSmoothingEnabled=i!==1,e.color){const d={Red:"#FF0000",Blue:"#0000FF",Green:"#00FF00",Yellow:"#FFFF00",Purple:"#800080",Orange:"#FFA500",Pink:"#FFC0CB",Brown:"#A52A2A"};a.fillStyle=d[e.color]||"#FF0000",a.fillRect(0,0,n.width,n.height);}const l=[e.bottom,e.mid,e.top,e.expression].filter(d=>!!d).map(d=>fO(d));return (await Promise.all(l.map(d=>uO(d)))).forEach(d=>{a.drawImage(d,0,0,n.width,n.height);}),n}let fb=null,Ca=null,pi=null,_o=null;function Wf(e){return zi()+e}async function gO(e){try{const{Store:t}=await $n(async()=>{const{Store:a}=await Promise.resolve().then(()=>sc);return {Store:a}},void 0),n=await t.select("myDataAtom"),r=n?.cosmetic?.avatar||[],o=rS(e,r),i=e.color||n?.cosmetic?.color||"Red";return fb={avatar:o,color:i},bO(),vO(o),console.log("[Avatar] Rendered avatar override:",o),!0}catch(t){return console.error("[Avatar] Failed to render avatar:",t),false}}async function mO(){fb=null,Ca&&(clearInterval(Ca),Ca=null),pi&&(pi.disconnect(),pi=null);const e=ge.document;return e.querySelectorAll("[data-gemini-avatar-overridden]").forEach(t=>{t.removeAttribute("data-gemini-avatar-overridden");}),e.querySelectorAll(".gemini-avatar-overlay").forEach(t=>t.remove()),e.querySelectorAll("img[data-gemini-override]").forEach(t=>{t.removeAttribute("data-gemini-override");}),_o&&(_o.remove(),_o=null),console.log("[Avatar] Cleared override"),true}function bO(){if(_o)return;const e=ge.document;_o=e.createElement("style"),_o.id="gemini-avatar-override-styles",_o.textContent=`
        [data-gemini-avatar-overridden="true"] canvas {
            opacity: 0 !important;
            visibility: hidden !important;
        }

        .gemini-avatar-overlay {
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            pointer-events: none !important;
            z-index: 9999 !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }

        .gemini-avatar-overlay img {
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            object-fit: contain !important;
        }
    `,e.head.appendChild(_o);}function vO(e){Ca&&clearInterval(Ca),pi&&pi.disconnect();const t=ge.document,n=()=>{const o=t.querySelectorAll(".Avatar");let i=0;o.forEach(a=>{const s=Array.from(a.querySelectorAll("img"));if(s.length===4){let c=false;s.forEach((d,u)=>{const f=Wf(e[u]);d.src!==f&&(c=true);}),c&&(s.forEach((d,u)=>{d.src=Wf(e[u]),d.setAttribute("data-gemini-override",e[u]);}),i++);return}if(a.querySelector("canvas")&&!a.querySelector(".gemini-avatar-overlay")){a.setAttribute("data-gemini-avatar-overridden","true");const c=t.createElement("div");c.className="gemini-avatar-overlay",e.forEach(d=>{const u=t.createElement("img");u.src=Wf(d),u.setAttribute("data-gemini-cosmetic",d),c.appendChild(u);}),window.getComputedStyle(a).position==="static"&&(a.style.position="relative"),a.appendChild(c),i++;}}),i>0&&console.log(`[Avatar] Re-applied ${i} override(s) (React reverted)`);};n(),Ca=setInterval(n,500),pi=new MutationObserver(()=>{setTimeout(n,10);});const r=t.querySelector(".game-root")||t.querySelector("#root")||t.body;pi.observe(r,{childList:true,subtree:true,attributeFilter:["src"]}),console.log("[Avatar] Aggressive monitor started (500ms + MutationObserver)");}function yO(){return fb}function wO(e){if(!e)return  false;const t=e.toLowerCase();return t.includes("_blank")||t.includes("_none")||t===oS.toLowerCase()}function xO(e){return e.some(wO)}let $u=null,ga=null;ge.Gemini_AvatarOverride=null;async function RS(e){try{const{Store:t}=await $n(async()=>{const{Store:y}=await Promise.resolve().then(()=>sc);return {Store:y}},void 0),{getPlayers:n}=await $n(async()=>{const{getPlayers:y}=await Promise.resolve().then(()=>jS);return {getPlayers:y}},void 0);Gf();const i=n().get().myPlayer;if(!i)return console.error("[WorldAvatar] myPlayer not available"),!1;const a=i.id,s=i.cosmetic.avatar;ge.MagicCircle_PlayerId=a,ga||(ga=[...s]);let l=rS(e,s);const c=xO(l);Gf(),$u=l,ge.Gemini_AvatarOverride=l,console.log("[WorldAvatar] Applying override:",l);const d=await t.select("stateAtom");if(!d?.data?.players)return console.error("[WorldAvatar] stateAtom.data.players not available"),!1;const u=d.data.players.findIndex(y=>y.id===a);if(u===-1)return console.error("[WorldAvatar] Current player not found in players array"),!1;const f=d.data.players[u],g=[...d.data.players];g[u]={...f,cosmetic:{...f.cosmetic,avatar:l}};const h={...d,data:{...d.data,players:g}};return await t.set("stateAtom",h),Gf()&&c||Ep({name:i.name,cosmetic:{...i.cosmetic,avatar:l}},ge),!0}catch{return  false}}async function CO(){if(!$u||!ga)return  true;try{const{Store:e}=await $n(async()=>{const{Store:u}=await Promise.resolve().then(()=>sc);return {Store:u}},void 0),{getPlayers:t}=await $n(async()=>{const{getPlayers:u}=await Promise.resolve().then(()=>jS);return {getPlayers:u}},void 0);ge.Gemini_AvatarOverride=null;const o=t().get().myPlayer;if(!o)return !1;const i=o.id,a=await e.select("stateAtom");if(!a?.data?.players)return !1;const s=a.data.players.findIndex(u=>u.id===i);if(s===-1)return !1;const l=a.data.players[s],c=[...a.data.players];c[s]={...l,cosmetic:{...l.cosmetic,avatar:ga}};const d={...a,data:{...a.data,players:c}};return await e.set("stateAtom",d),Ep({name:o.name,cosmetic:{...o.cosmetic,avatar:ga}},ge),$u=null,ga=null,!0}catch{return  false}}function SO(){return $u}let dn=[];const Kd=[],$y=()=>{Kd.forEach(e=>e([...dn]));},ki={init(){dn=Xe(hn.SECTION.AVATAR_LOADOUTS,[]);},get(){return [...dn]},async save(e,t,n){if(!n){const i=dn.find(a=>a.top===t.top&&a.mid===t.mid&&a.bottom===t.bottom&&a.expression===t.expression);if(i)return i.id}const r=n||Math.random().toString(36).substring(2,9),o={...t,id:r,name:e,createdAt:n&&dn.find(i=>i.id===n)?.createdAt||Date.now()};if(n){const i=dn.findIndex(a=>a.id===n);i!==-1?dn[i]=o:dn.push(o);}else dn.push(o);return Ye(hn.SECTION.AVATAR_LOADOUTS,dn),$y(),r},delete(e){dn=dn.filter(t=>t.id!==e),Ye(hn.SECTION.AVATAR_LOADOUTS,dn),$y();},rename(e,t){const n=dn.find(r=>r.id===e);n&&(n.name=t,Ye(hn.SECTION.AVATAR_LOADOUTS,dn));},async wear(e){const t=dn.find(r=>r.id===e);if(!t)return  false;const n={top:t.top,mid:t.mid,bottom:t.bottom,expression:t.expression};return await RS(n)},subscribe(e){return Kd.push(e),()=>{const t=Kd.indexOf(e);t!==-1&&Kd.splice(t,1);}}},MS={init:iS,isReady:()=>Y2(),list:cc,listAsync:aS,listUrls:nM,get:Cp,debug:rM,set:PS,blank:dO,Loadouts:ki,toCanvas:hO,clearImageCache:pO,render:gO,clearOverride:mO,getOverride:yO,renderWorld:RS,clearWorldOverride:CO,getWorldOverride:SO};function Zo(){if(!SS())throw new Error("MGCosmetic not ready yet")}const hb={init:cL,isReady:SS,categories:()=>(Zo(),uL()),list:e=>(Zo(),pL(e)),url:((e,t)=>(Zo(),dg(e,t))),create:((e,t,n)=>(Zo(),ug(e,t,n))),show:((e,t,n)=>(Zo(),bL(e,t,n))),attach:e=>(Zo(),gL(e)),clear:()=>(Zo(),vL()),Avatar:MS},Dy={Gold:25,Rainbow:50,Wet:2,Chilled:2,Frozen:10,Dawnlit:2,Dawnbound:3,Amberlit:5,Amberbound:6};function LS(e){const t=ue.get("mutations");if(!t)return Dy[e]??null;const n=t[e];return !n||typeof n.coinMultiplier!="number"?Dy[e]??null:n.coinMultiplier}const Vf=new Map;function qf(e){if(Vf.has(e))return Vf.get(e);const t=LS(e)??1;return Vf.set(e,t),t}const _O=new Set(["Gold","Rainbow"]),kO=new Set(["Wet","Chilled","Frozen","Dawnlit","Dawnbound","Amberlit","Amberbound"]);function gb(e){let t=1,n=0,r=0;for(const o of e)if(o==="Gold"||o==="Rainbow")o==="Rainbow"?t=qf("Rainbow"):t===1&&(t=qf("Gold"));else {const i=qf(o);i>1&&(n+=i,r++);}return t*(1+n-r)}function EO(e){return LS(e)}function AO(e){return _O.has(e)}function TO(e){return kO.has(e)}function IO(e){return TO(e)}function mb(e,t){const n=Tp(e);if(!n)return 50;const r=n.maxScale;if(t<=1)return 50;if(t>=r)return 100;const o=(t-1)/(r-1);return Math.floor(50+50*o)}function dr(e,t,n){const r=Tp(e);if(!r)return 0;const o=r.baseSellPrice,i=gb(n);return Math.round(o*t*i)}function PO(e,t,n){if(n>=t)return 100;if(n<=e)return 0;const r=t-e,o=n-e;return Math.floor(o/r*100)}function RO(e,t){return t>=e}function Tp(e){const t=ue.get("plants");if(!t)return null;const n=t[e];return n?.crop?{baseSellPrice:n.crop.baseSellPrice??0,maxScale:n.crop.maxScale??1,growTime:n.crop.growTime??0}:null}const OS=3600,Kf=80,MO=100,zs=30;function Ip(e){return e/OS}function dc(e,t){const n=pc(e);if(!n)return Kf;const r=n.maxScale;if(t<=1)return Kf;if(t>=r)return MO;const o=(t-1)/(r-1);return Math.floor(Kf+20*o)}function uc(e,t,n){const r=pc(e);if(!r)return n-zs;const o=r.hoursToMature,i=t/OS,a=zs/o,s=Math.min(a*i,zs),l=n-zs;return Math.floor(l+s)}function Pp(e,t){const n=pc(e);return n?t>=n.hoursToMature:false}function NS(e){const t=pc(e);return t?zs/t.hoursToMature:0}function LO(e,t,n){const r=t-e;return r<=0||n<=0?0:r/n}function pc(e){const t=ue.get("pets");if(!t)return null;const n=t[e];return n?{hoursToMature:n.hoursToMature??0,maxScale:n.maxScale??1,abilities:n.abilities??[]}:null}function $S(e,t){return t<=0?1:Math.min(1,e/t)}const Zt=3600,nd=80,Fy=100,Pr=30,OO={Worm:30,Snail:60,Bee:15,Chicken:60,Bunny:45,Dragonfly:15,Pig:60,Cow:75,Turkey:60,SnowFox:45,Stoat:60,WhiteCaribou:75,Squirrel:30,Turtle:90,Goat:60,Butterfly:30,Peacock:60,Capybara:60};function fc(e){const t=ue.get("pets");if(!t)return null;const n=t[e];return n?{hoursToMature:n.hoursToMature??0,maxScale:n.maxScale??1}:null}function NO(e){return e/Zt}function hc(e,t){const n=fc(e);if(!n)return nd;const{maxScale:r}=n;if(t<=1)return nd;if(t>=r)return Fy;const o=(t-1)/(r-1);return Math.floor(nd+(Fy-nd)*o)}function $O(e){return e-Pr}function DO(e){const t=fc(e);return !t||t.hoursToMature<=0?0:Pr/t.hoursToMature}function gc(e,t,n){const r=fc(e);if(!r)return n-Pr;const o=t/Zt,i=Pr/r.hoursToMature,a=Math.min(i*o,Pr),s=n-Pr;return Math.floor(s+a)}function DS(e,t,n){const r=fc(e);if(!r)return 0;const o=n-Pr,i=t-o;if(i<=0)return 0;const a=Pr/r.hoursToMature;return a<=0?0:i/a*Zt}function bb(e,t,n,r,o=Zt){const a=DS(e,n,r)-t;return a<=0?0:o<=0?1/0:a/o}function Rp(e,t,n,r=Zt){return bb(e,t,n,n,r)}function vb(e,t,n,r,o=Zt){if(n>=r)return 0;const i=n+1;return bb(e,t,i,r,o)}function FO(e,t){return e>=t}function BO(e,t){const n=t-Pr,o=(e-n)/Pr*100;return Math.min(100,Math.max(0,o))}const jO=Object.freeze(Object.defineProperty({__proto__:null,calculateAge:NO,calculateCurrentStrength:gc,calculateHoursToMaxStrength:Rp,calculateHoursToNextStrength:vb,calculateHoursToStrength:bb,calculateMaxStrength:hc,calculateStartingStrength:$O,calculateStrengthPerHour:DO,calculateStrengthProgress:BO,calculateXpForStrength:DS,getSpeciesData:fc,isPetMature:FO},Symbol.toStringTag,{value:"Module"}));function yb(e){const t=ue.get("pets");if(!t)return 100/24;const n=t[e];if(!n?.coinsToFullyReplenishHunger)return 100/24;const r=OO[e];return r?n.coinsToFullyReplenishHunger/r*60:(console.warn(`[Feed] Unknown species "${e}", using 60min default`),n.coinsToFullyReplenishHunger/60*60)}function GO(e,t){return e<=0?0:t<=0?1/0:e/t}function wb(e,t,n,r){if(e<=0||n<=0)return 0;const o=t/n;if(o>=e)return 0;const i=e-o,a=r/n;return Math.ceil(i/a)}function xb(e,t,n){const r=ue.get("pets");if(!r)return 0;const o=r[e];if(!o?.coinsToFullyReplenishHunger)return 0;const i=o.coinsToFullyReplenishHunger,a=yb(e);return wb(n,t,a,i)}function Ml(e,t,n){const r=ue.get("pets");if(!r)return 0;const o=r[e];if(!o?.coinsToFullyReplenishHunger)return 0;const i=o.coinsToFullyReplenishHunger,a=yb(e);return wb(n,t,a,i)}function Cb(e,t,n,r,o,i){return e?t&&i>0?Ml(n,r,i):0:Ml(n,r,o)}const zO=Object.freeze(Object.defineProperty({__proto__:null,calculateAdjustedFeedsToMax:Cb,calculateFeedsForDuration:wb,calculateFeedsToMaxStrength:Ml,calculateFeedsToNextStrength:xb,calculateHoursUntilStarving:GO,getHungerDrainPerHour:yb},Symbol.toStringTag,{value:"Module"})),FS={init(){},isReady(){return  true},crop:{calculateSize:mb,calculateSellPrice:dr,calculateProgress:PO,isReady:RO,getData:Tp},pet:{calculateAge:Ip,calculateMaxStrength:dc,calculateCurrentStrength:uc,isMature:Pp,calculateStrengthPerHour:NS,getData:pc},mutation:{calculateMultiplier:gb,getValue:EO,isGrowth:AO,isEnvironmental:IO},xp:jO,feed:zO};function ur(e,t){if(e===t)return  true;if(e===null||t===null)return e===t;if(typeof e!=typeof t)return  false;if(typeof e!="object")return e===t;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return  false;for(let a=0;a<e.length;a++)if(!ur(e[a],t[a]))return  false;return  true}if(Array.isArray(e)||Array.isArray(t))return  false;const n=e,r=t,o=Object.keys(n),i=Object.keys(r);if(o.length!==i.length)return  false;for(const a of o)if(!Object.prototype.hasOwnProperty.call(r,a)||!ur(n[a],r[a]))return  false;return  true}const By={currentGardenTile:"myCurrentGardenTileAtom",globalTileIndex:"myCurrentGlobalTileIndexAtom",gardenObject:"myCurrentGardenObjectAtom",isMature:"isGardenObjectMatureAtom",isInMyGarden:"isInMyGardenAtom",gardenName:"currentGardenNameAtom",sortedSlotIndices:"myCurrentSortedGrowSlotIndicesAtom",currentGrowSlotIndex:"myCurrentGrowSlotIndexAtom"},jy={position:{globalIndex:null,localIndex:null},tile:{type:null,isEmpty:true},garden:{name:null,isOwner:false,playerSlotIndex:null},object:{type:null,data:null,isMature:false},plant:null};function UO(e){const t=e.currentGardenTile;return {globalIndex:e.globalTileIndex,localIndex:t?.localTileIndex??null}}function HO(e){return {type:e.currentGardenTile?.tileType??null,isEmpty:e.gardenObject===null}}function WO(e){const t=e.currentGardenTile;return {name:e.gardenName,isOwner:e.isInMyGarden??false,playerSlotIndex:t?.userSlotIdx??null}}function VO(e){const t=e.gardenObject;return t?{type:t.objectType,data:t,isMature:e.isMature??false}:{type:null,data:null,isMature:false}}function qO(e){const t=e.gardenObject;if(!t||t.objectType!=="plant")return null;const n=t,r=e.sortedSlotIndices??[];return {species:n.species,slots:n.slots??[],currentSlotIndex:e.currentGrowSlotIndex,sortedSlotIndices:r,nextHarvestSlotIndex:r.length>0?r[0]:null}}function Gy(e){return {position:UO(e),tile:HO(e),garden:WO(e),object:VO(e),plant:qO(e)}}function zy(e){return JSON.stringify({globalIndex:e.position.globalIndex,localIndex:e.position.localIndex,tileType:e.tile.type,isEmpty:e.tile.isEmpty,gardenName:e.garden.name,isOwner:e.garden.isOwner,playerSlotIndex:e.garden.playerSlotIndex,objectType:e.object.type,isMature:e.object.isMature,plantSpecies:e.plant?.species??null,slotCount:e.plant?.slots.length??0})}function KO(e,t){return e.type!==t.type||e.isMature!==t.isMature?true:e.data===null&&t.data===null?false:e.data===null||t.data===null?true:!ur(e.data,t.data)}function XO(e,t){return e===null&&t===null?false:e===null||t===null||e.species!==t.species||e.currentSlotIndex!==t.currentSlotIndex||e.nextHarvestSlotIndex!==t.nextHarvestSlotIndex||e.slots.length!==t.slots.length||!ur(e.sortedSlotIndices,t.sortedSlotIndices)?true:!ur(e.slots,t.slots)}function YO(e,t){return e.name!==t.name||e.isOwner!==t.isOwner||e.playerSlotIndex!==t.playerSlotIndex}function JO(){let e=jy,t=jy,n=false;const r=[],o={all:new Set,stable:new Set,object:new Set,plantInfo:new Set,garden:new Set},i={},a=Object.keys(By),s=new Set;function l(){if(s.size<a.length)return;const d=Gy(i);if(!ur(e,d)&&(t=e,e=d,!!n)){for(const u of o.all)u(e,t);if(zy(t)!==zy(e))for(const u of o.stable)u(e,t);if(KO(t.object,e.object)){const u={current:e.object,previous:t.object};for(const f of o.object)f(u);}if(XO(t.plant,e.plant)){const u={current:e.plant,previous:t.plant};for(const f of o.plantInfo)f(u);}if(YO(t.garden,e.garden)){const u={current:e.garden,previous:t.garden};for(const f of o.garden)f(u);}}}async function c(){if(n)return;const d=a.map(async u=>{const f=By[u],g=await rt.subscribe(f,h=>{i[u]=h,s.add(u),l();});r.push(g);});await Promise.all(d),n=true,s.size===a.length&&(e=Gy(i));}return c(),{get(){return e},subscribe(d,u){return o.all.add(d),u?.immediate!==false&&n&&s.size===a.length&&d(e,e),()=>o.all.delete(d)},subscribeStable(d,u){return o.stable.add(d),u?.immediate!==false&&n&&s.size===a.length&&d(e,e),()=>o.stable.delete(d)},subscribeObject(d,u){return o.object.add(d),u?.immediate&&n&&s.size===a.length&&d({current:e.object,previous:e.object}),()=>o.object.delete(d)},subscribePlantInfo(d,u){return o.plantInfo.add(d),u?.immediate&&n&&s.size===a.length&&d({current:e.plant,previous:e.plant}),()=>o.plantInfo.delete(d)},subscribeGarden(d,u){return o.garden.add(d),u?.immediate&&n&&s.size===a.length&&d({current:e.garden,previous:e.garden}),()=>o.garden.delete(d)},destroy(){for(const d of r)d();r.length=0,o.all.clear(),o.stable.clear(),o.object.clear(),o.plantInfo.clear(),o.garden.clear(),n=false;}}}let Xf=null;function _t(){return Xf||(Xf=JO()),Xf}function QO(){let e=null;const t=[],n=new Set,r={},o=new Set,i=2;function a(u,f){return {x:f%u,y:Math.floor(f/u)}}function s(u,f,g){return g*u+f}function l(u,f){const{cols:g,rows:h}=u,y=g*h,S=new Set,C=new Set,_=new Map,E=[],P=u.userSlotIdxAndDirtTileIdxToGlobalTileIdx??[],O=u.userSlotIdxAndBoardwalkTileIdxToGlobalTileIdx??[],k=Math.max(P.length,O.length);for(let A=0;A<k;A++){const L=P[A]??[],F=O[A]??[],G=L.map((H,ce)=>(S.add(H),_.set(H,A),{globalIndex:H,localIndex:ce,position:a(g,H)})),q=F.map((H,ce)=>(C.add(H),_.set(H,A),{globalIndex:H,localIndex:ce,position:a(g,H)}));E.push({userSlotIdx:A,dirtTiles:G,boardwalkTiles:q,allTiles:[...G,...q]});}const I=u.spawnTiles.map(A=>a(g,A)),R={};if(u.locations)for(const[A,L]of Object.entries(u.locations)){const F=L.spawnTileIdx??[];R[A]={name:A,spawnTiles:F,spawnPositions:F.map(G=>a(g,G))};}return {cols:g,rows:h,totalTiles:y,tileSize:f,spawnTiles:u.spawnTiles,spawnPositions:I,locations:R,userSlots:E,globalToXY(A){return a(g,A)},xyToGlobal(A,L){return s(g,A,L)},getTileOwner(A){return _.get(A)??null},isDirtTile(A){return S.has(A)},isBoardwalkTile(A){return C.has(A)}}}function c(){if(o.size<i||e)return;const u=r.map,f=r.tileSize??0;if(u){e=l(u,f);for(const g of n)g(e);n.clear();}}async function d(){const u=await rt.subscribe("mapAtom",g=>{r.map=g,o.add("map"),c();});t.push(u);const f=await rt.subscribe("tileSizeAtom",g=>{r.tileSize=g,o.add("tileSize"),c();});t.push(f);}return d(),{get(){return e},isReady(){return e!==null},onReady(u,f){return e?(f?.immediate!==false&&u(e),()=>{}):(n.add(u),()=>n.delete(u))},destroy(){for(const u of t)u();t.length=0,e=null,n.clear();}}}let Yf=null;function hg(){return Yf||(Yf=QO()),Yf}function ZO(){const e=ue.get("mutations");return e?Object.keys(e):[]}function BS(){const e={};for(const t of ZO())e[t]=[];return e}function gg(){return {garden:null,mySlotIndex:null,plants:{all:[],mature:[],growing:[],bySpecies:{},count:0},crops:{all:[],mature:[],growing:[],mutated:{all:[],byMutation:BS()}},eggs:{all:[],mature:[],growing:[],byType:{},count:0},decors:{tileObjects:[],boardwalk:[],all:[],byType:{},count:0},tiles:{tileObjects:[],boardwalk:[],empty:{tileObjects:[],boardwalk:[]}},counts:{plants:0,maturePlants:0,crops:0,matureCrops:0,eggs:0,matureEggs:0,decors:0,emptyTileObjects:0,emptyBoardwalk:0}}}function Uy(e){return JSON.stringify({plants:e.counts.plants,maturePlants:e.counts.maturePlants,crops:e.counts.crops,matureCrops:e.counts.matureCrops,eggs:e.counts.eggs,matureEggs:e.counts.matureEggs,decors:e.counts.decors,emptyTileObjects:e.counts.emptyTileObjects,emptyBoardwalk:e.counts.emptyBoardwalk})}function eN(e,t,n,r){const o=t.slots.filter(i=>r>=i.endTime).length;return {tileIndex:e,position:n,species:t.species,plantedAt:t.plantedAt,maturedAt:t.maturedAt,isMature:r>=t.maturedAt,slots:t.slots,slotsCount:t.slots.length,matureSlotsCount:o}}function tN(e,t,n,r,o){return {tileIndex:e,position:t,slotIndex:n,species:r.species,startTime:r.startTime,endTime:r.endTime,targetScale:r.targetScale,mutations:[...r.mutations],isMature:o>=r.endTime,fruitCount:1}}function nN(e,t,n,r){return {tileIndex:e,position:n,eggId:t.eggId,plantedAt:t.plantedAt,maturedAt:t.maturedAt,isMature:r>=t.maturedAt}}function Hy(e,t,n,r){return {tileIndex:e,position:n,decorId:t.decorId,rotation:t.rotation,location:r}}function Wy(e,t){const{garden:n,mySlotIndex:r}=e,o=Date.now();if(!n||r===null)return gg();const i=t().get(),a=i?.userSlots[r],s=a?.dirtTiles??[],l=a?.boardwalkTiles??[],c=[],d=[],u=[],f={},g=[],h=[],y=[],S=[],C=BS(),_=[],E=[],P=[],O={},k=[],I=[],R={},A=new Set,L=new Set;for(const[H,ce]of Object.entries(n.tileObjects)){const W=parseInt(H,10);A.add(W);const te=i?i.globalToXY(W):{x:0,y:0};if(ce.objectType==="plant"){const ne=ce,ie=eN(H,ne,te,o);c.push(ie),ie.isMature?d.push(ie):u.push(ie),f[ie.species]||(f[ie.species]=[]),f[ie.species].push(ie);for(let ee=0;ee<ne.slots.length;ee++){const U=ne.slots[ee],X=tN(H,te,ee,U,o);if(g.push(X),X.isMature?h.push(X):y.push(X),X.mutations.length>0){S.push(X);for(const D of X.mutations)C[D]||(C[D]=[]),C[D].push(X);}}}else if(ce.objectType==="egg"){const ie=nN(H,ce,te,o);_.push(ie),O[ie.eggId]||(O[ie.eggId]=[]),O[ie.eggId].push(ie),ie.isMature?E.push(ie):P.push(ie);}else if(ce.objectType==="decor"){const ie=Hy(H,ce,te,"tileObjects");k.push(ie),R[ie.decorId]||(R[ie.decorId]=[]),R[ie.decorId].push(ie);}}for(const[H,ce]of Object.entries(n.boardwalkTileObjects)){const W=parseInt(H,10);L.add(W);const te=i?i.globalToXY(W):{x:0,y:0},ie=Hy(H,ce,te,"boardwalk");I.push(ie),R[ie.decorId]||(R[ie.decorId]=[]),R[ie.decorId].push(ie);}const F=[...k,...I],G=s.filter(H=>!A.has(H.localIndex)),q=l.filter(H=>!L.has(H.localIndex));return {garden:n,mySlotIndex:r,plants:{all:c,mature:d,growing:u,bySpecies:f,count:c.length},crops:{all:g,mature:h,growing:y,mutated:{all:S,byMutation:C}},eggs:{all:_,mature:E,growing:P,byType:O,count:_.length},decors:{tileObjects:k,boardwalk:I,all:F,byType:R,count:F.length},tiles:{tileObjects:s,boardwalk:l,empty:{tileObjects:G,boardwalk:q}},counts:{plants:c.length,maturePlants:d.length,crops:g.length,matureCrops:h.length,eggs:_.length,matureEggs:E.length,decors:F.length,emptyTileObjects:G.length,emptyBoardwalk:q.length}}}function rN(e,t){const n=new Set(e.map(a=>a.tileIndex)),r=new Set(t.map(a=>a.tileIndex)),o=t.filter(a=>!n.has(a.tileIndex)),i=e.filter(a=>!r.has(a.tileIndex));return {added:o,removed:i}}function oN(e,t,n){const r=new Set(e.map(i=>i.tileIndex)),o=new Set(n.map(i=>i.tileIndex));return t.filter(i=>!r.has(i.tileIndex)&&o.has(i.tileIndex))}function iN(e,t,n){const r=new Set(e.map(i=>`${i.tileIndex}:${i.slotIndex}`)),o=new Set(n.map(i=>`${i.tileIndex}:${i.slotIndex}`));return t.filter(i=>{const a=`${i.tileIndex}:${i.slotIndex}`;return !r.has(a)&&o.has(a)})}function aN(e,t,n){const r=new Set(e.map(i=>i.tileIndex)),o=new Set(n.map(i=>i.tileIndex));return t.filter(i=>!r.has(i.tileIndex)&&o.has(i.tileIndex))}function sN(e,t){const n=[],r=new Map(e.map(o=>[o.tileIndex,o]));for(const o of t){const i=r.get(o.tileIndex);if(!i)continue;const a=Math.min(i.slots.length,o.slots.length);for(let s=0;s<a;s++){const l=new Set(i.slots[s].mutations),c=new Set(o.slots[s].mutations),d=[...c].filter(f=>!l.has(f)),u=[...l].filter(f=>!c.has(f));if(d.length>0||u.length>0){const f=Date.now(),g=o.slots[s],h={tileIndex:o.tileIndex,position:o.position,slotIndex:s,species:g.species,startTime:g.startTime,endTime:g.endTime,targetScale:g.targetScale,mutations:[...g.mutations],isMature:f>=g.endTime,fruitCount:1};n.push({crop:h,added:d,removed:u});}}}return n}function lN(e,t,n){const r=[],o=new Map(t.map(a=>[a.tileIndex,a])),i=new Map;for(const a of n)i.set(`${a.tileIndex}:${a.slotIndex}`,a);for(const a of e){const s=o.get(a.tileIndex);if(!s)continue;const l=Math.min(a.slots.length,s.slots.length);for(let c=0;c<l;c++){const d=a.slots[c],u=s.slots[c];if(d.startTime!==u.startTime){const f=i.get(`${a.tileIndex}:${c}`);if(!f||!f.isMature)continue;const g={tileIndex:a.tileIndex,position:a.position,slotIndex:c,species:d.species,startTime:d.startTime,endTime:d.endTime,targetScale:d.targetScale,mutations:[...d.mutations],isMature:true,fruitCount:1};r.push({crop:g,remainingSlots:s.slotsCount});}}if(s.slotsCount<a.slotsCount)for(let c=s.slotsCount;c<a.slotsCount;c++){const d=i.get(`${a.tileIndex}:${c}`);if(!d||!d.isMature)continue;const u=a.slots[c];if(!u)continue;const f={tileIndex:a.tileIndex,position:a.position,slotIndex:c,species:u.species,startTime:u.startTime,endTime:u.endTime,targetScale:u.targetScale,mutations:[...u.mutations],isMature:true,fruitCount:1};r.push({crop:f,remainingSlots:s.slotsCount});}}return r}function cN(e,t){const n=new Set(e.map(a=>a.tileIndex)),r=new Set(t.map(a=>a.tileIndex)),o=t.filter(a=>!n.has(a.tileIndex)),i=e.filter(a=>!r.has(a.tileIndex));return {added:o,removed:i}}function dN(e,t){const n=l=>`${l.tileIndex}:${l.location}`,r=l=>`${l.tileIndex}:${l.location}`,o=new Set(e.map(n)),i=new Set(t.map(r)),a=t.filter(l=>!o.has(r(l))),s=e.filter(l=>!i.has(n(l)));return {added:a,removed:s}}function uN(){let e=gg(),t=gg(),n=false;const r=[],o={all:new Set,stable:new Set,plantAdded:new Set,plantRemoved:new Set,plantMatured:new Set,cropMutated:new Set,cropMatured:new Set,cropHarvested:new Set,eggPlaced:new Set,eggRemoved:new Set,eggMatured:new Set,decorPlaced:new Set,decorRemoved:new Set},i={},a=new Set,s=2;function l(){if(a.size<s)return;const d=Wy(i,hg);if(ur(e,d)||(t=e,e=d,!n))return;for(const E of o.all)E(e,t);if(Uy(t)!==Uy(e))for(const E of o.stable)E(e,t);const u=rN(t.plants.all,e.plants.all);for(const E of u.added)for(const P of o.plantAdded)P({plant:E});for(const E of u.removed)for(const P of o.plantRemoved)P({plant:E,tileIndex:E.tileIndex});const f=oN(t.plants.mature,e.plants.mature,e.plants.all);for(const E of f)for(const P of o.plantMatured)P({plant:E});const g=sN(t.plants.all,e.plants.all);for(const E of g)for(const P of o.cropMutated)P(E);const h=iN(t.crops.mature,e.crops.mature,e.crops.all);for(const E of h)for(const P of o.cropMatured)P({crop:E});const y=lN(t.plants.all,e.plants.all,t.crops.all);for(const E of y)for(const P of o.cropHarvested)P(E);const S=cN(t.eggs.all,e.eggs.all);for(const E of S.added)for(const P of o.eggPlaced)P({egg:E});for(const E of S.removed)for(const P of o.eggRemoved)P({egg:E});const C=aN(t.eggs.mature,e.eggs.mature,e.eggs.all);for(const E of C)for(const P of o.eggMatured)P({egg:E});const _=dN(t.decors.all,e.decors.all);for(const E of _.added)for(const P of o.decorPlaced)P({decor:E});for(const E of _.removed)for(const P of o.decorRemoved)P({decor:E});}async function c(){if(n)return;const d=await ER.onChangeNow(f=>{i.garden=f,a.add("garden"),l();});r.push(d);const u=await rt.subscribe("myUserSlotIdxAtom",f=>{i.mySlotIndex=f,a.add("mySlotIndex"),l();});r.push(u),n=true,a.size===s&&(e=Wy(i,hg));}return c(),{get(){return e},subscribe(d,u){return o.all.add(d),u?.immediate!==false&&n&&a.size===s&&d(e,e),()=>o.all.delete(d)},subscribeStable(d,u){return o.stable.add(d),u?.immediate!==false&&n&&a.size===s&&d(e,e),()=>o.stable.delete(d)},subscribePlantAdded(d,u){if(o.plantAdded.add(d),u?.immediate&&n&&a.size===s)for(const f of e.plants.all)d({plant:f});return ()=>o.plantAdded.delete(d)},subscribePlantRemoved(d,u){return o.plantRemoved.add(d),()=>o.plantRemoved.delete(d)},subscribePlantMatured(d,u){if(o.plantMatured.add(d),u?.immediate&&n&&a.size===s)for(const f of e.plants.mature)d({plant:f});return ()=>o.plantMatured.delete(d)},subscribeCropMutated(d,u){if(o.cropMutated.add(d),u?.immediate&&n&&a.size===s)for(const f of e.crops.mutated.all)d({crop:f,added:f.mutations,removed:[]});return ()=>o.cropMutated.delete(d)},subscribeCropMatured(d,u){if(o.cropMatured.add(d),u?.immediate&&n&&a.size===s)for(const f of e.crops.mature)d({crop:f});return ()=>o.cropMatured.delete(d)},subscribeCropHarvested(d,u){return o.cropHarvested.add(d),()=>o.cropHarvested.delete(d)},subscribeEggPlaced(d,u){if(o.eggPlaced.add(d),u?.immediate&&n&&a.size===s)for(const f of e.eggs.all)d({egg:f});return ()=>o.eggPlaced.delete(d)},subscribeEggRemoved(d,u){return o.eggRemoved.add(d),()=>o.eggRemoved.delete(d)},subscribeEggMatured(d,u){if(o.eggMatured.add(d),u?.immediate&&n&&a.size===s)for(const f of e.eggs.mature)d({egg:f});return ()=>o.eggMatured.delete(d)},subscribeDecorPlaced(d,u){if(o.decorPlaced.add(d),u?.immediate&&n&&a.size===s)for(const f of e.decors.all)d({decor:f});return ()=>o.decorPlaced.delete(d)},subscribeDecorRemoved(d,u){return o.decorRemoved.add(d),()=>o.decorRemoved.delete(d)},destroy(){for(const d of r)d();r.length=0,o.all.clear(),o.stable.clear(),o.plantAdded.clear(),o.plantRemoved.clear(),o.plantMatured.clear(),o.cropMutated.clear(),o.cropMatured.clear(),o.cropHarvested.clear(),o.eggPlaced.clear(),o.eggRemoved.clear(),o.eggMatured.clear(),o.decorPlaced.clear(),o.decorRemoved.clear(),n=false;}}}let Jf=null;function gr(){return Jf||(Jf=uN()),Jf}const Vy={inventory:"myPetInventoryAtom",hutch:"myPetHutchPetItemsAtom",active:"myPetInfosAtom",slotInfos:"myPetSlotInfosAtom",expandedPetSlotId:"expandedPetSlotIdAtom",myNumPetHutchItems:"myNumPetHutchItemsAtom",activityLogs:"myDataAtom"};function qy(e,t){const n=Ip(e.xp),r=dc(e.petSpecies,e.targetScale),o=uc(e.petSpecies,e.xp,r),i=Pp(e.petSpecies,n),l=ue.get("pets")?.[e.petSpecies]?.coinsToFullyReplenishHunger??1,c=e.hunger/l*100;return {id:e.id,petSpecies:e.petSpecies,name:e.name,xp:e.xp,hunger:e.hunger,hungerPercent:c,mutations:[...e.mutations],targetScale:e.targetScale,abilities:[...e.abilities],location:t,position:null,lastAbilityTrigger:null,growthStage:n,currentStrength:o,maxStrength:r,isMature:i}}function pN(e,t){const r=t[e.slot.id]?.lastAbilityTrigger??null,o=Ip(e.slot.xp),i=dc(e.slot.petSpecies,e.slot.targetScale),a=uc(e.slot.petSpecies,e.slot.xp,i),s=Pp(e.slot.petSpecies,o),d=ue.get("pets")?.[e.slot.petSpecies]?.coinsToFullyReplenishHunger??1,u=e.slot.hunger/d*100;return {id:e.slot.id,petSpecies:e.slot.petSpecies,name:e.slot.name,xp:e.slot.xp,hunger:e.slot.hunger,hungerPercent:u,mutations:[...e.slot.mutations],targetScale:e.slot.targetScale,abilities:[...e.slot.abilities],location:"active",position:e.position?{x:e.position.x,y:e.position.y}:null,lastAbilityTrigger:r,growthStage:o,currentStrength:a,maxStrength:i,isMature:s}}const Ky=500;let _r=[],Xd=0;function fN(){try{const e=Xe(hn.GLOBAL.MY_PETS_ABILITY_LOGS,[]);if(!Array.isArray(e))return [];const t=e.filter(n=>typeof n=="object"&&n!==null&&typeof n.petId=="string"&&typeof n.petName=="string"&&typeof n.petSpecies=="string"&&typeof n.abilityId=="string"&&typeof n.performedAt=="number");return t.length<e.length&&console.log(`[myPets] Migrated ability logs: removed ${e.length-t.length} old entries`),t.length>0&&(Xd=Math.max(...t.map(n=>n.performedAt))),t}catch(e){return console.error("[myPets] Failed to load ability logs from storage:",e),[]}}function hN(e){try{Ye(hn.GLOBAL.MY_PETS_ABILITY_LOGS,e);}catch(t){console.error("[myPets] Failed to save ability logs to storage:",t);}}function gN(e){try{const n=e.parameters.pet;return !n||!n.id||!n.petSpecies?null:{petId:n.id,petName:n.name||n.petSpecies,petSpecies:n.petSpecies,abilityId:e.action,data:e.parameters,performedAt:e.timestamp}}catch(t){return console.error("[myPets] Failed to convert activity log:",t),null}}function mN(e){if(!e||!Array.isArray(e))return;const t=kC(e),n=[];for(const r of t)if(r.timestamp>Xd){const o=gN(r);o&&n.push(o);}n.length!==0&&(Xd=Math.max(...n.map(r=>r.performedAt),Xd),_r=[...n,..._r],_r.length>Ky&&(_r=_r.slice(0,Ky)),hN(_r),console.log(`[myPets] Processed ${n.length} new ability logs (total: ${_r.length})`));}function Xy(e){const t=new Set,n=[];for(const g of e.active??[]){const h=pN(g,e.slotInfos??{});n.push(h),t.add(h.id);}const r=[];for(const g of e.inventory??[]){if(t.has(g.id))continue;const h=qy(g,"inventory");r.push(h),t.add(h.id);}const o=[];for(const g of e.hutch??[]){if(t.has(g.id))continue;const h=qy(g,"hutch");o.push(h),t.add(h.id);}const i=[...n,...r,...o],a=e.expandedPetSlotId??null,s=a?i.find(g=>g.id===a)??null:null,d=gr().get().decors.all.some(g=>g.decorId==="PetHutch"),u=e.myNumPetHutchItems??0;return {all:i,byLocation:{inventory:r,hutch:o,active:n},counts:{inventory:r.length,hutch:o.length,active:n.length,total:i.length},hutch:{hasHutch:d,currentItems:u,maxItems:25},expandedPetSlotId:a,expandedPet:s,abilityLogs:[..._r]}}const Yy={all:[],byLocation:{inventory:[],hutch:[],active:[]},counts:{inventory:0,hutch:0,active:0,total:0},hutch:{hasHutch:false,currentItems:0,maxItems:25},expandedPetSlotId:null,expandedPet:null,abilityLogs:[]};function bN(e,t){if(e.length!==t.length)return  false;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return  false;return  true}function Jy(e){return JSON.stringify({id:e.id,petSpecies:e.petSpecies,name:e.name,mutations:e.mutations,abilities:e.abilities,location:e.location})}function vN(e,t){if(e.all.length!==t.all.length)return  false;const n=e.all.map(Jy),r=t.all.map(Jy);return bN(n,r)}function yN(e,t){const n=[],r=new Map(e.all.map(o=>[o.id,o]));for(const o of t.all){const i=r.get(o.id);i&&i.location!==o.location&&n.push({pet:o,from:i.location,to:o.location});}return n}function wN(e,t){const n=[],r=new Map(e.all.map(o=>[o.id,o]));for(const o of t.all){if(!o.lastAbilityTrigger)continue;const a=r.get(o.id)?.lastAbilityTrigger;(!a||a.abilityId!==o.lastAbilityTrigger.abilityId||a.performedAt!==o.lastAbilityTrigger.performedAt)&&n.push({pet:o,trigger:o.lastAbilityTrigger});}return n}function xN(e,t){const n=new Set(e.all.map(a=>a.id)),r=new Set(t.all.map(a=>a.id)),o=t.all.filter(a=>!n.has(a.id)),i=e.all.filter(a=>!r.has(a.id));return o.length===0&&i.length===0?null:{added:o,removed:i,counts:t.counts}}function CN(e,t){const n=[],r=new Map(e.all.map(o=>[o.id,o]));for(const o of t.all){const i=r.get(o.id);i&&o.growthStage>i.growthStage&&n.push({pet:o,previousStage:i.growthStage,newStage:o.growthStage});}return n}function SN(e,t){const n=[],r=new Map(e.all.map(o=>[o.id,o]));for(const o of t.all){const i=r.get(o.id);i&&o.currentStrength>i.currentStrength&&n.push({pet:o,previousStrength:i.currentStrength,newStrength:o.currentStrength});}return n}function _N(e,t){const n=[],r=new Map(e.all.map(o=>[o.id,o]));for(const o of t.all){const i=r.get(o.id);i&&o.currentStrength===o.maxStrength&&i.currentStrength<i.maxStrength&&n.push({pet:o});}return n}function kN(){let e=Yy,t=Yy,n=false;const r=[],o={all:new Set,stable:new Set,location:new Set,ability:new Set,count:new Set,expandedPet:new Set,growth:new Set,strengthGain:new Set,maxStrength:new Set},i={},a=Object.keys(Vy),s=new Set;function l(){if(s.size<a.length)return;if(i.activityLogs){const C=i.activityLogs?.activityLogs||i.activityLogs;Array.isArray(C)&&mN(C);}const d=Xy(i);if(ur(e,d)||(t=e,e=d,!n))return;for(const C of o.all)C(e,t);if(!vN(t,e))for(const C of o.stable)C(e,t);const u=yN(t,e);for(const C of u)for(const _ of o.location)_(C);const f=wN(t,e);for(const C of f)for(const _ of o.ability)_(C);const g=xN(t,e);if(g)for(const C of o.count)C(g);const h=CN(t,e);for(const C of h)for(const _ of o.growth)_(C);const y=SN(t,e);for(const C of y)for(const _ of o.strengthGain)_(C);const S=_N(t,e);for(const C of S)for(const _ of o.maxStrength)_(C);if(t.expandedPetSlotId!==e.expandedPetSlotId){const C={current:e.expandedPet,previous:t.expandedPet,currentId:e.expandedPetSlotId,previousId:t.expandedPetSlotId};for(const _ of o.expandedPet)_(C);}}async function c(){if(n)return;_r=fN(),console.log(`[myPets] Loaded ${_r.length} ability logs from storage`);const d=a.map(async u=>{const f=Vy[u],g=await rt.subscribe(f,h=>{i[u]=h,s.add(u),l();});r.push(g);});await Promise.all(d),n=true,s.size===a.length&&(e=Xy(i));}return c(),{get(){return e},subscribe(d,u){return o.all.add(d),u?.immediate!==false&&n&&s.size===a.length&&d(e,e),()=>o.all.delete(d)},subscribeStable(d,u){return o.stable.add(d),u?.immediate!==false&&n&&s.size===a.length&&d(e,e),()=>o.stable.delete(d)},subscribeLocation(d,u){if(o.location.add(d),u?.immediate&&n&&s.size===a.length)for(const f of e.all)d({pet:f,from:f.location,to:f.location});return ()=>o.location.delete(d)},subscribeAbility(d,u){if(o.ability.add(d),u?.immediate&&n&&s.size===a.length)for(const f of e.all)f.lastAbilityTrigger&&d({pet:f,trigger:f.lastAbilityTrigger});return ()=>o.ability.delete(d)},subscribeCount(d,u){return o.count.add(d),u?.immediate&&n&&s.size===a.length&&d({added:e.all,removed:[],counts:e.counts}),()=>o.count.delete(d)},subscribeExpandedPet(d,u){return o.expandedPet.add(d),u?.immediate&&n&&s.size===a.length&&d({current:e.expandedPet,previous:e.expandedPet,currentId:e.expandedPetSlotId,previousId:e.expandedPetSlotId}),()=>o.expandedPet.delete(d)},subscribeGrowth(d,u){if(o.growth.add(d),u?.immediate&&n&&s.size===a.length)for(const f of e.all)d({pet:f,previousStage:f.growthStage,newStage:f.growthStage});return ()=>o.growth.delete(d)},subscribeStrengthGain(d,u){if(o.strengthGain.add(d),u?.immediate&&n&&s.size===a.length)for(const f of e.all)d({pet:f,previousStrength:f.currentStrength,newStrength:f.currentStrength});return ()=>o.strengthGain.delete(d)},subscribeMaxStrength(d,u){if(o.maxStrength.add(d),u?.immediate&&n&&s.size===a.length)for(const f of e.all)f.currentStrength===f.maxStrength&&d({pet:f});return ()=>o.maxStrength.delete(d)},destroy(){for(const d of r)d();r.length=0,o.all.clear(),o.stable.clear(),o.location.clear(),o.ability.clear(),o.count.clear(),o.expandedPet.clear(),o.growth.clear(),o.strengthGain.clear(),o.maxStrength.clear(),n=false;}}}let Qf=null;function po(){return Qf||(Qf=kN()),Qf}const Qy={inventory:"myInventoryAtom",isFull:"isMyInventoryAtMaxLengthAtom",selectedItemIndex:"myValidatedSelectedItemIndexAtom"},Zy={items:[],favoritedItemIds:[],count:0,isFull:false,selectedItem:null};function e0(e){const t=e.inventory,n=t?.items??[],r=t?.favoritedItemIds??[],o=e.selectedItemIndex;let i=null;return o!==null&&o>=0&&o<n.length&&(i={index:o,item:n[o]}),{items:n,favoritedItemIds:r,count:n.length,isFull:e.isFull??false,selectedItem:i}}function t0(e){const t=e.items.map(n=>"id"in n?n.id:"species"in n&&n.itemType==="Seed"?`seed:${n.species}:${n.quantity}`:"toolId"in n?`tool:${n.toolId}:${n.quantity}`:"eggId"in n?`egg:${n.eggId}:${n.quantity}`:"decorId"in n?`decor:${n.decorId}:${n.quantity}`:JSON.stringify(n));return JSON.stringify({itemKeys:t,favoritedItemIds:e.favoritedItemIds,isFull:e.isFull,selectedItemIndex:e.selectedItem?.index??null})}function EN(e,t){return t0(e)===t0(t)}function AN(e,t){return e===null&&t===null?false:e===null||t===null?true:e.index!==t.index}function rd(e){return "id"in e?e.id:"species"in e&&e.itemType==="Seed"?`seed:${e.species}`:"toolId"in e?`tool:${e.toolId}`:"eggId"in e?`egg:${e.eggId}`:"decorId"in e?`decor:${e.decorId}`:JSON.stringify(e)}function TN(e,t){const n=new Set(e.map(rd)),r=new Set(t.map(rd)),o=t.filter(a=>!n.has(rd(a))),i=e.filter(a=>!r.has(rd(a)));return o.length===0&&i.length===0?null:{added:o,removed:i,counts:{before:e.length,after:t.length}}}function IN(e,t){const n=new Set(e),r=new Set(t),o=t.filter(a=>!n.has(a)),i=e.filter(a=>!r.has(a));return o.length===0&&i.length===0?null:{added:o,removed:i,current:t}}function PN(){let e=Zy,t=Zy,n=false;const r=[],o={all:new Set,stable:new Set,selection:new Set,items:new Set,favorites:new Set},i={},a=Object.keys(Qy),s=new Set;function l(){if(s.size<a.length)return;const d=e0(i);if(ur(e,d)||(t=e,e=d,!n))return;for(const g of o.all)g(e,t);if(!EN(t,e))for(const g of o.stable)g(e,t);if(AN(t.selectedItem,e.selectedItem)){const g={current:e.selectedItem,previous:t.selectedItem};for(const h of o.selection)h(g);}const u=TN(t.items,e.items);if(u)for(const g of o.items)g(u);const f=IN(t.favoritedItemIds,e.favoritedItemIds);if(f)for(const g of o.favorites)g(f);}async function c(){if(n)return;const d=a.map(async u=>{const f=Qy[u],g=await rt.subscribe(f,h=>{i[u]=h,s.add(u),l();});r.push(g);});await Promise.all(d),n=true,s.size===a.length&&(e=e0(i));}return c(),{get(){return e},subscribe(d,u){return o.all.add(d),u?.immediate!==false&&n&&s.size===a.length&&d(e,e),()=>o.all.delete(d)},subscribeStable(d,u){return o.stable.add(d),u?.immediate!==false&&n&&s.size===a.length&&d(e,e),()=>o.stable.delete(d)},subscribeSelection(d,u){return o.selection.add(d),u?.immediate&&n&&s.size===a.length&&d({current:e.selectedItem,previous:e.selectedItem}),()=>o.selection.delete(d)},subscribeItems(d,u){return o.items.add(d),u?.immediate&&n&&s.size===a.length&&d({added:e.items,removed:[],counts:{before:0,after:e.count}}),()=>o.items.delete(d)},subscribeFavorites(d,u){return o.favorites.add(d),u?.immediate&&n&&s.size===a.length&&d({added:e.favoritedItemIds,removed:[],current:e.favoritedItemIds}),()=>o.favorites.delete(d)},destroy(){for(const d of r)d();r.length=0,o.all.clear(),o.stable.clear(),o.selection.clear(),o.items.clear(),o.favorites.clear(),n=false;}}}let Zf=null;function En(){return Zf||(Zf=PN()),Zf}const mg={all:[],host:null,myPlayer:null,count:0};function RN(e,t,n){const r=n.get(e.id),o=r?.slot,i=o?.data,a=o?.lastActionEvent;return {id:e.id,name:e.name,discordId:e.databaseUserId,discordAvatarUrl:e.discordAvatarUrl,guildId:e.guildId,isConnected:e.isConnected,isHost:e.id===t,slotIndex:r?.index??null,position:o?.position??null,cosmetic:{color:e.cosmetic?.color??"",avatar:e.cosmetic?.avatar?[...e.cosmetic.avatar]:[]},emote:{type:e.emoteData?.emoteType??-1},coins:i?.coinsCount??0,inventory:i?.inventory??null,shopPurchases:i?.shopPurchases??null,garden:i?.garden??null,pets:{slots:i?.petSlots??[],slotInfos:o?.petSlotInfos??null},journal:i?.journal??null,stats:i?.stats??null,tasksCompleted:i?.tasksCompleted??[],activityLogs:i?.activityLogs??[],customRestocks:{config:i?.customRestocks??null,inventories:o?.customRestockInventories??null},lastAction:a?{type:a.action,data:a.data,timestamp:a.timestamp}:null,selectedItemIndex:o?.notAuthoritative_selectedItemIndex??null,lastSlotMachineInfo:o?.lastSlotMachineInfo??null}}function n0(e){const t=e.players,n=e.hostPlayerId??"",r=e.userSlots??[],o=e.myUserSlotIndex;if(!t||!Array.isArray(t)||t.length===0)return mg;const i=new Map;Array.isArray(r)&&r.forEach((c,d)=>{c?.type==="user"&&c?.playerId&&i.set(c.playerId,{slot:c,index:d});});const a=t.map(c=>RN(c,n,i)),s=a.find(c=>c.isHost)??null,l=o!==null?a.find(c=>c.slotIndex===o)??null:null;return {all:a,host:s,myPlayer:l,count:a.length}}function r0(e){const t=e.all.map(n=>`${n.id}:${n.isConnected}:${n.isHost}`);return JSON.stringify({playerKeys:t,hostId:e.host?.id??null,count:e.count})}function MN(e,t){const n=[],r=new Set(e.map(i=>i.id)),o=new Set(t.map(i=>i.id));for(const i of t)r.has(i.id)||n.push({player:i,type:"join"});for(const i of e)o.has(i.id)||n.push({player:i,type:"leave"});return n}function LN(e,t){const n=[],r=new Map(e.map(o=>[o.id,o]));for(const o of t){const i=r.get(o.id);i&&i.isConnected!==o.isConnected&&n.push({player:o,isConnected:o.isConnected});}return n}function ON(){let e=mg,t=mg,n=false;const r=[],o={all:new Set,stable:new Set,joinLeave:new Set,connection:new Set,host:new Set},i={},a=new Set,s=4;function l(){if(a.size<s)return;const d=n0(i);if(ur(e,d)||(t=e,e=d,!n))return;for(const y of o.all)y(e,t);if(r0(t)!==r0(e))for(const y of o.stable)y(e,t);const u=MN(t.all,e.all);for(const y of u)for(const S of o.joinLeave)S(y);const f=LN(t.all,e.all);for(const y of f)for(const S of o.connection)S(y);const g=t.host?.id??null,h=e.host?.id??null;if(g!==h){const y={current:e.host,previous:t.host};for(const S of o.host)S(y);}}async function c(){if(n)return;const d=await _R.onChangeNow(h=>{i.players=h,a.add("players"),l();});r.push(d);const u=await kR.onChangeNow(h=>{i.hostPlayerId=h,a.add("hostPlayerId"),l();});r.push(u);const f=await SR.onChangeNow(h=>{i.userSlots=h,a.add("userSlots"),l();});r.push(f);const g=await rt.subscribe("myUserSlotIdxAtom",h=>{i.myUserSlotIndex=h,a.add("myUserSlotIndex"),l();});r.push(g),n=true,a.size===s&&(e=n0(i));}return c(),{get(){return e},subscribe(d,u){return o.all.add(d),u?.immediate!==false&&n&&a.size===s&&d(e,e),()=>o.all.delete(d)},subscribeStable(d,u){return o.stable.add(d),u?.immediate!==false&&n&&a.size===s&&d(e,e),()=>o.stable.delete(d)},subscribeJoinLeave(d,u){if(o.joinLeave.add(d),u?.immediate&&n&&a.size===s)for(const f of e.all)d({player:f,type:"join"});return ()=>o.joinLeave.delete(d)},subscribeConnection(d,u){if(o.connection.add(d),u?.immediate&&n&&a.size===s)for(const f of e.all)d({player:f,isConnected:f.isConnected});return ()=>o.connection.delete(d)},subscribeHost(d,u){return o.host.add(d),u?.immediate&&n&&a.size===s&&d({current:e.host,previous:e.host}),()=>o.host.delete(d)},destroy(){for(const d of r)d();r.length=0,o.all.clear(),o.stable.clear(),o.joinLeave.clear(),o.connection.clear(),o.host.clear(),n=false;}}}let eh=null;function Sb(){return eh||(eh=ON()),eh}const jS=Object.freeze(Object.defineProperty({__proto__:null,getPlayers:Sb},Symbol.toStringTag,{value:"Module"})),mc=["seed","tool","egg","decor"];function NN(e,t){switch(t){case "seed":return e.species??e.itemType;case "tool":return e.toolId??e.itemType;case "egg":return e.eggId??e.itemType;case "decor":return e.decorId??e.itemType;default:return e.itemType}}function $N(e,t,n){const r=NN(e,t),o=n[r]??0,i=Math.max(0,e.initialStock-o);return {id:r,itemType:e.itemType,initialStock:e.initialStock,purchased:o,remaining:i,isAvailable:i>0,price:e.price}}function DN(e,t,n){if(!t)return {type:e,items:[],availableCount:0,totalCount:0,secondsUntilRestock:0,restockAt:null};const o=n[e]?.purchases??{},i=(t.inventory??[]).map(c=>$N(c,e,o)),a=i.filter(c=>c.isAvailable).length,s=t.secondsUntilRestock??0,l=s>0?Date.now()+s*1e3:null;return {type:e,items:i,availableCount:a,totalCount:i.length,secondsUntilRestock:s,restockAt:l}}function o0(e){const t=e.shops,n=e.purchases??{},r=mc.map(s=>DN(s,t?.[s],n)),o={seed:r[0],tool:r[1],egg:r[2],decor:r[3]},i=r.filter(s=>s.restockAt!==null);let a=null;if(i.length>0){const l=i.sort((c,d)=>(c.restockAt??0)-(d.restockAt??0))[0];a={shop:l.type,seconds:l.secondsUntilRestock,at:l.restockAt};}return {all:r,byType:o,nextRestock:a}}const i0={all:mc.map(e=>({type:e,items:[],availableCount:0,totalCount:0,secondsUntilRestock:0,restockAt:null})),byType:{seed:{type:"seed",items:[],availableCount:0,totalCount:0,secondsUntilRestock:0,restockAt:null},tool:{type:"tool",items:[],availableCount:0,totalCount:0,secondsUntilRestock:0,restockAt:null},egg:{type:"egg",items:[],availableCount:0,totalCount:0,secondsUntilRestock:0,restockAt:null},decor:{type:"decor",items:[],availableCount:0,totalCount:0,secondsUntilRestock:0,restockAt:null}},nextRestock:null};function a0(e){return JSON.stringify({shops:e.all.map(t=>({type:t.type,itemCount:t.items.length,availableCount:t.availableCount}))})}function FN(e,t){const n=e.secondsUntilRestock,r=t.secondsUntilRestock;return n>0&&n<=5&&r>n||n>0&&r===0&&t.items.some(i=>i.purchased===0)?{shop:t,previousItems:e.items}:null}function BN(e,t){const n=[];for(const r of mc){const o=e.byType[r],i=t.byType[r],a=new Map(o.items.map(s=>[s.id,s]));for(const s of i.items){const l=a.get(s.id);l&&s.purchased>l.purchased&&n.push({shopType:r,itemId:s.id,quantity:s.purchased-l.purchased,newPurchased:s.purchased,remaining:s.remaining});}}return n}function jN(e,t){const n=[];for(const r of mc){const o=e.byType[r],i=t.byType[r],a=new Map(o.items.map(s=>[s.id,s]));for(const s of i.items){const l=a.get(s.id);l&&l.isAvailable!==s.isAvailable&&n.push({shopType:r,itemId:s.id,wasAvailable:l.isAvailable,isAvailable:s.isAvailable});}}return n}function GN(){let e=i0,t=i0,n=false;const r=[],o={all:new Set,stable:new Set,seedRestock:new Set,toolRestock:new Set,eggRestock:new Set,decorRestock:new Set,purchase:new Set,availability:new Set},i={},a=new Set,s=2;function l(){if(a.size<s)return;const d=o0(i);if(ur(e,d)||(t=e,e=d,!n))return;for(const h of o.all)h(e,t);if(a0(t)!==a0(e))for(const h of o.stable)h(e,t);const u={seed:o.seedRestock,tool:o.toolRestock,egg:o.eggRestock,decor:o.decorRestock};for(const h of mc){const y=FN(t.byType[h],e.byType[h]);if(y)for(const S of u[h])S(y);}const f=BN(t,e);for(const h of f)for(const y of o.purchase)y(h);const g=jN(t,e);for(const h of g)for(const y of o.availability)y(h);}async function c(){if(n)return;const d=await AR.onChangeNow(u=>{i.shops=u,a.add("shops"),l();});r.push(d);try{const u=await TR.onChangeNow(f=>{i.purchases=f,a.add("purchases"),l();});r.push(u);}catch{i.purchases={},a.add("purchases"),l();}n=true,a.size===s&&(e=o0(i));}return c(),{get(){return e},getShop(d){return e.byType[d]},getItem(d,u){return e.byType[d].items.find(g=>g.id===u)??null},subscribe(d,u){return o.all.add(d),u?.immediate!==false&&n&&a.size===s&&d(e,e),()=>o.all.delete(d)},subscribeStable(d,u){return o.stable.add(d),u?.immediate!==false&&n&&a.size===s&&d(e,e),()=>o.stable.delete(d)},subscribeSeedRestock(d,u){return o.seedRestock.add(d),u?.immediate&&n&&a.size===s&&d({shop:e.byType.seed,previousItems:[]}),()=>o.seedRestock.delete(d)},subscribeToolRestock(d,u){return o.toolRestock.add(d),u?.immediate&&n&&a.size===s&&d({shop:e.byType.tool,previousItems:[]}),()=>o.toolRestock.delete(d)},subscribeEggRestock(d,u){return o.eggRestock.add(d),u?.immediate&&n&&a.size===s&&d({shop:e.byType.egg,previousItems:[]}),()=>o.eggRestock.delete(d)},subscribeDecorRestock(d,u){return o.decorRestock.add(d),u?.immediate&&n&&a.size===s&&d({shop:e.byType.decor,previousItems:[]}),()=>o.decorRestock.delete(d)},subscribePurchase(d,u){if(o.purchase.add(d),u?.immediate&&n&&a.size===s)for(const f of e.all)for(const g of f.items)g.purchased>0&&d({shopType:f.type,itemId:g.id,quantity:g.purchased,newPurchased:g.purchased,remaining:g.remaining});return ()=>o.purchase.delete(d)},subscribeAvailability(d,u){if(o.availability.add(d),u?.immediate&&n&&a.size===s)for(const f of e.all)for(const g of f.items)d({shopType:f.type,itemId:g.id,wasAvailable:g.isAvailable,isAvailable:g.isAvailable});return ()=>o.availability.delete(d)},destroy(){for(const d of r)d();r.length=0,o.all.clear(),o.stable.clear(),o.seedRestock.clear(),o.toolRestock.clear(),o.eggRestock.clear(),o.decorRestock.clear(),o.purchase.clear(),o.availability.clear(),n=false;}}}let th=null;function $o(){return th||(th=GN()),th}function GS(e){const t=e||"Sunny",o=ue.get("weather")?.[t]?.name||t;return {id:t,name:o,isActive:t!=="Sunny",type:t,startTime:null,endTime:null,remainingSeconds:0}}function s0(){return GS(null)}function zN(){let e=s0(),t=s0(),n=null,r=false,o=null;const i={all:new Set,stable:new Set};function a(l){const c=(l||"Sunny")!==(n||"Sunny");n=l;const d=GS(l),u=e.id!==d.id;if(t=e,e=d,!!r){if(c)for(const f of i.all)f(e,t);if(u){const f={current:e,previous:t};for(const g of i.stable)g(f);}}}async function s(){r||(o=await rt.subscribe("weatherAtom",l=>{a(l);}),r=true);}return s(),{get(){return e},subscribe(l,c){return i.all.add(l),c?.immediate!==false&&r&&l(e,e),()=>i.all.delete(l)},subscribeStable(l,c){return i.stable.add(l),c?.immediate&&r&&l({current:e,previous:e}),()=>i.stable.delete(l)},destroy(){o?.(),o=null,i.all.clear(),i.stable.clear(),r=false;}}}let nh=null;function Do(){return nh||(nh=zN()),nh}let un=null;function zS(){return un||(un={currentTile:_t(),myPets:po(),gameMap:hg(),myInventory:En(),players:Sb(),shops:$o(),weather:Do(),myGarden:gr()},un)}function Hr(){if(!un)throw new Error("[Globals] Not initialized. Call initGlobals() first.");return un}function UN(){un&&(un.currentTile.destroy(),un.myPets.destroy(),un.gameMap.destroy(),un.myInventory.destroy(),un.players.destroy(),un.shops.destroy(),un.weather.destroy(),un.myGarden.destroy(),un=null);}const De={get currentTile(){return Hr().currentTile},get myPets(){return Hr().myPets},get gameMap(){return Hr().gameMap},get myInventory(){return Hr().myInventory},get players(){return Hr().players},get shops(){return Hr().shops},get weather(){return Hr().weather},get myGarden(){return Hr().myGarden}};function HN(e){const t=pb(e);return {ok:t.ok,itemId:e,reason:t.ok?void 0:t.reason}}function WN(e){const r=De.shops.getShop("seed").items.find(s=>s.id===e);if(!r)return {ok:false,itemId:e,totalPurchased:0,errors:[`Seed not found in shop: ${e}`]};const o=r.remaining,i=[];let a=0;for(let s=0;s<o;s++){const l=pb(e);l.ok?a++:i.push(l.reason||`Failed to purchase seed ${s+1}`);}return {ok:a>0,itemId:e,totalPurchased:a,errors:i}}function VN(e){const t=db(e);return {ok:t.ok,itemId:e,reason:t.ok?void 0:t.reason}}function qN(e){const r=De.shops.getShop("egg").items.find(s=>s.id===e);if(!r)return {ok:false,itemId:e,totalPurchased:0,errors:[`Egg not found in shop: ${e}`]};const o=r.remaining,i=[];let a=0;for(let s=0;s<o;s++){const l=db(e);l.ok?a++:i.push(l.reason||`Failed to purchase egg ${s+1}`);}return {ok:a>0,itemId:e,totalPurchased:a,errors:i}}function KN(e){const t=cb(e);return {ok:t.ok,itemId:e,reason:t.ok?void 0:t.reason}}function XN(e){const r=De.shops.getShop("decor").items.find(s=>s.id===e);if(!r)return {ok:false,itemId:e,totalPurchased:0,errors:[`Decor not found in shop: ${e}`]};const o=r.remaining,i=[];let a=0;for(let s=0;s<o;s++){const l=cb(e);l.ok?a++:i.push(l.reason||`Failed to purchase decor ${s+1}`);}return {ok:a>0,itemId:e,totalPurchased:a,errors:i}}function YN(e){const t=ub(e);return {ok:t.ok,itemId:e,reason:t.ok?void 0:t.reason}}function JN(e){const r=De.shops.getShop("tool").items.find(s=>s.id===e);if(!r)return {ok:false,itemId:e,totalPurchased:0,errors:[`Tool not found in shop: ${e}`]};const o=r.remaining,i=[];let a=0;for(let s=0;s<o;s++){const l=ub(e);l.ok?a++:i.push(l.reason||`Failed to purchase tool ${s+1}`);}return {ok:a>0,itemId:e,totalPurchased:a,errors:i}}let rh=false;const fi={init(){rh||(rh=true,console.log("[MGShopActions] Initialized"));},isReady(){return rh},seed:{buy:HN,buyAll:WN},egg:{buy:VN,buyAll:qN},decor:{buy:KN,buyAll:XN},tool:{buy:YN,buyAll:JN}};async function US(e){const t=[{name:"Data",init:()=>ue.init()},{name:"CustomModal",init:()=>eo.init()},{name:"Sprites",init:()=>me.init()},{name:"TileObjectSystem",init:()=>so.init()},{name:"Pixi",init:()=>xp.init()},{name:"RiveLoader",init:()=>ja.init()},{name:"Audio",init:()=>Dt.init()},{name:"Cosmetics",init:()=>hb.init()},{name:"ShopActions",init:()=>fi.init()}];await Promise.all(t.map(async n=>{e?.({status:"start",name:n.name});try{await n.init(),e?.({status:"success",name:n.name});}catch(r){console.error(`[${n.name}] failed`,r),e?.({status:"error",name:n.name,error:r});}})),console.log("[Gemini] Modules ready. Access via Gemini.Modules in console.");}const Mp=Object.freeze(Object.defineProperty({__proto__:null,MGAssets:Bi,MGAudio:Dt,MGCalculators:FS,MGCosmetic:hb,MGCustomModal:eo,MGData:ue,MGEnvironment:Vt,MGManifest:Zr,MGPixi:xp,MGPixiHooks:Vn,MGRiveLoader:ja,MGShopActions:fi,MGSprite:me,MGTile:so,MGVersion:Nm,PET_ABILITY_ACTIONS:SC,filterPetAbilityLogs:kC,formatAbilityLog:EC,initAllModules:US,isPetAbilityAction:_C},Symbol.toStringTag,{value:"Module"}));let Sa=null,Us=null;function QN(){if(Us)return Us;const e=new Set,t=new Set,n=new Set,r=new Set,o=ue.get("plants");if(o&&typeof o=="object")for(const[l,c]of Object.entries(o))c&&typeof c=="object"&&c.seed&&e.add(l);const i=ue.get("eggs");if(i&&typeof i=="object")for(const l of Object.keys(i))t.add(l);const a=ue.get("decor");if(a&&typeof a=="object")for(const l of Object.keys(a))n.add(l);const s=ue.get("weather");if(s&&typeof s=="object")for(const l of Object.keys(s))r.add(l);return r.has("Frost")&&r.add("Snow"),r.has("Snow")&&r.add("Frost"),Us={seed:e,egg:t,decor:n,weather:r},Us}function ZN(){Us=null;}function HS(e,t){const n=QN();return e==="seed"?n.seed.has(t):e==="egg"?n.egg.has(t):e==="decor"?n.decor.has(t):e==="weather"?n.weather.has(t):false}function WS(){return Sa||(Sa=ST()),Sa}function e$(e){const t={};for(const[n,r]of Object.entries(e))HS(r.shopType,r.itemId)&&(t[n]={...r});Sa=t,Mm(t),zt("Replaced history from server",{items:Object.keys(t).length}),Da(Me.SHOP_RESTOCK_HISTORY_UPDATED);}function _b(){return WS()}function t$(){Sa={},Mm(Sa);}function VS(){const e=WS();let t=0;for(const[n,r]of Object.entries(e))HS(r.shopType,r.itemId)||(delete e[n],t+=1);t>0&&(Mm(e),zt("Pruned invalid history items",{removed:t}),Da(Me.SHOP_RESTOCK_HISTORY_UPDATED));}const n$=3e4;let l0=new Map;function r$(e,t){return `${e}:${t}`}function o$(e,t){const n=r$(e,t),r=l0.get(n);if(r&&Date.now()-r.at<n$)return r.prediction;const i=_b()[n];if(!i)return null;const a=qS(i);return l0.set(n,{prediction:a,at:Date.now()}),a}function i$(){const e=_b(),t=[];for(const n of Object.values(e))t.push(qS(n));return t}function qS(e){const t=e.totalOccurrences??0,n=e.lastSeen??null,r=e.appearanceRate??null,o=e.shopType==="weather"?null:Mx[e.shopType];let i=e.averageIntervalMs??null,a=null;if(i===null&&o!==null&&r!==null&&r>0&&(i=Math.round(o/r)),n!==null){if(e.estimatedNextTimestamp!==null)a=e.estimatedNextTimestamp;else if(i!==null){a=n+i;const s=Date.now();if(a<s&&i>0){const l=s-n,c=Math.ceil(l/i);a=n+c*i;}}}return {itemId:e.itemId,shopType:e.shopType,estimatedNextTimestamp:a,averageIntervalMs:i,totalDataPoints:t,lastSeen:n,appearanceRate:r,averageQuantity:e.averageQuantity??null}}let Du=false;const KS=e=>{fr().debug.enabled&&zt("Debug simulate received (no-op in read-only mode)",e.detail);};function a$(){Du||(Du=true,zt("Debug simulate listener attached"),window.addEventListener(Ox.DEBUG_SIMULATE,KS));}function s$(){Du&&(Du=false,zt("Debug simulate listener removed"),window.removeEventListener(Ox.DEBUG_SIMULATE,KS));}const l$={apiBaseUrl:"https://ariesmod-api.ariedam.fr/"},XS=lt.ARIES_API;function kb(){return Xe(XS,l$)}function c$(e){Ye(XS,e);}function d$(e){const n={...kb(),...e};return c$(n),n}function YS(e,t){return new Promise(n=>{GM_xmlhttpRequest({method:"GET",url:e,headers:t??{},onload:r=>{if(r.status>=200&&r.status<300){try{const o=r.responseText?JSON.parse(r.responseText):null;n({status:r.status,data:o});}catch{n({status:r.status,data:null});}return}n({status:r.status,data:null});},onerror:()=>n({status:0,data:null})});})}function JS(e,t,n){return new Promise(r=>{GM_xmlhttpRequest({method:"POST",url:e,headers:{"Content-Type":"application/json",...n??{}},data:JSON.stringify(t),onload:o=>{if(o.status>=200&&o.status<300){try{const i=o.responseText?JSON.parse(o.responseText):null;r({status:o.status,data:i});}catch{r({status:o.status,data:null});}return}r({status:o.status,data:null});},onerror:()=>r({status:0,data:null})});})}function QS(e,t){const n=kb(),r=new URL(e,n.apiBaseUrl);if(t)for(const[o,i]of Object.entries(t))i!==void 0&&r.searchParams.set(o,String(i));return r.toString()}function Ei(e,t,n){const r=QS(e,t);return YS(r,n)}function Lp(e,t,n){const r=QS(e);return JS(r,t,n)}function u$(){const{supabaseUrl:e,supabaseAnonKey:t}=fr();return !e||!t?null:{apikey:t,Authorization:`Bearer ${t}`}}function p$(e){return e==="seed"||e==="egg"||e==="decor"||e==="weather"}function f$(e){const t={};let n=null;for(const r of e){const o=r.item_id,i=r.shop_type;if(!o||!i||i==="tool"||!p$(i))continue;const a=r.last_seen??null;typeof a=="number"&&(n===null||a>n)&&(n=a);const s=`${i}:${o}`;t[s]={itemId:o,shopType:i,totalOccurrences:r.total_occurrences??0,totalQuantity:r.total_quantity??null,firstSeen:null,lastSeen:a,averageIntervalMs:r.expected_interval_ms??r.median_interval_ms??null,estimatedNextTimestamp:r.estimated_next_timestamp??null,averageQuantity:r.average_quantity??null,lastQuantity:null,ratePerDay:null,appearanceRate:r.current_probability??null};}return {items:t,maxLastSeen:n}}function h$(e){const t={};let n=null;for(const r of e){const o=r.weather_id;if(!o)continue;const i=r.last_seen??null;typeof i=="number"&&(n===null||i>n)&&(n=i);const a=`weather:${o}`;t[a]={itemId:o,shopType:"weather",totalOccurrences:r.total_occurrences??0,totalQuantity:null,firstSeen:null,lastSeen:i,averageIntervalMs:r.average_interval_ms??null,estimatedNextTimestamp:r.estimated_next_timestamp??null,averageQuantity:null,lastQuantity:null,ratePerDay:r.appearance_rate??null,appearanceRate:r.appearance_rate??null};}return {items:t,maxLastSeen:n}}async function g$(){const e=fr(),t=u$();if(e.communitySource==="supabase"){if(!t||!e.supabaseUrl)return zt("Supabase config missing"),{items:null,meta:null,source:"none"};try{const n=`${e.supabaseUrl}/rest/v1/restock_predictions?select=`+["item_id","shop_type","total_occurrences","total_quantity","last_seen","average_quantity","median_interval_ms","expected_interval_ms","estimated_next_timestamp","current_probability"].join(","),r=`${e.supabaseUrl}/rest/v1/weather_predictions?select=`+["weather_id","total_occurrences","last_seen","average_interval_ms","estimated_next_timestamp","appearance_rate"].join(","),[o,i]=await Promise.all([Ei(n,void 0,t),Ei(r,void 0,t)]);if(o.status===404)return zt("Supabase predictions view not found (404)"),{items:null,meta:null,source:"supabase"};if(o.status===500)return zt("Supabase predictions view error (500)"),{items:null,meta:null,source:"supabase"};if(o.status!==200&&o.status!==0)return zt("Fetch predictions error",{status:o.status}),{items:null,meta:null,source:"supabase"};i.status!==200&&i.status!==0&&zt("Fetch weather predictions error",{status:i.status});const a=Array.isArray(o.data)?o.data:[],s=Array.isArray(i.data)?i.data:[],l=f$(a),c=h$(s),d={...l.items,...c.items},u=[l.maxLastSeen,c.maxLastSeen].filter(f=>typeof f=="number").reduce((f,g)=>f===null||g>f?g:f,null);return zt("Fetch predictions",{items:Object.keys(d).length}),{items:d,meta:{lastUpdated:u,count:Object.keys(d).length},source:"supabase"}}catch(n){return zt("Fetch predictions exception",{error:String(n)}),{items:null,meta:null,source:"supabase"}}}if(e.communitySource==="vps"){const n=await Ei("/restock/history"),r=n.data?.items?Object.keys(n.data.items).length:0;return zt("Fetch history (VPS)",{items:r}),{items:n.data?.items??null,meta:null,source:"vps"}}return {items:null,meta:null,source:"none"}}function bg(){Da(Me.SHOP_RESTOCK_TRACKED_CHANGED);}function vg(e){Da(Me.SHOP_RESTOCK_TRACKED,{items:e});}function Op(){const e=fr();return Array.isArray(e.trackedItems)?[...e.trackedItems]:[]}function m$(e,t){const n=fr();zt("Toggle tracked start",{shopType:e,itemId:t,currentCount:n.trackedItems.length});const r=Op(),o=r.find(s=>s.shopType===e&&s.itemId===t);let i,a;return o?(i=r.filter(s=>!(s.shopType===e&&s.itemId===t)),a=false):(i=[...r,{shopType:e,itemId:t}],a=true),Tu({...n,trackedItems:i}),zt("Toggle tracked result",{enabled:a,newCount:i.length}),bg(),vg(i),a}function b$(e,t,n){const r=fr(),o=Op(),i=o.some(a=>a.shopType===e&&a.itemId===t);if(n&&!i){const a=[...o,{shopType:e,itemId:t}];Tu({...r,trackedItems:a}),bg(),vg(a);return}if(!n&&i){const a=o.filter(s=>!(s.shopType===e&&s.itemId===t));Tu({...r,trackedItems:a}),bg(),vg(a);}}function v$(e,t){return Op().some(r=>r.shopType===e&&r.itemId===t)}function y$(){return Op()}let Ll=false,ws=null,oh=false,c0=0;const w$=6e4;function ZS(){if(Ll)return;if(!Rm()){zt("Init skipped (disabled)");return}Ll=true;const e=fr();e.debug.enabled&&a$(),e.communityDataEnabled&&t_(true),VS(),zt("Initialized");}function e_(){Ll&&(s$(),Ll=false,zt("Destroyed"));}function x$(){return Ll}function C$(){return Rm()}function S$(e){Rm()!==e&&(CT(e),e?ZS():e_());}function _$(e){const t=_b();return Object.values(t).filter(n=>n.shopType===e)}function k$(){t$();}function E$(e,t){return o$(e,t)}function A$(){return i$()}async function t_(e=false){if(!oh&&!document.hidden){if(!e&&Date.now()-c0<w$){zt("Sync skipped (cooldown)");return}oh=true;try{const t=await g$();if(t.meta?.lastUpdated){if(!e&&ws&&t.meta.lastUpdated<=ws)return;ws=t.meta.lastUpdated;}t.items&&e$(t.items);const n=t.meta??(ws?{lastUpdated:ws}:null);n&&window.dispatchEvent(new CustomEvent(Me.SHOP_RESTOCK_META_UPDATED,{detail:n})),c0=Date.now();}finally{oh=false;}}}const Kn={init:ZS,destroy:e_,isReady:x$,isEnabled:C$,setEnabled:S$,getHistoryForShop:_$,clearHistory:k$,predictItem:E$,predictAllFavorites:A$,syncCommunityData:t_,toggleTrackedItem:m$,setTrackedItem:b$,isTracked:v$,getTrackedItems:y$};class T${constructor(){de(this,"injections",new Map);de(this,"state",{});de(this,"initialized",false);}register(t){if(this.injections.has(t.id)){console.warn(`[InjectionRegistry] ${t.id} already registered`);return}this.injections.set(t.id,t),this.loadState(t.id),console.log(`[InjectionRegistry] Registered: ${t.name}`);}initAll(){if(!this.initialized){for(const[t,n]of this.injections)if(this.state[t]??n.defaultEnabled??false)try{n.injection.init();}catch(o){console.error(`[InjectionRegistry] Failed to init ${t}:`,o);}this.initialized=true,console.log("[InjectionRegistry] All injections initialized");}}destroyAll(){for(const[,t]of this.injections)try{t.injection.destroy();}catch(n){console.error(`[InjectionRegistry] Failed to destroy ${t.id}:`,n);}this.initialized=false,console.log("[InjectionRegistry] All injections destroyed");}setEnabled(t,n){const r=this.injections.get(t);if(!r){console.warn(`[InjectionRegistry] Unknown injection: ${t}`);return}this.state[t]=n,this.saveState(t),n?r.injection.init():r.injection.destroy(),console.log(`[InjectionRegistry] ${r.name} ${n?"enabled":"disabled"}`);}getAll(){return Array.from(this.injections.values())}isEnabled(t){return this.state[t]??false}loadState(t){const n=this.injections.get(t);if(!n)return;const r=Xe(n.storageKey,n.defaultEnabled??false);this.state[t]=r;}saveState(t){const n=this.injections.get(t);n&&Ye(n.storageKey,this.state[t]);}}let ih=null;function Fu(){return ih||(ih=new T$),ih}function n_(e){return e.replace(/[_-]+/g," ").replace(/^\w/,t=>t.toUpperCase())}function I$(){return Object.keys(wa).map(e=>({value:e,label:n_(e)}))}const P$=["--bg","--fg","--accent","--muted","--soft","--border","--shadow","--paper","--tab-bg","--tab-fg","--pill-from","--pill-to","--low","--medium","--high","--complete","--info","--accent-1","--accent-2","--accent-3"];function R$(e){return n_(e.replace(/^--/,""))}function M$(e){return e.alpha<1?e.rgba:e.hex}const Mn={pets:{enabled:true},autoFavorite:{enabled:true},shopRestock:{enabled:true},locker:{enabled:true},trackers:{enabled:true},alerts:{enabled:true},avatar:{enabled:true},room:{enabled:true},bulkFavorite:{enabled:false},cropSizeIndicator:{enabled:false},eggProbabilityIndicator:{enabled:false},cropValueIndicator:{enabled:true}};class L$ extends pr{constructor(n){super({id:"tab-settings",label:"Settings"});de(this,"featureConfig",Mn);this.deps=n;}async build(n){const r=this.createGrid("12px");r.id="settings",n.appendChild(r);let o;try{o=await xT();}catch{o={get:()=>Wh,set:()=>{},save:()=>{},setUI:()=>{},setCardExpanded:()=>{},toggleCard:()=>{}};}const i=o.get(),a=Xe(lt.CONFIG,{});this.featureConfig=this.mergeFeatureConfig(a);const s=Object.keys(wa),l=this.deps.getCurrentTheme?.()??this.deps.initialTheme,c=s.includes(l)?l:s[0]??"dark";let d=c;const u=km({text:"Theme",tone:"muted",size:"lg"}),f=Ri({options:I$(),value:c,onChange:P=>{d=P,this.deps.applyTheme(P),this.renderThemePickers(P,g,d);}}),g=x("div",{className:"settings-theme-grid"}),h=dt({title:"Style",padding:"lg",expandable:true,defaultExpanded:!!i.ui.expandedCards.style,onExpandChange:P=>o.setCardExpanded("style",P)},x("div",{className:"kv settings-theme-row"},u.root,f.root),g);this.renderThemePickers(c,g,d);const y=this.createHUDSectionsCard({defaultExpanded:!!i.ui.expandedCards.hudSections,onExpandChange:P=>o.setCardExpanded("hudSections",P)}),S=this.createEnhancementsCard({defaultExpanded:!!i.ui.expandedCards.enhancements,onExpandChange:P=>o.setCardExpanded("enhancements",P)}),C=this.createJournalCard({defaultExpanded:!!i.ui.expandedCards.journal,onExpandChange:P=>o.setCardExpanded("journal",P)}),_=this.createRestockCard({defaultExpanded:!!i.ui.expandedCards.restock,onExpandChange:P=>o.setCardExpanded("restock",P)}),E=this.createEnvCard({defaultExpanded:!!i.ui.expandedCards.system,onExpandChange:P=>o.setCardExpanded("system",P)});r.appendChild(h),r.appendChild(y),r.appendChild(S),r.appendChild(C),r.appendChild(_),r.appendChild(E);}mergeFeatureConfig(n){return {pets:{...Mn.pets,...n.pets},autoFavorite:{...Mn.autoFavorite,...n.autoFavorite},shopRestock:{...Mn.shopRestock,...n.shopRestock},locker:{...Mn.locker,...n.locker},trackers:{...Mn.trackers,...n.trackers},alerts:{...Mn.alerts,...n.alerts},avatar:{...Mn.avatar,...n.avatar},room:{...Mn.room,...n.room},bulkFavorite:{...Mn.bulkFavorite,...n.bulkFavorite},cropSizeIndicator:{...Mn.cropSizeIndicator,...n.cropSizeIndicator},eggProbabilityIndicator:{...Mn.eggProbabilityIndicator,...n.eggProbabilityIndicator},cropValueIndicator:{...Mn.cropValueIndicator,...n.cropValueIndicator}}}saveFeatureConfig(){Ye(lt.CONFIG,this.featureConfig),console.log("[Settings] Feature config saved:",this.featureConfig);}createHUDSectionsCard(n){const r=(o,i,a,s,l=false,c=false)=>{const d=x("div",{style:`
          display: grid;
          grid-template-columns: 1fr auto;
          gap: 12px;
          padding: ${l?"0":"12px"} 0 ${c?"0":"12px"} 0;
          ${c?"":"border-bottom: 1px solid var(--border);"}
          transition: opacity 0.2s ease;
          opacity: ${i?"1":"0.5"};
        `}),u=x("div"),f=x("div",{style:"font-weight: 500; margin-bottom: 4px;"},o),g=x("div",{style:"font-size: 12px; color: var(--fg); opacity: 0.7;"},s);u.append(f,g);const h=ao({checked:i,onChange:y=>{d.style.opacity=y?"1":"0.5",a(y);}});return d.append(u,h.root),d};return dt({title:"HUD Sections",padding:"lg",expandable:true,defaultExpanded:n?.defaultExpanded??false,onExpandChange:n?.onExpandChange},x("div",{},r("Auto-Favorite",this.featureConfig.autoFavorite.enabled,o=>{this.featureConfig.autoFavorite.enabled=o,this.saveFeatureConfig();},"Automatic mutation favoriting settings",true),r("Restock",this.featureConfig.shopRestock.enabled,o=>{this.featureConfig.shopRestock.enabled=o,this.saveFeatureConfig(),Kn.setEnabled(o);},"Shop restock tracking and predictions",false,false),r("Pets",this.featureConfig.pets.enabled,o=>{this.featureConfig.pets.enabled=o,this.saveFeatureConfig();},"Pet management and team tracking"),r("Locker",this.featureConfig.locker.enabled,o=>{this.featureConfig.locker.enabled=o,this.saveFeatureConfig();},"Configure crop, egg, and decor blockers"),r("Trackers",this.featureConfig.trackers.enabled,o=>{this.featureConfig.trackers.enabled=o,this.saveFeatureConfig();},"Resource and progress tracking"),r("Alerts",this.featureConfig.alerts.enabled,o=>{this.featureConfig.alerts.enabled=o,this.saveFeatureConfig();},"Event notifications and alerts"),r("Avatar",this.featureConfig.avatar.enabled,o=>{this.featureConfig.avatar.enabled=o,this.saveFeatureConfig();},"Avatar customization and loadouts"),r("Room",this.featureConfig.room.enabled,o=>{this.featureConfig.room.enabled=o,this.saveFeatureConfig();},"Public room browser",false,true)))}createSectionRow(n,r,o,i,a=false,s=false){const l=x("div",{style:`
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 12px;
        padding: ${a?"0":"12px"} 0 ${s?"0":"12px"} 0;
        ${s?"":"border-bottom: 1px solid var(--border);"}
        transition: opacity 0.2s ease;
        opacity: ${r?"1":"0.5"};
      `}),c=x("div"),d=x("div",{style:"font-weight: 500; margin-bottom: 4px;"},n),u=x("div",{style:"font-size: 12px; color: var(--fg); opacity: 0.7;"},i);c.append(d,u);const f=ao({checked:r,onChange:g=>{l.style.opacity=g?"1":"0.5",o(g);}});return l.append(c,f.root),l}createEnhancementsCard(n){const r=Fu(),i=[...r.getAll().filter(s=>!this.isJournalInjection(s.id))].sort((s,l)=>s.name.localeCompare(l.name)),a=i.map((s,l)=>{const c=l===0,d=l===i.length-1,u=r.isEnabled(s.id);return this.createSectionRow(s.name,u,f=>{r.setEnabled(s.id,f),this.saveFeatureConfig();},s.description,c,d)});return dt({title:"In-Game Enhancements",variant:"soft",padding:"lg",expandable:true,defaultExpanded:n?.defaultExpanded??false,onExpandChange:n?.onExpandChange},x("div",{},...a))}createJournalCard(n){const r=Fu(),i=[...r.getAll().filter(s=>this.isJournalInjection(s.id)).filter(s=>s.id!=="journalHints"&&s.id!=="journalFilterSort")].sort((s,l)=>s.name.localeCompare(l.name)),a=i.map((s,l)=>{const c=l===0,d=l===i.length-1,u=r.isEnabled(s.id);return this.createSectionRow(s.name,u,f=>{r.setEnabled(s.id,f),this.saveFeatureConfig();},s.description,c,d)});return dt({title:"Journal",variant:"soft",padding:"lg",expandable:true,defaultExpanded:n?.defaultExpanded??false,onExpandChange:n?.onExpandChange},x("div",{},...a))}createRestockCard(n){return fr(),dt({title:"Restock",variant:"soft",padding:"lg",expandable:true,defaultExpanded:n?.defaultExpanded??false,onExpandChange:n?.onExpandChange},x("div",{},x("div",{style:"font-size: 12px; opacity: 0.7; line-height: 1.4;"},"Community upload is disabled. Restock and weather data are now sourced from the server API.")))}isJournalInjection(n){return n==="abilitiesInject"||n==="journalHints"||n==="journalFilterSort"||n==="journalAllTab"||n==="missingVariantsIndicator"}renderThemePickers(n,r,o){const i=wa[n];if(r.replaceChildren(),!!i)for(const a of P$){const s=i[a];if(s==null)continue;const l=lT({label:R$(a),value:s,defaultExpanded:false,onInput:c=>this.updateThemeVar(n,a,c,o),onChange:c=>this.updateThemeVar(n,a,c,o)});r.appendChild(l.root);}}updateThemeVar(n,r,o,i){const a=wa[n];a&&(a[r]=M$(o),i===n&&this.deps.applyTheme(n));}createEnvCard(n){const r=n?.defaultExpanded??false,o=n?.onExpandChange,i=(C,_)=>{const E=x("div",{className:"kv kv--inline-mobile"}),P=x("label",{},C),O=x("div",{className:"ro"});return typeof _=="string"?O.textContent=_:O.append(_),E.append(P,O),E},a=x("code",{},"—"),s=x("span",{},"—"),l=x("span",{},"—"),c=x("span",{},"—"),d=x("span",{},"—"),u=x("span",{},"—"),f=()=>{const C=Vt.detect();l.textContent=C.surface??"Unknown",c.textContent=C.platform??"Unknown",d.textContent=C.browser??"Unknown",u.textContent=C.os??"Unknown",a.textContent=C.host??"Unknown",s.textContent=C.isInIframe?"Yes":"No";},g=Ct({label:"Copy JSON",variant:"primary",size:"sm"});yT(g,()=>{const C=Vt.detect();return JSON.stringify(C,null,2)});const h=x("div",{style:"width:100%;display:flex;justify-content:center;"},g),y=dt({title:"System",variant:"soft",padding:"lg",footer:h,expandable:true,defaultExpanded:r,onExpandChange:o},i("Surface",l),i("Platform",c),i("Browser",d),i("OS",u),i("Host",a),i("Iframe",s)),S=()=>{document.hidden||f();};return document.addEventListener("visibilitychange",S),f(),this.addCleanup(()=>document.removeEventListener("visibilitychange",S)),y}}function Za(e){const{id:t,columns:n,data:r,pageSize:o=0,stickyHeader:i=true,zebra:a=true,animations:s=true,respectReducedMotion:l=true,compact:c=false,maxHeight:d,selectable:u=false,selectionType:f="switch",selectOnRowClick:g=false,initialSelection:h=[],hideHeaderCheckbox:y=false,getRowId:S=(b,v)=>String(v),onSortChange:C,onSelectionChange:_,onRowClick:E}=e;let P=n.slice(),O=r.slice(),k=r.slice(),I=null,R=null,A=1;const L=typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(prefers-reduced-motion: reduce)").matches:false,F=!!s&&!(l&&L),G=x("div",{className:"lg-table-wrap",id:t});if(d!=null){const b=typeof d=="number"?`${d}px`:d;G.style.setProperty("--tbl-max-h",b);}const q=x("div",{className:"lg-table"}),H=x("div",{className:"lg-thead"}),ce=x("div",{className:"lg-tbody"}),W=x("div",{className:"lg-tfoot"});i&&G.classList.add("sticky"),a&&G.classList.add("zebra"),c&&G.classList.add("compact"),u&&G.classList.add("selectable");const te=f==="switch"?"52px":"36px";G.style.setProperty("--check-w",te);function ne(b){return b==="center"?"center":b==="right"?"flex-end":"flex-start"}function ie(){const b=P.map(N=>{const z=(N.width||"1fr").trim();return /\bfr$/.test(z)?`minmax(0, ${z})`:z}),v=(u?[te,...b]:b).join(" ");G.style.setProperty("--lg-cols",v);}ie();function ee(){return o?Math.max(1,Math.ceil(O.length/o)):1}function U(){if(!o)return O;const b=(A-1)*o;return O.slice(b,b+o)}function X(){if(!I||!R)return;const b=P.find(z=>String(z.key)===I),v=R==="asc"?1:-1,N=b?.sortFn?(z,V)=>v*b.sortFn(z,V):(z,V)=>{const Z=z[I],pe=V[I];return Z==null&&pe==null?0:Z==null?-1*v:pe==null?1*v:typeof Z=="number"&&typeof pe=="number"?v*(Z-pe):v*String(Z).localeCompare(String(pe),void 0,{numeric:true,sensitivity:"base"})};O.sort(N);}const D=new Set(h);function j(){return Array.from(D)}const Q=new Map;function ae(b){D.clear(),b.forEach(v=>D.add(v)),Ie(),Q.forEach((v,N)=>{v.setChecked(D.has(N),true);}),qe(),_?.(j());}function le(){D.clear(),Ie(),Q.forEach(b=>b.setChecked(false,true)),qe(),_?.(j());}let we=null;function Ie(){if(!we)return;const b=U();if(!b.length){we.indeterminate=false,we.checked=false;return}const v=b.map((z,V)=>S(z,(A-1)*(o||0)+V)),N=v.reduce((z,V)=>z+(D.has(V)?1:0),0);we.checked=N===v.length,we.indeterminate=N>0&&N<v.length;}let Ve=false;function kt(){Ve=false;const b=ce.offsetWidth-ce.clientWidth;H.style.paddingRight=b>0?`${b}px`:"0px";}function mn(){Ve||(Ve=true,requestAnimationFrame(kt));}const St=new ResizeObserver(()=>mn()),qt=()=>mn();function wn(){H.replaceChildren();const b=x("div",{className:"lg-tr lg-tr-head"});if(u){const v=x("div",{className:"lg-th lg-th-check"});y||(we=x("input",{type:"checkbox"}),we.addEventListener("change",()=>{const N=U(),z=we.checked;N.forEach((V,Z)=>{const pe=S(V,(A-1)*(o||0)+Z);z?D.add(pe):D.delete(pe);}),_?.(j()),qe();}),v.appendChild(we)),b.appendChild(v);}P.forEach(v=>{const N=x("button",{className:"lg-th",type:"button",title:v.title||v.header});N.textContent=v.header,v.align&&N.style.setProperty("--col-justify",ne(v.align)),v.sortable&&N.classList.add("sortable"),I===String(v.key)&&R?N.setAttribute("data-sort",R):N.removeAttribute("data-sort"),v.sortable&&N.addEventListener("click",()=>{const z=String(v.key);I!==z?(I=z,R="asc"):(R=R==="asc"?"desc":R==="desc"?null:"asc",R||(I=null,O=k.slice())),C?.(I,R),I&&R&&X(),Ft();}),b.appendChild(N);}),H.appendChild(b);try{St.disconnect();}catch{}St.observe(ce),mn();}function nn(b){return Array.from(b.querySelectorAll(":scope > .lg-td, :scope > .lg-td-check"))}function xn(b){return b.querySelector(".lg-td, .lg-td-check")}function ft(b){const v=xn(b);return v?v.getBoundingClientRect():null}function qe(){const b=U(),v=new Map;Array.from(ce.children).forEach(Z=>{const pe=Z,Ce=pe.getAttribute("data-id");if(!Ce)return;const ye=ft(pe);ye&&v.set(Ce,ye);});const N=new Map;Array.from(ce.children).forEach(Z=>{const pe=Z,Ce=pe.getAttribute("data-id");Ce&&N.set(Ce,pe);});const z=[];for(let Z=0;Z<b.length;Z++){const pe=b[Z],Ce=(o?(A-1)*o:0)+Z,ye=S(pe,Ce);z.push(ye);let Se=N.get(ye);Se||(Se=Qn(pe,Ce),F&&nn(Se).forEach(vt=>{vt.style.transform="translateY(6px)",vt.style.opacity="0";})),ce.appendChild(Se);}const V=[];if(N.forEach((Z,pe)=>{z.includes(pe)||V.push(Z);}),!F){V.forEach(Z=>Z.remove()),Ie(),mn();return}z.forEach(Z=>{const pe=ce.querySelector(`.lg-tr-body[data-id="${Z}"]`);if(!pe)return;const Ce=ft(pe),ye=v.get(Z),Se=nn(pe);if(ye&&Ce){const it=ye.left-Ce.left,Kt=ye.top-Ce.top;Se.forEach(Pt=>{Pt.style.transition="none",Pt.style.transform=`translate(${it}px, ${Kt}px)`,Pt.style.opacity="1";}),xn(pe)?.getBoundingClientRect(),Se.forEach(Pt=>{Pt.style.willChange="transform, opacity",Pt.style.transition="transform .18s ease, opacity .18s ease";}),requestAnimationFrame(()=>{Se.forEach(Pt=>{Pt.style.transform="translate(0,0)";});});}else Se.forEach(it=>{it.style.transition="transform .18s ease, opacity .18s ease";}),requestAnimationFrame(()=>{Se.forEach(it=>{it.style.transform="translate(0,0)",it.style.opacity="1";});});const ut=it=>{(it.propertyName==="transform"||it.propertyName==="opacity")&&(Se.forEach(Kt=>{Kt.style.willChange="",Kt.style.transition="",Kt.style.transform="",Kt.style.opacity="";}),it.currentTarget.removeEventListener("transitionend",ut));},vt=Se[0];vt&&vt.addEventListener("transitionend",ut);}),V.forEach(Z=>{const pe=nn(Z);pe.forEach(Se=>{Se.style.willChange="transform, opacity",Se.style.transition="transform .18s ease, opacity .18s ease",Se.style.opacity="0",Se.style.transform="translateY(-6px)";});const Ce=Se=>{Se.propertyName==="opacity"&&(Se.currentTarget.removeEventListener("transitionend",Ce),Z.remove());},ye=pe[0];ye?ye.addEventListener("transitionend",Ce):Z.remove();}),Ie(),mn();}function Qn(b,v){const N=S(b,v),z=x("div",{className:"lg-tr lg-tr-body","data-id":N});if(u){const V=x("div",{className:"lg-td lg-td-check"});if(f==="switch"){const Z=ao({size:"sm",checked:D.has(N),onChange:pe=>{pe?D.add(N):D.delete(N),Ie(),_?.(j());}});Q.set(N,Z),V.appendChild(Z.root);}else {const Z=x("input",{type:"checkbox",className:"lg-row-check"});Z.checked=D.has(N),Z.addEventListener("change",pe=>{pe.stopPropagation(),Z.checked?D.add(N):D.delete(N),Ie(),_?.(j());}),Z.addEventListener("click",pe=>pe.stopPropagation()),V.appendChild(Z);}z.appendChild(V);}return P.forEach(V=>{const Z=x("div",{className:"lg-td"});V.align&&Z.style.setProperty("--col-justify",ne(V.align));let pe=V.render?V.render(b,v):String(b[V.key]??"");typeof pe=="string"?Z.textContent=pe:Z.appendChild(pe),z.appendChild(Z);}),(E||u&&g)&&(z.classList.add("clickable"),z.addEventListener("click",V=>{if(!V.target.closest(".lg-td-check")){if(u&&g){const Z=!D.has(N);if(Z?D.add(N):D.delete(N),Ie(),f==="switch"){const pe=Q.get(N);pe&&pe.setChecked(Z,true);}else {const pe=z.querySelector(".lg-row-check");pe&&(pe.checked=Z);}_?.(j());}E?.(b,v,V);}})),z}function Zn(){if(W.replaceChildren(),!o)return;const b=ee(),v=x("div",{className:"lg-pager"}),N=x("button",{className:"btn",type:"button"},"←"),z=x("button",{className:"btn",type:"button"},"→"),V=x("span",{className:"lg-pager-info"},`${A} / ${b}`);N.disabled=A<=1,z.disabled=A>=b,N.addEventListener("click",()=>Et(A-1)),z.addEventListener("click",()=>Et(A+1)),v.append(N,V,z),W.appendChild(v);}function Et(b){const v=ee();A=Math.min(Math.max(1,b),v),qe(),Zn();}function Ft(){ie(),wn(),qe(),Zn();}function Cn(b){k=b.slice(),O=b.slice(),I&&R&&X(),Et(1);}function br(b){P=b.slice(),Ft();}function Dn(b,v="asc"){I=b,R=b?v:null,I&&R?X():O=k.slice(),Ft();}function M(){try{St.disconnect();}catch{}window.removeEventListener("resize",qt);}return q.append(H,ce,W),G.appendChild(q),window.addEventListener("resize",qt),Ft(),{root:G,setData:Cn,setColumns:br,sortBy:Dn,getScrollTop:()=>ce.scrollTop,setScrollTop:b=>{ce.scrollTop=b;},getSelection:j,setSelection:ae,clearSelection:le,setPage:Et,getState:()=>({page:A,pageCount:ee(),sortKey:I,sortDir:R}),destroy:M}}let Bu=false;const Hs=new Set;function O$(e=document){let t=e.activeElement||null;for(;t&&t.shadowRoot&&t.shadowRoot.activeElement;)t=t.shadowRoot.activeElement;return t}const Wn=e=>{const t=O$();if(t){for(const n of Hs)if(t===n||n.contains(t)){e.stopImmediatePropagation(),e.stopPropagation();return}}};function N$(){Bu||(Bu=true,window.addEventListener("keydown",Wn,true),window.addEventListener("keypress",Wn,true),window.addEventListener("keyup",Wn,true),document.addEventListener("keydown",Wn,true),document.addEventListener("keypress",Wn,true),document.addEventListener("keyup",Wn,true));}function $$(){Bu&&(Bu=false,window.removeEventListener("keydown",Wn,true),window.removeEventListener("keypress",Wn,true),window.removeEventListener("keyup",Wn,true),document.removeEventListener("keydown",Wn,true),document.removeEventListener("keypress",Wn,true),document.removeEventListener("keyup",Wn,true));}function D$(e){return Hs.size===0&&N$(),Hs.add(e),()=>{Hs.delete(e),Hs.size===0&&$$();}}function od(e){return e==null?null:typeof e=="string"?document.createTextNode(e):e}function F$(){const e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"svg");t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("width","16"),t.setAttribute("height","16"),t.setAttribute("aria-hidden","true"),t.style.display="none",t.style.flexShrink="0";const n=document.createElementNS(e,"circle");n.setAttribute("cx","12"),n.setAttribute("cy","12"),n.setAttribute("r","9"),n.setAttribute("fill","none"),n.setAttribute("stroke","currentColor"),n.setAttribute("stroke-width","3"),n.setAttribute("stroke-linecap","round");const r=document.createElementNS(e,"animate");r.setAttribute("attributeName","stroke-dasharray"),r.setAttribute("values","1,150;90,150;90,150"),r.setAttribute("dur","1.5s"),r.setAttribute("repeatCount","indefinite");const o=document.createElementNS(e,"animateTransform");return o.setAttribute("attributeName","transform"),o.setAttribute("attributeType","XML"),o.setAttribute("type","rotate"),o.setAttribute("from","0 12 12"),o.setAttribute("to","360 12 12"),o.setAttribute("dur","1s"),o.setAttribute("repeatCount","indefinite"),n.append(r,o),t.appendChild(n),t}function es(e={}){const{id:t,placeholder:n="Search...",value:r="",size:o="md",disabled:i=false,autoFocus:a=false,onChange:s,onSearch:l,autoSearch:c=false,debounceMs:d=0,focusKey:u="/",iconLeft:f,iconRight:g,withClear:h=true,clearTitle:y="Clear",ariaLabel:S,submitLabel:C,loading:_=false,blockGameKeys:E=true}=e,P=x("div",{className:"search"+(o?` search--${o}`:""),id:t}),O=x("span",{className:"search-ico search-ico--left"});if(f){const le=od(f);le&&O.appendChild(le);}else O.textContent="🔎",O.style.opacity=".9";const k=x("input",{className:"input search-input",type:"text",placeholder:n,value:r,"aria-label":S||n}),I=x("span",{className:"search-ico search-ico--right"});if(g){const le=od(g);le&&I.appendChild(le);}const R=F$();R.classList.add("search-spinner");const A=h?x("button",{className:"search-clear",type:"button",title:y},"×"):null,L=C!=null?x("button",{className:"btn search-submit",type:"button"},C):null,F=x("div",{className:"search-field"},O,k,I,R,...A?[A]:[]);P.append(F,...L?[L]:[]);let G=!!i,q=null;function H(le){R.style.display=le?"inline-block":"none",P.classList.toggle("is-loading",le);}function ce(){q!=null&&(window.clearTimeout(q),q=null);}function W(le){ce(),d>0?q=window.setTimeout(()=>{q=null,le();},d):le();}function te(){s?.(k.value),c&&l&&l(k.value);}k.addEventListener("input",()=>{W(te);}),k.addEventListener("keydown",le=>{le.key==="Enter"?(le.preventDefault(),ce(),l?.(k.value)):le.key==="Escape"&&(k.value.length>0?ee("",{notify:true}):k.blur());}),A&&A.addEventListener("click",()=>ee("",{notify:true})),L&&L.addEventListener("click",()=>l?.(k.value));let ne=()=>{};if(E&&(ne=D$(k)),u){const le=we=>{if(we.key===u&&!we.ctrlKey&&!we.metaKey&&!we.altKey){const Ie=document.activeElement;Ie&&(Ie.tagName==="INPUT"||Ie.tagName==="TEXTAREA"||Ie.isContentEditable)||(we.preventDefault(),k.focus());}};window.addEventListener("keydown",le,true),P.__cleanup=()=>{window.removeEventListener("keydown",le,true),ne();};}else P.__cleanup=()=>{ne();};function ie(le){G=!!le,k.disabled=G,A&&(A.disabled=G),L&&(L.disabled=G),P.classList.toggle("disabled",G);}function ee(le,we={}){const Ie=k.value;k.value=le??"",we.notify&&Ie!==le&&W(te);}function U(){return k.value}function X(){k.focus();}function D(){k.blur();}function j(le){k.placeholder=le;}function Q(le){ee("",le);}return ie(G),H(_),a&&X(),{root:P,input:k,getValue:U,setValue:ee,focus:X,blur:D,setDisabled:ie,setPlaceholder:j,clear:Q,setLoading:H,setIconLeft(le){O.replaceChildren();const we=od(le??"🔎");we&&O.appendChild(we);},setIconRight(le){I.replaceChildren();const we=od(le??"");we&&I.appendChild(we);}}}function B$(e){const t=String(e??"").trim().toLowerCase();return t?t==="common"?"Common":t==="uncommon"?"Uncommon":t==="rare"?"Rare":t==="legendary"?"Legendary":t==="mythical"?"Mythical":t==="divine"?"Divine":t==="celestial"?"Celestial":t==="unknown"||t==="unknow"?"Unknown":null:null}function j$(e){return e.toLowerCase()}function ts(e={}){const{id:t,label:n="",type:r="neutral",tone:o="soft",border:i,withBorder:a,pill:s=true,size:l="md",onClick:c,variant:d="default",rarity:u=null,abilityId:f="",abilityName:g=""}=e,h=x("span",{className:"badge",id:t});s&&h.classList.add("badge--pill"),l==="sm"?h.classList.add("badge--sm"):l==="lg"?h.classList.add("badge--lg"):h.classList.add("badge--md"),c&&h.addEventListener("click",c);let y=false,S=a;function C(){y||(S===false?h.style.border="none":h.style.border="");}function _(A,L=o){h.classList.remove("badge--neutral","badge--info","badge--success","badge--warning","badge--danger","badge--soft","badge--outline","badge--solid"),h.classList.add(`badge--${A}`,`badge--${L}`),C();}function E(A){const L=(A??"").trim();L?(h.style.border=L,y=true):(y=false,C());}function P(A){S=A,C();}function O(A){h.textContent=A;}function k(A,L=o){_(A,L);}function I(A){h.classList.remove("badge--rarity","badge--rarity-common","badge--rarity-uncommon","badge--rarity-rare","badge--rarity-legendary","badge--rarity-mythical","badge--rarity-divine","badge--rarity-celestial","badge--rarity-unknown"),h.style.background="",h.style.backgroundSize="",h.style.animation="",h.style.color="",h.style.webkitTextStroke="";const L=B$(A);if(!L){h.textContent=String(A??"—");return}h.textContent=L,h.classList.add("badge--rarity",`badge--rarity-${j$(L)}`);}function R(A,L){const G=ue.get("abilities")?.[A],q=G?.color,H=q?.bg||"rgba(100, 100, 100, 0.9)",ce=q?.hover||"rgba(150, 150, 150, 1)";h.classList.remove("badge--neutral","badge--info","badge--success","badge--warning","badge--danger","badge--soft","badge--outline","badge--solid","badge--rarity","badge--rarity-common","badge--rarity-uncommon","badge--rarity-rare","badge--rarity-legendary","badge--rarity-mythical","badge--rarity-divine","badge--rarity-celestial","badge--rarity-unknown"),h.classList.add("badge--ability"),h.textContent=L||G?.name||A||"Unknown Ability",h.style.background=H,h.style.color="white",h.style.border="none",h.style.webkitTextStroke="",h.style.animation="",h.style.backgroundSize="";const W=()=>{h.style.background=ce;},te=()=>{h.style.background=H;};h.removeEventListener("mouseenter",W),h.removeEventListener("mouseleave",te),h.addEventListener("mouseenter",W),h.addEventListener("mouseleave",te);}return d==="rarity"?I(u):d==="ability"?R(f,g):(h.textContent=n,_(r,o),typeof a=="boolean"&&P(a),i&&E(i)),{root:h,setLabel:O,setType:k,setBorder:E,setWithBorder:P,setRarity:I,setAbility:R}}const G$={expanded:false,sort:{key:null,dir:null},search:""},z$={categories:{}};async function U$(){const e=await co("tab-test",{version:2,defaults:z$,sanitize:i=>({categories:i.categories&&typeof i.categories=="object"?i.categories:{}})});function t(i){return e.get().categories[i]||{...G$}}function n(i,a){const s=e.get(),l=t(i);e.update({categories:{...s.categories,[i]:{...l,expanded:a}}});}function r(i,a,s){const l=e.get(),c=t(i);e.update({categories:{...l.categories,[i]:{...c,sort:{key:a,dir:s}}}});}function o(i,a){const s=e.get(),l=t(i);e.update({categories:{...s.categories,[i]:{...l,search:a}}});}return {get:e.get,set:e.set,save:e.save,getCategoryState:t,setCategoryExpanded:n,setCategorySort:r,setCategorySearch:o}}const H$={Common:1,Uncommon:2,Rare:3,Legendary:4,Mythical:5,Divine:6,Celestial:7};function id(e){return e?H$[e]??0:0}class W$ extends pr{constructor(){super({id:"tab-test",label:"Test"});de(this,"stateCtrl",null);}async build(n){this.stateCtrl=await U$();const r=this.createContainer("test-section");r.style.display="flex",r.style.flexDirection="column",r.style.gap="12px",n.appendChild(r),await this.buildSpriteTables(r);}renderSprite(n){const r=x("div",{style:"display:flex;align-items:center;justify-content:center;width:32px;height:32px;"});if(n.spriteId){const o=n.spriteId;requestAnimationFrame(()=>{try{const i=me.toCanvas(o,{scale:1});i.style.maxWidth="32px",i.style.maxHeight="32px",i.style.objectFit="contain",r.appendChild(i);}catch{r.textContent="-";}});}else r.textContent="-";return r}renderRarity(n){if(!n.rarity){const o=x("span",{style:"opacity:0.5;"});return o.textContent="—",o}return ts({variant:"rarity",rarity:n.rarity,size:"sm"}).root}createDataCard(n,r,o,i){const a=this.stateCtrl.getCategoryState(n),s=f=>{if(!f)return o;const g=f.toLowerCase();return o.filter(h=>h.name.toLowerCase().includes(g))},l=Za({columns:i,data:s(a.search),pageSize:0,compact:true,maxHeight:"calc(var(--lg-row-h, 40px) * 6)",getRowId:f=>f.spriteId,onSortChange:(f,g)=>{this.stateCtrl.setCategorySort(n,f,g);}});a.sort.key&&a.sort.dir&&l.sortBy(a.sort.key,a.sort.dir);const c=es({placeholder:"Search...",value:a.search,debounceMs:150,withClear:true,size:"sm",focusKey:"",onChange:f=>{const g=f.trim();this.stateCtrl.setCategorySearch(n,g),l.setData(s(g));}}),d=x("div",{style:"margin-bottom:8px;"});d.appendChild(c.root);const u=x("div");return u.appendChild(d),u.appendChild(l.root),dt({title:r,subtitle:`${o.length} entries`,variant:"soft",padding:"sm",expandable:true,defaultExpanded:a.expanded,onExpandChange:f=>{this.stateCtrl.setCategoryExpanded(n,f);}},u)}formatCategoryName(n){return n.split("-").map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" ")}findPlantBySprite(n,r){const o=ue.get("plants");if(!o)return null;for(const a of Object.values(o))if(a?.seed?.spriteId===n||a?.plant?.spriteId===n||a?.crop?.spriteId===n)return a;const i=r.toLowerCase();for(const a of Object.values(o)){const s=(a?.seed?.name||"").toLowerCase();if(s===i||s===`${i} seed`)return a}return null}findPetBySpriteId(n){const r=ue.get("pets");if(!r)return null;for(const o of Object.values(r))if(o?.spriteId===n)return o;return null}findItemBySpriteId(n){const r=ue.get("items");if(!r)return null;for(const o of Object.values(r))if(o?.spriteId===n)return o;return null}findDecorBySpriteId(n){const r=ue.get("decor");if(!r)return null;for(const o of Object.values(r))if(o?.spriteId===n)return o;return null}findEggBySpriteId(n){const r=ue.get("eggs");if(!r)return null;for(const o of Object.values(r))if(o?.spriteId===n)return o;return null}getRarityForSprite(n,r,o){const i=n.toLowerCase();if(i==="plant"||i==="seed"||i==="tallplant"){const a=this.findPlantBySprite(r,o);if(a?.seed?.rarity)return a.seed.rarity}if(i==="pet"){const a=this.findPetBySpriteId(r);if(a?.rarity)return a.rarity}if(i==="item"){const a=this.findItemBySpriteId(r);if(a?.rarity)return a.rarity}if(i==="decor"){const a=this.findDecorBySpriteId(r);if(a?.rarity)return a.rarity}if(i==="egg"){const a=this.findEggBySpriteId(r);if(a?.rarity)return a.rarity}return null}yieldToMain(n=0){return new Promise(r=>{n>0?setTimeout(r,n):typeof requestIdleCallback<"u"?requestIdleCallback(()=>r(),{timeout:50}):setTimeout(r,4);})}async buildSpriteTables(n){const r=[{key:"name",header:"Name",sortable:true,width:"1fr",sortFn:(i,a)=>i.name.localeCompare(a.name,void 0,{numeric:true,sensitivity:"base"})},{key:"rarity",header:"Rarity",sortable:true,width:"100px",align:"center",render:i=>this.renderRarity(i),sortFn:(i,a)=>id(i.rarity)-id(a.rarity)},{key:"sprite",header:"Sprite",width:"60px",align:"center",render:i=>this.renderSprite(i)}];if(!me.isReady())try{await me.init();}catch{return}const o=me.getCategories();for(let i=0;i<o.length;i++){await this.yieldToMain(8);const a=o[i],l=me.getCategoryId(a).map(c=>{const d=`sprite/${a}/${c}`;return {name:c,spriteId:d,rarity:this.getRarityForSprite(a,d,c)}});if(l.sort((c,d)=>id(c.rarity)-id(d.rarity)),l.length>0){const c=this.createDataCard(a,this.formatCategoryName(a),l,r);n.appendChild(c);}}}}function wt(e,t,n){if(e.querySelector(`style[data-style-id="${n}"]`))return;const r=document.createElement("style");r.setAttribute("data-style-id",n),r.textContent=t,e.appendChild(r);}const r_=`
  /* Themed scrollbar using CSS variables */
  #auto-favorite-settings .selection-grid::-webkit-scrollbar {
    width: 6px;
  }
  #auto-favorite-settings .selection-grid::-webkit-scrollbar-track {
    background: transparent;
  }
  #auto-favorite-settings .selection-grid::-webkit-scrollbar-thumb {
    background: var(--scrollbar-thumb, rgba(255,255,255,0.2));
    border-radius: 3px;
  }
  #auto-favorite-settings .selection-grid::-webkit-scrollbar-thumb:hover {
    background: var(--scrollbar-thumb-hover, rgba(255,255,255,0.3));
  }

  /* Game-style checkbox using theme variables */
  #auto-favorite-settings .game-checkbox {
    appearance: none;
    width: 18px;
    height: 18px;
    border: 2px solid color-mix(in oklab, var(--tab-bg) 60%, transparent);
    border-radius: 3px;
    background: var(--bg);
    cursor: pointer;
    position: relative;
    transition: all 0.2s;
  }

  #auto-favorite-settings .game-checkbox:hover {
    border-color: var(--accent);
    box-shadow: 0 0 4px color-mix(in oklab, var(--accent) 40%, transparent);
  }

  #auto-favorite-settings .game-checkbox:checked {
    background: linear-gradient(135deg, var(--tab-bg) 0%, var(--accent) 100%);
    border-color: var(--accent);
  }

  #auto-favorite-settings .game-checkbox:checked::after {
    content: '✓';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: var(--bg);
    font-size: 14px;
    font-weight: bold;
  }

  /* Item row using theme variables */
  #auto-favorite-settings .item-row {
    background: color-mix(in oklab, var(--tab-bg) 8%, transparent);
    border: 1px solid color-mix(in oklab, var(--tab-bg) 20%, transparent);
    transition: all 0.15s ease;
  }

  #auto-favorite-settings .item-row:hover {
    background: color-mix(in oklab, var(--tab-bg) 15%, transparent);
    border-color: var(--accent);
    transform: translateX(2px);
  }

  #auto-favorite-settings .item-row.checked {
    background: color-mix(in oklab, var(--accent) 12%, transparent);
    border-color: var(--accent);
  }

  /* Responsive Mutation Rows - Fluid Flexbox */
  #auto-favorite-settings .mut-row {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 8px;
    width: 100%;
  }

  #auto-favorite-settings .mut-btn {
    flex: 1 1 130px;
    min-width: 0; /* Allow shrinking below content size */
  }

  /* Base mutation button (inactive state) */
  .mut-btn {
    padding: 8px 12px;
    min-height: 52px;
    border-radius: var(--card-radius, 12px);
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    background: color-mix(in oklab, var(--bg) 12%, transparent);
    border: 2px solid color-mix(in oklab, var(--border) 40%, transparent);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    box-shadow: none;
    opacity: 0.8;
    width: 100%;
  }

  /* Active state - full opacity */
  .mut-btn.active {
    opacity: 1;
  }

  /* Rainbow mutation - special gradient */
  .mut-btn--rainbow.active {
    background: linear-gradient(
      135deg,
      rgba(255, 0, 0, 0.3) 0%,
      rgba(255, 165, 0, 0.3) 20%,
      rgba(255, 255, 0, 0.3) 40%,
      rgba(0, 128, 0, 0.3) 60%,
      rgba(0, 0, 255, 0.3) 80%,
      rgba(75, 0, 130, 0.3) 100%
    );
    border-color: #fff9c4;
    box-shadow: 0 4px 18px rgba(255, 255, 255, 0.25);
  }

  /* Gold mutation */
  .mut-btn--gold.active {
    background: color-mix(in oklab, var(--mut-gold) 25%, transparent);
    border-color: var(--mut-gold);
    box-shadow: 0 4px 12px color-mix(in oklab, var(--mut-gold) 30%, transparent);
  }

  /* Wet mutation */
  .mut-btn--wet.active {
    background: color-mix(in oklab, var(--mut-wet) 25%, transparent);
    border-color: var(--mut-wet);
    box-shadow: 0 4px 12px color-mix(in oklab, var(--mut-wet) 30%, transparent);
  }

  /* Chilled mutation */
  .mut-btn--chilled.active {
    background: color-mix(in oklab, var(--mut-chilled) 25%, transparent);
    border-color: var(--mut-chilled);
    box-shadow: 0 4px 12px color-mix(in oklab, var(--mut-chilled) 30%, transparent);
  }

  /* Frozen mutation */
  .mut-btn--frozen.active {
    background: color-mix(in oklab, var(--mut-frozen) 25%, transparent);
    border-color: var(--mut-frozen);
    box-shadow: 0 4px 12px color-mix(in oklab, var(--mut-frozen) 30%, transparent);
  }

  /* Dawnlit mutation */
  .mut-btn--dawnlit.active {
    background: color-mix(in oklab, var(--mut-dawnlit) 25%, transparent);
    border-color: var(--mut-dawnlit);
    box-shadow: 0 4px 12px color-mix(in oklab, var(--mut-dawnlit) 30%, transparent);
  }

  /* Dawncharged mutation */
  .mut-btn--dawncharged.active {
    background: color-mix(in oklab, var(--mut-dawncharged) 25%, transparent);
    border-color: var(--mut-dawncharged);
    box-shadow: 0 4px 12px color-mix(in oklab, var(--mut-dawncharged) 30%, transparent);
  }

  /* Ambershine mutation */
  .mut-btn--ambershine.active {
    background: color-mix(in oklab, var(--mut-ambershine) 25%, transparent);
    border-color: var(--mut-ambershine);
    box-shadow: 0 4px 12px color-mix(in oklab, var(--mut-ambershine) 30%, transparent);
  }

  /* Ambercharged mutation */
  .mut-btn--ambercharged.active {
    background: color-mix(in oklab, var(--mut-ambercharged) 25%, transparent);
    border-color: var(--mut-ambercharged);
    box-shadow: 0 4px 12px color-mix(in oklab, var(--mut-ambercharged) 30%, transparent);
  }
`,V$={enabled:false,favoriteProduceList:[],favoritePetsList:[],favoriteMutations:[]};let ai=null;async function q$(){if(ai)return ai;ai=await co("tab-auto-favorite",{version:1,defaults:V$});const e=Xe(lt.AUTO_FAVORITE_UI,null);return e&&(await ai.set(e),TA(lt.AUTO_FAVORITE_UI),console.log("[AutoFavoriteSettings] Migrated old storage to new state")),ai}function tr(){if(!ai)throw new Error("[AutoFavoriteSettings] Section state not initialized. Call initSectionState() first.");return ai}const Eb=lt.AUTO_FAVORITE,o_={enabled:false,mode:"simple",simple:{enabled:false,favoriteSpecies:[],favoriteMutations:[]}};function Oi(){return Xe(Eb,o_)}function Ab(e){Ye(Eb,e);}function i_(e){const n={...Oi(),...e};return Ab(n),n}function Tb(e){const t=Oi();return t.mode="simple",t.simple={...t.simple,...e},Ab(t),t}function K$(e){Tb({favoriteSpecies:e});}function X$(e){Tb({favoriteMutations:e});}function d0(){return Oi().enabled}let Yd=null;const dl=new Set;function yg(){const e=Oi();if(!e.enabled){console.log("[AutoFavorite] Disabled");return}dl.clear(),Yd=En().subscribeItems(t=>{if(t.added.length>0){const n=Oi();for(const r of t.added)J$(r,n);}}),console.log(`✅ [AutoFavorite] Started - Watching ${e.simple.favoriteSpecies.length} species, ${e.simple.favoriteMutations.length} mutations`);}function a_(){Yd&&(Yd(),Yd=null),dl.clear(),console.log("🛑 [AutoFavorite] Stopped");}function Y$(e){const t=Oi();t.enabled=e,t.simple.enabled=e,i_(t),e?yg():a_();}function J$(e,t){if(e.itemType!=="Produce"&&e.itemType!=="Pet")return;if(!e.id){console.warn("[AutoFavorite] Item has no ID:",e);return}if(!(dl.has(e.id)||e.isFavorited||e.favorited)&&s_(e,t.simple)){dl.add(e.id);try{Ap(e.id),console.log(`[AutoFavorite] ⭐ Favorited ${e.itemType}: ${e.species||e.id}`);}catch(r){console.error("[AutoFavorite] WebSocket error:",r),dl.delete(e.id);}}}function s_(e,t){if(!t.enabled)return  false;const n=e.itemType==="Pet"?e.petSpecies:e.species;return n?!!(t.favoriteSpecies.includes(n)||t.favoriteMutations.length>0&&(e.mutations||[]).some(o=>t.favoriteMutations.includes(o))):false}function Q$(){return Object.keys(ue.get("mutations")??{})}const l_={init(){this.isReady()||yg();},isReady(){return d0()},DEFAULT_CONFIG:o_,STORAGE_KEY:Eb,loadConfig:Oi,saveConfig:Ab,updateConfig:i_,updateSimpleConfig:Tb,setFavoriteSpecies:K$,setFavoriteMutations:X$,isEnabled:d0,start:yg,stop:a_,setEnabled:Y$,shouldFavorite:s_,getGameMutations:Q$};let ah=null,u0=null;function c_(){try{return Sb().get().myPlayer?.journal||null}catch{return null}}function Z$(e){return e?`pro:${Object.keys(e.produce).length}-pet:${Object.keys(e.pets).length}`:"null"}function d_(){return ["Normal",...Object.keys(ue.get("mutations")??{}),"Max Weight"]}function u_(){const e=ue.get("mutations")??{},t=[];for(const[n,r]of Object.entries(e))(r?.baseChance??0)>0&&!r?.tileRef&&t.push({id:n,chance:r.baseChance});return t.sort((n,r)=>r.chance-n.chance),["Normal",...t.map(n=>n.id),"Max Weight"]}function eD(){return Object.keys(ue.get("mutations")??{})}function p_(e){const n=(ue.get("pets")??{})[e];if(!n?.innateAbilityWeights||typeof n.innateAbilityWeights!="object")return [];const r=n.innateAbilityWeights,o=["RainbowGranter","GoldGranter"];return Object.keys(r).filter(i=>!o.includes(i))}function f_(e){const t=ue.get("plants")??{},n=Object.keys(t),r=d_(),o=e?.produce??{},i=[];let a=0;for(const c of n){const u=o[c]?.variantsLogged?.map(g=>g.variant)??[],f=r.filter(g=>!u.includes(g));a+=u.length,i.push({species:c,variantsLogged:u,variantsMissing:f,variantsTotal:r.length,variantsPercentage:r.length>0?u.length/r.length*100:0,isComplete:f.length===0});}const s=n.length*r.length,l=i.filter(c=>c.variantsLogged.length>0).length;return {total:n.length,logged:l,percentage:n.length>0?l/n.length*100:0,speciesDetails:i,variantsTotal:s,variantsLogged:a,variantsPercentage:s>0?a/s*100:0}}function h_(e){const t=ue.get("pets")??{},n=Object.keys(t),r=u_(),o=e?.pets??{},i=[];let a=0,s=0,l=0,c=0;for(const u of n){const f=o[u],g=f?.variantsLogged?.map(E=>E.variant)??[],h=f?.abilitiesLogged?.map(E=>E.ability)??[],y=r.filter(E=>!g.includes(E)),S=p_(u),C=h.filter(E=>S.includes(E)),_=S.filter(E=>!C.includes(E));s+=r.length,a+=g.length,c+=S.length,l+=Math.min(C.length,S.length),i.push({species:u,variantsLogged:g,variantsMissing:y,variantsTotal:r.length,variantsPercentage:r.length>0?g.length/r.length*100:0,abilitiesLogged:C,abilitiesMissing:_,abilitiesTotal:S.length,abilitiesPercentage:S.length>0?C.length/S.length*100:0,isComplete:y.length===0&&(S.length===0||_.length===0)});}const d=i.filter(u=>u.variantsLogged.length>0).length;return {total:n.length,logged:d,percentage:n.length>0?d/n.length*100:0,speciesDetails:i,variantsTotal:s,variantsLogged:a,variantsPercentage:s>0?a/s*100:0,abilitiesTotal:c,abilitiesLogged:l,abilitiesPercentage:c>0?l/c*100:0}}async function Np(e=false){await ue.waitForAny();const t=c_(),n=Z$(t);if(!e&&ah&&n===u0)return ah;const r={plants:f_(t),pets:h_(t),lastUpdated:Date.now()};return ah=r,u0=n,r}async function tD(){const e=await Np();return {plants:e.plants.speciesDetails.filter(t=>t.variantsMissing.length>0).map(t=>({species:t.species,missing:t.variantsMissing})),pets:e.pets.speciesDetails.filter(t=>t.variantsMissing.length>0||(t.abilitiesMissing?.length??0)>0).map(t=>({species:t.species,missingVariants:t.variantsMissing,missingAbilities:t.abilitiesMissing??[]}))}}let ul=null,wg=false;function nD(){wg||(wg=true,ul||(ul=setInterval(async()=>{const e=await Np();Ib(e);},3e4)),console.log("[Journal] Started"));}function rD(){ul&&(clearInterval(ul),ul=null),wg=false;}function Ib(e){window.dispatchEvent(new CustomEvent("gemini:journal-updated",{detail:e}));}async function oD(){const e=await Np();return Ib(e),e}function iD(e){try{const t=Lt.getMyJournal();if(!t?.pets)return [];const n=t.pets[e];return n?.abilitiesLogged?n.abilitiesLogged.map(r=>r.ability):[]}catch(t){return console.error("[AbilitiesInject] Failed to get logged abilities:",t),[]}}function aD(e,t){try{const n=Lt.getMyJournal();if(!n?.pets)return;const r=n.pets[e];return r?.abilitiesLogged?r.abilitiesLogged.find(i=>i.ability===t)?.createdAt:void 0}catch(n){console.error("[AbilitiesInject] Failed to get ability log date:",n);return}}function Pb(e){try{const t=ue.getAll();if(!t?.pets)return [];const n=t.pets[e];if(!n)return [];if(n.innateAbilityWeights&&typeof n.innateAbilityWeights=="object"){const r=n.innateAbilityWeights,o=["RainbowGranter","GoldGranter"];return Object.entries(r).filter(([i])=>!o.includes(i)).sort(([,i],[,a])=>a-i).map(([i])=>i)}return []}catch(t){return console.error("[AbilitiesInject] Failed to get all abilities:",t),[]}}function sD(e){try{const t=ue.getAll();if(!t?.abilities)return e;const n=t.abilities[e];if(!n)return e;const r=n.name;if(typeof r=="string")return r;const o=n.displayName;return typeof o=="string"?o:e}catch(t){return console.error("[AbilitiesInject] Failed to get ability name:",t),e}}function Rb(e){try{const t=["RainbowGranter","GoldGranter"],n=iD(e),r=Pb(e),o=n.filter(l=>!t.includes(l)),i=r.filter(l=>!o.includes(l)),a=r.length,s=a>0?o.length/a*100:0;return {logged:o,missing:i,total:a,percentage:s}}catch(t){return console.error("[AbilitiesInject] Failed to calculate progress:",t),{logged:[],missing:[],total:0,percentage:0}}}function lD(e){const t=new Date(e),n=t.toLocaleDateString("en-US",{month:"short"}),r=t.getDate(),o=t.getFullYear();return `${n} ${r}, ${o}`}function cD(e){const n=ue.get("abilities")?.[e];return {bg:n?.color?.bg||"rgba(100, 100, 100, 0.9)",hover:n?.color?.hover||"rgba(150, 150, 150, 1)"}}function dD(e,t,n,r){const o=n?aD(e,t):void 0,i=document.createElement("div");i.className="gemini-ability-entry",i.style.cssText=`
    display: grid;
    grid-template-rows: 1fr auto;
    gap: 8px;
    align-items: center;
    justify-items: center;
  `;const a=r?"80px":"100px",s=document.createElement("div");if(s.className="gemini-ability-stamp",o){const c=`Logged on ${lD(o)}`;s.style.cursor="help";let d=null;s.addEventListener("mouseenter",()=>{d=document.createElement("div"),d.textContent=c,d.style.cssText=`
        position: fixed;
        background: rgba(45, 35, 28, 0.95);
        color: var(--fg);
        font-size: 11px;
        padding: 8px 12px;
        border-radius: 6px;
        z-index: 10000;
        pointer-events: none;
        box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        white-space: nowrap;
        transform: scale(0.95);
        opacity: 0;
        transition: opacity 0.1s ease, transform 0.1s ease;
      `,document.body.appendChild(d);const u=s.getBoundingClientRect(),f=d.offsetHeight,g=d.offsetWidth;let h=u.left+u.width/2-g/2,y=u.top-f-8;y<8&&(y=u.bottom+8),h<8&&(h=8),h+g>window.innerWidth-8&&(h=window.innerWidth-g-8),d.style.left=`${h}px`,d.style.top=`${y}px`,requestAnimationFrame(()=>{d&&(d.style.opacity="1",d.style.transform="scale(1)");});}),s.addEventListener("mouseleave",()=>{d&&(d.remove(),d=null);});}const l=zx();l||console.error("[AbilitiesInject] Base URL not available - modules may not be initialized"),s.style.cssText=`
    position: relative;
    width: ${a};
    height: ${a};
    display: flex;
    align-items: center;
    justify-content: center;
    ${l?`background-image: url(${l}ui/Stamp.webp);`:""}
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
  `;try{const c=me.toCanvas("pet",e,{scale:.7,boundsMode:"padded"});if(c){const d=r?"56px":"70px";c.style.position="absolute",c.style.top="50%",c.style.left="50%",c.style.transform="translate(-50%, -50%)",c.style.width=d,c.style.height=d,c.style.objectFit="contain",c.style.imageRendering="pixelated",c.style.zIndex="1",n||(c.style.filter="grayscale(1) brightness(0.16)"),s.appendChild(c);}else {const d=document.createElement("div");d.textContent="ðŸ¾",d.style.fontSize="32px",d.style.position="absolute",d.style.top="50%",d.style.left="50%",d.style.transform="translate(-50%, -50%)",d.style.zIndex="1",s.appendChild(d);}}catch(c){console.warn("[AbilitiesInject] Failed to load pet sprite:",e,c);const d=document.createElement("div");d.textContent="ðŸ¾",d.style.fontSize="32px",d.style.position="absolute",d.style.top="50%",d.style.left="50%",d.style.transform="translate(-50%, -50%)",d.style.zIndex="1",s.appendChild(d);}if(n){const c=sD(t),d=cD(t),u=document.createElement("div");u.className="gemini-ability-badge",u.textContent=c,u.style.cssText=`
      background: ${d.bg};
      color: white;
      padding: 4px;
      border-radius: 10px;
      min-width: ${r?"80px":"90px"};
      width: auto;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: ${r?"12px":"14px"};
      font-weight: bold;
      text-align: center;
    `,i.appendChild(s),i.appendChild(u);}else {const c=document.createElement("div");c.className="gemini-ability-badge",c.style.cssText=`
      background: var(--paper, var(--soft));
      padding: 4px;
      border-radius: 10px;
      min-width: ${r?"80px":"90px"};
      width: auto;
      display: flex;
      align-items: center;
      justify-content: center;
    `;const d=document.createElement("span");d.style.cssText=`
      font-size: ${r?"12px":"14px"};
      color: var(--fg);
      text-align: center;
      font-weight: normal;
      width: 100%;
    `,d.textContent="???",c.appendChild(d),i.appendChild(s),i.appendChild(c);}return i}function uD(e,t,n){return [...e.logged,...e.missing].map(o=>{const i=e.logged.includes(o);return dD(t,o,i,n)})}const ma="p.chakra-text.css-1qd26jh",Mb="p.chakra-text.css-12b1ql2";let Ua=[],xg=null,pl=null,Ol=false,ju=false;const p0="gemini-ability-entry";let Jd=false;const Ai="gemini-overview-updated";let sh=null;function pD(){const e=document.querySelector(ma);if(!e)return null;const t=e.textContent?.trim();if(!t||t==="???"||!document.querySelector(Mb))return null;const r=document.querySelectorAll("div.McGrid");let o=null;for(const i of r){const a=i.textContent||"",s=a.includes("Normal"),l=a.includes("Gold"),c=a.includes("Max Weight"),d=a.includes("Rainbow"),u=a.includes("???"),f=[s,l,c,d,u].filter(Boolean).length,g=a.includes("Crops")||a.includes("Pets"),h=a.includes("Collected"),y=a.includes("Back");if(f>=2&&!g&&!h&&!y){o=i;break}}return o?{speciesName:t,variantGrid:o}:null}function g_(e){const t=ue.get("pets")??{};for(const[r,o]of Object.entries(t)){const i=o;if(i.name===e||i.displayName===e||r===e)return r}const n=e.toLowerCase();for(const[r,o]of Object.entries(t)){const i=o,a=typeof i.name=="string"?i.name:void 0,s=typeof i.displayName=="string"?i.displayName:void 0;if(a&&a.toLowerCase()===n||s&&s.toLowerCase()===n||r.toLowerCase()===n)return r}return n.replace(/\s+/g,"")}function m_(e){const t=ue.get("pets")??{};return e in t}function Gu(){const e=document.querySelector(".gemini-journal-allTab");if(e){const o=e.querySelector(".gemini-allTab-tab");if(o instanceof HTMLElement&&o.offsetHeight>25)return "All"}const t=document.querySelectorAll("button");let n=null,r=null;for(const o of t){const i=o.textContent?.trim();i==="Crops"&&(n=o),i==="Pets"&&(r=o);}if(!n&&!r)return null;if(n&&r){const o=n.offsetHeight,i=r.offsetHeight;if(o>i)return "Crops";if(i>o)return "Pets";if(n.getAttribute("aria-selected")==="true")return "Crops";if(r.getAttribute("aria-selected")==="true")return "Pets"}return r&&r.offsetParent?"Pets":n&&n.offsetParent?"Crops":null}function b_(){if(!Array.from(document.querySelectorAll("p.chakra-text")).find(i=>i.textContent?.includes("GARDEN JOURNAL"))||!Array.from(document.querySelectorAll("p.chakra-text")).find(i=>i.textContent?.match(/Collected\s+\d+%/)))return  false;const n=document.querySelector(ma);return n&&!n.textContent?.includes("GARDEN")?false:Gu()==="Pets"}function fD(){const e=Array.from(document.querySelectorAll("p.chakra-text")).find(y=>y.textContent?.match(/Collected\s+\d+%/));if(!e||Gu()!=="Pets")return  false;if(e.classList.contains(Ai))return  true;const n=e.querySelector("span.chakra-text");if(!n)return  false;const r=n.textContent?.match(/\((\d+)\/(\d+)\)/);if(!r)return  false;const o=parseInt(r[1],10),i=parseInt(r[2],10),a=ue.get("pets")??{},s=Object.keys(a).length*4,l=s*.25;if(Math.abs(i-s)>l)return  false;if(!e.hasAttribute("data-original-percent")){const y=e.textContent?.match(/Collected\s+(\d+)%/);y&&e.setAttribute("data-original-percent",y[1]);}n.hasAttribute("data-original-count")||n.setAttribute("data-original-count",n.textContent||"");let c=0,d=0;for(const y of Object.keys(a)){const S=Pb(y),C=Rb(y);c+=S.length,d+=C.logged.length;}const u=o+d,f=i+c,g=Math.floor(u/f*100),h=e.childNodes[0];return h&&h.nodeType===Node.TEXT_NODE&&(h.textContent=`Collected ${g}% `),n.textContent=`(${u}/${f})`,e.classList.add(Ai),true}function hD(){ue.get("pets");const e=document.querySelectorAll("p.chakra-text");for(const t of e){const n=t.textContent||"";if(!n.match(/^\d+\/\d+$/)||t.classList.contains(Ai))continue;const r=n.match(/^(\d+)\/(\d+)$/);if(!r)continue;const o=parseInt(r[1],10),i=parseInt(r[2],10);let a=null,s=t,l=false;for(;s&&!l;){if(s.classList.contains("McGrid")){const y=s.querySelectorAll("p.chakra-text");for(const S of y){const C=S.textContent||"";if(C!=="???"&&!C.includes("/")&&C.length>2&&C.length<30){a=S,l=true;break}}}s=s.parentElement;}if(!a)continue;const c=a.textContent?.trim();if(!c)continue;const d=g_(c);if(!d||!m_(d))continue;const u=Pb(d),f=Rb(d);if(u.length===0)continue;const g=o+f.logged.length,h=i+u.length;t.textContent=`${g}/${h}`,t.classList.add(Ai);}}function gD(){if(!b_()){Jd=false;return}if(!Jd)try{const e=fD();hD(),e&&(Jd=!0);}catch(e){console.error("[AbilitiesInject] Failed to update overview page:",e);}}function Cg(){const e=Array.from(document.querySelectorAll("p.chakra-text")).find(t=>t.hasAttribute("data-original-percent"));if(e){const t=e.getAttribute("data-original-percent");if(t){const r=e.childNodes[0];r&&r.nodeType===Node.TEXT_NODE&&(r.textContent=`Collected ${t}% `);}e.removeAttribute("data-original-percent"),e.classList.remove(Ai);const n=e.querySelector("span.chakra-text");if(n){const r=n.getAttribute("data-original-count");r&&(n.textContent=r),n.removeAttribute("data-original-count");}}document.querySelectorAll(`.${Ai}`).forEach(t=>{t.classList.remove(Ai);}),Jd=false;}function mD(){return window.innerWidth<768}function bD(e,t){const n=document.querySelector(Mb);if(!n)return;const r=n.textContent?.match(/Collected (\d+)\/(\d+)/);if(!r)return;const o=parseInt(r[1],10),i=parseInt(r[2],10),a=o+e,s=i+t;n.textContent=`Collected ${a}/${s}`;}function vD(e,t){try{ju=!0,Vr();const n=Rb(t);if(n.total===0)return;const r=uD(n,t,mD());for(const o of r)e.appendChild(o),Ua.push(o);bD(n.logged.length,n.total),Ws={logged:n.logged.length,total:n.total};}catch(n){console.error("[AbilitiesInject] Failed to inject:",n),Vr();}finally{setTimeout(()=>{ju=false;},0);}}function yD(e,t){const n=document.querySelector(Mb);if(!n)return;const r=n.textContent?.match(/Collected (\d+)\/(\d+)/);if(!r)return;const o=parseInt(r[1],10),i=parseInt(r[2],10),a=o-e,s=i-t;n.textContent=`Collected ${a}/${s}`;}let Ws=null;function Vr(){Ws&&(yD(Ws.logged,Ws.total),Ws=null);for(const e of Ua)e.remove();Ua=[],xg=null,ju=false;}function ei(){if(ju)return;const e=Gu();e!==sh&&(sh==="Pets"&&e!=="Pets"&&(Cg(),Vr()),sh=e);const t=Gu();if(b_()&&t==="Pets"){Vr(),gD();return}Cg();const n=pD();if(!n){Vr();return}const r=g_(n.speciesName);if(!r){Vr();return}if(!m_(r)){Vr();return}r===xg&&Ua.length>0&&Ua[0].isConnected||(xg=r,vD(n.variantGrid,r));}function wD(){ei(),setTimeout(()=>{ei();},100),setTimeout(()=>{ei();},500),setTimeout(()=>{ei();},1e3),pl=new MutationObserver(e=>{for(const t of e)t.type==="childList"&&(t.addedNodes.forEach(n=>{if(n instanceof HTMLElement){if(n.classList.contains(p0)||Ua.includes(n))return;const r=n.textContent||"";(r.includes("GARDEN JOURNAL")||r.includes("Collected")||r.includes("Chicken")||r.includes("Bunny"))&&ei(),(n.matches?.(ma)||n.querySelector?.(ma))&&ei(),(n.matches?.("div.McGrid")||n.querySelector?.("div.McGrid"))&&ei();}}),t.removedNodes.forEach(n=>{if(n instanceof HTMLElement){if(n.classList.contains(p0))return;(n.matches?.(ma)||n.querySelector?.(ma))&&Vr();}}));}),pl.observe(document.body,{childList:true,subtree:true});}function xD(){pl&&(pl.disconnect(),pl=null),Vr(),Cg();}function CD(){Ol||(Ol=true,wD());}function SD(){Ol&&(Ol=false,xD());}function _D(){return Ol}const kD={init:CD,destroy:SD,isEnabled:_D};function Tt(){const e=[];return {add(t){e.push(t);},run(){for(const t of e)try{t();}catch(n){console.warn("[CleanupTracker] Error during cleanup:",n);}},clear(){e.length=0;}}}function Fo(e,t){e.add(()=>t.disconnect());}let Qd=false;function Bo(){return Qd}function gn(e){if(!Qd){Qd=true;try{e();}finally{Qd=false;}}}const ED={Normal:"Normal: Harvest a {cropName} and log it without any mutations.",Wet:"Wet is the most common mutation, gained during the Rain weather event.",Chilled:"The Chilled mutation is gained during the Snow weather event.",Frozen:"The Frozen mutation is obtained from Wet crops during the Snow weather event, or Chilled crops during Rain.",Dawnlit:"The Dawnlit mutation is gained during the Dawn weather event.",Ambershine:"The Amberlit mutation is gained during the Amber Moon weather event.",Thunderstruck:"The Thunderstruck mutation is gained during the Thunderstorm weather event.",Gold:"Gold is a rare mutation that appears in 1% of newly planted crops. Pets with the Gold Granter ability have a small chance to apply the Gold mutation to a random crop.",Rainbow:"Rainbow is a very rare mutation that appears in 0.1% of newly planted crops.  Pets with the Rainbow Granter ability have a small chance to apply the Rainbow mutation to a random crop.",Dawncharged:"Dawnbound: During the Dawn lunar event, place a {cropName} with the Dawnlit mutation adjacent to a Dawnbinder crop.",Ambercharged:"Amberbound: During the Amber Moon lunar event, place a {cropName} with the Amberlit mutation adjacent to a Moonbinder crop.","Max Weight":"Max weight applies only to size 100 crops (the largest possible). The size of a crop can be checked by hovering over its weight. Obtaining weight 100 crops can be achieved through Crop Size Boost pets."},AD={Normal:"Hatch a {petName} without any mutations",Gold:"All pets have a 1% base chance to hatch with the gold mutation; increase these chances with the Pet Mutation Boost abilities.",Rainbow:"All pets have a 0.1% base chance to hatch with the rainbow mutation; increase these chances with the Pet Mutation Boost abilities.","Max Weight":"Hatch a {petName} with a Max STR of 100, using Max Strength Boost ability is recommended while hatching"},TD={CommonEgg:["Worm","Snail","Bee"],UncommonEgg:["Chicken","Bunny","Dragonfly"],RareEgg:["Pig","Cow","Turkey"],WinterEgg:["SnowFox","Stoat","WhiteCaribou"],LegendaryEgg:["Squirrel","Turtle","Goat"],MythicalEgg:["Butterfly","Peacock","Capybara"]},ID={CommonEgg:"Common Eggs",UncommonEgg:"Uncommon Eggs",RareEgg:"Rare Eggs",WinterEgg:"Winter Eggs",LegendaryEgg:"Legendary Eggs",MythicalEgg:"Mythical Eggs"};function PD(e){for(const[t,n]of Object.entries(TD))if(n.includes(e))return ID[t]||t;return "Eggs"}function RD(e){return `Keep hatching ${PD(e)} to get a pet with this ability`}function MD(e,t){const n=ED[e];return n?n.replace(/\{cropName\}/g,t):`Obtain a ${e} ${t}`}function LD(e,t){const n=AD[e];return n?n.replace(/\{petName\}/g,t):`Obtain a ${e} ${t}`}let Zd=null;function OD(e){const t=document.createElement("div");return t.className="gemini-journal-hint",t.textContent=e,t.style.cssText=`
    position: fixed;
    background: var(--paper, rgba(45, 35, 28, 0.95));
    color: var(--fg);
    font-size: 11px;
    padding: 8px 12px;
    border-radius: 6px;
    max-width: 240px;
    z-index: 10000;
    pointer-events: none;
    box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    line-height: 1.4;
    opacity: 0;
    transform: scale(0.95);
    transition: opacity 0.1s ease, transform 0.1s ease;
    font-family: inherit;
    text-align: center;
  `,t}function ND(e,t){const n=t.getBoundingClientRect(),r=240,o=8;let i=n.left+n.width/2-r/2,a=n.top-40-o;i<8&&(i=8),i+r>window.innerWidth-8&&(i=window.innerWidth-r-8),a<8&&(a=n.bottom+o),e.style.left=`${i}px`,e.style.top=`${a}px`;}function f0(e,t){zu();const n=OD(t);document.body.appendChild(n),ND(n,e),requestAnimationFrame(()=>{n.style.opacity="1",n.style.transform="scale(1)";}),Zd=n;}function zu(){Zd&&(Zd.remove(),Zd=null);}function lo(e){const t=ue.get("plants")??{};for(const[o,i]of Object.entries(t)){const a=i;if(a?.crop?.name===e)return {id:o,type:"crop"};if(a?.plant?.name===e)return {id:o,type:"crop"};if(o===e)return {id:o,type:"crop"}}const n=ue.get("pets")??{};for(const[o,i]of Object.entries(n)){const a=i;if(a?.name===e)return {id:o,type:"pet"};if(a?.displayName===e)return {id:o,type:"pet"};if(o===e)return {id:o,type:"pet"}}const r=e.toLowerCase();for(const[o,i]of Object.entries(t)){const a=i;if(a?.crop?.name?.toLowerCase()===r)return {id:o,type:"crop"};if(a?.plant?.name?.toLowerCase()===r)return {id:o,type:"crop"};if(o.toLowerCase()===r)return {id:o,type:"crop"}}for(const[o,i]of Object.entries(n)){const a=i;if(a?.name?.toLowerCase()===r)return {id:o,type:"pet"};if(a?.displayName?.toLowerCase()===r)return {id:o,type:"pet"};if(o.toLowerCase()===r)return {id:o,type:"pet"}}return null}function $p(e,t){if(t==="crop"){const r=(ue.get("plants")??{})[e];return r?.crop?.name||r?.plant?.name||e}else {const r=(ue.get("pets")??{})[e];return r?.name||r?.displayName||e}}let eu=null,Vs=null,h0=-1;function $D(){const e=ue.get("mutations");return e?Object.keys(e).length:0}function v_(){const e=$D();e!==h0&&(eu=null,Vs=null,h0=e);}function DD(){const e=ue.get("mutations");if(!e)return ["Normal","Max Weight"];const t=[],n=[],r=[];for(const[o,i]of Object.entries(e)){const a=o.toLowerCase().endsWith("charged"),s=(i?.baseChance??0)>0&&!i?.tileRef,l=i?.tileRef?.index??1/0;a?r.push({id:o,index:l}):s?n.push({id:o,chance:i.baseChance}):t.push({id:o,index:l});}return t.sort((o,i)=>o.index-i.index),r.sort((o,i)=>o.index-i.index),n.sort((o,i)=>i.chance-o.chance),["Normal",...t.map(o=>o.id),...n.map(o=>o.id),...r.map(o=>o.id),"Max Weight"]}function FD(){return v_(),eu||(eu=DD()),eu}function y_(){if(v_(),Vs)return Vs;const e=ue.get("mutations"),t=[];if(e)for(const[n,r]of Object.entries(e))(r?.baseChance??0)>0&&!r?.tileRef&&t.push({id:n,chance:r.baseChance});return t.sort((n,r)=>r.chance-n.chance),Vs=["Normal",...t.map(n=>n.id),"Max Weight"],Vs}function BD(){return y_().length}let _a=Tt(),Ha=false;const w_="gemini-hint-attached";let fl=null;const jD="p.chakra-text.css-1qd26jh";function GD(e,t){const n=t==="crop"?"plants":"pets",r=ue.get(n);if(!r||!r[e])return e;const o=t==="crop"?"crop":"pet";return r[e][o]?.name||e}function zD(){const e=document.querySelector(jD);if(e){const n=e.textContent?.trim();if(n&&n!=="???"){const r=lo(n);if(r)return {displayName:n,id:r.id,type:r.type}}if(n==="???"&&fl)return {displayName:"???",id:fl.id,type:fl.type}}const t=document.querySelectorAll(".chakra-text, p, span");for(const n of t){const r=n.textContent?.trim();if(r&&r!=="???"&&!/^\d+\/\d+$/.test(r)&&!r.includes("%")&&!(r==="Crops"||r==="Pets"||r==="All")&&!(r.includes("GARDEN")||r.includes("JOURNAL"))&&!r.includes("Collected")&&r.length>=3&&r.length<=20){const o=lo(r);if(o)return {displayName:r,id:o.id,type:o.type}}}return null}function x_(){const e=document.querySelectorAll("button");for(const t of e){const n=t.textContent?.trim(),r=t.querySelector('[class*="MotionMcFlex"], .MotionMcFlex, div[style*="height: 35px"]');if(r&&r.offsetHeight>=30){if(n==="Crops")return "crops";if(n==="Pets")return "pets"}}return null}function UD(){const e=[],t=document.querySelectorAll("p"),n=document.querySelectorAll("span"),r=[...t,...n];for(const o of r){if(o.textContent?.trim()!=="???"||!o.offsetParent)continue;let a=o.parentElement,s=null;for(let l=0;l<4&&a&&!s;l++){const c=a.parentElement;if(!c)break;for(const d of Array.from(c.children)){if(!(d instanceof HTMLElement)||d===a)continue;const u=f=>{if(C_(f))return  true;for(const g of Array.from(f.children))if(g instanceof HTMLElement&&u(g))return  true;return  false};if(u(d)){s=c;break}}a=c;}s&&(s.classList.contains(w_)||e.push(s));}return e}function g0(e,t){return (t==="crops"?FD():y_())[e]??null}function C_(e){return e.style.backgroundImage&&e.style.backgroundImage.includes("Stamp")?true:window.getComputedStyle(e).backgroundImage.includes("Stamp")}function HD(e){let t=e.parentElement;for(let n=0;n<8&&t;n++){const r=t.querySelectorAll("div"),o=[];for(const i of r)C_(i)&&o.push(i);if(o.length>=4)return o;t=t.parentElement;}return []}function WD(e,t){let n=e.parentElement;for(let r=0;r<6&&n;r++){const o=[];for(const i of t)n.contains(i)&&o.push(i);if(o.length===1){const i=o[0];return t.indexOf(i)}n=n.parentElement;}return  -1}function VD(e,t){const n=BD();return t>n&&e>=n?"ability":"variant"}function qD(e){const t=zD();if(!t)return;const n=x_();if(!n&&!t.type)return;const r=HD(e);if(r.length===0)return;const o=WD(e,r);if(o===-1)return;let i="";const a=t.type||(n==="crops"?"crop":"pet"),s=GD(t.id,a);if(a==="crop"){const u=g0(o,"crops");if(!u)return;i=MD(u,s);}else if(a==="pet")if(VD(o,r.length)==="variant"){const f=g0(o,"pets");if(!f)return;i=LD(f,s);}else i=RD(t.id);e.classList.add(w_);const l=()=>f0(e,i),c=()=>zu(),d=u=>{u.stopPropagation(),f0(e,i),setTimeout(()=>zu(),3e3);};e.addEventListener("mouseenter",l),e.addEventListener("mouseleave",c),e.addEventListener("click",d),_a.add(()=>{e.removeEventListener("mouseenter",l),e.removeEventListener("mouseleave",c),e.removeEventListener("click",d);});}function S_(){const e=UD();if(e.length!==0)for(const t of e)qD(t);}function KD(e,t){const n=[];for(const l of e){const c=l.querySelectorAll(".chakra-text, p, span");let d=null;for(const u of c){const f=u.textContent?.trim()??"";if(!(f.includes("%")||/^\d+\/\d+$/.test(f))&&!(f.length<2||f.length>30)&&f!=="???"){const g=lo(f);if(g&&g.type===t){d=g.id;break}}}n.push(d??"");}const r=t==="crop"?ue.get("plants"):ue.get("pets"),o=r?Object.keys(r):[],i=new Set(n.filter(l=>l!=="")),a=o.filter(l=>!i.has(l));let s=0;for(let l=0;l<n.length;l++)n[l]===""&&s<a.length&&(n[l]=a[s],s++);return n}function XD(){const e=t=>{const r=t.target.closest(".McGrid");if(!r)return;const o=r.querySelectorAll(".chakra-text, p, span");for(const g of o){const h=g.textContent?.trim()??"";if(!(h.includes("%")||/^\d+\/\d+$/.test(h))&&!(h.length<2||h.length>30)&&h!=="???"){const y=lo(h);if(y){fl={id:y.id,type:y.type};return}}}const i=r.closest(".McFlex");if(!i)return;const a=Array.from(i.querySelectorAll(":scope > .McGrid")),s=a.indexOf(r);if(s===-1)return;const l=x_();let c,d,u;if(l)c=l==="crops"?"crop":"pet",d=a,u=s;else {const g=ue.get("plants"),h=g?Object.keys(g).length:0;s<h?(c="crop",d=a.slice(0,h),u=s):(c="pet",d=a.slice(h),u=s-h);}const f=KD(d,c);u<f.length&&f[u]&&(fl={id:f[u],type:c});};document.body.addEventListener("click",e,{capture:true}),_a.add(()=>document.body.removeEventListener("click",e,{capture:true}));}function YD(){const e=new MutationObserver(()=>{Ha&&S_();});e.observe(document.body,{childList:true,subtree:true}),Fo(_a,e);}function JD(){Ha||(Ha=true,XD(),S_(),YD());}function QD(){Ha&&(Ha=false,_a.run(),_a.clear(),_a=Tt(),zu());}function ZD(){return Ha}const eF=Object.freeze(Object.defineProperty({__proto__:null,destroy:QD,init:JD,isEnabled:ZD},Symbol.toStringTag,{value:"Module"}));let ti=null,xs=0;const tF=500;function $r(){if(ti&&Date.now()-xs<tF&&document.contains(ti))return ti;const e=document.querySelectorAll('.chakra-box, [class*="Box"], div');for(const n of e)if(n.style.backgroundImage?.includes("GardenJournal")||window.getComputedStyle(n).backgroundImage?.includes("GardenJournal"))return ti=n,xs=Date.now(),n;const t=document.querySelectorAll(".chakra-text, p, span");for(const n of t)if(n.textContent?.includes("GARDEN JOURNAL")){let r=n.parentElement;for(let o=0;o<10&&r;o++){if(r.classList.contains("McGrid")||r.querySelector(".McGrid"))return ti=r,xs=Date.now(),r;r=r.parentElement;}}return ti=null,xs=Date.now(),null}function Lb(){const e=$r();if(!e)return null;const t=e.querySelectorAll(".McFlex");for(const n of t){const r=window.getComputedStyle(n);if((r.overflowY==="auto"||r.overflowY==="scroll")&&n.querySelector(":scope > .McGrid"))return n}return null}function __(){const e=$r();if(!e)return null;const t=e.querySelectorAll(".chakra-text, p, span");for(const n of t)if((n.textContent?.trim()??"").match(/Collected\s+\d+%/i))return n;return null}function nF(){const e=$r();if(!e)return;const t=e.querySelectorAll("button");for(const n of t){const r=n.textContent?.trim();if(r==="Crops"||r==="Pets"){const o=n.querySelector("div");if(o){const i=o.querySelector("div");i&&(i.style.height="20px");}}}}function rF(){const e=$r();if(!e)return;const t=e.querySelectorAll("button");for(const n of t){const r=n.textContent?.trim();if(r==="Crops"||r==="Pets"){const o=n.querySelector("div");if(o){const i=o.querySelector("div");i&&i.style.height==="20px"&&(i.style.height="");}}}}let m0=null;const Sg=new Set;function Dp(e){if(e!==m0){m0=e,e!==null?nF():rF();for(const t of Sg)try{t(e);}catch(n){console.warn("[TabState] Listener error:",n);}}}function Ob(e){return Sg.add(e),()=>Sg.delete(e)}let Ti=Tt(),Nl=false,Po={filter:"all",sort:"default"};const Nb="gemini-journal-filterSort";function oF(){const e=$r();if(!e)return null;const t=e.querySelectorAll(".chakra-text, p, span");for(const n of t)if((n.textContent?.trim()??"").match(/Collected\s+\d+%/i))return n;return null}function iF(){const e=Lb();return e?Array.from(e.querySelectorAll(":scope > .McGrid")).filter(n=>(n.textContent??"").match(/\d+\/\d+/)!==null):[]}function aF(){const e=document.createElement("div");e.className=Nb,e.style.cssText=`
        display: flex;
        gap: 8px;
        padding: 6px 0;
        margin: 6px 0;
        flex-wrap: wrap;
        align-items: center;
        justify-content: center;
    `;const t=document.createElement("span");t.textContent="Filter:",t.style.cssText="color: #A88A6B; font-size: 11px;";const n=document.createElement("select");for(const[i,a]of [["all","All"],["missing","Missing"],["collected","Complete"]]){const s=document.createElement("option");s.value=i,s.textContent=a,n.appendChild(s);}n.style.cssText=`
        background: #D4C8B8;
        color: #3D3325;
        border: 1px solid #8B7355;
        border-radius: 4px;
        padding: 3px 6px;
        font-size: 10px;
        cursor: pointer;
    `,n.value=Po.filter,n.onchange=()=>{Po.filter=n.value,gn(()=>_g());};const r=document.createElement("span");r.textContent="Sort:",r.style.cssText="color: #A88A6B; font-size: 11px; margin-left: 8px;";const o=document.createElement("select");for(const[i,a]of [["default","Default"],["alphabetical","A-Z"],["progress","By Progress"]]){const s=document.createElement("option");s.value=i,s.textContent=a,o.appendChild(s);}return o.style.cssText=n.style.cssText,o.value=Po.sort,o.onchange=()=>{Po.sort=o.value,gn(()=>_g());},e.append(t,n,r,o),e}function sF(e,t){const n=e.querySelectorAll(".chakra-text, p, span");let r="",o=0;for(const i of n){const a=i.textContent?.trim()??"",s=a.match(/^(\d+)\/(\d+)$/);if(s){const l=parseInt(s[1]),c=parseInt(s[2]);o=c>0?l/c*100:0;continue}a!=="???"&&!a.includes("%")&&a.length>=2&&a.length<=25&&(r=a);}return !r&&o===0?null:{el:e,name:r||"???",progress:o,originalOrder:t}}function _g(){const e=iF();if(e.length===0)return;const t=[];if(e.forEach((r,o)=>{const i=sF(r,o);i&&t.push(i);}),t.length===0)return;for(const r of t){let o=true;Po.filter==="missing"?o=r.progress<100:Po.filter==="collected"&&(o=r.progress===100),r.el.style.display=o?"":"none";}let n;switch(Po.sort){case "alphabetical":n=[...t].sort((r,o)=>r.name.localeCompare(o.name));break;case "progress":n=[...t].sort((r,o)=>o.progress-r.progress);break;default:n=[...t].sort((r,o)=>r.originalOrder-o.originalOrder);}n.forEach((r,o)=>{r.el.style.order=String(o);});}function lF(){if(document.querySelector(`.${Nb}`))return;const e=oF();if(!e||!e.closest(".McFlex"))return;const n=aF(),r=e.nextElementSibling;if(r&&e.parentElement)e.parentElement.insertBefore(n,r);else if(e.parentElement)e.parentElement.appendChild(n);else return;Ti.add(()=>n.remove());}function tu(){gn(()=>{lF(),_g();});}let hi=null;function cF(){hi!==null&&clearTimeout(hi),hi=window.setTimeout(()=>{Bo()||tu(),hi=null;},200);}function dF(){setTimeout(tu,100),setTimeout(tu,400),setTimeout(tu,800);const e=new MutationObserver(()=>{Bo()||cF();});e.observe(document.body,{childList:true,subtree:true}),Fo(Ti,e);const t=Ob(n=>{const r=document.querySelector(`.${Nb}`);r&&(r.style.display=n?"none":"");});Ti.add(t),Ti.add(()=>{hi!==null&&(clearTimeout(hi),hi=null);});}function uF(){Po={filter:"all",sort:"default"},Ti.run(),Ti.clear(),Ti=Tt();}function pF(){Nl||(Nl=true,dF(),console.log("[JournalFilterSort] Initialized"));}function fF(){Nl&&(Nl=false,uF(),console.log("[JournalFilterSort] Destroyed"));}function hF(){return Nl}const gF=Object.freeze(Object.defineProperty({__proto__:null,destroy:fF,init:pF,isEnabled:hF},Symbol.toStringTag,{value:"Module"}));let qr=Tt(),Oo=Tt(),$l=false,to=false,kg=0;const Fp="gemini-journal-allTab",Eg="gemini-journal-allOverlay";let qs="all",Uu="default";function k_(){const e=$r();if(!e)return null;const t=e.querySelectorAll(".chakra-text, p, span");for(const n of t){const r=n.textContent?.trim();if(r==="Crops"||r==="Pets"){const o=n.closest("button");if(o){const i=o.parentElement;if(i&&i.querySelectorAll("button").length>=2)return i}}}return null}function E_(){const e=k_();if(!e)return {crops:null,pets:null};let t=null,n=null;const r=e.querySelectorAll("button");for(const o of r){const i=o.textContent?.trim();i==="Crops"&&(t=o),i==="Pets"&&(n=o);}return {crops:t,pets:n}}function A_(){const e=$r();if(!e)return null;const t=e.querySelectorAll(".McGrid");for(const n of t){const r=n.querySelectorAll(":scope > .McFlex");for(const o of r){const i=window.getComputedStyle(o);if((i.overflow==="hidden"||i.overflowY==="hidden")&&(o.textContent?.includes("JOURNAL")||o.querySelector(".McGrid")))return o}}return null}function mF(e){return e<15?"#F98B4B":e<25?"#FC6D30":e<50?"#F3D32B":e<75?"#E9B52F":e<100?"#5EAC46":"#0B893F"}function bF(){const e=document.createElement("button");e.className=Fp,e.type="button",e.style.cssText=`
        background: transparent;
        border: none;
        cursor: pointer;
        height: 60px;
        padding: 0;
        margin: 0;
    `;const t=document.createElement("div");t.className="McFlex",t.style.cssText=`
        display: flex;
        align-items: flex-end;
        justify-content: center;
        height: 100%;
    `;const n=document.createElement("div");n.className="gemini-allTab-tab",n.style.cssText=`
        display: flex;
        align-items: flex-start;
        justify-content: center;
        width: clamp(70px, 12vw, 100px);
        height: 20px;
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
        background: #5a7a6a;
        position: relative;
        border-left: 1px solid #6a9a82;
        border-right: 1px solid #6a9a82;
        border-top: 2px solid #7aba9a;
        overflow: hidden;
        transition: height 0.3s ease-in-out;
    `;const r=document.createElement("span");return r.textContent="All",r.style.cssText=`
        font-size: clamp(12px, 2vw, 14px);
        font-weight: bold;
        color: white;
        position: relative;
        z-index: 2;
    `,n.appendChild(r),t.appendChild(n),e.appendChild(t),e.onmouseenter=()=>{to||(n.style.height="25px");},e.onmouseleave=()=>{to||(n.style.height="20px");},e.onclick=o=>{o.preventDefault(),o.stopPropagation();const i=Date.now();i-kg<300||(kg=i,gn(()=>wF()));},e}function vF(e,t){const n=document.createElement("div");n.style.cssText=`
        display: grid;
        grid-template-columns: minmax(36px, 50px) 1fr;
        align-items: center;
        gap: 8px;
        cursor: pointer;
    `;const r=document.createElement("div");r.style.cssText=`
        width: clamp(36px, 8vw, 50px);
        height: clamp(36px, 8vw, 50px);
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: visible;
    `;const o=e.variantsLogged.length===0;if(o){const y=document.createElement("span");y.textContent="?",y.style.cssText="font-size: 24px; color: rgba(168, 138, 107, 0.6); font-weight: bold;",r.appendChild(y);}else try{if(me.isReady()){const y=t==="crop"?"plant":"pet";let S=e.species;t==="crop"&&(e.species==="DawnCelestial"&&(S="DawnCelestialCrop"),e.species==="MoonCelestial"&&(S="MoonCelestialCrop"),e.species==="OrangeTulip"&&(S="Tulip"));const C=(E,P)=>{try{if(me.has(E,P))return me.toCanvas(E,P,{scale:.5})}catch{}return null},_=C(y,S)||(t==="crop"?C("tallplant",S):null)||C(y,S.toLowerCase())||(t==="crop"?C("tallplant",S.toLowerCase()):null);if(_)_.style.cssText="width: 100%; height: 100%; display: block; object-fit: contain; image-rendering: pixelated;",r.appendChild(_);else {const E=document.createElement("span");E.textContent=t==="crop"?"🌱":"🐾",E.style.cssText="font-size: 20px;",r.appendChild(E);}}else {const y=document.createElement("span");y.textContent=t==="crop"?"🌱":"🐾",y.style.cssText="font-size: 20px;",r.appendChild(y);}}catch{const y=document.createElement("span");y.textContent=t==="crop"?"🌱":"🐾",y.style.cssText="font-size: 20px;",r.appendChild(y);}let i,a,s;if(t==="pet"){const y=e.abilitiesLogged?.length??0,S=e.abilitiesTotal??0;i=e.variantsLogged.length+y,a=e.variantsTotal+S,s=a>0?i/a*100:0;}else i=e.variantsLogged.length,a=e.variantsTotal,s=e.variantsPercentage;const l=mF(s),c=document.createElement("div");c.style.cssText=`
        position: relative;
        background: #D4C4A8;
        border-radius: 5px;
        padding: 6px 12px;
        overflow: hidden;
        flex: 1;
        min-width: 0;
        max-width: 100%;
    `;const d=document.createElement("div");d.style.cssText=`
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        width: ${s}%;
        background: ${l};
        border-radius: inherit;
        transition: width 0.3s ease;
    `;const u=document.createElement("div");u.style.cssText=`
        display: grid;
        grid-template-columns: 1fr auto;
        align-items: center;
        position: relative;
        z-index: 1;
    `;const f=$p(e.species,t),g=document.createElement("span");g.style.cssText="font-weight: bold; font-size: 13px; color: #3D3325; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;",g.textContent=o?"???":f;const h=document.createElement("span");return h.style.cssText=`font-size: 12px; font-weight: bold; color: ${s<100?"#8B6914":"#3D3325"}; margin-left: 4px; flex-shrink: 0;`,h.textContent=`${i}/${a}`,u.append(g,h),c.append(d,u),n.append(r,c),n.onclick=y=>{y.preventDefault(),y.stopPropagation(),yF(e.species,t);},n.onmouseenter=()=>{n.style.opacity="0.8";},n.onmouseleave=()=>{n.style.opacity="1";},n}function yF(e,t){gn(()=>Hu()),setTimeout(()=>{const{crops:n,pets:r}=E_(),o=t==="crop"?n:r;o&&(o.click(),setTimeout(()=>{const i=A_();if(!i)return;const a=i.querySelectorAll(".McGrid");for(const s of a){const l=s.textContent??"";if(l.toLowerCase().includes(e.toLowerCase())||l.includes($p(e,t))){s.click();break}}setTimeout(()=>{gn(()=>I_());},100);},200));},100);}function b0(e,t,n){const r=document.createElement("div");r.style.cssText="margin-bottom: 16px;";let o=0,i=0;for(const u of t)n==="pet"?(o+=u.variantsLogged.length+(u.abilitiesLogged?.length??0),i+=u.variantsTotal+(u.abilitiesTotal??0)):(o+=u.variantsLogged.length,i+=u.variantsTotal);const a=document.createElement("div"),s=n==="crop"?"#7cb342":"#9575cd";a.style.cssText=`
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 4px 0;
        margin-bottom: 12px;
        border-bottom: 2px solid rgba(212, 196, 168, 0.3);
    `;const l=document.createElement("span");l.textContent=e,l.style.cssText=`font-size: 16px; font-weight: 600; font-family: shrikhand, serif; color: ${s}; text-transform: uppercase;`;const c=document.createElement("span");c.textContent=`${o}/${i}`,c.style.cssText="color: #A88A6B; font-size: 12px; font-weight: bold;",a.append(l,c);const d=document.createElement("div");d.style.cssText="display: flex; flex-direction: column; gap: 12px; padding: 0 4px;";for(const u of t)d.appendChild(vF(u,n));return r.append(a,d),r}function T_(){const e=Lt.getMyJournal(),t=Lt.calculateProduceProgress(e),n=Lt.calculatePetProgress(e),r=document.createElement("div");r.className="gemini-journal-allContent",r.style.cssText=`
        padding: 12px 16px;
        flex: 1;
        overflow: hidden;
        display: flex;
        flex-direction: column;
    `;const o=document.createElement("div");o.style.cssText="text-align: center; padding-bottom: 8px;";const i=document.createElement("p");i.textContent="GARDEN JOURNAL",i.style.cssText="font-size: clamp(14px, 3vw, 20px); font-weight: bold; font-family: shrikhand, serif; color: #4F6981; margin-bottom: 4px;";const a=t.variantsLogged+n.variantsLogged+(n.abilitiesLogged??0),s=t.variantsTotal+n.variantsTotal+(n.abilitiesTotal??0),l=Math.floor(a/s*100),c=document.createElement("p");c.style.cssText="font-size: 14px; font-weight: bold; color: #4F6981; margin-top: -2px;",c.textContent=`Collected ${l}% `;const d=document.createElement("span");d.className="chakra-text",d.style.cssText="color: #A88A6B; font-size: 12px; font-weight: bold;",d.textContent=`(${a}/${s})`,c.appendChild(d);const u=document.createElement("div");u.style.cssText="height: 4px; background: #D4C4A8; border-radius: 9999px; opacity: 0.5; margin: 8px 0;",o.append(i,c,u);const f=document.createElement("div");f.style.cssText=`
        display: flex;
        gap: 12px;
        padding: 6px 0;
        margin-bottom: 8px;
        flex-wrap: wrap;
        align-items: center;
        justify-content: center;
    `;const g=document.createElement("span");g.textContent="Filter:",g.style.cssText="color: #A88A6B; font-size: 11px; font-weight: bold;";const h=document.createElement("select");for(const[P,O]of [["all","All"],["missing","Missing"],["complete","Complete"]]){const k=document.createElement("option");k.value=P,k.textContent=O,h.appendChild(k);}h.value=qs,h.style.cssText=`
        background: #D4C8B8;
        color: #3D3325;
        border: 1px solid #8B7355;
        border-radius: 4px;
        padding: 3px 8px;
        font-size: 10px;
        cursor: pointer;
    `,h.onchange=()=>{qs=h.value,y0();};const y=document.createElement("span");y.textContent="Sort:",y.style.cssText="color: #A88A6B; font-size: 11px; font-weight: bold; margin-left: 8px;";const S=document.createElement("select");for(const[P,O]of [["default","Default"],["az","A-Z"],["progress","By Progress"]]){const k=document.createElement("option");k.value=P,k.textContent=O,S.appendChild(k);}S.value=Uu,S.style.cssText=h.style.cssText,S.onchange=()=>{Uu=S.value,y0();},f.append(g,h,y,S);const C=document.createElement("div");C.className="gemini-journal-scrollbar",C.style.cssText=`
        flex: 1;
        overflow-y: auto;
        padding-right: 4px;
    `;const _=v0(t.speciesDetails,"crop"),E=v0(n.speciesDetails,"pet");if(_.length>0&&C.appendChild(b0("Crops",_,"crop")),E.length>0&&C.appendChild(b0("Pets",E,"pet")),_.length===0&&E.length===0){const P=document.createElement("div");P.style.cssText="text-align: center; padding: 40px 20px; color: #A88A6B; font-size: 14px;",P.textContent=qs==="missing"?"All entries are complete!":qs==="complete"?"No complete entries yet.":"No entries found.",C.appendChild(P);}return r.append(o,f,C),r}function v0(e,t){let n=e.filter(r=>{let o,i;t==="pet"?(o=r.variantsLogged.length+(r.abilitiesLogged?.length??0),i=r.variantsTotal+(r.abilitiesTotal??0)):(o=r.variantsLogged.length,i=r.variantsTotal);const a=i>0?o/i*100:0;switch(qs){case "missing":return a<100;case "complete":return a>=100;default:return  true}});return Uu==="az"?n=[...n].sort((r,o)=>r.species.localeCompare(o.species)):Uu==="progress"&&(n=[...n].sort((r,o)=>{const i=t==="pet"?r.variantsLogged.length+(r.abilitiesLogged?.length??0):r.variantsLogged.length,a=t==="pet"?r.variantsTotal+(r.abilitiesTotal??0):r.variantsTotal,s=a>0?i/a:0,l=t==="pet"?o.variantsLogged.length+(o.abilitiesLogged?.length??0):o.variantsLogged.length,c=t==="pet"?o.variantsTotal+(o.abilitiesTotal??0):o.variantsTotal;return (c>0?l/c:0)-s})),n}function y0(){const e=document.querySelector(`.${Eg}`);if(e){for(;e.firstChild;)e.firstChild.remove();e.appendChild(T_());}}function wF(){if(to)return;to=true,Dp("all");const t=document.querySelector(`.${Fp}`)?.querySelector(".gemini-allTab-tab");t&&(t.style.height="35px");const n=A_();if(!n){console.warn("[JournalAllTab] Cannot activate All tab: content wrapper not found"),to=false;return}const r=[];for(const a of Array.from(n.children))a instanceof HTMLElement&&!a.classList.contains(Eg)&&(r.push(a),a.style.visibility="hidden");Oo.add(()=>{for(const a of r)a.style.visibility="";});const o=document.createElement("div");o.className=Eg,o.style.cssText=`
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 10;
        background: transparent;
        display: flex;
        flex-direction: column;
    `,window.getComputedStyle(n).position==="static"&&(n.style.position="relative",Oo.add(()=>{n.style.position="";})),o.appendChild(T_()),n.appendChild(o),Oo.add(()=>o.remove()),xF(),console.log("[JournalAllTab] All tab activated");}function xF(){const e=__();if(!e)return;const t=Lt.getMyJournal(),n=Lt.calculateProduceProgress(t),r=Lt.calculatePetProgress(t),o=n.variantsLogged+r.variantsLogged+(r.abilitiesLogged??0),i=n.variantsTotal+r.variantsTotal+(r.abilitiesTotal??0),a=Math.floor(o/i*100);if(!e.hasAttribute("data-original-percent")){const c=e.textContent?.match(/Collected\s+(\d+)%/);c&&e.setAttribute("data-original-percent",c[1]);}const s=e.querySelector("span.chakra-text");s&&!s.hasAttribute("data-original-count")&&s.setAttribute("data-original-count",s.textContent||"");const l=e.childNodes[0];l&&l.nodeType===Node.TEXT_NODE&&(l.textContent=`Collected ${a}% `),s&&(s.textContent=`(${o}/${i})`);}function CF(){const e=__();if(!e)return;const t=e.getAttribute("data-original-percent");if(t){const r=e.childNodes[0];r&&r.nodeType===Node.TEXT_NODE&&(r.textContent=`Collected ${t}% `),e.removeAttribute("data-original-percent");}const n=e.querySelector("span.chakra-text");if(n){const r=n.getAttribute("data-original-count");r&&(n.textContent=r),n.removeAttribute("data-original-count");}}function Hu(){if(!to)return;to=false,Dp(null);const t=document.querySelector(`.${Fp}`)?.querySelector(".gemini-allTab-tab");t&&(t.style.height="20px"),Oo.run(),Oo=Tt(),CF(),console.log("[JournalAllTab] All tab deactivated");}function I_(){const e=k_();if(!e||e.querySelector(`.${Fp}`))return;const{crops:t,pets:n}=E_();if(!t)return;const r=bF();e.insertBefore(r,t),qr.add(()=>r.remove());const o=()=>{gn(()=>Hu());};t&&(t.addEventListener("click",o),qr.add(()=>t.removeEventListener("click",o))),n&&(n.addEventListener("click",o),qr.add(()=>n.removeEventListener("click",o)));const i=Ob(a=>{a!=="all"&&to&&gn(()=>Hu());});qr.add(i),console.log("[JournalAllTab] Tab injected");}function nu(){gn(()=>{try{I_();}catch(e){console.warn("[JournalAllTab] processPage error:",e);}});}let gi=null;function SF(){gi!==null&&clearTimeout(gi),gi=window.setTimeout(()=>{Bo()||nu(),gi=null;},200);}function _F(){setTimeout(nu,100),setTimeout(nu,400),setTimeout(nu,800);const e=new MutationObserver(()=>{Bo()||SF();});e.observe(document.body,{childList:true,subtree:true}),Fo(qr,e),qr.add(()=>{gi!==null&&(clearTimeout(gi),gi=null);});}function kF(){Hu(),Oo.run(),Oo.clear(),qr.run(),qr.clear(),Oo=Tt(),qr=Tt(),to=false,kg=0;}function EF(){$l||($l=true,_F(),console.log("[JournalAllTab] Initialized"));}function AF(){$l&&($l=false,kF(),console.log("[JournalAllTab] Destroyed"));}function TF(){return $l}const IF=Object.freeze(Object.defineProperty({__proto__:null,destroy:AF,init:EF,isEnabled:TF},Symbol.toStringTag,{value:"Module"})),PF="gemini-qol-journalGuide-styles",RF=`
/* ─── Badge ─── */

.gemini-qol-journalGuide-badge {
    display: inline-flex;
    align-items: center;
    gap: 2px;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 11px;
    line-height: 1.2;
    white-space: nowrap;
    position: absolute;
    right: 80px;
    top: 50%;
    transform: translateY(-50%);
    z-index: 5;
    opacity: 0.95;
    pointer-events: auto;
    cursor: help;
    min-height: 22px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.25);
    transition: opacity 0.2s, transform 0.2s;
    border: 1px solid rgba(255,255,255,0.3);
}

.gemini-qol-journalGuide-badge:hover {
    opacity: 1;
    transform: translateY(-50%) scale(1.05);
    box-shadow: 0 3px 8px rgba(0,0,0,0.3);
}

.gemini-qol-journalGuide-badge[data-active="true"] {
    animation: gemini-qol-journalGuide-pulse 2s ease-in-out infinite;
}

.gemini-qol-journalGuide-badge[data-predicted="true"] {
    opacity: 0.75;
    border: 2px dashed rgba(255,255,255,0.5);
}

.gemini-qol-journalGuide-badge-icon {
    width: 14px;
    height: 14px;
    image-rendering: pixelated;
}

.gemini-qol-journalGuide-badge-icon-fallback {
    font-size: 10px;
    color: #fff;
    font-weight: bold;
}

.gemini-qol-journalGuide-badge-letter {
    display: inline-block;
}

@keyframes gemini-qol-journalGuide-pulse {
    0%, 100% { box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
    50% { box-shadow: 0 1px 8px rgba(255,255,255,0.4), 0 1px 3px rgba(0,0,0,0.2); }
}

/* ─── Shared Scrollbar (used by journalGuide and journalAllTab) ─── */

.gemini-journal-scrollbar::-webkit-scrollbar,
.gemini-qol-journalGuide-scroll::-webkit-scrollbar {
    width: 4px;
    height: 6px;
}

.gemini-journal-scrollbar::-webkit-scrollbar-track,
.gemini-qol-journalGuide-scroll::-webkit-scrollbar-track {
    background: transparent;
}

.gemini-journal-scrollbar::-webkit-scrollbar-thumb,
.gemini-qol-journalGuide-scroll::-webkit-scrollbar-thumb {
    background: rgba(85, 48, 20, 0.2);
    border-radius: 3px;
}

.gemini-journal-scrollbar::-webkit-scrollbar-thumb:hover,
.gemini-qol-journalGuide-scroll::-webkit-scrollbar-thumb:hover {
    background: rgba(110, 60, 24, 0.3);
}

/* ─── Responsive Badge Sizing ─── */

@media (max-width: 480px) {
    .gemini-qol-journalGuide-badge {
        font-size: 10px;
        padding: 2px 6px;
        right: 72px;
    }
    .gemini-qol-journalGuide-badge-icon {
        width: 12px;
        height: 12px;
    }
    .gemini-qol-journalGuide-row {
        grid-template-columns: 36px 1fr;
        gap: 4px;
        padding: 4px 2px;
    }
}

@media (max-width: 360px) {
    .gemini-qol-journalGuide-badge {
        font-size: 9px;
        padding: 1px 5px;
        right: 64px;
    }
    .gemini-qol-journalGuide-badge-icon {
        width: 10px;
        height: 10px;
    }
    .gemini-qol-journalGuide-row {
        grid-template-columns: 30px 1fr;
        gap: 3px;
        padding: 3px 2px;
    }
}

/* ─── Reduced Motion Support ─── */

@media (prefers-reduced-motion: reduce) {
    .gemini-qol-journalGuide-badge[data-active="true"] {
        animation: none;
    }
    .gemini-qol-journalGuide-badge {
        transition: none;
    }
}
`;let ko=null;function MF(){ko||(ko=document.createElement("style"),ko.id=PF,ko.textContent=RF,document.head.appendChild(ko));}function LF(){ko&&(ko.remove(),ko=null);}function Bp(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]]);return n}function OF(e,t,n,r){function o(i){return i instanceof n?i:new n(function(a){a(i);})}return new(n||(n=Promise))(function(i,a){function s(d){try{c(r.next(d));}catch(u){a(u);}}function l(d){try{c(r.throw(d));}catch(u){a(u);}}function c(d){d.done?i(d.value):o(d.value).then(s,l);}c((r=r.apply(e,t||[])).next());})}const NF=e=>e?(...t)=>e(...t):(...t)=>fetch(...t);class $b extends Error{constructor(t,n="FunctionsError",r){super(t),this.name=n,this.context=r;}}class $F extends $b{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t);}}class w0 extends $b{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t);}}class x0 extends $b{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t);}}var Ag;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2";})(Ag||(Ag={}));class DF{constructor(t,{headers:n={},customFetch:r,region:o=Ag.Any}={}){this.url=t,this.headers=n,this.region=o,this.fetch=NF(r);}setAuth(t){this.headers.Authorization=`Bearer ${t}`;}invoke(t){return OF(this,arguments,void 0,function*(n,r={}){var o;let i,a;try{const{headers:s,method:l,body:c,signal:d,timeout:u}=r;let f={},{region:g}=r;g||(g=this.region);const h=new URL(`${this.url}/${n}`);g&&g!=="any"&&(f["x-region"]=g,h.searchParams.set("forceFunctionRegion",g));let y;c&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)?typeof Blob<"u"&&c instanceof Blob||c instanceof ArrayBuffer?(f["Content-Type"]="application/octet-stream",y=c):typeof c=="string"?(f["Content-Type"]="text/plain",y=c):typeof FormData<"u"&&c instanceof FormData?y=c:(f["Content-Type"]="application/json",y=JSON.stringify(c)):c&&typeof c!="string"&&!(typeof Blob<"u"&&c instanceof Blob)&&!(c instanceof ArrayBuffer)&&!(typeof FormData<"u"&&c instanceof FormData)?y=JSON.stringify(c):y=c;let S=d;u&&(a=new AbortController,i=setTimeout(()=>a.abort(),u),d?(S=a.signal,d.addEventListener("abort",()=>a.abort())):S=a.signal);const C=yield this.fetch(h.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},f),this.headers),s),body:y,signal:S}).catch(O=>{throw new $F(O)}),_=C.headers.get("x-relay-error");if(_&&_==="true")throw new w0(C);if(!C.ok)throw new x0(C);let E=((o=C.headers.get("Content-Type"))!==null&&o!==void 0?o:"text/plain").split(";")[0].trim(),P;return E==="application/json"?P=yield C.json():E==="application/octet-stream"||E==="application/pdf"?P=yield C.blob():E==="text/event-stream"?P=C:E==="multipart/form-data"?P=yield C.formData():P=yield C.text(),{data:P,error:null,response:C}}catch(s){return {data:null,error:s,response:s instanceof x0||s instanceof w0?s.context:void 0}}finally{i&&clearTimeout(i);}})}}var FF=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code;}},BF=class{constructor(e){var t,n,r;this.shouldThrowOnError=false,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=(t=e.shouldThrowOnError)!==null&&t!==void 0?t:false,this.signal=e.signal,this.isMaybeSingle=(n=e.isMaybeSingle)!==null&&n!==void 0?n:false,this.urlLengthLimit=(r=e.urlLengthLimit)!==null&&r!==void 0?r:8e3,e.fetch?this.fetch=e.fetch:this.fetch=fetch;}throwOnError(){return this.shouldThrowOnError=true,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){var n=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const r=this.fetch;let o=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{let a=null,s=null,l=null,c=i.status,d=i.statusText;if(i.ok){var u,f;if(n.method!=="HEAD"){var g;const C=await i.text();C===""||(n.headers.get("Accept")==="text/csv"||n.headers.get("Accept")&&(!((g=n.headers.get("Accept"))===null||g===void 0)&&g.includes("application/vnd.pgrst.plan+text"))?s=C:s=JSON.parse(C));}const y=(u=n.headers.get("Prefer"))===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),S=(f=i.headers.get("content-range"))===null||f===void 0?void 0:f.split("/");y&&S&&S.length>1&&(l=parseInt(S[1])),n.isMaybeSingle&&n.method==="GET"&&Array.isArray(s)&&(s.length>1?(a={code:"PGRST116",details:`Results contain ${s.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},s=null,l=null,c=406,d="Not Acceptable"):s.length===1?s=s[0]:s=null);}else {var h;const y=await i.text();try{a=JSON.parse(y),Array.isArray(a)&&i.status===404&&(s=[],a=null,c=200,d="OK");}catch{i.status===404&&y===""?(c=204,d="No Content"):a={message:y};}if(a&&n.isMaybeSingle&&(!(a==null||(h=a.details)===null||h===void 0)&&h.includes("0 rows"))&&(a=null,c=200,d="OK"),a&&n.shouldThrowOnError)throw new FF(a)}return {error:a,data:s,count:l,status:c,statusText:d}});return this.shouldThrowOnError||(o=o.catch(i=>{var a;let s="",l="",c="";const d=i?.cause;if(d){var u,f,g,h;const C=(u=d?.message)!==null&&u!==void 0?u:"",_=(f=d?.code)!==null&&f!==void 0?f:"";s=`${(g=i?.name)!==null&&g!==void 0?g:"FetchError"}: ${i?.message}`,s+=`

Caused by: ${(h=d?.name)!==null&&h!==void 0?h:"Error"}: ${C}`,_&&(s+=` (${_})`),d?.stack&&(s+=`
${d.stack}`);}else {var y;s=(y=i?.stack)!==null&&y!==void 0?y:"";}const S=this.url.toString().length;return i?.name==="AbortError"||i?.code==="ABORT_ERR"?(c="",l="Request was aborted (timeout or manual cancellation)",S>this.urlLengthLimit&&(l+=`. Note: Your request URL is ${S} characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side.`)):(d?.name==="HeadersOverflowError"||d?.code==="UND_ERR_HEADERS_OVERFLOW")&&(c="",l="HTTP headers exceeded server limits (typically 16KB)",S>this.urlLengthLimit&&(l+=`. Your request URL is ${S} characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead.`)),{error:{message:`${(a=i?.name)!==null&&a!==void 0?a:"FetchError"}: ${i?.message}`,details:s,hint:l,code:c},data:null,count:null,status:0,statusText:""}})),o.then(e,t)}returns(){return this}overrideTypes(){return this}},jF=class extends BF{select(e){let t=false;const n=(e??"*").split("").map(r=>/\s/.test(r)&&!t?"":(r==='"'&&(t=!t),r)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=true,nullsFirst:n,foreignTable:r,referencedTable:o=r}={}){const i=o?`${o}.order`:"order",a=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:n=t}={}){const r=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:n,referencedTable:r=n}={}){const o=typeof r>"u"?"offset":`${r}.offset`,i=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(o,`${e}`),this.url.searchParams.set(i,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=true,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=false,verbose:t=false,settings:n=false,buffers:r=false,wal:o=false,format:i="text"}={}){var a;const s=[e?"analyze":null,t?"verbose":null,n?"settings":null,r?"buffers":null,o?"wal":null].filter(Boolean).join("|"),l=(a=this.headers.get("Accept"))!==null&&a!==void 0?a:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${l}"; options=${s};`),i==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};const C0=new RegExp("[,()]");var aa=class extends jF{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}regexMatch(e,t){return this.url.searchParams.append(e,`match.${t}`),this}regexIMatch(e,t){return this.url.searchParams.append(e,`imatch.${t}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}isDistinct(e,t){return this.url.searchParams.append(e,`isdistinct.${t}`),this}in(e,t){const n=Array.from(new Set(t)).map(r=>typeof r=="string"&&C0.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(e,`in.(${n})`),this}notIn(e,t){const n=Array.from(new Set(t)).map(r=>typeof r=="string"&&C0.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(e,`not.in.(${n})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:n,type:r}={}){let o="";r==="plain"?o="pl":r==="phrase"?o="ph":r==="websearch"&&(o="w");const i=n===void 0?"":`(${n})`;return this.url.searchParams.append(e,`${o}fts${i}.${t}`),this}match(e){return Object.entries(e).forEach(([t,n])=>{this.url.searchParams.append(t,`eq.${n}`);}),this}not(e,t,n){return this.url.searchParams.append(e,`not.${t}.${n}`),this}or(e,{foreignTable:t,referencedTable:n=t}={}){const r=n?`${n}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,n){return this.url.searchParams.append(e,`${t}.${n}`),this}},GF=class{constructor(e,{headers:t={},schema:n,fetch:r,urlLengthLimit:o=8e3}){this.url=e,this.headers=new Headers(t),this.schema=n,this.fetch=r,this.urlLengthLimit=o;}cloneRequestState(){return {url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(e,t){const{head:n=false,count:r}=t??{},o=n?"HEAD":"GET";let i=false;const a=(e??"*").split("").map(c=>/\s/.test(c)&&!i?"":(c==='"'&&(i=!i),c)).join(""),{url:s,headers:l}=this.cloneRequestState();return s.searchParams.set("select",a),r&&l.append("Prefer",`count=${r}`),new aa({method:o,url:s,headers:l,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}insert(e,{count:t,defaultToNull:n=true}={}){var r;const o="POST",{url:i,headers:a}=this.cloneRequestState();if(t&&a.append("Prefer",`count=${t}`),n||a.append("Prefer","missing=default"),Array.isArray(e)){const s=e.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(s.length>0){const l=[...new Set(s)].map(c=>`"${c}"`);i.searchParams.set("columns",l.join(","));}}return new aa({method:o,url:i,headers:a,schema:this.schema,body:e,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch,urlLengthLimit:this.urlLengthLimit})}upsert(e,{onConflict:t,ignoreDuplicates:n=false,count:r,defaultToNull:o=true}={}){var i;const a="POST",{url:s,headers:l}=this.cloneRequestState();if(l.append("Prefer",`resolution=${n?"ignore":"merge"}-duplicates`),t!==void 0&&s.searchParams.set("on_conflict",t),r&&l.append("Prefer",`count=${r}`),o||l.append("Prefer","missing=default"),Array.isArray(e)){const c=e.reduce((d,u)=>d.concat(Object.keys(u)),[]);if(c.length>0){const d=[...new Set(c)].map(u=>`"${u}"`);s.searchParams.set("columns",d.join(","));}}return new aa({method:a,url:s,headers:l,schema:this.schema,body:e,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch,urlLengthLimit:this.urlLengthLimit})}update(e,{count:t}={}){var n;const r="PATCH",{url:o,headers:i}=this.cloneRequestState();return t&&i.append("Prefer",`count=${t}`),new aa({method:r,url:o,headers:i,schema:this.schema,body:e,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch,urlLengthLimit:this.urlLengthLimit})}delete({count:e}={}){var t;const n="DELETE",{url:r,headers:o}=this.cloneRequestState();return e&&o.append("Prefer",`count=${e}`),new aa({method:n,url:r,headers:o,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch,urlLengthLimit:this.urlLengthLimit})}};function Dl(e){"@babel/helpers - typeof";return Dl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dl(e)}function zF(e,t){if(Dl(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(Dl(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return (t==="string"?String:Number)(e)}function UF(e){var t=zF(e,"string");return Dl(t)=="symbol"?t:t+""}function HF(e,t,n){return (t=UF(t))in e?Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true}):e[t]=n,e}function S0(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r);}return n}function ad(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?S0(Object(n),true).forEach(function(r){HF(e,r,n[r]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S0(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r));});}return e}var WF=class P_{constructor(t,{headers:n={},schema:r,fetch:o,timeout:i,urlLengthLimit:a=8e3}={}){this.url=t,this.headers=new Headers(n),this.schemaName=r,this.urlLengthLimit=a;const s=o??globalThis.fetch;i!==void 0&&i>0?this.fetch=(l,c)=>{const d=new AbortController,u=setTimeout(()=>d.abort(),i),f=c?.signal;if(f){if(f.aborted)return clearTimeout(u),s(l,c);const g=()=>{clearTimeout(u),d.abort();};return f.addEventListener("abort",g,{once:true}),s(l,ad(ad({},c),{},{signal:d.signal})).finally(()=>{clearTimeout(u),f.removeEventListener("abort",g);})}return s(l,ad(ad({},c),{},{signal:d.signal})).finally(()=>clearTimeout(u))}:this.fetch=s;}from(t){if(!t||typeof t!="string"||t.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new GF(new URL(`${this.url}/${t}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}schema(t){return new P_(this.url,{headers:this.headers,schema:t,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}rpc(t,n={},{head:r=false,get:o=false,count:i}={}){var a;let s;const l=new URL(`${this.url}/rpc/${t}`);let c;const d=g=>g!==null&&typeof g=="object"&&(!Array.isArray(g)||g.some(d)),u=r&&Object.values(n).some(d);u?(s="POST",c=n):r||o?(s=r?"HEAD":"GET",Object.entries(n).filter(([g,h])=>h!==void 0).map(([g,h])=>[g,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([g,h])=>{l.searchParams.append(g,h);})):(s="POST",c=n);const f=new Headers(this.headers);return u?f.set("Prefer",i?`count=${i},return=minimal`:"return=minimal"):i&&f.set("Prefer",`count=${i}`),new aa({method:s,url:l,headers:f,schema:this.schemaName,body:c,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch,urlLengthLimit:this.urlLengthLimit})}};class VF{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return {type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return {type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return {type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return {type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return {type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const n=globalThis.process;if(n){const r=n.versions;if(r&&r.node){const o=r.node,i=parseInt(o.replace(/^v/,"").split(".")[0]);return i>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${i} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${i} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return {type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let n=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(n+=`

Suggested solution: ${t.workaround}`),new Error(n)}static createWebSocket(t,n){const r=this.getWebSocketConstructor();return new r(t,n)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return  false}}}const qF="2.94.0",KF=`realtime-js/${qF}`,XF="1.0.0",R_="2.0.0",_0=R_,Tg=1e4,YF=1e3,JF=100;var Co;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed";})(Co||(Co={}));var Gt;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving";})(Gt||(Gt={}));var ar;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token";})(ar||(ar={}));var Ig;(function(e){e.websocket="websocket";})(Ig||(Ig={}));var si;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed";})(si||(si={}));class QF{constructor(t){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=t??[];}encode(t,n){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return n(this._binaryEncodeUserBroadcastPush(t));let r=[t.join_ref,t.ref,t.topic,t.event,t.payload];return n(JSON.stringify(r))}_binaryEncodeUserBroadcastPush(t){var n;return this._isArrayBuffer((n=t.payload)===null||n===void 0?void 0:n.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var n,r;const o=(r=(n=t.payload)===null||n===void 0?void 0:n.payload)!==null&&r!==void 0?r:new ArrayBuffer(0);return this._encodeUserBroadcastPush(t,this.BINARY_ENCODING,o)}_encodeJsonUserBroadcastPush(t){var n,r;const o=(r=(n=t.payload)===null||n===void 0?void 0:n.payload)!==null&&r!==void 0?r:{},a=new TextEncoder().encode(JSON.stringify(o)).buffer;return this._encodeUserBroadcastPush(t,this.JSON_ENCODING,a)}_encodeUserBroadcastPush(t,n,r){var o,i;const a=t.topic,s=(o=t.ref)!==null&&o!==void 0?o:"",l=(i=t.join_ref)!==null&&i!==void 0?i:"",c=t.payload.event,d=this.allowedMetadataKeys?this._pick(t.payload,this.allowedMetadataKeys):{},u=Object.keys(d).length===0?"":JSON.stringify(d);if(l.length>255)throw new Error(`joinRef length ${l.length} exceeds maximum of 255`);if(s.length>255)throw new Error(`ref length ${s.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`topic length ${a.length} exceeds maximum of 255`);if(c.length>255)throw new Error(`userEvent length ${c.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`metadata length ${u.length} exceeds maximum of 255`);const f=this.USER_BROADCAST_PUSH_META_LENGTH+l.length+s.length+a.length+c.length+u.length,g=new ArrayBuffer(this.HEADER_LENGTH+f);let h=new DataView(g),y=0;h.setUint8(y++,this.KINDS.userBroadcastPush),h.setUint8(y++,l.length),h.setUint8(y++,s.length),h.setUint8(y++,a.length),h.setUint8(y++,c.length),h.setUint8(y++,u.length),h.setUint8(y++,n),Array.from(l,C=>h.setUint8(y++,C.charCodeAt(0))),Array.from(s,C=>h.setUint8(y++,C.charCodeAt(0))),Array.from(a,C=>h.setUint8(y++,C.charCodeAt(0))),Array.from(c,C=>h.setUint8(y++,C.charCodeAt(0))),Array.from(u,C=>h.setUint8(y++,C.charCodeAt(0)));var S=new Uint8Array(g.byteLength+r.byteLength);return S.set(new Uint8Array(g),0),S.set(new Uint8Array(r),g.byteLength),S.buffer}decode(t,n){if(this._isArrayBuffer(t)){let r=this._binaryDecode(t);return n(r)}if(typeof t=="string"){const r=JSON.parse(t),[o,i,a,s,l]=r;return n({join_ref:o,ref:i,topic:a,event:s,payload:l})}return n({})}_binaryDecode(t){const n=new DataView(t),r=n.getUint8(0),o=new TextDecoder;if(r===this.KINDS.userBroadcast)return this._decodeUserBroadcast(t,n,o)}_decodeUserBroadcast(t,n,r){const o=n.getUint8(1),i=n.getUint8(2),a=n.getUint8(3),s=n.getUint8(4);let l=this.HEADER_LENGTH+4;const c=r.decode(t.slice(l,l+o));l=l+o;const d=r.decode(t.slice(l,l+i));l=l+i;const u=r.decode(t.slice(l,l+a));l=l+a;const f=t.slice(l,t.byteLength),g=s===this.JSON_ENCODING?JSON.parse(r.decode(f)):f,h={type:this.BROADCAST_EVENT,event:d,payload:g};return a>0&&(h.meta=JSON.parse(u)),{join_ref:null,ref:null,topic:c,event:this.BROADCAST_EVENT,payload:h}}_isArrayBuffer(t){var n;return t instanceof ArrayBuffer||((n=t?.constructor)===null||n===void 0?void 0:n.name)==="ArrayBuffer"}_pick(t,n){return !t||typeof t!="object"?{}:Object.fromEntries(Object.entries(t).filter(([r])=>n.includes(r)))}}class M_{constructor(t,n){this.callback=t,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=n;}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0;}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback();},this.timerCalc(this.tries+1));}}var yt;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange";})(yt||(yt={}));const k0=(e,t,n={})=>{var r;const o=(r=n.skipTypes)!==null&&r!==void 0?r:[];return t?Object.keys(t).reduce((i,a)=>(i[a]=ZF(a,e,t,o),i),{}):{}},ZF=(e,t,n,r)=>{const o=t.find(s=>s.name===e),i=o?.type,a=n[e];return i&&!r.includes(i)?L_(i,a):Pg(a)},L_=(e,t)=>{if(e.charAt(0)==="_"){const n=e.slice(1,e.length);return r5(t,n)}switch(e){case yt.bool:return e5(t);case yt.float4:case yt.float8:case yt.int2:case yt.int4:case yt.int8:case yt.numeric:case yt.oid:return t5(t);case yt.json:case yt.jsonb:return n5(t);case yt.timestamp:return o5(t);case yt.abstime:case yt.date:case yt.daterange:case yt.int4range:case yt.int8range:case yt.money:case yt.reltime:case yt.text:case yt.time:case yt.timestamptz:case yt.timetz:case yt.tsrange:case yt.tstzrange:return Pg(t);default:return Pg(t)}},Pg=e=>e,e5=e=>{switch(e){case "t":return  true;case "f":return  false;default:return e}},t5=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},n5=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e},r5=(e,t)=>{if(typeof e!="string")return e;const n=e.length-1,r=e[n];if(e[0]==="{"&&r==="}"){let i;const a=e.slice(1,n);try{i=JSON.parse("["+a+"]");}catch{i=a?a.split(","):[];}return i.map(s=>L_(t,s))}return e},o5=e=>typeof e=="string"?e.replace(" ","T"):e,O_=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class lh{constructor(t,n,r={},o=Tg){this.channel=t,this.event=n,this.payload=r,this.timeout=o,this.sent=false,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null;}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=false,this.send();}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=true,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}));}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t);}receive(t,n){var r;return this._hasReceived(t)&&n((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:t,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n);};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{});},this.timeout);}trigger(t,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:n});}destroy(){this._cancelRefEvent(),this._cancelTimeout();}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{});}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0;}_matchReceive({status:t,response:n}){this.recHooks.filter(r=>r.status===t).forEach(r=>r.callback(n));}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var E0;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave";})(E0||(E0={}));class hl{constructor(t,n){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=false,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=n?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},o=>{const{onJoin:i,onLeave:a,onSync:s}=this.caller;this.joinRef=this.channel._joinRef(),this.state=hl.syncState(this.state,o,i,a),this.pendingDiffs.forEach(l=>{this.state=hl.syncDiff(this.state,l,i,a);}),this.pendingDiffs=[],s();}),this.channel._on(r.diff,{},o=>{const{onJoin:i,onLeave:a,onSync:s}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=hl.syncDiff(this.state,o,i,a),s());}),this.onJoin((o,i,a)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:i,newPresences:a});}),this.onLeave((o,i,a)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:i,leftPresences:a});}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"});});}static syncState(t,n,r,o){const i=this.cloneDeep(t),a=this.transformState(n),s={},l={};return this.map(i,(c,d)=>{a[c]||(l[c]=d);}),this.map(a,(c,d)=>{const u=i[c];if(u){const f=d.map(S=>S.presence_ref),g=u.map(S=>S.presence_ref),h=d.filter(S=>g.indexOf(S.presence_ref)<0),y=u.filter(S=>f.indexOf(S.presence_ref)<0);h.length>0&&(s[c]=h),y.length>0&&(l[c]=y);}else s[c]=d;}),this.syncDiff(i,{joins:s,leaves:l},r,o)}static syncDiff(t,n,r,o){const{joins:i,leaves:a}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return r||(r=()=>{}),o||(o=()=>{}),this.map(i,(s,l)=>{var c;const d=(c=t[s])!==null&&c!==void 0?c:[];if(t[s]=this.cloneDeep(l),d.length>0){const u=t[s].map(g=>g.presence_ref),f=d.filter(g=>u.indexOf(g.presence_ref)<0);t[s].unshift(...f);}r(s,d,l);}),this.map(a,(s,l)=>{let c=t[s];if(!c)return;const d=l.map(u=>u.presence_ref);c=c.filter(u=>d.indexOf(u.presence_ref)<0),t[s]=c,o(s,c,l),c.length===0&&delete t[s];}),t}static map(t,n){return Object.getOwnPropertyNames(t).map(r=>n(r,t[r]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((n,r)=>{const o=t[r];return "metas"in o?n[r]=o.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):n[r]=o,n},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t;}onLeave(t){this.caller.onLeave=t;}onSync(t){this.caller.onSync=t;}inPendingSyncState(){return !this.joinRef||this.joinRef!==this.channel._joinRef()}}var A0;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE";})(A0||(A0={}));var gl;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system";})(gl||(gl={}));var Wr;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR";})(Wr||(Wr={}));class ba{constructor(t,n={config:{}},r){var o,i;if(this.topic=t,this.params=n,this.socket=r,this.bindings={},this.state=Gt.closed,this.joinedOnce=false,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:false,self:false},presence:{key:"",enabled:false},private:false},n.config),this.timeout=this.socket.timeout,this.joinPush=new lh(this,ar.join,this.params,this.timeout),this.rejoinTimer=new M_(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Gt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(a=>a.send()),this.pushBuffer=[];}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Gt.closed,this.socket._remove(this);}),this._onError(a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=Gt.errored,this.rejoinTimer.scheduleTimeout());}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Gt.errored,this.rejoinTimer.scheduleTimeout());}),this.joinPush.receive("error",a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=Gt.errored,this.rejoinTimer.scheduleTimeout());}),this._on(ar.reply,{},(a,s)=>{this._trigger(this._replyEventName(s),a);}),this.presence=new hl(this),this.broadcastEndpointURL=O_(this.socket.endPoint),this.private=this.params.config.private||false,!this.private&&(!((i=(o=this.params.config)===null||o===void 0?void 0:o.broadcast)===null||i===void 0)&&i.replay))throw `tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,n=this.timeout){var r,o,i;if(this.socket.isConnected()||this.socket.connect(),this.state==Gt.closed){const{config:{broadcast:a,presence:s,private:l}}=this.params,c=(o=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(g=>g.filter))!==null&&o!==void 0?o:[],d=!!this.bindings[gl.PRESENCE]&&this.bindings[gl.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===true,u={},f={broadcast:a,presence:Object.assign(Object.assign({},s),{enabled:d}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(u.access_token=this.socket.accessTokenValue),this._onError(g=>t?.(Wr.CHANNEL_ERROR,g)),this._onClose(()=>t?.(Wr.CLOSED)),this.updateJoinPayload(Object.assign({config:f},u)),this.joinedOnce=true,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:g})=>{var h;if(this.socket._isManualToken()||this.socket.setAuth(),g===void 0){t?.(Wr.SUBSCRIBED);return}else {const y=this.bindings.postgres_changes,S=(h=y?.length)!==null&&h!==void 0?h:0,C=[];for(let _=0;_<S;_++){const E=y[_],{filter:{event:P,schema:O,table:k,filter:I}}=E,R=g&&g[_];if(R&&R.event===P&&ba.isFilterValueEqual(R.schema,O)&&ba.isFilterValueEqual(R.table,k)&&ba.isFilterValueEqual(R.filter,I))C.push(Object.assign(Object.assign({},E),{id:R.id}));else {this.unsubscribe(),this.state=Gt.errored,t?.(Wr.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=C,t&&t(Wr.SUBSCRIBED);return}}).receive("error",g=>{this.state=Gt.errored,t?.(Wr.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(g).join(", ")||"error")));}).receive("timeout",()=>{t?.(Wr.TIMED_OUT);});}return this}presenceState(){return this.presence.state}async track(t,n={}){return await this.send({type:"presence",event:"track",payload:t},n.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,n,r){return this.state===Gt.joined&&t===gl.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(t,n,r)}async httpSend(t,n,r={}){var o;if(n==null)return Promise.reject("Payload is required for httpSend()");const i={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(i.Authorization=`Bearer ${this.socket.accessTokenValue}`);const a={method:"POST",headers:i,body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:n,private:this.private}]})},s=await this._fetchWithTimeout(this.broadcastEndpointURL,a,(o=r.timeout)!==null&&o!==void 0?o:this.timeout);if(s.status===202)return {success:true};let l=s.statusText;try{const c=await s.json();l=c.error||c.message||l;}catch{}return Promise.reject(new Error(l))}async send(t,n={}){var r,o;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:a}=t,s={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(s.Authorization=`Bearer ${this.socket.accessTokenValue}`);const l={method:"POST",headers:s,body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:a,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=n.timeout)!==null&&r!==void 0?r:this.timeout);return await((o=c.body)===null||o===void 0?void 0:o.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var a,s,l;const c=this._push(t.type,t,n.timeout||this.timeout);t.type==="broadcast"&&!(!((l=(s=(a=this.params)===null||a===void 0?void 0:a.config)===null||s===void 0?void 0:s.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),c.receive("ok",()=>i("ok")),c.receive("error",()=>i("error")),c.receive("timeout",()=>i("timed out"));})}updateJoinPayload(t){this.joinPush.updatePayload(t);}unsubscribe(t=this.timeout){this.state=Gt.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ar.close,"leave",this._joinRef());};this.joinPush.destroy();let r=null;return new Promise(o=>{r=new lh(this,ar.leave,{},t),r.receive("ok",()=>{n(),o("ok");}).receive("timeout",()=>{n(),o("timed out");}).receive("error",()=>{o("error");}),r.send(),this._canPush()||r.trigger("ok",{});}).finally(()=>{r?.destroy();})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Gt.closed,this.bindings={};}async _fetchWithTimeout(t,n,r){const o=new AbortController,i=setTimeout(()=>o.abort(),r),a=await this.socket.fetch(t,Object.assign(Object.assign({},n),{signal:o.signal}));return clearTimeout(i),a}_push(t,n,r=this.timeout){if(!this.joinedOnce)throw `tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new lh(this,t,n,r);return this._canPush()?o.send():this._addToPushBuffer(o),o}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>JF){const n=this.pushBuffer.shift();n&&(n.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${n.event}`,n.payload));}}_onMessage(t,n,r){return n}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,n,r){var o,i;const a=t.toLocaleLowerCase(),{close:s,error:l,leave:c,join:d}=ar;if(r&&[s,l,c,d].indexOf(a)>=0&&r!==this._joinRef())return;let f=this._onMessage(a,n,r);if(n&&!f)throw "channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(g=>{var h,y,S;return ((h=g.filter)===null||h===void 0?void 0:h.event)==="*"||((S=(y=g.filter)===null||y===void 0?void 0:y.event)===null||S===void 0?void 0:S.toLocaleLowerCase())===a}).map(g=>g.callback(f,r)):(i=this.bindings[a])===null||i===void 0||i.filter(g=>{var h,y,S,C,_,E;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in g){const P=g.id,O=(h=g.filter)===null||h===void 0?void 0:h.event;return P&&((y=n.ids)===null||y===void 0?void 0:y.includes(P))&&(O==="*"||O?.toLocaleLowerCase()===((S=n.data)===null||S===void 0?void 0:S.type.toLocaleLowerCase()))}else {const P=(_=(C=g?.filter)===null||C===void 0?void 0:C.event)===null||_===void 0?void 0:_.toLocaleLowerCase();return P==="*"||P===((E=n?.event)===null||E===void 0?void 0:E.toLocaleLowerCase())}else return g.type.toLocaleLowerCase()===a}).map(g=>{if(typeof f=="object"&&"ids"in f){const h=f.data,{schema:y,table:S,commit_timestamp:C,type:_,errors:E}=h;f=Object.assign(Object.assign({},{schema:y,table:S,commit_timestamp:C,eventType:_,new:{},old:{},errors:E}),this._getPayloadRecords(h));}g.callback(f,r);});}_isClosed(){return this.state===Gt.closed}_isJoined(){return this.state===Gt.joined}_isJoining(){return this.state===Gt.joining}_isLeaving(){return this.state===Gt.leaving}_replyEventName(t){return `chan_reply_${t}`}_on(t,n,r){const o=t.toLocaleLowerCase(),i={type:o,filter:n,callback:r};return this.bindings[o]?this.bindings[o].push(i):this.bindings[o]=[i],this}_off(t,n){const r=t.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(o=>{var i;return !(((i=o.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&ba.isEqual(o.filter,n))})),this}static isEqual(t,n){if(Object.keys(t).length!==Object.keys(n).length)return  false;for(const r in t)if(t[r]!==n[r])return  false;return  true}static isFilterValueEqual(t,n){return (t??void 0)===(n??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin();}_onClose(t){this._on(ar.close,{},t);}_onError(t){this._on(ar.error,{},n=>t(n));}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Gt.joining,this.joinPush.resend(t));}_getPayloadRecords(t){const n={new:{},old:{}};return (t.type==="INSERT"||t.type==="UPDATE")&&(n.new=k0(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(n.old=k0(t.columns,t.old_record)),n}}const ch=()=>{},sd={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},i5=[1e3,2e3,5e3,1e4],a5=1e4,s5=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class l5{constructor(t,n){var r;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=false,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Tg,this.transport=null,this.heartbeatIntervalMs=sd.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=ch,this.ref=0,this.reconnectTimer=null,this.vsn=_0,this.logger=ch,this.conn=null,this.sendBuffer=[],this.serializer=new QF,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=false,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=o=>o?(...i)=>o(...i):(...i)=>fetch(...i),!(!((r=n?.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=n.params.apikey,this.endPoint=`${t}/${Ig.websocket}`,this.httpEndpoint=O_(t),this._initializeOptions(n),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(n?.fetch);}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=VF.createWebSocket(this.endpointURL());}catch(t){this._setConnectionState("disconnected");const n=t.message;throw n.includes("Node.js")?new Error(`${n}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${n}`)}this._setupConnectionHandlers();}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,n){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",true),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected");},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected");},typeof this.conn.close=="function"&&(t?this.conn.close(t,n??""):this.conn.close()),this._teardownConnection();}else this._setConnectionState("disconnected");}getChannels(){return this.channels}async removeChannel(t){const n=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const t=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,n,r){this.logger(t,n,r);}connectionState(){switch(this.conn&&this.conn.readyState){case Co.connecting:return si.Connecting;case Co.open:return si.Open;case Co.closing:return si.Closing;default:return si.Closed}}isConnected(){return this.connectionState()===si.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,n={config:{}}){const r=`realtime:${t}`,o=this.getChannels().find(i=>i.topic===r);if(o)return o;{const i=new ba(`realtime:${t}`,n,this);return this.channels.push(i),i}}push(t){const{topic:n,event:r,payload:o,ref:i}=t,a=()=>{this.encode(t,s=>{var l;(l=this.conn)===null||l===void 0||l.send(s);});};this.log("push",`${n} ${r} (${i})`,o),this.isConnected()?a():this.sendBuffer.push(a);}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise;}finally{this._authPromise=null;}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected");}catch(n){this.log("error","error in heartbeat callback",n);}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout");}catch(n){this.log("error","error in heartbeat callback",n);}this._wasManualDisconnect=false,(t=this.conn)===null||t===void 0||t.close(YF,"heartbeat timeout"),setTimeout(()=>{var n;this.isConnected()||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout();},sd.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent");}catch(n){this.log("error","error in heartbeat callback",n);}this._setAuthSafely("heartbeat");}onHeartbeat(t){this.heartbeatCallback=t;}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[]);}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let n=this.channels.find(r=>r.topic===t&&(r._isJoined()||r._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${t}"`),n.unsubscribe());}_remove(t){this.channels=this.channels.filter(n=>n.topic!==t.topic);}_onConnMessage(t){this.decode(t.data,n=>{if(n.topic==="phoenix"&&n.event==="phx_reply"&&n.ref&&n.ref===this.pendingHeartbeatRef){const c=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(n.payload.status==="ok"?"ok":"error",c);}catch(d){this.log("error","error in heartbeat callback",d);}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null;}const{topic:r,event:o,payload:i,ref:a}=n,s=a?`(${a})`:"",l=i.status||"";this.log("receive",`${l} ${r} ${o} ${s}`.trim(),i),this.channels.filter(c=>c._isMember(r)).forEach(c=>c._trigger(o,i,a)),this._triggerStateCallbacks("message",n);});}_clearTimer(t){var n;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((n=this.reconnectTimer)===null||n===void 0||n.reset());}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect");}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t),this.conn.readyState===Co.open&&this._onConnOpen());}_teardownConnection(){if(this.conn){if(this.conn.readyState===Co.open||this.conn.readyState===Co.connecting)try{this.conn.close();}catch(t){this.log("error","Error closing connection",t);}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null;}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(t=>t.teardown());}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer();}).catch(n=>{this.log("error","error waiting for auth on connect",n),this.flushSendBuffer();}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open");}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this._terminateWorker();},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat();},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs});}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0);}_onConnClose(t){var n;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout(),this._triggerStateCallbacks("close",t);}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t);try{this.heartbeatCallback("error");}catch(n){this.log("error","error in heartbeat callback",n);}}_triggerChanError(){this.channels.forEach(t=>t._trigger(ar.error));}_appendParams(t,n){if(Object.keys(n).length===0)return t;const r=t.match(/\?/)?"&":"?",o=new URLSearchParams(n);return `${t}${r}${o}`}_workerObjectUrl(t){let n;if(t)n=t;else {const r=new Blob([s5],{type:"application/javascript"});n=URL.createObjectURL(r);}return n}_setConnectionState(t,n=false){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=false:t==="disconnecting"&&(this._wasManualDisconnect=n);}async _performAuth(t=null){let n,r=false;if(t)n=t,r=true;else if(this.accessToken)try{n=await this.accessToken();}catch(o){this.log("error","Error fetching access token from callback",o),n=this.accessTokenValue;}else n=this.accessTokenValue;r?this._manuallySetToken=true:this.accessToken&&(this._manuallySetToken=false),this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(o=>{const i={access_token:n,version:KF};n&&o.updateJoinPayload(i),o.joinedOnce&&o._isJoined()&&o._push(ar.access_token,{access_token:n});}));}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise;}_setAuthSafely(t="general"){this._isManualToken()||this.setAuth().catch(n=>{this.log("error",`Error setting auth in ${t}`,n);});}_triggerStateCallbacks(t,n){try{this.stateChangeCallbacks[t].forEach(r=>{try{r(n);}catch(o){this.log("error",`error in ${t} callback`,o);}});}catch(r){this.log("error",`error triggering ${t} callbacks`,r);}}_setupReconnectionTimer(){this.reconnectTimer=new M_(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect();},sd.RECONNECT_DELAY);},this.reconnectAfterMs);}_initializeOptions(t){var n,r,o,i,a,s,l,c,d,u,f,g;switch(this.transport=(n=t?.transport)!==null&&n!==void 0?n:null,this.timeout=(r=t?.timeout)!==null&&r!==void 0?r:Tg,this.heartbeatIntervalMs=(o=t?.heartbeatIntervalMs)!==null&&o!==void 0?o:sd.HEARTBEAT_INTERVAL,this.worker=(i=t?.worker)!==null&&i!==void 0?i:false,this.accessToken=(a=t?.accessToken)!==null&&a!==void 0?a:null,this.heartbeatCallback=(s=t?.heartbeatCallback)!==null&&s!==void 0?s:ch,this.vsn=(l=t?.vsn)!==null&&l!==void 0?l:_0,t?.params&&(this.params=t.params),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=t?.reconnectAfterMs)!==null&&c!==void 0?c:(h=>i5[h-1]||a5),this.vsn){case XF:this.encode=(d=t?.encode)!==null&&d!==void 0?d:((h,y)=>y(JSON.stringify(h))),this.decode=(u=t?.decode)!==null&&u!==void 0?u:((h,y)=>y(JSON.parse(h)));break;case R_:this.encode=(f=t?.encode)!==null&&f!==void 0?f:this.serializer.encode.bind(this.serializer),this.decode=(g=t?.decode)!==null&&g!==void 0?g:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t?.workerUrl;}}}var Fl=class extends Error{constructor(e,t){super(e),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown=t.icebergType==="CommitStateUnknownException"||[500,502,504].includes(t.status)&&t.icebergType?.includes("CommitState")===true;}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function c5(e,t,n){const r=new URL(t,e);if(n)for(const[o,i]of Object.entries(n))i!==void 0&&r.searchParams.set(o,i);return r.toString()}async function d5(e){return !e||e.type==="none"?{}:e.type==="bearer"?{Authorization:`Bearer ${e.token}`}:e.type==="header"?{[e.name]:e.value}:e.type==="custom"?await e.getHeaders():{}}function u5(e){const t=e.fetchImpl??globalThis.fetch;return {async request({method:n,path:r,query:o,body:i,headers:a}){const s=c5(e.baseUrl,r,o),l=await d5(e.auth),c=await t(s,{method:n,headers:{...i?{"Content-Type":"application/json"}:{},...l,...a},body:i?JSON.stringify(i):void 0}),d=await c.text(),u=(c.headers.get("content-type")||"").includes("application/json"),f=u&&d?JSON.parse(d):d;if(!c.ok){const g=u?f:void 0,h=g?.error;throw new Fl(h?.message??`Request failed with status ${c.status}`,{status:c.status,icebergType:h?.type,icebergCode:h?.code,details:g})}return {status:c.status,headers:c.headers,data:f}}}}function ld(e){return e.join("")}var p5=class{constructor(e,t=""){this.client=e,this.prefix=t;}async listNamespaces(e){const t=e?{parent:ld(e.namespace)}:void 0;return (await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(r=>({namespace:r}))}async createNamespace(e,t){const n={namespace:e.namespace,properties:t?.properties};return (await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:n})).data}async dropNamespace(e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${ld(e.namespace)}`});}async loadNamespaceMetadata(e){return {properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${ld(e.namespace)}`})).data.properties}}async namespaceExists(e){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${ld(e.namespace)}`}),!0}catch(t){if(t instanceof Fl&&t.status===404)return  false;throw t}}async createNamespaceIfNotExists(e,t){try{return await this.createNamespace(e,t)}catch(n){if(n instanceof Fl&&n.status===409)return;throw n}}};function Yi(e){return e.join("")}var f5=class{constructor(e,t="",n){this.client=e,this.prefix=t,this.accessDelegation=n;}async listTables(e){return (await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Yi(e.namespace)}/tables`})).data.identifiers}async createTable(e,t){const n={};return this.accessDelegation&&(n["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Yi(e.namespace)}/tables`,body:t,headers:n})).data.metadata}async updateTable(e,t){const n=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Yi(e.namespace)}/tables/${e.name}`,body:t});return {"metadata-location":n.data["metadata-location"],metadata:n.data.metadata}}async dropTable(e,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Yi(e.namespace)}/tables/${e.name}`,query:{purgeRequested:String(t?.purge??false)}});}async loadTable(e){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Yi(e.namespace)}/tables/${e.name}`,headers:t})).data.metadata}async tableExists(e){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Yi(e.namespace)}/tables/${e.name}`,headers:t}),!0}catch(n){if(n instanceof Fl&&n.status===404)return  false;throw n}}async createTableIfNotExists(e,t){try{return await this.createTable(e,t)}catch(n){if(n instanceof Fl&&n.status===409)return await this.loadTable({namespace:e.namespace,name:t.name});throw n}}},h5=class{constructor(e){let t="v1";e.catalogName&&(t+=`/${e.catalogName}`);const n=e.baseUrl.endsWith("/")?e.baseUrl:`${e.baseUrl}/`;this.client=u5({baseUrl:n,auth:e.auth,fetchImpl:e.fetch}),this.accessDelegation=e.accessDelegation?.join(","),this.namespaceOps=new p5(this.client,t),this.tableOps=new f5(this.client,t,this.accessDelegation);}async listNamespaces(e){return this.namespaceOps.listNamespaces(e)}async createNamespace(e,t){return this.namespaceOps.createNamespace(e,t)}async dropNamespace(e){await this.namespaceOps.dropNamespace(e);}async loadNamespaceMetadata(e){return this.namespaceOps.loadNamespaceMetadata(e)}async listTables(e){return this.tableOps.listTables(e)}async createTable(e,t){return this.tableOps.createTable(e,t)}async updateTable(e,t){return this.tableOps.updateTable(e,t)}async dropTable(e,t){await this.tableOps.dropTable(e,t);}async loadTable(e){return this.tableOps.loadTable(e)}async namespaceExists(e){return this.namespaceOps.namespaceExists(e)}async tableExists(e){return this.tableOps.tableExists(e)}async createNamespaceIfNotExists(e,t){return this.namespaceOps.createNamespaceIfNotExists(e,t)}async createTableIfNotExists(e,t){return this.tableOps.createTableIfNotExists(e,t)}},jp=class extends Error{constructor(e,t="storage",n,r){super(e),this.__isStorageError=true,this.namespace=t,this.name=t==="vectors"?"StorageVectorsError":"StorageError",this.status=n,this.statusCode=r;}};function Gp(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}var cd=class extends jp{constructor(e,t,n,r="storage"){super(e,r,t,n),this.name=r==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=t,this.statusCode=n;}toJSON(){return {name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},N_=class extends jp{constructor(e,t,n="storage"){super(e,n),this.name=n==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=t;}};const g5=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),m5=e=>{if(typeof e!="object"||e===null)return  false;const t=Object.getPrototypeOf(e);return (t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},Rg=e=>{if(Array.isArray(e))return e.map(n=>Rg(n));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([n,r])=>{const o=n.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));t[o]=Rg(r);}),t},b5=e=>!e||typeof e!="string"||e.length===0||e.length>100||e.trim()!==e||e.includes("/")||e.includes("\\")?false:/^[\w!.\*'() &$@=;:+,?-]+$/.test(e);function Bl(e){"@babel/helpers - typeof";return Bl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bl(e)}function v5(e,t){if(Bl(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(Bl(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return (t==="string"?String:Number)(e)}function y5(e){var t=v5(e,"string");return Bl(t)=="symbol"?t:t+""}function w5(e,t,n){return (t=y5(t))in e?Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true}):e[t]=n,e}function T0(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r);}return n}function Be(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?T0(Object(n),true).forEach(function(r){w5(e,r,n[r]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T0(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r));});}return e}const I0=e=>{var t;return e.msg||e.message||e.error_description||(typeof e.error=="string"?e.error:(t=e.error)===null||t===void 0?void 0:t.message)||JSON.stringify(e)},x5=async(e,t,n,r)=>{if(e&&typeof e=="object"&&"status"in e&&"ok"in e&&typeof e.status=="number"&&!n?.noResolveJson){const o=e,i=o.status||500;if(typeof o.json=="function")o.json().then(a=>{const s=a?.statusCode||a?.code||i+"";t(new cd(I0(a),i,s,r));}).catch(()=>{if(r==="vectors"){const a=i+"";t(new cd(o.statusText||`HTTP ${i} error`,i,a,r));}else {const a=i+"";t(new cd(o.statusText||`HTTP ${i} error`,i,a,r));}});else {const a=i+"";t(new cd(o.statusText||`HTTP ${i} error`,i,a,r));}}else t(new N_(I0(e),e,r));},C5=(e,t,n,r)=>{const o={method:e,headers:t?.headers||{}};return e==="GET"||e==="HEAD"||!r?Be(Be({},o),n):(m5(r)?(o.headers=Be({"Content-Type":"application/json"},t?.headers),o.body=JSON.stringify(r)):o.body=r,t?.duplex&&(o.duplex=t.duplex),Be(Be({},o),n))};async function Cs(e,t,n,r,o,i,a){return new Promise((s,l)=>{e(n,C5(t,r,o,i)).then(c=>{if(!c.ok)throw c;if(r?.noResolveJson)return c;if(a==="vectors"){const d=c.headers.get("content-type");if(c.headers.get("content-length")==="0"||c.status===204)return {};if(!d||!d.includes("application/json"))return {}}return c.json()}).then(c=>s(c)).catch(c=>x5(c,l,r,a));})}function $_(e="storage"){return {get:async(t,n,r,o)=>Cs(t,"GET",n,r,o,void 0,e),post:async(t,n,r,o,i)=>Cs(t,"POST",n,o,i,r,e),put:async(t,n,r,o,i)=>Cs(t,"PUT",n,o,i,r,e),head:async(t,n,r,o)=>Cs(t,"HEAD",n,Be(Be({},r),{},{noResolveJson:true}),o,void 0,e),remove:async(t,n,r,o,i)=>Cs(t,"DELETE",n,o,i,r,e)}}const S5=$_("storage"),{get:jl,post:ir,put:Mg,head:_5,remove:Db}=S5,Nn=$_("vectors");var ns=class{constructor(e,t={},n,r="storage"){this.shouldThrowOnError=false,this.url=e,this.headers=t,this.fetch=g5(n),this.namespace=r;}throwOnError(){return this.shouldThrowOnError=true,this}async handleOperation(e){var t=this;try{return {data:await e(),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(Gp(n))return {data:null,error:n};throw n}}},k5=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t;}then(e,t){return this.execute().then(e,t)}async execute(){var e=this;try{return {data:(await e.downloadFn()).body,error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Gp(t))return {data:null,error:t};throw t}}};let D_;D_=Symbol.toStringTag;var E5=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[D_]="BlobDownloadBuilder",this.promise=null;}asStream(){return new k5(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var e=this;try{return {data:await(await e.downloadFn()).blob(),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Gp(t))return {data:null,error:t};throw t}}};const A5={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},P0={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:false};var T5=class extends ns{constructor(e,t={},n,r){super(e,t,r,"storage"),this.bucketId=n;}async uploadOrUpdate(e,t,n,r){var o=this;return o.handleOperation(async()=>{let i;const a=Be(Be({},P0),r);let s=Be(Be({},o.headers),e==="POST"&&{"x-upsert":String(a.upsert)});const l=a.metadata;typeof Blob<"u"&&n instanceof Blob?(i=new FormData,i.append("cacheControl",a.cacheControl),l&&i.append("metadata",o.encodeMetadata(l)),i.append("",n)):typeof FormData<"u"&&n instanceof FormData?(i=n,i.has("cacheControl")||i.append("cacheControl",a.cacheControl),l&&!i.has("metadata")&&i.append("metadata",o.encodeMetadata(l))):(i=n,s["cache-control"]=`max-age=${a.cacheControl}`,s["content-type"]=a.contentType,l&&(s["x-metadata"]=o.toBase64(o.encodeMetadata(l))),(typeof ReadableStream<"u"&&i instanceof ReadableStream||i&&typeof i=="object"&&"pipe"in i&&typeof i.pipe=="function")&&!a.duplex&&(a.duplex="half")),r?.headers&&(s=Be(Be({},s),r.headers));const c=o._removeEmptyFolders(t),d=o._getFinalPath(c),u=await(e=="PUT"?Mg:ir)(o.fetch,`${o.url}/object/${d}`,i,Be({headers:s},a?.duplex?{duplex:a.duplex}:{}));return {path:c,id:u.Id,fullPath:u.Key}})}async upload(e,t,n){return this.uploadOrUpdate("POST",e,t,n)}async uploadToSignedUrl(e,t,n,r){var o=this;const i=o._removeEmptyFolders(e),a=o._getFinalPath(i),s=new URL(o.url+`/object/upload/sign/${a}`);return s.searchParams.set("token",t),o.handleOperation(async()=>{let l;const c=Be({upsert:P0.upsert},r),d=Be(Be({},o.headers),{"x-upsert":String(c.upsert)});return typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.append("cacheControl",c.cacheControl)):(l=n,d["cache-control"]=`max-age=${c.cacheControl}`,d["content-type"]=c.contentType),{path:i,fullPath:(await Mg(o.fetch,s.toString(),l,{headers:d})).Key}})}async createSignedUploadUrl(e,t){var n=this;return n.handleOperation(async()=>{let r=n._getFinalPath(e);const o=Be({},n.headers);t?.upsert&&(o["x-upsert"]="true");const i=await ir(n.fetch,`${n.url}/object/upload/sign/${r}`,{},{headers:o}),a=new URL(n.url+i.url),s=a.searchParams.get("token");if(!s)throw new jp("No token returned by API");return {signedUrl:a.toString(),path:e,token:s}})}async update(e,t,n){return this.uploadOrUpdate("PUT",e,t,n)}async move(e,t,n){var r=this;return r.handleOperation(async()=>await ir(r.fetch,`${r.url}/object/move`,{bucketId:r.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n?.destinationBucket},{headers:r.headers}))}async copy(e,t,n){var r=this;return r.handleOperation(async()=>({path:(await ir(r.fetch,`${r.url}/object/copy`,{bucketId:r.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n?.destinationBucket},{headers:r.headers})).Key}))}async createSignedUrl(e,t,n){var r=this;return r.handleOperation(async()=>{let o=r._getFinalPath(e),i=await ir(r.fetch,`${r.url}/object/sign/${o}`,Be({expiresIn:t},n?.transform?{transform:n.transform}:{}),{headers:r.headers});const a=n?.download?`&download=${n.download===true?"":n.download}`:"";return {signedUrl:encodeURI(`${r.url}${i.signedURL}${a}`)}})}async createSignedUrls(e,t,n){var r=this;return r.handleOperation(async()=>{const o=await ir(r.fetch,`${r.url}/object/sign/${r.bucketId}`,{expiresIn:t,paths:e},{headers:r.headers}),i=n?.download?`&download=${n.download===true?"":n.download}`:"";return o.map(a=>Be(Be({},a),{},{signedUrl:a.signedURL?encodeURI(`${r.url}${a.signedURL}${i}`):null}))})}download(e,t){const n=typeof t?.transform<"u"?"render/image/authenticated":"object",r=this.transformOptsToQueryString(t?.transform||{}),o=r?`?${r}`:"",i=this._getFinalPath(e),a=()=>jl(this.fetch,`${this.url}/${n}/${i}${o}`,{headers:this.headers,noResolveJson:true});return new E5(a,this.shouldThrowOnError)}async info(e){var t=this;const n=t._getFinalPath(e);return t.handleOperation(async()=>Rg(await jl(t.fetch,`${t.url}/object/info/${n}`,{headers:t.headers})))}async exists(e){var t=this;const n=t._getFinalPath(e);try{return await _5(t.fetch,`${t.url}/object/${n}`,{headers:t.headers}),{data:!0,error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Gp(r)&&r instanceof N_){const o=r.originalError;if([400,404].includes(o?.status))return {data:false,error:r}}throw r}}getPublicUrl(e,t){const n=this._getFinalPath(e),r=[],o=t?.download?`download=${t.download===true?"":t.download}`:"";o!==""&&r.push(o);const i=typeof t?.transform<"u"?"render/image":"object",a=this.transformOptsToQueryString(t?.transform||{});a!==""&&r.push(a);let s=r.join("&");return s!==""&&(s=`?${s}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${n}${s}`)}}}async remove(e){var t=this;return t.handleOperation(async()=>await Db(t.fetch,`${t.url}/object/${t.bucketId}`,{prefixes:e},{headers:t.headers}))}async list(e,t,n){var r=this;return r.handleOperation(async()=>{const o=Be(Be(Be({},A5),t),{},{prefix:e||""});return await ir(r.fetch,`${r.url}/object/list/${r.bucketId}`,o,{headers:r.headers},n)})}async listV2(e,t){var n=this;return n.handleOperation(async()=>{const r=Be({},e);return await ir(n.fetch,`${n.url}/object/list-v2/${n.bucketId}`,r,{headers:n.headers},t)})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return `${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}};const I5="2.94.0",bc={"X-Client-Info":`storage-js/${I5}`};var P5=class extends ns{constructor(e,t={},n,r){const o=new URL(e);r?.useNewHostname&&/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase."));const i=o.href.replace(/\/$/,""),a=Be(Be({},bc),t);super(i,a,n,"storage");}async listBuckets(e){var t=this;return t.handleOperation(async()=>{const n=t.listBucketOptionsToQueryString(e);return await jl(t.fetch,`${t.url}/bucket${n}`,{headers:t.headers})})}async getBucket(e){var t=this;return t.handleOperation(async()=>await jl(t.fetch,`${t.url}/bucket/${e}`,{headers:t.headers}))}async createBucket(e,t={public:false}){var n=this;return n.handleOperation(async()=>await ir(n.fetch,`${n.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:n.headers}))}async updateBucket(e,t){var n=this;return n.handleOperation(async()=>await Mg(n.fetch,`${n.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:n.headers}))}async emptyBucket(e){var t=this;return t.handleOperation(async()=>await ir(t.fetch,`${t.url}/bucket/${e}/empty`,{},{headers:t.headers}))}async deleteBucket(e){var t=this;return t.handleOperation(async()=>await Db(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}))}listBucketOptionsToQueryString(e){const t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},R5=class extends ns{constructor(e,t={},n){const r=e.replace(/\/$/,""),o=Be(Be({},bc),t);super(r,o,n,"storage");}async createBucket(e){var t=this;return t.handleOperation(async()=>await ir(t.fetch,`${t.url}/bucket`,{name:e},{headers:t.headers}))}async listBuckets(e){var t=this;return t.handleOperation(async()=>{const n=new URLSearchParams;e?.limit!==void 0&&n.set("limit",e.limit.toString()),e?.offset!==void 0&&n.set("offset",e.offset.toString()),e?.sortColumn&&n.set("sortColumn",e.sortColumn),e?.sortOrder&&n.set("sortOrder",e.sortOrder),e?.search&&n.set("search",e.search);const r=n.toString(),o=r?`${t.url}/bucket?${r}`:`${t.url}/bucket`;return await jl(t.fetch,o,{headers:t.headers})})}async deleteBucket(e){var t=this;return t.handleOperation(async()=>await Db(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}))}from(e){var t=this;if(!b5(e))throw new jp("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const n=new h5({baseUrl:this.url,catalogName:e,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),r=this.shouldThrowOnError;return new Proxy(n,{get(o,i){const a=o[i];return typeof a!="function"?a:async(...s)=>{try{return {data:await a.apply(o,s),error:null}}catch(l){if(r)throw l;return {data:null,error:l}}}}})}},M5=class extends ns{constructor(e,t={},n){const r=e.replace(/\/$/,""),o=Be(Be({},bc),{},{"Content-Type":"application/json"},t);super(r,o,n,"vectors");}async createIndex(e){var t=this;return t.handleOperation(async()=>await Nn.post(t.fetch,`${t.url}/CreateIndex`,e,{headers:t.headers})||{})}async getIndex(e,t){var n=this;return n.handleOperation(async()=>await Nn.post(n.fetch,`${n.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:n.headers}))}async listIndexes(e){var t=this;return t.handleOperation(async()=>await Nn.post(t.fetch,`${t.url}/ListIndexes`,e,{headers:t.headers}))}async deleteIndex(e,t){var n=this;return n.handleOperation(async()=>await Nn.post(n.fetch,`${n.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:n.headers})||{})}},L5=class extends ns{constructor(e,t={},n){const r=e.replace(/\/$/,""),o=Be(Be({},bc),{},{"Content-Type":"application/json"},t);super(r,o,n,"vectors");}async putVectors(e){var t=this;if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return t.handleOperation(async()=>await Nn.post(t.fetch,`${t.url}/PutVectors`,e,{headers:t.headers})||{})}async getVectors(e){var t=this;return t.handleOperation(async()=>await Nn.post(t.fetch,`${t.url}/GetVectors`,e,{headers:t.headers}))}async listVectors(e){var t=this;if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return t.handleOperation(async()=>await Nn.post(t.fetch,`${t.url}/ListVectors`,e,{headers:t.headers}))}async queryVectors(e){var t=this;return t.handleOperation(async()=>await Nn.post(t.fetch,`${t.url}/QueryVectors`,e,{headers:t.headers}))}async deleteVectors(e){var t=this;if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return t.handleOperation(async()=>await Nn.post(t.fetch,`${t.url}/DeleteVectors`,e,{headers:t.headers})||{})}},O5=class extends ns{constructor(e,t={},n){const r=e.replace(/\/$/,""),o=Be(Be({},bc),{},{"Content-Type":"application/json"},t);super(r,o,n,"vectors");}async createBucket(e){var t=this;return t.handleOperation(async()=>await Nn.post(t.fetch,`${t.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{})}async getBucket(e){var t=this;return t.handleOperation(async()=>await Nn.post(t.fetch,`${t.url}/GetVectorBucket`,{vectorBucketName:e},{headers:t.headers}))}async listBuckets(e={}){var t=this;return t.handleOperation(async()=>await Nn.post(t.fetch,`${t.url}/ListVectorBuckets`,e,{headers:t.headers}))}async deleteBucket(e){var t=this;return t.handleOperation(async()=>await Nn.post(t.fetch,`${t.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{})}},N5=class extends O5{constructor(e,t={}){super(e,t.headers||{},t.fetch);}from(e){return new $5(this.url,this.headers,e,this.fetch)}async createBucket(e){var t=()=>super.createBucket,n=this;return t().call(n,e)}async getBucket(e){var t=()=>super.getBucket,n=this;return t().call(n,e)}async listBuckets(e={}){var t=()=>super.listBuckets,n=this;return t().call(n,e)}async deleteBucket(e){var t=()=>super.deleteBucket,n=this;return t().call(n,e)}},$5=class extends M5{constructor(e,t,n,r){super(e,t,r),this.vectorBucketName=n;}async createIndex(e){var t=()=>super.createIndex,n=this;return t().call(n,Be(Be({},e),{},{vectorBucketName:n.vectorBucketName}))}async listIndexes(e={}){var t=()=>super.listIndexes,n=this;return t().call(n,Be(Be({},e),{},{vectorBucketName:n.vectorBucketName}))}async getIndex(e){var t=()=>super.getIndex,n=this;return t().call(n,n.vectorBucketName,e)}async deleteIndex(e){var t=()=>super.deleteIndex,n=this;return t().call(n,n.vectorBucketName,e)}index(e){return new D5(this.url,this.headers,this.vectorBucketName,e,this.fetch)}},D5=class extends L5{constructor(e,t,n,r,o){super(e,t,o),this.vectorBucketName=n,this.indexName=r;}async putVectors(e){var t=()=>super.putVectors,n=this;return t().call(n,Be(Be({},e),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async getVectors(e){var t=()=>super.getVectors,n=this;return t().call(n,Be(Be({},e),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async listVectors(e={}){var t=()=>super.listVectors,n=this;return t().call(n,Be(Be({},e),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async queryVectors(e){var t=()=>super.queryVectors,n=this;return t().call(n,Be(Be({},e),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async deleteVectors(e){var t=()=>super.deleteVectors,n=this;return t().call(n,Be(Be({},e),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}},F5=class extends P5{constructor(e,t={},n,r){super(e,t,n,r);}from(e){return new T5(this.url,this.headers,e,this.fetch)}get vectors(){return new N5(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new R5(this.url+"/iceberg",this.headers,this.fetch)}};const F_="2.94.0",sa=30*1e3,Lg=3,dh=Lg*sa,B5="http://localhost:9999",j5="supabase.auth.token",G5={"X-Client-Info":`gotrue-js/${F_}`},Og="X-Supabase-Api-Version",B_={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},z5=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,U5=600*1e3;class Gl extends Error{constructor(t,n,r){super(t),this.__isAuthError=true,this.name="AuthError",this.status=n,this.code=r;}}function Re(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class H5 extends Gl{constructor(t,n,r){super(t,n,r),this.name="AuthApiError",this.status=n,this.code=r;}}function W5(e){return Re(e)&&e.name==="AuthApiError"}class li extends Gl{constructor(t,n){super(t),this.name="AuthUnknownError",this.originalError=n;}}class fo extends Gl{constructor(t,n,r,o){super(t,r,o),this.name=n,this.status=r;}}class Ln extends fo{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0);}}function uh(e){return Re(e)&&e.name==="AuthSessionMissingError"}class Ji extends fo{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0);}}class dd extends fo{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0);}}class ud extends fo{constructor(t,n=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n;}toJSON(){return {name:this.name,message:this.message,status:this.status,details:this.details}}}function V5(e){return Re(e)&&e.name==="AuthImplicitGrantRedirectError"}class R0 extends fo{constructor(t,n=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n;}toJSON(){return {name:this.name,message:this.message,status:this.status,details:this.details}}}class q5 extends fo{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found");}}class Ng extends fo{constructor(t,n){super(t,"AuthRetryableFetchError",n,void 0);}}function ph(e){return Re(e)&&e.name==="AuthRetryableFetchError"}class M0 extends fo{constructor(t,n,r){super(t,"AuthWeakPasswordError",n,"weak_password"),this.reasons=r;}}class $g extends fo{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt");}}const Wu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),L0=` 	
\r=`.split(""),K5=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<L0.length;t+=1)e[L0[t].charCodeAt(0)]=-2;for(let t=0;t<Wu.length;t+=1)e[Wu[t].charCodeAt(0)]=t;return e})();function O0(e,t,n){if(e!==null)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const r=t.queue>>t.queuedBits-6&63;n(Wu[r]),t.queuedBits-=6;}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const r=t.queue>>t.queuedBits-6&63;n(Wu[r]),t.queuedBits-=6;}}function j_(e,t,n){const r=K5[e];if(r>-1)for(t.queue=t.queue<<6|r,t.queuedBits+=6;t.queuedBits>=8;)n(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else {if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function N0(e){const t=[],n=a=>{t.push(String.fromCodePoint(a));},r={utf8seq:0,codepoint:0},o={queue:0,queuedBits:0},i=a=>{J5(a,r,n);};for(let a=0;a<e.length;a+=1)j_(e.charCodeAt(a),o,i);return t.join("")}function X5(e,t){if(e<=127){t(e);return}else if(e<=2047){t(192|e>>6),t(128|e&63);return}else if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|e&63);return}else if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function Y5(e,t){for(let n=0;n<e.length;n+=1){let r=e.charCodeAt(n);if(r>55295&&r<=56319){const o=(r-55296)*1024&65535;r=(e.charCodeAt(n+1)-56320&65535|o)+65536,n+=1;}X5(r,t);}}function J5(e,t,n){if(t.utf8seq===0){if(e<=127){n(e);return}for(let r=1;r<6;r+=1)if((e>>7-r&1)===0){t.utf8seq=r;break}if(t.utf8seq===2)t.codepoint=e&31;else if(t.utf8seq===3)t.codepoint=e&15;else if(t.utf8seq===4)t.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1;}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|e&63,t.utf8seq-=1,t.utf8seq===0&&n(t.codepoint);}}function ka(e){const t=[],n={queue:0,queuedBits:0},r=o=>{t.push(o);};for(let o=0;o<e.length;o+=1)j_(e.charCodeAt(o),n,r);return new Uint8Array(t)}function Q5(e){const t=[];return Y5(e,n=>t.push(n)),new Uint8Array(t)}function mi(e){const t=[],n={queue:0,queuedBits:0},r=o=>{t.push(o);};return e.forEach(o=>O0(o,n,r)),O0(null,n,r),t.join("")}function Z5(e){return Math.round(Date.now()/1e3)+e}function eB(){return Symbol("auth-callback")}const sn=()=>typeof window<"u"&&typeof document<"u",ni={tested:false,writable:false},G_=()=>{if(!sn())return  false;try{if(typeof globalThis.localStorage!="object")return !1}catch{return  false}if(ni.tested)return ni.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),ni.tested=!0,ni.writable=!0;}catch{ni.tested=true,ni.writable=false;}return ni.writable};function tB(e){const t={},n=new URL(e);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((o,i)=>{t[i]=o;});}catch{}return n.searchParams.forEach((r,o)=>{t[o]=r;}),t}const z_=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),nB=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",la=async(e,t,n)=>{await e.setItem(t,JSON.stringify(n));},ri=async(e,t)=>{const n=await e.getItem(t);if(!n)return null;try{return JSON.parse(n)}catch{return n}},on=async(e,t)=>{await e.removeItem(t);};class zp{constructor(){this.promise=new zp.promiseConstructor((t,n)=>{this.resolve=t,this.reject=n;});}}zp.promiseConstructor=Promise;function pd(e){const t=e.split(".");if(t.length!==3)throw new $g("Invalid JWT structure");for(let r=0;r<t.length;r++)if(!z5.test(t[r]))throw new $g("JWT not in base64url format");return {header:JSON.parse(N0(t[0])),payload:JSON.parse(N0(t[1])),signature:ka(t[2]),raw:{header:t[0],payload:t[1]}}}async function rB(e){return await new Promise(t=>{setTimeout(()=>t(null),e);})}function oB(e,t){return new Promise((r,o)=>{(async()=>{for(let i=0;i<1/0;i++)try{const a=await e(i);if(!t(i,null,a)){r(a);return}}catch(a){if(!t(i,a)){o(a);return}}})();})}function iB(e){return ("0"+e.toString(16)).substr(-2)}function aB(){const t=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=n.length;let o="";for(let i=0;i<56;i++)o+=n.charAt(Math.floor(Math.random()*r));return o}return crypto.getRandomValues(t),Array.from(t,iB).join("")}async function sB(e){const n=new TextEncoder().encode(e),r=await crypto.subtle.digest("SHA-256",n),o=new Uint8Array(r);return Array.from(o).map(i=>String.fromCharCode(i)).join("")}async function lB(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const n=await sB(e);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Qi(e,t,n=false){const r=aB();let o=r;n&&(o+="/PASSWORD_RECOVERY"),await la(e,`${t}-code-verifier`,o);const i=await lB(r);return [i,r===i?"plain":"s256"]}const cB=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function dB(e){const t=e.headers.get(Og);if(!t||!t.match(cB))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function uB(e){if(!e)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(e<=t)throw new Error("JWT has expired")}function pB(e){switch(e){case "RS256":return {name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case "ES256":return {name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const fB=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Zi(e){if(!fB.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function fh(){const e={};return new Proxy(e,{get:(t,n)=>{if(n==="__isUserNotAvailableProxy")return  true;if(typeof n=="symbol"){const r=n.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function hB(e,t){return new Proxy(e,{get:(n,r,o)=>{if(r==="__isInsecureUserWarningProxy")return  true;if(typeof r=="symbol"){const i=r.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)"||i==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(n,r,o)}return !t.value&&typeof r=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=true),Reflect.get(n,r,o)}})}function $0(e){return JSON.parse(JSON.stringify(e))}const ii=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),gB=[502,503,504];async function D0(e){var t;if(!nB(e))throw new Ng(ii(e),0);if(gB.includes(e.status))throw new Ng(ii(e),e.status);let n;try{n=await e.json();}catch(i){throw new li(ii(i),i)}let r;const o=dB(e);if(o&&o.getTime()>=B_["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?r=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(r=n.error_code),r){if(r==="weak_password")throw new M0(ii(n),e.status,((t=n.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(r==="session_not_found")throw new Ln}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((i,a)=>i&&typeof a=="string",true))throw new M0(ii(n),e.status,n.weak_password.reasons);throw new H5(ii(n),e.status||500,r)}const mB=(e,t,n,r)=>{const o={method:e,headers:t?.headers||{}};return e==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t?.headers),o.body=JSON.stringify(r),Object.assign(Object.assign({},o),n))};async function Ne(e,t,n,r){var o;const i=Object.assign({},r?.headers);i[Og]||(i[Og]=B_["2024-01-01"].name),r?.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const a=(o=r?.query)!==null&&o!==void 0?o:{};r?.redirectTo&&(a.redirect_to=r.redirectTo);const s=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",l=await bB(e,t,n+s,{headers:i,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(l):{data:Object.assign({},l),error:null}}async function bB(e,t,n,r,o,i){const a=mB(t,r,o,i);let s;try{s=await e(n,Object.assign({},a));}catch(l){throw console.error(l),new Ng(ii(l),0)}if(s.ok||await D0(s),r?.noResolveJson)return s;try{return await s.json()}catch(l){await D0(l);}}function or(e){var t;let n=null;wB(e)&&(n=Object.assign({},e),e.expires_at||(n.expires_at=Z5(e.expires_in)));const r=(t=e.user)!==null&&t!==void 0?t:e;return {data:{session:n,user:r},error:null}}function F0(e){const t=or(e);return !t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((n,r)=>n&&typeof r=="string",true)&&(t.data.weak_password=e.weak_password),t}function Eo(e){var t;return {data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function vB(e){return {data:e,error:null}}function yB(e){const{action_link:t,email_otp:n,hashed_token:r,redirect_to:o,verification_type:i}=e,a=Bp(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),s={action_link:t,email_otp:n,hashed_token:r,redirect_to:o,verification_type:i},l=Object.assign({},a);return {data:{properties:s,user:l},error:null}}function B0(e){return e}function wB(e){return e.access_token&&e.refresh_token&&e.expires_in}const hh=["global","local","others"];class xB{constructor({url:t="",headers:n={},fetch:r}){this.url=t,this.headers=n,this.fetch=z_(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)};}async signOut(t,n=hh[0]){if(hh.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${hh.join(", ")}`);try{return await Ne(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Re(r))return {data:null,error:r};throw r}}async inviteUserByEmail(t,n={}){try{return await Ne(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:Eo})}catch(r){if(Re(r))return {data:{user:null},error:r};throw r}}async generateLink(t){try{const{options:n}=t,r=Bp(t,["options"]),o=Object.assign(Object.assign({},r),n);return "newEmail"in r&&(o.new_email=r?.newEmail,delete o.newEmail),await Ne(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:yB,redirectTo:n?.redirectTo})}catch(n){if(Re(n))return {data:{properties:null,user:null},error:n};throw n}}async createUser(t){try{return await Ne(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:Eo})}catch(n){if(Re(n))return {data:{user:null},error:n};throw n}}async listUsers(t){var n,r,o,i,a,s,l;try{const c={nextPage:null,lastPage:0,total:0},d=await Ne(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=t?.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(i=(o=t?.perPage)===null||o===void 0?void 0:o.toString())!==null&&i!==void 0?i:""},xform:B0});if(d.error)throw d.error;const u=await d.json(),f=(a=d.headers.get("x-total-count"))!==null&&a!==void 0?a:0,g=(l=(s=d.headers.get("link"))===null||s===void 0?void 0:s.split(","))!==null&&l!==void 0?l:[];return g.length>0&&(g.forEach(h=>{const y=parseInt(h.split(";")[0].split("=")[1].substring(0,1)),S=JSON.parse(h.split(";")[1].split("=")[1]);c[`${S}Page`]=y;}),c.total=parseInt(f)),{data:Object.assign(Object.assign({},u),c),error:null}}catch(c){if(Re(c))return {data:{users:[]},error:c};throw c}}async getUserById(t){Zi(t);try{return await Ne(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Eo})}catch(n){if(Re(n))return {data:{user:null},error:n};throw n}}async updateUserById(t,n){Zi(t);try{return await Ne(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:n,headers:this.headers,xform:Eo})}catch(r){if(Re(r))return {data:{user:null},error:r};throw r}}async deleteUser(t,n=false){Zi(t);try{return await Ne(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:n},xform:Eo})}catch(r){if(Re(r))return {data:{user:null},error:r};throw r}}async _listFactors(t){Zi(t.userId);try{const{data:n,error:r}=await Ne(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return {data:n,error:r}}catch(n){if(Re(n))return {data:null,error:n};throw n}}async _deleteFactor(t){Zi(t.userId),Zi(t.id);try{return {data:await Ne(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(n){if(Re(n))return {data:null,error:n};throw n}}async _listOAuthClients(t){var n,r,o,i,a,s,l;try{const c={nextPage:null,lastPage:0,total:0},d=await Ne(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=t?.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(i=(o=t?.perPage)===null||o===void 0?void 0:o.toString())!==null&&i!==void 0?i:""},xform:B0});if(d.error)throw d.error;const u=await d.json(),f=(a=d.headers.get("x-total-count"))!==null&&a!==void 0?a:0,g=(l=(s=d.headers.get("link"))===null||s===void 0?void 0:s.split(","))!==null&&l!==void 0?l:[];return g.length>0&&(g.forEach(h=>{const y=parseInt(h.split(";")[0].split("=")[1].substring(0,1)),S=JSON.parse(h.split(";")[1].split("=")[1]);c[`${S}Page`]=y;}),c.total=parseInt(f)),{data:Object.assign(Object.assign({},u),c),error:null}}catch(c){if(Re(c))return {data:{clients:[]},error:c};throw c}}async _createOAuthClient(t){try{return await Ne(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Re(n))return {data:null,error:n};throw n}}async _getOAuthClient(t){try{return await Ne(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Re(n))return {data:null,error:n};throw n}}async _updateOAuthClient(t,n){try{return await Ne(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:n,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(Re(r))return {data:null,error:r};throw r}}async _deleteOAuthClient(t){try{return await Ne(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Re(n))return {data:null,error:n};throw n}}async _regenerateOAuthClientSecret(t){try{return await Ne(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Re(n))return {data:null,error:n};throw n}}}function j0(e={}){return {getItem:t=>e[t]||null,setItem:(t,n)=>{e[t]=n;},removeItem:t=>{delete e[t];}}}const ea={debug:!!(globalThis&&G_()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class U_ extends Error{constructor(t){super(t),this.isAcquireTimeout=true;}}class CB extends U_{}async function SB(e,t,n){ea.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const r=new globalThis.AbortController;return t>0&&setTimeout(()=>{r.abort(),ea.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e);},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:true}:{mode:"exclusive",signal:r.signal},async o=>{if(o){ea.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,o.name);try{return await n()}finally{ea.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,o.name);}}else {if(t===0)throw ea.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new CB(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(ea.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "));}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i);}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}}))}function _B(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__;}catch{typeof self<"u"&&(self.globalThis=self);}}function H_(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function kB(e){return parseInt(e,16)}function EB(e){const t=new TextEncoder().encode(e);return "0x"+Array.from(t,r=>r.toString(16).padStart(2,"0")).join("")}function AB(e){var t;const{chainId:n,domain:r,expirationTime:o,issuedAt:i=new Date,nonce:a,notBefore:s,requestId:l,resources:c,scheme:d,uri:u,version:f}=e;{if(!Number.isInteger(n))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${n}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(a&&a.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${a}`);if(!u)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(f!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${f}`);if(!((t=e.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`)}const g=H_(e.address),h=d?`${d}://${r}`:r,y=e.statement?`${e.statement}
`:"",S=`${h} wants you to sign in with your Ethereum account:
${g}

${y}`;let C=`URI: ${u}
Version: ${f}
Chain ID: ${n}${a?`
Nonce: ${a}`:""}
Issued At: ${i.toISOString()}`;if(o&&(C+=`
Expiration Time: ${o.toISOString()}`),s&&(C+=`
Not Before: ${s.toISOString()}`),l&&(C+=`
Request ID: ${l}`),c){let _=`
Resources:`;for(const E of c){if(!E||typeof E!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${E}`);_+=`
- ${E}`;}C+=_;}return `${S}
${C}`}class $t extends Error{constructor({message:t,code:n,cause:r,name:o}){var i;super(t,{cause:r}),this.__isWebAuthnError=true,this.name=(i=o??(r instanceof Error?r.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=n;}}class Vu extends $t{constructor(t,n){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n,message:t}),this.name="WebAuthnUnknownError",this.originalError=n;}}function TB({error:e,options:t}){var n,r,o;const{publicKey:i}=t;if(!i)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new $t({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(((n=i.authenticatorSelection)===null||n===void 0?void 0:n.requireResidentKey)===true)return new $t({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(t.mediation==="conditional"&&((r=i.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new $t({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if(((o=i.authenticatorSelection)===null||o===void 0?void 0:o.userVerification)==="required")return new $t({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else {if(e.name==="InvalidStateError")return new $t({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new $t({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return i.pubKeyCredParams.filter(s=>s.type==="public-key").length===0?new $t({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new $t({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const a=window.location.hostname;if(W_(a)){if(i.rp.id!==a)return new $t({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new $t({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new $t({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new $t({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new $t({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function IB({error:e,options:t}){const{publicKey:n}=t;if(!n)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new $t({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else {if(e.name==="NotAllowedError")return new $t({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const r=window.location.hostname;if(W_(r)){if(n.rpId!==r)return new $t({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new $t({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new $t({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new $t({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}class PB{createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n);}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0;}}}const RB=new PB;function MB(e){if(!e)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:n,excludeCredentials:r}=e,o=Bp(e,["challenge","user","excludeCredentials"]),i=ka(t).buffer,a=Object.assign(Object.assign({},n),{id:ka(n.id).buffer}),s=Object.assign(Object.assign({},o),{challenge:i,user:a});if(r&&r.length>0){s.excludeCredentials=new Array(r.length);for(let l=0;l<r.length;l++){const c=r[l];s.excludeCredentials[l]=Object.assign(Object.assign({},c),{id:ka(c.id).buffer,type:c.type||"public-key",transports:c.transports});}}return s}function LB(e){if(!e)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:n}=e,r=Bp(e,["challenge","allowCredentials"]),o=ka(t).buffer,i=Object.assign(Object.assign({},r),{challenge:o});if(n&&n.length>0){i.allowCredentials=new Array(n.length);for(let a=0;a<n.length;a++){const s=n[a];i.allowCredentials[a]=Object.assign(Object.assign({},s),{id:ka(s.id).buffer,type:s.type||"public-key",transports:s.transports});}}return i}function OB(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const n=e;return {id:e.id,rawId:e.id,response:{attestationObject:mi(new Uint8Array(e.response.attestationObject)),clientDataJSON:mi(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:(t=n.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function NB(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const n=e,r=e.getClientExtensionResults(),o=e.response;return {id:e.id,rawId:e.id,response:{authenticatorData:mi(new Uint8Array(o.authenticatorData)),clientDataJSON:mi(new Uint8Array(o.clientDataJSON)),signature:mi(new Uint8Array(o.signature)),userHandle:o.userHandle?mi(new Uint8Array(o.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:(t=n.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function W_(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function G0(){var e,t;return !!(sn()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((e=navigator?.credentials)===null||e===void 0?void 0:e.create)=="function"&&typeof((t=navigator?.credentials)===null||t===void 0?void 0:t.get)=="function")}async function $B(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Vu("Browser returned unexpected credential type",t)}:{data:null,error:new Vu("Empty credential response",t)}}catch(t){return {data:null,error:TB({error:t,options:e})}}}async function DB(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Vu("Browser returned unexpected credential type",t)}:{data:null,error:new Vu("Empty credential response",t)}}catch(t){return {data:null,error:IB({error:t,options:e})}}}const FB={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:false,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},BB={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function qu(...e){const t=o=>o!==null&&typeof o=="object"&&!Array.isArray(o),n=o=>o instanceof ArrayBuffer||ArrayBuffer.isView(o),r={};for(const o of e)if(o)for(const i in o){const a=o[i];if(a!==void 0)if(Array.isArray(a))r[i]=a;else if(n(a))r[i]=a;else if(t(a)){const s=r[i];t(s)?r[i]=qu(s,a):r[i]=qu(a);}else r[i]=a;}return r}function jB(e,t){return qu(FB,e,t||{})}function GB(e,t){return qu(BB,e,t||{})}class zB{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this);}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:n,friendlyName:r,signal:o},i){var a;try{const{data:s,error:l}=await this.client.mfa.challenge({factorId:t,webauthn:n});if(!s)return {data:null,error:l};const c=o??RB.createNewAbortSignal();if(s.webauthn.type==="create"){const{user:d}=s.webauthn.credential_options.publicKey;if(!d.name){const u=r;if(u)d.name=`${d.id}:${u}`;else {const g=(await this.client.getUser()).data.user,h=((a=g?.user_metadata)===null||a===void 0?void 0:a.name)||g?.email||g?.id||"User";d.name=`${d.id}:${h}`;}}d.displayName||(d.displayName=d.name);}switch(s.webauthn.type){case "create":{const d=jB(s.webauthn.credential_options.publicKey,i?.create),{data:u,error:f}=await $B({publicKey:d,signal:c});return u?{data:{factorId:t,challengeId:s.id,webauthn:{type:s.webauthn.type,credential_response:u}},error:null}:{data:null,error:f}}case "request":{const d=GB(s.webauthn.credential_options.publicKey,i?.request),{data:u,error:f}=await DB(Object.assign(Object.assign({},s.webauthn.credential_options),{publicKey:d,signal:c}));return u?{data:{factorId:t,challengeId:s.id,webauthn:{type:s.webauthn.type,credential_response:u}},error:null}:{data:null,error:f}}}}catch(s){return Re(s)?{data:null,error:s}:{data:null,error:new li("Unexpected error in challenge",s)}}}async _verify({challengeId:t,factorId:n,webauthn:r}){return this.client.mfa.verify({factorId:n,challengeId:t,webauthn:r})}async _authenticate({factorId:t,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:o}={}},i){if(!n)return {data:null,error:new Gl("rpId is required for WebAuthn authentication")};try{if(!G0())return {data:null,error:new li("Browser does not support WebAuthn",null)};const{data:a,error:s}=await this.challenge({factorId:t,webauthn:{rpId:n,rpOrigins:r},signal:o},{request:i});if(!a)return {data:null,error:s};const{webauthn:l}=a;return this._verify({factorId:t,challengeId:a.challengeId,webauthn:{type:l.type,rpId:n,rpOrigins:r,credential_response:l.credential_response}})}catch(a){return Re(a)?{data:null,error:a}:{data:null,error:new li("Unexpected error in authenticate",a)}}}async _register({friendlyName:t,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:o}={}},i){if(!n)return {data:null,error:new Gl("rpId is required for WebAuthn registration")};try{if(!G0())return {data:null,error:new li("Browser does not support WebAuthn",null)};const{data:a,error:s}=await this._enroll({friendlyName:t});if(!a)return await this.client.mfa.listFactors().then(d=>{var u;return (u=d.data)===null||u===void 0?void 0:u.all.find(f=>f.factor_type==="webauthn"&&f.friendly_name===t&&f.status!=="unverified")}).then(d=>d?this.client.mfa.unenroll({factorId:d?.id}):void 0),{data:null,error:s};const{data:l,error:c}=await this._challenge({factorId:a.id,friendlyName:a.friendly_name,webauthn:{rpId:n,rpOrigins:r},signal:o},{create:i});return l?this._verify({factorId:a.id,challengeId:l.challengeId,webauthn:{rpId:n,rpOrigins:r,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:c}}catch(a){return Re(a)?{data:null,error:a}:{data:null,error:new li("Unexpected error in register",a)}}}}_B();const UB={url:B5,storageKey:j5,autoRefreshToken:true,persistSession:true,detectSessionInUrl:true,headers:G5,flowType:"implicit",debug:false,hasCustomAuthorizationHeader:false,throwOnError:false,lockAcquireTimeout:1e4};async function z0(e,t,n){return await n()}const ta={};class zl{get jwks(){var t,n;return (n=(t=ta[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(t){ta[this.storageKey]=Object.assign(Object.assign({},ta[this.storageKey]),{jwks:t});}get jwks_cached_at(){var t,n;return (n=(t=ta[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){ta[this.storageKey]=Object.assign(Object.assign({},ta[this.storageKey]),{cachedAt:t});}constructor(t){var n,r,o;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=true,this.hasCustomAuthorizationHeader=false,this.suppressGetSessionWarning=false,this.lockAcquired=false,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const i=Object.assign(Object.assign({},UB),t);if(this.storageKey=i.storageKey,this.instanceID=(n=zl.nextInstanceID[this.storageKey])!==null&&n!==void 0?n:0,zl.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.instanceID>0&&sn()){const a=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(a),this.logDebugMessages&&console.trace(a);}if(this.persistSession=i.persistSession,this.autoRefreshToken=i.autoRefreshToken,this.admin=new xB({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=z_(i.fetch),this.lock=i.lock||z0,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,this.throwOnError=i.throwOnError,this.lockAcquireTimeout=i.lockAcquireTimeout,i.lock?this.lock=i.lock:this.persistSession&&sn()&&(!((r=globalThis?.navigator)===null||r===void 0)&&r.locks)?this.lock=SB:this.lock=z0,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new zB(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:G_()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=j0(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=j0(this.memoryStorage)),sn()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey);}catch(a){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",a);}(o=this.broadcastChannel)===null||o===void 0||o.addEventListener("message",async a=>{this._debug("received broadcast notification from other tab or client",a);try{await this._notifyAllSubscribers(a.data.event,a.data.session,!1);}catch(s){this._debug("#broadcastChannel","error",s);}});}this.initialize().catch(a=>{this._debug("#initialize()","error",a);});}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return `GoTrueClient@${this.storageKey}:${this.instanceID} (${F_}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let n={},r="none";if(sn()&&(n=tB(window.location.href),this._isImplicitGrantCallback(n)?r="implicit":await this._isPKCECallback(n)&&(r="pkce")),sn()&&this.detectSessionInUrl&&r!=="none"){const{data:o,error:i}=await this._getSessionFromURL(n,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),V5(i)){const l=(t=i.details)===null||t===void 0?void 0:t.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return {error:i}}return {error:i}}const{session:a,redirectType:s}=o;return this._debug("#_initialize()","detected session in URL",a,"redirect type",s),await this._saveSession(a),setTimeout(async()=>{s==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a);},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return Re(n)?this._returnResult({error:n}):this._returnResult({error:new li("Unexpected error during initialization",n)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end");}}async signInAnonymously(t){var n,r,o;try{const i=await Ne(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(n=t?.options)===null||n===void 0?void 0:n.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(o=t?.options)===null||o===void 0?void 0:o.captchaToken}},xform:or}),{data:a,error:s}=i;if(s||!a)return this._returnResult({data:{user:null,session:null},error:s});const l=a.session,c=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(i){if(Re(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signUp(t){var n,r,o;try{let i;if("email"in t){const{email:d,password:u,options:f}=t;let g=null,h=null;this.flowType==="pkce"&&([g,h]=await Qi(this.storage,this.storageKey)),i=await Ne(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f?.emailRedirectTo,body:{email:d,password:u,data:(n=f?.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:g,code_challenge_method:h},xform:or});}else if("phone"in t){const{phone:d,password:u,options:f}=t;i=await Ne(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:u,data:(r=f?.data)!==null&&r!==void 0?r:{},channel:(o=f?.channel)!==null&&o!==void 0?o:"sms",gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:or});}else throw new dd("You must provide either an email or phone number and a password");const{data:a,error:s}=i;if(s||!a)return await on(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:s});const l=a.session,c=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(i){if(await on(this.storage,`${this.storageKey}-code-verifier`),Re(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithPassword(t){try{let n;if("email"in t){const{email:i,password:a,options:s}=t;n=await Ne(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:a,gotrue_meta_security:{captcha_token:s?.captchaToken}},xform:F0});}else if("phone"in t){const{phone:i,password:a,options:s}=t;n=await Ne(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:a,gotrue_meta_security:{captcha_token:s?.captchaToken}},xform:F0});}else throw new dd("You must provide either an email or phone number and a password");const{data:r,error:o}=n;if(o)return this._returnResult({data:{user:null,session:null},error:o});if(!r||!r.session||!r.user){const i=new Ji;return this._returnResult({data:{user:null,session:null},error:i})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:o})}catch(n){if(Re(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOAuth(t){var n,r,o,i;return await this._handleProviderSignIn(t.provider,{redirectTo:(n=t.options)===null||n===void 0?void 0:n.redirectTo,scopes:(r=t.options)===null||r===void 0?void 0:r.scopes,queryParams:(o=t.options)===null||o===void 0?void 0:o.queryParams,skipBrowserRedirect:(i=t.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:n}=t;switch(n){case "ethereum":return await this.signInWithEthereum(t);case "solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}}async signInWithEthereum(t){var n,r,o,i,a,s,l,c,d,u,f;let g,h;if("message"in t)g=t.message,h=t.signature;else {const{chain:y,wallet:S,statement:C,options:_}=t;let E;if(sn())if(typeof S=="object")E=S;else {const A=window;if("ethereum"in A&&typeof A.ethereum=="object"&&"request"in A.ethereum&&typeof A.ethereum.request=="function")E=A.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else {if(typeof S!="object"||!_?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");E=S;}const P=new URL((n=_?.url)!==null&&n!==void 0?n:window.location.href),O=await E.request({method:"eth_requestAccounts"}).then(A=>A).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!O||O.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const k=H_(O[0]);let I=(r=_?.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!I){const A=await E.request({method:"eth_chainId"});I=kB(A);}const R={domain:P.host,address:k,statement:C,uri:P.href,version:"1",chainId:I,nonce:(o=_?.signInWithEthereum)===null||o===void 0?void 0:o.nonce,issuedAt:(a=(i=_?.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&a!==void 0?a:new Date,expirationTime:(s=_?.signInWithEthereum)===null||s===void 0?void 0:s.expirationTime,notBefore:(l=_?.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(c=_?.signInWithEthereum)===null||c===void 0?void 0:c.requestId,resources:(d=_?.signInWithEthereum)===null||d===void 0?void 0:d.resources};g=AB(R),h=await E.request({method:"personal_sign",params:[EB(g),k]});}try{const{data:y,error:S}=await Ne(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:g,signature:h},!((u=t.options)===null||u===void 0)&&u.captchaToken?{gotrue_meta_security:{captcha_token:(f=t.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:or});if(S)throw S;if(!y||!y.session||!y.user){const C=new Ji;return this._returnResult({data:{user:null,session:null},error:C})}return y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",y.session)),this._returnResult({data:Object.assign({},y),error:S})}catch(y){if(Re(y))return this._returnResult({data:{user:null,session:null},error:y});throw y}}async signInWithSolana(t){var n,r,o,i,a,s,l,c,d,u,f,g;let h,y;if("message"in t)h=t.message,y=t.signature;else {const{chain:S,wallet:C,statement:_,options:E}=t;let P;if(sn())if(typeof C=="object")P=C;else {const k=window;if("solana"in k&&typeof k.solana=="object"&&("signIn"in k.solana&&typeof k.solana.signIn=="function"||"signMessage"in k.solana&&typeof k.solana.signMessage=="function"))P=k.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else {if(typeof C!="object"||!E?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");P=C;}const O=new URL((n=E?.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in P&&P.signIn){const k=await P.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},E?.signInWithSolana),{version:"1",domain:O.host,uri:O.href}),_?{statement:_}:null));let I;if(Array.isArray(k)&&k[0]&&typeof k[0]=="object")I=k[0];else if(k&&typeof k=="object"&&"signedMessage"in k&&"signature"in k)I=k;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in I&&"signature"in I&&(typeof I.signedMessage=="string"||I.signedMessage instanceof Uint8Array)&&I.signature instanceof Uint8Array)h=typeof I.signedMessage=="string"?I.signedMessage:new TextDecoder().decode(I.signedMessage),y=I.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else {if(!("signMessage"in P)||typeof P.signMessage!="function"||!("publicKey"in P)||typeof P!="object"||!P.publicKey||!("toBase58"in P.publicKey)||typeof P.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");h=[`${O.host} wants you to sign in with your Solana account:`,P.publicKey.toBase58(),..._?["",_,""]:[""],"Version: 1",`URI: ${O.href}`,`Issued At: ${(o=(r=E?.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&o!==void 0?o:new Date().toISOString()}`,...!((i=E?.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${E.signInWithSolana.notBefore}`]:[],...!((a=E?.signInWithSolana)===null||a===void 0)&&a.expirationTime?[`Expiration Time: ${E.signInWithSolana.expirationTime}`]:[],...!((s=E?.signInWithSolana)===null||s===void 0)&&s.chainId?[`Chain ID: ${E.signInWithSolana.chainId}`]:[],...!((l=E?.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${E.signInWithSolana.nonce}`]:[],...!((c=E?.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${E.signInWithSolana.requestId}`]:[],...!((u=(d=E?.signInWithSolana)===null||d===void 0?void 0:d.resources)===null||u===void 0)&&u.length?["Resources",...E.signInWithSolana.resources.map(I=>`- ${I}`)]:[]].join(`
`);const k=await P.signMessage(new TextEncoder().encode(h),"utf8");if(!k||!(k instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");y=k;}}try{const{data:S,error:C}=await Ne(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:h,signature:mi(y)},!((f=t.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(g=t.options)===null||g===void 0?void 0:g.captchaToken}}:null),xform:or});if(C)throw C;if(!S||!S.session||!S.user){const _=new Ji;return this._returnResult({data:{user:null,session:null},error:_})}return S.session&&(await this._saveSession(S.session),await this._notifyAllSubscribers("SIGNED_IN",S.session)),this._returnResult({data:Object.assign({},S),error:C})}catch(S){if(Re(S))return this._returnResult({data:{user:null,session:null},error:S});throw S}}async _exchangeCodeForSession(t){const n=await ri(this.storage,`${this.storageKey}-code-verifier`),[r,o]=(n??"").split("/");try{if(!r&&this.flowType==="pkce")throw new q5;const{data:i,error:a}=await Ne(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:r},xform:or});if(await on(this.storage,`${this.storageKey}-code-verifier`),a)throw a;if(!i||!i.session||!i.user){const s=new Ji;return this._returnResult({data:{user:null,session:null,redirectType:null},error:s})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign(Object.assign({},i),{redirectType:o??null}),error:a})}catch(i){if(await on(this.storage,`${this.storageKey}-code-verifier`),Re(i))return this._returnResult({data:{user:null,session:null,redirectType:null},error:i});throw i}}async signInWithIdToken(t){try{const{options:n,provider:r,token:o,access_token:i,nonce:a}=t,s=await Ne(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:o,access_token:i,nonce:a,gotrue_meta_security:{captcha_token:n?.captchaToken}},xform:or}),{data:l,error:c}=s;if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!l||!l.session||!l.user){const d=new Ji;return this._returnResult({data:{user:null,session:null},error:d})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:l,error:c})}catch(n){if(Re(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOtp(t){var n,r,o,i,a;try{if("email"in t){const{email:s,options:l}=t;let c=null,d=null;this.flowType==="pkce"&&([c,d]=await Qi(this.storage,this.storageKey));const{error:u}=await Ne(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:s,data:(n=l?.data)!==null&&n!==void 0?n:{},create_user:(r=l?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:c,code_challenge_method:d},redirectTo:l?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:u})}if("phone"in t){const{phone:s,options:l}=t,{data:c,error:d}=await Ne(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:s,data:(o=l?.data)!==null&&o!==void 0?o:{},create_user:(i=l?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(a=l?.channel)!==null&&a!==void 0?a:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:c?.message_id},error:d})}throw new dd("You must provide either an email or phone number.")}catch(s){if(await on(this.storage,`${this.storageKey}-code-verifier`),Re(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async verifyOtp(t){var n,r;try{let o,i;"options"in t&&(o=(n=t.options)===null||n===void 0?void 0:n.redirectTo,i=(r=t.options)===null||r===void 0?void 0:r.captchaToken);const{data:a,error:s}=await Ne(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:i}}),redirectTo:o,xform:or});if(s)throw s;if(!a)throw new Error("An error occurred on token verification.");const l=a.session,c=a.user;return l?.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:c,session:l},error:null})}catch(o){if(Re(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signInWithSSO(t){var n,r,o,i,a;try{let s=null,l=null;this.flowType==="pkce"&&([s,l]=await Qi(this.storage,this.storageKey));const c=await Ne(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(r=(n=t.options)===null||n===void 0?void 0:n.redirectTo)!==null&&r!==void 0?r:void 0}),!((o=t?.options)===null||o===void 0)&&o.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:s,code_challenge_method:l}),headers:this.headers,xform:vB});return !((i=c.data)===null||i===void 0)&&i.url&&sn()&&!(!((a=t.options)===null||a===void 0)&&a.skipBrowserRedirect)&&window.location.assign(c.data.url),this._returnResult(c)}catch(s){if(await on(this.storage,`${this.storageKey}-code-verifier`),Re(s))return this._returnResult({data:null,error:s});throw s}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:n},error:r}=t;if(r)throw r;if(!n)throw new Ln;const{error:o}=await Ne(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return this._returnResult({data:{user:null,session:null},error:o})})}catch(t){if(Re(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const n=`${this.url}/resend`;if("email"in t){const{email:r,type:o,options:i}=t,{error:a}=await Ne(this.fetch,"POST",n,{headers:this.headers,body:{email:r,type:o,gotrue_meta_security:{captcha_token:i?.captchaToken}},redirectTo:i?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:a})}else if("phone"in t){const{phone:r,type:o,options:i}=t,{data:a,error:s}=await Ne(this.fetch,"POST",n,{headers:this.headers,body:{phone:r,type:o,gotrue_meta_security:{captcha_token:i?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:a?.message_id},error:s})}throw new dd("You must provide either an email or phone number and a type")}catch(n){if(Re(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async n=>n))}async _acquireLock(t,n){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),o=(async()=>(await r,await n()))();return this.pendingInLock.push((async()=>{try{await o;}catch{}})()),o}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=n();for(this.pendingInLock.push((async()=>{try{await r;}catch{}})()),await r;this.pendingInLock.length;){const o=[...this.pendingInLock];await Promise.all(o),this.pendingInLock.splice(0,o.length);}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1;}})}finally{this._debug("#_acquireLock","end");}}async _useSession(t){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await t(n)}finally{this._debug("#_useSession","end");}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const n=await ri(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?t=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return {data:{session:null},error:null};const r=t.expires_at?t.expires_at*1e3-Date.now()<dh:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",t.expires_at),!r){if(this.userStorage){const a=await ri(this.userStorage,this.storageKey+"-user");a?.user?t.user=a.user:t.user=fh();}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const a={value:this.suppressGetSessionWarning};t.user=hB(t.user,a),a.value&&(this.suppressGetSessionWarning=!0);}return {data:{session:t},error:null}}const{data:o,error:i}=await this._callRefreshToken(t.refresh_token);return i?this._returnResult({data:{session:null},error:i}):this._returnResult({data:{session:o},error:null})}finally{this._debug("#__loadSession()","end");}}async getUser(t){if(t)return await this._getUser(t);await this.initializePromise;const n=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return n.data.user&&(this.suppressGetSessionWarning=true),n}async _getUser(t){try{return t?await Ne(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:Eo}):await this._useSession(async n=>{var r,o,i;const{data:a,error:s}=n;if(s)throw s;return !(!((r=a.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ln}:await Ne(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(o=a.session)===null||o===void 0?void 0:o.access_token)!==null&&i!==void 0?i:void 0,xform:Eo})})}catch(n){if(Re(n))return uh(n)&&(await this._removeSession(),await on(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:n});throw n}}async updateUser(t,n={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(t,n))}async _updateUser(t,n={}){try{return await this._useSession(async r=>{const{data:o,error:i}=r;if(i)throw i;if(!o.session)throw new Ln;const a=o.session;let s=null,l=null;this.flowType==="pkce"&&t.email!=null&&([s,l]=await Qi(this.storage,this.storageKey));const{data:c,error:d}=await Ne(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n?.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:s,code_challenge_method:l}),jwt:a.access_token,xform:Eo});if(d)throw d;return a.user=c.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),this._returnResult({data:{user:a.user},error:null})})}catch(r){if(await on(this.storage,`${this.storageKey}-code-verifier`),Re(r))return this._returnResult({data:{user:null},error:r});throw r}}async setSession(t){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new Ln;const n=Date.now()/1e3;let r=n,o=!0,i=null;const{payload:a}=pd(t.access_token);if(a.exp&&(r=a.exp,o=r<=n),o){const{data:s,error:l}=await this._callRefreshToken(t.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!s)return {data:{user:null,session:null},error:null};i=s;}else {const{data:s,error:l}=await this._getUser(t.access_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});i={access_token:t.access_token,refresh_token:t.refresh_token,user:s.user,token_type:"bearer",expires_in:r-n,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i);}return this._returnResult({data:{user:i.user,session:i},error:null})}catch(n){if(Re(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async n=>{var r;if(!t){const{data:a,error:s}=n;if(s)throw s;t=(r=a.session)!==null&&r!==void 0?r:void 0;}if(!t?.refresh_token)throw new Ln;const{data:o,error:i}=await this._callRefreshToken(t.refresh_token);return i?this._returnResult({data:{user:null,session:null},error:i}):o?this._returnResult({data:{user:o.user,session:o},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(n){if(Re(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async _getSessionFromURL(t,n){try{if(!sn())throw new ud("No browser detected.");if(t.error||t.error_description||t.error_code)throw new ud(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(n){case "implicit":if(this.flowType==="pkce")throw new R0("Not a valid PKCE flow url.");break;case "pkce":if(this.flowType==="implicit")throw new ud("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new R0("No code detected.");const{data:_,error:E}=await this._exchangeCodeForSession(t.code);if(E)throw E;const P=new URL(window.location.href);return P.searchParams.delete("code"),window.history.replaceState(window.history.state,"",P.toString()),{data:{session:_.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:o,access_token:i,refresh_token:a,expires_in:s,expires_at:l,token_type:c}=t;if(!i||!s||!a||!c)throw new ud("No session defined in URL");const d=Math.round(Date.now()/1e3),u=parseInt(s);let f=d+u;l&&(f=parseInt(l));const g=f-d;g*1e3<=sa&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${g}s, should have been closer to ${u}s`);const h=f-u;d-h>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",h,f,d):d-h<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",h,f,d);const{data:y,error:S}=await this._getUser(i);if(S)throw S;const C={provider_token:r,provider_refresh_token:o,access_token:i,expires_in:u,expires_at:f,refresh_token:a,token_type:c,user:y.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:C,redirectType:t.type},error:null})}catch(r){if(Re(r))return this._returnResult({data:{session:null,redirectType:null},error:r});throw r}}_isImplicitGrantCallback(t){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),t):!!(t.access_token||t.error_description)}async _isPKCECallback(t){const n=await ri(this.storage,`${this.storageKey}-code-verifier`);return !!(t.code&&n)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async n=>{var r;const{data:o,error:i}=n;if(i&&!uh(i))return this._returnResult({error:i});const a=(r=o.session)===null||r===void 0?void 0:r.access_token;if(a){const{error:s}=await this.admin.signOut(a,t);if(s&&!(W5(s)&&(s.status===404||s.status===401||s.status===403)||uh(s)))return this._returnResult({error:s})}return t!=="others"&&(await this._removeSession(),await on(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const n=eB(),r={id:n,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n);}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,r),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(n);})))(),{data:{subscription:r}}}async _emitInitialSession(t){return await this._useSession(async n=>{var r,o;try{const{data:{session:i},error:a}=n;if(a)throw a;await((r=this.stateChangeEmitters.get(t))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",t,"session",i);}catch(i){await((o=this.stateChangeEmitters.get(t))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",i),console.error(i);}})}async resetPasswordForEmail(t,n={}){let r=null,o=null;this.flowType==="pkce"&&([r,o]=await Qi(this.storage,this.storageKey,true));try{return await Ne(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:r,code_challenge_method:o,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(i){if(await on(this.storage,`${this.storageKey}-code-verifier`),Re(i))return this._returnResult({data:null,error:i});throw i}}async getUserIdentities(){var t;try{const{data:n,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:(t=n.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(n){if(Re(n))return this._returnResult({data:null,error:n});throw n}}async linkIdentity(t){return "token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var n;try{const{data:r,error:o}=await this._useSession(async i=>{var a,s,l,c,d;const{data:u,error:f}=i;if(f)throw f;const g=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(a=t.options)===null||a===void 0?void 0:a.redirectTo,scopes:(s=t.options)===null||s===void 0?void 0:s.scopes,queryParams:(l=t.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await Ne(this.fetch,"GET",g,{headers:this.headers,jwt:(d=(c=u.session)===null||c===void 0?void 0:c.access_token)!==null&&d!==void 0?d:void 0})});if(o)throw o;return sn()&&!(!((n=t.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(r?.url),this._returnResult({data:{provider:t.provider,url:r?.url},error:null})}catch(r){if(Re(r))return this._returnResult({data:{provider:t.provider,url:null},error:r});throw r}}async linkIdentityIdToken(t){return await this._useSession(async n=>{var r;try{const{error:o,data:{session:i}}=n;if(o)throw o;const{options:a,provider:s,token:l,access_token:c,nonce:d}=t,u=await Ne(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(r=i?.access_token)!==null&&r!==void 0?r:void 0,body:{provider:s,id_token:l,access_token:c,nonce:d,link_identity:!0,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:or}),{data:f,error:g}=u;return g?this._returnResult({data:{user:null,session:null},error:g}):!f||!f.session||!f.user?this._returnResult({data:{user:null,session:null},error:new Ji}):(f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("USER_UPDATED",f.session)),this._returnResult({data:f,error:g}))}catch(o){if(await on(this.storage,`${this.storageKey}-code-verifier`),Re(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}})}async unlinkIdentity(t){try{return await this._useSession(async n=>{var r,o;const{data:i,error:a}=n;if(a)throw a;return await Ne(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(o=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&o!==void 0?o:void 0})})}catch(n){if(Re(n))return this._returnResult({data:null,error:n});throw n}}async _refreshAccessToken(t){const n=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(n,"begin");try{const r=Date.now();return await oB(async o=>(o>0&&await rB(200*Math.pow(2,o-1)),this._debug(n,"refreshing attempt",o),await Ne(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:or})),(o,i)=>{const a=200*Math.pow(2,o);return i&&ph(i)&&Date.now()+a-r<sa})}catch(r){if(this._debug(n,"error",r),Re(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}finally{this._debug(n,"end");}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,n){const r=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",n,"url",r),sn()&&!n.skipBrowserRedirect&&window.location.assign(r),{data:{provider:t,url:r},error:null}}async _recoverAndRefresh(){var t,n;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const o=await ri(this.storage,this.storageKey);if(o&&this.userStorage){let a=await ri(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!a&&(a={user:o.user},await la(this.userStorage,this.storageKey+"-user",a)),o.user=(t=a?.user)!==null&&t!==void 0?t:fh();}else if(o&&!o.user&&!o.user){const a=await ri(this.storage,this.storageKey+"-user");a&&a?.user?(o.user=a.user,await on(this.storage,this.storageKey+"-user"),await la(this.storage,this.storageKey,o)):o.user=fh();}if(this._debug(r,"session from storage",o),!this._isValidSession(o)){this._debug(r,"session is not valid"),o!==null&&await this._removeSession();return}const i=((n=o.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<dh;if(this._debug(r,`session has${i?"":" not"} expired with margin of ${dh}s`),i){if(this.autoRefreshToken&&o.refresh_token){const{error:a}=await this._callRefreshToken(o.refresh_token);a&&(console.error(a),ph(a)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()));}}else if(o.user&&o.user.__isUserNotAvailableProxy===!0)try{const{data:a,error:s}=await this._getUser(o.access_token);!s&&a?.user?(o.user=a.user,await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)):this._debug(r,"could not get user data, skipping SIGNED_IN notification");}catch(a){console.error("Error getting user data:",a),this._debug(r,"error getting user data, skipping SIGNED_IN notification",a);}else await this._notifyAllSubscribers("SIGNED_IN",o);}catch(o){this._debug(r,"error",o),console.error(o);return}finally{this._debug(r,"end");}}async _callRefreshToken(t){var n,r;if(!t)throw new Ln;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const o=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(o,"begin");try{this.refreshingDeferred=new zp;const{data:i,error:a}=await this._refreshAccessToken(t);if(a)throw a;if(!i.session)throw new Ln;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const s={data:i.session,error:null};return this.refreshingDeferred.resolve(s),s}catch(i){if(this._debug(o,"error",i),Re(i)){const a={data:null,error:i};return ph(i)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(a),a}throw (r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(o,"end");}}async _notifyAllSubscribers(t,n,r=true){const o=`#_notifyAllSubscribers(${t})`;this._debug(o,"begin",n,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:t,session:n});const i=[],a=Array.from(this.stateChangeEmitters.values()).map(async s=>{try{await s.callback(t,n);}catch(l){i.push(l);}});if(await Promise.all(a),i.length>0){for(let s=0;s<i.length;s+=1)console.error(i[s]);throw i[0]}}finally{this._debug(o,"end");}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=true,await on(this.storage,`${this.storageKey}-code-verifier`);const n=Object.assign({},t),r=n.user&&n.user.__isUserNotAvailableProxy===true;if(this.userStorage){!r&&n.user&&await la(this.userStorage,this.storageKey+"-user",{user:n.user});const o=Object.assign({},n);delete o.user;const i=$0(o);await la(this.storage,this.storageKey,i);}else {const o=$0(n);await la(this.storage,this.storageKey,o);}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=false,await on(this.storage,this.storageKey),await on(this.storage,this.storageKey+"-code-verifier"),await on(this.storage,this.storageKey+"-user"),this.userStorage&&await on(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null);}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&sn()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",t);}catch(n){console.error("removing visibilitychange callback failed",n);}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),sa);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t);const n=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick();},0);this.autoRefreshTickTimeout=n,n&&typeof n=="object"&&typeof n.unref=="function"?n.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(n);}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t);const n=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,n&&clearTimeout(n);}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh();}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh();}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async n=>{const{data:{session:r}}=n;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const o=Math.floor((r.expires_at*1e3-t)/sa);this._debug("#_autoRefreshTokenTick()",`access token expires in ${o} ticks, a tick lasts ${sa}ms, refresh threshold is ${Lg} ticks`),o<=Lg&&await this._callRefreshToken(r.refresh_token);})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n);}}finally{this._debug("#_autoRefreshTokenTick()","end");}});}catch(t){if(t.isAcquireTimeout||t instanceof U_)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!sn()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),false;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1);}catch(t){this._debug("#visibilityChangedCallback","error",t);}},window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0);}catch(t){console.error("_handleVisibilityChange",t);}}async _onVisibilityChanged(t){const n=`#_onVisibilityChanged(${t})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh();}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh();}async _getUrlForProvider(t,n,r){const o=[`provider=${encodeURIComponent(n)}`];if(r?.redirectTo&&o.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&o.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,a]=await Qi(this.storage,this.storageKey),s=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(a)}`});o.push(s.toString());}if(r?.queryParams){const i=new URLSearchParams(r.queryParams);o.push(i.toString());}return r?.skipBrowserRedirect&&o.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${t}?${o.join("&")}`}async _unenroll(t){try{return await this._useSession(async n=>{var r;const{data:o,error:i}=n;return i?this._returnResult({data:null,error:i}):await Ne(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(Re(n))return this._returnResult({data:null,error:n});throw n}}async _enroll(t){try{return await this._useSession(async n=>{var r,o;const{data:i,error:a}=n;if(a)return this._returnResult({data:null,error:a});const s=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:l,error:c}=await Ne(this.fetch,"POST",`${this.url}/factors`,{body:s,headers:this.headers,jwt:(r=i?.session)===null||r===void 0?void 0:r.access_token});return c?this._returnResult({data:null,error:c}):(t.factorType==="totp"&&l.type==="totp"&&(!((o=l?.totp)===null||o===void 0)&&o.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(n){if(Re(n))return this._returnResult({data:null,error:n});throw n}}async _verify(t){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async n=>{var r;const{data:o,error:i}=n;if(i)return this._returnResult({data:null,error:i});const a=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?OB(t.webauthn.credential_response):NB(t.webauthn.credential_response)})}:{code:t.code}),{data:s,error:l}=await Ne(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:a,headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token});return l?this._returnResult({data:null,error:l}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+s.expires_in},s)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",s),this._returnResult({data:s,error:l}))})}catch(n){if(Re(n))return this._returnResult({data:null,error:n});throw n}})}async _challenge(t){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async n=>{var r;const{data:o,error:i}=n;if(i)return this._returnResult({data:null,error:i});const a=await Ne(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token});if(a.error)return a;const{data:s}=a;if(s.type!=="webauthn")return {data:s,error:null};switch(s.webauthn.type){case "create":return {data:Object.assign(Object.assign({},s),{webauthn:Object.assign(Object.assign({},s.webauthn),{credential_options:Object.assign(Object.assign({},s.webauthn.credential_options),{publicKey:MB(s.webauthn.credential_options.publicKey)})})}),error:null};case "request":return {data:Object.assign(Object.assign({},s),{webauthn:Object.assign(Object.assign({},s.webauthn),{credential_options:Object.assign(Object.assign({},s.webauthn.credential_options),{publicKey:LB(s.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(n){if(Re(n))return this._returnResult({data:null,error:n});throw n}})}async _challengeAndVerify(t){const{data:n,error:r}=await this._challenge({factorId:t.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:t.factorId,challengeId:n.id,code:t.code})}async _listFactors(){var t;const{data:{user:n},error:r}=await this.getUser();if(r)return {data:null,error:r};const o={all:[],phone:[],totp:[],webauthn:[]};for(const i of (t=n?.factors)!==null&&t!==void 0?t:[])o.all.push(i),i.status==="verified"&&o[i.factor_type].push(i);return {data:o,error:null}}async _getAuthenticatorAssuranceLevel(t){var n,r,o,i;if(t)try{const{payload:g}=pd(t);let h=null;g.aal&&(h=g.aal);let y=h;const{data:{user:S},error:C}=await this.getUser(t);if(C)return this._returnResult({data:null,error:C});((r=(n=S?.factors)===null||n===void 0?void 0:n.filter(P=>P.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(y="aal2");const E=g.amr||[];return {data:{currentLevel:h,nextLevel:y,currentAuthenticationMethods:E},error:null}}catch(g){if(Re(g))return this._returnResult({data:null,error:g});throw g}const{data:{session:a},error:s}=await this.getSession();if(s)return this._returnResult({data:null,error:s});if(!a)return {data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:l}=pd(a.access_token);let c=null;l.aal&&(c=l.aal);let d=c;((i=(o=a.user.factors)===null||o===void 0?void 0:o.filter(g=>g.status==="verified"))!==null&&i!==void 0?i:[]).length>0&&(d="aal2");const f=l.amr||[];return {data:{currentLevel:c,nextLevel:d,currentAuthenticationMethods:f},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async n=>{const{data:{session:r},error:o}=n;return o?this._returnResult({data:null,error:o}):r?await Ne(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:r.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new Ln})})}catch(n){if(Re(n))return this._returnResult({data:null,error:n});throw n}}async _approveAuthorization(t,n){try{return await this._useSession(async r=>{const{data:{session:o},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!o)return this._returnResult({data:null,error:new Ln});const a=await Ne(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:o.access_token,body:{action:"approve"},xform:s=>({data:s,error:null})});return a.data&&a.data.redirect_url&&sn()&&!n?.skipBrowserRedirect&&window.location.assign(a.data.redirect_url),a})}catch(r){if(Re(r))return this._returnResult({data:null,error:r});throw r}}async _denyAuthorization(t,n){try{return await this._useSession(async r=>{const{data:{session:o},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!o)return this._returnResult({data:null,error:new Ln});const a=await Ne(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:o.access_token,body:{action:"deny"},xform:s=>({data:s,error:null})});return a.data&&a.data.redirect_url&&sn()&&!n?.skipBrowserRedirect&&window.location.assign(a.data.redirect_url),a})}catch(r){if(Re(r))return this._returnResult({data:null,error:r});throw r}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:n},error:r}=t;return r?this._returnResult({data:null,error:r}):n?await Ne(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,xform:o=>({data:o,error:null})}):this._returnResult({data:null,error:new Ln})})}catch(t){if(Re(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async n=>{const{data:{session:r},error:o}=n;return o?this._returnResult({data:null,error:o}):r?(await Ne(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,query:{client_id:t.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Ln})})}catch(n){if(Re(n))return this._returnResult({data:null,error:n});throw n}}async fetchJwk(t,n={keys:[]}){let r=n.keys.find(s=>s.kid===t);if(r)return r;const o=Date.now();if(r=this.jwks.keys.find(s=>s.kid===t),r&&this.jwks_cached_at+U5>o)return r;const{data:i,error:a}=await Ne(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(a)throw a;return !i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=o,r=i.keys.find(s=>s.kid===t),!r)?null:r}async getClaims(t,n={}){try{let r=t;if(!r){const{data:g,error:h}=await this.getSession();if(h||!g.session)return this._returnResult({data:null,error:h});r=g.session.access_token;}const{header:o,payload:i,signature:a,raw:{header:s,payload:l}}=pd(r);n?.allowExpired||uB(i.exp);const c=!o.alg||o.alg.startsWith("HS")||!o.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(o.kid,n?.keys?{keys:n.keys}:n?.jwks);if(!c){const{error:g}=await this.getUser(r);if(g)throw g;return {data:{claims:i,header:o,signature:a},error:null}}const d=pB(o.alg),u=await crypto.subtle.importKey("jwk",c,d,!0,["verify"]);if(!await crypto.subtle.verify(d,u,a,Q5(`${s}.${l}`)))throw new $g("Invalid JWT signature");return {data:{claims:i,header:o,signature:a},error:null}}catch(r){if(Re(r))return this._returnResult({data:null,error:r});throw r}}}zl.nextInstanceID={};const HB=zl,WB="2.94.0";let Ks="";typeof Deno<"u"?Ks="deno":typeof document<"u"?Ks="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ks="react-native":Ks="node";const VB={"X-Client-Info":`supabase-js-${Ks}/${WB}`},qB={headers:VB},KB={schema:"public"},XB={autoRefreshToken:true,persistSession:true,detectSessionInUrl:true,flowType:"implicit"},YB={};function Ul(e){"@babel/helpers - typeof";return Ul=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ul(e)}function JB(e,t){if(Ul(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(Ul(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return (t==="string"?String:Number)(e)}function QB(e){var t=JB(e,"string");return Ul(t)=="symbol"?t:t+""}function ZB(e,t,n){return (t=QB(t))in e?Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true}):e[t]=n,e}function U0(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r);}return n}function At(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?U0(Object(n),true).forEach(function(r){ZB(e,r,n[r]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U0(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r));});}return e}const ej=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),tj=()=>Headers,nj=(e,t,n)=>{const r=ej(n),o=tj();return async(i,a)=>{var s;const l=(s=await t())!==null&&s!==void 0?s:e;let c=new o(a?.headers);return c.has("apikey")||c.set("apikey",e),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),r(i,At(At({},a),{},{headers:c}))}};function rj(e){return e.endsWith("/")?e:e+"/"}function oj(e,t){var n,r;const{db:o,auth:i,realtime:a,global:s}=e,{db:l,auth:c,realtime:d,global:u}=t,f={db:At(At({},l),o),auth:At(At({},c),i),realtime:At(At({},d),a),storage:{},global:At(At(At({},u),s),{},{headers:At(At({},(n=u?.headers)!==null&&n!==void 0?n:{}),(r=s?.headers)!==null&&r!==void 0?r:{})}),accessToken:async()=>""};return e.accessToken?f.accessToken=e.accessToken:delete f.accessToken,f}function ij(e){const t=e?.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(rj(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var aj=class extends HB{constructor(e){super(e);}},sj=class{constructor(e,t,n){var r,o;this.supabaseUrl=e,this.supabaseKey=t;const i=ij(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const a=`sb-${i.hostname.split(".")[0]}-auth-token`,s={db:KB,realtime:YB,auth:At(At({},XB),{},{storageKey:a}),global:qB},l=oj(n??{},s);if(this.storageKey=(r=l.auth.storageKey)!==null&&r!==void 0?r:"",this.headers=(o=l.global.headers)!==null&&o!==void 0?o:{},l.accessToken)this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(d,u)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(u)} is not possible`)}});else {var c;this.auth=this._initSupabaseAuthClient((c=l.auth)!==null&&c!==void 0?c:{},this.headers,l.global.fetch);}this.fetch=nj(t,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(At({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(d=>this.realtime.setAuth(d)).catch(d=>console.warn("Failed to set initial Realtime auth token:",d)),this.rest=new WF(new URL("rest/v1",i).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch,timeout:l.db.timeout,urlLengthLimit:l.db.urlLengthLimit}),this.storage=new F5(this.storageUrl.href,this.headers,this.fetch,n?.storage),l.accessToken||this._listenForAuthEvents();}get functions(){return new DF(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},n={head:false,get:false,count:void 0}){return this.rest.rpc(e,t,n)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e=this,t,n;if(e.accessToken)return await e.accessToken();const{data:r}=await e.auth.getSession();return (t=(n=r.session)===null||n===void 0?void 0:n.access_token)!==null&&t!==void 0?t:e.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:r,userStorage:o,storageKey:i,flowType:a,lock:s,debug:l,throwOnError:c},d,u){const f={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new aj({url:this.authUrl.href,headers:At(At({},f),d),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:r,userStorage:o,flowType:a,lock:s,debug:l,throwOnError:c,fetch:u,hasCustomAuthorizationHeader:Object.keys(this.headers).some(g=>g.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new l5(this.realtimeUrl.href,At(At({},e),{},{params:At(At({},{apikey:this.supabaseKey}),e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",t?.access_token);})}_handleTokenChanged(e,t,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?(this.changedAccessToken=n,this.realtime.setAuth(n)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0);}};const lj=(e,t,n)=>new sj(e,t,n);function cj(){if(typeof window<"u")return  false;const e=globalThis.process;if(!e)return  false;const t=e.version;if(t==null)return  false;const n=t.match(/^v(\d+)\./);return n?parseInt(n[1],10)<=18:false}cj()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const H0=14400*1e3,dj=1800*1e3,uj=1200*1e3,pj=27.5*60*1e3,Ku=2;let Ni={_version:Ku,weatherTimestamps:{},lastUpdated:0},fd=null,hd=null,ml=null,ci=new Set,ru=false;function fj(e){if(e?._version===Ku&&e?.weatherTimestamps)return e;const t=e,n={};return t&&((t.lastRainStart!=null||t.lastRainEnd!=null)&&(n.Rain={lastStart:t.lastRainStart??null,lastEnd:t.lastRainEnd??null}),(t.lastDawnStart!=null||t.lastDawnEnd!=null)&&(n.Dawn={lastStart:t.lastDawnStart??null,lastEnd:t.lastDawnEnd??null}),t.lastFrostStart!=null&&(n.Frost={lastStart:t.lastFrostStart,lastEnd:null}),t.lastAmberMoonStart!=null&&(n.AmberMoon={lastStart:t.lastAmberMoonStart,lastEnd:null})),{_version:Ku,weatherTimestamps:n,lastUpdated:t?.lastUpdated??0}}function $i(e){return Ni.weatherTimestamps[e]??{lastStart:null,lastEnd:null}}function Wa(e,t){const n=$i(e);Ni.weatherTimestamps[e]={...n,...t};}function hj(){if(hd)return hd;const e=Up();if(!e)return null;try{return hd=lj(e.url,e.anonKey,{auth:{persistSession:!1},realtime:{params:{eventsPerSecond:5}}}),hd}catch{return null}}function V_(){const e=Up();return e?{apikey:e.anonKey,Authorization:`Bearer ${e.anonKey}`}:{}}function Up(){const e=Xe(pn.WEATHER_TRACKING_CONFIG,{});if(e?.enabled===false||e?.communityDataEnabled===false||e?.communitySource&&e.communitySource!=="supabase")return null;const t=e?.supabaseUrl?.trim(),n=e?.supabaseAnonKey?.trim();return !t||!n?null:{url:t,anonKey:n}}function gj(){const e=Xe(pn.WEATHER_TRACKING_CONFIG,{});return e?.enabled===false||e?.communityDataEnabled===false||e?.communitySource&&e.communitySource!=="supabase"?false:e?.communityUploadEnabled===true}function mj(){if(IA(pn.WEATHER_TRACKING_CONFIG))return;const e=Xe(lt.SHOP_RESTOCK,{}),t={enabled:true,communityDataEnabled:e?.communityDataEnabled??true,communityUploadEnabled:false,communitySource:e?.communitySource??"supabase",supabaseUrl:e?.supabaseUrl??"",supabaseAnonKey:e?.supabaseAnonKey??""};Ye(pn.WEATHER_TRACKING_CONFIG,t);}function bj(){const e=Xe(pn.WEATHER_TRACKING,null);Ni=fj(e),e&&e._version!==Ku&&Hp();}function Hp(){Ni.lastUpdated=Date.now(),Ye(pn.WEATHER_TRACKING,Ni);}function vj(e,t){const n=Date.now();e&&e!=="Sunny"&&Wa(e,{lastStart:n}),t&&t!=="Sunny"&&t!==e&&Wa(t,{lastEnd:n}),Hp(),gj()&&yj({weatherId:e??"Sunny",previousWeatherId:t,timestamp:n}),window.dispatchEvent(new CustomEvent(Me.WEATHER_TRANSITION,{detail:{currentId:e,previousId:t,timestamp:n}}));}async function yj(e){try{const t=Up();if(!t)return;await JS(`${t.url}/functions/v1/weather-events`,e,V_());}catch{}}async function wj(){try{const e=Up();if(!e)return;const t=Ni.lastUpdated>0?Ni.lastUpdated-3600*1e3:Date.now()-1440*60*1e3,n=await YS(`${e.url}/functions/v1/weather-events?since=${t}&limit=50&summary=1`,V_());if(n.data?.meta){const r=n.data.meta,o=(a,s)=>{if(!s)return;const l=$i(a);(!l.lastStart||s>l.lastStart)&&Wa(a,{lastStart:s});},i=(a,s)=>{if(!s)return;const l=$i(a);(!l.lastEnd||s>l.lastEnd)&&Wa(a,{lastEnd:s});};i("Rain",r.lastRainEnd),o("Dawn",r.lastDawnStart),i("Dawn",r.lastDawnEnd),o("Frost",r.lastFrostStart),o("AmberMoon",r.lastAmberMoonStart),Hp();}}catch{}}function xj(e){const t=e?.new??e?.record??e?.data??null;if(!t)return;const n=typeof t.id=="string"?t.id:null;if(n){if(ci.has(n))return;if(ci.add(n),ci.size>200){const a=new Set;let s=0;for(const l of ci)s++>100&&a.add(l);ci=a;}}const r=t.weather_id,o=t.previous_weather_id??null,i=typeof t.timestamp=="number"?t.timestamp:Date.now();if(r&&r!=="Sunny"){const a=$i(r);(!a.lastStart||i>a.lastStart)&&Wa(r,{lastStart:i});}if(o&&o!=="Sunny"&&o!==r){const a=$i(o);(!a.lastEnd||i>a.lastEnd)&&Wa(o,{lastEnd:i});}Hp();}function Cj(){const e=hj();e&&(ml=e.channel("weather-events").on("postgres_changes",{event:"INSERT",schema:"public",table:"weather_events"},xj),ml.subscribe(t=>{t==="SUBSCRIBED"&&console.log("[JournalGuide:Weather] Realtime subscribed");}));}function q_(){if(ml){try{ml.unsubscribe();}catch{}ml=null;}}function Sj(){const e=Date.now(),r=Do().get()?.id??null,o=new Set;r&&r!=="Sunny"&&o.add(r);const i=new Set,a=r==="Rain",s=r==="Snow"||r==="Frost",l=r==="Dawn",c=r==="AmberMoon";let d=null,u=false;const f=$i("Dawn");if(f.lastStart){const S=e-f.lastStart,C=Math.floor(S/H0);d=f.lastStart+(C+1)*H0,u=!l&&d-e<=dj,u&&i.add("Dawn");}let g=null,h=false;const y=$i("Rain");return y.lastEnd&&!a&&(h=e-y.lastEnd>=uj,g=y.lastEnd+pj,h&&i.add("Rain")),{currentWeatherId:r,activeWeathers:o,predictedWeathers:i,isRaining:a,isSnowing:s,isDawn:l,isAmberMoon:c,rainPredictedSoon:h,dawnPredictedSoon:u,nextDawnEstimate:d,nextRainEstimate:g}}function _j(e){if(ru)return;ru=true,mj(),bj(),wj();const t=Do();fd=t.get()?.id??null;const r=t.subscribeStable(o=>{const i=o.current?.id??null,a=o.previous?.id??fd;i!==fd&&(vj(i,a),fd=i);});e.add(r),Cj(),e.add(()=>q_()),e.add(()=>{ru=false,ci.clear();});}function kj(){q_(),ru=false,ci.clear();}function Kr(e,t){return e.mutatedCrops.get(t)??false}let gd=null,Dg=true;function Fg(){Dg=true;}const Ej={GoldGranter:"goldGranter",RainbowGranter:"rainbowGranter",CropSizeBoost:"cropSizeBoost",ProduceMutationBoost:"cropMutationBoost",SnowyCropMutationBoost:"cropMutationBoost",PetMutationBoost:"petMutationBoost",MaxStrengthBoost:"maxStrengthBoost"};function Aj(){const e={goldGranter:"none",rainbowGranter:"none",cropSizeBoost:"none",cropMutationBoost:"none",petMutationBoost:"none",maxStrengthBoost:"none"};try{const t=po().get();if(!t)return e;const n=[{pets:t.byLocation?.active??[],status:"active"},{pets:t.byLocation?.inventory??[],status:"owned"},{pets:t.byLocation?.hutch??[],status:"owned"}];for(const{pets:r,status:o}of n)for(const i of r)if(i.abilities)for(const a of i.abilities){const s=Ej[a];s&&(e[s]==="none"||o==="active"&&e[s]==="owned")&&(e[s]=o);}}catch{}return e}function Tj(){try{return (gr().get()?.plants?.bySpecies?.DawnCelestial??[]).length>0}catch{return  false}}function Ij(){try{return (gr().get()?.plants?.bySpecies?.MoonCelestial??[]).length>0}catch{return  false}}function Pj(e,t){try{return (gr().get()?.crops?.mutated?.byMutation?.[t]??[]).some(o=>o.species===e)}catch{return  false}}function W0(e){try{return (gr().get()?.plants?.bySpecies?.[e]??[]).some(r=>r.matureSlotsCount>0)}catch{return  false}}function V0(e){try{const t=En().get();return t?.items?t.items.some(n=>n.itemType==="Seed"&&n.species===e):!1}catch{return  false}}function q0(e){try{const t=En().get();if(!t?.items)return !1;const n=ue.get("eggs")??{};return t.items.some(r=>{if(r.itemType!=="Egg")return !1;const o=n[r.eggId];return o?.species===e||o?.petSpecies===e})}catch{return  false}}function Rj(e){const t=new Map,n=ue.get("mutations");if(!n)return t;for(const r of Object.keys(n))t.set(r,Pj(e,r));return t}function gh(){const e=new Map,t=ue.get("mutations");if(!t)return e;for(const n of Object.keys(t))e.set(n,false);return e}function Fb(){if(!Dg&&gd)return gd;const e=Sj(),t=Aj(),n=Tj(),r=Ij(),o=Lt.getMyJournal(),i=Lt.calculateProduceProgress(o),a=Lt.calculatePetProgress(o),s=new Map,l=new Set;for(const d of i.speciesDetails)l.add(d.species),s.set(d.species,{speciesId:d.species,type:"crop",variantsMissing:d.variantsMissing,variantsLogged:d.variantsLogged,hasMatureCrops:W0(d.species),mutatedCrops:Rj(d.species),hasSeeds:V0(d.species),hasEggs:false,isComplete:d.isComplete});try{const d=ue.get("plants");if(d){const u=Lt.getCropVariants();for(const f of Object.keys(d))l.has(f)||s.set(f,{speciesId:f,type:"crop",variantsMissing:[...u],variantsLogged:[],hasMatureCrops:W0(f),mutatedCrops:gh(),hasSeeds:V0(f),hasEggs:!1,isComplete:!1});}}catch{}const c=new Set;for(const d of a.speciesDetails)c.add(d.species),s.set(d.species,{speciesId:d.species,type:"pet",variantsMissing:d.variantsMissing,variantsLogged:d.variantsLogged,abilitiesMissing:d.abilitiesMissing,abilitiesLogged:d.abilitiesLogged,hasMatureCrops:false,mutatedCrops:gh(),hasSeeds:false,hasEggs:q0(d.species),isComplete:d.isComplete});try{const d=ue.get("pets");if(d){const u=Lt.getPetVariants();for(const f of Object.keys(d))if(!c.has(f)){const h=d[f]?.pet?.abilities||[];s.set(f,{speciesId:f,type:"pet",variantsMissing:[...u],variantsLogged:[],abilitiesMissing:h,abilitiesLogged:[],hasMatureCrops:!1,mutatedCrops:gh(),hasSeeds:!1,hasEggs:q0(f),isComplete:!1});}}}catch{}return gd={weather:e,petAbilities:t,hasDawnbinder:n,hasMoonbinder:r,speciesContexts:s,cropProgress:i.speciesDetails,petProgress:a.speciesDetails,timestamp:Date.now()},Dg=false,gd}const Mj={Wet:"rgba(95, 255, 255, 1)",Chilled:"rgba(180, 230, 255, 1)",Frozen:"rgb(185, 200, 255)",Dawnlit:"rgb(245, 155, 225)",Dawncharged:"rgb(200, 150, 255)",Ambershine:"rgb(255, 180, 120)",Ambercharged:"rgb(250, 140, 75)",Thunderstruck:"rgb(255, 230, 50)",Gold:"rgb(235, 200, 0)",Rainbow:"linear-gradient(45deg, rgba(200,0,0,0.9), rgba(200,120,0,0.9), rgba(160,170,30,0.9), rgba(60,170,60,0.9), rgba(50,170,170,0.9), rgba(40,150,180,0.9), rgba(20,90,180,0.9), rgba(70,30,150,0.9))"},Lj=new Set(["Gold","Rainbow"]);let mh=null,Hl=null,Bg=null;function Wp(){if(mh)return;mh=new Map,Hl=new Map,Bg=new Map;const e=ue.get("weather");if(e)for(const[t,n]of Object.entries(e)){if(!n||typeof n!="object")continue;typeof n.groupId=="string"&&Bg.set(t,n.groupId);const r=n.mutator?.mutation;typeof r=="string"&&(mh.set(t,r),Hl.set(r,t));}}function Vp(e){return Wp(),Hl.get(e)??null}function K_(e){const n=ue.get("weather")?.[e]?.spriteId;if(typeof n=="string"){const r=n.lastIndexOf("/");return r>=0?n.substring(r+1):n}return `${e}Icon`}function qp(e){return ue.get("weather")?.[e]?.name??e}function Oj(e){return Wp(),Bg.get(e)??null}function X_(e){return Wp(),Hl.has(e)}function Y_(e){const t=ue.get("mutations");return t?.[e]?(t[e].baseChance??0)>0&&!t[e].tileRef:Lj.has(e)}function vc(e){return e.toLowerCase().endsWith("charged")}function J_(e){if(!vc(e))return null;if(e==="Dawncharged")return {baseMutation:"Dawnlit",weatherId:"Dawn",celestialPlant:"DawnCelestial",celestialCheck:"hasDawnbinder"};if(e==="Ambercharged")return {baseMutation:"Ambershine",weatherId:"AmberMoon",celestialPlant:"MoonCelestial",celestialCheck:"hasMoonbinder"};const t=e.replace(/charged$/i,""),n=Vp(t);return {baseMutation:t,weatherId:n??t,celestialPlant:`${t}Celestial`,celestialCheck:`has${t}binder`}}function Nj(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r)|0;return `hsl(${Math.abs(t)%360}, 70%, 60%)`}function rs(e){return Mj[e]??Nj(e)}function $j(e){const t=rs(e);return t.startsWith("linear-gradient")||t.startsWith("radial-gradient")}function Kp(e){return ue.get("mutations")?.[e]?.name??e}function Dj(e){return Kp(e).charAt(0).toUpperCase()}function Fj(){Wp();const e=[];for(const t of Hl.keys())t!=="Frozen"&&(vc(t)||Y_(t)||e.push(t));return e}function Bj(){const e=ue.get("mutations");return e?Object.keys(e).filter(t=>vc(t)):[]}function K0(e){try{const n=ue.get("plants")?.[e]?.seed?.rarity??0;return [5,8,12,18,25,35,45][n]||15}catch{return 15}}function X0(e){try{const n=ue.get("plants")?.[e]?.plant?.secondsToMature??0;return n===0?0:n<300?2:n<3600?5:n<43200?8:12}catch{return 5}}function Y0(e){try{const n=ue.get("pets")?.[e]?.pet?.rarity??0;return [5,10,20,35,50][n]||20}catch{return 20}}function J0(e){try{const n=ue.get("pets")?.[e]?.pet?.hoursToMature??12;return n<=24?2:n<=72?5:n<=100?8:12}catch{return 5}}const md={Normal:10,"Max Weight":20,Wet:30,Chilled:40,Frozen:50,Dawnlit:55,Ambershine:60,Gold:70,Rainbow:100,Dawncharged:85,Ambercharged:90,"Gold:pet":40,"Rainbow:pet":90,"Max Weight:pet":70,"Normal:pet":5};function jj(e,t){const n=t?`${e}:pet`:e;if(md[n]!==void 0)return md[n];if(md[e]!==void 0)return md[e];if(vc(e))return 85;if(X_(e)){const r=Vp(e);if(r){const o=Oj(r);return o==="Hydro"?35:o==="Lunar"?55:45}return 50}return Y_(e)?70:50}function Le(e,t,n){return `${Kp(e)} ${t}: ${n}`}function Gj(e,t,n,r,o){const i=Vp(t);if(!i)return null;let a=e,s="";const l=r.petAbilities.cropMutationBoost==="active",c=Kr(n,t),d=qp(i),u=r.weather.activeWeathers.has(i)||i==="Frost"&&(r.weather.activeWeathers.has("Frost")||r.weather.activeWeathers.has("Snow")),f=r.weather.predictedWeathers.has(i)||i==="Rain"&&r.weather.rainPredictedSoon;return c&&n.hasMatureCrops?(a=Math.min(a,1),s=Le(t,o,"Pot + log mutated crops now!")):u&&n.hasMatureCrops?(a=Math.min(a,l?2:3),s=Le(t,o,`${d} active! Harvest now`)):u&&n.hasSeeds?(a=14,s=Le(t,o,`${d} active! Plant seeds`)):f&&n.hasMatureCrops?(a=12,s=Le(t,o,`${d} expected soon — crops ready`)):f?(a=20,s=Le(t,o,`${d} expected soon — grow crops`)):n.hasMatureCrops?(a=28,s=Le(t,o,`Wait for ${d}`)):(a=40,s=Le(t,o,`Grow crops, then wait for ${d}`)),{score:a,hint:s}}function zj(e,t,n,r,o){const i=J_(t);if(!i)return null;let a=e,s="";const{baseMutation:l,weatherId:c,celestialCheck:d}=i,u=qp(c),f=Kp(l),g=Kr(n,l);let h=false,y="celestial plant";return d==="hasDawnbinder"?(h=r.hasDawnbinder,y="Dawnbinder"):d==="hasMoonbinder"&&(h=r.hasMoonbinder,y="Moonbinder"),r.weather.activeWeathers.has(c)&&h&&g?(a=15,s=Le(t,o,`${u} active! 25%/min to charge`)):h&&g?(a=32,s=Le(t,o,`Wait for ${u} (25%/min)`)):h?(a=52,s=Le(t,o,`Get ${f} first, place next to ${y}`)):(a=e,s=Le(t,o,`Wait for ${u} and place next to ${y}`)),{score:a,hint:s}}function Uj(e,t,n,r,o){let i=e,a="";switch(t){case "Normal":{const s=K0(n.speciesId),l=X0(n.speciesId),c=s+l;if(n.hasMatureCrops)i=Math.min(i,1),a=Le(t,o,"Pot + log a mature crop now!");else if(n.hasSeeds){i=Math.min(c,20);const d=X0(n.speciesId);d===0?a=Le(t,o,"Plant seeds and pot + log immediately!"):d<=2?a=Le(t,o,"Plant seeds — matures in minutes"):d<=5?a=Le(t,o,"Plant seeds — matures in 5-60 min"):a=Le(t,o,"Plant seeds — long grow time");}else {i=c;const d=K0(n.speciesId);d<=5?a=Le(t,o,"Buy common seeds from shop"):d<=12?a=Le(t,o,"Buy uncommon/rare seeds from shop"):a=Le(t,o,"Buy rare seeds from shop");}break}case "Max Weight":{n.hasMatureCrops&&r.petAbilities.cropSizeBoost==="active"?(i=Math.min(i,1),a=Le(t,o,"Size boost pet active!")):n.hasMatureCrops&&r.petAbilities.cropSizeBoost==="owned"?(i=8,a=Le(t,o,"Activate size boost pet, then pot + log")):n.hasMatureCrops?(i=15,a=Le(t,o,"Need a pet with CropSizeBoost ability")):a=Le(t,o,"Grow crops and use size boost pet");break}case "Frozen":{Kr(n,"Chilled")&&Kr(n,"Wet")?(i=Math.min(i,1),a=Le(t,o,"Wet + Chilled crops ready — pot + log now!")):r.weather.isSnowing&&Kr(n,"Wet")?(i=10,a=Le(t,o,"Snowing! Wet crops → Chilled → Frozen")):r.weather.isRaining&&Kr(n,"Chilled")?(i=10,a=Le(t,o,"Raining! Chilled crops → Wet → Frozen")):r.weather.isSnowing||r.weather.isRaining?(i=25,a=Le(t,o,"Get both Wet and Chilled on same crop")):a=Le(t,o,"Need Wet + Chilled combo (rain + snow)");break}case "Gold":{n.hasMatureCrops&&r.petAbilities.goldGranter==="active"?(i=Math.min(i,1),a=Le(t,o,"Gold pet active! Pot + log (0.72%)")):n.hasMatureCrops&&r.petAbilities.goldGranter==="owned"?(i=10,a=Le(t,o,"Activate Gold granter pet (0.72%)")):r.petAbilities.goldGranter!=="none"?(i=25,a=Le(t,o,"Grow crops + use Gold granter (0.72%)")):a=Le(t,o,"Need a pet with GoldGranter ability");break}case "Rainbow":{n.hasMatureCrops&&r.petAbilities.rainbowGranter==="active"?(i=Math.min(i,1),a=Le(t,o,"Rainbow pet active! Pot + log (0.72%)")):n.hasMatureCrops&&r.petAbilities.rainbowGranter==="owned"?(i=15,a=Le(t,o,"Activate Rainbow granter pet (0.72%)")):r.petAbilities.rainbowGranter!=="none"?(i=40,a=Le(t,o,"Grow crops + use Rainbow granter (0.72%)")):a=Le(t,o,"Need a pet with RainbowGranter ability");break}default:{if(vc(t)){const s=zj(e,t,n,r,o);if(s)return s}if(X_(t)){const s=Gj(e,t,n,r,o);if(s)return s}a=Le(t,o,"Obtain this variant");}}return {score:i,hint:a}}function Hj(e,t,n,r,o){let i=e,a="";switch(t){case "Normal":{const s=Y0(n.speciesId),l=J0(n.speciesId),c=s+l;if(n.hasEggs){i=Math.min(c/2,10);const d=J0(n.speciesId);d<=2?a=Le(t,o,"Hatch egg — matures in 12-24 hours"):d<=5?a=Le(t,o,"Hatch egg — matures in ~3 days"):a=Le(t,o,"Hatch egg — long maturity time");}else {i=c;const d=Y0(n.speciesId);d<=5?a=Le(t,o,"Get Common Egg from shop"):d<=20?a=Le(t,o,"Get Uncommon/Rare Egg from shop"):a=Le(t,o,"Get Legendary/Mythic Egg from shop");}break}case "Max Weight":{r.petAbilities.maxStrengthBoost==="active"?(i=10,a=Le(t,o,"Max strength pet active — grow to max")):r.petAbilities.maxStrengthBoost==="owned"?(i=20,a=Le(t,o,"Activate MaxStrengthBoost pet")):a=Le(t,o,"Hatch a pet with Max STR 70/100");break}case "Gold":{r.petAbilities.petMutationBoost==="active"?(i=20,a=Le(t,o,"Mutation boost active — 0.72% chance")):n.hasEggs?(i=30,a=Le(t,o,"Hatch eggs — 0.72% chance")):a=Le(t,o,"Hatch eggs (0.72% chance)");break}case "Rainbow":{r.petAbilities.petMutationBoost==="active"?(i=30,a=Le(t,o,"Mutation boost active — 0.72% chance")):n.hasEggs?(i=50,a=Le(t,o,"Hatch eggs — 0.72% chance")):a=Le(t,o,"Hatch eggs (0.72% chance)");break}default:a=Le(t,o,"Obtain this variant");}return {score:i,hint:a}}function Q0(e){return e<=5?"available":e<=25?"easy":e<=60?"setup":"rare"}const Q_=["available","easy","setup","rare"],Wj={available:"Available Now",easy:"Easy",setup:"Needs Setup",rare:"Rare"},Ss={available:"#4CAF50",easy:"#FFB300",setup:"#FF9800",rare:"#F44336"};function Z_(e){const t=[];for(const[n,r]of e.speciesContexts){if(r.isComplete)continue;const o=$p(n,r.type);for(const i of r.variantsMissing){const a=jj(i,r.type==="pet"),{score:s,hint:l}=r.type==="crop"?Uj(a,i,r,e,o):Hj(a,i,r,e,o);t.push({speciesId:n,type:r.type,displayName:o,variantId:i,score:s,tier:Q0(s),actionHint:l});}if(r.type==="pet"&&r.abilitiesMissing)for(const i of r.abilitiesMissing){const s=`${i} ${o}: Trigger this ability`;t.push({speciesId:n,type:"pet",displayName:o,variantId:i,score:35,tier:Q0(35),actionHint:s,isAbility:true});}}return t.sort((n,r)=>n.score-r.score),t}function Vj(e){const t=new Map;for(const n of Q_)t.set(n,[]);for(const n of e)t.get(n.tier).push(n);return t}function qj(e){return e.filter(t=>t.tier==="available").length}function Kj(e){try{return ue.get("plants")?.[e]?.seed?.rarity??0}catch{return 0}}function Xj(e){try{return ue.get("pets")?.[e]?.pet?.rarity??0}catch{return 0}}function Yj(e){return  false}function Jj(e){return  false}function Z0(e){return ue.get("abilities")?.[e]?.color?.bg||"rgba(100, 100, 100, 0.9)"}const di={normal:"#A88A6B",rainbow:"linear-gradient(45deg, rgba(200,0,0,0.9), rgba(200,120,0,0.9), rgba(160,170,30,0.9), rgba(60,170,60,0.9), rgba(50,170,170,0.9), rgba(40,150,180,0.9), rgba(20,90,180,0.9), rgba(70,30,150,0.9))"};function no(e){switch(e){case "Rainbow":return di.rainbow;case "Gold":return Z0("GoldGranter");case "Max Weight":return Z0("CropSizeBoost");case "Normal":return di.normal;default:return rs(e)}}function Ht(e,t,n){const r=Kp(e),o=$p(t.speciesId,t.type);return `${r} ${o}: ${n}`}function ek(e,t){if(!t.variantsMissing.includes("Rainbow"))return null;if(t.type==="crop"){const r=e.petAbilities.rainbowGranter==="active";return t.hasMatureCrops&&r?{key:"Rainbow:harvest",variantId:"Rainbow",icon:null,label:Ht("Rainbow",t,"Rainbow pet active! Harvest (0.72%)"),isActive:true,isPredicted:false,bgColor:no("Rainbow")}:t.hasSeeds&&r?{key:"Rainbow:plant",variantId:"Rainbow",icon:null,label:Ht("Rainbow",t,"Plant seeds (0.72%)"),isActive:true,isPredicted:false,bgColor:no("Rainbow")}:null}if(!t.hasEggs)return null;const n=e.petAbilities.petMutationBoost!=="none";return {key:`Rainbow:pet:${n?"boost":"egg"}`,variantId:"Rainbow",icon:null,label:Ht("Rainbow",t,n?"Hatch eggs — 0.72% chance":"Hatch eggs"),isActive:true,isPredicted:false,bgColor:no("Rainbow")}}function tk(e,t){if(!t.variantsMissing.includes("Gold"))return null;if(t.type==="crop"){const r=e.petAbilities.goldGranter==="active";return t.hasMatureCrops&&r?{key:"Gold:harvest",variantId:"Gold",icon:null,label:Ht("Gold",t,"Gold pet active! Harvest (0.72%)"),isActive:true,isPredicted:false,bgColor:no("Gold")}:t.hasSeeds&&r?{key:"Gold:plant",variantId:"Gold",icon:null,label:Ht("Gold",t,"Plant seeds (0.72%)"),isActive:true,isPredicted:false,bgColor:no("Gold")}:null}if(!t.hasEggs)return null;const n=e.petAbilities.petMutationBoost!=="none";return {key:`Gold:pet:${n?"boost":"egg"}`,variantId:"Gold",icon:null,label:Ht("Gold",t,n?"Hatch eggs — 0.72% chance":"Hatch eggs"),isActive:true,isPredicted:false,bgColor:no("Gold")}}function Qj(e,t){return t.type!=="crop"||!t.variantsMissing.includes("Frozen")?null:e.weather.isSnowing&&Kr(t,"Chilled")?{key:"Frozen:active",variantId:"Frozen",icon:"FrostIcon",label:Ht("Frozen",t,"Chilled crops may freeze!"),isActive:true,isPredicted:false,bgColor:rs("Frozen")}:null}function nk(e,t){return t.variantsMissing.includes("Max Weight")?t.type==="crop"?t.hasMatureCrops&&e.petAbilities.cropSizeBoost==="active"?{key:"MaxWeight:crop:harvest",variantId:"Max Weight",icon:null,label:Ht("Max Weight",t,"Size boost active! Harvest"),isActive:true,isPredicted:false,bgColor:no("Max Weight")}:t.hasSeeds&&e.petAbilities.cropSizeBoost==="active"?{key:"MaxWeight:crop:plant",variantId:"Max Weight",icon:null,label:Ht("Max Weight",t,"Size boost active! Plant seeds"),isActive:true,isPredicted:false,bgColor:no("Max Weight")}:null:t.hasEggs&&e.petAbilities.maxStrengthBoost==="active"?{key:"MaxWeight:pet:hatch",variantId:"Max Weight",icon:null,label:Ht("Max Weight",t,"Strength boost active! Hatch"),isActive:true,isPredicted:false,bgColor:no("Max Weight")}:null:null}function rk(e,t){if(!t.variantsMissing.includes("Normal"))return null;if(t.type==="crop"){if(t.hasMatureCrops)return {key:"Normal:crop:harvest",variantId:"Normal",icon:null,label:Ht("Normal",t,"Pot + log a mature crop!"),isActive:true,isPredicted:false,bgColor:di.normal};if(t.hasSeeds)return {key:"Normal:crop:plant",variantId:"Normal",icon:null,label:Ht("Normal",t,"Plant seeds"),isActive:true,isPredicted:false,bgColor:di.normal};const n=Kj(t.speciesId),r=Yj(t.speciesId);return n<=1||r?{key:"Normal:crop:buy",variantId:"Normal",icon:null,label:Ht("Normal",t,"Buy seeds from shop"),isActive:r,isPredicted:false,bgColor:di.normal}:null}if(t.type==="pet"){if(t.hasEggs)return {key:"Normal:pet:hatch",variantId:"Normal",icon:null,label:Ht("Normal",t,"Hatch egg"),isActive:true,isPredicted:false,bgColor:di.normal};const n=Xj(t.speciesId),r=Jj(t.speciesId);return n<=1||r?{key:"Normal:pet:buy",variantId:"Normal",icon:null,label:Ht("Normal",t,"Get egg from shop"),isActive:r,isPredicted:false,bgColor:di.normal}:null}return null}function Zj(e,t,n){if(t.type!=="crop"||!t.variantsMissing.includes(n))return null;const r=Vp(n);if(!r)return null;const o=K_(r),i=qp(r),a=rs(n),s=Kr(t,n),l=e.weather.activeWeathers.has(r)||r==="Frost"&&(e.weather.activeWeathers.has("Frost")||e.weather.activeWeathers.has("Snow")),c=e.weather.predictedWeathers.has(r)||r==="Rain"&&e.weather.rainPredictedSoon;return s&&t.hasMatureCrops?{key:`${n}:harvest`,variantId:n,icon:o,label:Ht(n,t,"Pot + log mutated crops!"),isActive:true,isPredicted:false,bgColor:a}:l&&t.hasSeeds?{key:`${n}:plant`,variantId:n,icon:o,label:Ht(n,t,`${i} active! Plant seeds`),isActive:true,isPredicted:false,bgColor:a}:c&&t.hasSeeds?{key:`${n}:predicted`,variantId:n,icon:o,label:Ht(n,t,`${i} soon — have seeds ready`),isActive:false,isPredicted:true,bgColor:a}:null}function e4(e,t,n){if(t.type!=="crop"||!t.variantsMissing.includes(n))return null;const r=J_(n);if(!r)return null;const{baseMutation:o,weatherId:i,celestialCheck:a}=r,s=K_(i),l=rs(n),c=Kr(t,o);let d=false;if(a==="hasDawnbinder"?d=e.hasDawnbinder:a==="hasMoonbinder"&&(d=e.hasMoonbinder),e.weather.activeWeathers.has(i)&&d&&c){const f=qp(i);return {key:`${n}:active`,variantId:n,icon:s,label:Ht(n,t,`${f} active! Charging`),isActive:true,isPredicted:false,bgColor:l}}return null}function t4(){const e=[ek,tk];for(const t of Bj()){const n=t;e.push((r,o)=>e4(r,o,n));}for(const t of Fj()){const n=t;e.push((r,o)=>Zj(r,o,n));}return e.push(Qj),e.push(nk),e.push(rk),e}const n4=[ek,tk,nk,rk];function r4(e,t,n){const r=n.speciesContexts.get(e);if(!r||r.isComplete)return null;const o=t==="crop"?t4():n4;for(const i of o){const a=i(n,r);if(a)return a}return null}let ou=null;function o4(e){const t=document.createElement("div");return t.className="gemini-journal-hint",t.textContent=e,t.style.cssText=`
        position: fixed;
        background: var(--paper, rgba(45, 35, 28, 0.95));
        color: var(--fg);
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 11px;
        max-width: 300px;
        z-index: 10000;
        pointer-events: none;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        white-space: normal;
        word-wrap: break-word;
        opacity: 0;
        transform: scale(0.95);
        transition: opacity 0.15s ease-out, transform 0.15s ease-out;
        font-family: inherit;
        text-align: center;
    `,t}function i4(e,t){const n=t.getBoundingClientRect(),r=300,o=8;let i=n.left+n.width/2-r/2,a=n.top-40-o;i<8&&(i=8),i+r>window.innerWidth-8&&(i=window.innerWidth-r-8),a<8&&(a=n.bottom+o),e.style.left=`${i}px`,e.style.top=`${a}px`;}function ew(e,t){Xu();const n=o4(t);document.body.appendChild(n),i4(n,e),requestAnimationFrame(()=>{n.style.opacity="1",n.style.transform="scale(1)";}),ou=n;}function Xu(){ou&&(ou.remove(),ou=null);}function a4(){Xu();}function s4(e){const t=document.createElement("div");if(t.className="gemini-qol-journalGuide-badge",e.isActive&&t.setAttribute("data-active","true"),e.isPredicted&&t.setAttribute("data-predicted","true"),t.style.background=e.isActive?e.bgColor:e.isPredicted?"rgba(139, 115, 85, 0.6)":e.bgColor,e.icon)try{const r=me.toCanvas("ui",e.icon,{scale:.6});r.className="gemini-qol-journalGuide-badge-icon",r.style.width="14px",r.style.height="14px",r.style.imageRendering="pixelated",t.appendChild(r);}catch(r){console.warn("[JournalGuide] Failed to render badge icon:",e.icon,r);const o=document.createElement("span");o.textContent=e.variantId.charAt(0),o.className="gemini-qol-journalGuide-badge-icon-fallback",t.appendChild(o);}const n=document.createElement("span");return n.className="gemini-qol-journalGuide-badge-letter",n.textContent=e.variantId.charAt(0).toUpperCase(),n.style.cssText=`
        color: white;
        font-size: 10px;
        font-weight: bold;
    `,t.appendChild(n),t.addEventListener("mouseenter",()=>ew(t,e.label)),t.addEventListener("mouseleave",Xu),t.addEventListener("click",r=>{r.stopPropagation(),ew(t,e.label),setTimeout(Xu,3e3);}),t}const tw={Normal:{letter:"N",color:"#A88A6B",bold:false},Wet:{letter:"W",color:"rgba(95, 255, 255, 1)",bold:true},Chilled:{letter:"C",color:"rgba(180, 230, 255, 1)",bold:true},Frozen:{letter:"F",color:"rgb(185, 200, 255)",bold:true},Dawnlit:{letter:"D",color:"rgb(245, 155, 225)",bold:true},Ambershine:{letter:"A",color:"rgb(255, 180, 120)",bold:true},Thunderstruck:{letter:"T",color:"rgb(255, 230, 50)",bold:true},Gold:{letter:"G",color:"rgb(235, 200, 0)",bold:true},Rainbow:{letter:"R",color:"linear-gradient(135deg, #D02128, #D94C52, #FC6D30, #E9B52F, #5EAC46, #48ADF4, #6D1CF0, #AE53B0)",bold:true,isGradient:true},Dawncharged:{letter:"D",color:"rgb(200, 150, 255)",bold:true},Ambercharged:{letter:"A",color:"rgb(250, 140, 75)",bold:true},"Max Weight":{letter:"S",color:"#717171",bold:false}};function l4(e){if(tw[e])return tw[e];const t=rs(e),n=Dj(e),r=$j(e);return {letter:n,color:t,bold:true,isGradient:r}}function ok(e,t){const n=l4(e),r=t??"12px",o=document.createElement("span");return o.textContent=n.letter,o.title=e,n.isGradient?o.style.cssText=`
            background: ${n.color};
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: bold;
            font-size: ${r};
            display: inline-block;
        `:o.style.cssText=`
            color: ${n.color};
            font-weight: ${n.bold?"bold":"normal"};
            font-size: ${r};
        `,o}function ik(e,t){const n=ok(e,t),r=n.textContent??e.charAt(0).toUpperCase(),o=n.getAttribute("style")??"";return {text:r,css:o}}const Bb="gemini-qol-journalGuide-tab",nw="gemini-qol-journalGuide-overlay";let jg=0;function c4(e,t){const n=document.createElement("button");n.className=Bb,n.type="button",n.style.cssText=`
        background: transparent;
        border: none;
        cursor: pointer;
        height: 60px;
        padding: 0;
        margin: 0;
    `;const r=document.createElement("div");r.className="McFlex",r.style.cssText=`
        display: flex;
        align-items: flex-end;
        justify-content: center;
        height: 100%;
    `;const o=document.createElement("div");o.className="gemini-qol-journalGuide-tab-inner",o.style.cssText=`
        display: flex;
        align-items: flex-start;
        justify-content: center;
        width: clamp(70px, 12vw, 100px);
        height: 20px;
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
        background: #d4a574;
        position: relative;
        border-left: 1px solid #e4b584;
        border-right: 1px solid #e4b584;
        border-top: 2px solid #f4c594;
        overflow: hidden;
        transition: height 0.3s ease-in-out;
    `;const i=document.createElement("span");if(i.textContent="★",i.style.cssText=`
        font-size: clamp(14px, 2vw, 16px);
        font-weight: bold;
        color: white;
        position: relative;
        z-index: 2;
    `,e>0){const a=document.createElement("span");a.className="gemini-qol-journalGuide-tab-badge",a.textContent=String(e),a.style.cssText=`
            position: absolute;
            top: -4px;
            right: 8px;
            background: #28a745;
            color: white;
            font-size: 9px;
            font-weight: bold;
            padding: 2px 5px;
            border-radius: 10px;
            z-index: 3;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        `,o.appendChild(a);}return o.appendChild(i),r.appendChild(o),n.appendChild(r),n.onmouseenter=()=>{n.hasAttribute("data-active")||(o.style.height="25px");},n.onmouseleave=()=>{n.hasAttribute("data-active")||(o.style.height="20px");},n.onclick=a=>{a.preventDefault(),a.stopPropagation();const s=Date.now();s-jg<300||(jg=s,t());},n}function d4(){const e=$r();if(!e)return null;const t=e.querySelectorAll(".McGrid");for(const n of t){const r=n.querySelectorAll(":scope > .McFlex");for(const o of r){const i=window.getComputedStyle(o);if((i.overflow==="hidden"||i.overflowY==="hidden")&&(o.textContent?.includes("JOURNAL")||o.querySelector(".McGrid")))return o}}return null}function u4(e){const t=document.createElement("div");t.className="gemini-qol-journalGuide-row",t.style.cssText=`
        display: grid;
        grid-template-columns: minmax(36px, 50px) 1fr;
        align-items: center;
        gap: 8px;
        padding: 6px 4px;
        border-radius: 4px;
        transition: background 0.2s;
        cursor: default;
    `;const n=document.createElement("div");if(n.style.cssText=`
        width: clamp(36px, 8vw, 50px);
        height: clamp(36px, 8vw, 50px);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        overflow: visible;
    `,me.isReady())try{const s=e.type==="crop"?"plant":"pet";let l=e.speciesId;e.type==="crop"&&(e.speciesId==="DawnCelestial"&&(l="DawnCelestialCrop"),e.speciesId==="MoonCelestial"&&(l="MoonCelestialCrop"),e.speciesId==="OrangeTulip"&&(l="Tulip"));const c=g=>{if(g==="Normal"||g==="Max Weight")return [];const h=ue.get("mutations");return h&&g in h?[g]:[]},d=e.isAbility?[]:c(e.variantId),u=(g,h)=>{try{if(me.has(g,h))return me.toCanvas(g,h,{scale:.5,mutations:d,boundsMode:d.length>0?"mutations":void 0})}catch{}return null},f=u(s,l)||(e.type==="crop"?u("tallplant",l):null)||u(s,l.toLowerCase())||(e.type==="crop"?u("tallplant",l.toLowerCase()):null);if(f)f.style.width="100%",f.style.height="100%",f.style.objectFit="contain",f.style.imageRendering="pixelated",f.style.display="block",n.appendChild(f);else {const g=document.createElement("span");g.textContent=e.type==="crop"?"🌱":"🐾",g.style.cssText="font-size: 20px;",n.appendChild(g);}}catch(s){console.warn("[JournalGuide] Failed to render sprite for",e.speciesId,s);const l=document.createElement("span");l.textContent=e.type==="crop"?"🌱":"🐾",l.style.cssText="font-size: 20px;",n.appendChild(l);}else {const s=document.createElement("span");s.textContent=e.type==="crop"?"🌱":"🐾",s.style.cssText="font-size: 20px;",n.appendChild(s);}t.appendChild(n);const r=document.createElement("div");r.style.cssText="display: flex; flex-direction: column; gap: 2px; min-width: 0; overflow: hidden;";const o=document.createElement("div");o.style.cssText="display: flex; align-items: center; gap: 6px;";const i=document.createElement("span");if(i.textContent=e.displayName,i.style.cssText="font-weight: bold; font-size: 13px; color: #3D3325; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;",o.appendChild(i),e.isAbility){const s=document.createElement("span");s.textContent=e.variantId,s.style.cssText="font-size: 10px; font-weight: bold; color: #9575cd; background: rgba(149, 117, 205, 0.15); padding: 2px 6px; border-radius: 4px;",o.appendChild(s);}else {const s=ok(e.variantId,"14px");o.appendChild(s);}r.appendChild(o);const a=document.createElement("div");return a.textContent=e.actionHint,a.style.cssText="font-size: 11px; color: #6B5D50; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;",r.appendChild(a),t.appendChild(r),t.onmouseenter=()=>{t.style.background="rgba(212, 196, 168, 0.3)";},t.onmouseleave=()=>{t.style.background="";},t}function p4(e,t){const n=document.createElement("div");n.style.cssText="margin-bottom: 16px;";const r=document.createElement("div");r.style.cssText=`
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 8px 12px;
        background: ${Ss[e]}15;
        border-left: 4px solid ${Ss[e]};
        border-radius: 4px;
        margin-bottom: 8px;
        cursor: pointer;
        transition: background 0.2s;
    `;const o=document.createElement("span");o.textContent=Wj[e],o.style.cssText="font-size: 13px; font-weight: 600; color: #3D3325;";const i=document.createElement("span");i.textContent=String(t.length),i.style.cssText=`font-size: 11px; font-weight: bold; color: white; background: ${Ss[e]}; padding: 2px 8px; border-radius: 10px;`,r.append(o,i);const a=document.createElement("div");a.style.cssText="display: flex; flex-direction: column; gap: 6px; padding: 0 4px;";let s=e==="easy"||e==="setup"||e==="rare";s&&(a.style.display="none");for(const l of t)a.appendChild(u4(l));return r.onclick=()=>{s=!s,a.style.display=s?"none":"flex";},r.onmouseenter=()=>{r.style.background=`${Ss[e]}25`;},r.onmouseleave=()=>{r.style.background=`${Ss[e]}15`;},n.append(r,a),n}let Ao="all";function f4(e,t){return t==="all"?e:t==="crops"?e.filter(n=>n.type==="crop"):e.filter(n=>n.type==="pet")}function h4(e){const t=document.createElement("div");t.style.cssText=`
        display: flex;
        gap: 6px;
        justify-content: center;
        padding: 6px 0;
        flex-wrap: wrap;
    `;const n=[{label:"All",value:"all"},{label:"Crops",value:"crops"},{label:"Pets",value:"pets"}];for(const{label:r,value:o}of n){const i=document.createElement("button");i.textContent=r,i.style.cssText=`
            padding: 4px 16px;
            border-radius: 12px;
            border: none;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            background: ${o===Ao?"#8B7355":"#D4C4A8"};
            color: ${o===Ao?"white":"#5A4A3A"};
        `,i.onmouseenter=()=>{o!==Ao&&(i.style.background="#C4B5A0");},i.onmouseleave=()=>{o!==Ao&&(i.style.background="#D4C4A8");},i.onclick=()=>{Ao=o;for(const a of t.querySelectorAll("button")){const s=a,l=s.textContent===r;s.style.background=l?"#8B7355":"#D4C4A8",s.style.color=l?"white":"#5A4A3A";}e(o);},t.appendChild(i);}return t}function ak(e){const t=document.createElement("div");t.style.cssText=`
        padding: 12px 16px;
        flex: 1;
        overflow: hidden;
        display: flex;
        flex-direction: column;
    `;const n=document.createElement("div");n.style.cssText="text-align: center; padding-bottom: 8px;";const r=document.createElement("p");r.textContent="JOURNAL GUIDE",r.style.cssText="font-size: clamp(14px, 3vw, 20px); font-weight: bold; font-family: shrikhand, serif; color: #4F6981; margin-bottom: 4px;";const o=document.createElement("p");o.textContent="Recommended actions for missing variants",o.style.cssText="font-size: 12px; color: #A88A6B; margin-top: -2px;";const i=document.createElement("div");i.style.cssText="height: 4px; background: #D4C4A8; border-radius: 9999px; opacity: 0.5; margin: 8px 0;",n.append(r,o,i);const a=h4(u=>{const f=document.querySelector(".gemini-qol-journalGuide-overlay");f&&(f.innerHTML="",f.appendChild(ak(e)));}),s=document.createElement("div");s.style.cssText=`
        flex: 1;
        overflow-y: auto;
        padding-right: 4px;
    `,s.className="gemini-qol-journalGuide-scroll";const l=f4(e,Ao),c=Vj(l);let d=false;for(const u of Q_){const f=c.get(u)??[];f.length!==0&&(d=true,s.appendChild(p4(u,f)));}if(!d){const u=document.createElement("div");u.style.cssText="text-align: center; padding: 40px 20px; color: #A88A6B; font-size: 14px;",u.textContent=l.length===0?"No missing entries for this filter!":"All caught up!",s.appendChild(u);}return t.append(n,a,s),t}function g4(e,t){Dp("guide");const n=document.querySelector(`.${Bb}`),r=n?.querySelector(".gemini-qol-journalGuide-tab-inner");r&&(r.style.height="35px",n?.setAttribute("data-active","true"));const o=d4();if(!o){console.warn("[JournalGuide] Cannot activate Guide tab: content wrapper not found");return}const i=[];for(const l of Array.from(o.children))l instanceof HTMLElement&&!l.classList.contains(nw)&&(i.push(l),l.style.visibility="hidden");t.add(()=>{for(const l of i)l.style.visibility="";});const a=document.createElement("div");a.className=nw,a.style.cssText=`
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 10;
        background: transparent;
        display: flex;
        flex-direction: column;
    `,window.getComputedStyle(o).position==="static"&&(o.style.position="relative",t.add(()=>{o.style.position="";})),a.appendChild(ak(e)),o.appendChild(a),t.add(()=>a.remove());}function m4(){Dp(null);const e=document.querySelector(`.${Bb}`),t=e?.querySelector(".gemini-qol-journalGuide-tab-inner");t&&(t.style.height="20px",e?.removeAttribute("data-active")),Ao="all";}function b4(){Ao="all",jg=0;}let fn=Tt(),Ea=Tt(),Wl=false,Di=false;const lr=new Map;let bi=null;function sk(){const e=$r();if(!e)return null;const t=e.querySelectorAll(".chakra-text, p, span");for(const n of t){const r=n.textContent?.trim();if(r==="Crops"||r==="Pets"||r==="All"){const o=n.closest("button");if(o){const i=o.parentElement;if(i&&i.querySelectorAll("button").length>=2)return i}}}return null}function Gg(){const e=sk();if(!e)return {crops:null,pets:null,all:null};let t=null,n=null,r=null;const o=e.querySelectorAll("button");for(const i of o){const a=i.textContent?.trim();a==="Crops"&&(t=i),a==="Pets"&&(n=i),a==="All"&&(r=i);}return {crops:t,pets:n,all:r}}function v4(e,t){const n=[];for(const l of e){const c=l.querySelectorAll(".chakra-text, p, span");let d=null;for(const u of c){const f=u.textContent?.trim()??"";if(!(f.includes("%")||/^\d+\/\d+$/.test(f))&&!(f.length<2||f.length>30)&&f!=="???"){const g=lo(f);if(g&&g.type===t){d=g.id;break}}}n.push(d??"");}const r=t==="crop"?ue.get("plants"):ue.get("pets"),o=r?Object.keys(r):[],i=new Set(n.filter(l=>l!=="")),a=o.filter(l=>!i.has(l));let s=0;for(let l=0;l<n.length;l++)n[l]===""&&s<a.length&&(n[l]=a[s],s++);return n}function y4(e){const t=Lb();if(!t)return null;const n=Array.from(t.querySelectorAll(":scope > .McGrid")),r=n.indexOf(e);if(r===-1)return null;const o=w4();let i,a,s;if(!o||o==="all"){const c=ue.get("plants"),d=c?Object.keys(c).length:0;r<d?(i="crop",a=n.slice(0,d),s=r):(i="pet",a=n.slice(d),s=r-d);}else i=o==="crops"?"crop":"pet",a=n,s=r;const l=v4(a,i);return s<l.length&&l[s]?{element:e,speciesId:l[s],category:i}:null}function w4(){const e=Gg(),t=n=>{if(!n)return  false;const r=n.querySelector('[class*="MotionMcFlex"], .MotionMcFlex');return r instanceof HTMLElement?r.offsetHeight>=30:false};return t(e.crops)?"crops":t(e.pets)?"pets":t(e.all)?"all":null}function x4(){const e=[],t=new Set,n=Lb();if(n){const o=n.querySelectorAll(":scope > .McGrid");for(const i of o){const a=rw(i);a&&!t.has(a.speciesId)&&(e.push(a),t.add(a.speciesId));}}const r=document.querySelector(".gemini-journal-allOverlay");if(r){const o=r.querySelectorAll(".gemini-journal-allOverlay-row");for(const i of o){const a=rw(i);a&&!t.has(a.speciesId)&&(e.push(a),t.add(a.speciesId));}}return e}function rw(e){const t=e.querySelectorAll(".chakra-text, p, span");let n=false;for(const r of t){const o=r.textContent?.trim()??"";if(o.includes("%")||/^\d+\/\d+$/.test(o))continue;if(o==="???"){n=true;continue}if(o.length<2||o.length>30)continue;const i=lo(o);if(i)return {element:e,speciesId:i.id,category:i.type}}return n?y4(e):null}function jb(){if(Di)return;const e=Fb(),t=x4(),n=new Set;for(const{element:r,speciesId:o,category:i}of t){n.add(o);const a=r4(o,i,e),s=lr.get(o);if(!(a&&s&&s.badgeKey===a.key)&&(s&&(s.element.remove(),lr.delete(o)),a)){const l=s4(a);r.style.position=r.style.position||"relative",r.appendChild(l),lr.set(o,{element:l,badgeKey:a.key});}}for(const[r,{element:o}]of lr)n.has(r)||(o.remove(),lr.delete(r));}function lk(){if(Di)return;Di=true,lr.forEach(({element:n})=>n.remove()),lr.clear();const e=Fb(),t=Z_(e);g4(t,Ea),console.log("[JournalGuide] Guide tab activated");}function Yu(){Di&&(Di=false,m4(),Ea.run(),Ea=Tt(),gn(()=>jb()),console.log("[JournalGuide] Guide tab deactivated"));}function _s(){bi!==null&&clearTimeout(bi),bi=window.setTimeout(()=>{bi=null,Fg(),gn(()=>{jb(),Di&&lk();});},300);}function C4(){const e=sk();if(!e||e.querySelector(".gemini-qol-journalGuide-tab"))return;const{pets:t}=Gg();if(!t)return;const n=Fb(),r=Z_(n),o=qj(r),i=c4(o,lk);t.nextSibling?e.insertBefore(i,t.nextSibling):e.appendChild(i),fn.add(()=>i.remove());const a=()=>{gn(()=>Yu());},{crops:s,pets:l}=Gg();s&&(s.addEventListener("click",a),fn.add(()=>s.removeEventListener("click",a))),l&&(l.addEventListener("click",a),fn.add(()=>l.removeEventListener("click",a)));const c=document.querySelector(".gemini-allTab-tab")?.parentElement;c&&(c.addEventListener("click",a),fn.add(()=>c.removeEventListener("click",a)));const d=Ob(u=>{u!=="guide"&&Di&&gn(()=>Yu());});fn.add(d),console.log("[JournalGuide] Guide tab injected");}function iu(){gn(()=>{try{if(!$r()){lr.forEach(({element:t})=>t.remove()),lr.clear(),Yu();return}C4(),jb();}catch(e){console.warn("[JournalGuide] processPage error:",e);}});}let vi=null;function S4(){vi!==null&&clearTimeout(vi),vi=window.setTimeout(()=>{Bo()||iu(),vi=null;},200);}function _4(){setTimeout(iu,100),setTimeout(iu,400),setTimeout(iu,800);const e=new MutationObserver(()=>{Bo()||S4();});e.observe(document.body,{childList:true,subtree:true}),Fo(fn,e);const t=gr().subscribeStable(()=>{_s();});fn.add(t);const n=po().subscribe(()=>{_s();});fn.add(n);const r=En().subscribeStable(()=>{_s();});fn.add(r);const o=()=>{Fg(),_s();};window.addEventListener("gemini:journal-updated",o),fn.add(()=>window.removeEventListener("gemini:journal-updated",o));const i=()=>{Fg(),_s();};window.addEventListener(Me.WEATHER_TRANSITION,i),fn.add(()=>window.removeEventListener(Me.WEATHER_TRANSITION,i)),_j(fn),fn.add(()=>{bi!==null&&(clearTimeout(bi),bi=null),vi!==null&&(clearTimeout(vi),vi=null);});}function k4(){lr.forEach(({element:e})=>e.remove()),lr.clear(),Yu(),kj(),Ea.run(),Ea.clear(),fn.run(),fn.clear(),fn=Tt(),Ea=Tt();}function E4(){Wl||(Wl=true,MF(),_4(),console.log("[JournalGuide] Initialized"));}function A4(){Wl&&(Wl=false,k4(),LF(),a4(),b4(),console.log("[JournalGuide] Destroyed"));}function T4(){return Wl}const I4=Object.freeze(Object.defineProperty({__proto__:null,destroy:A4,init:E4,isEnabled:T4},Symbol.toStringTag,{value:"Module"}));function P4(){const e=Fu();Ye(pn.JOURNAL_HINTS,true),Ye(pn.JOURNAL_FILTER_SORT,true),Ye(pn.JOURNAL_GUIDE,true),e.register({id:"abilitiesInject",name:"Journal Abilities",description:"Shows pet abilities in journal modal",injection:kD,storageKey:pn.ABILITIES_INJECT,defaultEnabled:true}),e.register({id:"journalHints",name:"Journal Hints",description:"Shows hints for missing journal entries on hover",injection:eF,storageKey:pn.JOURNAL_HINTS,defaultEnabled:true}),e.register({id:"journalFilterSort",name:"Journal Filter/Sort",description:"Adds filter and sort controls to journal overview",injection:gF,storageKey:pn.JOURNAL_FILTER_SORT,defaultEnabled:true}),e.register({id:"journalAllTab",name:"Journal All Tab",description:"Adds an All tab showing combined crops and pets view",injection:IF,storageKey:pn.JOURNAL_ALL_TAB,defaultEnabled:true}),e.register({id:"journalGuide",name:"Journal Guide",description:"Shows difficulty-sorted recommendations and progress badges",injection:I4,storageKey:pn.JOURNAL_GUIDE,defaultEnabled:true});}const ow=lt.JOURNAL,bh={injections:{abilitiesInject:true,journalHints:true,journalFilterSort:true,journalAllTab:true,journalGuide:true}};function R4(){const e=Xe(ow,null);return e||(Xe(lt.JOURNAL_CHECKER,null)&&Ye(ow,bh),bh)}let ks=false;const Lt={init(){ks||(ks=true,R4(),nD(),P4());},destroy(){ks&&(ks=false,rD());},isReady(){return ks},getProgress(){return null},getMyJournal:c_,getCropVariants:d_,getPetVariants:u_,getAllMutations:eD,getPetAbilities:p_,calculateProduceProgress:f_,calculatePetProgress:h_,aggregateJournalProgress:Np,getMissingSummary:tD,refresh:oD,dispatchUpdate:Ib},Gb=lt.BULK_FAVORITE,ck={enabled:false,position:"top-right"};function yc(){return Xe(Gb,ck)}function dk(e){Ye(Gb,e);}function M4(e){const t=yc();t.position=e,dk(t);}function uk(){return yc().enabled}function L4(e){return typeof e=="object"&&e!==null&&"id"in e&&typeof e.id=="string"}async function O4(e){const t=En().get();if(!t?.items)return console.warn("[BulkFavorite] No inventory data available"),0;const n=new Set(t.favoritedItemIds??[]);let r=0;for(const o of t.items){if(!L4(o))continue;const i=n.has(o.id);e&&i||!e&&!i||(await Ap(o.id,e),r++,await N4(50));}return console.log(`[BulkFavorite] ${e?"Favorited":"Unfavorited"} ${r} items`),r}function N4(e){return new Promise(t=>setTimeout(t,e))}let bd=false;const zg={init(){bd||(bd=true,console.log("✅ [MGBulkFavorite] Feature initialized"));},isReady(){return bd},DEFAULT_CONFIG:ck,STORAGE_KEY:Gb,loadConfig:yc,saveConfig:dk,isEnabled:uk,setPosition:M4,bulkFavorite:O4,destroy(){bd=false;}};class $4{constructor(){de(this,"achievements",new Map);de(this,"data");de(this,"STORAGE_KEY",lt.ACHIEVEMENTS);de(this,"onUnlockCallbacks",[]);de(this,"onProgressCallbacks",[]);this.data=this.loadData();}loadData(){return Xe(this.STORAGE_KEY,{unlocked:{},progress:{}})}saveData(){Ye(this.STORAGE_KEY,this.data);}register(t){this.achievements.set(t.id,t),this.data.progress[t.id]||(this.data.progress[t.id]={current:0,target:t.target,percentage:0});}registerMany(t){for(const n of t)this.register(n);}async checkAchievement(t){const n=this.achievements.get(t);if(!n)throw new Error(`Achievement not found: ${t}`);const r=this.isUnlocked(t),o=await n.checkProgress(),i={current:o,target:n.target,percentage:Math.min(100,Math.floor(o/n.target*100))},a=this.data.progress[t];this.data.progress[t]=i;const s=o>=n.target;return !r&&s?this.unlock(t,i):s||this.triggerProgressCallbacks({achievement:n,progress:i,previousProgress:a}),this.saveData(),{id:t,wasUnlocked:r,isUnlocked:s,progress:i}}async checkAllAchievements(){const t=[];for(const n of this.achievements.keys()){const r=await this.checkAchievement(n);t.push(r);}return t}unlock(t,n){const r=this.achievements.get(t);if(!r)return;const o={achievementId:t,unlockedAt:Date.now(),progress:n};this.data.unlocked[t]=o,this.saveData(),this.triggerUnlockCallbacks({achievement:r,unlockedAt:o.unlockedAt,progress:n});}isUnlocked(t){return !!this.data.unlocked[t]}getAchievement(t){return this.achievements.get(t)||null}getAllAchievements(){return Array.from(this.achievements.values())}getAchievementsByCategory(t){return Array.from(this.achievements.values()).filter(n=>n.category===t)}getAchievementsByRarity(t){return Array.from(this.achievements.values()).filter(n=>n.rarity===t)}getUnlockedAchievements(){return Object.values(this.data.unlocked)}getLockedAchievements(){return Array.from(this.achievements.values()).filter(t=>!this.isUnlocked(t.id)&&!t.hidden)}getProgress(t){return this.data.progress[t]||null}getCompletionPercentage(){const t=this.achievements.size,n=Object.keys(this.data.unlocked).length;return t>0?Math.floor(n/t*100):0}getCompletionStats(){const t=this.achievements.size,n=Object.keys(this.data.unlocked).length,r=t-n,o=this.getCompletionPercentage();return {total:t,unlocked:n,locked:r,percentage:o}}onUnlock(t){return this.onUnlockCallbacks.push(t),()=>{const n=this.onUnlockCallbacks.indexOf(t);n!==-1&&this.onUnlockCallbacks.splice(n,1);}}onProgress(t){return this.onProgressCallbacks.push(t),()=>{const n=this.onProgressCallbacks.indexOf(t);n!==-1&&this.onProgressCallbacks.splice(n,1);}}triggerUnlockCallbacks(t){for(const n of this.onUnlockCallbacks)try{n(t);}catch(r){console.warn("[Achievements] Unlock callback error:",r);}}triggerProgressCallbacks(t){for(const n of this.onProgressCallbacks)try{n(t);}catch(r){console.warn("[Achievements] Progress callback error:",r);}}reset(){this.data={unlocked:{},progress:{}};for(const t of this.achievements.values())this.data.progress[t.id]={current:0,target:t.target,percentage:0};this.saveData();}exportData(){return JSON.stringify(this.data,null,2)}importData(t){try{const n=JSON.parse(t);return this.data=n,this.saveData(),!0}catch(n){return console.warn("[Achievements] Failed to import data:",n),false}}}let bl=null;function nr(){return bl||(bl=new $4),bl}function D4(){bl&&(bl=null);}let vd=false;const F4={init(){vd||(nr(),vd=true,console.log("✅ [MGAchievements] Initialized"));},isReady(){return vd},getManager(){return nr()},register:(...e)=>nr().register(...e),registerMany:(...e)=>nr().registerMany(...e),isUnlocked:(...e)=>nr().isUnlocked(...e),getAll:()=>nr().getAllAchievements(),getUnlocked:()=>nr().getUnlockedAchievements(),getStats:()=>nr().getCompletionStats(),checkAll:()=>nr().checkAllAchievements(),onUnlock:(...e)=>nr().onUnlock(...e),onProgress:(...e)=>nr().onProgress(...e),destroy(){D4(),vd=false;}},B4={enabled:true},pk=lt.ANTI_AFK,j4=["visibilitychange","blur","focus","focusout","pagehide","freeze","resume"],G4=25e3,z4=1,U4=1e-5,Ze={listeners:[],savedProps:{hidden:void 0,visibilityState:void 0,hasFocus:null},audioCtx:null,oscillator:null,gainNode:null,heartbeatInterval:null};function H4(){const e=(t,n)=>{const r=o=>{o.stopImmediatePropagation(),o.preventDefault?.();};t.addEventListener(n,r,{capture:true}),Ze.listeners.push({type:n,handler:r,target:t});};for(const t of j4)e(document,t),e(window,t);}function W4(){for(const{type:e,handler:t,target:n}of Ze.listeners)try{n.removeEventListener(e,t,{capture:!0});}catch{}Ze.listeners.length=0;}function V4(){const e=Object.getPrototypeOf(document);Ze.savedProps.hidden=Object.getOwnPropertyDescriptor(e,"hidden"),Ze.savedProps.visibilityState=Object.getOwnPropertyDescriptor(e,"visibilityState"),Ze.savedProps.hasFocus=document.hasFocus?document.hasFocus.bind(document):null;try{Object.defineProperty(e,"hidden",{configurable:!0,get:()=>!1});}catch{}try{Object.defineProperty(e,"visibilityState",{configurable:!0,get:()=>"visible"});}catch{}try{document.hasFocus=()=>!0;}catch{}}function q4(){const e=Object.getPrototypeOf(document);try{Ze.savedProps.hidden&&Object.defineProperty(e,"hidden",Ze.savedProps.hidden);}catch{}try{Ze.savedProps.visibilityState&&Object.defineProperty(e,"visibilityState",Ze.savedProps.visibilityState);}catch{}try{Ze.savedProps.hasFocus&&(document.hasFocus=Ze.savedProps.hasFocus);}catch{}}function Ju(){Ze.audioCtx&&Ze.audioCtx.state!=="running"&&Ze.audioCtx.resume?.().catch(()=>{});}function K4(){try{const e=window.AudioContext||window.webkitAudioContext;Ze.audioCtx=new e({latencyHint:"interactive"}),Ze.gainNode=Ze.audioCtx.createGain(),Ze.gainNode.gain.value=U4,Ze.oscillator=Ze.audioCtx.createOscillator(),Ze.oscillator.frequency.value=z4,Ze.oscillator.connect(Ze.gainNode).connect(Ze.audioCtx.destination),Ze.oscillator.start(),document.addEventListener("visibilitychange",Ju,{capture:!0}),window.addEventListener("focus",Ju,{capture:!0});}catch{fk();}}function fk(){try{Ze.oscillator?.stop();}catch{}try{Ze.oscillator?.disconnect(),Ze.gainNode?.disconnect();}catch{}try{Ze.audioCtx?.close?.();}catch{}document.removeEventListener("visibilitychange",Ju,{capture:true}),window.removeEventListener("focus",Ju,{capture:true}),Ze.oscillator=null,Ze.gainNode=null,Ze.audioCtx=null;}function X4(){const e=document.querySelector("canvas")||document.body||document.documentElement;Ze.heartbeatInterval=window.setInterval(()=>{try{e.dispatchEvent(new MouseEvent("mousemove",{bubbles:!0,clientX:1,clientY:1}));}catch{}},G4);}function Y4(){Ze.heartbeatInterval!==null&&(clearInterval(Ze.heartbeatInterval),Ze.heartbeatInterval=null);}function vh(){V4(),H4(),K4(),X4();}function yh(){Y4(),fk(),W4(),q4();}let yd=false,Gn=false;function na(){return Xe(pk,B4)}function wh(e){Ye(pk,e);}const Aa={init(){if(yd)return;const e=na();yd=true,e.enabled?(vh(),Gn=true,console.log("[MGAntiAfk] Initialized and started")):console.log("[MGAntiAfk] Initialized but disabled");},isReady(){return yd},isRunning(){return Gn},isEnabled(){return na().enabled},enable(){const e=na();e.enabled=true,wh(e),Gn||(vh(),Gn=true,console.log("[MGAntiAfk] Enabled"));},disable(){const e=na();e.enabled=false,wh(e),Gn&&(yh(),Gn=false,console.log("[MGAntiAfk] Disabled"));},toggle(){Aa.isEnabled()?Aa.disable():Aa.enable();},getConfig(){return na()},updateConfig(e){const n={...na(),...e};wh(n),n.enabled&&!Gn?(vh(),Gn=true):!n.enabled&&Gn&&(yh(),Gn=false);},destroy(){Gn&&(yh(),Gn=false),yd=false,console.log("[MGAntiAfk] Destroyed");}},hk=lt.PET_TEAM,J4={enabled:false,teams:[],activeTeamId:null},zb=3,iw=50,Wt="";function ln(){return Xe(hk,J4)}function jo(e){Ye(hk,e);}function Q4(e){const n={...ln(),...e};return jo(n),n}function Z4(){return ln().enabled}function e8(e){Q4({enabled:e});}function t8(){return crypto.randomUUID()}function Ug(){return Date.now()}function gk(e=[]){const t=[...e];for(;t.length<zb;)t.push(Wt);return [t[0]||Wt,t[1]||Wt,t[2]||Wt]}function mk(e,t){const n=ln(),r=e.trim();return r?!n.teams.some(o=>o.name.trim()===r&&o.id!==t):false}function bk(e,t){const n=ln();if(!e.some(i=>i!==Wt))return  true;const o=[...e].sort().join(",");return !n.teams.some(i=>i.id===t?false:[...i.petIds].sort().join(",")===o)}function vk(e){const n=po().get(),r=new Set(n.all.map(i=>i.id)),o=ln();for(const i of o.teams)for(const a of i.petIds)a!==Wt&&r.add(a);for(const i of e)if(i!==Wt&&!r.has(i))return  false;return  true}function yk(e){const n=po().get(),r=new Map(n.all.map(i=>[i.id,i])),o=[];for(const i of e.petIds){if(i===Wt)continue;const a=r.get(i);a&&o.push(a);}return o}function n8(e){return e.petIds.every(t=>t!==Wt)}function r8(e){const t=[];for(let n=0;n<zb;n++)e.petIds[n]===Wt&&t.push(n);return t}function o8(e){return e.petIds.filter(t=>t!==Wt).length}function i8(e){return e.petIds.every(t=>t===Wt)}function a8(e,t){return e.petIds.includes(t)}function s8(e,t){return e.petIds.indexOf(t)}function l8(e,t=[]){const n=ln();if(n.teams.length>=iw)throw new Error(`Maximum number of teams (${iw}) reached`);if(!mk(e))throw new Error(`Team name "${e}" already exists`);const r=e.trim();if(!r)throw new Error("Team name cannot be empty");const o=gk(t);if(!vk(o))throw new Error("One or more pet IDs do not exist");if(!bk(o))throw new Error("A team with this exact composition already exists");const i={id:t8(),name:r,petIds:o,createdAt:Ug(),updatedAt:Ug()};return n.teams.push(i),jo(n),i}function wk(e,t){const n=ln(),r=n.teams.findIndex(a=>a.id===e);if(r===-1)return null;const o=n.teams[r];if(t.name!==void 0){const a=t.name.trim();if(!a)throw new Error("Team name cannot be empty");if(!mk(a,e))throw new Error(`Team name "${a}" already exists`);t.name=a;}if(t.petIds!==void 0){const a=gk(t.petIds);if(!vk(a))throw new Error("One or more pet IDs do not exist");if(!bk(a,e))throw new Error("A team with this exact composition already exists");t.petIds=a;}const i={...o,...t,id:o.id,createdAt:o.createdAt,updatedAt:Ug()};return n.teams[r]=i,jo(n),i}function c8(e){const t=ln(),n=t.teams.length;return t.teams=t.teams.filter(r=>r.id!==e),t.teams.length===n?false:(jo(t),true)}function d8(e){return ln().teams.find(n=>n.id===e)??null}function u8(){return [...ln().teams]}function p8(e){const t=ln(),n=e.trim();return t.teams.find(r=>r.name.trim()===n)??null}function f8(e){const t=ln(),n=new Map(t.teams.map(r=>[r.id,r]));if(e.length!==t.teams.length)return  false;for(const r of e)if(!n.has(r))return  false;return t.teams=e.map(r=>n.get(r)),jo(t),true}function h8(e,t){try{return wk(e,{name:t})!==null}catch(n){return console.warn(`[PetTeam] Failed to rename team ${e}:`,n),false}}function g8(){const n=po().get().byLocation.active.map(o=>o.id).sort(),r=ln();for(const o of r.teams){const i=o.petIds.filter(a=>a!=="").sort();if(i.length===n.length&&i.every((a,s)=>a===n[s]))return o.id}return null}function xk(){const e=g8(),t=ln();return e!==t.activeTeamId&&(t.activeTeamId=e,jo(t)),e}function Ck(e){const t=ln();t.activeTeamId=e,jo(t);}function m8(e){return xk()===e}function b8(e){const t=po(),n=En(),r=t.get();if(n.get().isFull)throw new Error("Cannot activate team: inventory is full");const i=r.byLocation.active,a=e.petIds.filter(d=>d!==Wt).sort(),s=i.map(d=>d.id).sort();if(JSON.stringify(a)===JSON.stringify(s)){console.log("[PetTeam] Team already active");return}const l=r.hutch,c=l.hasHutch?l.maxItems-l.currentItems:0;v8(e.petIds,c,r),Ck(e.id),console.log("[PetTeam] Team activated successfully");}function v8(e,t,n){const r=n.byLocation.active;let o=t;console.log(`[PetTeam] Starting swap with ${t} hutch spaces available`);for(let i=0;i<zb;i++){const a=e[i],s=r[i]??null;if(console.log(`[PetTeam] Slot ${i}: current=${s?.id.slice(0,8)??"empty"}, target=${a.slice(0,8)||"empty"}, hutchSpace=${o}`),s?.id===a){console.log(`[PetTeam] Slot ${i}: Same pet, skipping`);continue}if(a===Wt&&s){const l=o>0;console.log(`[PetTeam] Slot ${i}: Removing pet, storeInHutch=${l}`),y8(s.id,l),l&&o--;continue}if(!s&&a!==Wt){const c=n.all.find(d=>d.id===a)?.location==="hutch";console.log(`[PetTeam] Slot ${i}: Adding pet, fromHutch=${c}`),c&&o++,w8(a,n);continue}if(s&&a!==Wt){const c=n.all.find(u=>u.id===a)?.location==="hutch";c&&o++;const d=o>0;console.log(`[PetTeam] Slot ${i}: Swapping pets, fromHutch=${c}, storeInHutch=${d}`),x8(s.id,a,n,d),d&&o--;continue}}console.log(`[PetTeam] Swap complete, ${o} hutch spaces remaining`);}function y8(e,t){IS(e),t&&sb(e);}function w8(e,t){const n=t.all.find(r=>r.id===e);if(!n){console.warn(`[PetTeam] Pet ${e} not found`);return}n.location==="hutch"&&lb(e),AS(e);}function x8(e,t,n,r){const o=n.all.find(i=>i.id===t);if(!o){console.warn(`[PetTeam] Pet ${t} not found`);return}o.location==="hutch"&&lb(t),TS(e,t),r&&sb(e);}function C8(){try{return localStorage.getItem("aries_mod")!==null}catch(e){return console.warn("[PetTeam] Failed to access localStorage:",e),false}}function S8(){try{const e=localStorage.getItem("aries_mod");if(!e)return [];const n=JSON.parse(e)?.pets?.teams;return Array.isArray(n)?n.filter(r=>r&&typeof r=="object"):[]}catch(e){return console.warn("[PetTeam] Failed to read Aries teams:",e),[]}}function _8(e){const t=Date.now(),n=e.slots||[],r=[typeof n[0]=="string"?n[0]:Wt,typeof n[1]=="string"?n[1]:Wt,typeof n[2]=="string"?n[2]:Wt];return {name:e.name?.trim()||"Imported Team",petIds:r,createdAt:t,updatedAt:t}}function k8(){const e={success:false,source:"none",imported:0,errors:[]};if(!C8())return e.errors.push("Aries mod not detected. Install Aries mod first."),e;const t=S8();if(t.length===0)return e.errors.push("No teams found in Aries mod. Create teams in Aries first."),e;const n=ln();n.teams=[],n.activeTeamId=null;const r=new Set;for(const o of t)try{const i=_8(o);let a=i.name;if(r.has(a)){let l=1;for(;r.has(`${a} (${l})`);)l++;a=`${a} (${l})`;}r.add(a);const s={id:crypto.randomUUID(),name:a,petIds:i.petIds,createdAt:i.createdAt,updatedAt:i.updatedAt};n.teams.push(s),e.imported++;}catch(i){const a=i instanceof Error?i.message:String(i);e.errors.push(`Failed to import "${o.name}": ${a}`);}return e.imported>0&&(jo(n),e.success=true,e.source="aries"),e}let wd=false;const je={init(){if(wd)return;if(!ln().enabled){console.log("[PetTeam] Feature disabled");return}wd=true,console.log("[PetTeam] Feature initialized");},destroy(){wd&&(wd=false,console.log("[PetTeam] Feature destroyed"));},isEnabled:Z4,setEnabled:e8,createTeam:l8,updateTeam:wk,deleteTeam:c8,renameTeam:h8,getTeam:d8,getAllTeams:u8,getTeamByName:p8,reorderTeams:f8,getPetsForTeam:yk,isTeamFull:n8,getEmptySlots:r8,getFilledSlotCount:o8,isTeamEmpty:i8,isPetInTeam:a8,getPetSlotIndex:s8,getActiveTeamId:xk,setActiveTeamId:Ck,isActiveTeam:m8,activateTeam:b8,importFromAries:k8},E8=["PetXpBoost","PetXpBoostII","PetXpBoostIII","SnowyPetXpBoost"],Sk=lt.XP_TRACKER,A8={enabled:false,sortBy:"closestToMax",filterSpecies:[],filterHasXpBoost:false,updateIntervalMs:3e3,isPoppedOut:false,popOutPosition:null,collapsedSections:{activePets:false,allPets:false,xpBoostSummary:false}},Ta="XP Tracker",Ia="[XpTracker]";function os(){return Xe(Sk,A8)}function _k(e){Ye(Sk,e);}function kk(e){const n={...os(),...e};return _k(n),n}function Ek(){return os().enabled}function T8(e){kk({enabled:e});}function Ub(e){return E8.includes(e)}function I8(e){const t=ue.get("abilities");if(!t)return null;const n=t[e];return !n||!Ub(e)?null:{id:e,name:n.name??"XP Boost",baseProbability:n.baseProbability??0,bonusXp:n.baseParameters?.bonusXp??0,requiredWeather:n.baseParameters?.requiredWeather??null}}function Ak(e){return e.filter(Ub)}function Tk(e){return e.some(Ub)}function P8(e){switch(e){case "PetXpBoost":return "I";case "PetXpBoostII":return "II";case "PetXpBoostIII":return "III";case "SnowyPetXpBoost":return "Snowy";default:return "I"}}function Ik(e,t,n,r=100){const o=I8(e);if(!o)return null;const i=P8(e),a=o.requiredWeather,s=a===null||n===a,l=t/r,c=l*l,d=o.baseProbability,u=o.bonusXp,f=d,g=Math.floor(u*c),h=f/100*60,y=s?Math.floor(h*g):0;return {abilityId:e,abilityName:o.name,tier:i,baseChancePerMinute:d,actualChancePerMinute:f,baseXpPerProc:u,actualXpPerProc:g,expectedProcsPerHour:h,expectedXpPerHour:y,requiredWeather:a,isActive:s}}function Pk(e,t){const n={totalBonusXpPerHour:0,totalProcsPerHour:0,activeBoosterCount:0,boosters:[]};for(const r of e){const o=Ak(r.abilities);for(const i of o){const a=Ik(i,r.strength,t,r.maxStrength||100);a&&(n.boosters.push({petId:r.petId,petName:r.petName,stats:a}),a.isActive&&(n.totalBonusXpPerHour+=a.expectedXpPerHour,n.totalProcsPerHour+=a.expectedProcsPerHour,n.activeBoosterCount++));}}return n}function Rk(e,t,n,r=100){const o=Ak(e);return o.length===0?null:Ik(o[0],t,n,r)}function aw(e,t){return e.hoursToMaxStrength-t.hoursToMaxStrength}function R8(e,t){return t.hoursToMaxStrength-e.hoursToMaxStrength}function M8(e,t){return e.species.localeCompare(t.species)}function L8(e,t){return t.currentStrength-e.currentStrength}function O8(e,t){const n={active:0,inventory:1,hutch:2};return n[e.location]-n[t.location]}function N8(e,t){return e.name.localeCompare(t.name)}function $8(e){switch(e){case "closestToMax":return aw;case "furthestFromMax":return R8;case "species":return M8;case "strength":return L8;case "location":return O8;case "name":return N8;default:return aw}}function Mk(e,t){const n=$8(t);return [...e].sort(n)}function D8(e,t){return t.length===0?e:e.filter(n=>t.includes(n.species))}function F8(e,t){return t?e.filter(n=>n.xpBoostStats!==null):e}function Lk(e,t){let n=e;return n=D8(n,t.filterSpecies),n=F8(n,t.filterHasXpBoost),n=Mk(n,t.sortBy),n}function Es(e){const t=je.getTeam(e);if(!t)return null;const n=Ok(t);if(n.length===0)return {teamId:t.id,teamName:t.name,pets:[],teamSummary:{baseXpPerHour:Zt,bonusXpPerHour:0,totalXpPerHour:Zt,activeBoosterCount:0,totalProcsPerHour:0}};const r=De.weather.get(),o=r.isActive?r.type:null,i=n.filter(d=>!d.isMature||Tk(d.abilities)).filter(d=>d.hunger>0).map(d=>({petId:d.id,petName:d.name??"",abilities:d.abilities,strength:d.currentStrength})),a=Pk(i,o),s=[],l=B8(n,a.totalBonusXpPerHour);for(const d of n){const u=Xs(d,o,a.totalBonusXpPerHour,l);s.push(u);}const c={baseXpPerHour:Zt,bonusXpPerHour:a.totalBonusXpPerHour,totalXpPerHour:Zt+a.totalBonusXpPerHour,activeBoosterCount:a.activeBoosterCount,totalProcsPerHour:a.totalProcsPerHour};return {teamId:t.id,teamName:t.name,pets:s,teamSummary:c}}function Ok(e){const t=De.myPets.get(),n=[];for(const r of e.petIds){if(!r)continue;const o=t.all.find(i=>i.id===r);o&&n.push(o);}return n}function B8(e,t){let n=0;for(const r of e){const o=hc(r.petSpecies,r.targetScale);if(gc(r.petSpecies,r.xp,o)>=o)continue;const a=r.hunger>0?Zt+t:0,s=Rp(r.petSpecies,r.xp,o,a>0?a:Zt);n=Math.max(n,s);}return n}function Xs(e,t,n,r){const o=hc(e.petSpecies,e.targetScale),i=gc(e.petSpecies,e.xp,o),a=i>=o,s=e.hunger<=0,c=s?0:(s?0:Zt)+n,d=Rk(e.abilities,i,t),u=a?null:vb(e.petSpecies,e.xp,i,o,c>0?c:Zt),f=Rp(e.petSpecies,e.xp,o,c>0?c:Zt),g=u!==null?xb(e.petSpecies,e.hunger,u):null,h=Ml(e.petSpecies,e.hunger,f),y=a&&d&&r>0?Cb(true,true,e.petSpecies,e.hunger,0,r):null;return {id:e.id,name:e.name??"",species:e.petSpecies,currentStrength:i,maxStrength:o,isMaxStrength:a,xpPerHour:c,hoursToNextStrength:u,hoursToMaxStrength:f,feedsToNextStrength:g,feedsToMaxStrength:h,isStarving:s,hunger:e.hunger,xpBoostStats:d,supportingFeeds:y,mutations:e.mutations,targetScale:e.targetScale}}function sw(e){const t=je.getTeam(e);if(!t)return 0;const n=Ok(t);if(n.length===0)return 0;const r=n.map(o=>{const i=hc(o.petSpecies,o.targetScale);return gc(o.petSpecies,o.xp,i)/i*100});return r.reduce((o,i)=>o+i,0)/r.length}function lw(e){if(!isFinite(e)||e<=0)return "0m";if(e<1)return `${Math.ceil(e*60)}m`;if(e<24)return `${e.toFixed(1)}h`;{const t=Math.floor(e/24),n=Math.floor(e%24);return `${t}d ${n}h`}}let Va=false,au=null,Xp=[],Hb=null;function j8(e,t,n){const r=hc(e.petSpecies,e.targetScale),o=gc(e.petSpecies,e.xp,r),i=o>=r,a=e.hunger<=0,s=a?0:Zt,l=Rk(e.abilities,o,t);l?.isActive&&l.expectedXpPerHour;const c=e.location==="active"&&!a?s+n:0,d=vb(e.petSpecies,e.xp,o,r,c>0?c:Zt),u=Rp(e.petSpecies,e.xp,r,c>0?c:Zt),f=xb(e.petSpecies,e.hunger,d),g=Ml(e.petSpecies,e.hunger,u);return {id:e.id,species:e.petSpecies,name:e.name,xp:e.xp,hunger:e.hunger,location:e.location,isStarving:a,currentStrength:o,maxStrength:r,isMaxStrength:i,hoursToNextStrength:d,hoursToMaxStrength:u,feedsToNextStrength:f,feedsToMaxStrength:g,baseXpPerHour:s,totalXpPerHour:c,xpBoostStats:l,targetScale:e.targetScale,abilities:e.abilities,mutations:e.mutations}}function Nk(){const e=De.myPets.get(),t=De.weather.get(),n=t.isActive?t.type:null,o=e.byLocation.active.filter(l=>!l.isMature||Tk(l.abilities)).filter(l=>l.hunger>0).map(l=>({petId:l.id,petName:l.name??"",abilities:l.abilities,strength:l.currentStrength})),i=Pk(o,n);Hb=i;const a=[];for(const l of e.all){const c=j8({id:l.id,petSpecies:l.petSpecies,name:l.name??"",xp:l.xp,hunger:l.hunger,targetScale:l.targetScale,abilities:l.abilities,mutations:l.mutations,location:l.location},n,i.totalBonusXpPerHour);a.push(c);}const s=Math.max(0,...a.map(l=>l.hoursToMaxStrength));for(const l of a)l.isMaxStrength&&l.xpBoostStats&&(l.feedsToMaxStrength=Cb(true,true,l.species,l.hunger,0,s));return a}function $k(){if(Va)return;if(!os().enabled){console.log(`${Ia} ${Ta} disabled`);return}console.log(`${Ia} Initializing ${Ta}...`),ue.isReady()&&(Xp=Nk()),Va=true,console.log(`${Ia} ${Ta} initialized`);}function Wb(){return Va&&ue.isReady()}function Vb(){return Wb()?Xp:[]}function G8(){return Vb().filter(e=>e.location==="active")}function z8(){return Hb}function qb(){Wb()&&(Xp=Nk());}function U8(e){Kb();const t=os(),n=e??t.updateIntervalMs;au=setInterval(()=>{Ek()&&qb();},n);}function Kb(){au&&(clearInterval(au),au=null);}function Dk(){Va&&(Kb(),Va=false,Xp=[],Hb=null,console.log(`${Ia} ${Ta} destroyed`));}function H8(){const e=os();return Lk(Vb(),{sortBy:e.sortBy,filterSpecies:e.filterSpecies,filterHasXpBoost:e.filterHasXpBoost})}function W8(e){T8(e),e?(Va=false,$k(),ue.isReady()&&qb(),console.log(`${Ia} ${Ta} enabled`)):(Dk(),console.log(`${Ia} ${Ta} disabled`));}const Hg={init:$k,isReady:Wb,destroy:Dk,loadConfig:os,saveConfig:_k,updateConfig:kk,isEnabled:Ek,setEnabled:W8,getAllPetsProgress:Vb,getActivePetsProgress:G8,getCombinedBoostStats:z8,getFilteredPets:H8,refresh:qb,startAutoUpdate:U8,stopAutoUpdate:Kb,sortPets:Mk,filterAndSortPets:Lk},Vl={EggGrowthBoost:{procRate:.21,minutesPerProc:7},EggGrowthBoostII_NEW:{procRate:.24,minutesPerProc:9},EggGrowthBoostII:{procRate:.27,minutesPerProc:11},SnowyEggGrowthBoost:{procRate:.35,minutesPerProc:10}},ql={PlantGrowthBoost:{procRate:.24,minutesPerProc:3},PlantGrowthBoostII:{procRate:.27,minutesPerProc:5},PlantGrowthBoostIII:{procRate:.3,minutesPerProc:7},SnowyPlantGrowthBoost:{procRate:.4,minutesPerProc:6}};[...Object.keys(Vl),...Object.keys(ql)];function Xb(e){const t=[];for(const n of e)for(const r of n.abilities)if(r in Vl){const o=Vl[r];t.push({petId:n.id,petName:n.name||n.petSpecies,abilityId:r,procRate:o.procRate,minutesPerProc:o.minutesPerProc});}return t}function Yb(e){const t=[];for(const n of e)for(const r of n.abilities)if(r in ql){const o=ql[r];t.push({petId:n.id,petName:n.name||n.petSpecies,abilityId:r,procRate:o.procRate,minutesPerProc:o.minutesPerProc});}return t}function Kl(e){let t=0,n=0;for(const r of e){const o=r.procRate*60;t+=o,n+=o*r.minutesPerProc;}return {procsPerHour:t,timeReductionPerHour:n}}function To(e){return e.some(t=>t.abilities.some(n=>n in Vl))}function Io(e){return e.some(t=>t.abilities.some(n=>n in ql))}let vl=null;function Fk(){const t=_t().get().plant;if(!t)return;const n=t.currentSlotIndex!==null?t.slots[t.currentSlotIndex]:null;n&&dr(n.species,n.targetScale,n.mutations||[]);}function V8(e){Fk();}function q8(){vl&&Bk(),Fk(),vl=_t().subscribePlantInfo(V8,{immediate:true});}function Bk(){vl&&(vl(),vl=null);}const Wg="css-qnqsp4",Vg="css-v439q6";let Pa=Tt(),qg=false,As=false,su=null,Kg=null,yi=null;const K8=`
  .gemini-qol-cropPrice {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    margin-top: 6px;
  }

  .gemini-qol-cropPrice-sprite {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    flex-shrink: 0;
  }

  .gemini-qol-cropPrice-text {
    font-size: 14px;
    color: #FFD84D;
    font-weight: 700;
  }

  @media (max-width: 768px) {
    .gemini-qol-cropPrice {
      gap: 4px;
      margin-top: 4px;
    }

    .gemini-qol-cropPrice-sprite {
      width: 16px;
      height: 16px;
    }

    .gemini-qol-cropPrice-text {
      font-size: 12px;
    }
  }
`;function X8(){if(qg)return;const e=document.createElement("style");e.id="gemini-qol-cropPrice-styles",e.textContent=K8,document.head.appendChild(e),Pa.add(()=>e.remove()),qg=true;}function Y8(e){const t=document.createElement("div");t.className="gemini-qol-cropPrice";const n=document.createElement("div");n.className="gemini-qol-cropPrice-sprite";const r=document.createElement("canvas");r.width=20,r.height=20,n.appendChild(r);const o=document.createElement("div");o.className="gemini-qol-cropPrice-text",o.textContent=e>0?e.toLocaleString():"",t.appendChild(n),t.appendChild(o);try{const i=me.toCanvas("ui","Coin");if(i&&r.parentElement){const a=r.getContext("2d");if(a){const s=Math.min(r.width/i.width,r.height/i.height),l=i.width*s,c=i.height*s,d=(r.width-l)/2,u=(r.height-c)/2;a.drawImage(i,d,u,l,c);}}}catch(i){console.warn("[CropValueIndicator.render] Failed to render coin sprite:",i);}return t}function J8(e){const t=[],n=e.querySelectorAll("span.chakra-text");for(const r of n){const o=r.textContent?.trim();if(!o)continue;["Gold","Rainbow","Wet","Chilled","Frozen","Dawnlit","Dawnbound","Amberlit","Amberbound"].includes(o)&&t.push(o);}return t}function Q8(e){const t=e.querySelectorAll("p.chakra-text");for(const n of t){const r=n.textContent?.trim();if(!r)continue;const o=r.match(/^([\d.]+)\s*kg$/i);if(o)return parseFloat(o[1])}return 1}function Z8(){const e=[],t=document.querySelectorAll(`.${Wg}`);for(const r of t)r.offsetParent&&(r.closest("button.chakra-button")||e.push({element:r}));const n=document.querySelectorAll(`.${Vg}`);for(const r of n){if(!r.offsetParent||r.closest("button.chakra-button"))continue;const o=r.querySelectorAll(":scope > .McFlex > .McFlex");if(o.length>0){const i=o[o.length-1];i.querySelector("p.chakra-text")&&e.push({element:i});}}return e}function eG(){const t=_t().get().plant;if(!t)return 0;const n=t.currentSlotIndex!==null?t.slots[t.currentSlotIndex]:null;return n?dr(n.species,n.targetScale,n.mutations||[]):0}function tG(e,t){const n=document.querySelectorAll(".gemini-qol-cropPrice");for(const r of n){if(!r.offsetParent||r.closest("button.chakra-button"))continue;const o=r.querySelector(".gemini-qol-cropPrice-text");o&&(o.textContent=e>0?e.toLocaleString():"");}}function nG(){yi!==null&&cancelAnimationFrame(yi),yi=requestAnimationFrame(()=>{yi=null;const e=eG();if(e===Kg)return;Kg=e;const n=_t().get().plant;!n||!(n.currentSlotIndex!==null&&n.slots[n.currentSlotIndex])||tG(e);});}function Ts(e){if(!e.element.querySelector(".gemini-qol-cropPrice"))try{const t=e.element.querySelector("p.chakra-text");if(!t)return;const n=t.closest(".McFlex");if(!n)return;const o=_t().get().plant;let i=0,a=null;if(o&&o.currentSlotIndex!==null){const l=o.slots[o.currentSlotIndex];l&&(a=l.species,i=dr(l.species,l.targetScale,l.mutations||[]));}if(i===0){const l=t.textContent?.trim();if(l){a=l;const c=Q8(n),d=J8(n);i=dr(l,c,d);}}const s=Y8(i);n.appendChild(s),Pa.add(()=>s.remove());}catch(t){console.warn("[CropValueIndicator.render] Failed to inject price:",t);}}function rG(){const e=Z8();for(const n of e)Ts(n);su=_t().subscribePlantInfo(()=>{nG();});const t=new MutationObserver(n=>{for(const r of n)r.type==="childList"&&r.addedNodes.forEach(o=>{if(o instanceof HTMLElement){if(o.classList.contains(Wg)&&(o.closest("button.chakra-button")||Ts({element:o})),o.querySelectorAll(`.${Wg}`).forEach(s=>{s.closest("button.chakra-button")||Ts({element:s});}),o.classList.contains(Vg)&&!o.closest("button.chakra-button")){const s=o.querySelectorAll(":scope > .McFlex > .McFlex");if(s.length>0){const l=s[s.length-1];l.querySelector("p.chakra-text")&&!l.querySelector(".gemini-qol-cropPrice")&&Ts({element:l});}}o.querySelectorAll(`.${Vg}`).forEach(s=>{if(!s.closest("button.chakra-button")){const l=s.querySelectorAll(":scope > .McFlex > .McFlex");if(l.length>0){const c=l[l.length-1];c.querySelector("p.chakra-text")&&!c.querySelector(".gemini-qol-cropPrice")&&Ts({element:c});}}});}});});t.observe(document.body,{childList:true,subtree:true}),Fo(Pa,t);}const oG={init(){As||(As=true,X8(),rG());},destroy(){As&&(As=false,yi!==null&&(cancelAnimationFrame(yi),yi=null),su&&(su(),su=null),Pa.run(),Pa.clear(),Pa=Tt(),qg=false,Kg=null);},isEnabled(){return As}},jk=lt.CROP_VALUE_INDICATOR,iG={enabled:false};function Jb(){return Xe(jk,iG)}function aG(e){Ye(jk,e);}let Xl=false;function Gk(){Xl||!Jb().enabled||(Xl=true,q8());}function zk(){Xl&&(Bk(),Xl=false);}function sG(){return Xl}function lG(){return Jb().enabled}function cG(e){const t=Jb();t.enabled!==e&&(t.enabled=e,aG(t),e?Gk():zk());}const lu={init:Gk,destroy:zk,isReady:sG,isEnabled:lG,setEnabled:cG,render:oG},Yl="css-qnqsp4",Qb="css-1cdcuw7",Zb='[role="tooltip"]';let cu=Tt(),Is=false,du=null,Xg=null,wi=null;function dG(){const e=[],t=document.querySelectorAll(`.${Yl}`);for(const n of t){if(!n.offsetParent||n.closest("button.chakra-button"))continue;const r=n.querySelector(`.${Qb}`);r&&e.push({element:n,weightElement:r});}return e}function uG(){const t=_t().get().plant;if(!t)return 0;const n=t.currentSlotIndex!==null?t.slots[t.currentSlotIndex]:null;return n?mb(n.species,n.targetScale):0}function pG(e,t){const n=document.querySelectorAll(`.${Yl}`);for(const r of n){if(!r.offsetParent||r.closest("button.chakra-button"))continue;const o=r.querySelector(`.${Qb}`);if(o){const i=o.querySelector("svg"),a=`${e}%`;o.textContent=a,i&&o.appendChild(i);}}Qu(),console.log("[CropSizeIndicator.render] 🔄 Updated all sizes:",{species:t.species,scale:t.targetScale,size:e,count:n.length});}function fG(){wi!==null&&cancelAnimationFrame(wi),wi=requestAnimationFrame(()=>{wi=null;const e=uG();if(e===Xg)return;Xg=e;const n=_t().get().plant;if(!n)return;const r=n.currentSlotIndex!==null?n.slots[n.currentSlotIndex]:null;r&&pG(e,r);});}function Uk(e,t){const n=ue.get("plants");if(!n)return "";const r=n[e];return r?.crop?.baseWeight?`${(r.crop.baseWeight*t).toFixed(2)} kg`:""}function Qu(){const e=document.querySelectorAll(Zb),n=_t().get().plant;if(!n||n.currentSlotIndex===null)return;const r=n.slots[n.currentSlotIndex];if(!r)return;const o=Uk(r.species,r.targetScale);for(const i of e){if(!i.offsetParent)continue;const a=i.textContent?.trim();a&&a.startsWith("Size:")&&o&&(i.textContent=o);}}function xh(){const e=dG();for(const t of e)if(t.weightElement)try{const r=_t().get().plant;if(r&&r.currentSlotIndex!==null){const o=r.slots[r.currentSlotIndex];if(o){const i=mb(o.species,o.targetScale),a=t.weightElement.querySelector("svg");t.weightElement.textContent=`${i}%`,a&&t.weightElement.appendChild(a);}}}catch(n){console.warn("[CropSizeIndicator.render] Failed to update size:",n);}Qu();}function hG(){const e=document.querySelectorAll(`.${Yl}`),n=_t().get().plant;if(!n||n.currentSlotIndex===null)return;const r=n.slots[n.currentSlotIndex];if(!r)return;const o=Uk(r.species,r.targetScale);for(const a of e){if(!a.offsetParent||a.closest("button.chakra-button"))continue;const s=a.querySelector(`.${Qb}`);if(s){const l=s.querySelector("svg");s.textContent=o,l&&s.appendChild(l);}}const i=document.querySelectorAll(Zb);for(const a of i){if(!a.offsetParent)continue;const s=a.textContent?.trim();s&&!s.includes("kg")&&(a.textContent=o);}console.log("[CropSizeIndicator.render] Restored crop weights");}function gG(){xh(),du=_t().subscribePlantInfo(()=>{fG();});const e=new MutationObserver(t=>{for(const n of t)n.type==="childList"&&n.addedNodes.forEach(r=>{if(r instanceof HTMLElement){if(r.hasAttribute("role")&&r.getAttribute("role")==="tooltip"){const a=r.textContent?.trim();a&&a.startsWith("Size:")&&Qu();}r.classList.contains(Yl)&&(r.closest("button.chakra-button")||xh()),r.querySelectorAll(`.${Yl}`).length>0&&xh(),r.querySelectorAll(Zb).forEach(a=>{const s=a.textContent?.trim();s&&s.startsWith("Size:")&&Qu();});}});});e.observe(document.body,{childList:true,subtree:true}),Fo(cu,e),console.log("[CropSizeIndicator.render] Started observing crops");}const ev={init(){if(Is){console.log("[CropSizeIndicator.render] Already initialized");return}Is=true,gG(),console.log("✅ [CropSizeIndicator.render] Initialized");},destroy(){Is&&(Is=false,hG(),wi!==null&&(cancelAnimationFrame(wi),wi=null),du&&(du(),du=null),cu.run(),cu.clear(),cu=Tt(),Xg=null,console.log("🛑 [CropSizeIndicator.render] Destroyed"));},isEnabled(){return Is}},Hk=lt.CROP_SIZE_INDICATOR,mG={enabled:false};function tv(){return Xe(Hk,mG)}function bG(e){Ye(Hk,e);}let Jl=false;function Wk(){if(Jl){console.log("[CropSizeIndicator] Already initialized");return}if(!tv().enabled){console.log("[CropSizeIndicator] Disabled");return}Jl=true,console.log("[CropSizeIndicator] Initializing..."),ev.init(),console.log("[CropSizeIndicator] Initialized successfully");}function Vk(){Jl&&(console.log("[CropSizeIndicator] Destroying..."),ev.destroy(),Jl=false,console.log("[CropSizeIndicator] Destroyed"));}function vG(){return Jl}function yG(){return tv().enabled}function wG(e){const t=tv();if(t.enabled===e){console.log(`[CropSizeIndicator] Already ${e?"enabled":"disabled"}`);return}t.enabled=e,bG(t),e?Wk():Vk(),console.log(`[CropSizeIndicator] ${e?"Enabled":"Disabled"}`);}const uu={init:Wk,destroy:Vk,isReady:vG,isEnabled:yG,setEnabled:wG,render:ev},Yg="css-qnqsp4",Jg="css-v439q6",Yp="gemini-qol-missingVariants";let Ra=Tt(),Qg=false,Ps=false,pu=null,xi=null;const xG=`
  .${Yp} {
    display: flex;
    gap: 6px;
    margin-top: 6px;
    flex-wrap: wrap;
    justify-content: center;
    align-items: center;
    width: 100%;
  }
`;function CG(){if(Qg)return;const e=document.createElement("style");e.id="gemini-qol-missingVariants-styles",e.textContent=xG,document.head.appendChild(e),Ra.add(()=>e.remove()),Qg=true;}function cw(){return Lt.getCropVariants()}function qk(e){const t=Lt.getMyJournal();if(!t)return cw();const r=t.produce?.[e]?.variantsLogged?.map(i=>i.variant)??[];return cw().filter(i=>!r.includes(i))}function SG(e){const t=ue.get("plants")??{};return e in t?true:lo(e)?.type==="crop"}function _G(){const t=_t().get().plant;if(!t)return null;let n=null;if(t.currentSlotIndex!==null){const o=t.slots[t.currentSlotIndex];o&&(n=o.species);}return n||(n=t.species),lo(n??"")?.id??n}function kG(e){const t=document.querySelectorAll(`.${Yp}`),n=qk(e);for(const r of t){if(n.length===0){r.remove();continue}const o=Array.from(r.children).map(i=>i.title);if(JSON.stringify(o)!==JSON.stringify(n)){r.replaceChildren();for(const i of n){const a=ik(i),s=document.createElement("span");s.textContent=a.text,s.title=i,s.style.cssText=a.css,r.appendChild(s);}}}}function EG(){xi!==null&&cancelAnimationFrame(xi),xi=requestAnimationFrame(()=>{xi=null;const e=_G();if(!e)return;const t=Kk();for(const n of t)ca(n);kG(e);});}function AG(e){if(!SG(e))return null;const t=qk(e);if(t.length===0)return null;const n=document.createElement("div");n.className=Yp;for(const r of t){const o=ik(r),i=document.createElement("span");i.textContent=o.text,i.title=r,i.style.cssText=o.css,n.appendChild(i);}return n}function Kk(){const e=[],t=document.querySelectorAll(`.${Yg}`);for(const r of t)r.offsetParent&&(r.closest("button.chakra-button")||e.push({element:r}));const n=document.querySelectorAll(`.${Jg}`);for(const r of n){if(!r.offsetParent||r.closest("button.chakra-button"))continue;const o=r.querySelectorAll(".McFlex");for(const i of o){const a=i.querySelector("p.chakra-text");if(a&&a.textContent&&!a.textContent.includes("%")){e.push({element:i});break}}}return e}function ca(e){if(!e.element.querySelector(`.${Yp}`))try{const t=e.element.querySelector("p.chakra-text");if(!t)return;const n=t.closest(".McFlex");if(!n)return;let r=null;const i=_t().get().plant;i&&(i.currentSlotIndex!==null&&i.slots[i.currentSlotIndex]?r=i.slots[i.currentSlotIndex].species:r=i.species);const a=t.textContent?.trim()??"",s=lo(a);if(s?.type==="crop"&&(r=s.id),!r)return;const l=AG(r);l&&(gn(()=>{n.appendChild(l);}),Ra.add(()=>l.remove()));}catch(t){console.warn("[MissingVariantsIndicator] Failed to inject:",t);}}function TG(){const e=Kk();for(const n of e)ca(n);pu=_t().subscribePlantInfo(()=>{EG();});const t=new MutationObserver(n=>{for(const r of n)r.type==="childList"&&r.addedNodes.forEach(o=>{if(o instanceof HTMLElement){if(o.classList.contains(Yg)&&(o.closest("button.chakra-button")||ca({element:o})),o.querySelectorAll(`.${Yg}`).forEach(s=>{s.closest("button.chakra-button")||ca({element:s});}),o.classList.contains(Jg)&&!o.closest("button.chakra-button")){const s=o.querySelectorAll(":scope > .McFlex > .McFlex");if(s.length>0){const l=s[s.length-1];l.querySelector("p.chakra-text")&&ca({element:l});}}o.querySelectorAll(`.${Jg}`).forEach(s=>{if(!s.closest("button.chakra-button")){const l=s.querySelectorAll(":scope > .McFlex > .McFlex");if(l.length>0){const c=l[l.length-1];c.querySelector("p.chakra-text")&&ca({element:c});}}});}});});t.observe(document.body,{childList:true,subtree:true}),Fo(Ra,t);}async function IG(){for(let n=1;n<=5;n++){if(!Lt.isReady())try{Lt.init();}catch(o){console.warn("[MissingVariantsIndicator] Failed to init journal checker:",o);}if(Lt.getMyJournal())return console.log("[MissingVariantsIndicator] Journal data available"),true;n<5&&await new Promise(o=>setTimeout(o,1e3));}return console.warn("[MissingVariantsIndicator] Journal data not available, continuing anyway"),false}const nv={init(){Ps||(Ps=true,CG(),TG(),IG().catch(e=>{console.warn("[MissingVariantsIndicator] Error waiting for journal data:",e);}));},destroy(){Ps&&(Ps=false,pu&&(pu(),pu=null),xi!==null&&(cancelAnimationFrame(xi),xi=null),Ra.run(),Ra.clear(),Ra=Tt(),Qg=false);},isEnabled(){return Ps}},Xk=lt.MISSING_VARIANTS_INDICATOR,PG={enabled:false};function rv(){return Xe(Xk,PG)}function RG(e){Ye(Xk,e);}let Ql=false;function Yk(){Ql||!rv().enabled||(Ql=true,nv.init(),console.log("✅ [MissingVariantsIndicator] Initialized"));}function Jk(){Ql&&(nv.destroy(),Ql=false,console.log("🛑 [MissingVariantsIndicator] Destroyed"));}function MG(){return Ql}function LG(){return rv().enabled}function OG(e){const t=rv();t.enabled!==e&&(t.enabled=e,RG(t),e?Yk():Jk());}const Ch={init:Yk,destroy:Jk,isReady:MG,isEnabled:LG,setEnabled:OG,render:nv},Qk=lt.SHOP_NOTIFIER,Zk={seed:[],tool:[],egg:[],decor:[]},NG={enabled:false,trackedItems:Zk},$G=["seed","tool","egg","decor"];function eE(e){return {seed:Array.isArray(e?.seed)?[...e.seed]:[],tool:Array.isArray(e?.tool)?[...e.tool]:[],egg:Array.isArray(e?.egg)?[...e.egg]:[],decor:Array.isArray(e?.decor)?[...e.decor]:[]}}function wc(e){return {seed:[...e.seed],tool:[...e.tool],egg:[...e.egg],decor:[...e.decor]}}function is(){const e=Xe(Qk,NG);return {enabled:e?.enabled??false,trackedItems:eE(e?.trackedItems)}}function Jp(e){Ye(Qk,{enabled:e.enabled,trackedItems:wc(e.trackedItems)});}function DG(e){const n={...is(),...e};return e.trackedItems&&(n.trackedItems=eE(e.trackedItems)),Jp(n),n}function ov(){return is().enabled}function FG(e){DG({enabled:e});}function tE(){return wc(is().trackedItems)}function nE(){const e=tE(),t=[];for(const n of $G)for(const r of e[n])t.push({shopType:n,itemId:r});return t}function BG(e,t){const n=is(),r=wc(n.trackedItems),o=r[e];if(o.includes(t))return;o.push(t),Jp({...n,trackedItems:r});const i=new CustomEvent("gemini:tracked-items-changed",{detail:{shopType:e,itemId:t,action:"add"}});window.dispatchEvent(i);}function rE(e,t){const n=is(),r=wc(n.trackedItems),o=r[e],i=o.filter(s=>s!==t);if(i.length===o.length)return;r[e]=i,Jp({...n,trackedItems:r});const a=new CustomEvent("gemini:tracked-items-changed",{detail:{shopType:e,itemId:t,action:"remove"}});window.dispatchEvent(a);}function jG(){const e=is();Jp({...e,trackedItems:wc(Zk)});}let Zu=false;const Zg=[];function GG(e,t){const n=tE()[e];if(!n.length)return [];const r=new Set(n);return t.items.filter(o=>r.has(o.id)&&o.isAvailable).map(o=>({itemId:o.id,remaining:o.remaining}))}function xd(e,t){const n=GG(e,t.shop);if(!n.length)return;console.log("[ShopNotifier] Tracked items restocked",{shopType:e,items:n});const r=new CustomEvent(Me.SHOP_RESTOCK_TRACKED,{detail:{shopType:e,items:n}});window.dispatchEvent(r);}function zG(){if(Zu)return;Zu=true;const e=$o();Zg.push(e.subscribeSeedRestock(t=>xd("seed",t)),e.subscribeToolRestock(t=>xd("tool",t)),e.subscribeEggRestock(t=>xd("egg",t)),e.subscribeDecorRestock(t=>xd("decor",t)));}function UG(){if(Zu){Zu=false;for(const e of Zg)e();Zg.length=0;}}const oE={Shovel:{shopType:"tool",maxQuantity:1},WateringCan:{shopType:"tool",maxQuantity:99},PetHutch:{shopType:"decor",maxQuantity:1},DecorShed:{shopType:"decor",maxQuantity:1}};function HG(e,t,n){const r=n.find(i=>typeof i=="object"&&i!==null&&"toolId"in i&&i.toolId===e);return r?(r.quantity??0)>=t:false}function WG(e,t,n){const r=n.find(c=>typeof c=="object"&&c!==null&&"decorId"in c&&c.decorId===e),o=r?r.quantity??0:0,s=gr().get().decors.all.filter(c=>typeof c=="object"&&c!==null&&"decorId"in c&&c.decorId===e).length;return o+s>=t}function iE(e,t,n,r){return t==="tool"?HG(e,n,r):t==="decor"?WG(e,n,r):false}function dw(e,t){const n=oE[e];if(!n||n.shopType!==t)return  false;const o=En().get();return iE(e,t,n.maxQuantity,o.items)}function uw(){const t=En().get(),n=nE();for(const r of n){const o=oE[r.itemId];o&&o.shopType===r.shopType&&iE(r.itemId,r.shopType,o.maxQuantity,t.items)&&(console.log(`[ShopNotifier] Auto-disabling tracking for ${r.itemId} (max quantity reached)`),rE(r.shopType,r.itemId));}}let ep=false,fu=null;function VG(){if(ep)return;ep=true,fu=En().subscribeStable(()=>{uw();}),uw();}function qG(){ep&&(ep=false,fu&&(fu(),fu=null));}let Zl=false;function aE(){if(Zl){console.log("[ShopNotifier] Already initialized");return}if(!ov()){console.log("[ShopNotifier] Disabled");return}Zl=true,zG(),VG(),console.log("[ShopNotifier] Initialized");}function sE(){Zl&&(UG(),qG(),Zl=false,console.log("[ShopNotifier] Destroyed"));}function KG(){return Zl}function XG(){return ov()}function YG(e){if(ov()===e){console.log(`[ShopNotifier] Already ${e?"enabled":"disabled"}`);return}FG(e),e?aE():sE(),console.log(`[ShopNotifier] ${e?"Enabled":"Disabled"}`);}const Or={init:aE,destroy:sE,isReady:KG,isEnabled:XG,setEnabled:YG,addTrackedItem:BG,removeTrackedItem:rE,getTrackedItems:nE,resetTrackedItems:jG},lE=lt.WEATHER_NOTIFIER,JG={enabled:false,trackedWeathers:[]};function cE(e){return Array.isArray(e)?[...e]:[]}function Qp(e){return [...e]}function xc(){const e=Xe(lE,JG);return {enabled:e?.enabled??false,trackedWeathers:cE(e?.trackedWeathers)}}function iv(e){Ye(lE,{enabled:e.enabled,trackedWeathers:Qp(e.trackedWeathers)});}function QG(e){const n={...xc(),...e};return e.trackedWeathers&&(n.trackedWeathers=cE(e.trackedWeathers)),iv(n),n}function dE(){return xc().enabled}function ZG(e){QG({enabled:e});}function Zp(){return Qp(xc().trackedWeathers)}function ez(e){return Zp().includes(e)}function tz(e){const t=xc(),n=Qp(t.trackedWeathers);if(n.includes(e))return;n.push(e);const r=!t.enabled&&n.length>0,o={trackedWeathers:n,enabled:r?true:t.enabled};iv(o);const i=new CustomEvent("gemini:tracked-weathers-changed",{detail:{weatherId:e,action:"add",shouldReinit:r}});window.dispatchEvent(i);const a=new CustomEvent("gemini:weather-tracked-check",{detail:{weatherId:e}});window.dispatchEvent(a);}function nz(e){const t=xc(),n=Qp(t.trackedWeathers),r=n.filter(s=>s!==e);if(r.length===n.length)return;const o=t.enabled&&r.length===0,i={trackedWeathers:r,enabled:o?false:t.enabled};iv(i);const a=new CustomEvent("gemini:tracked-weathers-changed",{detail:{weatherId:e,action:"remove",shouldReinit:o}});window.dispatchEvent(a);}let yl=null,hu="Sunny",Xr=false,wl=null,tp="";function uE(e){return `${e.soundId}:${e.volume}:${e.mode}`}function np(e){const t=Ue.getItemCustomSound("weather",e);return t?{soundId:t.soundId,volume:t.volume,mode:t.mode}:Dt.CustomSounds.getNotificationConfig("weather")}function rz(e){if(Xr)return;const t=Dt.CustomSounds.getById(e.soundId);if(t){wl=t.source,Xr=true,tp=uE(e);try{Dt.CustomSounds.play(e.soundId,{volume:e.volume/100,loop:!0});}catch{Xr=false,wl=null,tp="";}}}function gu(){if(Xr){try{const e=Dt.getCustomHandle();(!wl||e&&e.url===wl)&&Dt.CustomSounds.stop();}catch{}Xr=false,wl=null,tp="";}}function ec(e,t){const n=t??np(e);if(n.mode!=="loop"){Xr&&gu();return}if(!Zp().includes(e)){Xr&&gu();return}const i=uE(n);Xr&&i!==tp&&gu(),Xr||rz(n);}function pE(e){const{weatherId:t}=e.detail||{};if(!t)return;const o=Do().get().id,i=np(t);if(o===t){console.log("[WeatherNotifier] Manually tracked weather is currently active:",t),i.mode==="one-shot"&&gE(i),ec(o,i);const a=new CustomEvent("gemini:weather-appeared",{detail:{weatherId:t}});window.dispatchEvent(a);}}function fE(){const t=Do().get().id;ec(t);}function hE(e){if(e.detail?.entityType!=="weather")return;const r=Do().get().id;ec(r);}function oz(){if(yl){console.log("[WeatherNotifier] Already tracking");return}const e=Do(),t=e.get();hu=t.id,console.log("[WeatherNotifier] Starting tracking, initial weather:",hu),window.addEventListener("gemini:weather-tracked-check",pE),window.addEventListener("gemini:tracked-weathers-changed",fE),window.addEventListener(Me.CUSTOM_SOUND_CHANGE,hE);const n=np(t.id);ec(t.id,n),yl=e.subscribeStable(r=>{const o=r.current.id,i=r.previous.id,a=np(o);if(console.log("[WeatherNotifier] Weather changed:",{previous:i,current:o}),ec(o,a),o!==i&&Zp().includes(o)){console.log("[WeatherNotifier] Tracked weather detected:",o),a.mode==="one-shot"&&gE(a);const l=new CustomEvent("gemini:weather-appeared",{detail:{weatherId:o}});window.dispatchEvent(l);}hu=o;}),console.log("[WeatherNotifier] Tracking initialized");}function iz(){window.removeEventListener("gemini:weather-tracked-check",pE),window.removeEventListener("gemini:tracked-weathers-changed",fE),window.removeEventListener(Me.CUSTOM_SOUND_CHANGE,hE),yl&&(yl(),yl=null,hu="Sunny",gu(),console.log("[WeatherNotifier] Tracking stopped"));}function gE(e){try{Dt.CustomSounds.play(e.soundId,{volume:e.volume/100});}catch(t){console.warn("[WeatherNotifier] Failed to play notification sound:",t);}}let tc=false;function mE(e){const{shouldReinit:t}=e.detail||{};t&&(console.log("[WeatherNotifier] Config changed, reinitializing..."),vE(),bE());}function bE(){if(tc){console.log("[WeatherNotifier] Already initialized");return}if(tc=true,window.addEventListener("gemini:tracked-weathers-changed",mE),!dE()){console.log("[WeatherNotifier] Disabled (waiting for tracked weathers)");return}console.log("[WeatherNotifier] Initializing"),oz(),console.log("[WeatherNotifier] Initialized");}function vE(){tc&&(console.log("[WeatherNotifier] Destroying"),window.removeEventListener("gemini:tracked-weathers-changed",mE),iz(),tc=false,console.log("[WeatherNotifier] Destroyed"));}function az(){return tc}const qa={init:bE,destroy:vE,isReady:az,isEnabled:dE,setEnabled:ZG,getTrackedWeathers:Zp,addTrackedWeather:tz,removeTrackedWeather:nz,isWeatherTracked:ez},sz={enabled:false,threshold:5};function ef(){return Xe(lt.PET_HUNGER_NOTIFIER,sz)}function yE(e){Ye(lt.PET_HUNGER_NOTIFIER,e);}function wE(){return ef().enabled}function lz(e){const t=ef();t.enabled=e,yE(t);const n=new CustomEvent("gemini:pet-hunger-config-changed",{detail:{shouldReinit:true}});window.dispatchEvent(n);}function xE(){return ef().threshold}function cz(e){const t=ef();t.threshold=e,yE(t);}let xl=null;const mu=new Set;let No=false,Cl=null;function dz(e){if(No)return;const t=Dt.CustomSounds.getById(e.soundId);if(t){Cl=t.source,No=true;try{Dt.CustomSounds.play(e.soundId,{volume:e.volume/100,loop:!0});}catch{No=false,Cl=null;}}}function em(){if(No){try{const e=Dt.getCustomHandle();(!Cl||e&&e.url===Cl)&&Dt.CustomSounds.stop();}catch{}No=false,Cl=null;}}function uz(e,t){if(t.mode!=="loop"){No&&em();return}e?No||dz(t):No&&em();}function pz(){if(xl){console.log("[PetHungerNotifier] Already tracking");return}const e=po(),t=xE();console.log("[PetHungerNotifier] Starting tracking, threshold:",t+"%"),xl=e.subscribe(n=>{const r=n.byLocation.active,o=Dt.CustomSounds.getNotificationConfig("pet"),i=o.mode==="loop";let a=false;for(const s of r)if(s.hungerPercent<t){if(a=true,!mu.has(s.id)){console.log("[PetHungerNotifier] Pet hunger low:",{name:s.name||s.petSpecies,species:s.petSpecies,hungerPercent:s.hungerPercent.toFixed(2)+"%"}),i||hz(o);const l=new CustomEvent("gemini:pet-hunger-low",{detail:{pet:s}});window.dispatchEvent(l),mu.add(s.id);}}else mu.delete(s.id);uz(a,o);}),console.log("[PetHungerNotifier] Tracking initialized");}function fz(){xl&&(xl(),xl=null,mu.clear(),em(),console.log("[PetHungerNotifier] Tracking stopped"));}function hz(e){try{Dt.CustomSounds.play(e.soundId,{volume:e.volume/100});}catch(t){console.warn("[PetHungerNotifier] Failed to play notification sound:",t);}}let nc=false;function CE(e){const{shouldReinit:t}=e.detail||{};t&&(console.log("[PetHungerNotifier] Config changed, reinitializing..."),_E(),SE());}function SE(){if(nc){console.log("[PetHungerNotifier] Already initialized");return}if(nc=true,window.addEventListener("gemini:pet-hunger-config-changed",CE),!wE()){console.log("[PetHungerNotifier] Disabled");return}console.log("[PetHungerNotifier] Initializing"),pz(),console.log("[PetHungerNotifier] Initialized");}function _E(){nc&&(console.log("[PetHungerNotifier] Destroying"),window.removeEventListener("gemini:pet-hunger-config-changed",CE),fz(),nc=false,console.log("[PetHungerNotifier] Destroyed"));}function gz(){return nc}const rc={init:SE,destroy:_E,isReady:gz,isEnabled:wE,setEnabled:lz,getThreshold:xE,setThreshold:cz};let rp=null,op=null;function pw(e){rp=e;}function fw(e){op=e;}function mz(){return rp?[...rp]:[]}function bz(){return op?[...op]:[]}function hw(){rp=null,op=null;}async function av(e=50){const{data:t}=await Ei("rooms",{limit:e});return !t||!Array.isArray(t)?[]:t.map(n=>({id:n.id,isPrivate:n.is_private,playersCount:n.players_count??0,lastUpdatedAt:n.last_updated_at,lastUpdatedByPlayerId:n.last_updated_by_player_id,userSlots:Array.isArray(n.user_slots)?n.user_slots.map(r=>({name:r.name,avatarUrl:r.avatar_url??null})):void 0}))}async function vz(e,t){const n=e.trim(),r=t?.minQueryLength??2;if(n.length<r)return [];const o=t?.limitRooms??200,i=n.toLowerCase(),a=await av(o),s=[];for(const l of a){if(!l.userSlots||l.userSlots.length===0)continue;const c=l.userSlots.filter(d=>d.name?d.name.toLowerCase().includes(i):false);c.length>0&&s.push({room:l,matchedSlots:c});}return s}async function yz(e){if(!e)return null;const{status:t,data:n}=await Ei("get-player-view",{playerId:e});return t===404?null:n}async function tf(e,t){const n=Array.from(new Set((e??[]).map(a=>String(a).trim()).filter(a=>a.length>=3)));if(n.length===0)return [];const r={playerIds:n};t?.sections&&(r.sections=Array.isArray(t.sections)?t.sections:[t.sections]);const{status:o,data:i}=await Lp("get-players-view",r);return o!==200||!Array.isArray(i)?[]:i}async function wz(e,t){const n=e.trim(),r=t?.minQueryLength??2;if(n.length<r)return [];const o=t?.limitRooms??200,i=n.toLowerCase(),a=await av(o),s=new Map;for(const l of a)if(!(!l.userSlots||l.userSlots.length===0))for(const c of l.userSlots){if(!c.name||!c.name.toLowerCase().includes(i))continue;const u=`${l.id}::${c.name}`;s.has(u)||s.set(u,{playerName:c.name,avatarUrl:c.avatarUrl,roomId:l.id,roomPlayersCount:l.playersCount});}return Array.from(s.values())}async function kE(e){if(!e)return [];const{status:t,data:n}=await Ei("list-friends",{playerId:e});return t!==200||!n||!Array.isArray(n.friends)?[]:n.friends}async function xz(e){const t=await kE(e);if(t.length===0)return pw([]),[];const n=await tf(t,{sections:["profile","room"]});return pw(n),[...n]}async function sv(e){if(!e)return {playerId:"",incoming:[],outgoing:[]};const{status:t,data:n}=await Ei("list-friend-requests",{playerId:e});return t!==200||!n?{playerId:e,incoming:[],outgoing:[]}:{playerId:n.playerId,incoming:Array.isArray(n.incoming)?n.incoming:[],outgoing:Array.isArray(n.outgoing)?n.outgoing:[]}}async function Cz(e){const{incoming:t}=await sv(e),n=t.map(o=>o.fromPlayerId);if(n.length===0)return fw([]),[];const r=await tf(n,{sections:["profile"]});return fw(r),[...r]}async function Sz(e){const{outgoing:t}=await sv(e),n=t.map(r=>r.toPlayerId);return n.length===0?[]:tf(n,{sections:["profile"]})}async function _z(e,t){if(!e||!t||e===t)return  false;const{status:n}=await Lp("friend-request",{fromPlayerId:e,toPlayerId:t});return n===204?true:(n===409&&console.warn("[AriesAPI] friend-request conflict (already exists)"),false)}async function kz(e){const{playerId:t,otherPlayerId:n,action:r}=e;if(!t||!n||t===n)return  false;const{status:o}=await Lp("friend-respond",{playerId:t,otherPlayerId:n,action:r});return o===204}async function Ez(e,t){if(!e||!t||e===t)return  false;const{status:n}=await Lp("friend-remove",{playerId:e,otherPlayerId:t});return n===204}let Rs=false;const ip={init(){Rs||(Rs=true,console.log("[AriesAPI] Initialized"));},destroy(){Rs&&(Rs=false,hw(),console.log("[AriesAPI] Destroyed"));},isReady(){return Rs},getConfig(){return kb()},updateConfig(e){return d$(e)},fetchRooms:av,searchRoomsByPlayerName:vz,fetchPlayerView:yz,fetchPlayersView:tf,searchPlayersByName:wz,fetchFriendsIds:kE,fetchFriendsWithViews:xz,fetchFriendRequests:sv,fetchIncomingRequestsWithViews:Cz,fetchOutgoingRequestsWithViews:Sz,sendFriendRequest:_z,respondFriendRequest:kz,removeFriend:Ez,getCachedFriends:mz,getCachedIncomingRequests:bz,clearCache:hw},gw={enabled:true,manualLocks:[],overallRules:[],speciesRules:{}};function ap(){return `rule-${Date.now()}-${Math.random().toString(36).slice(2,9)}`}function Az(e){const t={enabled:e.enabled,manualLocks:e.manualLocks||[],overallRules:[],speciesRules:{}},n=e.globalCriteria?.lockByScale?.enabled,r=(e.globalCriteria?.lockedMutations?.length??0)>0;if(n||r){const o={id:ap(),name:"Migrated Global Rule",enabled:true,mode:"lock",sizeCondition:n?{enabled:true,minPercentage:e.globalCriteria.lockByScale.minPercentage}:void 0,mutationCondition:r?{enabled:true,mutations:e.globalCriteria.lockedMutations,matchMode:"any"}:void 0};t.overallRules.push(o);}if(e.speciesOverrides)for(const[o,i]of Object.entries(e.speciesOverrides)){const a=i.lockByScale?.enabled,s=(i.lockedMutations?.length??0)>0;if(a||s){const l={id:ap(),name:`Migrated ${o} Rule`,enabled:true,mode:"lock",sizeCondition:a?{enabled:true,minPercentage:i.lockByScale.minPercentage}:void 0,mutationCondition:s?{enabled:true,mutations:i.lockedMutations,matchMode:"any"}:void 0};t.speciesRules[o]=[l];}}return console.log("[HarvestLocker] Migrated legacy config to new format"),t}function Tz(e){const t=e;return t!==null&&typeof t=="object"&&"globalCriteria"in t&&!("overallRules"in t)}function It(){const e=Xe(hn.FEATURE.HARVEST_LOCKER,gw);if(Tz(e)){const t=Az(e);return Jn(t),t}return {...gw,...e,manualLocks:e.manualLocks||[],overallRules:e.overallRules||[],speciesRules:e.speciesRules||{}}}function Jn(e){Ye(hn.FEATURE.HARVEST_LOCKER,e);}function EE(e,t,n,r){return {id:ap(),name:e,enabled:true,mode:t,sizeCondition:n,mutationCondition:r}}function Iz(e){const t=It();t.overallRules.push(e),Jn(t);}function Pz(e,t){const n=It();n.speciesRules[e]||(n.speciesRules[e]=[]),n.speciesRules[e].push(t),Jn(n);}function AE(e,t){const n=It(),r=n.overallRules.findIndex(o=>o.id===e);if(r!==-1){n.overallRules[r]={...n.overallRules[r],...t},Jn(n);return}for(const o of Object.keys(n.speciesRules)){const i=n.speciesRules[o].findIndex(a=>a.id===e);if(i!==-1){n.speciesRules[o][i]={...n.speciesRules[o][i],...t},Jn(n);return}}console.warn(`[HarvestLocker] Rule ${e} not found`);}function Rz(e){const t=It(),n=t.overallRules.findIndex(r=>r.id===e);if(n!==-1){t.overallRules.splice(n,1),Jn(t);return}for(const r of Object.keys(t.speciesRules)){const o=t.speciesRules[r].findIndex(i=>i.id===e);if(o!==-1){t.speciesRules[r].splice(o,1),t.speciesRules[r].length===0&&delete t.speciesRules[r],Jn(t);return}}console.warn(`[HarvestLocker] Rule ${e} not found`);}function Mz(e,t){const n=It(),r=n.overallRules.find(i=>i.id===e);if(!r){console.warn(`[HarvestLocker] Rule ${e} not found`);return}const o={...r,id:ap(),name:`${r.name} (${t})`};n.speciesRules[t]||(n.speciesRules[t]=[]),n.speciesRules[t].push(o),Jn(n);}const Ii=new Set;let Yr=null;const sp=[];function Lz(e){if(sp.length>0){console.warn("[HarvestLocker] Already started");return}Yr=e;const t=gr().subscribeStable(n=>{if(!n){Ii.clear();return}TE(n);});sp.push(t);}function Oz(){sp.forEach(e=>e()),sp.length=0,Ii.clear(),Yr=null,console.log("[HarvestLocker] Stopped");}function Go(e){Yr=e;const t=gr().get();t&&TE(t);}function lv(e,t){const n=`${e}-${t}`;return Ii.has(n)}function Nz(){return Array.from(Ii)}function TE(e){if(Yr){if(Ii.clear(),Yr.manualLocks.forEach(t=>Ii.add(t)),!jz(e)){console.warn("[HarvestLocker] Invalid garden structure"),window.dispatchEvent(new CustomEvent(Me.HARVEST_LOCKER_LOCKS_UPDATED));return}e.plants.all.forEach(t=>{t.slots.forEach((n,r)=>{const o=`${t.tileIndex}-${r}`,i=$z(n.species);Dz(n,i)&&Ii.add(o);});}),window.dispatchEvent(new CustomEvent(Me.HARVEST_LOCKER_LOCKS_UPDATED));}}function $z(e){return Yr?Yr.speciesRules[e]?Yr.speciesRules[e].filter(t=>t.enabled):Yr.overallRules.filter(t=>t.enabled):[]}function Dz(e,t){const n=t.filter(o=>o.mode==="lock"),r=t.filter(o=>o.mode==="allow");for(const o of n)if(mw(e,o))return  true;return r.length>0&&!r.some(i=>mw(e,i))}function mw(e,t){const n=[];if(t.sizeCondition?.enabled){const r=Bz(e),o=t.sizeCondition.sizeMode??"max";n.push(o==="max"?r>=t.sizeCondition.minPercentage:r<=t.sizeCondition.minPercentage);}if(t.mutationCondition?.enabled&&t.mutationCondition.mutations.length>0){const r=Fz(e.mutations,t.mutationCondition.mutations,t.mutationCondition.matchMode);n.push(r);}return n.length>0&&n.every(r=>r)}function Fz(e,t,n){const r=t.includes("none"),o=t.filter(a=>a!=="none"),i=r&&e.length===0;return n==="any"?i?true:o.some(a=>e.includes(a)):r&&e.length>0?false:o.length===0?i:o.every(a=>e.includes(a))}function Bz(e){const n=ue.get("plants")?.[e.species];if(!n||typeof n!="object"||!("crop"in n))return 0;const r=n.crop;if(typeof r!="object"||!r)return 0;const{baseTileScale:o,maxScale:i}=r,a=i-o;return a===0?100:(e.targetScale-o)/a*100}function jz(e){return typeof e=="object"&&e!==null&&"plants"in e&&typeof e.plants=="object"&&e.plants!==null&&"all"in e.plants&&Array.isArray(e.plants.all)}function nf(e,t){const n=new MutationObserver(o=>{for(const i of o)for(const a of i.addedNodes){if(!(a instanceof Element))continue;a.matches(e)&&t(a);const s=a.querySelectorAll(e);for(const l of s)t(l);}});n.observe(document.body,{childList:true,subtree:true});const r=document.querySelectorAll(e);for(const o of r)t(o);return {disconnect:()=>n.disconnect()}}function rf(e,t){const n=new MutationObserver(r=>{for(const o of r)for(const i of o.removedNodes){if(!(i instanceof Element))continue;i.matches(e)&&t(i);const a=i.querySelectorAll(e);for(const s of a)t(s);}});return n.observe(document.body,{childList:true,subtree:true}),{disconnect:()=>n.disconnect()}}const Gz=`
/* Locked crop card: purple border + subtle glow (respects border-radius, no layout shift) */
.gemini-qol-harvestLocker-locked {
  position: relative !important;
  box-shadow: 0 0 0 2px #8B3E98, 0 0 8px rgba(139, 62, 152, 0.35) !important;
  transition: box-shadow 0.25s ease !important;
}

/* Lock icon badge: top-right corner */
#gemini-qol-harvestLocker-lock-icon {
  position: absolute;
  top: 4px;
  right: 4px;
  width: 22px;
  height: 22px;
  background: linear-gradient(135deg, #652E91, #8B3E98);
  border: 1px solid rgba(174, 83, 176, 0.6);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: none;
  z-index: 10;
  box-shadow: 0 2px 8px rgba(139, 62, 152, 0.45);
  animation: gemini-harvestLocker-glow 2.5s ease-in-out infinite;
}

/* Pulse subtile sur le badge */
@keyframes gemini-harvestLocker-glow {
  0%, 100% { box-shadow: 0 2px 8px rgba(139, 62, 152, 0.45); }
  50%      { box-shadow: 0 2px 14px rgba(139, 62, 152, 0.75); }
}

/* Icone lock avec ombre pour la profondeur */
#gemini-qol-harvestLocker-lock-icon svg {
  width: 12px;
  height: 12px;
  color: #F5F5F5;
  filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.4));
}
`,bw="css-qnqsp4",IE="gemini-qol-harvestLocker-locked",tm="gemini-qol-harvestLocker-lock-icon",nm="gemini-qol-harvestLocker-styles",zz='<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" focusable="false"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>';let Rr=null,bu=false;const rm=[];function Cd(e){rm.push(e);}function Uz(){for(const e of rm)try{e();}catch(t){console.warn("[HarvestLocker Inject] Cleanup error:",t);}rm.length=0;}function Hz(){if(bu)return;if(document.getElementById(nm)){bu=true;return}const e=document.createElement("style");e.id=nm,e.textContent=Gz,document.head.appendChild(e),bu=true;}function Wz(){document.getElementById(nm)?.remove(),bu=false;}function Vz(e){if(e.classList.add(IE),!e.querySelector(`#${tm}`)){const t=document.createElement("div");t.id=tm,t.innerHTML=zz,e.appendChild(t);}}function lp(e){e.classList.remove(IE),e.querySelector(`#${tm}`)?.remove();}function Sh(){if(!Rr)return;const e=_t().get();if(!e.plant||e.position.localIndex===null||e.plant.nextHarvestSlotIndex===null){lp(Rr),console.log("[HarvestLocker Inject] No plant data — overlay removed");return}const t=String(e.position.localIndex),n=e.plant.nextHarvestSlotIndex;lv(t,n)?(Vz(Rr),console.log(`[HarvestLocker Inject] LOCKED — overlay applied (${e.plant.species} tile:${t} slot:${n})`)):(lp(Rr),console.log(`[HarvestLocker Inject] unlocked — overlay removed (${e.plant.species} tile:${t} slot:${n})`));}function qz(){Hz();const e=nf(`.${bw}`,o=>{Rr=o,Sh();});Cd(()=>e.disconnect());const t=rf(`.${bw}`,o=>{Rr===o&&(lp(o),Rr=null);});Cd(()=>t.disconnect());const n=_t().subscribePlantInfo(()=>{Sh();});Cd(n);const r=()=>Sh();window.addEventListener(Me.HARVEST_LOCKER_LOCKS_UPDATED,r),Cd(()=>window.removeEventListener(Me.HARVEST_LOCKER_LOCKS_UPDATED,r)),console.log("[HarvestLocker Inject] Started");}function Kz(){Rr&&(lp(Rr),Rr=null),Uz(),Wz(),console.log("[HarvestLocker Inject] Stopped");}let Sd=false;const PE={init(){Sd||(qz(),Sd=true);},destroy(){Sd&&(Kz(),Sd=false);},isEnabled(){return It().enabled}},RE=[];function Xz(){return RE.slice()}function Yz(e){RE.push(e);}function ME(e){try{return JSON.parse(e)}catch{return}}function vw(e){if(typeof e=="string"){const t=ME(e);return t!==void 0?t:e}return e}function LE(e){if(e!=null){if(typeof e=="string"){const t=ME(e);return t!==void 0?LE(t):e}if(Array.isArray(e)&&typeof e[0]=="string")return e[0];if(typeof e=="object"){const t=e;return t.type??t.Type??t.kind??t.messageType}}}function Jz(e){const t=e?.MagicCircle_RoomConnection?.currentWebSocket;return t&&typeof t=="object"?t:null}function Fe(e,t,n){const r=typeof t=="boolean"?t:true,o=typeof t=="function"?t:n,i=(a,s)=>{if(LE(a)!==e)return;const c=o(a,s);return c&&typeof c=="object"&&"kind"in c?c:typeof c=="boolean"?c?void 0:{kind:"drop"}:r?void 0:{kind:"drop"}};return Yz(i),i}const Ms=new WeakSet,yw=new WeakMap;function Qz(e){const t=e.pageWindow,n=!!e.debug,r=e.middlewares&&e.middlewares.length?e.middlewares:Xz();if(!r.length)return ()=>{};const o=f=>({ws:f,pageWindow:t,debug:n}),i=(f,g)=>{let h=f;for(const y of r){const S=y(h,o(g));if(S){if(S.kind==="drop")return {kind:"drop"};S.kind==="replace"&&(h=S.message);}}return h!==f?{kind:"replace",message:h}:void 0};let a=null,s=null,l=null;const c=()=>{const f=t?.MagicCircle_RoomConnection,g=f?.sendMessage;if(!f||typeof g!="function")return  false;if(Ms.has(g))return  true;const h=g.bind(f);function y(...S){const C=S.length===1?S[0]:S,_=vw(C),E=i(_,Jz(t));if(E?.kind==="drop"){n&&console.log("[WS] drop outgoing (RoomConnection.sendMessage)",_);return}if(E?.kind==="replace"){const P=E.message;return S.length>1&&Array.isArray(P)?(n&&console.log("[WS] replace outgoing (RoomConnection.sendMessage)",_,"=>",P),h(...P)):(n&&console.log("[WS] replace outgoing (RoomConnection.sendMessage)",_,"=>",P),h(P))}return h(...S)}Ms.add(y),yw.set(y,g);try{f.sendMessage=y,Ms.add(f.sendMessage),n&&console.log("[WS] outgoing patched via MagicCircle_RoomConnection.sendMessage");}catch{return  false}return a=()=>{try{f.sendMessage===y&&(f.sendMessage=g);}catch{}},true};(()=>{const f=t?.WebSocket?.prototype,g=f?.send;if(typeof g!="function"||Ms.has(g))return;function h(y){const S=vw(y),C=i(S,this);if(C?.kind==="drop"){n&&console.log("[WS] drop outgoing (ws.send)",S);return}if(C?.kind==="replace"){const _=C.message,E=typeof _=="string"||_ instanceof ArrayBuffer||_ instanceof Blob?_:JSON.stringify(_);return n&&console.log("[WS] replace outgoing (ws.send)",S,"=>",_),g.call(this,E)}return g.call(this,y)}Ms.add(h),yw.set(h,g);try{f.send=h,n&&console.log("[WS] outgoing patched via WebSocket.prototype.send");}catch{return}s=()=>{try{f.send===h&&(f.send=g);}catch{}};})();const u=e.waitForRoomConnectionMs??4e3;if(!c()&&u>0){const f=Date.now();l=setInterval(()=>{if(c()){clearInterval(l),l=null;return}Date.now()-f>u&&(clearInterval(l),l=null,n&&console.log("[WS] RoomConnection not found, only ws.send is patched"));},250);}return ()=>{if(l){try{clearInterval(l);}catch{}l=null;}if(a){try{a();}catch{}a=null;}if(s){try{s();}catch{}s=null;}}}(function(){try{const t=({ url: (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('__entry.js', document.baseURI).href) }),n=t.glob?.("./**/*.ts",{eager:!0})??t.glob?.("./**/*.js",{eager:!0});if(!n)return}catch{}})();Fe(be.HarvestCrop,(e,t)=>{if(!It().enabled)return  true;const r=e,o=r.slot!==void 0?String(r.slot):void 0,i=r.slotsIndex;return o!==void 0&&typeof i=="number"&&lv(o,i)?(console.log(`[HarvestLocker] Blocked harvest for slot ${o}-${i}`),false):true});let Ka=false;function OE(){if(Ka){console.warn("[HarvestLocker] Already initialized");return}const e=It();if(!e.enabled){console.log("[HarvestLocker] Disabled");return}Ka=true,Lz(e),PE.init(),console.log("[HarvestLocker] Initialized");}function NE(){Ka&&(PE.destroy(),Oz(),Ka=false,console.log("[HarvestLocker] Destroyed"));}function Zz(){return It().enabled}function e6(e){const t=It();t.enabled=e,Jn(t),e&&!Ka?OE():!e&&Ka&&NE();}function t6(e,t){return lv(e,t)}function n6(){return Nz()}function r6(e,t){const n=It(),r=`${e}-${t}`;n.manualLocks.includes(r)||(n.manualLocks.push(r),Jn(n),Go(n));}function o6(e,t){const n=It(),r=`${e}-${t}`;n.manualLocks=n.manualLocks.filter(o=>o!==r),Jn(n),Go(n);}function i6(){const e=It();e.manualLocks=[],Jn(e),Go(e);}function a6(){return It()}function s6(){return It().overallRules}function l6(e){return It().speciesRules[e]||[]}function c6(){const e=It();return Object.keys(e.speciesRules)}function d6(e,t,n,r){const o=EE(e,t,n,r);return Iz(o),Go(It()),o}function u6(e,t,n,r,o){const i=EE(t,n,r,o);return Pz(e,i),Go(It()),i}function p6(e,t){AE(e,t),Go(It());}function f6(e){Rz(e),Go(It());}function h6(e,t){AE(e,{enabled:t}),Go(It());}const yn={init:OE,destroy:NE,isEnabled:Zz,setEnabled:e6,isLocked:t6,getAllLockedSlots:n6,lockSlot:r6,unlockSlot:o6,clearManualLocks:i6,getOverallRules:s6,getSpeciesRules:l6,getAllSpeciesWithRules:c6,addNewOverallRule:d6,addNewSpeciesRule:u6,modifyRule:p6,removeRule:f6,toggleRule:h6,cloneRuleToSpecies:Mz,getConfig:a6},ww={enabled:true,blockedEggs:[]};function ho(){const e=Xe(hn.FEATURE.EGG_LOCKER,ww);return {...ww,...e,blockedEggs:e.blockedEggs||[]}}function of(e){Ye(hn.FEATURE.EGG_LOCKER,e);}function g6(e){const t=ho();t.blockedEggs.includes(e)||(t.blockedEggs.push(e),of(t),window.dispatchEvent(new CustomEvent(Me.EGG_LOCKER_LOCKS_UPDATED)));}function m6(e){const t=ho();t.blockedEggs=t.blockedEggs.filter(n=>n!==e),of(t),window.dispatchEvent(new CustomEvent(Me.EGG_LOCKER_LOCKS_UPDATED));}const b6=`
/* Locked egg card: purple border + subtle glow (respects border-radius, no layout shift) */
.gemini-qol-eggLocker-locked {
  position: relative !important;
  box-shadow: 0 0 0 2px #8B3E98, 0 0 8px rgba(139, 62, 152, 0.35) !important;
  transition: box-shadow 0.25s ease !important;
}

/* Lock icon badge: top-right corner */
#gemini-qol-eggLocker-lock-icon {
  position: absolute;
  top: 4px;
  right: 4px;
  width: 22px;
  height: 22px;
  background: linear-gradient(135deg, #652E91, #8B3E98);
  border: 1px solid rgba(174, 83, 176, 0.6);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: none;
  z-index: 10;
  box-shadow: 0 2px 8px rgba(139, 62, 152, 0.45);
  animation: gemini-eggLocker-glow 2.5s ease-in-out infinite;
}

/* Pulse subtle sur le badge */
@keyframes gemini-eggLocker-glow {
  0%, 100% { box-shadow: 0 2px 8px rgba(139, 62, 152, 0.45); }
  50%      { box-shadow: 0 2px 14px rgba(139, 62, 152, 0.75); }
}

/* Icone lock avec ombre pour la profondeur */
#gemini-qol-eggLocker-lock-icon svg {
  width: 12px;
  height: 12px;
  color: #F5F5F5;
  filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.4));
}
`,xw="css-qnqsp4",$E="gemini-qol-eggLocker-locked",om="gemini-qol-eggLocker-lock-icon",im="gemini-qol-eggLocker-styles",v6='<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" focusable="false"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>';let Mr=null,vu=false;const am=[];function _d(e){am.push(e);}function y6(){for(const e of am)try{e();}catch(t){console.warn("[EggLocker Inject] Cleanup error:",t);}am.length=0;}function w6(){if(vu)return;if(document.getElementById(im)){vu=true;return}const e=document.createElement("style");e.id=im,e.textContent=b6,document.head.appendChild(e),vu=true;}function x6(){document.getElementById(im)?.remove(),vu=false;}function C6(e){if(e.classList.add($E),!e.querySelector(`#${om}`)){const t=document.createElement("div");t.id=om,t.innerHTML=v6,e.appendChild(t);}}function cp(e){e.classList.remove($E),e.querySelector(`#${om}`)?.remove();}function _h(){if(!Mr)return;const e=_t().get();if(e.object.type!=="egg"||!e.object.data){cp(Mr);return}const t=e.object.data;Ro.getBlockedEggs().includes(t.eggId)?(C6(Mr),console.log(`[EggLocker Inject] LOCKED — overlay applied (${t.eggId})`)):(cp(Mr),console.log(`[EggLocker Inject] unlocked — overlay removed (${t.eggId})`));}function S6(){w6();const e=nf(`.${xw}`,o=>{Mr=o,_h();});_d(()=>e.disconnect());const t=rf(`.${xw}`,o=>{Mr===o&&(cp(o),Mr=null);});_d(()=>t.disconnect());const n=_t().subscribeObject(()=>{_h();});_d(n);const r=()=>_h();window.addEventListener(Me.EGG_LOCKER_LOCKS_UPDATED,r),_d(()=>window.removeEventListener(Me.EGG_LOCKER_LOCKS_UPDATED,r)),console.log("[EggLocker Inject] Started");}function _6(){Mr&&(cp(Mr),Mr=null),y6(),x6(),console.log("[EggLocker Inject] Stopped");}let kd=false;const DE={init(){kd||(S6(),kd=true);},destroy(){kd&&(_6(),kd=false);},isEnabled(){return ho().enabled}};Fe(be.HatchEgg,()=>{const e=ho();if(!e.enabled)return  true;const t=_t().get();if(t.object.type!=="egg"||!t.object.data)return  true;const n=t.object.data.eggId;return e.blockedEggs.includes(n)?(console.log(`[EggLocker] Blocked hatch for ${n}`),false):(console.log(`[EggLocker] Allowed hatch for ${n}`),true)});let Xa=false;function FE(){if(Xa)return;if(!ho().enabled){console.log("[EggLocker] Disabled");return}Xa=true,DE.init(),console.log("[EggLocker] Initialized");}function BE(){Xa&&(DE.destroy(),Xa=false,console.log("[EggLocker] Destroyed"));}function k6(){return ho().enabled}function E6(e){const t=ho();t.enabled=e,of(t),e&&!Xa?FE():!e&&Xa&&BE();}function A6(){const e=ue.get("eggs");return e?Object.keys(e):[]}function T6(){return ho().blockedEggs}function I6(e){g6(e);}function P6(e){m6(e);}function R6(){const e=ho();e.blockedEggs=[],of(e);}const Ro={init:FE,destroy:BE,isEnabled:k6,setEnabled:E6,getAvailableEggs:A6,getBlockedEggs:T6,blockEgg:I6,unblockEgg:P6,clearBlocks:R6},Cw={enabled:true,blockedDecors:[]};function mr(){const e=Xe(hn.FEATURE.DECOR_LOCKER,Cw);return {...Cw,...e,blockedDecors:e.blockedDecors||[]}}function Cc(e){Ye(hn.FEATURE.DECOR_LOCKER,e);}function M6(e){const t=mr();t.blockedDecors.includes(e)||(t.blockedDecors.push(e),Cc(t),window.dispatchEvent(new CustomEvent(Me.DECOR_LOCKER_LOCKS_UPDATED)));}function L6(e){const t=mr();t.blockedDecors=t.blockedDecors.filter(n=>n!==e),Cc(t),window.dispatchEvent(new CustomEvent(Me.DECOR_LOCKER_LOCKS_UPDATED));}const O6=`
/* Locked decor card: purple border + subtle glow (respects border-radius, no layout shift) */
.gemini-qol-decorLocker-locked {
  position: relative !important;
  box-shadow: 0 0 0 2px #8B3E98, 0 0 8px rgba(139, 62, 152, 0.35) !important;
  transition: box-shadow 0.25s ease !important;
}

/* Lock icon badge: top-right corner */
#gemini-qol-decorLocker-lock-icon {
  position: absolute;
  top: 4px;
  right: 4px;
  width: 22px;
  height: 22px;
  background: linear-gradient(135deg, #652E91, #8B3E98);
  border: 1px solid rgba(174, 83, 176, 0.6);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: none;
  z-index: 10;
  box-shadow: 0 2px 8px rgba(139, 62, 152, 0.45);
  animation: gemini-decorLocker-glow 2.5s ease-in-out infinite;
}

/* Pulse subtle sur le badge */
@keyframes gemini-decorLocker-glow {
  0%, 100% { box-shadow: 0 2px 8px rgba(139, 62, 152, 0.45); }
  50%      { box-shadow: 0 2px 14px rgba(139, 62, 152, 0.75); }
}

/* Icone lock avec ombre pour la profondeur */
#gemini-qol-decorLocker-lock-icon svg {
  width: 12px;
  height: 12px;
  color: #F5F5F5;
  filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.4));
}
`,Sw="css-qnqsp4",jE="gemini-qol-decorLocker-locked",sm="gemini-qol-decorLocker-lock-icon",lm="gemini-qol-decorLocker-styles",N6='<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" focusable="false"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>';let Lr=null,yu=false;const cm=[];function Ed(e){cm.push(e);}function $6(){for(const e of cm)try{e();}catch(t){console.warn("[DecorLocker Inject] Cleanup error:",t);}cm.length=0;}function D6(){if(yu)return;if(document.getElementById(lm)){yu=true;return}const e=document.createElement("style");e.id=lm,e.textContent=O6,document.head.appendChild(e),yu=true;}function F6(){document.getElementById(lm)?.remove(),yu=false;}function B6(e){if(e.classList.add(jE),!e.querySelector(`#${sm}`)){const t=document.createElement("div");t.id=sm,t.innerHTML=N6,e.appendChild(t);}}function dp(e){e.classList.remove(jE),e.querySelector(`#${sm}`)?.remove();}function kh(){if(!Lr)return;const e=_t().get();if(e.object.type!=="decor"||!e.object.data){dp(Lr);return}const t=e.object.data;Mo.isDecorBlocked(t.decorId)?(B6(Lr),console.log(`[DecorLocker Inject] LOCKED — overlay applied (${t.decorId})`)):(dp(Lr),console.log(`[DecorLocker Inject] unlocked — overlay removed (${t.decorId})`));}function j6(){D6();const e=nf(`.${Sw}`,o=>{Lr=o,kh();});Ed(()=>e.disconnect());const t=rf(`.${Sw}`,o=>{Lr===o&&(dp(o),Lr=null);});Ed(()=>t.disconnect());const n=_t().subscribeObject(()=>{kh();});Ed(n);const r=()=>kh();window.addEventListener(Me.DECOR_LOCKER_LOCKS_UPDATED,r),Ed(()=>window.removeEventListener(Me.DECOR_LOCKER_LOCKS_UPDATED,r)),console.log("[DecorLocker Inject] Started");}function G6(){Lr&&(dp(Lr),Lr=null),$6(),F6(),console.log("[DecorLocker Inject] Stopped");}let Ad=false;const GE={init(){Ad||(j6(),Ad=true);},destroy(){Ad&&(G6(),Ad=false);},isEnabled(){return mr().enabled}};Fe(be.PickupDecor,()=>{const e=mr();if(!e.enabled)return  true;const t=_t().get();if(!t.object||t.object.type!=="decor"||!t.object.data)return  true;const n=t.object.data.decorId;return e.blockedDecors.includes(n)?(console.log(`[DecorLocker] Blocked pickup for ${n}`),false):(console.log(`[DecorLocker] Allowed pickup for ${n}`),true)});let Ya=false;function zE(){if(Ya)return;if(!mr().enabled){console.log("[DecorLocker] Disabled");return}Ya=true,GE.init(),console.log("[DecorLocker] Initialized");}function UE(){Ya&&(GE.destroy(),Ya=false,console.log("[DecorLocker] Destroyed"));}function z6(){return mr().enabled}function U6(e){const t=mr();t.enabled=e,Cc(t),e&&!Ya?zE():!e&&Ya&&UE();}function HE(){const e=ue.get("decor");return e?Object.keys(e):[]}function H6(){return mr().blockedDecors}function W6(e){return mr().blockedDecors.includes(e)}function V6(e){M6(e);}function q6(e){L6(e);}function K6(){const e=HE(),t=mr();t.blockedDecors=e,Cc(t),window.dispatchEvent(new CustomEvent("gemini:decorLocker-locks-updated"));}function WE(){const e=mr();e.blockedDecors=[],Cc(e),window.dispatchEvent(new CustomEvent("gemini:decorLocker-locks-updated"));}function X6(){WE();}const Mo={init:zE,destroy:UE,isEnabled:z6,setEnabled:U6,getAvailableDecors:HE,getBlockedDecors:H6,isDecorBlocked:W6,blockDecor:V6,unblockDecor:q6,blockAllDecors:K6,unblockAllDecors:WE,clearBlocks:X6};class VE{constructor(){de(this,"stats");de(this,"STORAGE_KEY",lt.TRACKER_STATS);this.stats=this.loadStats(),this.startSession();}loadStats(){return Xe(this.STORAGE_KEY,this.getDefaultStats())}saveStats(){Ye(this.STORAGE_KEY,this.stats);}getDefaultStats(){return {session:{sessionStart:Date.now(),sessionEnd:null,coinsEarned:0,coinsSpent:0,cropsHarvested:0,cropsSold:0,petsHatched:0,petsSold:0,petsFed:0,seedsPurchased:0,eggsPurchased:0,abilityProcs:0},allTime:{totalSessions:0,totalPlayTime:0,coinsEarned:0,coinsSpent:0,cropsHarvested:0,cropsSold:0,petsHatched:0,petsSold:0,petsFed:0,seedsPurchased:0,eggsPurchased:0,abilityProcs:0,crops:{},pets:{}}}}startSession(){this.stats.session={sessionStart:Date.now(),sessionEnd:null,coinsEarned:0,coinsSpent:0,cropsHarvested:0,cropsSold:0,petsHatched:0,petsSold:0,petsFed:0,seedsPurchased:0,eggsPurchased:0,abilityProcs:0},this.stats.allTime.totalSessions++,this.saveStats();}endSession(){this.stats.session.sessionEnd=Date.now();const t=this.stats.session.sessionEnd-this.stats.session.sessionStart;this.stats.allTime.totalPlayTime+=t,this.saveStats();}recordHarvest(t,n=1,r=[]){this.stats.session.cropsHarvested+=n,this.stats.allTime.cropsHarvested+=n,this.stats.allTime.crops[t]||(this.stats.allTime.crops[t]={harvested:0,sold:0,totalValue:0,mutations:{}}),this.stats.allTime.crops[t].harvested+=n;for(const o of r)this.stats.allTime.crops[t].mutations[o]||(this.stats.allTime.crops[t].mutations[o]=0),this.stats.allTime.crops[t].mutations[o]++;this.saveStats();}recordCropSale(t,n=1,r=0){this.stats.session.cropsSold+=n,this.stats.session.coinsEarned+=r,this.stats.allTime.cropsSold+=n,this.stats.allTime.coinsEarned+=r,this.stats.allTime.crops[t]||(this.stats.allTime.crops[t]={harvested:0,sold:0,totalValue:0,mutations:{}}),this.stats.allTime.crops[t].sold+=n,this.stats.allTime.crops[t].totalValue+=r,this.saveStats();}recordPetHatch(t,n=[],r=[]){this.stats.session.petsHatched++,this.stats.allTime.petsHatched++,this.stats.allTime.pets[t]||(this.stats.allTime.pets[t]={hatched:0,sold:0,fed:0,mutations:{},abilities:{}}),this.stats.allTime.pets[t].hatched++;for(const o of n)this.stats.allTime.pets[t].mutations[o]||(this.stats.allTime.pets[t].mutations[o]=0),this.stats.allTime.pets[t].mutations[o]++;for(const o of r)this.stats.allTime.pets[t].abilities[o]||(this.stats.allTime.pets[t].abilities[o]=0),this.stats.allTime.pets[t].abilities[o]++;this.saveStats();}recordPetSale(t,n=0){this.stats.session.petsSold++,this.stats.session.coinsEarned+=n,this.stats.allTime.petsSold++,this.stats.allTime.coinsEarned+=n,this.stats.allTime.pets[t]||(this.stats.allTime.pets[t]={hatched:0,sold:0,fed:0,mutations:{},abilities:{}}),this.stats.allTime.pets[t].sold++,this.saveStats();}recordPetFeed(t){this.stats.session.petsFed++,this.stats.allTime.petsFed++,this.stats.allTime.pets[t]||(this.stats.allTime.pets[t]={hatched:0,sold:0,fed:0,mutations:{},abilities:{}}),this.stats.allTime.pets[t].fed++,this.saveStats();}recordSeedPurchase(t,n=1,r=0){this.stats.session.seedsPurchased+=n,this.stats.session.coinsSpent+=r,this.stats.allTime.seedsPurchased+=n,this.stats.allTime.coinsSpent+=r,this.saveStats();}recordEggPurchase(t,n=1,r=0){this.stats.session.eggsPurchased+=n,this.stats.session.coinsSpent+=r,this.stats.allTime.eggsPurchased+=n,this.stats.allTime.coinsSpent+=r,this.saveStats();}recordAbilityProc(t){this.stats.session.abilityProcs++,this.stats.allTime.abilityProcs++,this.saveStats();}recordCoinsEarned(t){this.stats.session.coinsEarned+=t,this.stats.allTime.coinsEarned+=t,this.saveStats();}recordCoinsSpent(t){this.stats.session.coinsSpent+=t,this.stats.allTime.coinsSpent+=t,this.saveStats();}getStats(){return {...this.stats}}getSessionStats(){return {...this.stats.session}}getAllTimeStats(){return {...this.stats.allTime}}getCropStats(t){return this.stats.allTime.crops[t]||null}getPetStats(t){return this.stats.allTime.pets[t]||null}getTopCrops(t=10){return Object.entries(this.stats.allTime.crops).map(([n,r])=>({species:n,stats:r})).sort((n,r)=>r.stats.harvested-n.stats.harvested).slice(0,t)}getTopPets(t=10){return Object.entries(this.stats.allTime.pets).map(([n,r])=>({species:n,stats:r})).sort((n,r)=>r.stats.hatched-n.stats.hatched).slice(0,t)}resetSession(){this.startSession();}resetAll(){this.stats=this.getDefaultStats(),this.saveStats();}exportStats(){return JSON.stringify(this.stats,null,2)}importStats(t){try{const n=JSON.parse(t);return this.stats=n,this.saveStats(),!0}catch(n){return console.warn("[StatsTracker] Failed to import stats:",n),false}}}let Ma=null;function Y6(){return Ma||(Ma=new VE),Ma}function J6(){Ma&&(Ma.endSession(),Ma=null);}function qE(e){const t=Ip(e.xp),n=dc(e.petSpecies,e.targetScale),r=uc(e.petSpecies,e.xp,n),o=Pp(e.petSpecies,t),i=NS(e.petSpecies),a=LO(r,n,i),s=$S(r,n);return {current:r,max:n,progress:s,age:t,isMature:o,strengthPerHour:i,hoursToMax:a}}function KE(e){return {...e,strength:qE(e)}}function XE(e){return e.map(KE)}function Q6(e){if(e.length===0)return {averageCurrent:0,averageMax:0,totalMature:0,totalImmature:0,strongestPet:null,weakestPet:null};const t=XE(e),n=t.reduce((l,c)=>l+c.strength.current,0),r=t.reduce((l,c)=>l+c.strength.max,0),o=t.filter(l=>l.strength.isMature).length,i=t.length-o,a=t.reduce((l,c)=>c.strength.max>(l?.strength.max||0)?c:l,t[0]),s=t.reduce((l,c)=>c.strength.max<(l?.strength.max||1/0)?c:l,t[0]);return {averageCurrent:Math.round(n/t.length),averageMax:Math.round(r/t.length),totalMature:o,totalImmature:i,strongestPet:a,weakestPet:s}}const Z6=Object.freeze(Object.defineProperty({__proto__:null,calculatePetStrength:qE,enrichPetWithStrength:KE,enrichPetsWithStrength:XE,getPetStrengthStats:Q6},Symbol.toStringTag,{value:"Module"}));class YE{constructor(){de(this,"logs",[]);de(this,"maxLogs",1e3);de(this,"unsubscribe",null);de(this,"isInitialized",false);}init(){this.isInitialized||(this.unsubscribe=De.myPets.subscribeAbility(t=>{this.log({abilityId:t.trigger.abilityId||"unknown",petId:t.pet.id,petSpecies:t.pet.petSpecies,petName:t.pet.name,timestamp:t.trigger.performedAt||Date.now()});}),this.isInitialized=true);}log(t){const n={...t,id:`${t.timestamp}-${Math.random().toString(36).substr(2,9)}`};this.logs.push(n),this.logs.length>this.maxLogs&&(this.logs=this.logs.slice(-this.maxLogs));}getLogs(t){let n=this.logs;t?.abilityId&&(n=n.filter(o=>o.abilityId===t.abilityId)),t?.petId&&(n=n.filter(o=>o.petId===t.petId)),t?.petSpecies&&(n=n.filter(o=>o.petSpecies===t.petSpecies));const{since:r}=t??{};return r!==void 0&&(n=n.filter(o=>o.timestamp>=r)),t?.limit&&(n=n.slice(-t.limit)),n}getStats(t=36e5){const n=Date.now()-t,r=this.logs.filter(i=>i.timestamp>=n),o=new Map;for(const i of r){o.has(i.abilityId)||o.set(i.abilityId,{abilityId:i.abilityId,count:0,procsPerMinute:0,procsPerHour:0,lastProc:null});const a=o.get(i.abilityId);a.count++,(!a.lastProc||i.timestamp>a.lastProc)&&(a.lastProc=i.timestamp);}for(const i of o.values())i.procsPerMinute=i.count/t*6e4,i.procsPerHour=i.count/t*36e5;return o}getAbilityStats(t,n=36e5){return this.getStats(n).get(t)||null}getPetStats(t,n=36e5){const r=Date.now()-n,o=this.logs.filter(a=>a.petId===t&&a.timestamp>=r),i=new Map;for(const a of o){i.has(a.abilityId)||i.set(a.abilityId,{abilityId:a.abilityId,count:0,procsPerMinute:0,procsPerHour:0,lastProc:null});const s=i.get(a.abilityId);s.count++,(!s.lastProc||a.timestamp>s.lastProc)&&(s.lastProc=a.timestamp);}for(const a of i.values())a.procsPerMinute=a.count/n*6e4,a.procsPerHour=a.count/n*36e5;return {totalProcs:o.length,abilities:i}}getTopAbilities(t=10,n=36e5){return Array.from(this.getStats(n).values()).sort((o,i)=>i.count-o.count).slice(0,t)}clear(){this.logs=[];}setMaxLogs(t){this.maxLogs=t,this.logs.length>t&&(this.logs=this.logs.slice(-t));}getLogCount(){return this.logs.length}isActive(){return this.isInitialized}destroy(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null),this.logs=[],this.isInitialized=false;}}let Ci=null;function eU(){return Ci||(Ci=new YE,Ci.init()),Ci}function tU(){Ci&&(Ci.destroy(),Ci=null);}const nU={StatsTracker:VE,getStatsTracker:Y6,destroyStatsTracker:J6},rU={AbilityLogger:YE,getAbilityLogger:eU,destroyAbilityLogger:tU,...Z6},rr=[{id:"Rainbow",desc:"All Rainbow items"},{id:"Gold",desc:"All Gold items"},{id:"Wet",desc:"All Wet items"},{id:"Chilled",desc:"All Chilled items"},{id:"Frozen",desc:"All Frozen items"},{id:"Dawnlit",desc:"Dawn mutations"},{id:"Dawncharged",desc:"Dawn charged"},{id:"Ambershine",desc:"Amber mutations"},{id:"Ambercharged",desc:"Amber charged"}],oU={Common:1,Uncommon:2,Rare:3,Legendary:4,Mythical:5,Divine:6,Celestial:7};function ra(e){return e?oU[e]??0:0}class iU extends pr{constructor(){super({id:"tab-auto-favorite",label:"Auto-Favorite"});de(this,"allPlants",[]);de(this,"allPets",[]);de(this,"sectionElement",null);}async build(n){await q$();const r=n.getRootNode();wt(r,r_,"auto-favorite-settings-styles");const o=this.createGrid("12px");o.id="auto-favorite-settings",this.sectionElement=o,n.appendChild(o),await this.loadGameData(),await this.waitForSprites(),this.renderContent();}async loadGameData(){try{await ue.waitForAny(3e3).catch(()=>{}),await Promise.all([ue.waitFor("plants",3e3).catch(()=>console.warn("[AutoFavorite UI] Still waiting for plants data...")),ue.waitFor("pets",3e3).catch(()=>console.warn("[AutoFavorite UI] Still waiting for pets data..."))]);const n=ue.get("plants")||{},r=ue.get("pets")||{};this.allPlants=Object.keys(n).sort((o,i)=>{const a=n[o]?.seed?.rarity||null,s=n[i]?.seed?.rarity||null,l=ra(a)-ra(s);return l!==0?l:o.localeCompare(i,void 0,{numeric:!0,sensitivity:"base"})}),this.allPets=Object.keys(r).sort((o,i)=>{const a=r[o]?.rarity||null,s=r[i]?.rarity||null,l=ra(a)-ra(s);return l!==0?l:o.localeCompare(i,void 0,{numeric:!0,sensitivity:"base"})});}catch(n){console.error("[AutoFavorite UI] Failed to load game data:",n);}}async waitForSprites(){if(me.isReady())return;const n=1e4,r=100;let o=0;return new Promise(i=>{const a=()=>{me.isReady()||o>=n?i():(o+=r,setTimeout(a,r));};a();})}renderContent(){this.sectionElement&&(this.sectionElement.innerHTML="",this.sectionElement.appendChild(this.createMasterToggle()),this.sectionElement.appendChild(this.createMutationsCard()),this.sectionElement.appendChild(this.createProduceCard()),this.sectionElement.appendChild(this.createPetsCard()));}createMasterToggle(){const n=x("div",{className:"kv"}),r=km({text:"Enable Auto-Favorite",tone:"default",size:"lg"}),o=ao({checked:tr().get().enabled,onChange:async i=>{const a=tr(),s=a.get();await a.set({...s,enabled:i}),await this.saveConfig();}});return n.append(r.root,o.root),dt({title:"Auto-Favorite",padding:"lg"},n,x("p",{style:"margin-top: 6px; font-size: 12px; color: var(--muted);"},"Automatically favorite items when added to inventory"))}createMutationsCard(){const n=x("div",{className:"u-col"}),r=x("div",{className:"mut-row"});r.appendChild(this.createMutationButton(rr[0])),r.appendChild(this.createMutationButton(rr[1])),n.appendChild(r);const o=x("div",{className:"mut-row"});o.appendChild(this.createMutationButton(rr[2])),o.appendChild(this.createMutationButton(rr[3])),o.appendChild(this.createMutationButton(rr[4])),n.appendChild(o);const i=x("div",{className:"mut-row"});i.appendChild(this.createMutationButton(rr[5])),i.appendChild(this.createMutationButton(rr[6])),n.appendChild(i);const a=x("div",{className:"mut-row"});return a.appendChild(this.createMutationButton(rr[7])),a.appendChild(this.createMutationButton(rr[8])),n.appendChild(a),dt({title:"Mutations Priority",variant:"soft",padding:"lg",expandable:true,defaultExpanded:true},n,x("p",{style:"margin-top: 8px; font-size: 11px; color: var(--muted);"},`${tr().get().favoriteMutations.length} / ${rr.length} active`))}createMutationButton(n){let r=tr().get().favoriteMutations.includes(n.id);const i=["mut-btn",`mut-btn--${n.id.toLowerCase()}`];r&&i.push("active");const a=x("div",{className:i.join(" ")}),s=x("div",{style:"width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;"});try{if(me.isReady()){const d=me.toCanvas("plant","Sunflower",{mutations:[n.id],scale:.16});d.style.width="28px",d.style.height="28px",d.style.objectFit="contain",s.appendChild(d);}}catch{}const l=n.id.charAt(0).toUpperCase()+n.id.slice(1).toLowerCase(),c=x("div",{style:"font-size: 13px; font-weight: 600; color: var(--fg); text-shadow: 0 1px 2px rgba(0,0,0,0.5); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"},l);if(a.append(s,c),n.id==="Rainbow"||n.id==="Gold"){const d=x("div",{style:"width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;"});try{if(me.isReady()){const u=me.toCanvas("pet","Capybara",{mutations:[n.id],scale:.16});u.style.width="28px",u.style.height="28px",u.style.objectFit="contain",d.appendChild(u);}}catch{}a.append(d);}else {const d=x("div",{style:"width: 28px; flex-shrink: 0;"});a.append(d);}return a.addEventListener("click",async d=>{d.stopPropagation();const u=tr(),f=u.get();if(r){const h=f.favoriteMutations.filter(y=>y!==n.id);await u.set({...f,favoriteMutations:h}),r=false,a.classList.remove("active");}else {const h=[...f.favoriteMutations,n.id];await u.set({...f,favoriteMutations:h}),r=true,a.classList.add("active");}await this.saveConfig();const g=this.sectionElement?.querySelector(".card p");g&&(g.textContent=`${tr().get().favoriteMutations.length} / ${rr.length} active`);}),a}createProduceCard(){return this.createItemSelectionCard({title:"Produce",items:this.allPlants,category:"plant",selected:tr().get().favoriteProduceList,onUpdate:async n=>{const r=tr(),o=r.get();await r.set({...o,favoriteProduceList:n}),await this.saveConfig();}})}createPetsCard(){return this.createItemSelectionCard({title:"Pets",items:this.allPets,category:"pet",selected:tr().get().favoritePetsList,onUpdate:async n=>{const r=tr(),o=r.get();await r.set({...o,favoritePetsList:n}),await this.saveConfig();}})}createItemSelectionCard(n){const{title:r,items:o,category:i,selected:a,onUpdate:s}=n;let l=new Set(a),c=o;const d=x("div",{style:"margin-bottom: 8px;"}),u=es({placeholder:`Search ${r.toLowerCase()}...`,value:"",debounceMs:150,withClear:true,size:"sm",focusKey:"",onChange:k=>{const I=k.trim().toLowerCase();I?c=o.filter(R=>R.toLowerCase().includes(I)):c=o,E.setData(y());}});d.appendChild(u.root);const f=x("div",{style:"display: flex; gap: 8px; margin-bottom: 12px;"}),g=Ct({label:"Select All",variant:"default",size:"sm",onClick:()=>{const k=y().map(I=>I.id);E.setSelection(k);}}),h=Ct({label:"Deselect All",variant:"default",size:"sm",onClick:()=>{E.clearSelection();}});f.append(g,h);const y=()=>c.map(k=>({id:k,name:k,rarity:this.getItemRarity(k,i),selected:l.has(k)})),S=k=>{if(!k){const R=x("span",{style:"opacity:0.5;"});return R.textContent="—",R}return ts({variant:"rarity",rarity:k,size:"sm"}).root},C=k=>{const I=x("div",{style:"width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; overflow: hidden; flex-shrink: 0; background: color-mix(in oklab, var(--bg) 5%, transparent); border-radius: 6px;"});try{if(me.isReady()){let R=i,A=k;i==="plant"&&(["Bamboo","Cactus"].includes(k)&&(R="tallplant"),k==="DawnCelestial"&&(A="DawnCelestialCrop"),k==="MoonCelestial"&&(A="MoonCelestialCrop"),k==="OrangeTulip"&&(A="Tulip"));const L=me.toCanvas(R,A,{scale:.5});L.style.width="28px",L.style.height="28px",L.style.objectFit="contain",I.appendChild(L);}}catch{}return I},E=Za({columns:[{key:"name",header:"Name",width:"1fr",align:"center",sortable:true,sortFn:(k,I)=>k.name.localeCompare(I.name,void 0,{numeric:true,sensitivity:"base"}),render:k=>{const I=x("div",{style:"display: flex; align-items: center; justify-content: center; gap: 8px; width: 100%;"}),R=C(k.id),A=x("span",{style:"font-weight: 500; color: var(--fg); white-space: nowrap;"},k.name);return I.append(R,A),I}},{key:"rarity",header:"Rarity",width:"100px",align:"center",sortable:true,sortFn:(k,I)=>ra(k.rarity)-ra(I.rarity),render:k=>S(k.rarity)}],data:y(),maxHeight:280,compact:true,zebra:true,animations:true,selectable:true,selectOnRowClick:true,hideHeaderCheckbox:true,initialSelection:Array.from(l),getRowId:k=>k.id,onSelectionChange:k=>{l.clear(),k.forEach(I=>l.add(I)),s(Array.from(l)),O();}}),P=x("p",{style:"margin-top: 8px; font-size: 11px; color: var(--muted);"}),O=()=>{P.textContent=`${l.size} / ${o.length} selected`;};return O(),dt({title:`${r} (${l.size}/${o.length})`,variant:"soft",padding:"lg",expandable:true,defaultExpanded:false},d,f,E.root,P)}getItemRarity(n,r){try{if(r==="pet")return (ue.get("pets")||{})[n]?.rarity||null;if(r==="plant"){const o=ue.get("plants")||{},i=o[n];if(i?.seed?.rarity)return i.seed.rarity;const a=n.toLowerCase();for(const s of Object.values(o))if(s?.seed?.name?.toLowerCase()===a||s?.plant?.name?.toLowerCase()===a)return s.seed.rarity}}catch{}return null}async saveConfig(){const n=tr().get();try{const{updateSimpleConfig:r}=l_;await r({enabled:n.enabled,favoriteSpecies:[...n.favoriteProduceList,...n.favoritePetsList],favoriteMutations:n.favoriteMutations});}catch(r){console.error("[AutoFavoriteSettings] Failed to update feature config:",r);}}}function aU(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.style.color="var(--accent)";const t=document.createElementNS("http://www.w3.org/2000/svg","line");t.setAttribute("x1","12"),t.setAttribute("y1","5"),t.setAttribute("x2","12"),t.setAttribute("y2","19");const n=document.createElementNS("http://www.w3.org/2000/svg","line");return n.setAttribute("x1","5"),n.setAttribute("y1","12"),n.setAttribute("x2","19"),n.setAttribute("y2","12"),e.appendChild(t),e.appendChild(n),e}function sU(e,t){const n=e;let r=e;const o=ic({value:e,placeholder:"Team name",mode:"alphanumeric",allowSpaces:true,maxLength:50,blockGameKeys:true,onChange:i=>{const a=i.trim();a&&a!==r&&(r=a,t?.(a));},onEnter:i=>{const a=i.trim()||n;a!==r&&(r=a,t?.(a));}});return o.root.className="team-list-item__name-input",o.input.addEventListener("blur",()=>{const i=o.getValue().trim()||n;i!==r&&(r=i,t?.(i));}),o.input.addEventListener("keydown",i=>{i.key==="Escape"&&(i.preventDefault(),o.input.blur());}),o.root}function JE(e){const t=x("div",{className:"team-list-item"}),n=e.customIndicator??x("div",{className:`team-list-item__indicator ${e.isActive?"team-list-item__indicator--active":"team-list-item__indicator--inactive"}`}),r=e.isNameEditable?sU(e.team.name,e.onNameChange):x("div",{textContent:e.team.name,className:`team-list-item__name ${e.isActive?"team-list-item__name--active":"team-list-item__name--inactive"}`}),o=x("div",{className:"team-list-item__sprites"});function i(){const l=De.myPets.get();o.innerHTML="";for(let c=0;c<3;c++){const d=e.team.petIds[c],u=d&&d!=="",f=x("div",{className:`team-list-item__sprite-slot ${e.showSlotStyles&&!u?"team-list-item__sprite-slot--empty":""}`});if(e.onSlotClick&&(f.style.cursor="pointer",f.addEventListener("click",()=>{e.onSlotClick(c);})),u){let g=l.all.find(h=>h.id===d);if(!g){const h=window.__petDataCache;h&&h.has(d)&&(g=h.get(d));}if(g)try{const h=me.toCanvas("pet",g.petSpecies,{mutations:g.mutations,scale:1}),y=document.createElement("canvas");y.width=h.width,y.height=h.height;const S=y.getContext("2d");if(S&&S.drawImage(h,0,0),y.style.width="100%",y.style.height="100%",y.style.objectFit="contain",f.appendChild(y),e.showSlotStyles){const C=x("div",{className:"team-list-item__sprite-slot-overlay"});f.appendChild(C),f.classList.add("team-list-item__sprite-slot--filled");}}catch(h){console.warn(`[TeamListItem] Failed to render sprite for pet ${g.petSpecies}:`,h);const y=x("div",{textContent:"🐾",className:"team-list-item__sprite-placeholder"});f.appendChild(y);}else {const h=x("div",{textContent:"⏳",className:"team-list-item__sprite-placeholder"});f.appendChild(h),console.warn(`[TeamListItem] Pet ${d} not found in myPets yet, waiting for update`);let y=false;const S=De.myPets.subscribe(()=>{if(y)return;const _=De.myPets.get().all.find(E=>E.id===d);if(_){y=true,S();try{f.innerHTML="";const E=me.toCanvas("pet",_.petSpecies,{mutations:_.mutations,scale:1}),P=document.createElement("canvas");P.width=E.width,P.height=E.height;const O=P.getContext("2d");if(O&&O.drawImage(E,0,0),P.style.width="100%",P.style.height="100%",P.style.objectFit="contain",f.appendChild(P),e.showSlotStyles){const k=x("div",{className:"team-list-item__sprite-slot-overlay"});f.appendChild(k),f.classList.add("team-list-item__sprite-slot--filled");}console.log(`[TeamListItem] Pet ${d} sprite updated`);}catch(E){console.warn(`[TeamListItem] Failed to render sprite for pet ${_.petSpecies}:`,E),f.innerHTML="<div class='team-list-item__sprite-placeholder'>🐾</div>";}}},{immediate:false});}}else if(e.showSlotStyles&&!u){const g=aU();f.appendChild(g);}o.appendChild(f);}}i();const a=De.myPets.subscribe(()=>{i();});if(!e.hideDragHandle){const l=x("div",{textContent:"⋮⋮",className:"team-list-item__drag-handle"});t.appendChild(l);}if(t.appendChild(n),t.appendChild(r),t.appendChild(o),e.onExpandClick){const l=x("button",{className:`team-list-item__expand ${e.isExpanded?"team-list-item__expand--open":""}`});l.innerHTML='<svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>',l.addEventListener("click",c=>{c.stopPropagation(),e.onExpandClick?.();}),t.appendChild(l);}const s=new MutationObserver(()=>{document.contains(t)||(s.disconnect(),a());});return s.observe(document.body,{childList:true,subtree:true}),t}function lU(e){return e==null?null:typeof e=="string"?document.createTextNode(e):e}function Ui(e){const{segments:t,selected:n=t[0]?.id??"",size:r="md",fullWidth:o=false,disabled:i=false,onChange:a}=e,s=x("div",{className:"sg-root"});r!=="md"&&s.classList.add(`sg--${r}`),o&&(s.style.width="100%");const l=x("div",{className:"sg-container",role:"tablist"}),c=x("div",{className:"sg-indicator"}),d=t.map(I=>{const R=x("button",{className:"sg-btn",type:"button",role:"tab","aria-selected":"false",title:I.label});if(R.id=I.id,I.icon){const L=x("span",{className:"sg-icon"}),F=lU(I.icon);F&&L.appendChild(F),R.appendChild(L);}const A=x("span",{className:"sg-label"},I.label);return R.appendChild(A),R.disabled=!!I.disabled,R});l.appendChild(c),d.forEach(I=>l.appendChild(I)),s.appendChild(l);let u=n,f=i,g=null;function h(){const I=d.find(R=>R.id===u);I&&requestAnimationFrame(()=>{const R=c,A=I.offsetLeft,L=I.offsetWidth;R.style.width=`${L}px`,R.style.transform=`translateX(${A}px)`;});}function y(){d.forEach(I=>{const R=I.id===u;I.classList.toggle("active",R),I.setAttribute("aria-selected",String(R)),I.disabled=f||!!t.find(A=>A.id===I.id)?.disabled;}),h();}function S(I){const R=I.currentTarget;if(R.disabled)return;_(R.id);}function C(I){if(f)return;const R=d.findIndex(L=>L.id===u);let A=R;if(I.key==="ArrowLeft"||I.key==="ArrowUp"?(I.preventDefault(),A=(R-1+d.length)%d.length):I.key==="ArrowRight"||I.key==="ArrowDown"?(I.preventDefault(),A=(R+1)%d.length):I.key==="Home"?(I.preventDefault(),A=0):I.key==="End"&&(I.preventDefault(),A=d.length-1),A!==R){const L=d[A];L&&!L.disabled&&(_(L.id),L.focus());}}d.forEach(I=>{I.addEventListener("click",S),I.addEventListener("keydown",C);});function _(I){!t.some(A=>A.id===I)||u===I||(u=I,y(),a?.(u));}function E(){return u}function P(I){f=!!I,y();}function O(){d.forEach(I=>{I.removeEventListener("click",S),I.removeEventListener("keydown",C);}),g?.disconnect(),g=null;}y(),g=new ResizeObserver(()=>{const I=d.find(R=>R.id===u);if(I&&I.offsetWidth>0){const R=c;R.style.transition="none",R.style.width=`${I.offsetWidth}px`,R.style.transform=`translateX(${I.offsetLeft}px)`,requestAnimationFrame(()=>{R.style.removeProperty("transition");}),g?.disconnect(),g=null;}}),g.observe(l);const k=s;return k.select=_,k.getSelected=E,k.setDisabled=P,k.destroy=O,k}function af(e={}){const{id:t,checked:n=false,disabled:r=false,size:o="md",label:i,labelSide:a="right",onChange:s}=e,l=x("div",{className:"lg-checkbox-wrap"}),c=x("input",{className:`lg-checkbox lg-checkbox--${o}`,id:t,type:"checkbox",checked:!!n,disabled:!!r});let d=null;i&&a!=="none"&&(d=x("label",{className:"lg-checkbox-label"},i),d.addEventListener("click",y)),d&&a==="left"?l.append(d,c):d&&a==="right"?l.append(c,d):l.append(c);let u=!!n,f=!!r;function g(){c.checked=u,c.disabled=f;}function h(I=false){f||(u=!u,g(),I||s?.(u));}function y(){f||h();}function S(I){f||(I.key===" "||I.key==="Enter")&&(I.preventDefault(),h());}c.addEventListener("click",y),c.addEventListener("keydown",S);function C(){return u}function _(I,R=false){u=!!I,g(),R||s?.(u);}function E(I){f=!!I,g();}function P(I){if(!I){d&&(d.remove(),d=null);return}d?d.textContent=I:(d=x("label",{className:"lg-checkbox-label"},I),d.addEventListener("click",y),l.append(d));}function O(){c.focus();}function k(){c.removeEventListener("click",y),c.removeEventListener("keydown",S),d&&d.removeEventListener("click",y);}return g(),{root:l,input:c,isChecked:C,setChecked:_,setDisabled:E,setLabel:P,focus:O,destroy:k}}let Ls=0,_w="",kw="";function cU(){return Ls===0&&(_w=document.body.style.overflow,kw=document.body.style.touchAction,document.body.style.overflow="hidden",document.body.style.touchAction="none"),Ls++,()=>{Ls=Math.max(0,Ls-1),Ls===0&&(document.body.style.overflow=_w,document.body.style.touchAction=kw);}}class dU{constructor(t){de(this,"dragState",null);de(this,"longPressState",null);de(this,"options");de(this,"onPointerMove");de(this,"onPointerUp");de(this,"onPointerCancel");de(this,"onLongPressPointerMove");de(this,"onLongPressPointerUp");this.options=t,this.onPointerMove=this.handlePointerMove.bind(this),this.onPointerUp=this.handlePointerUp.bind(this),this.onPointerCancel=this.handlePointerCancel.bind(this),this.onLongPressPointerMove=this.handleLongPressPointerMove.bind(this),this.onLongPressPointerUp=this.handleLongPressPointerUp.bind(this);}startLongPress(t,n,r){if(this.cleanupLongPress(),je.getAllTeams().findIndex(c=>c.id===r)===-1)return;const a=t.clientX,s=t.clientY,l=window.setTimeout(()=>{this.longPressState&&this.startDrag(t,n,r);},500);this.longPressState={pointerId:t.pointerId,startX:a,startY:s,timeout:l,target:n},window.addEventListener("pointermove",this.onLongPressPointerMove,{passive:false}),window.addEventListener("pointerup",this.onLongPressPointerUp,{passive:false});}startDrag(t,n,r){const o=this.options.getListContainer();if(this.dragState||!o)return;t.preventDefault();const a=je.getAllTeams().findIndex(f=>f.id===r);if(a===-1)return;const s=n.getBoundingClientRect(),l=o.getBoundingClientRect(),c=n.cloneNode(true);c.classList.add("team-list-item--placeholder"),c.classList.remove("team-list-item--dragging");const d=n.style.touchAction;n.style.touchAction="none";const u=cU();if(this.dragState={itemEl:n,pointerId:t.pointerId,placeholder:c,offsetY:t.clientY-s.top,fromIndex:a,teamId:r,captureTarget:n,touchActionPrev:d,releaseScrollLock:u},n.classList.add("team-list-item--dragging"),n.style.width=`${s.width}px`,n.style.height=`${s.height}px`,n.style.left=`${s.left-l.left}px`,n.style.top=`${s.top-l.top}px`,n.style.position="absolute",n.style.zIndex="30",n.style.pointerEvents="none",o.style.position||(o.style.position="relative"),o.insertBefore(c,n.nextSibling),o.classList.add("is-reordering"),n.setPointerCapture)try{n.setPointerCapture(t.pointerId);}catch{}window.addEventListener("pointermove",this.onPointerMove,{passive:false}),window.addEventListener("pointerup",this.onPointerUp,{passive:false}),window.addEventListener("pointercancel",this.onPointerCancel,{passive:false});}cleanup(){this.cleanupDrag(),this.cleanupLongPress();}handleLongPressPointerMove(t){if(!this.longPressState||t.pointerId!==this.longPressState.pointerId)return;const n=Math.abs(t.clientX-this.longPressState.startX),r=Math.abs(t.clientY-this.longPressState.startY),o=10;(n>o||r>o)&&this.cleanupLongPress();}handleLongPressPointerUp(t){!this.longPressState||t.pointerId!==this.longPressState.pointerId||this.cleanupLongPress();}handlePointerMove(t){const n=this.options.getListContainer();if(!this.dragState||!n||t.pointerId!==this.dragState.pointerId)return;t.preventDefault();const r=n.getBoundingClientRect();let o=t.clientY-r.top-this.dragState.offsetY;const i=r.height-this.dragState.itemEl.offsetHeight;Number.isFinite(i)&&(o=Math.max(-8,Math.min(i+8,o))),this.dragState.itemEl.style.top=`${o}px`,this.updatePlaceholderPosition(t.clientY);}handlePointerUp(t){!this.dragState||t.pointerId!==this.dragState.pointerId||(t.preventDefault(),this.finishDrag());}handlePointerCancel(t){!this.dragState||t.pointerId!==this.dragState.pointerId||this.finishDrag({revert:true});}updatePlaceholderPosition(t){const n=this.options.getListContainer();if(!this.dragState||!n)return;const{placeholder:r,itemEl:o}=this.dragState,i=Array.from(n.children).filter(l=>l!==o&&l!==r&&l instanceof HTMLElement&&l.classList.contains("team-list-item")),a=new Map;i.forEach(l=>{a.set(l,l.getBoundingClientRect().top);});let s=false;for(const l of i){const c=l.getBoundingClientRect(),d=c.top+c.height/2;if(t<d){r.nextSibling!==l&&n.insertBefore(r,l),s=true;break}}s||n.appendChild(r),i.forEach(l=>{const c=a.get(l),d=l.getBoundingClientRect().top;if(c!==void 0&&c!==d){const u=c-d;l.style.transform=`translateY(${u}px)`,l.style.transition="none",l.offsetHeight,l.style.transition="transform 0.14s ease",l.style.transform="translateY(0)";}});}finishDrag(t={}){const n=this.options.getListContainer();if(!this.dragState||!n)return;const{revert:r=false}=t,{itemEl:o,placeholder:i,fromIndex:a,touchActionPrev:s,releaseScrollLock:l,pointerId:c}=this.dragState;if(n.classList.remove("is-reordering"),o.hasPointerCapture(c))try{o.releasePointerCapture(c);}catch{}if(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("pointercancel",this.onPointerCancel),r){const f=Array.from(n.children).filter(g=>g!==o&&g!==i&&g instanceof HTMLElement&&g.classList.contains("team-list-item"))[a]||null;f?n.insertBefore(i,f):n.appendChild(i);}else {const u=Array.from(n.children).filter(g=>g!==o),f=u.indexOf(i);if(f!==-1){const g=u[f];g!==i&&n.insertBefore(i,g);}}if(i.replaceWith(o),i.remove(),o.classList.remove("team-list-item--dragging"),o.style.width="",o.style.height="",o.style.left="",o.style.top="",o.style.position="",o.style.zIndex="",o.style.pointerEvents="",o.style.touchAction=s??"",Array.from(n.children).filter(u=>u instanceof HTMLElement&&u.classList.contains("team-list-item")).forEach(u=>{u.style.transform="",u.style.transition="";}),l?.(),!r){const f=Array.from(n.children).filter(g=>g instanceof HTMLElement&&g.classList.contains("team-list-item")).indexOf(o);if(f!==-1&&f!==a){const h=je.getAllTeams().slice(),[y]=h.splice(a,1);h.splice(f,0,y);const S=h.map(C=>C.id);je.reorderTeams(S),this.options.onReorder(S);}}this.dragState=null;}cleanupDrag(){this.dragState&&(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("pointercancel",this.onPointerCancel),this.dragState=null);}cleanupLongPress(){this.longPressState&&(window.clearTimeout(this.longPressState.timeout),window.removeEventListener("pointermove",this.onLongPressPointerMove),window.removeEventListener("pointerup",this.onLongPressPointerUp),this.longPressState=null);}}class uU{constructor(t={}){de(this,"card",null);de(this,"modeControl",null);de(this,"modeContainer",null);de(this,"teamContent",null);de(this,"listContainer",null);de(this,"teamMode","overview");de(this,"selectedTeamIds",new Set);de(this,"teamCheckboxes",new Map);de(this,"options");de(this,"dragHandler");this.options=t,this.dragHandler=new dU({getListContainer:()=>this.listContainer,onReorder:n=>{this.options.onTeamReordered?.(n),this.options.onTeamsUpdated?.();}});}build(){return this.card?this.card:this.createTeamCard()}destroy(){this.dragHandler.cleanup(),this.modeControl&&(this.modeControl.destroy(),this.modeControl=null),this.teamCheckboxes.forEach(t=>t.destroy()),this.teamCheckboxes.clear(),this.selectedTeamIds.clear(),this.card=null,this.modeContainer=null,this.teamContent=null,this.listContainer=null;}render(){if(!this.card)return;if(!je.isEnabled()){this.renderDisabledState();return}this.modeContainer&&(this.modeContainer.style.display="flex"),this.ensureModeControl(),this.renderTeamContent();}createTeamCard(){const t=x("div",{className:"team-card-wrapper"});this.modeContainer=x("div",{className:"team-card__mode-container"}),t.appendChild(this.modeContainer),this.teamContent=x("div",{className:"team-card__content"}),t.appendChild(this.teamContent);const n=dt({title:"Team",subtitle:"Organize and switch between pet teams",expandable:true,defaultExpanded:true},t);return this.card=n,n}ensureModeControl(){if(this.modeContainer){if(!this.modeControl){this.modeControl=Ui({segments:[{id:"overview",label:"Overview"},{id:"manage",label:"Manage"}],selected:this.teamMode,onChange:t=>{this.teamMode=t,this.renderTeamContent();}}),this.modeContainer.appendChild(this.modeControl);return}this.modeControl.getSelected()!==this.teamMode&&this.modeControl.select(this.teamMode);}}renderDisabledState(){if(!this.teamContent)return;this.dragHandler.cleanup(),this.listContainer=null,this.modeContainer&&(this.modeContainer.style.display="none");const t=x("div",{className:"team-card__disabled-state"}),n=x("div",{textContent:"Pet Team feature is disabled",className:"team-card__disabled-message"}),r=Ct({label:"Enable Feature",onClick:()=>{je.setEnabled(true),this.render();}});t.appendChild(n),t.appendChild(r),this.teamContent.replaceChildren(t);}renderTeamContent(){if(!this.teamContent)return;this.dragHandler.cleanup(),this.listContainer=null,this.teamContent.replaceChildren(),this.teamCheckboxes.forEach(r=>r.destroy()),this.teamCheckboxes.clear(),this.selectedTeamIds.clear();const t=je.getAllTeams(),n=je.getActiveTeamId();if(t.length===0){this.renderEmptyState();return}this.listContainer=x("div",{className:"team-card__list-container"}),t.forEach(r=>{const o=n===r.id;let i;this.teamMode==="manage"&&(i=this.createCheckboxIndicator(r.id));const a=JE({team:r,isActive:o,customIndicator:i?.root,hideDragHandle:this.teamMode==="manage",isNameEditable:this.teamMode==="manage",showSlotStyles:this.teamMode==="manage",onNameChange:s=>{this.handleRenameTeam(r.id,s);},onSlotClick:this.teamMode==="manage"?s=>{this.handleRemovePet(r.id,s);}:void 0});this.teamMode==="manage"&&a.classList.add("team-list-item--manage"),this.teamMode==="overview"&&(a.addEventListener("click",async s=>{if(!s.target.closest(".team-list-item__drag-handle")){a.classList.add("team-list-item--clicked"),setTimeout(()=>{a.classList.remove("team-list-item--clicked");},300);try{await je.activateTeam(r),this.options.onTeamsUpdated?.();}catch(c){console.error("[TeamCard] Failed to activate team:",c);}}}),a.addEventListener("pointerdown",s=>{if(s.button!==0)return;s.target.closest(".team-list-item__drag-handle")?this.dragHandler.startDrag(s,a,r.id):this.dragHandler.startLongPress(s,a,r.id);})),this.listContainer.appendChild(a);}),this.teamContent.appendChild(this.listContainer),this.teamMode==="manage"&&this.renderManageActions();}renderEmptyState(){if(!this.teamContent)return;const t=x("div",{textContent:"No teams yet. Create your first team!",className:"team-card__empty-state"});if(this.teamContent.appendChild(t),this.teamMode==="manage"){const n=x("div",{className:"team-card__actions"}),r=Ct({label:"New Team",variant:"primary",onClick:()=>{this.handleCreateTeam();}});n.appendChild(r),this.teamContent.appendChild(n);}}renderManageActions(){if(!this.teamContent)return;const t=x("div",{className:"team-card__actions"}),n=Ct({label:"New Team",variant:"primary",onClick:()=>{this.handleCreateTeam();}}),r=Ct({label:"Import from Aries",variant:"default",onClick:()=>{this.handleImportFromAries();}}),o=Ct({label:"Delete Team",variant:"danger",disabled:this.selectedTeamIds.size===0,onClick:()=>{this.handleDeleteTeam();}});o.setAttribute("data-action","delete-team"),t.appendChild(n),t.appendChild(r),t.appendChild(o),this.teamContent.appendChild(t);}handleCreateTeam(){const t="New Team";let n=t,r=1;const o=je.getAllTeams(),i=new Set(o.map(a=>a.name));for(;i.has(n);)n=`${t} (${r})`,r++;try{je.createTeam(n,[])&&(this.render(),this.options.onTeamsUpdated?.());}catch{}}handleDeleteTeam(){if(this.selectedTeamIds.size===0)return;const t=Array.from(this.selectedTeamIds);for(const n of t)je.deleteTeam(n);this.render(),this.options.onTeamsUpdated?.();}handleImportFromAries(){try{const t=je.importFromAries();t.success?(console.log(`[PetTeam] Successfully imported ${t.imported} team${t.imported===1?"":"s"} from Aries mod`),this.render(),this.options.onTeamsUpdated?.()):console.error("[PetTeam] Import failed:",t.errors.join(", "));}catch(t){console.error("[PetTeam] Import error:",t);}}handleRenameTeam(t,n){je.renameTeam(t,n),this.options.onTeamsUpdated?.();}handleRemovePet(t,n){const r=je.getTeam(t);if(!r)return;const o=r.petIds[n];!o||o===""?this.handleAddPet(t,n):this.handleRemovePetFromSlot(t,n);}handleRemovePetFromSlot(t,n){const r=je.getTeam(t);if(!r)return;const o=[...r.petIds];o[n]="",je.updateTeam(t,{petIds:o}),this.render(),this.options.onTeamsUpdated?.();}async handleAddPet(t,n){const r=je.getTeam(t);if(!r)return;const i=De.myPets.get().all.map(g=>({id:g.id,itemType:"Pet",petSpecies:g.petSpecies,name:g.name??null,xp:g.xp,hunger:g.hunger,mutations:g.mutations||[],targetScale:g.targetScale,abilities:g.abilities||[]})),a=new Set(r.petIds.filter(g=>g!=="")),s=i.filter(g=>!a.has(g.id));await rt.set("myPossiblyNoLongerValidSelectedItemIndexAtom",null);const l=Vt.detect();(l.platform==="mobile"||l.viewportWidth<768)&&this.options.setHUDOpen&&this.options.setHUDOpen(false);const d=De.myInventory.subscribeSelection(g=>{if(g.current&&g.current.item){const h=g.current.item,y=[...r.petIds];y[n]=h.id,je.updateTeam(t,{petIds:y}),this.options.onTeamsUpdated?.(),rt.set("myPossiblyNoLongerValidSelectedItemIndexAtom",null),eo.close().then(()=>{const S=Vt.detect();(S.platform==="mobile"||S.viewportWidth<768)&&this.options.setHUDOpen&&this.options.setHUDOpen(true),this.render(),this.options.onTeamsUpdated?.();});}});await eo.show("inventory",{items:s,favoritedItemIds:[]}),await eo.waitForClose();const u=Vt.detect();(u.platform==="mobile"||u.viewportWidth<768)&&this.options.setHUDOpen&&this.options.setHUDOpen(true),d();}createCheckboxIndicator(t){const n=af({checked:this.selectedTeamIds.has(t),size:"md",onChange:r=>{r?this.selectedTeamIds.add(t):this.selectedTeamIds.delete(t),this.updateDeleteButtonState();}});return this.teamCheckboxes.set(t,n),n}updateDeleteButtonState(){const t=this.teamContent?.querySelector('[data-action="delete-team"]');t&&(t.disabled=this.selectedTeamIds.size===0);}}class pU{constructor(t,n={}){de(this,"root");de(this,"pet");de(this,"options");de(this,"contentSlot",null);de(this,"isBuilt",false);this.pet=t,this.options=n,this.root=document.createElement("div"),this.root.className="base-pet-card",n.className&&this.root.classList.add(n.className);}build(){if(this.isBuilt)return this.root;this.updateStateClasses();const t=document.createElement("div");t.className="base-pet-card__left";const n=document.createElement("div");n.className="base-pet-card__sprite-wrapper",this.renderSprite(n),t.appendChild(n);const r=document.createElement("div");r.className="base-pet-card__info";const o=document.createElement("div");if(o.className="base-pet-card__name",o.textContent=this.pet.name||this.pet.petSpecies,r.appendChild(o),!this.options.hideStr){const i=document.createElement("div");i.className="base-pet-card__str",this.renderStr(i),r.appendChild(i);}return t.appendChild(r),this.root.appendChild(t),this.contentSlot=document.createElement("div"),this.contentSlot.className="base-pet-card__content",this.root.appendChild(this.contentSlot),this.options.onClick&&(this.root.style.cursor="pointer",this.root.addEventListener("click",()=>this.options.onClick?.(this.pet))),this.isBuilt=true,this.root}getContentSlot(){if(!this.contentSlot)throw new Error("BasePetCard must be built before getting slot");return this.contentSlot}update(t){if(this.pet=t,!this.isBuilt)return;this.updateStateClasses();const n=this.root.querySelector(".base-pet-card__name");n&&(n.textContent=t.name||t.petSpecies);const r=this.root.querySelector(".base-pet-card__str");r&&this.renderStr(r);const o=this.root.querySelector(".base-pet-card__sprite-wrapper");o instanceof HTMLElement&&this.renderSprite(o);}updateStateClasses(){this.root.classList.toggle("base-pet-card--max",this.pet.currentStrength>=this.pet.maxStrength),this.root.classList.toggle("base-pet-card--starving",(this.pet.hunger||0)===0);}renderStr(t){const r=this.pet.currentStrength>=this.pet.maxStrength?`MAX ${this.pet.maxStrength}`:`STR ${this.pet.currentStrength}/${this.pet.maxStrength}`;t.innerHTML="";const o=ts({label:r,type:"neutral",tone:"soft",size:"sm",pill:true});t.appendChild(o.root);}setCentered(t){this.root.classList.toggle("base-pet-card--centered",t);}renderSprite(t){t.innerHTML="";try{const n=this.pet.mutations||[];if(me.has("pet",this.pet.petSpecies)){const r=me.toCanvas("pet",this.pet.petSpecies,{mutations:n,scale:1,boundsMode:"padded"});r.style.width="64px",r.style.height="64px",r.style.objectFit="contain",t.appendChild(r);}else t.innerHTML='<div class="base-pet-card__sprite-fallback">🐾</div>';}catch{t.innerHTML='<div class="base-pet-card__sprite-fallback">🐾</div>';}}destroy(){this.root.remove(),this.contentSlot=null,this.isBuilt=false;}}const jt={XP:{BOOST_PAIR:.85,LEVELING_PAIR:.75,PASSIVE_LEVELING:.5,STR_DISTANCE_THRESHOLD:.15},ECONOMY:{DEDICATED_COIN:.9,META_SELLING:.85,PASSIVE_EFFICIENCY:.65,ENDGAME_HARVEST:.95,SYNERGY_BONUS:.1,EARLY_REGROW:.7},HATCHING:{TIER_3_MAX_STR:.95,RAINBOW_HUNTING:.7,COMBO_BONUS:.05},TIER_BONUS:.05,CONFIDENCE_THRESHOLD:.6},Pe={XP_BOOST:["PetXpBoost","PetXpBoostII","PetXpBoostIII","SnowyPetXpBoost"],COIN_FINDER:["CoinFinderI","CoinFinderII","CoinFinderIII","SnowyCoinFinder"],SELL_BOOST:["SellBoostI","SellBoostII","SellBoostIII","SellBoostIV"],CROP_REFUND_HARVEST:["ProduceRefund","DoubleHarvest"],PLANT_GROWTH:["PlantGrowthBoost","PlantGrowthBoostII","PlantGrowthBoostIII","SnowyPlantGrowthBoost"],CROP_SIZE:["ProduceScaleBoost","ProduceScaleBoostII","ProduceScaleBoostIII","SnowyCropSizeBoost"],CROP_MUTATION:["ProduceMutationBoost","ProduceMutationBoostII","ProduceMutationBoostIII","SnowyCropMutationBoost"],EGG_GROWTH:["EggGrowthBoost","EggGrowthBoostII_NEW","EggGrowthBoostII","SnowyEggGrowthBoost"],HUNGER_BOOST:["HungerBoost","HungerBoostII","HungerBoostIII","SnowyHungerBoost"],HUNGER_RESTORE:["HungerRestore","HungerRestoreII","HungerRestoreIII","SnowyHungerRestore"],RARE_GRANTERS:["FrostGranter","GoldGranter","RainbowGranter"],COMMON_GRANTERS:["RainDance","SnowGranter"],MAX_STR_BOOST:["PetHatchSizeBoost","PetHatchSizeBoostII","PetHatchSizeBoostIII"],HATCH_XP:["PetAgeBoost","PetAgeBoostII","PetAgeBoostIII"],PET_MUTATION:["PetMutationBoost","PetMutationBoostII","PetMutationBoostIII"],DOUBLE_HATCH:["DoubleHatch"],PET_REFUND:["PetRefund","PetRefundII"]},sf={ALLOWED_PANELS:{"xp-farming":["xp"],"coin-farming":["coin","xp","hatch"],"crop-farming":["growth","coin","xp","hatch"],"time-reduction":["growth","xp"],"mutation-hunting":["growth","coin","xp"],hatching:["hatch","xp"],efficiency:["xp"],balanced:["xp","growth","coin","hatch"],unknown:["xp","growth","coin","hatch"]}};function vn(e,t){return e.abilities.some(n=>t.includes(n))}function an(e,t){return e.filter(n=>vn(n,t)).length}function fU(e){return e.includes("IV")?4:e.includes("III")||e==="EggGrowthBoostII"?3:e.includes("II")||e.includes("_NEW")?2:1}function Os(e,t){const n=e.flatMap(r=>r.abilities.filter(o=>t.includes(o))).map(fU);return n.length===0?0:n.reduce((r,o)=>r+o,0)/n.length}function Ns(e){const t=yk(e);if(t.length===0)return {primary:"unknown",confidence:0,secondary:[],suggestedFeatures:[],reasons:["Team has no pets"]};const n=[],r={},o=an(t,Pe.XP_BOOST),i=jt.XP.STR_DISTANCE_THRESHOLD,s=t.filter(U=>U.maxStrength===0?false:(U.maxStrength-U.currentStrength)/U.maxStrength>i).length,l=t.filter(U=>U.currentStrength<U.maxStrength).length;if(o>=1&&s>=2)r["xp-farming"]=jt.XP.BOOST_PAIR,n.push(`1 XP Boost + ${s} high-need pets (>${i*100}% STR distance)`);else if(o>=2){const U=Os(t,Pe.XP_BOOST);r["xp-farming"]=jt.XP.LEVELING_PAIR+U*jt.TIER_BONUS,n.push(`${o} XP Boost pets (avg tier ${U.toFixed(1)})`);}else l>=2&&s>=1?(r["xp-farming"]=jt.XP.LEVELING_PAIR,n.push(`${l} leveling pets with ${s} high-need`)):l>=2&&(r["xp-farming"]=jt.XP.PASSIVE_LEVELING,n.push(`${l} pets below max STR`));const c=an(t,Pe.COIN_FINDER),d=an(t,Pe.SELL_BOOST),u=an(t,Pe.CROP_REFUND_HARVEST),f=an(t,Pe.RARE_GRANTERS),g=an(t,Pe.COMMON_GRANTERS),h=t.some(U=>vn(U,Pe.COIN_FINDER)&&(vn(U,Pe.RARE_GRANTERS)||vn(U,Pe.COMMON_GRANTERS)));c>=1&&!h?(r["coin-farming"]=jt.ECONOMY.DEDICATED_COIN,n.push("Dedicated Coin Finder team (no granters)")):d>=1&&u>=1?(r["coin-farming"]=jt.ECONOMY.META_SELLING,n.push("Meta Selling Team (Sell Boost + Crop Refund/Harvest)")):c>=1&&h?(r["coin-farming"]=jt.ECONOMY.PASSIVE_EFFICIENCY,r.efficiency=Math.max(r.efficiency||0,jt.ECONOMY.PASSIVE_EFFICIENCY),n.push("Coin Finder + Granter (passive efficiency)")):(d>=1||u>=1)&&(r["coin-farming"]=Math.max(r["coin-farming"]||0,.7),n.push("Sell/Refund abilities (coin efficiency)"));const y=an(t,Pe.PLANT_GROWTH),S=an(t,Pe.CROP_MUTATION),C=an(t,Pe.CROP_SIZE),_=t.filter(U=>U.abilities.includes("DoubleHarvest")).length,E=t.filter(U=>U.abilities.includes("ProduceRefund")).length,P=t.some(U=>U.abilities.includes("DoubleHarvest")&&U.abilities.includes("ProduceRefund"));if(_>=3){let U=jt.ECONOMY.ENDGAME_HARVEST;P&&(U+=jt.ECONOMY.SYNERGY_BONUS),r["crop-farming"]=Math.max(r["crop-farming"]||0,U),n.push("Endgame Harvest Team (3x Double Harvest)"+(P?" + capybara synergy":""));}else if(_>=1&&E>=1){let U=.85;P&&(U+=jt.ECONOMY.SYNERGY_BONUS),r["crop-farming"]=Math.max(r["crop-farming"]||0,U),n.push("Double Harvest + Crop Refund"+(P?" (same pet - capybara)":""));}else S>=1&&_===0&&(r["crop-farming"]=Math.max(r["crop-farming"]||0,jt.ECONOMY.EARLY_REGROW),n.push("Early Game Regrow Team (Crop Mutation)"));if(f>=1){const U=t.some(D=>D.abilities.includes("RainbowGranter")),X=t.some(D=>D.abilities.includes("GoldGranter"));U?(r["crop-farming"]=Math.max(r["crop-farming"]||0,.95),n.push("Rainbow Granter (ultra-rare, intentional)")):X?(r["crop-farming"]=Math.max(r["crop-farming"]||0,.9),n.push("Gold Granter (ultra-rare)")):(r["crop-farming"]=Math.max(r["crop-farming"]||0,.75),n.push("Frost Granter (rare mutation)"));}const O=y+S+C+g;if(O>=2&&!r["crop-farming"]){const U=(Os(t,Pe.PLANT_GROWTH)+Os(t,Pe.CROP_MUTATION)+Os(t,Pe.CROP_SIZE))/3;r["crop-farming"]=Math.max(r["crop-farming"]||0,.7+U*.03),n.push(`${O} crop-related abilities`);}const k=an(t,Pe.EGG_GROWTH);if(k>=1&&(r["time-reduction"]=.7,n.push(`${k} Egg Growth Boost pet(s)`)),y>=1&&!r["crop-farming"]&&(r["time-reduction"]=Math.max(r["time-reduction"]||0,.5),n.push("Plant Growth Boost (crop speed)")),f>=1||S>=1){const U=t.some(D=>D.abilities.includes("RainbowGranter")),X=t.some(D=>D.abilities.includes("GoldGranter"));U||X?(r["mutation-hunting"]=.95,n.push(`${U?"Rainbow":"Gold"} Granter (mutation focus)`)):S>=1&&(r["mutation-hunting"]=.8,n.push("Crop Mutation Boost (targeted hunting)"));}const I=an(t,Pe.HUNGER_BOOST),R=an(t,Pe.HUNGER_RESTORE);I>=1&&R>=1?(r.efficiency=.85,n.push("Hunger Boost + Hunger Restore (long-term setup)")):(I>=1||R>=1)&&(r.efficiency=.6,n.push("Hunger management (reduced feeding)"));const A=c+f+g;A>=2&&(r.efficiency=Math.max(r.efficiency||0,.6),n.push(`${A} passive abilities (passive gains)`));const L=an(t,Pe.MAX_STR_BOOST),F=an(t,Pe.HATCH_XP),G=an(t,Pe.PET_MUTATION),q=an(t,Pe.DOUBLE_HATCH),H=an(t,Pe.PET_REFUND);if(L>=1){const U=Os(t,Pe.MAX_STR_BOOST),X=U>=3?jt.HATCHING.TIER_3_MAX_STR:.85;r.hatching=X+U*jt.TIER_BONUS,n.push(`Max Strength Boost (tier ${U.toFixed(1)}) - late-game meta`);}if(G>=1||q>=1||H>=1){const U=G+q+H,X=jt.HATCHING.RAINBOW_HUNTING+U*jt.HATCHING.COMBO_BONUS;r.hatching=Math.max(r.hatching||0,X),n.push(`${U} rainbow hunting abilities`);}F>=1&&!r.hatching&&(r.hatching=.5,n.push("Hatch XP Boost (early-game focus)"));const ce=t.filter(U=>vn(U,Pe.MAX_STR_BOOST)||vn(U,Pe.PET_MUTATION)||vn(U,Pe.DOUBLE_HATCH)||vn(U,Pe.PET_REFUND)).length;ce>=Math.ceil(t.length*.67)&&r.hatching&&(r.hatching=Math.max(r.hatching,.97),r["crop-farming"]&&r["crop-farming"]<.97&&t.filter(X=>(vn(X,Pe.CROP_REFUND_HARVEST)||vn(X,Pe.CROP_SIZE)||vn(X,Pe.CROP_MUTATION))&&!vn(X,Pe.PET_REFUND)&&!vn(X,Pe.DOUBLE_HATCH)&&!vn(X,Pe.PET_MUTATION)&&!vn(X,Pe.MAX_STR_BOOST)).length===0&&(delete r["crop-farming"],n.push("Suppressed crop-farming (hatching majority override)")),n.push(`Hatching Majority (${ce}/${t.length} pets) - clear team purpose`));const W=Object.entries(r).sort(([,U],[,X])=>X-U);if(W.length===0)return {primary:"balanced",confidence:.3,secondary:[],suggestedFeatures:["xp","growth","coin","hatch"],reasons:["Mixed or unclear purpose"]};const[te,ne]=W[0],ie=W.slice(1).map(([U,X])=>({purpose:U,confidence:X}));return ne<jt.CONFIDENCE_THRESHOLD?{primary:"balanced",confidence:ne,secondary:W.map(([U,X])=>({purpose:U,confidence:X})),suggestedFeatures:["xp","growth","coin","hatch"],reasons:[...n,`Low confidence (${(ne*100).toFixed(0)}%) - showing all panels`]}:{primary:te,confidence:ne,secondary:ie,suggestedFeatures:{"xp-farming":["xp"],"coin-farming":["coin","growth","xp"],"crop-farming":["growth","coin","xp"],"time-reduction":["growth","xp"],"mutation-hunting":["growth","coin","xp"],efficiency:["xp"],hatching:["hatch","growth","xp"],balanced:["xp","growth","coin","hatch"],unknown:["xp","growth","coin","hatch"]}[te]||["xp","growth","coin","hatch"],reasons:n}}async function hU(){try{const e=window.AudioContext||window.webkitAudioContext;if(!e)return;const t=new e,n=t.currentTime,r=t.createOscillator(),o=t.createGain();r.connect(o),o.connect(t.destination),r.type="sine",r.frequency.setValueAtTime(800,n),r.frequency.exponentialRampToValueAtTime(400,n+.03),o.gain.setValueAtTime(.12,n),o.gain.exponentialRampToValueAtTime(.001,n+.05),r.start(n),r.stop(n+.05),setTimeout(()=>t.close(),100);}catch{}}function gU(e={}){const{id:t,variant:n="default",size:r="md",round:o=false,sprite:i=null,onClick:a,disabled:s=false,playSound:l=true,tooltip:c}=e,d=x("button",{className:"gemini-icon-btn",id:t});d.type="button",n!=="default"&&d.classList.add(`gemini-icon-btn--${n}`),r!=="md"&&d.classList.add(`gemini-icon-btn--${r}`),o&&d.classList.add("gemini-icon-btn--round"),c&&(d.title=c),d.disabled=s;const u=x("span",{className:"gemini-icon-btn__content"});d.appendChild(u),i&&u.appendChild(i);const f=x("span",{className:"gemini-icon-btn__swap"});f.textContent="⇄",d.appendChild(f),d.addEventListener("click",async h=>{d.disabled||(l&&hU(),a?.(h));});const g=d;return g.setSprite=h=>{u.innerHTML="",h&&u.appendChild(h);},g.setVariant=h=>{d.classList.remove("gemini-icon-btn--default","gemini-icon-btn--plant","gemini-icon-btn--egg"),h!=="default"&&d.classList.add(`gemini-icon-btn--${h}`);},g.setDisabled=h=>{d.disabled=h;},g}const QE=`
/* ═══════════════════════════════════════════════════════════════════════════
   GEMINI ICON BUTTON - Raised Icon Button with Glassmorphism
   Design: Modern glass panel with colored 3D base shadow and satisfying press
   ═══════════════════════════════════════════════════════════════════════════ */

.gemini-icon-btn {
    /* Reset */
    appearance: none;
    border: none;
    cursor: pointer;
    font-family: inherit;
    
    /* Size */
    position: relative;
    width: 40px;
    height: 36px;
    padding: 0;
    flex-shrink: 0;
    
    /* CSS variable for colored 3D base - can be overridden by variants */
    --btn-base-color: color-mix(in oklab, var(--accent) 70%, black);
    
    /* Glassmorphism Background */
    background: linear-gradient(
        180deg,
        color-mix(in oklab, white 10%, color-mix(in oklab, var(--soft) 90%, transparent)) 0%,
        color-mix(in oklab, var(--soft) 75%, transparent) 50%,
        color-mix(in oklab, var(--soft) 60%, transparent) 100%
    );
    
    /* Simple border */
    border: 1px solid color-mix(in oklab, var(--border) 60%, transparent);
    border-radius: 10px;
    
    /* 3D RAISED EFFECT - Hard-edged shadow offset to bottom-right */
    box-shadow: 
        /* Hard edge creates visible "base" on bottom and right */
        2px 2px 0 0 var(--btn-base-color),
        /* Soft diffuse shadow for depth */
        3px 3px 6px color-mix(in oklab, var(--shadow) 25%, transparent),
        /* Inner top highlight */
        inset 0 1px 1px color-mix(in oklab, white 12%, transparent);
    
    /* Smooth Transitions */
    transition: 
        transform 0.1s cubic-bezier(0.34, 1.56, 0.64, 1),
        box-shadow 0.1s ease-out,
        border-color 0.2s ease,
        background 0.15s ease,
        filter 0.15s ease;
    
    -webkit-tap-highlight-color: transparent;
}

/* ─────────────────────────────────────────────────────────────────────────────
   CONTENT - Sprite/Icon Container
   ───────────────────────────────────────────────────────────────────────────── */

.gemini-icon-btn__content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    pointer-events: none;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 22px;
    height: 22px;
    overflow: hidden;
    z-index: 1;
    transition: transform 0.1s ease-out;
}

.gemini-icon-btn canvas {
    image-rendering: pixelated;
    display: block;
    max-width: 100%;
    max-height: 100%;
}

/* ─────────────────────────────────────────────────────────────────────────────
   SWAP INDICATOR - Bottom-right badge showing this is a toggle button
   ───────────────────────────────────────────────────────────────────────────── */

.gemini-icon-btn__swap {
    position: absolute;
    bottom: 1px;
    right: 1px;
    
    /* Sizing */
    width: 14px;
    height: 14px;
    
    /* No background - just the symbol */
    background: transparent;
    border-radius: 0;
    
    /* Text styling - visible against button */
    font-size: 10px;
    font-weight: 700;
    line-height: 14px;
    text-align: center;
    color: var(--fg);
    opacity: 0.7;
    text-shadow: 
        0 1px 0 color-mix(in oklab, var(--bg) 80%, transparent),
        0 0 3px color-mix(in oklab, var(--bg) 60%, transparent);
    
    /* Don't interfere with clicks */
    pointer-events: none;
    
    /* Smooth transitions */
    transition: 
        transform 0.15s ease,
        opacity 0.15s ease;
    
    z-index: 2;
}

/* Hover: indicator becomes more visible */
.gemini-icon-btn:hover:not(:disabled) .gemini-icon-btn__swap {
    opacity: 1;
    transform: scale(1.1);
}

/* Pressed: indicator follows button */
.gemini-icon-btn:active:not(:disabled) .gemini-icon-btn__swap {
    opacity: 0.8;
    transform: scale(0.95);
}

/* ─────────────────────────────────────────────────────────────────────────────
   STATES
   ───────────────────────────────────────────────────────────────────────────── */

/* Hover - lifts button, shadow grows */
.gemini-icon-btn:hover:not(:disabled) {
    transform: translate(-1px, -1px);
    border-color: color-mix(in oklab, var(--accent) 35%, var(--border));
    box-shadow: 
        /* Shadow grows as button lifts */
        4px 4px 0 0 var(--btn-base-color),
        5px 5px 10px color-mix(in oklab, var(--shadow) 30%, transparent),
        inset 0 1px 1px color-mix(in oklab, white 15%, transparent);
    filter: brightness(1.04);
}

/* Pressed - button sinks, shadow collapses */
.gemini-icon-btn:active:not(:disabled) {
    transform: translate(1px, 1px);
    transition: 
        transform 0.05s ease-out,
        box-shadow 0.05s ease-out,
        background 0.05s ease;
    box-shadow: 
        /* Shadow nearly gone - button pressed flat */
        1px 1px 0 0 var(--btn-base-color),
        2px 2px 4px color-mix(in oklab, var(--shadow) 20%, transparent),
        inset 0 1px 2px color-mix(in oklab, black 8%, transparent);
    filter: brightness(0.96);
    background: linear-gradient(
        180deg,
        color-mix(in oklab, var(--soft) 78%, transparent) 0%,
        color-mix(in oklab, var(--soft) 68%, transparent) 50%,
        color-mix(in oklab, var(--soft) 58%, transparent) 100%
    );
}

/* Disabled */
.gemini-icon-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    filter: saturate(0.9);
}

/* Focus ring */
.gemini-icon-btn:focus-visible {
    outline: none;
    box-shadow: 
        0 0 0 2px color-mix(in oklab, var(--accent) 50%, transparent),
        3px 3px 0 0 var(--btn-base-color),
        4px 4px 8px color-mix(in oklab, var(--shadow) 30%, transparent);
}

/* ═══════════════════════════════════════════════════════════════════════════
   VARIANTS - Override the base color for different button types
   ═══════════════════════════════════════════════════════════════════════════ */

/* Plant variant - green/cyan base */
.gemini-icon-btn--plant {
    --btn-base-color: color-mix(in oklab, var(--high) 60%, black);
    background: linear-gradient(
        180deg,
        color-mix(in oklab, white 8%, color-mix(in oklab, var(--high) 15%, color-mix(in oklab, var(--soft) 90%, transparent))) 0%,
        color-mix(in oklab, var(--high) 10%, color-mix(in oklab, var(--soft) 75%, transparent)) 50%,
        color-mix(in oklab, var(--high) 8%, color-mix(in oklab, var(--soft) 60%, transparent)) 100%
    );
    border-color: color-mix(in oklab, var(--high) 25%, var(--border));
}

.gemini-icon-btn--plant:hover:not(:disabled) {
    border-color: color-mix(in oklab, var(--high) 45%, var(--border));
}

/* Egg variant - purple base */
.gemini-icon-btn--egg {
    --btn-base-color: color-mix(in oklab, var(--accent-2) 60%, black);
    background: linear-gradient(
        180deg,
        color-mix(in oklab, white 8%, color-mix(in oklab, var(--accent-2) 15%, color-mix(in oklab, var(--soft) 90%, transparent))) 0%,
        color-mix(in oklab, var(--accent-2) 10%, color-mix(in oklab, var(--soft) 75%, transparent)) 50%,
        color-mix(in oklab, var(--accent-2) 8%, color-mix(in oklab, var(--soft) 60%, transparent)) 100%
    );
    border-color: color-mix(in oklab, var(--accent-2) 25%, var(--border));
}

.gemini-icon-btn--egg:hover:not(:disabled) {
    border-color: color-mix(in oklab, var(--accent-2) 45%, var(--border));
}

/* ═══════════════════════════════════════════════════════════════════════════
   SIZE VARIANTS
   ═══════════════════════════════════════════════════════════════════════════ */

.gemini-icon-btn--sm {
    width: 32px;
    height: 28px;
    border-radius: 8px;
}

.gemini-icon-btn--sm .gemini-icon-btn__content {
    width: 18px;
    height: 18px;
}

.gemini-icon-btn--lg {
    width: 48px;
    height: 44px;
    border-radius: 12px;
}

.gemini-icon-btn--lg .gemini-icon-btn__content {
    width: 26px;
    height: 26px;
}

/* ═══════════════════════════════════════════════════════════════════════════
   CIRCULAR VARIANT
   ═══════════════════════════════════════════════════════════════════════════ */

.gemini-icon-btn--round {
    width: 38px;
    height: 38px;
    border-radius: 50%;
}

.gemini-icon-btn--round.gemini-icon-btn--sm {
    width: 30px;
    height: 30px;
}

.gemini-icon-btn--round.gemini-icon-btn--lg {
    width: 46px;
    height: 46px;
}
`;class mU{constructor(){de(this,"card",null);de(this,"listContainer",null);de(this,"innerContent",null);de(this,"logs",[]);de(this,"filteredLogs",[]);de(this,"unsubscribe",null);de(this,"ITEM_HEIGHT",88);de(this,"BUFFER_SIZE",3);de(this,"VIEWPORT_HEIGHT",480);de(this,"renderedRange",{start:0,end:0});de(this,"scrollListener",null);de(this,"scrollScheduled",false);}build(){return this.card?this.card:this.createAbilityLogsCard()}destroy(){this.scrollListener&&this.listContainer&&(this.listContainer.removeEventListener("scroll",this.scrollListener),this.scrollListener=null),this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null),this.card=null,this.listContainer=null,this.innerContent=null,this.logs=[],this.filteredLogs=[];}async render(){const t=po(),n=t.get().abilityLogs;this.updateFromAbilityLogs(n),this.unsubscribe=t.subscribeAbility(()=>{const r=t.get().abilityLogs;this.updateFromAbilityLogs(r);});}updateFromAbilityLogs(t){if(!t||!Array.isArray(t)){this.logs=[],this.filteredLogs=[],this.updateList();return}this.logs=t.map(n=>{const i=ue.get("abilities")?.[n.abilityId]?.name||n.abilityId||"Unknown Ability",a={action:n.abilityId,timestamp:n.performedAt,parameters:n.data||{}},s=EC(a),l=new Date(n.performedAt),c=l.toLocaleDateString("en-US",{month:"short",day:"numeric"}),d=l.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),u=`${c} ${d}`;return {timestamp:n.performedAt,petName:n.petName,petSpecies:n.petSpecies,abilityName:i,abilityId:n.abilityId,description:s,formattedDate:u}}),this.filteredLogs=[...this.logs],this.updateList();}createAbilityBadge(t,n){return ts({variant:"ability",abilityId:t,abilityName:n}).root}createAbilityLogsCard(){const t=x("div",{className:"ability-logs-container",style:"display: flex; flex-direction: column; gap: 12px;"}),n=x("div",{style:"margin-bottom: 0;"}),r=es({placeholder:"Search logs...",value:"",debounceMs:150,withClear:true,size:"sm",focusKey:"",onChange:o=>{const i=o.trim().toLowerCase();i?this.filteredLogs=this.logs.filter(a=>a.petName.toLowerCase().includes(i)||a.petSpecies.toLowerCase().includes(i)||a.abilityName.toLowerCase().includes(i)||a.description.toLowerCase().includes(i)):this.filteredLogs=[...this.logs],this.updateList();}});return n.appendChild(r.root),t.appendChild(n),this.listContainer=x("div",{className:"ability-logs-list",style:"max-height: 480px; overflow-y: auto; overflow-x: hidden; position: relative;"}),this.innerContent=x("div",{style:"display: flex; flex-direction: column; gap: 8px; position: relative;"}),this.listContainer.appendChild(this.innerContent),this.scrollListener=()=>{this.scrollScheduled||(this.scrollScheduled=true,requestAnimationFrame(()=>{this.handleScroll(),this.scrollScheduled=false;}));},this.listContainer.addEventListener("scroll",this.scrollListener),t.appendChild(this.listContainer),this.card=dt({title:"Ability Logs",subtitle:"Track all pet ability activations",expandable:true,defaultExpanded:true},t),this.card}updateList(){if(!this.listContainer||!this.innerContent)return;this.innerContent.replaceChildren(),this.renderedRange={start:0,end:0};const t=[...this.filteredLogs].sort((n,r)=>r.timestamp-n.timestamp);if(t.length===0){const n=x("div",{className:"ability-logs-empty",style:"padding: 24px; text-align: center; color: color-mix(in oklab, var(--fg) 60%, #9ca3af); font-size: 14px;"},"No ability logs yet");this.innerContent.appendChild(n);return}this.filteredLogs=t,this.listContainer.scrollTop=0,this.handleScroll();}handleScroll(){if(!this.listContainer||!this.innerContent)return;const t=this.listContainer.scrollTop,n=Math.ceil(this.VIEWPORT_HEIGHT/this.ITEM_HEIGHT);let r=Math.max(0,Math.floor(t/this.ITEM_HEIGHT)-this.BUFFER_SIZE),o=Math.min(this.filteredLogs.length,r+n+this.BUFFER_SIZE*2);if(r===this.renderedRange.start&&o===this.renderedRange.end)return;this.renderedRange={start:r,end:o},this.innerContent.replaceChildren();const i=r*this.ITEM_HEIGHT;if(i>0){const s=x("div",{style:`height: ${i}px; flex-shrink: 0;`});this.innerContent.appendChild(s);}for(let s=r;s<o;s++){const l=this.filteredLogs[s],c=this.createLogItemCard(l);this.innerContent.appendChild(c);}const a=Math.max(0,(this.filteredLogs.length-o)*this.ITEM_HEIGHT);if(a>0){const s=x("div",{style:`height: ${a}px; flex-shrink: 0;`});this.innerContent.appendChild(s);}}createLogItemCard(t){const n=x("div",{className:"ability-log-item",style:"background: var(--soft); border: 1px solid var(--border); border-radius: 8px; padding: 12px; display: flex; gap: 12px; align-items: center; transition: all 0.2s ease;"});n.addEventListener("pointerenter",function(){this.style.background="color-mix(in oklab, var(--soft) 90%, var(--fg) 10%)",this.style.borderColor="color-mix(in oklab, var(--border) 70%, var(--fg) 30%)";}),n.addEventListener("pointerleave",function(){this.style.background="var(--soft)",this.style.borderColor="var(--border)";});const r=x("div",{style:"width: 40px; height: 40px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; background: var(--muted); border-radius: 6px;"});try{const d=me.toCanvas("pet",t.petSpecies);d&&(d.style.width="100%",d.style.height="100%",d.style.objectFit="contain",r.appendChild(d));}catch{r.textContent="🐾",r.style.fontSize="24px";}n.appendChild(r);const o=x("div",{style:"flex: 1; min-width: 0; display: flex; flex-direction: column; gap: 4px;"}),i=x("div",{style:"display: flex; align-items: center; justify-content: space-between; gap: 8px;"}),a=x("div",{style:"font-size: 14px; font-weight: 700; color: var(--fg); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"},t.petName),s=x("div",{style:"font-size: 11px; font-weight: 500; color: color-mix(in oklab, var(--fg) 60%, #9ca3af); white-space: nowrap;"},t.formattedDate);i.appendChild(a),i.appendChild(s),o.appendChild(i);const l=this.createAbilityBadge(t.abilityId,t.abilityName);o.appendChild(l);const c=x("div",{style:"font-size: 12px; color: color-mix(in oklab, var(--fg) 70%, #9ca3af); line-height: 1.4; overflow: hidden; text-overflow: ellipsis;"},t.description);return o.appendChild(c),n.appendChild(o),n}}const ZE=`
.team-card-wrapper {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.team-card__mode-container {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
}

.team-card__content {
    display: flex;
    flex-direction: column;
    gap: 12px;
    width: 100%;
}

.team-card__disabled-state {
    text-align: center;
}

.team-card__disabled-message {
    color: var(--muted);
    font-size: 14px;
    margin-bottom: 12px;
}

.team-card__empty-state {
    color: var(--muted);
    text-align: center;
    font-size: 14px;
}

.team-card__list-container {
    display: flex;
    flex-direction: column;
    position: relative;
    width: 100%;
}

.team-card__list-container.is-reordering {
    /* Active reordering state */
}

.team-card__actions {
    display: flex;
    gap: 12px;
    justify-content: center;
    width: 100%;
}

/* ═══════════════════════════════════════════════════════════════════════════
   EXPAND BUTTON
   ═══════════════════════════════════════════════════════════════════════════ */

.team-list-item__expand {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 6px;
    margin-left: 8px;
    background: transparent;
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--muted);
    cursor: pointer;
    transition: all 0.2s ease;
    flex-shrink: 0;
}

.team-list-item__expand:hover {
    background: var(--soft);
    color: var(--fg);
    border-color: var(--accent);
}

.team-list-item__expand svg {
    transition: transform 0.2s ease;
}

.team-list-item__expand--open svg {
    transform: rotate(180deg);
}

/* ═══════════════════════════════════════════════════════════════════════════
   EXPANDED CONTAINER - 1 per team with 3 pet rows
   ═══════════════════════════════════════════════════════════════════════════ */

.team-expanded-container {
    display: flex;
    flex-direction: column;
    gap: 8px;
    padding: 12px;
    margin: 0 8px 8px 8px;
    background: linear-gradient(145deg, var(--soft), var(--bg));
    border: 1px solid var(--border);
    border-radius: 12px;
    animation: expandSlideIn 0.25s ease-out;
}

@keyframes expandSlideIn {
    from {
        opacity: 0;
        transform: translateY(-8px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
    margin: 4px 12px 12px 12px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
    animation: slideDown 0.3s ease-out;
    display: flex;
    flex-direction: column;
}

@keyframes slideDown {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* ═══════════════════════════════════════════════════════════════════════════
   PET ROW - Individual row with header + content
   ═══════════════════════════════════════════════════════════════════════════ */

.expanded-pet-row {
    display: flex;
    flex-direction: column;
    padding: 0 12px 14px 12px;
}

.expanded-pet-row:first-of-type {
    padding-top: 8px;
}

.pet-row__header {
    display: flex;
    align-items: center;
    background: var(--tab-bg);
    padding: 6px 12px;
    gap: 8px;
    border: 1px solid var(--border);
    border-top-left-radius: 12px;
    border-top-right-radius: 12px;
    border-bottom: none;
    margin-bottom: 0;
}

.expanded-pet-row .base-pet-card {
    border-top-left-radius: 0;
    border-top-right-radius: 0;
}

.pet-row__nav {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--fg);
    font-size: 14px;
    font-weight: 800;
    cursor: pointer;
    transition: all 0.15s ease;
    flex-shrink: 0;
}

.pet-row__nav:hover {
    background: var(--soft);
    border-color: var(--pill-to);
    transform: scale(1.05);
}

.pet-label {
    flex: 1;
    text-align: center;
    font-size: 11px;
    font-weight: 800;
    color: var(--fg);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    opacity: 0.8;
}

/* ═══════════════════════════════════════════════════════════════════════════
   FEATURE CARD - Individual Pet Feature Display
   ═══════════════════════════════════════════════════════════════════════════ */

.feature-card {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 10px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    min-height: 200px;
}

.feature-card__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 10px;
    background: linear-gradient(90deg, var(--accent), var(--pill-to));
    border-bottom: 1px solid var(--border);
    gap: 4px;
}

.feature-card__label {
    flex: 1;
    text-align: center;
    font-size: 11px;
    font-weight: 700;
    color: var(--fg);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.feature-card__nav {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 4px;
    color: var(--fg);
    font-size: 12px;
    font-weight: 800;
    cursor: pointer;
    transition: all 0.15s ease;
    flex-shrink: 0;
}

.feature-card__nav:hover {
    background: var(--soft);
    border-color: var(--pill-to);
}

.feature-card__content {
    flex: 1;
    padding: 10px;
    background: var(--soft);
    overflow-y: auto;
    max-height: 280px;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
}

.feature-card__content::-webkit-scrollbar {
    width: 4px;
}

.feature-card__content::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 2px;
}

/* ═══════════════════════════════════════════════════════════════════════════
   RESPONSIVE - Mobile Layout
   ═══════════════════════════════════════════════════════════════════════════ */

@media (max-width: 768px) {
    .team-expanded-cards {
        grid-template-columns: 1fr;
        gap: 8px;
        padding: 10px;
        margin: 0 4px 6px 4px;
    }

    .feature-card {
        min-height: 160px;
    }

    .feature-card__content {
        max-height: 220px;
    }
}

@media (max-width: 480px) {
    .team-list-item__expand {
        padding: 4px;
    }

    .feature-card__header {
        padding: 6px 8px;
    }

    .feature-card__label {
        font-size: 10px;
    }

    .feature-card__nav {
        width: 20px;
        height: 20px;
        font-size: 10px;
    }

    .feature-card__content {
        padding: 8px;
        max-height: 180px;
    }
}

/* ═══════════════════════════════════════════════════════════════════════════
   TEAM PROGRESS
   ═══════════════════════════════════════════════════════════════════════════ */

.team-progress-bar {
    position: relative;
    height: 16px;
    background: var(--border);
    border-radius: 8px;
    margin: 10px 12px 6px 12px;
    overflow: hidden;
    border: 1px solid var(--border);
    flex-shrink: 0;
}

.team-progress-bar__fill {
    height: 100%;
    border-radius: 7px;
    transition: width 0.3s ease;
}

/* Color coding for team progress bar */
.team-progress-bar__fill--low {
    background: linear-gradient(90deg, var(--low), var(--medium));
}
.team-progress-bar__fill--medium {
    background: linear-gradient(90deg, var(--medium), var(--high));
}
.team-progress-bar__fill--high {
    background: linear-gradient(90deg, var(--high), var(--complete));
}

.team-progress-bar__percent {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 10px;
    font-weight: 800;
    color: var(--fg);
    text-shadow: 0 1px 2px rgba(0,0,0,0.4);
    pointer-events: none;
}

/* BasePetCard provides its own mobile responsiveness. We only need minimal 
   overrides for the team-level containers if necessary. */

@media (max-width: 480px) {
    .team-expanded-container {
        margin: 4px 6px 8px 6px;
    }
    
    .team-progress-bar {
        pointer-events: none;
        z-index: 5;
    }

    .feature-card__header {
        padding: 6px 8px;
    }

    .feature-card__nav {
        width: 22px;
        height: 22px;
        font-size: 10px;
    }
}

/* 320px devices */
@media (max-width: 360px) {
    .pet-row__content {
        padding: 8px;
    }
    
    .xp-stat__label {
        font-size: 9px;
    }
}

`,e1=`
/* ═══════════════════════════════════════════════════════════════════════════
   BASE PET CARD - The Shell
   ═══════════════════════════════════════════════════════════════════════════ */

.base-pet-card {
    display: flex;
    align-items: stretch;
    gap: 16px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 12px;
    transition: all 0.2s ease;
    position: relative;
}

.base-pet-card--max {
    background: var(--bg);
}

.base-pet-card--starving {
    border-color: var(--low);
    background: linear-gradient(135deg, var(--soft), var(--bg));
}

.base-pet-card--centered {
    justify-content: center;
}

.base-pet-card--centered .base-pet-card__left {
    min-width: unset;
}

.base-pet-card--centered .base-pet-card__content {
    display: none;
}

/* ═══════════════════════════════════════════════════════════════════════════
   GROUPED PET CARD - Bundled sprites for 2-3 matching pets
   ═══════════════════════════════════════════════════════════════════════════ */

.base-pet-card--grouped,
.base-pet-card--grouped-2 {
    /* Grouped state inherits base card styles */
}

.base-pet-card--grouped .base-pet-card__left,
.base-pet-card--grouped-2 .base-pet-card__left {
    min-width: 110px;
}

/* Grouped sprite container with overlapping triad/duo formation */
.grouped-sprite-container {
    position: relative;
    width: 100px;
    height: 68px;
    display: flex;
    align-items: center;
    justify-content: center;
    /* No background - just sprites */
    overflow: visible;
}

.grouped-sprite-container canvas {
    position: absolute;
    /* Natural sizing - don't stretch */
    width: auto !important;
    height: auto !important;
    max-width: 56px;
    max-height: 56px;
    image-rendering: pixelated;
}

/* 3-pet triad formation - less vertical overlap, more horizontal spread */
.grouped-sprite-container canvas:nth-child(1) { z-index: 3; left: 24px; top: 4px; }
.grouped-sprite-container canvas:nth-child(2) { z-index: 2; left: -4px; top: 12px; }
.grouped-sprite-container canvas:nth-child(3) { z-index: 1; left: 52px; top: 12px; }

/* 2-pet duo formation - more horizontal spread */
.grouped-sprite-container--duo canvas:nth-child(1) { left: 6px; top: 4px; z-index: 2; }
.grouped-sprite-container--duo canvas:nth-child(2) { left: 46px; top: 4px; z-index: 1; }

/* Stacked badges in horizontal row matching sprite layout */
.grouped-badges {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    justify-content: center;
    margin-top: 4px;
    width: 100%;
}

.grouped-badges .badge {
    font-size: 8px !important;
    padding: 2px 5px !important;
    background: var(--pill-to);
    color: var(--pill-from);
    text-shadow: 
        -1px -1px 0 rgba(0, 0, 0, 0.8),
        1px -1px 0 rgba(0, 0, 0, 0.8),
        -1px 1px 0 rgba(0, 0, 0, 0.8),
        1px 1px 0 rgba(0, 0, 0, 0.8) !important;
    border: none;
    border-radius: 8px;
    white-space: nowrap;
}


/* ═══════════════════════════════════════════════════════════════════════════
   LEFT SECTION - Sprite & Identity
   ═══════════════════════════════════════════════════════════════════════════ */

.base-pet-card__left {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    min-width: 80px;
    flex-shrink: 0;
}

.base-pet-card__sprite-wrapper {
    width: 64px;
    height: 64px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--soft);
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
}

.base-pet-card__sprite-wrapper canvas {
    image-rendering: pixelated;
}

.base-pet-card__info {
    text-align: center;
    display: flex;
    flex-direction: column;
    gap: 2px;
    width: 100%;
}

.base-pet-card__name {
    font-size: 11px;
    font-weight: 800;
    color: var(--pill-to);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 80px;
}

.base-pet-card__str {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
    font-size: 10px;
    font-weight: 700;
}

.base-str__label { color: var(--muted); }
.base-str__current { 
    color: var(--pill-to); 
    font-weight: 800; 
    text-shadow: 
        -1px -1px 0 rgba(0, 0, 0, 0.8),
        1px -1px 0 rgba(0, 0, 0, 0.8),
        -1px 1px 0 rgba(0, 0, 0, 0.8),
        1px 1px 0 rgba(0, 0, 0, 0.8);
}
.base-str__max { 
    color: var(--muted); 
    text-shadow: 
        -1px -1px 0 rgba(0, 0, 0, 0.8),
        1px -1px 0 rgba(0, 0, 0, 0.8),
        -1px 1px 0 rgba(0, 0, 0, 0.8),
        1px 1px 0 rgba(0, 0, 0, 0.8);
}

/* ═══════════════════════════════════════════════════════════════════════════
   RIGHT SECTION - The Content Slot (Stat Grid Protocol)
   ═══════════════════════════════════════════════════════════════════════════ */

.base-pet-card__content {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 6px;
    justify-content: center;
    min-width: 0;
}

/* THE STAT GRID PROTOCOL */
.stat-row {
    display: flex;
    align-items: center;
    gap: 8px;
    width: 100%;
    min-height: 20px;
}

.stat-row--boost {
    border-radius: 4px;
    padding: 2px 0;
    margin-bottom: 2px;
}

.stat__label {
    font-size: 10px;
    font-weight: 800;
    color: var(--pill-to);
    min-width: 65px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.stat__value {
    font-size: 12px;
    font-weight: 700;
    color: var(--fg);
    white-space: nowrap;
}

.stat__value--accent {
    color: var(--pill-from);
}

.stat__timer {
    font-family: monospace;
    font-size: 12px;
    color: var(--pill-from);
    min-width: 45px;
}

.stat__feeds {
    font-size: 11px;
    color: var(--pill-from);
    min-width: 40px;
    text-align: right;
    display: inline-flex;
    align-items: center;
    gap: 4px;
}

.stat__feeds canvas {
    display: block;
    image-rendering: pixelated;
}

.stat__progress-mini {
    position: relative; /* For absolute percent positioning */
    flex: 1;
    height: 8px;
    background: var(--border);
    border-radius: 4px;
    overflow: visible; /* Allow percent to show */
    margin: 0 4px;
    min-width: 60px;
}

.stat__progress-fill {
    height: 100%;
    border-radius: 3px;
    transition: width 0.3s ease;
}

/* Solid blue for XP progress bars */
.stat__progress-fill--xp {
    background: var(--pill-to);
}

/* Gray for secondary progress (max STR) */
.stat__progress-fill--xp-secondary {
    background: var(--muted);
}

/* Legacy color variants (for non-XP usage) */
.stat__progress-fill--low { background: linear-gradient(90deg, var(--low), var(--medium)); }
.stat__progress-fill--medium { background: linear-gradient(90deg, var(--medium), var(--high)); }
.stat__progress-fill--high { background: linear-gradient(90deg, var(--high), var(--complete)); }

/* Growth panel: green for plants */
.stat__progress-fill--plant {
    background: linear-gradient(90deg, var(--accent-1), color-mix(in oklab, var(--accent-1) 70%, white));
}

/* Growth panel: purple for eggs */
.stat__progress-fill--egg {
    background: linear-gradient(90deg, var(--accent-2), color-mix(in oklab, var(--accent-2) 70%, white));
}

/* STR label inline with progress bar - supports both text and sprites */
.stat__str-label {
    font-size: 10px;
    font-weight: 700;
    color: var(--pill-to);
    white-space: nowrap;
    min-width: 50px;
    display: inline-flex;
    align-items: center;
    gap: 2px;
}

/* Canvas sprites within stat rows */
.stat__str-label canvas {
    display: block;
    image-rendering: pixelated;
    vertical-align: middle;
}

.stat__percent {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    font-size: 10px;
    font-weight: 800;
    color: var(--accent);
    text-shadow:
        -1px -1px 0 rgba(0, 0, 0, 0.8),
        1px -1px 0 rgba(0, 0, 0, 0.8),
        -1px 1px 0 rgba(0, 0, 0, 0.8),
        1px 1px 0 rgba(0, 0, 0, 0.8);
    pointer-events: none;
    z-index: 2;
}

/* Badge Override for Pet Card */
.base-pet-card .badge {
    background: var(--pill-to);
    color: var(--pill-from);
    text-shadow: 
        -1px -1px 0 rgba(0, 0, 0, 0.8),
        1px -1px 0 rgba(0, 0, 0, 0.8),
        -1px 1px 0 rgba(0, 0, 0, 0.8),
        1px 1px 0 rgba(0, 0, 0, 0.8) !important;
    border: none;
    font-size: 11px;
    padding: 3px 10px;
    height: auto;
}

/* ═══════════════════════════════════════════════════════════════════════════
   RESPONSIVE
   ═══════════════════════════════════════════════════════════════════════════ */

@media (max-width: 480px) {
    .base-pet-card {
        flex-direction: column;
        align-items: center;
        padding: 10px;
    }
    
    .base-pet-card__left {
        flex-direction: row;
        width: 100%;
        justify-content: flex-start;
        border-bottom: 1px dashed var(--border);
        padding-bottom: 8px;
        min-width: unset;
        gap: 12px;
    }

    .base-pet-card__sprite-wrapper {
        width: 56px;
        height: 56px;
        padding: 4px;
        overflow: visible;
        flex-shrink: 0;
    }

    .base-pet-card__info {
        flex-direction: row;
        align-items: center;
        justify-content: flex-start;
        gap: 12px;
        text-align: left;
    }

    .base-pet-card__name {
        font-size: 13px;
        max-width: 120px;
    }

    .base-pet-card .badge {
        font-size: 11px;
        padding: 4px 10px;
    }

    .base-pet-card__sprite-wrapper canvas {
        width: 100% !important;
        height: 100% !important;
        object-fit: contain;
    }
    
    .base-pet-card__content {
        width: 100%;
        padding-top: 4px;
    }

    .stat-row {
        flex-wrap: wrap;
        gap: 6px 8px;
        margin-bottom: 8px; /* More spacing between rows on mobile */
    }

    .stat__label {
        min-width: 60px;
    }

    .stat__str-label {
        order: 0; /* Sprite FIRST on mobile */
        min-width: 30px;
        font-size: 11px;
        font-weight: 600;
        color: var(--pill-to);
    }

    .stat__timer {
        order: 1; /* Timer SECOND on mobile */
        min-width: 50px;
    }

    .stat__feeds {
        order: 2;
        min-width: 35px;
    }

    .stat__progress-mini {
        min-width: 80px;
        flex: 1;
        order: 3;
    }

    /* Percent is inside progress bar, not separate */
}
`,cv=`
.badge{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:var(--badge-py, 6px) var(--badge-px, 12px);
  border-radius:var(--badge-radius, 12px);
  border:1px solid var(--border);
  background-color: color-mix(in oklab, var(--soft) 80%, transparent);
  color: var(--fg);
  font-size: var(--badge-fs, 13px);
  line-height:1.1;
  font-weight:600;
  white-space:nowrap;
  opacity:.98;
  transition:
    background-color .28s ease,
    border-color .28s ease,
    color .28s ease,
    box-shadow .28s ease;
}

.badge--pill{ border-radius:999px; }

.badge--sm{ --badge-py:4px; --badge-px:10px; --badge-fs:12px; --badge-radius:10px; }
.badge--md{ --badge-py:6px; --badge-px:12px; --badge-fs:13px; --badge-radius:12px; }
.badge--lg,.badge--large{
  --badge-py:8px; --badge-px:14px; --badge-fs:14px; --badge-radius:12px;
}

.badge--outline{ background-color: transparent; }
.badge--solid{ background-color: color-mix(in oklab, var(--border) 18%, transparent); }

.badge--neutral{ --bd: var(--border); }
.badge--info{    --bd: color-mix(in oklab, var(--info) 65%, var(--border)); }
.badge--success{ --bd: color-mix(in oklab, var(--high) 65%, var(--border)); }
.badge--warning{ --bd: color-mix(in oklab, var(--medium) 65%, var(--border)); }
.badge--danger{  --bd: color-mix(in oklab, var(--low) 65%, var(--border)); }

.badge.badge--neutral,
.badge.badge--info,
.badge.badge--success,
.badge.badge--warning,
.badge.badge--danger{
  border-color: var(--bd, var(--border));
}

.badge--soft.badge--info    { background-color: color-mix(in oklab, var(--info) 15%, transparent); }
.badge--soft.badge--success { background-color: color-mix(in oklab, var(--high) 14%, transparent); }
.badge--soft.badge--warning { background-color: color-mix(in oklab, var(--medium) 16%, transparent); }
.badge--soft.badge--danger  { background-color: color-mix(in oklab, var(--low) 15%, transparent); }

/* ===================== RARITY ===================== */
.badge.badge--rarity{
  display:inline-flex;
  justify-content:center;
  align-items:center;
  padding:4px 8px;
  border-radius:5px;
  font-size:12px;
  font-weight:700;
  line-height:1.1;
  white-space:nowrap;
  border:none;
  background:transparent;
  color:inherit;
}

.badge.badge--rarity.badge--rarity-common    { background: var(--rarity-common); color:#0b0b0b; }
.badge.badge--rarity.badge--rarity-uncommon  { background: var(--rarity-uncommon); color:#0b0b0b; }
.badge.badge--rarity.badge--rarity-rare      { background: var(--rarity-rare); color:#ffffff; }
.badge.badge--rarity.badge--rarity-legendary { background: var(--rarity-legendary); color:#0b0b0b; }
.badge.badge--rarity.badge--rarity-mythical  { background: var(--rarity-mythical); color:#ffffff; }
.badge.badge--rarity.badge--rarity-divine    { background: var(--rarity-divine); color:#0b0b0b; }

/* Animated celestial */
@keyframes badgeCelestialShift {
  0% { background-position: 0% 50%; }
  50%{ background-position:100% 50%; }
  100%{background-position: 0% 50%; }
}
.badge.badge--rarity.badge--rarity-celestial{
  background: linear-gradient(130deg,
    rgb(0,180,216) 0%,
    rgb(124,42,232) 40%,
    rgb(160,0,126) 60%,
    rgb(255,215,0) 100%);
  background-size:200% 200%;
  animation: badgeCelestialShift 4s linear infinite;
  color:#fff;
  -webkit-text-stroke: 0.2px #000;
}

/* >>> UNKNOWN <<< */
.badge.badge--rarity.badge--rarity-unknown{
  background:#000;
  color:#fff;
}

/* ===================== ABILITY ===================== */
.badge.badge--ability{
  display:inline-flex;
  align-items:center;
  padding:4px 10px;
  border-radius:6px;
  font-size:12px;
  font-weight:600;
  color:white;
  transition:background 0.2s ease;
  border:none;
  max-width:fit-content;
}
`,t1=`
/* ═══════════════════════════════════════════════════════════════════════════
   ARCADE BUTTON - 3D Push Button with Grey Base
   Reference: Classic arcade button with red dome, silver rim, dark base
   ═══════════════════════════════════════════════════════════════════════════ */

.arcade-btn {
    /* Reset */
    appearance: none;
    border: none;
    cursor: pointer;
    font-family: inherit;
    background: none;
    
    /* Size to accommodate 3D structure */
    position: relative;
    width: 44px;
    height: 40px;
    padding: 0;
    flex-shrink: 0;
    
    -webkit-tap-highlight-color: transparent;
}

/* ─────────────────────────────────────────────────────────────────────────────
   LAYER 1: Dark grey base pedestal (bottom)
   ───────────────────────────────────────────────────────────────────────────── */
.arcade-btn::before {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 42px;
    height: 10px;
    border-radius: 5px;
    background: linear-gradient(to bottom, #4a4a4a, #1a1a1a);
    box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.1),
        0 2px 4px rgba(0,0,0,0.6);
    z-index: 1;
}

/* ─────────────────────────────────────────────────────────────────────────────
   LAYER 2: Silver cylindrical rim (middle)
   - Viewed from above as an ellipse
   - Has inner depth shadow
   ───────────────────────────────────────────────────────────────────────────── */
.arcade-btn::after {
    content: '';
    position: absolute;
    bottom: 6px;
    left: 50%;
    transform: translateX(-50%);
    width: 38px;
    height: 18px;
    border-radius: 50%;
    background: linear-gradient(to bottom, #c0c0c0, #808080 50%, #606060);
    box-shadow:
        inset 0 3px 4px rgba(255,255,255,0.4),
        inset 0 -3px 6px rgba(0,0,0,0.4),
        0 1px 2px rgba(0,0,0,0.3);
    z-index: 2;
}

/* ─────────────────────────────────────────────────────────────────────────────
   LAYER 3: Red dome button (top) 
   - 3D dome shape using asymmetric border-radius
   - Overlaps into rim for seamless connection
   - Has highlight and shadow for depth
   ───────────────────────────────────────────────────────────────────────────── */
.arcade-btn__top {
    position: absolute;
    bottom: 16px;
    left: 50%;
    transform: translateX(-50%);
    width: 34px;
    height: 22px;
    /* Asymmetric border-radius creates dome viewed from above */
    border-radius: 50% 50% 50% 50% / 70% 70% 30% 30%;
    z-index: 3;
    
    /* Red dome gradient with 3D shading */
    background: 
        /* Highlight at top-left for glossy effect */
        radial-gradient(ellipse 45% 35% at 35% 25%, 
            rgba(255,255,255,0.6), 
            transparent
        ),
        /* Main dome gradient: light red at top, dark at bottom */
        linear-gradient(to bottom, 
            #ff5555 0%,
            #ee0000 40%,
            #aa0000 80%,
            #880000 100%
        );
    
    box-shadow:
        /* Dark red underbelly visible below */
        0 4px 0 #660000,
        /* Inner shadow at bottom for 3D curve */
        inset 0 -4px 8px rgba(0,0,0,0.35),
        /* Subtle inner highlight at top */
        inset 0 2px 4px rgba(255,200,200,0.3);
    
    transition: 
        bottom 0.06s ease-out,
        box-shadow 0.06s ease-out;
}

/* Sprite content centered on button */
.arcade-btn__content {
    position: absolute;
    top: 40%;
    left: 50%;
    transform: translate(-50%, -50%);
    pointer-events: none;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 18px;
    height: 14px;
    overflow: hidden;
    z-index: 4;
}

.arcade-btn canvas {
    image-rendering: pixelated;
    display: block;
    max-width: 100%;
    max-height: 100%;
}

/* ─────────────────────────────────────────────────────────────────────────────
   STATES
   ───────────────────────────────────────────────────────────────────────────── */

/* Hover - slight brightness increase */
.arcade-btn:hover:not(:disabled) .arcade-btn__top {
    filter: brightness(1.08);
}

/* Pressed - button pushes down into rim */
.arcade-btn:active:not(:disabled) .arcade-btn__top,
.arcade-btn.arcade-btn--pressed .arcade-btn__top {
    bottom: 10px;
    box-shadow:
        0 2px 0 #660000,
        inset 0 -2px 4px rgba(0,0,0,0.3),
        inset 0 1px 2px rgba(255,200,200,0.2);
}

/* Disabled */
.arcade-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* Focus ring */
.arcade-btn:focus-visible .arcade-btn__top {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
}

/* ═══════════════════════════════════════════════════════════════════════════
   VARIANTS - Override button top color only
   Base and rim stay the same (grey)
   ═══════════════════════════════════════════════════════════════════════════ */

/* Plant variant - Cyan/Teal */
.arcade-btn--plant .arcade-btn__top {
    background: 
        radial-gradient(ellipse 45% 35% at 35% 25%, 
            rgba(255,255,255,0.6), 
            transparent
        ),
        linear-gradient(to bottom, 
            #44dddd 0%,
            #00bbbb 40%,
            #008888 80%,
            #006666 100%
        );
    box-shadow:
        0 4px 0 #004444,
        inset 0 -4px 8px rgba(0,0,0,0.35),
        inset 0 2px 4px rgba(200,255,255,0.3);
}

.arcade-btn--plant:active:not(:disabled) .arcade-btn__top {
    box-shadow:
        0 2px 0 #004444,
        inset 0 -2px 4px rgba(0,0,0,0.3),
        inset 0 1px 2px rgba(200,255,255,0.2);
}

/* Egg variant - Purple */
.arcade-btn--egg .arcade-btn__top {
    background: 
        radial-gradient(ellipse 45% 35% at 35% 25%, 
            rgba(255,255,255,0.6), 
            transparent
        ),
        linear-gradient(to bottom, 
            #aa66ff 0%,
            #8844dd 40%,
            #6622aa 80%,
            #441177 100%
        );
    box-shadow:
        0 4px 0 #331066,
        inset 0 -4px 8px rgba(0,0,0,0.35),
        inset 0 2px 4px rgba(220,200,255,0.3);
}

.arcade-btn--egg:active:not(:disabled) .arcade-btn__top {
    box-shadow:
        0 2px 0 #331066,
        inset 0 -2px 4px rgba(0,0,0,0.3),
        inset 0 1px 2px rgba(220,200,255,0.2);
}
`,bU=`
  .ability-logs-container {
    width: 100%;
  }

  .ability-logs-list {
    /* Scrollbar styling */
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
  }

  .ability-logs-list::-webkit-scrollbar {
    width: 6px;
  }

  .ability-logs-list::-webkit-scrollbar-track {
    background: transparent;
  }

  .ability-logs-list::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 3px;
  }

  .ability-logs-list::-webkit-scrollbar-thumb:hover {
    background: color-mix(in oklab, var(--border) 70%, var(--fg) 30%);
  }

  .ability-log-item {
    cursor: pointer;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
  }

  /* Touch-friendly on mobile */
  @media (hover: none) and (pointer: coarse) {
    .ability-log-item {
      padding: 14px !important;
    }

    .ability-log-item:active {
      transform: scale(0.98);
    }
  }

  /* Responsive text sizing */
  @media (max-width: 480px) {
    .ability-log-item {
      padding: 10px !important;
      gap: 10px !important;
    }
  }

  /* Empty state styling */
  .ability-logs-empty {
    /* Styles are inline in AbilityLogsCard.ts */
  }

  /* Smooth animations */
  @media (prefers-reduced-motion: no-preference) {
    .ability-log-item {
      transition: all 0.2s ease;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .ability-log-item {
      transition: none;
    }
  }
`;class vU extends pr{constructor(n){super({id:"tab-pets",label:"Pets"});de(this,"unsubscribeMyPets");de(this,"lastActiveTeamId",null);de(this,"teamCardPart",null);de(this,"abilityLogsCardPart",null);de(this,"deps");this.deps=n;}async build(n){this.container=n;const{MGSprite:r}=await $n(async()=>{const{MGSprite:a}=await Promise.resolve().then(()=>Mp);return {MGSprite:a}},void 0);await r.init();const o=n.getRootNode();wt(o,ZE,"team-card-styles"),wt(o,e1,"base-pet-card-styles"),wt(o,cv,"badge-styles"),wt(o,t1,"arcade-button-styles"),wt(o,QE,"gemini-icon-button-styles"),wt(o,bU,"ability-logs-card-styles");const i=this.createGrid("12px");i.id="pets",n.appendChild(i),this.initializeTeamCardPart(i),this.initializeAbilityLogsCardPart(i),this.unsubscribeMyPets=De.myPets.subscribeStable(()=>{const a=je.getActiveTeamId();a!==this.lastActiveTeamId&&(this.lastActiveTeamId=a,this.teamCardPart?.render());}),this.lastActiveTeamId=je.getActiveTeamId();}async destroy(){this.unsubscribeMyPets&&(this.unsubscribeMyPets(),this.unsubscribeMyPets=void 0),this.teamCardPart&&(this.teamCardPart.destroy(),this.teamCardPart=null),this.abilityLogsCardPart&&(this.abilityLogsCardPart.destroy(),this.abilityLogsCardPart=null);}initializeTeamCardPart(n){this.teamCardPart||(this.teamCardPart=new uU({onTeamReordered:o=>{console.log("[PetsSection] Teams reordered:",o);},setHUDOpen:this.deps?.setHUDOpen}));const r=this.teamCardPart.build();n.appendChild(r),this.teamCardPart.render();}initializeAbilityLogsCardPart(n){this.abilityLogsCardPart||(this.abilityLogsCardPart=new mU);const r=this.abilityLogsCardPart.build();n.appendChild(r),this.abilityLogsCardPart.render();}}class yU{constructor(t){de(this,"root");de(this,"options");de(this,"headerElement",null);de(this,"petsContainer",null);de(this,"footerElement",null);this.options=t,this.root=document.createElement("div"),this.root.className="xp-panel";}build(){return this.headerElement=document.createElement("div"),this.headerElement.className="xp-panel__header",this.root.appendChild(this.headerElement),this.petsContainer=document.createElement("div"),this.petsContainer.className="xp-panel__pets",this.root.appendChild(this.petsContainer),this.footerElement=document.createElement("div"),this.footerElement.className="xp-panel__footer",this.root.appendChild(this.footerElement),this.root}update(t){this.updateHeader(t.teamSummary),this.updatePets(t.pets),this.updateFooter(t.teamSummary,t.pets);}updateHeader(t){this.headerElement&&(t.bonusXpPerHour>0,this.headerElement.innerHTML=`
            <div class="xp-panel__header-title">
                <span class="xp-panel__header-icon">📊</span>
                <span>XP Tracker</span>
            </div>
            <div class="xp-panel__header-rate">
                <span class="xp-panel__rate-total">${t.totalXpPerHour.toLocaleString()} XP/hr</span>
            </div>
        `);}updatePets(t){if(this.petsContainer){this.petsContainer.innerHTML="";for(const n of t){const r=this.buildPetCard(n);this.petsContainer.appendChild(r);}}}buildPetCard(t){const n=document.createElement("div");n.className="xp-pet-card",t.isStarving&&n.classList.add("xp-pet-card--starving"),t.isMaxStrength&&n.classList.add("xp-pet-card--max");const r=document.createElement("div");r.className="xp-pet-card__sprite";const o=document.createElement("div");o.className="xp-pet-card__sprite-wrapper";try{const d=t.mutations;if(me.has("pet",t.species)){const u=me.toCanvas("pet",t.species,{mutations:d,scale:1,boundsMode:"padded"});u.style.width="64px",u.style.height="64px",u.style.objectFit="contain",u.style.display="block",o.appendChild(u);}else o.innerHTML='<div class="xp-pet-card__sprite-fallback">🐾</div>';}catch(d){console.warn(`[TeamXpPanel] Failed to render sprite for ${t.species}:`,d),o.innerHTML='<div class="xp-pet-card__sprite-fallback">🐾</div>';}r.appendChild(o);const i=document.createElement("div");if(i.className="xp-pet-card__badges",t.isMaxStrength&&(i.innerHTML+='<span class="xp-badge xp-badge--max">MAX</span>'),t.isStarving&&(i.innerHTML+='<span class="xp-badge xp-badge--starving">STARVING</span>'),t.xpBoostStats){const d=t.xpBoostStats.tier==="Snowy"?"❄":"⚡";i.innerHTML+=`<span class="xp-badge xp-badge--boost">${d}${t.xpBoostStats.tier}</span>`;}r.appendChild(i);const a=document.createElement("div");a.className="xp-pet-card__str-display",a.innerHTML=`
            <span class="xp-str__label">STR</span>
            <span class="xp-str__current">${t.currentStrength}</span>
            <span class="xp-str__separator">/</span>
            <span class="xp-str__max">${t.maxStrength}</span>
        `,r.appendChild(a),n.appendChild(r);const s=document.createElement("div");s.className="xp-pet-card__stats";const l=document.createElement("div");l.className="xp-pet-card__name",l.textContent=t.name||t.species,s.appendChild(l);const c=document.createElement("table");return c.className="xp-stats-table",t.isStarving?c.innerHTML=`
                <tr class="xp-stats-table__row xp-stats-table__row--warning">
                    <td class="xp-stats-table__label">Status</td>
                    <td class="xp-stats-table__value xp-stats-table__value--danger">0 XP/hr - FEED NOW!</td>
                </tr>
            `:c.innerHTML=`
                ${t.isMaxStrength?"":`
                <tr class="xp-stats-table__row">
                    <td class="xp-stats-table__label">Next STR</td>
                    <td class="xp-stats-table__value">
                        ${this.buildProgressWithStats(t,"next")}
                    </td>
                </tr>
                <tr class="xp-stats-table__row">
                    <td class="xp-stats-table__label">Max STR</td>
                    <td class="xp-stats-table__value">
                        ${this.buildProgressWithStats(t,"max")}
                    </td>
                </tr>
                `}
                ${t.xpBoostStats?`
                <tr class="xp-stats-table__row xp-stats-table__row--boost">
                    <td class="xp-stats-table__label">XP Boost</td>
                    <td class="xp-stats-table__value">
                        <span class="xp-boost-stat">+${t.xpBoostStats.expectedXpPerHour.toLocaleString()} XP/hr</span>
                        ${t.xpBoostStats.isActive?"":'<span class="xp-inactive">(inactive)</span>'}
                    </td>
                </tr>
                `:""}
                ${t.supportingFeeds!==null?`
                <tr class="xp-stats-table__row xp-stats-table__row--support">
                    <td class="xp-stats-table__label">Supporting</td>
                    <td class="xp-stats-table__value">
                        <span class="xp-support">${t.supportingFeeds} feeds to carry team</span>
                    </td>
                </tr>
                `:""}
            `,s.appendChild(c),n.appendChild(s),n}buildProgressWithStats(t,n){const r=n==="next"?t.hoursToNextStrength:t.hoursToMaxStrength,o=n==="next"?t.feedsToNextStrength:t.feedsToMaxStrength,i=t.currentStrength-Math.floor(t.currentStrength),a=Math.floor(n==="next"?i*100:t.currentStrength/t.maxStrength*100),s=n==="next"?Math.min(99,Math.max(1,a)):Math.min(100,Math.max(0,a)),l=s<33?"low":s<67?"medium":"high";return `
            <div class="xp-progress-row">
                <span class="xp-progress-row__time">${this.formatHours(r)}</span>
                <span class="xp-progress-row__feeds">(🍖 x${o})</span>
                <div class="xp-progress-row__bar-container">
                    <div class="xp-progress-row__bar">
                        <div class="xp-progress-row__fill xp-progress-row__fill--${l}" style="width: ${s}%"></div>
                    </div>
                    <span class="xp-progress-row__percent">${s}%</span>
                </div>
            </div>
        `}updateFooter(t,n){if(!this.footerElement)return;if(t.activeBoosterCount===0){this.footerElement.innerHTML="",this.footerElement.classList.add("xp-panel__footer--hidden");return}this.footerElement.classList.remove("xp-panel__footer--hidden");const o=n.filter(i=>i.xpBoostStats?.isActive).map(i=>i.name||i.species).join(", ");this.footerElement.innerHTML=`
            <div class="xp-panel__footer-icon">⚡</div>
            <div class="xp-panel__footer-content">
                <div class="xp-panel__footer-title">
                    ${t.activeBoosterCount} XP Booster${t.activeBoosterCount!==1?"s":""} Active
                </div>
                <div class="xp-panel__footer-detail">
                    +${t.bonusXpPerHour.toLocaleString()} bonus XP/hr
                    <span class="xp-panel__footer-names">(${o})</span>
                </div>
            </div>
        `;}formatHours(t){if(t===null||t===0)return "0h";if(!isFinite(t))return "∞";if(t<1)return `${Math.ceil(t*60)}m`;if(t<24)return `${t.toFixed(1)}h`;{const n=Math.floor(t/24),r=Math.floor(t%24);return `${n}d ${r}h`}}destroy(){this.root.parentNode&&this.root.parentNode.removeChild(this.root),this.headerElement=null,this.petsContainer=null,this.footerElement=null;}}const wU={id:"xp",label:"XP",icon:"📊",category:"stats",isAvailable:()=>true,getSummary:(e,t)=>{const n=sw(e.id);return n>=99?null:{text:`${Math.round(n)}%`,variant:n<33?"low":n<67?"medium":"high",tooltip:`Average progress to max STR: ${Math.round(n)}%`,priority:10}},buildPanel:(e,t)=>{const n=new yU({teamId:e.id});t.appendChild(n.build());const r=Es(e.id);return r&&n.update(r),{update:(o,i)=>{const a=Es(o.id);a&&n.update(a);},destroy:()=>n.destroy(),refresh:()=>{const o=Es(e.id);o&&n.update(o);}}},renderPetSlot:(e,t,n)=>{const r=De.weather.get(),o=r.isActive?r.type:null,i=Es(t.id);let a,s;if(i){a=i.teamSummary.bonusXpPerHour;const f=i.pets||[];s=Math.max(0,...f.map(g=>g.hoursToMaxStrength||0));}else {const f=De.myPets.get(),g=t.petIds.filter(h=>h!=="").map(h=>f.all.find(y=>y.id===h)).filter(h=>h!==void 0);a=0,s=0;for(const h of g){const y=Xs(h,o,0,0);a+=y.xpBoostStats?.expectedXpPerHour??0,s=Math.max(s,y.hoursToMaxStrength??0);}}const l=Xs(e,o,a,s),c=l.isMaxStrength,d=!!l.xpBoostStats;let u="";if(c)d&&l.xpBoostStats&&(u=`
                    <div class="stat-row stat-row--boost">
                        <span class="stat__label">BOOST</span>
                        <span class="stat__value stat__value--accent">+${l.xpBoostStats.expectedXpPerHour.toLocaleString()} XP/h</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat__label">SUPPORT</span>
                        <span class="stat__value">${l.supportingFeeds} feeds</span>
                    </div>
                `);else {let f="";d&&l.xpBoostStats&&(f=`
                    <div class="stat-row stat-row--boost">
                        <span class="stat__label">BOOST</span>
                        <span class="stat__value stat__value--accent">+${l.xpBoostStats.expectedXpPerHour.toLocaleString()} XP/h</span>
                    </div>
                `);const g=l.maxStrength,h=l.currentStrength,y=Math.min(100,Math.max(0,Math.floor(h/g*100))),S=e.xp%3600/3600*100,C=Math.min(99,Math.max(1,Math.floor(S))),_=l.currentStrength+1,E=l.maxStrength;u=f+`
                <div class="stat-row">
                    <span class="stat__label">NEXT STR</span>
                    <span class="stat__timer">${lw(l.hoursToNextStrength||0)}</span>
                    <span class="stat__feeds">🍖 x${l.feedsToNextStrength}</span>
                    <span class="stat__str-label">STR ${_}</span>
                    <div class="stat__progress-mini">
                        <div class="stat__progress-fill stat__progress-fill--xp" style="width: ${C}%"></div>
                        <span class="stat__percent">${C}%</span>
                    </div>
                </div>
                <div class="stat-row">
                    <span class="stat__label">MAX STR</span>
                    <span class="stat__timer">${lw(l.hoursToMaxStrength||0)}</span>
                    <span class="stat__feeds">🍖 x${l.feedsToMaxStrength}</span>
                    <span class="stat__str-label">STR ${E}</span>
                    <div class="stat__progress-mini">
                        <div class="stat__progress-fill stat__progress-fill--xp" style="width: ${y}%"></div>
                        <span class="stat__percent">${y}%</span>
                    </div>
                </div>
            `;}n.innerHTML=u?`<div class="xp-stats-compact">${u}</div>`:"";},renderGroupedSlot:(e,t,n)=>{const r=De.weather.get(),o=r.isActive?r.type:null,i=Es(t.id);let a;if(i)a=i.teamSummary.bonusXpPerHour;else {a=0;for(const d of e){const u=Xs(d,o,0,0);a+=u.xpBoostStats?.expectedXpPerHour??0;}}let s=0,l=0;for(const d of e){const u=Xs(d,o,a,0);u.xpBoostStats&&(s+=u.xpBoostStats.expectedXpPerHour),u.supportingFeeds&&(l+=u.supportingFeeds);}let c="";if(s>0&&(c=`
                <div class="stat-row stat-row--boost">
                    <span class="stat__label">TEAM BOOST</span>
                    <span class="stat__value stat__value--accent">+${s.toLocaleString()} XP/h</span>
                </div>
            `,l>0&&(c+=`
                    <div class="stat-row">
                        <span class="stat__label">SUPPORT</span>
                        <span class="stat__value">${l} feeds</span>
                    </div>
                `)),s===0){if(e.every(u=>u.currentStrength>=u.maxStrength))n.innerHTML=`
                    <div class="xp-stats-compact xp-stats-grouped">
                        <div class="stat-row stat-row--info">
                            <span class="stat__message">All pets at max STR</span>
                        </div>
                    </div>
                `;else {const u=i?sw(t.id):e.length>0?e.reduce((f,g)=>f+g.currentStrength/g.maxStrength*100,0)/e.length:0;n.innerHTML=`
                    <div class="xp-stats-compact xp-stats-grouped">
                        <div class="stat-row stat-row--info">
                            <span class="stat__message">Leveling: ${Math.round(u)}%</span>
                        </div>
                    </div>
                `;}return}n.innerHTML=`<div class="xp-stats-compact xp-stats-grouped">${c}</div>`;},hasContent:(e,t)=>{const n=Array.isArray(e)?e:[e];return n.some(i=>i.currentStrength<i.maxStrength)?true:n.some(i=>i.abilities.some(a=>Pe.XP_BOOST.includes(a)))},shouldDisplay:(e,t,n)=>(sf.ALLOWED_PANELS[n.primary]||[]).includes("xp")?!!(t.some(a=>a.currentStrength<a.maxStrength)||t.some(a=>a.abilities.some(s=>Pe.XP_BOOST.includes(s)))):false,countRows:(e,t)=>{const n=Array.isArray(e)?e:[e];return n.every(o=>o.currentStrength>=o.maxStrength)?n.some(i=>i.abilities.some(a=>Pe.XP_BOOST.includes(a)))?1:0:2}};function Ut(e,t,n){const r=document.createElement(e);return t&&(r.className=t),n&&(r.textContent=n),r}function mo(e){if(e<=0)return "0m";const t=Math.floor(e/1e3),n=Math.floor(t/86400),r=Math.floor(t%86400/3600),o=Math.floor(t%3600/60),i=[];return n>0&&i.push(`${n}d`),r>0&&i.push(`${r}h`),(o>0||i.length===0)&&i.push(`${o}m`),i.join(" ")}function bo(e,t){const n=e==="egg"?"pet":"plant",r=Ut("span","sprite-wrapper");if(!t)return r;let o=t;e==="plant"&&(o==="DawnCelestial"&&(o="DawnCelestialCrop"),o==="MoonCelestial"&&(o="MoonCelestialCrop"));try{if(me.isReady()&&me.has(n,o)){const i=me.toCanvas(n,o,{scale:.3});i.style.height="16px",i.style.width="auto",i.style.imageRendering="pixelated",r.appendChild(i);}}catch{}return r}function Td(e,t){const n=Ut("span","stacked-sprites");if(t.length===0)return n;const r=e==="egg"?"pet":"plant",o=4,a=[...new Set(t.map(l=>e==="egg"?l.eggId:l.species).filter(Boolean))].slice(0,o);if(a.length===0)return n;n.style.display="grid",n.style.gridTemplateColumns="repeat(2, 10px)",n.style.gridTemplateRows="repeat(2, 10px)",n.style.width="24px",n.style.height="24px";let s=false;for(let l=0;l<a.length;l++){let c=a[l];e==="plant"&&c&&(c==="DawnCelestial"&&(c="DawnCelestialCrop"),c==="MoonCelestial"&&(c="MoonCelestialCrop"));try{if(me.isReady()&&c&&me.has(r,c)){const d=me.toCanvas(r,c,{scale:.2});d.style.height="14px",d.style.width="auto",d.style.imageRendering="pixelated",d.style.position="relative",d.style.zIndex=String(o-l),n.appendChild(d),s=!0;}}catch{}}return s||(n.textContent=e==="egg"?"🥚":"🌱"),n}function vo(e,t,n,r,o,i){const a=Ut("div","stat-row"),s=Ut("span","stat__label",e),l=Ut("span","stat__timer",t),c=Ut("span","stat__str-label");c.appendChild(n);const d=Ut("div","stat__progress-mini"),u=Ut("div",`stat__progress-fill ${o}`);u.style.width=`${r}%`,d.appendChild(u);const f=`${r}%`,g=Ut("span","stat__percent",f);return d.appendChild(g),a.appendChild(s),n&&n.innerHTML!==""&&n.textContent!=="🥚"&&n.textContent!=="🌱"&&a.appendChild(c),a.appendChild(l),a.appendChild(d),a}function Ew(e){const t=Ut("div","stat-row stat-row--boost"),n=Ut("span","stat__label","BOOST");t.appendChild(n);const r=Ut("span","stat__values-row");return e.forEach((o,i)=>{const a=Ut("span","stat__boost-item");a.appendChild(o.sprite),a.appendChild(Ut("span","stat__value stat__value--accent",o.text)),r.appendChild(a),i<e.length-1&&r.appendChild(Ut("span","stat__separator"," "));}),t.appendChild(r),t}function Aw(e,t){const n=t==="egg"?Vl:ql;let r=0,o=false;const i=[];for(const a of e.abilities)if(a in n){const s=n[a],l=s.procRate*60;r+=l*s.minutesPerProc,o=true,i.push(a);}return {hasBoost:o,minutesPerProc:0,hourlyReduction:r,abilityName:i.join(", ")}}function Tw(e,t){const n=je.getPetsForTeam(e),r=t==="egg"?Xb(n):Yb(n);return `${((60+Kl(r).timeReductionPerHour)/60).toFixed(2)}x`}function Id(e,t,n=1){return e.length===0?0:Math.round(e.reduce((r,o)=>{const i=t-o.plantedAt,s=(o.maturedAt-t)/n,l=i+s,c=l>0?i/l*100:0;return r+Math.min(100,Math.max(0,c))},0)/e.length)}function Pd(e,t,n=1){return e.length===0?0:Math.round(e.reduce((r,o)=>{const i=t-o.startTime,s=(o.endTime-t)/n,l=i+s,c=l>0?i/l*100:0;return r+Math.min(100,Math.max(0,c))},0)/e.length)}function Iw(e,t){if(e.length===0)return {remainingMs:0,name:null};const r=[...e].sort((o,i)=>o.maturedAt-i.maturedAt)[0];return {remainingMs:Math.max(0,r.maturedAt-t),name:r.eggId||null}}function Pw(e,t){if(e.length===0)return {remainingMs:0,name:null};const r=[...e].sort((o,i)=>o.endTime-i.endTime)[0];return {remainingMs:Math.max(0,r.endTime-t),name:r.species||null}}function Rw(e,t){if(e.length===0)return 0;const n=Math.max(...e.map(r=>r.maturedAt));return Math.max(0,n-t)}function Mw(e,t){if(e.length===0)return 0;const n=Math.max(...e.map(r=>r.endTime));return Math.max(0,n-t)}function yo(e,t){return e<=0||t<=0?0:Math.round(e/t)}const xU={id:"growth",label:"Growth",icon:"⏱️",category:"tracking",isAvailable:()=>true,getSummary:(e,t)=>{const n=De.myGarden.get(),r=n.eggs.growing.length+n.plants.growing.length;return r===0?null:{text:`${r} growing`,variant:"neutral",tooltip:`${n.eggs.growing.length} eggs, ${n.plants.growing.length} plants`,priority:8}},buildPanel:(e,t)=>({update:()=>{},destroy:()=>{},refresh:()=>{}}),renderPetSlot:(e,t,n,r,o)=>{const i=De.myGarden.get(),a=Date.now(),s=Aw(e,"egg"),l=Aw(e,"plant");if(n.innerHTML="",!s.hasBoost&&!l.hasBoost)return;const c=o?i.eggs.growing.filter(k=>o.has(k.tileIndex)):i.eggs.growing,d=o?i.crops.growing.filter(k=>o.has(k.tileIndex)):i.crops.growing;let u=r;!u&&s.hasBoost!==l.hasBoost&&(u=s.hasBoost?"egg":"plant");const f=u==="egg"&&s.hasBoost||u==="plant"&&l.hasBoost,g=!u,h=Ut("div","growth-stats-compact");if(!f&&!g){const k=r==="egg"?"Egg":"Plant",I=Ut("div","stat-row stat-row--message");I.appendChild(Ut("span","stat__message",`No ${k} Growth Boost, Click the Button to Switch View`)),h.appendChild(I),n.appendChild(h);return}const y=[],S=s.hasBoost&&(u==="egg"||g),C=l.hasBoost&&(u==="plant"||g);if(S){const k=Math.round(s.hourlyReduction/60*100);y.push({text:`+${k}% Speed`,sprite:bo("egg","UncommonEgg")});}if(C){const k=Math.round(l.hourlyReduction/60*100);y.push({text:`+${k}% Speed`,sprite:bo("plant","Carrot")});}y.length>0&&h.appendChild(Ew(y));const _=Tw(t,"egg"),E=parseFloat(_.replace("x","")),P=Tw(t,"plant"),O=parseFloat(P.replace("x",""));if(s.hasBoost&&(u==="egg"||g)){const k=Iw(c,a),I=yo(k.remainingMs,E),R=c.length>0?Id(c,a,E):100,A=I>0?mo(I):"Ready!";h.appendChild(vo("NEXT EGG",A,bo("egg",k.name),R,"stat__progress-fill--egg"));}if(l.hasBoost&&(u==="plant"||g)){const k=Pw(d,a),I=yo(k.remainingMs,O),R=d.length>0?Pd(d,a,O):100,A=I>0?mo(I):"Ready!";h.appendChild(vo("NEXT PLANT",A,bo("plant",k.name),R,"stat__progress-fill--plant"));}if(s.hasBoost&&(u==="egg"||g)){const k=c.length>0?Id(c,a,E):100,I=Rw(c,a),R=yo(I,E),A=R>0?mo(R):"All Ready!";h.appendChild(vo("ALL EGGS",A,Td("egg",c),k,"stat__progress-fill--egg"));}else if(l.hasBoost&&(u==="plant"||g)){const k=d.length>0?Pd(d,a,O):100,I=Mw(d,a),R=yo(I,O),A=R>0?mo(R):"All Ready!";h.appendChild(vo("ALL PLANTS",A,Td("plant",d),k,"stat__progress-fill--plant"));}n.appendChild(h);},renderGroupedSlot:(e,t,n,r,o)=>{const i=De.myGarden.get(),a=Date.now(),s=Xb(e),l=Yb(e),c=Kl(s),d=Kl(l);n.innerHTML="";const u=c.timeReductionPerHour>0,f=d.timeReductionPerHour>0;if(!u&&!f)return;const g=Ut("div","growth-stats-compact growth-stats-grouped"),h=o?i.eggs.growing.filter(k=>o.has(k.tileIndex)):i.eggs.growing,y=o?i.crops.growing.filter(k=>o.has(k.tileIndex)):i.crops.growing,S=r==="egg"&&u,C=r==="plant"&&f,_=!r,E=(60+c.timeReductionPerHour)/60,P=(60+d.timeReductionPerHour)/60,O=[];if((S||_)&&u){const k=Math.round(c.timeReductionPerHour/60*100);O.push({text:`+${k}% Speed`,sprite:bo("egg","UncommonEgg")});}if((C||_)&&f){const k=Math.round(d.timeReductionPerHour/60*100);O.push({text:`+${k}% Speed`,sprite:bo("plant","Carrot")});}if(O.length>0&&g.appendChild(Ew(O)),(S||_)&&u){const k=Iw(h,a),I=yo(k.remainingMs,E),R=h.length>0?Id(h,a,E):100,A=I>0?mo(I):"Ready!";g.appendChild(vo("NEXT EGG",A,bo("egg",k.name),R,"stat__progress-fill--egg"));}if((C||_)&&f){const k=Pw(y,a),I=yo(k.remainingMs,P),R=y.length>0?Pd(y,a,P):100,A=I>0?mo(I):"Ready!";g.appendChild(vo("NEXT PLANT",A,bo("plant",k.name),R,"stat__progress-fill--plant"));}if((S||_)&&u){const k=h.length>0?Id(h,a,E):100,I=Rw(h,a),R=yo(I,E),A=R>0?mo(R):"All Ready!";g.appendChild(vo("ALL EGGS",A,Td("egg",h),k,"stat__progress-fill--egg"));}else if((C||_)&&f){const k=y.length>0?Pd(y,a,P):100,I=Mw(y,a),R=yo(I,P),A=R>0?mo(R):"All Ready!";g.appendChild(vo("ALL PLANTS",A,Td("plant",y),k,"stat__progress-fill--plant"));}n.appendChild(g);},hasContent:(e,t)=>{const n=Array.isArray(e)?e:[e];return To(n)||Io(n)},shouldDisplay:(e,t,n)=>{const o=(sf.ALLOWED_PANELS[n.primary]||[]).includes("growth"),i=To(t)||Io(t);return o&&i},countRows:(e,t,n)=>{const r=Array.isArray(e)?e:[e],o=To(r),i=Io(r);if(!o&&!i)return 0;if(n==="egg"||n==="plant")return 2;let a=0;return o&&(a+=2),i&&(a+=2),a}},lf=1.5,Ys=["ProduceScaleBoost","ProduceScaleBoostII","ProduceScaleBoostIII","SnowyCropSizeBoost"],Js=["ProduceMutationBoost","ProduceMutationBoostII","ProduceMutationBoostIII","SnowyCropMutationBoost"],Qs=["RainDance","SnowGranter","FrostGranter","GoldGranter","RainbowGranter"],Zs=["DoubleHarvest"],el=["ProduceRefund"];function Jr(e,t,n){const r=document.createElement(e);return t&&(r.className=t),n&&(r.textContent=n),r}function wo(e){if(e>=1e12)return `${(e/1e12).toFixed(2)}T`;if(e>=1e9)return `${(e/1e9).toFixed(2)}B`;if(e>=1e6)return `${(e/1e6).toFixed(2)}M`;if(e>=1e3){const t=e/1e3;return t>=100?`${Math.round(t)}k`:`${t.toFixed(1)}k`}return String(Math.round(e))}function as(e){const t=ue.get("abilities");if(!t)return null;const n=t[e];return n?{id:e,name:n.name??e,baseProbability:n.baseProbability??0,scaleIncreasePercentage:n.baseParameters?.scaleIncreasePercentage??0,mutationChanceIncreasePercentage:n.baseParameters?.mutationChanceIncreasePercentage??0,grantedMutations:n.baseParameters?.grantedMutations??[],requiredWeather:n.baseParameters?.requiredWeather??null}:null}function Nt(e,t){return e.abilities.some(n=>t.includes(n))}function Sc(e,t,n){if(e.hunger<=0)return  false;const r=as(t);return !(!r||r.requiredWeather&&n!==r.requiredWeather)}function _c(e){return (e.currentStrength<0||e.currentStrength>100)&&console.warn(`[Gemini] Invalid strength: ${e.currentStrength} for pet ${e.name||"unknown"}`),(e.maxStrength<80||e.maxStrength>100)&&console.warn(`[Gemini] Unexpected maxStrength: ${e.maxStrength} for pet ${e.name||"unknown"} (expected 80-100)`),e.currentStrength/100}function cf(e,t){return Math.min(100,e*t)}function CU(e,t,n,r,o=lf){const i=Tp(e);if(!i)return 0;const a=dr(e,t,n)*o,s=Math.min(t*(1+r/100),i.maxScale),l=dr(e,s,n)*o;return Math.max(0,l-a)}function n1(e,t,n,r,o=lf){if(n.includes(r))return 0;const i=dr(e,t,n)*o,a=[...n,r],s=dr(e,t,a)*o;return Math.max(0,s-i)}function Eh(e,t,n){const r=Jr("div","stat-row");return r.appendChild(Jr("span","stat__label",e)),r.appendChild(Jr("span","stat__value",t)),r.appendChild(Jr("span","stat__timer",n)),r}function Lw(e,t,n){const r=Jr("div","stat-row");return r.appendChild(Jr("span","stat__label",e)),r.appendChild(Jr("span","stat__value",t)),r.appendChild(Jr("span","stat__timer",n)),r}function SU(e,t,n){const o=De.myGarden.get().crops.mature,i=n?o.filter(c=>n.has(String(c.tileIndex))):o;if(i.length===0)return {perProc:0,perHour:0};let a=0,s=0;for(const c of e){const d=_c(c);for(const u of Ys){if(!c.abilities.includes(u)||!Sc(c,u,t))continue;const f=as(u);if(!f)continue;const g=cf(f.baseProbability,d),h=f.scaleIncreasePercentage*d,y=g/100*60;let S=0,C=0;for(const E of i){const P=Math.max(1,Math.floor(E.fruitCount)),O=CU(E.species,E.targetScale,E.mutations,h);S+=O*P,C+=P;}const _=C>0?S/C:0;a+=_*y,s+=y;}}return {perProc:s>0?a/s:0,perHour:a}}function _U(e,t,n){const o=De.myGarden.get().crops.mature,i=De.weather.get(),a=ue.get("weather"),s=n?o.filter(S=>n.has(String(S.tileIndex))):o;if(s.length===0||!i.isActive||!a)return {perProc:0,perHour:0};const l=a[i.type];if(!l?.mutator)return {perProc:0,perHour:0};const c=l.mutator.chancePerMinutePerCrop??0,d=l.mutator.mutation??"";let u=0;for(const S of e){const C=_c(S);for(const _ of Js){if(!S.abilities.includes(_)||!Sc(S,_,t))continue;const E=as(_);if(!E)continue;const P=E.mutationChanceIncreasePercentage*C;u+=P;}}const f=c*(u/100),g=s.length*(f/100)*60;let h=0;for(const S of s){const C=n1(S.species,S.targetScale,S.mutations,d);h+=C;}const y=s.length>0?h/s.length:0;return {perProc:y,perHour:g*y}}function kU(e,t,n){const o=De.myGarden.get().crops.mature,i=n?o.filter(c=>n.has(String(c.tileIndex))):o;if(i.length===0)return {perProc:0,perHour:0};let a=0,s=0;for(const c of e){const d=_c(c);for(const u of Qs){if(!c.abilities.includes(u)||!Sc(c,u,t))continue;const f=as(u);if(!f)continue;const h=cf(f.baseProbability,d)/100*60,y=f.grantedMutations;if(y.length===0)continue;const S=y[0];let C=0,_=0;for(const O of i){if(S==="Gold"||S==="Rainbow"){const A=O.mutations.includes("Gold"),L=O.mutations.includes("Rainbow");if(A||L)continue}else if(O.mutations.includes(S))continue;const I=Math.max(1,Math.floor(O.fruitCount)),R=n1(O.species,O.targetScale,O.mutations,S);C+=R*I,_+=I;}const P=(_>0?C/_:0)*h;a+=P,s+=h;}}return {perProc:s>0?a/s:0,perHour:a}}function EU(e,t,n){const r=De.myGarden.get(),o=r.crops.all,i=r.crops.mature,a=n?o.filter(f=>n.has(String(f.tileIndex))):o,s=n?i.filter(f=>n.has(String(f.tileIndex))):i,l=s.length>0?s:a;if(l.length===0)return {expectedCrops:0,expectedCoins:0};let c=0;for(const f of e){const g=_c(f);for(const h of Zs){if(!f.abilities.includes(h)||!Sc(f,h,t))continue;const y=as(h);if(!y)continue;const S=cf(y.baseProbability,g);c+=S/100;}}const d=l.length*c;let u=0;for(const f of l){const g=dr(f.species,f.targetScale,f.mutations)*lf;u+=g*c;}return {expectedCrops:d,expectedCoins:u}}function AU(e,t,n){const r=De.myGarden.get(),o=r.crops.all,i=r.crops.mature,a=n?o.filter(f=>n.has(String(f.tileIndex))):o,s=n?i.filter(f=>n.has(String(f.tileIndex))):i,l=s.length>0?s:a;if(l.length===0)return {expectedCrops:0,expectedCoins:0};let c=0;for(const f of e){const g=_c(f);for(const h of el){if(!f.abilities.includes(h)||!Sc(f,h,t))continue;const y=as(h);if(!y)continue;const S=cf(y.baseProbability,g);c+=S/100;}}const d=l.length*c;let u=0;for(const f of l){const g=dr(f.species,f.targetScale,f.mutations)*lf;u+=g*c;}return {expectedCrops:d,expectedCoins:u}}const dm={id:"coin",label:"Value",icon:"💰",category:"tracking",isAvailable:()=>true,getSummary:(e,t)=>{const n=De.myGarden.get(),r=n.crops.all.length;return r===0?null:{text:`${r} crops`,variant:"neutral",tooltip:`${n.crops.mature.length} mature, ${n.crops.growing.length} growing`,priority:7}},buildPanel:(e,t)=>({update:()=>{},destroy:()=>{},refresh:()=>{}}),renderPetSlot:(e,t,n,r,o)=>{const i=[e];dm.renderGroupedSlot&&dm.renderGroupedSlot(i,t,n,r,o);},renderGroupedSlot:(e,t,n,r,o)=>{const i=De.weather.get(),a=i.isActive?i.type:null;n.innerHTML="";const s=Jr("div","value-stats-compact"),l=e.some(g=>Nt(g,Ys)),c=e.some(g=>Nt(g,Js)),d=e.some(g=>Nt(g,Qs)),u=e.some(g=>Nt(g,Zs)),f=e.some(g=>Nt(g,el));if(!(!l&&!c&&!d&&!u&&!f)){if(l){const g=SU(e,a,o);s.appendChild(Eh("SIZE BOOST",`+${wo(g.perProc)}/proc`,`+${wo(g.perHour)}/hr`));}if(c){const g=_U(e,a,o);s.appendChild(Eh("MUTATION BOOST",`+${wo(g.perProc)}/proc`,`+${wo(g.perHour)}/hr`));}if(d){const g=kU(e,a,o);s.appendChild(Eh("GRANTERS",`+${wo(g.perProc)}/proc`,`+${wo(g.perHour)}/hr`));}if(u){const g=EU(e,a,o);s.appendChild(Lw("EXTRA HARVEST",`+${g.expectedCrops.toFixed(1)} crops`,`+${wo(g.expectedCoins)} coins`));}if(f){const g=AU(e,a,o);s.appendChild(Lw("CROP REFUND",`+${g.expectedCrops.toFixed(1)} crops`,`+${wo(g.expectedCoins)} coins`));}n.appendChild(s);}},hasContent:(e,t)=>(Array.isArray(e)?e:[e]).some(r=>Nt(r,Ys)||Nt(r,Js)||Nt(r,Qs)||Nt(r,Zs)||Nt(r,el)),shouldDisplay:(e,t,n)=>{const o=(sf.ALLOWED_PANELS[n.primary]||[]).includes("coin"),i=t.some(a=>Nt(a,Ys)||Nt(a,Js)||Nt(a,Qs)||Nt(a,Zs)||Nt(a,el));return o&&i},countRows:(e,t)=>{const n=Array.isArray(e)?e:[e];let r=0;return n.some(o=>Nt(o,Ys))&&r++,n.some(o=>Nt(o,Js))&&r++,n.some(o=>Nt(o,Qs))&&r++,n.some(o=>Nt(o,Zs))&&r++,n.some(o=>Nt(o,el))&&r++,r}},da=["DoubleHatch"],ua=["PetRefund","PetRefundII"],pa=["PetMutationBoost","PetMutationBoostII","PetMutationBoostIII"];function kn(e,t,n){const r=document.createElement(e);return t&&(r.className=t),n&&(r.textContent=n),r}function r1(e){const t=ue.get("abilities");if(!t)return null;const n=t[e];return n?{id:e,name:n.name??e,baseProbability:n.baseProbability??0,mutationChanceIncreasePercentage:n.baseParameters?.mutationChanceIncreasePercentage??0}:null}function bn(e,t){return e.abilities.some(n=>t.includes(n))}function dv(e){return e.hunger>0}function o1(e){return e.currentStrength/e.maxStrength}function i1(e,t){return Math.min(100,e*t)}function TU(e){const t=kn("span","sprite-wrapper");try{if(me.isReady()&&me.has("pet",e)){const n=me.toCanvas("pet",e,{scale:.6});n.style.height="32px",n.style.width="auto",n.style.imageRendering="pixelated",t.appendChild(n);}}catch{t.textContent="🥚";}return t}function Rd(e,t){const n=kn("div","stat-row");n.appendChild(kn("span","stat__label",e));const r=kn("div","stat__sprite-grid");for(const o of t){if(o.value<=0)continue;const i=kn("div","stat__sprite-item");i.appendChild(TU(o.eggId));const a=kn("span","stat__sprite-value",o.value.toFixed(1));i.appendChild(a),r.appendChild(i);}return n.appendChild(r),n}function Ow(e,t,n,r){const o=kn("div","stat-row");o.appendChild(kn("span","stat__label","PET MUTATION"));const i=kn("span","stat__values-row"),a=kn("span","stat__value stat__value--rainbow",`${e}% (${n})`);a.style.backgroundImage="var(--rainbow-text-gradient)",a.style.webkitBackgroundClip="text",a.style.webkitTextFillColor="transparent",a.style.backgroundClip="text",i.appendChild(a),i.appendChild(kn("span","stat__separator"," | "));const s=kn("span","stat__value stat__value--gold",`${t}% (${r})`);return i.appendChild(s),o.appendChild(i),o}function uv(){const e=De.myInventory.get(),t=new Map;for(const n of e.items)if(n.itemType==="Egg"&&n.eggId){const r=t.get(n.eggId)||0;t.set(n.eggId,r+(n.quantity||1));}return t}function pv(e){const t=De.myGarden.get(),n=new Map,r=e?t.eggs.all.filter(o=>e.has(String(o.tileIndex))):t.eggs.all;for(const o of r){const i=n.get(o.eggId)||0;n.set(o.eggId,i+1);}return n}function Nw(e,t){const n=t?pv(t):uv(),r=[];let o=0;for(const i of e){if(!dv(i))continue;const a=o1(i);for(const s of da){if(!i.abilities.includes(s))continue;const l=r1(s);if(!l)continue;const c=i1(l.baseProbability,a);o+=c/100;}}for(const[i,a]of n){const s=a*o;r.push({eggId:i,value:s});}return r}function $w(e,t){const n=t?pv(t):uv(),r=[];let o=0;for(const i of e){if(!dv(i))continue;const a=o1(i);for(const s of ua){if(!i.abilities.includes(s))continue;const l=r1(s);if(!l)continue;const c=i1(l.baseProbability,a);o+=c/100;}}for(const[i,a]of n){const s=a*o;r.push({eggId:i,value:s});}return r}function Dw(e,t){const n=t?pv(t):uv(),r=Array.from(n.values()).reduce((g,h)=>g+h,0);let o=0,i=0;for(const g of e){if(!dv(g))continue;pa.some(y=>g.abilities.includes(y))&&(o+=g.currentStrength*1e-4,i+=g.currentStrength*.001);}const a=ue.get("mutations");let s=1,l=.1;if(a){const g=a.Gold,h=a.Rainbow;g?.baseChance!==void 0&&(s=g.baseChance),h?.baseChance!==void 0&&(l=h.baseChance);}const c=s+i,d=l+o,u=r*c/100,f=r*d/100;return {goldChance:c,rainbowChance:d,expectedGold:u,expectedRainbow:f}}const IU={id:"hatch",label:"Hatching",icon:"🥚",category:"tracking",isAvailable:()=>true,getSummary:(e,t)=>{const r=De.myInventory.get().items.filter(o=>o.itemType==="Egg").reduce((o,i)=>o+(i.quantity||1),0);return r===0?null:{text:`${r} eggs`,variant:"neutral",tooltip:`${r} eggs in inventory`,priority:6}},buildPanel:(e,t)=>({update:()=>{},destroy:()=>{},refresh:()=>{}}),renderPetSlot:(e,t,n,r,o)=>{n.innerHTML="";const i=kn("div","hatching-stats-compact"),a=bn(e,da),s=bn(e,ua),l=bn(e,pa);if(!a&&!s&&!l)return;const c=[e];if(a){const d=Nw(c,o);d.length>0&&i.appendChild(Rd("DOUBLE HATCH",d));}if(s){const d=$w(c,o);d.length>0&&i.appendChild(Rd("PET REFUND",d));}if(l){const d=Dw(c,o),u=d.rainbowChance.toFixed(4),f=d.goldChance.toFixed(2),g=d.expectedRainbow<.01?`~${(d.expectedRainbow*100).toFixed(1)}%e`:d.expectedRainbow.toFixed(2),h=d.expectedGold.toFixed(2);i.appendChild(Ow(u,f,g,h));}n.appendChild(i);},renderGroupedSlot:(e,t,n,r,o)=>{n.innerHTML="";const i=kn("div","hatching-stats-compact"),a=e.some(c=>bn(c,da)),s=e.some(c=>bn(c,ua)),l=e.some(c=>bn(c,pa));if(!(!a&&!s&&!l)){if(a){const c=Nw(e,o);c.length>0&&i.appendChild(Rd("DOUBLE HATCH",c));}if(s){const c=$w(e,o);c.length>0&&i.appendChild(Rd("PET REFUND",c));}if(l){const c=Dw(e,o),d=c.rainbowChance.toFixed(4),u=c.goldChance.toFixed(2),f=c.expectedRainbow<.01?`~${(c.expectedRainbow*100).toFixed(1)}%e`:c.expectedRainbow.toFixed(2),g=c.expectedGold.toFixed(2);i.appendChild(Ow(d,u,f,g));}n.appendChild(i);}},hasContent:(e,t)=>(Array.isArray(e)?e:[e]).some(r=>bn(r,da)||bn(r,ua)||bn(r,pa)),shouldDisplay:(e,t,n)=>{const o=(sf.ALLOWED_PANELS[n.primary]||[]).includes("hatch"),i=t.some(a=>bn(a,da)||bn(a,ua)||bn(a,pa));return o&&i},countRows:(e,t)=>{const n=Array.isArray(e)?e:[e];let r=0;return n.some(o=>bn(o,da))&&r++,n.some(o=>bn(o,ua))&&r++,n.some(o=>bn(o,pa))&&r++,r}},Ah=[wU,xU,dm,IU];function PU(e){let t=e;return t=t.replace(/_NEW$/,""),t=t.replace(/^Snowy/,""),t=t.replace(/(I|II|III|IV)$/,""),t}function a1(e){return new Set(e.abilities.map(PU))}function $s(e,t){if(e.size!==t.size)return  false;for(const n of e)if(!t.has(n))return  false;return  true}function Fw(e,t){return a1(e).has(t)}function RU(e,t){if(e.length<2)return {shouldGroup:false,matchingPets:[],remainingPets:e};if(t){const a=t==="egg"?"EggGrowthBoost":"PlantGrowthBoost",s=e.filter(c=>Fw(c,a)),l=e.filter(c=>!Fw(c,a));return s.length>=2?{shouldGroup:true,matchingPets:s,remainingPets:l}:{shouldGroup:false,matchingPets:[],remainingPets:e}}const n=e.map(a=>({pet:a,abilities:a1(a)}));if(e.length===3){const[a,s,l]=n;if($s(a.abilities,s.abilities)&&$s(a.abilities,l.abilities))return {shouldGroup:true,matchingPets:[a.pet,s.pet,l.pet],remainingPets:[]}}const[r,o,i]=n;return $s(r.abilities,o.abilities)?{shouldGroup:true,matchingPets:[r.pet,o.pet],remainingPets:i?[i.pet]:[]}:i&&$s(r.abilities,i.abilities)?{shouldGroup:true,matchingPets:[r.pet,i.pet],remainingPets:[o.pet]}:i&&$s(o.abilities,i.abilities)?{shouldGroup:true,matchingPets:[o.pet,i.pet],remainingPets:[r.pet]}:{shouldGroup:false,matchingPets:[],remainingPets:e}}const MU=3;function LU(e,t){const n=e.abilities||[],r=c=>n.some(d=>c.includes(d));if((r(Pe.DOUBLE_HATCH)||r(Pe.PET_REFUND)||r(Pe.PET_MUTATION)||r(Pe.MAX_STR_BOOST))&&t.some(c=>c.id==="hatch"))return "hatch";if((r(Pe.COIN_FINDER)||r(Pe.SELL_BOOST)||r(Pe.CROP_REFUND_HARVEST)||r(Pe.CROP_SIZE)||r(Pe.CROP_MUTATION)||r(Pe.RARE_GRANTERS)||r(Pe.COMMON_GRANTERS))&&t.some(c=>c.id==="coin"))return "coin";if((r(Pe.EGG_GROWTH)||r(Pe.PLANT_GROWTH))&&t.some(c=>c.id==="growth"))return "growth";const s=e.currentStrength<e.maxStrength,l=r(Pe.XP_BOOST);return (s||l)&&t.some(c=>c.id==="xp")?"xp":t[0]?.id||"xp"}class s1{constructor(t){de(this,"expandedTeams",new Map);de(this,"featureUpdateInterval",null);de(this,"options");de(this,"tileFilter");this.options=t;}setTileFilter(t){this.tileFilter=t,this.refreshAllPanels();}refreshAllPanels(){for(const[t,n]of this.expandedTeams)this.updateSpecificTeam(t,n);}isExpanded(t){return this.expandedTeams.has(t)}toggle(t){this.expandedTeams.has(t)?this.collapse(t):this.expand(t);}expand(t,n=false,r){const o=this.options.getListContainer(),i=je.getTeam(t);if(!i||!o)return;const a=je.getPetsForTeam(i),s=De.myPets.get(),l=Ns(i),c=Ah.filter(P=>!(!P.isAvailable()||P.shouldDisplay&&!P.shouldDisplay(i,a,l)));if(c.length===0){console.warn("[TeamCardExpansion] No available features to display");return}const d=l.primary==="time-reduction"||To(a)||Io(a);let u;if(d){const P=To(a),O=Io(a),k=De.myGarden.get(),I=k.eggs.growing.length>0,R=k.crops.growing.length>0;P&&O?R&&!I?u="plant":I&&!R?u="egg":u="plant":O?u="plant":P&&(u="egg");}const f=x("div",{className:"team-expanded-container"}),g=[];let h=n?{shouldGroup:false,matchingPets:[],remainingPets:a}:this.analyzeTeamForGrouping(i,a,u);const y=c.some(P=>P.id==="growth"||P.id==="hatch"||P.id==="coin");if(h.shouldGroup&&!y&&(h.matchingPets.every(O=>O.currentStrength>=O.maxStrength)||(h={shouldGroup:false,matchingPets:[],remainingPets:a})),h.shouldGroup&&h.matchingPets.length>=2){const P=c.filter(I=>!I.hasContent||I.hasContent(h.matchingPets,i)),O=P.find(I=>I.id==="growth"||I.id==="hatch"||I.id==="coin")||P[0]||c[0],k=this.createGroupedPetRow(i,h.matchingPets,c,O,u,t);f.appendChild(k.container),g.push(k.cardState);for(const I of h.remainingPets){const R=i.petIds.indexOf(I.id),A=this.createIndividualPetRow(i,I,R,c,u,t);f.appendChild(A.container),g.push(A.cardState);}}else for(let P=0;P<3;P++){const O=i.petIds[P],k=O?s.all.find(R=>R.id===O)??null:null,I=this.createIndividualPetRow(i,k,P,c,u,t,r);f.appendChild(I.container),g.push(I.cardState);}this.expandedTeams.set(t,{cards:g,expandedAt:Date.now(),container:f,growthViewType:u});const S=r==="xp"?"xp":r==="growth"?"growth":void 0;this.addProgressBar(f,a,t,S);const _=je.getAllTeams().findIndex(P=>P.id===t),E=Array.from(o.children).filter(P=>P instanceof HTMLElement&&P.classList.contains("team-list-item"));_!==-1&&_<E.length&&E[_].insertAdjacentElement("afterend",f),this.startUpdates();}expandInto(t,n,r,o){const i=n.id,a=this.expandedTeams.get(i);if(a){for(const h of a.cards)h.shell&&h.shell.destroy();for(;t.firstChild;)t.removeChild(t.firstChild);this.expandedTeams.delete(i),this.expandedTeams.size===0&&this.stopUpdates();}const s=Ns(n),l=Ah.filter(h=>!(!h.isAvailable()||h.shouldDisplay&&!h.shouldDisplay(n,r,s)));if(l.length===0){console.warn("[TrackerExpansion] No available features for virtual team");return}const c=s.primary==="time-reduction"||To(r)||Io(r);let d;if(c){const h=To(r),y=Io(r),S=De.myGarden.get(),C=S.eggs.growing.length>0,_=S.crops.growing.length>0;h&&y?d=_&&!C?"plant":C&&!_?"egg":"plant":y?d="plant":h&&(d="egg");}let u=this.analyzeTeamForGrouping(n,r,d);const f=l.some(h=>h.id==="growth"||h.id==="hatch"||h.id==="coin");u.shouldGroup&&!f&&(u.matchingPets.every(y=>y.currentStrength>=y.maxStrength)||(u={shouldGroup:false,matchingPets:[],remainingPets:r}));const g=[];if(u.shouldGroup&&u.matchingPets.length>=2){const h=l.filter(C=>!C.hasContent||C.hasContent(u.matchingPets,n)),y=h.find(C=>C.id==="growth"||C.id==="hatch"||C.id==="coin")||h[0]||l[0],S=this.createGroupedPetRow(n,u.matchingPets,l,y,d,i);t.appendChild(S.container),g.push(S.cardState);for(const C of u.remainingPets){const _=n.petIds.indexOf(C.id),E=this.createIndividualPetRow(n,C,_,l,d,i);t.appendChild(E.container),g.push(E.cardState);}}else {const h=De.myPets.get();for(let y=0;y<3;y++){const S=n.petIds[y],C=S?h.all.find(E=>E.id===S)??null:null,_=this.createIndividualPetRow(n,C,y,l,d,i);t.appendChild(_.container),g.push(_.cardState);}}this.expandedTeams.set(i,{cards:g,expandedAt:Date.now(),container:t,growthViewType:d,virtualTeam:n,reexpandCallback:o?.reexpand}),this.addProgressBar(t,r,i),this.startUpdates();}collapse(t){const n=this.expandedTeams.get(t);if(n){for(const r of n.cards)r.shell&&r.shell.destroy();n.container.remove(),this.expandedTeams.delete(t),this.expandedTeams.size===0&&this.stopUpdates();}}cleanupAll(){const t=Array.from(this.expandedTeams.keys());for(const n of t)this.collapse(n);}destroy(){this.cleanupAll(),this.stopUpdates();}addProgressBar(t,n,r,o){const i=this.expandedTeams.get(r),a=i?.virtualTeam??je.getTeam(r),l=(a?Ns(a):null)?.primary==="time-reduction"||To(n)||Io(n),c=o??(l?"growth":"xp");i&&(i.currentBarMode=c),c==="growth"?this.renderGrowthSummaryBar(t,n,r):this.renderXpProgressBar(t,n);}updateProgressBarForFeature(t,n){const r=this.expandedTeams.get(t);if(!r)return;const o=r.virtualTeam??je.getTeam(t);if(!o||n!=="xp"&&n!=="growth")return;const i=je.getPetsForTeam(o),a=n==="xp"?"xp":"growth";if(r.currentBarMode===a)return;const s=r.container.querySelector(".growth-summary-overhaul"),l=r.container.querySelector(".team-progress-bar:not(.team-progress-bar--egg):not(.team-progress-bar--plant)");s&&s.remove(),l&&l.remove(),this.addProgressBar(r.container,i,t,a);}renderXpProgressBar(t,n){if(n.some(o=>o.currentStrength<o.maxStrength)&&n.length>0){const o=Math.round(n.reduce((c,d)=>c+d.currentStrength/d.maxStrength,0)/n.length*100),i=x("div",{className:"team-progress-bar"}),a=o<33?"low":o<67?"medium":"high",s=x("div",{className:`team-progress-bar__fill team-progress-bar__fill--${a}`});s.style.width=`${o}%`;const l=x("div",{className:"team-progress-bar__percent",textContent:`${o}%`});i.appendChild(s),i.appendChild(l),t.prepend(i);}}renderGrowthSummaryBar(t,n,r){const o=this.expandedTeams.get(r),i=o?.growthViewType||"plant",a=De.myGarden.get(),s=Date.now(),l=i==="egg"?a.eggs.growing:a.crops.growing,c=this.tileFilter?l.filter(W=>this.tileFilter.has(W.tileIndex)):l,d=c.length,u=Xb(n),f=Yb(n),g=Kl(u).timeReductionPerHour,h=Kl(f).timeReductionPerHour,y=Math.round(i==="egg"?g:h);let S=d>0?0:100;if(d>0){const W=(60+y)/60;S=Math.round(c.reduce((te,ne)=>{const ie=i==="egg"?ne.plantedAt:ne.startTime,ee=i==="egg"?ne.maturedAt:ne.endTime,U=s-ie,D=(ee-s)/W,j=U+D,Q=j>0?U/j*100:0;return te+Math.min(100,Math.max(0,Q))},0)/d);}let C=c.find(W=>W.tileIndex===o?.pinnedItemId);!C&&d>0&&(C=[...c].sort((W,te)=>{const ne=i==="egg"?W.maturedAt:W.endTime,ie=i==="egg"?te.maturedAt:te.endTime;return ne-ie})[0]);const _=x("div",{className:"growth-summary-overhaul"}),E=x("div",{className:`team-progress-bar team-progress-bar--${i}`}),P=x("div",{className:`team-progress-bar__fill team-progress-bar__fill--${i}`});P.style.width=`${S}%`;const O=W=>{const te=Math.floor(W/60),ne=W%60;return te>0&&ne>0?`${te}h ${ne}m/h`:te>0?`${te}h/h`:`${ne}m/h`};y>0&&((60+y)/60).toFixed(2)+"";const k=x("div",{className:"team-progress-bar__overlay"});k.innerHTML=`
            <span class="bar-percent">${S}%</span>
            <span class="bar-info">${d} total +${O(y)}</span>
        `,E.appendChild(P),E.appendChild(k);const I=x("div",{className:"growth-next-item"});if(C){let W=i==="egg"?C.eggId:C.species;const te=i==="egg"?"pet":"plant";i==="plant"&&W&&(W==="DawnCelestial"&&(W="DawnCelestialCrop"),W==="MoonCelestial"&&(W="MoonCelestialCrop"));const ne=i==="egg"?C.maturedAt:C.endTime;i==="egg"?C.plantedAt:C.startTime;const ie=(60+y)/60,ee=Math.max(0,Math.round((ne-s)/ie)),U=s+ee,X=new Date(U),D=X.getDate()!==new Date().getDate(),j=X.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}).toLowerCase(),Q=`${D?"Tomorrow ":""}${j}`,ae=we=>{const Ie=Math.floor(we/1e3),Ve=Math.floor(Ie/60),kt=Math.floor(Ve/60);return kt>0?`${kt}h ${Ve%60}m ${Ie%60}s`:Ve>0?`${Ve}m ${Ie%60}s`:`${Ie}s`},le=x("div",{className:"growth-next-sprite"});try{if(me.isReady()&&me.has(te,W)){const we=me.toCanvas(te,W,{scale:.3});we.style.height="20px",we.style.width="auto",we.style.imageRendering="pixelated",le.appendChild(we);}else le.textContent=i==="egg"?"🥚":"🌱";}catch(we){console.warn("[GrowthSummary] Sprite error:",we),le.textContent=i==="egg"?"🥚":"🌱";}I.innerHTML=`
                <div class="growth-next-details">
                    <span class="growth-next-time">${ae(ee)}</span>
                    <span class="growth-next-date">| ${Q}</span>
                </div>
            `,I.prepend(le);}else I.innerHTML='<span class="empty-text">No items growing</span>';const R=x("div",{className:"growth-overhaul-controls"}),A=i==="egg"?"UncommonEgg":"Carrot",L=i==="egg"?"pet":"plant";let F=null;try{me.isReady()&&me.has(L,A)&&(F=me.toCanvas(L,A,{scale:.35}));}catch{}const G=gU({variant:i==="egg"?"egg":"plant",sprite:F,playSound:true,tooltip:`Switch to ${i==="egg"?"plants":"eggs"}`,onClick:W=>{W.stopPropagation(),o&&(o.growthViewType=i==="egg"?"plant":"egg",o.pinnedItemId=void 0,this.updateGrowthSummary(r));}}),q=x("button",{className:"growth-dropdown-overhaul",textContent:"▼"});q.onclick=W=>{W.stopPropagation(),this.showGrowthDropdown(q,c,i,r);},g>0&&h>0&&R.appendChild(G),R.appendChild(q),_.appendChild(E),_.appendChild(I),_.appendChild(R);const ce=t.querySelector(".growth-summary-overhaul");ce?ce.replaceWith(_):t.prepend(_);}updateGrowthSummary(t){const n=this.expandedTeams.get(t);if(n){const r=n.virtualTeam??je.getTeam(t);if(!r)return;const o=je.getPetsForTeam(r);this.renderGrowthSummaryBar(n.container,o,t);const i=this.analyzeTeamForGrouping(r,o,n.growthViewType),a=n.cards.some(l=>l.slotIndex===-1),s=i.shouldGroup&&i.matchingPets.length>=2;if(a!==s){if(n.virtualTeam){requestAnimationFrame(()=>this.rebuildInPlace(t,false));return}this.collapse(t),requestAnimationFrame(()=>this.expand(t,false));return}if(a&&s){const l=n.cards.find(c=>c.slotIndex===-1);if(l?.shell&&(l.shell.root.classList.contains("base-pet-card--grouped")?3:l.shell.root.classList.contains("base-pet-card--grouped-2")?2:0)!==i.matchingPets.length){if(n.virtualTeam){requestAnimationFrame(()=>this.rebuildInPlace(t,false));return}this.collapse(t),requestAnimationFrame(()=>this.expand(t,false));return}}this.updateGroupedCardsViewType(t,n),this.updateSpecificTeam(t,n);}}updateSpecificTeam(t,n){const r=n.virtualTeam??je.getTeam(t);if(!r)return;const o=De.myPets.get();for(const i of n.cards){const a=r.petIds[i.slotIndex],s=a?o.all.find(l=>l.id===a):null;if(s&&i.shell&&(i.shell.update(s),i.featureData.renderPetSlot))try{const l=i.shell.getContentSlot();i.featureData.renderPetSlot(s,r,l,n.growthViewType,this.tileFilter);const c=s.currentStrength>=s.maxStrength,d=l.children.length>0||l.textContent.trim().length>0;i.shell.setCentered(c&&!d);}catch(l){console.error(`[TeamCardExpansion] Failed to render slot for ${s.id}:`,l);}}}updateGroupedCardsViewType(t,n){const r=n.virtualTeam??je.getTeam(t);if(r){for(const o of n.cards)if(o.slotIndex===-1&&o.shell){const i=o.shell.getContentSlot();if(o.featureData.renderGroupedSlot&&o.shell.root.classList.contains("base-pet-card--grouped")){i.innerHTML="";const a=je.getPetsForTeam(r);o.featureData.renderGroupedSlot(a,r,i,n.growthViewType,this.tileFilter);const s=i.children.length>0||i.textContent.trim().length>0;o.shell.setCentered(!s);}}}}showGrowthDropdown(t,n,r,o){const i=document.querySelector(".growth-dropdown-menu");if(i){const c=i.getAttribute("data-owner-id")===o&&i.getAttribute("data-view-type")===r;if(i.remove(),c)return}const a=x("div",{className:"growth-dropdown-menu"});if(a.setAttribute("data-owner-id",o),a.setAttribute("data-view-type",r),n.length===0){const c=x("div",{className:"growth-dropdown-option"});c.textContent="No items growing",a.appendChild(c);}else {const c=r==="egg"?"pet":"plant";n.forEach(d=>{const u=d.tileIndex;let f=r==="egg"?d.eggId:d.species;r==="plant"&&(f==="DawnCelestial"&&(f="DawnCelestialCrop"),f==="MoonCelestial"&&(f="MoonCelestialCrop"));const g=x("div",{className:"growth-dropdown-option"}),h=x("span",{className:"dropdown-sprite"});try{if(me.isReady()&&me.has(c,f)){const E=me.toCanvas(c,f,{scale:.3});E.style.height="16px",E.style.width="auto",E.style.imageRendering="pixelated",h.appendChild(E);}else h.textContent=r==="egg"?"🥚":"🌱";}catch{h.textContent=r==="egg"?"🥚":"🌱";}const y=r==="egg"?d.maturedAt:d.endTime,C=new Date(y).toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}).toLowerCase(),_=x("span",{className:"dropdown-text"});_.textContent=`${f} - ${C}`,g.appendChild(h),g.appendChild(_),g.onclick=E=>{E.stopPropagation();const P=this.expandedTeams.get(o);P&&(P.pinnedItemId=u,this.updateGrowthSummary(o)),a.remove();},a.appendChild(g);});}const s=t.getBoundingClientRect();a.style.position="fixed",a.style.bottom=`${window.innerHeight-s.top+4}px`,a.style.top="auto",a.style.left="auto",a.style.right=`${window.innerWidth-s.right}px`,a.style.marginTop="0",a.style.zIndex="999999",document.body.appendChild(a);const l=c=>{!a.contains(c.target)&&c.target!==t&&(a.remove(),document.removeEventListener("click",l,true));};setTimeout(()=>document.addEventListener("click",l,true),10);}createIndividualPetRow(t,n,r,o,i,a,s){const l=n?o.filter(O=>!O.hasContent||O.hasContent(n,t)):o,c=l.length>0?l:o;let d=c[0];if(s)d=c.find(O=>O.id===s)||c[0];else if(n){const O=LU(n,c);d=c.find(k=>k.id===O)||c[0];}else {const k=Ns(t)?.suggestedFeatures||[];let I=false;for(const R of k){const A=c.find(L=>L.id===R);if(A){d=A,I=true;break}}I||(i?d=c.find(R=>R.id==="growth")||c[0]:d=c.find(R=>R.id==="xp")||c[0]);}const u=x("div",{className:"expanded-pet-row"}),f=x("div",{className:"pet-row__header"}),g=x("button",{textContent:"<",className:"pet-row__nav"}),h=x("div",{textContent:`${d.icon} ${d.label.toUpperCase()}`,className:"pet-label"}),y=x("button",{textContent:">",className:"pet-row__nav"});let S=null;n&&(S=new pU(n));const C={slotIndex:r,currentFeatureId:d.id,shell:S,featureData:d},_=O=>{const k=c[O];if(k.id==="growth"){const I=je.getPetsForTeam(t),R=this.expandedTeams.get(a),A=this.analyzeTeamForGrouping(t,I,R?.growthViewType);if(A.shouldGroup&&A.matchingPets.length>=2){this.collapseAndReexpandForGrowth(a);return}}if(h.textContent=`${k.icon} ${k.label.toUpperCase()}`,S&&n){const I=S.getContentSlot();if(I.innerHTML="",k.renderPetSlot){const L=this.expandedTeams.get(a);k.renderPetSlot(n,t,I,L?.growthViewType,this.tileFilter);}const R=n.currentStrength>=n.maxStrength,A=I.children.length>0||I.textContent.trim().length>0;S.setCentered(R&&!A);}C.currentFeatureId=k.id,C.featureData=k,f.className=`pet-row__header pet-row__header--${k.id}`,this.updateProgressBarForFeature(a,k.id);};f.className=`pet-row__header pet-row__header--${d.id}`;let E=c.findIndex(O=>O.id===d.id);g.addEventListener("click",O=>{O.stopPropagation(),E=(E-1+c.length)%c.length,_(E);}),y.addEventListener("click",O=>{O.stopPropagation(),E=(E+1)%c.length,_(E);}),c.length>1&&f.appendChild(g),f.appendChild(h),c.length>1&&f.appendChild(y);let P;if(S&&n){if(P=S.build(),d.renderPetSlot){const O=S.getContentSlot();d.renderPetSlot(n,t,O,i,this.tileFilter);const k=n.currentStrength>=n.maxStrength,I=O.children.length>0||O.textContent.trim().length>0;S.setCentered(k&&!I);}}else P=x("div",{className:"pet-row__content pet-row__content--empty"}),P.innerHTML=`
                <div class="pet-row__sprite"><div class="pet-row__empty-slot">Empty</div></div>
                <div class="pet-row__info"><span class="pet-row__empty-text">No pet assigned</span></div>
            `;return u.appendChild(f),u.appendChild(P),C.container=u,{container:u,cardState:C}}createGroupedPetRow(t,n,r,o,i,a){const s=r.filter(I=>!I.hasContent||I.hasContent(n,t)),l=s.length>0?s:r;if(this.shouldUseCombinedPanel(l,n,t,i))return this.createCombinedPanelRow(t,n,l,i,a);const c=x("div",{className:"expanded-pet-row expanded-pet-row--grouped"}),d=x("div",{className:"pet-row__header"}),u=x("button",{textContent:"<",className:"pet-row__nav"}),f=x("div",{textContent:`${o.icon} ${o.label.toUpperCase()}`,className:"pet-label"}),g=x("button",{textContent:">",className:"pet-row__nav"}),h=x("div",{className:`base-pet-card base-pet-card--grouped${n.length===2?"-2":""}`}),y=x("div",{className:"base-pet-card__left"}),S=x("div",{className:`grouped-sprite-container${n.length===2?" grouped-sprite-container--duo":""}`});for(const I of n)try{const R=I.mutations||[];if(me.has("pet",I.petSpecies)){const A=me.toCanvas("pet",I.petSpecies,{mutations:R,scale:1,boundsMode:"padded"});A.style.imageRendering="pixelated",S.appendChild(A);}}catch{}y.appendChild(S);const C=x("div",{className:`grouped-badges${n.length===2?" grouped-badges--duo":""}`});for(const I of n){const A=I.currentStrength>=I.maxStrength?`MAX ${I.maxStrength}`:`STR ${I.currentStrength}/${I.maxStrength}`,L=x("span",{className:"badge badge--neutral badge--soft badge--sm badge--pill",textContent:A});C.appendChild(L);}y.appendChild(C),h.appendChild(y);const _=x("div",{className:"base-pet-card__content"});h.appendChild(_);const E={root:h,getContentSlot:()=>_,setCentered:I=>{h.classList.toggle("base-pet-card--centered",I);},destroy:()=>{h.remove();},update:()=>{C.innerHTML="";for(const I of n){const A=I.currentStrength>=I.maxStrength?`MAX ${I.maxStrength}`:`STR ${I.currentStrength}/${I.maxStrength}`,L=x("span",{className:"badge badge--neutral badge--soft badge--sm badge--pill",textContent:A});C.appendChild(L);}}},P={slotIndex:-1,currentFeatureId:o.id,shell:E,featureData:o},O=I=>{const R=l[I];if(R.id==="xp"&&!n.every(F=>F.currentStrength>=F.maxStrength)){this.collapseAndReexpandForXP(a);return}if(f.textContent=`${R.icon} ${R.label.toUpperCase()}`,_.innerHTML="",R.renderGroupedSlot){const L=this.expandedTeams.get(a);R.renderGroupedSlot(n,t,_,L?.growthViewType,this.tileFilter);}else if(R.renderPetSlot){const L=this.expandedTeams.get(a);R.renderPetSlot(n[0],t,_,L?.growthViewType,this.tileFilter);}const A=_.children.length>0||_.textContent.trim().length>0;E.setCentered(!A),P.currentFeatureId=R.id,P.featureData=R,d.className=`pet-row__header pet-row__header--${R.id}`;};d.className=`pet-row__header pet-row__header--${o.id}`;let k=l.findIndex(I=>I.id===o.id);return u.addEventListener("click",I=>{I.stopPropagation(),k=(k-1+l.length)%l.length,O(k);}),g.addEventListener("click",I=>{I.stopPropagation(),k=(k+1)%l.length,O(k);}),l.length>1&&d.appendChild(u),d.appendChild(f),l.length>1&&d.appendChild(g),o.renderGroupedSlot?o.renderGroupedSlot(n,t,_,i,this.tileFilter):o.renderPetSlot&&o.renderPetSlot(n[0],t,_,i,this.tileFilter),c.appendChild(d),c.appendChild(h),h.classList.add("base-pet-card--grouped"),{container:c,cardState:{...P,container:c}}}collapseAndReexpandForXP(t){const n=this.expandedTeams.get(t);if(!n){this.collapse(t),setTimeout(()=>this.expand(t,true,"xp"),100);return}n.container.style.transition="opacity 0.15s ease-out",n.container.style.opacity="0.4",requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.rebuildInPlace(t,true,"xp"),n.container.style.opacity="1";});});}collapseAndReexpandForGrowth(t){const n=this.expandedTeams.get(t);if(!n){this.collapse(t),setTimeout(()=>this.expand(t,false,"growth"),100);return}n.container.style.transition="opacity 0.15s ease-out",n.container.style.opacity="0.4",requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.rebuildInPlace(t,false,"growth"),n.container.style.opacity="1";});});}rebuildInPlace(t,n,r){const o=this.expandedTeams.get(t);if(!o)return;const i=o.virtualTeam??je.getTeam(t);if(!i)return;const a=je.getPetsForTeam(i),s=De.myPets.get(),l=this.getAvailableFeaturesForTeam(i,a),c=o.growthViewType;for(const y of o.cards)y.shell&&y.shell.destroy(),y.container&&y.container.parentNode&&y.container.remove();const d=o.container.querySelector(".team-progress-bar");d&&d.remove();const u=[];let f=n?{shouldGroup:false,matchingPets:[],remainingPets:a}:this.analyzeTeamForGrouping(i,a,c);const g=l.some(y=>y.id==="growth"||y.id==="hatch"||y.id==="coin");if(f.shouldGroup&&!g&&(f.matchingPets.every(S=>S.currentStrength>=S.maxStrength)||(f={shouldGroup:false,matchingPets:[],remainingPets:a})),f.shouldGroup&&f.matchingPets.length>=2){const y=l.filter(_=>!_.hasContent||_.hasContent(f.matchingPets,i)),S=y.find(_=>_.id==="growth"||_.id==="hatch"||_.id==="coin")||y[0]||l[0],C=this.createGroupedPetRow(i,f.matchingPets,l,S,c,t);o.container.appendChild(C.container),u.push(C.cardState);for(const _ of f.remainingPets){const E=i.petIds.indexOf(_.id),P=this.createIndividualPetRow(i,_,E,l,c,t);o.container.appendChild(P.container),u.push(P.cardState);}}else for(let y=0;y<3;y++){const S=i.petIds[y],C=S?s.all.find(E=>E.id===S)??null:null,_=this.createIndividualPetRow(i,C,y,l,c,t,r);o.container.appendChild(_.container),u.push(_.cardState);}o.cards=u;const h=r==="xp"?"xp":r==="growth"?"growth":void 0;this.addProgressBar(o.container,a,t,h);}getAvailableFeaturesForTeam(t,n){return Ns(t),Ah.filter(r=>r.isAvailable())}countTotalRows(t,n,r,o){let i=0;for(const a of t)a.countRows?i+=a.countRows(n,r,o):a.hasContent?.(n,r)&&(i+=1);return i}shouldUseCombinedPanel(t,n,r,o){return t.length<2?false:this.countTotalRows(t,n,r,o)<=MU}createCombinedPanelRow(t,n,r,o,i){const a=x("div",{className:"expanded-pet-row expanded-pet-row--combined"}),s=x("div",{className:"pet-row__header pet-row__header--combined"}),l=x("span",{className:"combined-panel__icons",textContent:r.map(C=>C.icon).join(" ")});s.appendChild(l);const c=x("div",{textContent:"COMBINED",className:"pet-label"});s.appendChild(c);const d=x("div",{className:`base-pet-card base-pet-card--grouped${n.length===2?"-2":""}`}),u=x("div",{className:"base-pet-card__left"}),f=x("div",{className:`grouped-sprite-container${n.length===2?" grouped-sprite-container--duo":""}`});for(const C of n)try{const _=C.mutations||[];if(me.has("pet",C.petSpecies)){const E=me.toCanvas("pet",C.petSpecies,{mutations:_,scale:1,boundsMode:"padded"});E.style.imageRendering="pixelated",f.appendChild(E);}}catch{}u.appendChild(f);const g=x("div",{className:`grouped-badges${n.length===2?" grouped-badges--duo":""}`});for(const C of n){const E=C.currentStrength>=C.maxStrength?`MAX ${C.maxStrength}`:`STR ${C.currentStrength}/${C.maxStrength}`,P=x("span",{className:"badge badge--neutral badge--soft badge--sm badge--pill",textContent:E});g.appendChild(P);}u.appendChild(g),d.appendChild(u);const h=x("div",{className:"base-pet-card__content base-pet-card__content--combined"});for(const C of r){const _=x("div",{className:`combined-section combined-section--${C.id}`}),E=x("span",{className:"combined-section__icon",textContent:C.icon});_.appendChild(E);const P=x("div",{className:"combined-section__content"});C.renderGroupedSlot?C.renderGroupedSlot(n,t,P,o,this.tileFilter):C.renderPetSlot&&C.renderPetSlot(n[0],t,P,o,this.tileFilter),(P.children.length>0||P.textContent?.trim())&&(_.appendChild(P),h.appendChild(_));}d.appendChild(h);const S={slotIndex:-1,currentFeatureId:"combined",shell:{root:d,getContentSlot:()=>h,setCentered:C=>{d.classList.toggle("base-pet-card--centered",C);},destroy:()=>{d.remove();},update:()=>{g.innerHTML="";for(const C of n){const E=C.currentStrength>=C.maxStrength?`MAX ${C.maxStrength}`:`STR ${C.currentStrength}/${C.maxStrength}`,P=x("span",{className:"badge badge--neutral badge--soft badge--sm badge--pill",textContent:E});g.appendChild(P);}},build:()=>d},container:a,featureData:r[0]};return a.appendChild(s),a.appendChild(d),{container:a,cardState:S}}analyzeTeamForGrouping(t,n,r){const o=c=>(c.abilities||[]).some(u=>Pe.MAX_STR_BOOST.includes(u)||Pe.PET_MUTATION.includes(u)||Pe.DOUBLE_HATCH.includes(u)||Pe.PET_REFUND.includes(u)),i=n.filter(o);if(i.length>=2&&i.length<=3){const c=n.filter(d=>!i.includes(d));return {shouldGroup:true,matchingPets:i,remainingPets:c}}const a=["DoubleHarvest","ProduceRefund","ProduceRefundII"],s=c=>(c.abilities||[]).some(u=>a.includes(u)),l=n.filter(s);if(l.length>=2&&l.length<=3&&!l.some(d=>(d.abilities||[]).some(f=>Pe.EGG_GROWTH.includes(f)||Pe.PLANT_GROWTH.includes(f)||Pe.CROP_MUTATION.includes(f)))){const d=n.filter(u=>!l.includes(u));return {shouldGroup:true,matchingPets:l,remainingPets:d}}return RU(n,r)}startUpdates(){if(this.featureUpdateInterval!==null)return;const n=Vt.detect().platform==="mobile"?8e3:5e3;this.featureUpdateInterval=setInterval(()=>{this.updateAllFeatures();},n);}stopUpdates(){this.featureUpdateInterval!==null&&(clearInterval(this.featureUpdateInterval),this.featureUpdateInterval=null);}updateAllFeatures(){for(const[t,n]of this.expandedTeams)this.updateSpecificTeam(t,n);}}const OU={calculationScope:"all",selectedTileIndices:[],expandedTeamIds:[]};let en=null,Th=null;async function NU(){return en||(Th||(Th=co("tab-trackers",{version:3,defaults:OU})),en=await Th,en)}function La(){if(!en)throw new Error("[TrackersState] State not initialized. Call initTrackersState() first.");return en}function $U(e){if(!en)return;const t=en.get();t.expandedTeamIds.includes(e)?en.update({expandedTeamIds:t.expandedTeamIds.filter(r=>r!==e)}):en.update({expandedTeamIds:[...t.expandedTeamIds,e]});}function DU(e){en&&en.update({calculationScope:e});}function Ih(e){if(!en)return;const t=en.get();t.selectedTileIndices.includes(e)?en.update({selectedTileIndices:t.selectedTileIndices.filter(r=>r!==e)}):en.update({selectedTileIndices:[...t.selectedTileIndices,e]});}function FU(){en&&en.update({selectedTileIndices:[]});}class BU{constructor(t={}){de(this,"dropdown",null);de(this,"options");de(this,"isDragging",false);de(this,"dragSelectMode",null);this.options=t,document.addEventListener("pointerup",()=>{this.isDragging=false,this.dragSelectMode=null;});}build(){if(this.dropdown)return this.dropdown;this.dropdown=x("div",{className:"tile-grid-selector"});const t=this.buildHeader();this.dropdown.appendChild(t);const n=this.buildGrids();return this.dropdown.appendChild(n),this.dropdown}show(){this.dropdown||this.build(),this.dropdown&&!this.dropdown.parentElement&&(this.options.container||document.body).appendChild(this.dropdown),this.dropdown&&this.dropdown.classList.add("tile-grid-selector--visible"),this.renderGrids();}hide(){this.dropdown&&this.dropdown.classList.remove("tile-grid-selector--visible");}destroy(){this.dropdown?.parentElement&&this.dropdown.parentElement.removeChild(this.dropdown),this.dropdown=null;}buildHeader(){const t=x("div",{className:"tile-grid-selector__header"}),r=La().get().selectedTileIndices.length,o=x("div",{className:"tile-grid-selector__info",textContent:`${r} tile${r!==1?"s":""} selected`}),i=x("button",{className:"tile-grid-selector__btn",textContent:"Clear All"});i.addEventListener("click",()=>{FU(),this.renderGrids(),this.options.onChange&&this.options.onChange();});const a=x("button",{className:"tile-grid-selector__close-btn",textContent:"×",title:"Close"});return a.addEventListener("click",()=>{this.hide();}),t.appendChild(o),t.appendChild(i),t.appendChild(a),t}buildGrids(){const t=x("div",{className:"tile-grid-selector__grids"}),n=x("div",{className:"tile-grid-selector__grid",id:"tile-grid-1"}),r=x("div",{className:"tile-grid-selector__grid",id:"tile-grid-2"});return t.appendChild(n),t.appendChild(r),t}renderGrids(){const t=this.dropdown?.querySelector("#tile-grid-1"),n=this.dropdown?.querySelector("#tile-grid-2");if(!t||!n)return;t.innerHTML="",n.innerHTML="";const r=De.myGarden.get(),o=De.gameMap.get(),i=La().get();if(!r.garden||!o)return;const a=r.mySlotIndex;if(a===null)return;const s=o.userSlots[a];if(!s)return;const l=s.dirtTiles,c=new Set(i.selectedTileIndices),d=r.garden.tileObjects,u=[...new Set(l.map(k=>k.position.x))].sort((k,I)=>k-I);let f=0,g=u[Math.floor(u.length/2)];for(let k=1;k<u.length;k++){const I=u[k]-u[k-1];I>f&&(f=I,g=(u[k]+u[k-1])/2);}const h=l.filter(k=>k.position.x<g),y=l.filter(k=>k.position.x>=g),S=k=>{if(k.length===0)return {minX:0,maxX:9,minY:0,maxY:9};const I=k.map(A=>A.position.x),R=k.map(A=>A.position.y);return {minX:Math.min(...I),maxX:Math.max(...I),minY:Math.min(...R),maxY:Math.max(...R)}},C=S(h),_=S(y),E=new Map,P=new Map;for(const k of h){const I=k.position.x-C.minX,R=k.position.y-C.minY;E.set(`${R},${I}`,k);}for(const k of y){const I=k.position.x-_.minX,R=k.position.y-_.minY;P.set(`${R},${I}`,k);}for(let k=0;k<10;k++)for(let I=0;I<10;I++){const R=E.get(`${k},${I}`)||null,A=this.buildTileElement(R,R&&d[R.localIndex.toString()]||null,R?c.has(R.localIndex.toString()):false);t.appendChild(A);}for(let k=0;k<10;k++)for(let I=0;I<10;I++){const R=P.get(`${k},${I}`)||null,A=this.buildTileElement(R,R&&d[R.localIndex.toString()]||null,R?c.has(R.localIndex.toString()):false);n.appendChild(A);}const O=this.dropdown?.querySelector(".tile-grid-selector__info");O&&(O.textContent=`${c.size} tile${c.size!==1?"s":""} selected`);}buildTileElement(t,n,r){const o=x("button",{className:"tile-grid-selector__tile"});if(!t)return o.classList.add("tile-grid-selector__tile--null"),o.disabled=true,o;if(r&&o.classList.add("tile-grid-selector__tile--selected"),n?o.classList.add("tile-grid-selector__tile--occupied"):o.classList.add("tile-grid-selector__tile--empty"),n&&me.isReady()){const i=this.getSpriteForTileObject(n);i&&o.appendChild(i);}return o.addEventListener("pointerdown",i=>{i.preventDefault(),this.isDragging=true,this.dragSelectMode=r?"deselect":"select",Ih(t.localIndex.toString()),this.renderGrids(),this.options.onChange?.();}),o.addEventListener("pointerenter",()=>{if(!this.isDragging||!this.dragSelectMode)return;const a=La().get().selectedTileIndices.includes(t.localIndex.toString());this.dragSelectMode==="select"&&!a?(Ih(t.localIndex.toString()),this.renderGrids(),this.options.onChange?.()):this.dragSelectMode==="deselect"&&a&&(Ih(t.localIndex.toString()),this.renderGrids(),this.options.onChange?.());}),o}getSpriteForTileObject(t){try{if(t.objectType==="plant"){let n=t.species;if(n==="DawnCelestial"&&(n="DawnCelestialCrop"),n==="MoonCelestial"&&(n="MoonCelestialCrop"),me.has("plant",n)){const r=me.toCanvas("plant",n,{scale:.25});return r.style.height="100%",r.style.width="100%",r.style.objectFit="contain",r.style.imageRendering="pixelated",r}}else if(t.objectType==="egg"){const n=t.eggId;if(me.has("pet",n)){const r=me.toCanvas("pet",n,{scale:.25});return r.style.height="100%",r.style.width="100%",r.style.objectFit="contain",r.style.imageRendering="pixelated",r}}else if(t.objectType==="decor"){const n=t.decorId;if(me.has("decor",n)){const r=me.toCanvas("decor",n,{scale:.25});return r.style.height="100%",r.style.width="100%",r.style.objectFit="contain",r.style.imageRendering="pixelated",r}}}catch(n){console.warn("[TileGridSelector] Failed to load sprite:",n);}return null}}class jU{constructor(t){de(this,"card",null);de(this,"scopeControl",null);de(this,"scopeContainer",null);de(this,"content",null);de(this,"listContainer",null);de(this,"options");de(this,"tileGridOverlay",null);de(this,"expansionHandler");this.options=t,this.expansionHandler=new s1({getListContainer:()=>this.listContainer});}build(){return this.card?this.card:this.createCard()}destroy(){this.expansionHandler.destroy(),this.scopeControl&&(this.scopeControl.destroy(),this.scopeControl=null),this.tileGridOverlay&&(this.tileGridOverlay.destroy?.(),this.tileGridOverlay=null),this.card=null,this.scopeContainer=null,this.content=null,this.listContainer=null;}render(){if(!this.card)return;if(!je.isEnabled()){this.renderDisabledState();return}this.scopeContainer&&(this.scopeContainer.style.display="flex"),this.ensureScopeControl(),this.renderTeamList();}getListContainer(){return this.listContainer}createCard(){const t=x("div",{className:"tracker-card-wrapper"});this.scopeContainer=x("div",{className:"tracker-card__scope-container"}),t.appendChild(this.scopeContainer),this.content=x("div",{className:"tracker-card__content"}),t.appendChild(this.content);const n=dt({title:"Trackers",expandable:true,defaultExpanded:true},t);return this.card=n,n}ensureScopeControl(){if(!this.scopeContainer)return;const t=La().get();if(!this.scopeControl){this.scopeControl=Ui({segments:[{id:"all",label:"All Tiles"},{id:"selected",label:"Selected Tiles"}],selected:t.calculationScope,onChange:n=>{const r=n;DU(r),r==="selected"?this.showTileGridOverlay():this.tileGridOverlay?.hide(),this.renderTeamList();}}),this.scopeContainer.appendChild(this.scopeControl);return}this.scopeControl.getSelected()!==t.calculationScope&&this.scopeControl.select(t.calculationScope);}showTileGridOverlay(){this.tileGridOverlay||(this.tileGridOverlay=new BU({onChange:()=>{this.renderTeamList();},container:this.scopeContainer||void 0}),this.tileGridOverlay.build()),this.tileGridOverlay.show();}renderDisabledState(){if(!this.content)return;this.expansionHandler.cleanupAll(),this.listContainer=null,this.scopeContainer&&(this.scopeContainer.style.display="none");const t=x("div",{className:"tracker-card__disabled-state"}),n=x("div",{textContent:"Pet Teams feature is not enabled",className:"tracker-card__disabled-message"});t.appendChild(n),this.content.replaceChildren(t);}renderTeamList(){if(!this.content)return;this.expansionHandler.cleanupAll(),this.content.replaceChildren();const t=je.getAllTeams(),n=je.getActiveTeamId(),r=La().get(),o=r.calculationScope==="selected"?new Set(r.selectedTileIndices):void 0;if(this.expansionHandler.setTileFilter(o),t.length===0){this.renderEmptyState();return}this.listContainer=x("div",{className:"tracker-card__list-container"}),t.forEach(i=>{const a=n===i.id,s=r.expandedTeamIds.includes(i.id),l=JE({team:i,isActive:a,hideDragHandle:true,isNameEditable:false,isExpanded:s,onExpandClick:()=>{this.handleExpandToggle(i.id);}});l.setAttribute("data-team-id",i.id),l.addEventListener("click",c=>{c.stopPropagation();}),this.listContainer.appendChild(l),s&&this.expansionHandler.expand(i.id);}),this.content.appendChild(this.listContainer);}renderEmptyState(){if(!this.content)return;const t=x("div",{className:"tracker-card__empty-state"}),n=x("div",{textContent:"No teams created yet.",className:"tracker-card__empty-message"}),r=x("div",{textContent:"Create teams in the Pets tab to view trackers.",className:"tracker-card__empty-hint"});t.appendChild(n),t.appendChild(r),this.content.appendChild(t);}handleExpandToggle(t){$U(t),this.expansionHandler.toggle(t);const n=this.listContainer?.querySelector(`[data-team-id="${t}"]`);if(n){const r=La().get().expandedTeamIds.includes(t),o=n.querySelector(".team-list-item__expand");o&&o.classList.toggle("team-list-item__expand--open",r);}}}const GU=`
/* ─────────────────────────────────────────────────────────────────────────── */
/* Card Wrapper                                                                 */
/* ─────────────────────────────────────────────────────────────────────────── */

.tracker-card-wrapper {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
  max-width: 100%;
  overflow-x: auto;
  box-sizing: border-box;
}

/* ─────────────────────────────────────────────────────────────────────────── */
/* Scope Container (All Tiles / Selected Tiles toggle)                         */
/* ─────────────────────────────────────────────────────────────────────────── */

.tracker-card__scope-container {
  position: relative; /* For tile grid overlay positioning */
  display: flex;
  justify-content: center;
  align-items: center;
  padding: var(--spacing-sm) 0;
}

/* Legacy mode-container class (deprecated, use scope-container) */
.tracker-card__mode-container {
  display: flex;
  justify-content: center;
  align-items: center;
  padding: var(--spacing-sm) 0;
}

/* ─────────────────────────────────────────────────────────────────────────── */
/* Content Container                                                            */
/* ─────────────────────────────────────────────────────────────────────────── */

.tracker-card__content {
  display: flex;
  flex-direction: column;
  max-width: 100%;
  overflow-x: visible;
}

/* ─────────────────────────────────────────────────────────────────────────── */
/* List Container                                                               */
/* ─────────────────────────────────────────────────────────────────────────── */

.tracker-card__list-container {
  display: flex;
  flex-direction: column;
  gap: 0;
  max-width: 100%;
  overflow-x: visible;
}

/* ─────────────────────────────────────────────────────────────────────────── */
/* Empty State                                                                  */
/* ─────────────────────────────────────────────────────────────────────────── */

.tracker-card__empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: var(--spacing-xl) var(--spacing-md);
  text-align: center;
  gap: var(--spacing-xs);
}

.tracker-card__empty-message {
  color: var(--fg);
  font-size: var(--font-size-md);
  font-weight: 500;
}

.tracker-card__empty-hint {
  color: var(--muted);
  font-size: var(--font-size-sm);
}

/* ─────────────────────────────────────────────────────────────────────────── */
/* Disabled State                                                               */
/* ─────────────────────────────────────────────────────────────────────────── */

.tracker-card__disabled-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: var(--spacing-xl) var(--spacing-md);
  text-align: center;
}

.tracker-card__disabled-message {
  color: var(--muted);
  font-size: var(--font-size-md);
}

/* ─────────────────────────────────────────────────────────────────────────── */
/* Override TeamListItem for Trackers context                                   */
/* ─────────────────────────────────────────────────────────────────────────── */

.tracker-card__list-container .team-list-item {
  /* Read-only: no hover cursor for team switching */
  cursor: default;
}

.tracker-card__list-container .team-list-item__expand {
  /* Ensure expand button is clickable */
  cursor: pointer;
}

/* ─────────────────────────────────────────────────────────────────────────── */
/* Expansion Container (injected by TeamCardExpansionHandler)                   */
/* ─────────────────────────────────────────────────────────────────────────── */

.tracker-card__list-container .team-expanded-container {
  margin-left: 0;
  margin-right: 0;
  border-radius: 0;
  max-width: 100%;
  overflow-x: hidden;
  box-sizing: border-box;
  /* Use existing Pets section styles via teamCard.css */
}
`,zU=`
  /* Container */
  .modal-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 99999;
    pointer-events: none;
    contain: layout;
    will-change: opacity;
  }

  .modal-container.is-open {
    pointer-events: auto;
  }

  /* Backdrop */
  .modal-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: color-mix(in oklab, var(--shadow) 85%, transparent);
    backdrop-filter: blur(0px);
    opacity: 0;
    transition: opacity 0.2s ease, backdrop-filter 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 16px;
    will-change: opacity, backdrop-filter;
  }

  .modal-container.is-open .modal-backdrop {
    opacity: 1;
    backdrop-filter: blur(4px);
  }

  /* Dialog */
  .modal-dialog {
    background: var(--paper);
    border: 1px solid color-mix(in oklab, var(--border) 70%, transparent);
    border-radius: 12px;
    box-shadow: 0 10px 40px color-mix(in oklab, var(--shadow) 65%, transparent);
    display: flex;
    flex-direction: column;
    max-height: 90vh;
    width: 100%;
    opacity: 0;
    transform: scale(0.95);
    transition: transform 0.2s ease, opacity 0.2s ease;
    will-change: transform, opacity;
  }

  .modal-container.is-open .modal-dialog {
    opacity: 1;
    transform: scale(1);
  }

  /* Dialog sizes */
  .modal-dialog--sm {
    max-width: 300px;
  }

  .modal-dialog--md {
    max-width: 450px;
  }

  .modal-dialog--lg {
    max-width: 600px;
  }

  /* Header */
  .modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 20px;
    border-bottom: 1px solid color-mix(in oklab, var(--border) 60%, transparent);
  }

  .modal-title-group {
    display: flex;
    flex-direction: column;
    gap: 4px;
    min-width: 0;
  }

  .modal-title {
    margin: 0;
    font-size: 18px;
    font-weight: 600;
    color: var(--fg);
    font-family: var(--font-ui, system-ui);
  }

  .modal-subtitle {
    margin: 0;
    font-size: 12px;
    color: color-mix(in oklab, var(--fg) 55%, transparent);
    font-family: var(--font-ui, system-ui);
  }

  .modal-close {
    appearance: none;
    background: none;
    border: none;
    color: color-mix(in oklab, var(--fg) 60%, transparent);
    cursor: pointer;
    font-size: 28px;
    line-height: 1;
    padding: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    transition: all 0.15s ease;
  }

  .modal-close:hover {
    background: color-mix(in oklab, var(--soft) 85%, transparent);
    color: var(--fg);
  }

  .modal-close:focus-visible {
    outline: none;
    box-shadow: 0 0 0 2px color-mix(in oklab, var(--accent) 45%, transparent);
  }

  /* Body */
  .modal-body {
    padding: 20px;
    overflow-y: auto;
    flex: 1;
    scrollbar-gutter: stable;
  }

  /* Custom scrollbar */
  .modal-body::-webkit-scrollbar {
    width: 8px;
  }

  .modal-body::-webkit-scrollbar-track {
    background: color-mix(in oklab, var(--soft) 50%, transparent);
    border-radius: 4px;
  }

  .modal-body::-webkit-scrollbar-thumb {
    background: color-mix(in oklab, var(--border) 80%, transparent);
    border-radius: 4px;
  }

  .modal-body::-webkit-scrollbar-thumb:hover {
    background: color-mix(in oklab, var(--border) 100%, transparent);
  }

  /* Footer */
  .modal-footer {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 8px;
    padding: 20px;
    border-top: 1px solid color-mix(in oklab, var(--border) 60%, transparent);
  }

  /* Responsive (Mobile) */
  @media (max-width: 640px) {
    .modal-backdrop {
      padding: 0;
    }

    .modal-dialog {
      max-height: 100vh;
      border-radius: 0;
      height: 100%;
    }

    .modal-dialog--sm,
    .modal-dialog--md,
    .modal-dialog--lg {
      max-width: 100%;
    }
  }
`,UU={size:"md",closeOnBackdrop:true,closeOnEscape:true};function df(e){const t={...UU,...e};let n=false,r=null,o=null,i=null,a=null,s=null;function l(){h(),t.onClose?.();}function c(O){t.closeOnBackdrop&&O.target===o&&l();}function d(O){t.closeOnEscape&&O.key==="Escape"&&l();}function u(){if(!i)return;const O=["a[href]","button:not([disabled])","textarea:not([disabled])","input:not([disabled])","select:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(","),k=Array.from(i.querySelectorAll(O));if(k.length===0)return;const I=k[0],R=k[k.length-1];I.focus();const A=L=>{L.key==="Tab"&&(L.shiftKey?document.activeElement===I&&(L.preventDefault(),R.focus()):document.activeElement===R&&(L.preventDefault(),I.focus()));};i.addEventListener("keydown",A),a=()=>{i?.removeEventListener("keydown",A);};}function f(){r=x("div",{className:"modal-container"}),r.setAttribute("role","dialog"),r.setAttribute("aria-modal","true"),r.setAttribute("aria-labelledby","modal-title");const O=x("style");O.textContent=zU,r.appendChild(O),o=x("div",{className:"modal-backdrop"}),o.addEventListener("click",c),r.appendChild(o),i=x("div",{className:`modal-dialog modal-dialog--${t.size}`});const k=x("div",{className:"modal-header"}),I=x("h2",{className:"modal-title",id:"modal-title"},t.title);if(t.subtitle){const L=x("div",{className:"modal-title-group"});L.appendChild(I),L.appendChild(x("p",{className:"modal-subtitle"},t.subtitle)),k.appendChild(L);}else k.appendChild(I);const R=x("button",{className:"modal-close",type:"button","aria-label":"Close modal"},"×");R.addEventListener("click",l),k.appendChild(R),i.appendChild(k);const A=x("div",{className:"modal-body"});if(A.appendChild(t.content),i.appendChild(A),t.footer){const L=x("div",{className:"modal-footer"});L.appendChild(t.footer),i.appendChild(L);}return o.appendChild(i),r}function g(){if(!r)return;const O=r.getBoundingClientRect(),k=window.innerWidth,I=window.innerHeight;Math.abs(O.left)>1||Math.abs(O.top)>1||Math.abs(O.width-k)>1||Math.abs(O.height-I)>1?(r.style.left=`${-O.left}px`,r.style.top=`${-O.top}px`,r.style.width=`${k}px`,r.style.height=`${I}px`):(r.style.left="0px",r.style.top="0px",r.style.width="100%",r.style.height="100%");}function h(){!n||!r||(r.classList.remove("is-open"),n=false,a&&(a(),a=null),document.removeEventListener("keydown",d),s?.(),s=null,setTimeout(()=>{r?.remove();},200));}function y(){n&&h(),o?.removeEventListener("click",c),a&&(a(),a=null),document.removeEventListener("keydown",d),s?.(),s=null,r?.remove(),r=null,o=null,i=null;}const S=f();((document.querySelector("#gemini-hud-root")||document.querySelector("#gemini-root")||document.querySelector("#gemini-hud-container"))?.shadowRoot||document.body||document.documentElement).appendChild(S),requestAnimationFrame(g);const P=()=>g();return window.addEventListener("resize",P),s=()=>{window.removeEventListener("resize",P);},requestAnimationFrame(()=>{r?.classList.add("is-open"),n=true,u(),document.addEventListener("keydown",d);}),{root:S,close:h,destroy:y}}const HU="gemini:active-tracker-virtual";class WU{constructor(t={}){de(this,"options");de(this,"expansionHandler");de(this,"card",null);de(this,"slotsContainer",null);de(this,"expansionContainer",null);de(this,"saveRow",null);de(this,"saveButton",null);de(this,"slots",[{petId:null,isOverride:false},{petId:null,isOverride:false},{petId:null,isOverride:false}]);de(this,"unsubMyPets");de(this,"cleanups",[]);this.options=t,this.expansionHandler=new s1({getListContainer:()=>null});}build(){if(this.card)return this.card;const t=x("div",{className:"active-team-card"});return this.slotsContainer=x("div",{className:"active-team-card__slots"}),t.appendChild(this.slotsContainer),this.expansionContainer=x("div",{className:"active-team-card__expansion team-expanded-container"}),t.appendChild(this.expansionContainer),this.saveRow=x("div",{className:"active-team-card__save-row"}),t.appendChild(this.saveRow),this.card=dt({title:"Active Pets",subtitle:"Your current active pet team — click a slot to compare",expandable:false,defaultExpanded:true},t),this.card}render(){this.card&&(this.syncToActivePets(),this.rebuildSlots(),this.rebuildExpansion(),this.updateSaveButton());}destroy(){this.cleanups.forEach(t=>t()),this.cleanups=[],this.unsubMyPets&&(this.unsubMyPets(),this.unsubMyPets=void 0),this.expansionHandler.destroy(),this.saveButton&&(this.saveButton.remove(),this.saveButton=null),this.card=null,this.slotsContainer=null,this.expansionContainer=null,this.saveRow=null;}subscribe(){let t=this.getActiveIds();this.unsubMyPets=De.myPets.subscribeStable(()=>{const n=this.getActiveIds();n.some((o,i)=>o!==t[i])&&(t=n,this.syncToActivePets(),this.rebuildSlots(),this.rebuildExpansion(),this.updateSaveButton());});}getActiveIds(){const n=De.myPets.get().byLocation.active??[];return [n[0]?.id??null,n[1]?.id??null,n[2]?.id??null]}syncToActivePets(){const[t,n,r]=this.getActiveIds();this.slots[0]={petId:t,isOverride:false},this.slots[1]={petId:n,isOverride:false},this.slots[2]={petId:r,isOverride:false};}buildVirtualTeam(){return {id:HU,name:"Active Pets",petIds:[this.slots[0].petId??"",this.slots[1].petId??"",this.slots[2].petId??""],createdAt:0,updatedAt:0}}resolveSlotPets(){const t=De.myPets.get();return this.slots.map(n=>n.petId?t.all.find(r=>r.id===n.petId):void 0).filter(n=>n!==void 0)}rebuildSlots(){if(!this.slotsContainer)return;this.slotsContainer.innerHTML="";const t=De.myPets.get();for(let n=0;n<3;n++){const r=this.slots[n],o=r.petId?t.all.find(c=>c.id===r.petId):null,i=x("button",{className:o?"active-team-card__slot":"active-team-card__slot active-team-card__slot--empty",type:"button"}),a=x("div",{className:"active-team-card__sprite"});if(o)try{if(me.isReady()&&me.has("pet",o.petSpecies)){const c=me.toCanvas("pet",o.petSpecies,{mutations:o.mutations??[],scale:.9,boundsMode:"padded"});c.style.imageRendering="pixelated",c.style.maxHeight="48px",c.style.width="auto",a.appendChild(c);}else a.textContent="🐾";}catch{a.textContent="🐾";}else {const c=x("div",{className:"active-team-card__sprite-placeholder"});c.textContent="+",a.appendChild(c);}i.appendChild(a);const s=x("span",{className:"active-team-card__slot-swap",textContent:"⇄"});if(i.appendChild(s),r.isOverride){const c=x("span",{className:"active-team-card__override-badge",textContent:"OVERRIDE"});i.appendChild(c);}const l=n;i.addEventListener("click",()=>{this.handleSlotClick(l);}),this.slotsContainer.appendChild(i);}}rebuildExpansion(){if(!this.expansionContainer)return;const t=this.buildVirtualTeam(),n=this.resolveSlotPets();this.expansionHandler.expandInto(this.expansionContainer,t,n,{reexpand:()=>this.rebuildExpansion()});}updateSaveButton(){this.saveRow&&(this.shouldShowSaveButton()?this.saveButton||(this.saveButton=Ct({label:"Save as Team",variant:"primary",size:"sm",onClick:()=>this.handleSaveAsTeam()}),this.saveRow.appendChild(this.saveButton)):this.saveButton&&(this.saveButton.remove(),this.saveButton=null));}async handleSlotClick(t){const r=De.myPets.get().all.map(f=>({id:f.id,itemType:"Pet",petSpecies:f.petSpecies,name:f.name??null,xp:f.xp,hunger:f.hunger,mutations:f.mutations??[],targetScale:f.targetScale,abilities:f.abilities??[]})),o=new Set(this.slots.filter((f,g)=>g!==t).map(f=>f.petId).filter(f=>f!==null)),i=r.filter(f=>!o.has(f.id));await rt.set("myPossiblyNoLongerValidSelectedItemIndexAtom",null);const a=Vt.detect();(a.platform==="mobile"||a.viewportWidth<768)&&this.options.setHUDOpen&&this.options.setHUDOpen(false);let l=null;const c=De.myInventory.subscribeSelection(f=>{f.current?.item&&(l=f.current.item.id,rt.set("myPossiblyNoLongerValidSelectedItemIndexAtom",null),eo.close());});await eo.show("inventory",{items:i,favoritedItemIds:[]}),await eo.waitForClose(),c();const d=Vt.detect();(d.platform==="mobile"||d.viewportWidth<768)&&this.options.setHUDOpen&&this.options.setHUDOpen(true),l&&(this.slots[t]={petId:l,isOverride:true},this.rebuildSlots(),this.rebuildExpansion(),this.updateSaveButton());}shouldShowSaveButton(){if(!this.slots.some(r=>r.isOverride))return  false;const n=this.slots.map(r=>r.petId??"");return !je.getAllTeams().some(r=>r.petIds[0]===n[0]&&r.petIds[1]===n[1]&&r.petIds[2]===n[2])}handleSaveAsTeam(){const t=new Set(je.getAllTeams().map(u=>u.name));let n="My Team",r=1;for(;t.has(n);)n=`My Team (${r++})`;const o=ic({value:n,placeholder:"Team name…",mode:"any",allowSpaces:true,maxLength:32,blockGameKeys:true}),i=x("div",{className:"active-team-name-input-wrapper"}),a=x("label",{textContent:"Enter a name for this team:"});i.appendChild(a),i.appendChild(o.root);const s=x("div",{className:"active-team-modal-footer"});let l=null;const c=Ct({label:"Cancel",variant:"default",size:"sm",onClick:()=>l?.close()}),d=Ct({label:"Save",variant:"primary",size:"sm",onClick:()=>{const u=o.getValue().trim();if(u)try{const f=this.slots.map(g=>g.petId??"");je.createTeam(u,f),l?.close(),this.slots=this.slots.map(g=>({...g,isOverride:!1})),this.rebuildSlots(),this.updateSaveButton();}catch{o.root.style.outline="2px solid var(--color-danger, red)",setTimeout(()=>{o.root.style.outline="";},1500);}}});o.root.addEventListener("keydown",u=>{u.key==="Enter"&&d.click();}),s.appendChild(c),s.appendChild(d),l=df({title:"Save as Pet Team",content:i,footer:s,size:"sm",closeOnBackdrop:true,closeOnEscape:true,onClose:()=>{o.destroy();}}),setTimeout(()=>o.focus(),50);}}const VU=`

/* ─────────────────────────────────────────────────────────────────────────── */
/* Card wrapper                                                                 */
/* ─────────────────────────────────────────────────────────────────────────── */

.active-team-card {
  display: flex;
  flex-direction: column;
  gap: 0;
}

/* ─────────────────────────────────────────────────────────────────────────── */
/* Slot header row (3 clickable pet sprites)                                    */
/* ─────────────────────────────────────────────────────────────────────────── */

.active-team-card__slots {
  display: flex;
  justify-content: space-around;
  align-items: flex-end;
  padding: var(--spacing-sm) var(--spacing-sm) 0;
  gap: var(--spacing-xs);
}

.active-team-card__slot {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--spacing-xs);
  flex: 1;
  min-width: 0;
  cursor: pointer;
  border-radius: var(--radius-md);
  padding: var(--spacing-xs);
  transition: background 0.15s ease;
  position: relative;
  /* min 44px touch target per Apple HIG */
  min-height: 44px;
}

.active-team-card__slot:hover {
  background: var(--color-bg-secondary, rgba(255,255,255,0.06));
}

.active-team-card__slot:focus-visible {
  outline: 2px solid var(--color-focus, var(--color-primary));
  outline-offset: 2px;
}

/* Sprite canvas wrapper */
.active-team-card__sprite {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 48px;
  position: relative;
}

/* Swap icon overlay — appears on hover */
.active-team-card__slot-swap {
  position: absolute;
  bottom: 2px;
  right: 2px;
  font-size: 11px;
  line-height: 1;
  opacity: 0;
  transition: opacity 0.15s ease;
  pointer-events: none;
  background: var(--color-bg, #000);
  border-radius: var(--radius-sm);
  padding: 1px 3px;
}

.active-team-card__slot:hover .active-team-card__slot-swap {
  opacity: 0.85;
}

/* Override badge under sprite */
.active-team-card__override-badge {
  font-size: 10px;
  color: var(--color-primary, #7c6de0);
  font-weight: 600;
  letter-spacing: 0.04em;
  line-height: 1;
}

/* Empty slot placeholder */
.active-team-card__slot--empty .active-team-card__sprite-placeholder {
  width: 40px;
  height: 40px;
  border-radius: var(--radius-sm);
  border: 1px dashed var(--color-border, rgba(255,255,255,0.15));
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--muted, rgba(255,255,255,0.35));
  font-size: 18px;
}

/* ─────────────────────────────────────────────────────────────────────────── */
/* Expansion container (feature panels injected here by TrackerExpansionHandler) */
/* ─────────────────────────────────────────────────────────────────────────── */

.active-team-card__expansion {
  /* inherits team-expanded-container styles from existing CSS */
}

/* ─────────────────────────────────────────────────────────────────────────── */
/* Save as Team button                                                           */
/* ─────────────────────────────────────────────────────────────────────────── */

.active-team-card__save-row {
  display: flex;
  justify-content: flex-end;
  padding: var(--spacing-xs) var(--spacing-sm);
}

/* ─────────────────────────────────────────────────────────────────────────── */
/* Save-as-Team modal — name input wrapper                                       */
/* ─────────────────────────────────────────────────────────────────────────── */

.active-team-name-input-wrapper {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-sm);
  padding: var(--spacing-sm) 0;
}

.active-team-name-input-wrapper label {
  font-size: var(--font-size-sm);
  color: var(--muted, rgba(255,255,255,0.6));
}

/* Modal footer buttons */
.active-team-modal-footer {
  display: flex;
  gap: var(--spacing-sm);
  justify-content: flex-end;
}
`,qU=`
/* ─────────────────────────────────────────────────────────────────────────── */
/* Dropdown Container                                                           */
/* ─────────────────────────────────────────────────────────────────────────── */

.tile-grid-selector {
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  margin-top: var(--spacing-xs);
  background: var(--bg);
  border: 2px solid var(--border);
  border-radius: var(--radius-md);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  z-index: 1000;
  display: none;
  flex-direction: column;
  width: min(95%, 600px); /* Scale with container, max 600px */
  max-height: 80vh; /* Prevent vertical overflow */
  overflow: hidden;
}

.tile-grid-selector--visible {
  display: flex;
}

/* ─────────────────────────────────────────────────────────────────────────── */
/* Header                                                                       */
/* ─────────────────────────────────────────────────────────────────────────── */

.tile-grid-selector__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--spacing-sm) var(--spacing-md);
  border-bottom: 1px solid var(--border);
  background: var(--bg-secondary);
}

.tile-grid-selector__info {
  font-size: var(--font-size-sm);
  font-weight: 500;
  color: var(--fg);
}

.tile-grid-selector__btn {
  padding: 4px 8px;
  font-size: var(--font-size-xs);
  font-weight: 600;
  background: var(--bg-tertiary);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  color: var(--fg);
  cursor: pointer;
  transition: all 0.15s ease;
}

.tile-grid-selector__btn:hover {
  background: var(--hover);
}

.tile-grid-selector__btn:active {
  transform: scale(0.95);
}

/* Close button (X) */
.tile-grid-selector__close-btn {
  width: 24px;
  height: 24px;
  padding: 0;
  font-size: 18px;
  font-weight: 600;
  line-height: 1;
  background: var(--bg-tertiary);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  color: var(--muted);
  cursor: pointer;
  transition: all 0.15s ease;
  margin-left: auto;
}

.tile-grid-selector__close-btn:hover {
  background: var(--danger);
  border-color: var(--danger);
  color: white;
}

/* ─────────────────────────────────────────────────────────────────────────── */
/* Grid Container                                                               */
/* ─────────────────────────────────────────────────────────────────────────── */

.tile-grid-selector__grids {
  display: flex;
  justify-content: center;
  gap: 1%;
  padding: 2%; /* Base padding */
  width: 100%;
  box-sizing: border-box;
  overflow-y: auto;
  overflow-x: hidden;
}

.tile-grid-selector__grid {
  display: grid;
  grid-template-columns: repeat(10, 1fr); /* Equal columns that fill width */
  grid-template-rows: repeat(10, auto);
  gap: 2px; /* Small fixed gap for consistency */
  padding: 4px;
  width: 48%; /* Desktop: side by side */
  background: rgba(0, 0, 0, 0.2);
  border-radius: 8px;
  height: fit-content;
}

/* Mobile: stack vertically and maximize grid size */
@media (max-width: 600px) {
  .tile-grid-selector__grids {
    flex-direction: column;
    align-items: center;
    gap: 8px;
    padding: 8px;
  }

  .tile-grid-selector__grid {
    width: 100% !important; /* Full width on mobile stack */
    max-width: 450px !important; /* Prevent excessive width */
    gap: 1px !important;
    padding: 2px !important;
  }
}

/* ─────────────────────────────────────────────────────────────────────────── */
/* Tile Elements                                                                */
/* ─────────────────────────────────────────────────────────────────────────── */

.tile-grid-selector__tile {
  /* Fill grid cell */
  width: 100%;
  aspect-ratio: 1 / 1; /* Maintain square shape */
  border: 1px solid var(--border);
  border-radius: 2px;
  background: var(--bg);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  touch-action: none;
  user-select: none;
  padding: 1px; /* Minimal padding */
  transition: all 0.1s ease;
  position: relative;
  overflow: hidden;
}

.tile-grid-selector__tile:hover:not(:disabled) {
  border-color: var(--accent);
  transform: scale(1.1);
  z-index: 10;
}

.tile-grid-selector__tile:active:not(:disabled) {
  transform: scale(0.95);
}

/* Null tiles (no tile exists at this position) */
.tile-grid-selector__tile--null {
  background: transparent;
  border-color: transparent;
  cursor: not-allowed;
}

/* Empty tiles (tile exists but nothing on it) */
.tile-grid-selector__tile--empty {
  background: var(--bg-secondary);
  border-color: var(--border);
}

/* Occupied tiles (has plant/egg/decor) */
.tile-grid-selector__tile--occupied {
  background: var(--bg);
  border-color: #6b7280;
}

/* Selected state */
.tile-grid-selector__tile--selected {
  border-color: var(--accent);
  border-width: 2px;
  box-shadow: 0 0 0 1px var(--accent);
}

.tile-grid-selector__tile--selected::after {
  content: '';
  position: absolute;
  top: 2px;
  right: 2px;
  width: 6px;
  height: 6px;
  background: var(--accent);
  border-radius: 50%;
  box-shadow: 0 0 3px rgba(0, 0, 0, 0.5);
  z-index: 100;
}

/* Sprite rendering */
.tile-grid-selector__tile canvas {
  pointer-events: none;
  user-select: none;
}
`,KU=`
.team-card-wrapper {
    display: flex;
    flex-direction: column;
    gap: 12px;
    max-width: 100%;
    overflow-x: hidden;
    box-sizing: border-box;
}

.team-card__mode-container {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
}

.team-card__content {
    display: flex;
    flex-direction: column;
    gap: 12px;
    width: 100%;
}

.team-card__disabled-state {
    text-align: center;
}

.team-card__disabled-message {
    color: var(--muted);
    font-size: 14px;
    margin-bottom: 12px;
}

.team-card__empty-state {
    color: var(--muted);
    text-align: center;
    font-size: 14px;
}

.team-card__list-container {
    display: flex;
    flex-direction: column;
    position: relative;
    width: 100%;
}

.team-card__list-container.is-reordering {
    /* Active reordering state */
}

.team-card__actions {
    display: flex;
    gap: 12px;
    justify-content: center;
    width: 100%;
}

/* ═══════════════════════════════════════════════════════════════════════════
   EXPAND BUTTON
   ═══════════════════════════════════════════════════════════════════════════ */

.team-list-item__expand {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 6px;
    margin-left: 8px;
    background: transparent;
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--muted);
    cursor: pointer;
    transition: all 0.2s ease;
    flex-shrink: 0;
}

.team-list-item__expand:hover {
    background: var(--soft);
    color: var(--fg);
    border-color: var(--accent);
}

.team-list-item__expand svg {
    transition: transform 0.2s ease;
}

.team-list-item__expand--open svg {
    transform: rotate(180deg);
}

/* ═══════════════════════════════════════════════════════════════════════════
   EXPANDED CONTAINER - 1 per team with 3 pet rows
   ═══════════════════════════════════════════════════════════════════════════ */

.team-expanded-container {
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    gap: 8px;
    padding: 12px;
    margin: 0 8px 8px 8px;
    background: linear-gradient(145deg, var(--soft), var(--bg));
    border: 1px solid var(--border);
    border-radius: 12px;
    animation: expandSlideIn 0.25s ease-out;
    max-width: calc(100% - 16px); /* Account for margins */
    overflow-x: hidden;
    box-sizing: border-box;
}

@keyframes expandSlideIn {
    from {
        opacity: 0;
        transform: translateY(-8px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* ═══════════════════════════════════════════════════════════════════════════
   PET ROW - Individual row with header + content
   ═══════════════════════════════════════════════════════════════════════════ */

.expanded-pet-row {
    display: flex;
    flex-direction: column;
    padding: 0 12px 14px 12px;
    max-width: 100%;
    overflow-x: hidden;
    box-sizing: border-box;
}

.expanded-pet-row:first-of-type {
    padding-top: 8px;
}

.pet-row__header {
    display: flex;
    align-items: center;
    background: var(--tab-bg);
    padding: 6px 12px;
    gap: 8px;
    border: 1px solid var(--border);
    border-top-left-radius: 12px;
    border-top-right-radius: 12px;
    border-bottom: none;
    margin-bottom: 0;
}

.expanded-pet-row .base-pet-card {
    border-top-left-radius: 0;
    border-top-right-radius: 0;
}

.pet-row__nav {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--fg);
    font-size: 14px;
    font-weight: 800;
    cursor: pointer;
    transition: all 0.15s ease;
    flex-shrink: 0;
}

.pet-row__nav:hover {
    background: var(--soft);
    border-color: var(--pill-to);
    transform: scale(1.05);
}

.pet-label {
    flex: 1;
    text-align: center;
    font-size: 11px;
    font-weight: 800;
    color: var(--fg);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    opacity: 0.8;
}

/* ═══════════════════════════════════════════════════════════════════════════
   FEATURE CARD - Individual Pet Feature Display
   ═══════════════════════════════════════════════════════════════════════════ */

.feature-card {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 10px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    min-height: 200px;
}

.feature-card__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 10px;
    background: linear-gradient(90deg, var(--accent), var(--pill-to));
    border-bottom: 1px solid var(--border);
    gap: 4px;
}

.feature-card__label {
    flex: 1;
    text-align: center;
    font-size: 11px;
    font-weight: 700;
    color: var(--fg);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.feature-card__nav {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 4px;
    color: var(--fg);
    font-size: 12px;
    font-weight: 800;
    cursor: pointer;
    transition: all 0.15s ease;
    flex-shrink: 0;
}

.feature-card__nav:hover {
    background: var(--soft);
    border-color: var(--pill-to);
}

.feature-card__content {
    flex: 1;
    padding: 10px;
    background: var(--soft);
    overflow-y: auto;
    max-height: 280px;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
}

.feature-card__content::-webkit-scrollbar {
    width: 4px;
}

.feature-card__content::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 2px;
}

/* ═══════════════════════════════════════════════════════════════════════════
   RESPONSIVE - Mobile Layout
   ═══════════════════════════════════════════════════════════════════════════ */

@media (max-width: 768px) {
    .team-expanded-cards {
        grid-template-columns: 1fr;
        gap: 8px;
        padding: 10px;
        margin: 0 4px 6px 4px;
    }

    .feature-card {
        min-height: 160px;
    }

    .feature-card__content {
        max-height: 220px;
    }
}

@media (max-width: 480px) {
    .team-list-item__expand {
        padding: 4px;
    }

    .feature-card__header {
        padding: 6px 8px;
    }

    .feature-card__label {
        font-size: 10px;
    }

    .feature-card__nav {
        width: 20px;
        height: 20px;
        font-size: 10px;
    }

    .feature-card__content {
        padding: 8px;
        max-height: 180px;
    }
}

/* ═══════════════════════════════════════════════════════════════════════════
   TEAM PROGRESS
   ═══════════════════════════════════════════════════════════════════════════ */

.team-progress-bar {
    position: relative;
    height: 16px;
    background: var(--border);
    border-radius: 8px;
    margin: 10px 12px 6px 12px;
    overflow: hidden;
    border: 1px solid var(--border);
    flex-shrink: 0;
    --xp-fill: var(--accent); /* Default fill color */
}

.team-progress-bar__fill {
    height: 100%;
    border-radius: 7px;
    transition: width 0.3s ease;
}

/* Color coding for team progress bar - using oklab for better mixing */
.team-progress-bar__fill--low {
    background: linear-gradient(90deg, color-mix(in oklab, var(--xp-fill) 40%, transparent), color-mix(in oklab, var(--xp-fill) 60%, transparent));
}
.team-progress-bar__fill--medium {
    background: linear-gradient(90deg, color-mix(in oklab, var(--xp-fill) 60%, transparent), color-mix(in oklab, var(--xp-fill) 85%, transparent));
}
.team-progress-bar__fill--high {
    background: linear-gradient(90deg, color-mix(in oklab, var(--xp-fill) 80%, transparent), var(--xp-fill));
}

.team-progress-bar__percent {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 11px;
    font-weight: 800;
    color: var(--fg);
    text-shadow: 0 1px 2px rgba(0,0,0,0.6);
    pointer-events: none;
    z-index: 5;
}

/* BasePetCard provides its own mobile responsiveness. We only need minimal 
   overrides for the team-level containers if necessary. */

@media (max-width: 480px) {
    .team-expanded-container {
        margin: 4px 4px 8px 4px;
        max-width: calc(100% - 8px);
        padding: 8px;
    }

    .expanded-pet-row {
        padding: 0 8px 10px 8px;
    }

    .team-progress-bar {
        pointer-events: none;
        z-index: 5;
        margin: 8px 8px 4px 8px;
    }

    .feature-card__header {
        padding: 6px 8px;
    }

    .feature-card__nav {
        width: 22px;
        height: 22px;
        font-size: 10px;
    }
}

/* 320px devices */
@media (max-width: 360px) {
    .pet-row__content {
        padding: 8px;
    }
    
    .xp-stat__label {
        font-size: 9px;
    }
}

/* ═══════════════════════════════════════════════════════════════════════════
   COMBINED PANEL MODE
   Merges multiple panels into single view when total rows ≤ 3
   ═══════════════════════════════════════════════════════════════════════════ */

.expanded-pet-row--combined {
    /* Same base styling as grouped */
}

.pet-row__header--combined {
    justify-content: center;
    gap: 12px;
    background: linear-gradient(90deg, var(--soft), var(--tab-bg), var(--soft));
}

.combined-panel__icons {
    font-size: 13px;
    opacity: 0.9;
    letter-spacing: 2px;
}

/* Combined content area */
.base-pet-card__content--combined {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

/* Individual panel sections within combined view */
.combined-section {
    display: flex;
    align-items: flex-start;
    gap: 8px;
    padding: 4px 0;
}

.combined-section + .combined-section {
    border-top: 1px solid var(--border);
    padding-top: 8px;
    margin-top: 2px;
}

.combined-section__icon {
    font-size: 12px;
    opacity: 0.75;
    min-width: 20px;
    text-align: center;
    padding-top: 2px;
}

.combined-section__content {
    flex: 1;
    min-width: 0;
}

/* Ensure stat rows within combined sections flow correctly */
.combined-section__content .stat-row,
.combined-section__content .hatching-stats-compact,
.combined-section__content .xp-stats-compact,
.combined-section__content .value-stats-compact,
.combined-section__content .growth-stats-compact {
    /* Remove any margin that might cause issues */
    margin: 0;
}

/* Combined section specific colors */
.combined-section--xp .combined-section__icon {
    color: var(--xp-fill, #6ba6ff);
}

.combined-section--hatch .combined-section__icon {
    color: #f0a050;
}

.combined-section--growth .combined-section__icon {
    color: #60c060;
}

.combined-section--coin .combined-section__icon {
    color: #ffd700;
}

/* Mobile adjustments for combined panel */
@media (max-width: 480px) {
    .combined-section {
        gap: 6px;
    }
    
    .combined-section__icon {
        font-size: 11px;
        min-width: 16px;
    }
}

`,XU=`
/* ═══════════════════════════════════════════════════════════════════════════
   GROWTH TIMER PANEL STYLES
   ═══════════════════════════════════════════════════════════════════════════ */

/* Growth Panel structural styles moved to growthPanel.css.ts */

.feature-card,
.feature-card__content {
    box-sizing: border-box;
}


/* ═══════════════════════════════════════════════════════════════════════════
   RESPONSIVE
   ═══════════════════════════════════════════════════════════════════════════ */

.growth-timer-panel {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.growth-stats {
    padding: 8px 12px;
    background: linear-gradient(135deg, var(--soft), var(--bg));
    border: 1px solid var(--border);
    border-radius: 8px;
    font-size: 11px;
    font-weight: 600;
    color: var(--muted);
    text-align: center;
}

.growth-timer-list {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.timer-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 10px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    font-size: 11px;
    transition: all 0.2s ease;
}

.timer-item:hover {
    border-color: var(--pill-to);
    box-shadow: 0 2px 8px var(--shadow);
}

.timer-sprite {
    flex-shrink: 0;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.timer-sprite canvas {
    image-rendering: pixelated;
    image-rendering: crisp-edges;
}

.timer-countdown {
    font-weight: 800;
    color: var(--fg);
    font-size: 12px;
    min-width: 65px;
}

.timer-completion {
    flex: 1;
    color: var(--muted);
    font-size: 11px;
}

.timer-boost {
    color: var(--mut-ambercharged);
    font-weight: 700;
    font-size: 10px;
    white-space: nowrap;
}

.empty-state {
    text-align: center;
    padding: 24px;
    color: var(--muted);
    font-style: italic;
    font-size: 12px;
}

/* ═══════════════════════════════════════════════════════════════════════════
   RESPONSIVE
   ═══════════════════════════════════════════════════════════════════════════ */

@media (max-width: 768px) {
    .team-expanded-cards {
        grid-template-columns: 1fr;
    }

    .feature-card__content {
        max-height: 300px;
    }
}

@media (max-width: 480px) {
    .team-expanded-cards {
        padding: 8px;
        gap: 8px;
    }

    .feature-card__header {
        padding: 8px 10px;
    }

    .feature-card__label {
        font-size: 11px;
    }

    .feature-card__nav {
        width: 24px;
        height: 24px;
        font-size: 12px;
    }

    .feature-card__content {
        padding: 10px;
    }
}

/* ═══════════════════════════════════════════════════════════════════════════
   ACCESSIBILITY
   ═══════════════════════════════════════════════════════════════════════════ */

.feature-card:focus-within {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
}

.feature-card__nav:focus {
    outline: 2px solid var(--pill-to);
    outline-offset: 2px;
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
    .team-expanded-cards,
    .feature-card,
    .timer-item {
        animation: none;
        transition: none;
    }
}

/* Mobile responsive - prevent horizontal scrolling */
@media (max-width: 480px) {
    .growth-summary-overhaul {
        flex-wrap: wrap; /* Allow wrapping on narrow screens */
        gap: 8px;
        padding: 8px 10px;
    }

    .team-progress-bar--egg,
    .team-progress-bar--plant {
        min-width: 100%; /* Force full width on mobile */
        order: -1; /* Move progress bar to top */
    }

    .growth-next-item {
        min-width: 100%;
        flex-wrap: wrap;
    }

    .growth-overhaul-controls {
        flex-shrink: 0;
    }

    .bar-percent,
    .bar-info {
        font-size: 10px;
    }

    .growth-next-time,
    .growth-next-date {
        font-size: 10px;
    }
    
    /* Center controls (buttons) on mobile */
    .growth-overhaul-controls {
        justify-content: center;
        width: 100%;
    }
    
    /* Center next item row on mobile */
    .growth-next-item {
        justify-content: center;
        width: 100%;
    }
    
    /* Center overall container elements on mobile */
    .growth-summary-overhaul {
        justify-content: center;
    }
}
`,YU=`
/* ═══════════════════════════════════════════════════════════════════════════
   XP PANEL - Main Container
   ═══════════════════════════════════════════════════════════════════════════ */

.xp-panel {
    background: linear-gradient(145deg, var(--bg), var(--soft));
    border: 1px solid var(--border);
    border-left: 3px solid var(--pill-to);
    border-radius: 16px;
    margin: 12px 0 16px 12px;
    overflow: hidden;
    box-shadow:
        0 8px 32px var(--shadow),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
    animation: xpPanelSlideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    transform-origin: top center;
}

@keyframes xpPanelSlideIn {
    from {
        opacity: 0;
        transform: translateY(-16px) scaleY(0.95);
        max-height: 0;
    }
    to {
        opacity: 1;
        transform: translateY(0) scaleY(1);
        max-height: 2000px;
    }
}

/* ═══════════════════════════════════════════════════════════════════════════
   HEADER - Team XP Rate Display
   ═══════════════════════════════════════════════════════════════════════════ */

.xp-panel__header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 14px 20px;
    /* Task 6: Theme-semantic colors */
    background: linear-gradient(90deg, var(--accent), var(--pill-to));
    border-bottom: 1px solid var(--border);
}

.xp-panel__header-title {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--fg);  /* Task 6: Use --fg for better contrast */
}

.xp-panel__header-icon {
    font-size: 16px;
}

.xp-panel__header-rate {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 14px;
    font-weight: 600;
}

.xp-panel__rate-label {
    color: var(--muted);
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.xp-panel__rate-base {
    color: var(--fg);
}

.xp-panel__rate-plus,
.xp-panel__rate-equals {
    color: var(--muted);
    font-size: 12px;
}

.xp-panel__rate-bonus {
    color: var(--mut-gold);
    font-weight: 700;
}

.xp-panel__rate-total {
    background: linear-gradient(135deg, var(--pill-from), var(--pill-to));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-size: 16px;
    font-weight: 900;
}

/* ═══════════════════════════════════════════════════════════════════════════
   PETS CONTAINER - Horizontal Scrollable Row
   ═══════════════════════════════════════════════════════════════════════════ */

.xp-panel__pets {
    display: flex;
    flex-direction: column;
    gap: 2px;
    padding: 16px;
    background: var(--soft);
}

/* ═══════════════════════════════════════════════════════════════════════════
   PET CARD - Individual Pet Display
   ═══════════════════════════════════════════════════════════════════════════ */

.xp-pet-card {
    display: flex;
    align-items: stretch;
    gap: 16px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 14px;
    transition: all 0.25s cubic-bezier(0.2, 0.8, 0.2, 1);
    position: relative;
}

.xp-pet-card:hover {
    box-shadow: 0 6px 20px var(--shadow);
    transform: translateX(2px);
}

/* Left accent bar (appears on hover with smooth color transition) */
.xp-pet-card::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 3px;
    background: linear-gradient(180deg, var(--pill-from), var(--pill-to));
    border-radius: 12px 0 0 12px;
    opacity: 0;
    transition: opacity 0.3s ease, background 0.3s ease;
}

.xp-pet-card:hover::before {
    opacity: 1;
    background: linear-gradient(180deg, var(--accent), var(--pill-to));
}

/* Max strength pet */
.xp-pet-card--max {
    border-color: var(--complete);
    background: var(--bg);
}

.xp-pet-card--max::before {
    background: linear-gradient(180deg, var(--complete), var(--high));
}

.xp-pet-card--max:hover::before {
    opacity: 0.8;
}

/* Starving pet */
.xp-pet-card--starving {
    border-color: var(--low);
    background: linear-gradient(135deg, var(--soft), var(--bg));
    animation: starvingPulse 2s ease-in-out infinite;
}

.xp-pet-card--starving::before {
    background: var(--low);
}

.xp-pet-card--starving:hover::before {
    opacity: 1;
}

@keyframes starvingPulse {
    0%, 100% { border-color: var(--low); }
    50% { border-color: var(--medium); }
}

/* ═══════════════════════════════════════════════════════════════════════════
   SPRITE SECTION - Left Side
   ═══════════════════════════════════════════════════════════════════════════ */

.xp-pet-card__sprite {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    min-width: 80px;
    flex-shrink: 0;
}

.xp-pet-card__sprite-wrapper {
    width: 64px;
    height: 64px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(145deg, var(--soft), var(--bg));
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
    box-shadow:
        inset 0 2px 4px var(--shadow),
        0 2px 8px var(--shadow);
}

.xp-pet-card__sprite-wrapper canvas {
    image-rendering: pixelated;
    image-rendering: crisp-edges;
}

.xp-pet-card__sprite-fallback {
    font-size: 32px;
    opacity: 0.5;
}

/* Badges under sprite */
.xp-pet-card__badges {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    justify-content: center;
}

.xp-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 9px;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    white-space: nowrap;
}

.xp-badge--max {
    background: linear-gradient(135deg, var(--complete), var(--high));
    color: #fff; /* White for readability on green background */
    text-shadow: 0 1px 1px rgba(0,0,0,0.2);
}

.xp-badge--starving {
    background: var(--low);
    color: #fff; /* White for readability on red background */
    text-shadow: 0 1px 1px rgba(0,0,0,0.2);
}

.xp-badge--boost {
    background: linear-gradient(135deg, var(--mut-gold), var(--mut-ambercharged));
    color: #1a1a1a; /* Dark for readability on gold background */
    text-shadow: 0 1px 0 rgba(255,255,255,0.3);
}

/* Task 9-10: STR display under sprite/badges (tight 2px spacing) */
.xp-pet-card__str-display {
    display: flex;
    align-items: baseline;
    justify-content: center;
    gap: 3px;
    margin-top: 2px; /* Task 9: tight spacing */
    font-size: 11px;
    font-weight: 600;
}

.xp-str__label {
    color: var(--pill-to); /* Updated per user request */
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-size: 10px;
}

.xp-str__current {
    color: var(--fg);
    font-weight: 800;
    font-size: 13px;
    text-shadow: 
        -1px -1px 0 rgba(0, 0, 0, 0.8),
        1px -1px 0 rgba(0, 0, 0, 0.8),
        -1px 1px 0 rgba(0, 0, 0, 0.8),
        1px 1px 0 rgba(0, 0, 0, 0.8);
}

.xp-str__separator {
    color: var(--muted);
    font-size: 11px;
}

.xp-str__max {
    color: var(--muted);
    font-size: 11px;
    text-shadow: 
        -1px -1px 0 rgba(0, 0, 0, 0.8),
        1px -1px 0 rgba(0, 0, 0, 0.8),
        -1px 1px 0 rgba(0, 0, 0, 0.8),
        1px 1px 0 rgba(0, 0, 0, 0.8);
}

/* ═══════════════════════════════════════════════════════════════════════════
   STATS SECTION - Right Side
   ═══════════════════════════════════════════════════════════════════════════ */

.xp-pet-card__stats {
    flex: 1;
    display: flex;
    flex-direction: column;
    min-width: 0;
}

.xp-pet-card__name {
    font-size: 15px;
    font-weight: 800;
    color: var(--fg);
    margin-bottom: 10px;
    padding-bottom: 8px;
    border-bottom: 1px solid var(--border);
    letter-spacing: 0.3px;
}

/* Stats Table */
.xp-stats-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
}

/* Task 3: Remove row dividers for cleaner look */
.xp-stats-table__row {
    /* No border - clean, minimal design */
}

.xp-stats-table__row:last-child {
    /* No special treatment needed */
}

.xp-stats-table__label {
    padding: 6px 12px 6px 0;
    color: var(--pill-to); /* Updated per user request */
    font-weight: 600;
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    white-space: nowrap;
    width: 80px;
}

.xp-stats-table__value {
    padding: 6px 0;
    color: var(--fg);
    font-weight: 600;
}

.xp-stats-table__value--danger {
    color: var(--low);
    font-weight: 800;
}

/* Strength display */
.xp-strength {
    display: inline-flex;
    align-items: baseline;
    gap: 2px;
}

.xp-strength__current {
    font-size: 16px;
    font-weight: 800;
    background: linear-gradient(135deg, var(--pill-from), var(--pill-to));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.xp-strength__separator {
    color: var(--muted);
    font-size: 13px;
}

.xp-strength__max {
    color: var(--muted);
    font-size: 13px;
    font-weight: 600;
}

/* Progress row (time + feeds + progress bar) */
.xp-progress-row {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
}

.xp-progress-row__time {
    font-weight: 700;
    font-size: 13px;
    color: var(--fg);
    min-width: 45px;
}

.xp-progress-row__feeds {
    font-size: 12px;
    color: var(--muted);
    white-space: nowrap;
}

.xp-progress-row__bar-container {
    display: flex;
    align-items: center;
    gap: 6px;
    flex: 1;
    min-width: 120px;
}

.xp-progress-row__bar {
    flex: 1;
    height: 10px;
    background: var(--soft);
    border: 1px solid var(--border);
    border-radius: 5px;
    overflow: hidden;
    position: relative;
}

.xp-progress-row__fill {
    height: 100%;
    border-radius: 4px;
    transition: width 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
    position: relative;
    overflow: hidden;
}

.xp-progress-row__fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg,
        transparent,
        rgba(255,255,255,0.25),
        transparent
    );
    animation: progressShimmer 2.5s infinite;
}

@keyframes progressShimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

.xp-progress-row__fill--low {
    background: linear-gradient(90deg, var(--low), var(--medium));
}

.xp-progress-row__fill--medium {
    background: linear-gradient(90deg, var(--medium), var(--high));
}

.xp-progress-row__fill--high {
    background: linear-gradient(90deg, var(--high), var(--complete));
}

.xp-progress-row__percent {
    font-size: 11px;
    font-weight: 800;
    min-width: 32px;
    text-align: right;
    color: var(--fg);
}

/* XP Boost row */
.xp-stats-table__row--boost {
    background: linear-gradient(90deg, var(--soft), transparent);
}

.xp-boost-stat {
    color: var(--mut-ambercharged);
    font-weight: 700;
}

.xp-inactive {
    color: var(--muted);
    font-style: italic;
    font-size: 11px;
    margin-left: 4px;
}

/* Supporting row */
.xp-stats-table__row--support {
    background: linear-gradient(90deg, var(--soft), transparent);
}

.xp-support {
    color: var(--pill-to);
    font-weight: 600;
}

/* Warning row */
.xp-stats-table__row--warning {
    background: linear-gradient(90deg, rgba(220, 38, 38, 0.15), transparent);
}

/* ═══════════════════════════════════════════════════════════════════════════
   FOOTER - XP Boost Summary
   ═══════════════════════════════════════════════════════════════════════════ */

.xp-panel__footer {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 14px 20px;
    /* Task 5: Theme-semantic colors */
    background: linear-gradient(90deg, var(--accent), var(--pill-to));
    border-top: 1px solid var(--border);
}

.xp-panel__footer--hidden {
    display: none;
}

.xp-panel__footer-icon {
    font-size: 24px;
    color: var(--fg);  /* Task 5: Use --fg */
    animation: boostPulse 1.5s ease-in-out infinite;
}

@keyframes boostPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

.xp-panel__footer-content {
    flex: 1;
}

.xp-panel__footer-title {
    font-size: 13px;
    font-weight: 800;
    color: var(--fg);  /* Task 5: Use --fg */
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.xp-panel__footer-detail {
    font-size: 14px;
    font-weight: 600;
    color: var(--fg);  /* Task 5: Use --fg */
    margin-top: 2px;
}

.xp-panel__footer-names {
    color: var(--pill-to);  /* Task 5: Use --pill-to for subtle contrast */
    font-size: 12px;
    font-weight: 500;
}

/* ═══════════════════════════════════════════════════════════════════════════
   RESPONSIVE
   ═══════════════════════════════════════════════════════════════════════════ */

@media (max-width: 480px) {
    .xp-panel__header {
        flex-direction: column;
        gap: 8px;
        align-items: flex-start;
    }

    .xp-pet-card {
        flex-direction: column;
        align-items: center;
        text-align: center;
    }

    .xp-pet-card__sprite {
        flex-direction: row;
        gap: 12px;
    }

    .xp-pet-card__name {
        text-align: center;
    }

    .xp-stats-table__label {
        width: auto;
    }
}

/* ═══════════════════════════════════════════════════════════════════════════
   ACCESSIBILITY
   ═══════════════════════════════════════════════════════════════════════════ */

.xp-panel:focus-within {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
    .xp-panel,
    .xp-pet-card,
    .xp-progress__fill,
    .xp-panel__footer-icon {
        animation: none;
        transition: none;
    }

    .xp-progress__fill::after {
        animation: none;
    }
}

/* ═══════════════════════════════════════════════════════════════════════════
   PRINT
   ═══════════════════════════════════════════════════════════════════════════ */

@media print {
    .xp-panel {
        box-shadow: none;
        border: 2px solid var(--border);
    }

    .xp-progress__fill::after,
    .xp-panel__footer-icon {
        animation: none;
    }
}
`,JU=`
/* ═══════════════════════════════════════════════════════════════════════════
   GROWTH STATS COMPACT - Summary Bar
   ═══════════════════════════════════════════════════════════════════════════ */

/* Main container - single inline row like XP bar */
.growth-summary-overhaul {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 14px;
    background: var(--soft);
    border-radius: 12px;
    margin-bottom: 10px;
    max-width: 100%;
    overflow-x: hidden;
    box-sizing: border-box;
}

/* Progress bar section */
.team-progress-bar--egg, .team-progress-bar--plant {
    position: relative;
    flex: 1;
    min-width: 80px;
    max-width: 100%; /* Prevent overflow */
    height: 18px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 6px;
    overflow: hidden;
}

.team-progress-bar__fill--plant {
    background: linear-gradient(90deg, var(--accent-1), color-mix(in oklab, var(--accent-1) 70%, white));
    height: 100%;
    border-radius: 5px;
    transition: width 0.3s ease;
}

.team-progress-bar__fill--egg {
    background: linear-gradient(90deg, var(--accent-2), color-mix(in oklab, var(--accent-2) 70%, white));
    height: 100%;
    border-radius: 5px;
    transition: width 0.3s ease;
}

/* Next Item Display - inline */
.growth-next-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 11px;
    white-space: nowrap;
}

.growth-next-sprite {
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.growth-next-sprite canvas {
    image-rendering: pixelated;
}

.growth-next-details {
    display: flex;
    align-items: baseline;
    gap: 4px;
}

.growth-next-time {
    font-weight: 700;
    color: var(--pill-from); /* Updated per user request */
}

.growth-next-date {
    color: var(--fg); /* Per user: "3:04 pm" */
    font-size: 10px;
}

/* Controls - inline */
.growth-overhaul-controls {
    display: flex;
    gap: 8px;
}

.growth-toggle-overhaul, .growth-dropdown-overhaul {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 3px 6px;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.15s ease;
    color: var(--fg);
    display: flex;
    align-items: center;
    justify-content: center;
}

.growth-toggle-overhaul canvas {
    image-rendering: pixelated;
}

.growth-toggle-overhaul:hover, .growth-dropdown-overhaul:hover {
    border-color: var(--accent);
    background: var(--soft);
}

.growth-dropdown-option {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 10px;
    font-size: 11px;
    font-weight: 600;
    cursor: pointer;
    border-radius: 4px;
    color: var(--fg);
}

.growth-dropdown-option:hover {
    background: var(--accent);
    color: var(--pill-to);
}

.growth-stats-compact {
    display: flex;
    flex-direction: column;
    gap: 8px;
    max-width: 100%;
    overflow-x: hidden;
}

/* ═══════════════════════════════════════════════════════════════════════════
   STAT ROW - Individual Stat Display
   ═══════════════════════════════════════════════════════════════════════════ */

.stat-row {
    display: flex;
    align-items: center;
    gap: 4px; /* Tighter spacing on desktop */
    padding: 4px 8px; /* Slightly tighter padding */
    background: transparent;
    border: none;
    border-radius: 6px;
    flex-wrap: nowrap; /* Prevent vertical stacking on desktop */
    max-width: 100%;
    box-sizing: border-box;
}

.stat-row--boost {
    background: transparent;
}

.stat__label {
    font-size: 10px;
    font-weight: 700;
    color: var(--pill-to); /* Updated per user request */
    text-transform: uppercase;
    letter-spacing: 0.5px;
    min-width: 70px;
}

.stat__timer {
    font-size: 12px;
    font-weight: 700;
    color: var(--pill-from); /* Updated per user request */
    min-width: 60px;
}

.stat__feeds {
    font-size: 11px;
    color: var(--fg); /* Per user: date/time text */
    min-width: 50px;
}

.stat__str-label {
    display: flex;
    align-items: center;
    gap: 4px;
}

.stat__progress-mini {
    position: relative; /* Required for absolute positioning of percent */
    flex: 1;
    height: 10px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 5px;
    overflow: visible; /* Changed from hidden to show overlayed percent */
    min-width: 60px;
}

.stat__progress-fill {
    height: 100%;
    transition: width 0.3s ease;
}

.stat__progress-fill--egg {
    background: linear-gradient(90deg, var(--accent-2), color-mix(in oklab, var(--accent-2) 70%, white));
}

.stat__progress-fill--plant {
    background: linear-gradient(90deg, var(--accent-1), color-mix(in oklab, var(--accent-1) 70%, white));
}

.stat__percent {
    position: absolute;
    top: 50%;
    left: 50%; /* Center properly */
    transform: translate(-50%, -50%); /* Center properly */
    font-size: 11px;
    font-weight: 800;
    color: var(--accent); /* Per user: percentage text with outline */
    text-shadow: 
        -1px -1px 0 rgba(0, 0, 0, 0.8),
        1px -1px 0 rgba(0, 0, 0, 0.8),
        -1px 1px 0 rgba(0, 0, 0, 0.8),
        1px 1px 0 rgba(0, 0, 0, 0.8); /* Black outline for visibility */
    pointer-events: none;
    z-index: 2;
}

.stat__value {
    font-size: 11px;
    font-weight: 600;
    color: var(--pill-from); /* Updated per user request */
}

.stat__value--accent {
    color: var(--mut-ambercharged);
    font-weight: 700;
}

/* Sprite wrappers - remove inline styles */
.sprite-wrapper,
.stacked-sprites {
    display: inline-flex;
    align-items: center;
}

/* ═══════════════════════════════════════════════════════════════════════════
   BOOST ROW - Displays "+Xmin/proc" text
   User requirement: Convert min/h to "Xh Ym/h" format with --pill-from color
   ═══════════════════════════════════════════════════════════════════════════ */

.boost-summary {
    font-size: 12px;
    font-weight: 700;
    color: var(--pill-from); /* Per user: boost text with outline */
    text-shadow: 
        -1px -1px 0 rgba(0, 0, 0, 0.8),
        1px -1px 0 rgba(0, 0, 0, 0.8),
        -1px 1px 0 rgba(0, 0, 0, 0.8),
        1px 1px 0 rgba(0, 0, 0, 0.8); /* Black outline for visibility */
}

.team-progress-bar__overlay {
    position: absolute;
    inset: 0;
    z-index: 2;
    display: flex;
    justify-content: space-between; /* Use space-between instead of gap */
    align-items: center;
    padding: 0 15%; /* Percentage padding for responsive centering */
    width: 100%;
    pointer-events: none;
    box-sizing: border-box;
}

.bar-percent {
    color: var(--accent);
}

.bar-info {
    color: var(--pill-from);
}

.bar-percent, 
.bar-info {
    font-size: 13px; /* Match sizes */
    font-weight: 800;
    text-shadow: 
        -1px -1px 0 rgba(0, 0, 0, 0.8),
        1px -1px 0 rgba(0, 0, 0, 0.8),
        -1px 1px 0 rgba(0, 0, 0, 0.8),
        1px 1px 0 rgba(0, 0, 0, 0.8);
}

.stat-row--message {
    justify-content: center;
    background: transparent;
    border: 1px dashed var(--border);
    opacity: 1; /* Keep fully visible for --pill-from color */
    width: 100%;
    box-sizing: border-box;
}

.stat__message {
    font-size: 11px;
    font-weight: 700;
    color: var(--pill-from);
    text-align: center;
}

/* ═══════════════════════════════════════════════════════════════════════════
   DROPDOWN MENU - Gemini Scrollbar Implementation
   ═══════════════════════════════════════════════════════════════════════════ */

.growth-dropdown-menu {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    box-shadow: 0 8px 32px var(--shadow);
    padding: 4px;
    min-width: 180px;
    max-height: 200px;
    overflow-y: auto;
    
    /* Gemini scrollbar (standard pattern) */
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
}

.growth-dropdown-menu::-webkit-scrollbar {
    width: 6px;
}

.growth-dropdown-menu::-webkit-scrollbar-track {
    background: transparent;
}

.growth-dropdown-menu::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 3px;
}

.growth-dropdown-menu::-webkit-scrollbar-thumb:hover {
    background: var(--accent);
}

/* ═══════════════════════════════════════════════════════════════════════════
   RESPONSIVE - Mobile Layout (NO HORIZONTAL SCROLLING)
   ═══════════════════════════════════════════════════════════════════════════ */

@media (max-width: 768px) {
    .growth-stats-compact {
        padding: 8px;
    }

    .stat-row {
        flex-wrap: wrap; /* Stack items vertically */
        gap: 6px;
    }

    .stat__label {
        min-width: 100%;
        text-align: left;
    }

    .stat__timer,
    .stat__feeds,
    .stat__percent {
        font-size: 10px;
    }

    .stat__progress-mini {
        min-width: 100%; /* Full width on mobile */
    }
}

@media (max-width: 480px) {
    .team-progress-bar__overlay {
        padding: 0 10%; /* Smaller percentage padding on mobile */
        white-space: nowrap;
    }

    .bar-percent, 
    .bar-info {
        font-size: 11px; /* Slightly smaller for mobile */
    }

    .stat-row {
        padding: 8px 6px;
        flex-wrap: wrap; /* Allow wrapping so progress bar can drop down */
        gap: 8px;
        align-items: center;
    }

    .stat__label {
        min-width: auto;
        max-width: 70px;
        flex-shrink: 1;
        font-size: 9px;
    }

    .stat__timer,
    .stat__value {
        flex-shrink: 0; /* Keep value next to label/sprite */
    }

    .stat__progress-mini {
        width: 100%; /* Force progress bar to new row */
        height: 12px;
        margin-top: 2px;
    }

    .growth-dropdown-menu {
        max-height: 160px; /* Smaller on mobile */
    }

    /* Touch-friendly controls - minimum 44px height */
    .growth-toggle-overhaul,
    .growth-dropdown-overhaul {
        min-height: 44px;
        min-width: 44px;
        padding: 8px 12px;
    }

    .growth-dropdown-option {
        min-height: 44px; /* Touch target */
        padding: 10px 12px;
    }
}

@media (max-width: 360px) {
    .stat__label,
    .stat__timer,
    .stat__feeds,
    .stat__percent {
        font-size: 9px;
    }

    .stat__label {
        min-width: auto; /* Allow shrinking */
        max-width: 60px; /* Cap width */
        flex-shrink: 1;
    }

    .stat__progress-mini {
        min-width: 50px;
    }

    .growth-stats-compact {
        padding: 6px;
    }

    .growth-summary-overhaul {
        padding: 8px 10px;
        gap: 8px;
    }

    .team-progress-bar__overlay {
        padding: 0 8%;
    }

    .bar-percent,
    .bar-info {
        font-size: 10px;
    }
}

/* ═══════════════════════════════════════════════════════════════════════════
   SPRITE GRID - Egg Sprite Overlays (Hatching Panel)
   ═══════════════════════════════════════════════════════════════════════════ */

.stat__sprite-grid {
    display: flex;
    gap: 12px;  /* Increased from 8px for better spacing */
    align-items: center;
    flex-wrap: wrap;
    margin-left: 8px;  /* Add some left margin to separate from label */
}

.stat__sprite-item {
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 24px;  /* Ensure minimum width for sprite + overlay */
}

.stat__sprite-value {
    position: absolute;
    top: -8px;  /* Increased from -6px for better visibility */
    right: -6px;  /* Increased from -4px for more spacing */
    font-size: 0.7rem;  /* Slightly smaller for compactness */
    font-weight: 700;  /* Increased from 600 for better readability */
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 1px 4px;  /* Slightly more padding */
    color: var(--pill-from);
    text-shadow: none;
    z-index: 10;
    white-space: nowrap;  /* Prevent text wrapping */
}

.stat__values-row {
    display: flex;
    align-items: center;
    gap: 6px;  /* Increased from 4px */
}

.stat__separator {
    color: var(--border);
    font-weight: 400;
    margin: 0 4px;  /* Add horizontal margin */
}

.stat__boost-item {
    display: flex;
    align-items: center;
    gap: 6px;  /* Increased from 4px */
}

/* ═══════════════════════════════════════════════════════════════════════════
   MUTATION COLORS - Rainbow and Gold
   ═══════════════════════════════════════════════════════════════════════════ */

.stat__value.stat__value--gold {
    color: var(--mut-gold) !important;
}

.stat__value.stat__value--rainbow {
    color: var(--mut-rainbow) !important;
}

/* ═══════════════════════════════════════════════════════════════════════════
   ACCESSIBILITY
   ═══════════════════════════════════════════════════════════════════════════ */

@media (prefers-reduced-motion: reduce) {
    .stat__progress-fill {
        transition: none;
    }
}
`;class QU extends pr{constructor(n){super({id:"tab-trackers",label:"Trackers"});de(this,"deps");de(this,"trackerCardPart",null);de(this,"activeTeamCard",null);de(this,"unsubscribeMyPets");this.deps=n;}async build(n){this.container=n;const{MGSprite:r}=await $n(async()=>{const{MGSprite:a}=await Promise.resolve().then(()=>Mp);return {MGSprite:a}},void 0);await r.init(),await NU();const o=n.getRootNode();this.injectStyles(o);const i=this.createGrid("12px");i.id="trackers",n.appendChild(i),this.initializeActiveTeamCard(i),this.initializeTrackerCard(i),this.unsubscribeMyPets=De.myPets.subscribeStable(()=>{this.trackerCardPart?.render();});}async destroy(){this.unsubscribeMyPets&&(this.unsubscribeMyPets(),this.unsubscribeMyPets=void 0),this.activeTeamCard&&(this.activeTeamCard.destroy(),this.activeTeamCard=null),this.trackerCardPart&&(this.trackerCardPart.destroy(),this.trackerCardPart=null);}unmount(){this.destroy().catch(console.error),super.unmount();}injectStyles(n){wt(n,GU,"tracker-card-styles"),wt(n,VU,"active-team-card-styles"),wt(n,qU,"tile-grid-overlay-styles"),wt(n,KU,"team-card-styles"),wt(n,XU,"feature-card-styles"),wt(n,YU,"team-xp-panel-styles"),wt(n,JU,"growth-panel-styles"),wt(n,e1,"base-pet-card-styles"),wt(n,cv,"badge-styles"),wt(n,t1,"arcade-button-styles"),wt(n,QE,"gemini-icon-button-styles");}initializeActiveTeamCard(n){this.activeTeamCard||(this.activeTeamCard=new WU({setHUDOpen:this.deps?.setHUDOpen}));const r=this.activeTeamCard.build();n.appendChild(r),this.activeTeamCard.render(),this.activeTeamCard.subscribe();}initializeTrackerCard(n){this.trackerCardPart||(this.trackerCardPart=new jU({setHUDOpen:this.deps?.setHUDOpen}));const r=this.trackerCardPart.build();n.appendChild(r),this.trackerCardPart.render();}}const ZU=`
  #shop-notifier-section {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  /* Shop Cards */
  .shop-card--seed,
  .shop-card--tool,
  .shop-card--egg,
  .shop-card--decor {
    /* Card styles inherited from Card component */
  }

  /* Emoji icon in table cells */
  .shop-item-icon {
    font-size: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* Rarity badge container in table */
  .shop-item-rarity {
    display: flex;
    align-items: center;
    justify-content: flex-start;
  }

  /* Toggle switch container in table */
  .shop-item-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
  }
`;async function e3(){}const t3={seed:"Seeds",tool:"Tools",egg:"Eggs",decor:"Decor"},Bw={seed:"🌱",tool:"🔧",egg:"🥚",decor:"🎨"},fv={seed:"plants",tool:"items",egg:"eggs",decor:"decor"},hv={seed:"seed",tool:null,egg:null,decor:null},jw={common:0,uncommon:1,rare:2,legendary:3,mythical:4,divine:5,celestial:6};function n3(e,t){try{const n=fv[t],r=ue.get(n);if(!r||typeof r!="object")return null;const o=r[e];if(!o)return null;const i=hv[t];return (i?o[i]:o)?.spriteId??null}catch(n){return console.warn(`[ShopNotifier] Failed to get spriteId for ${e}:`,n),null}}function r3(e,t){try{const n=fv[t],r=ue.get(n);if(!r||typeof r!="object")return null;const o=r[e];if(!o)return null;const i=hv[t],s=(i?o[i]:o)?.rarity;return s?String(s).toLowerCase():null}catch{return null}}function o3(e,t){try{const n=fv[t],r=ue.get(n);if(!r||typeof r!="object")return e;const o=r[e];if(!o)return e;const i=hv[t];return (i?o[i]:o)?.name??e}catch(n){return console.warn(`[ShopNotifier] Failed to get name for ${e}:`,n),e}}function i3(e){const n=Or.getTrackedItems().filter(r=>r.shopType===e).map(r=>r.itemId);return new Set(n)}function l1(e,t){const n=i3(t);return e.items.map(r=>({...r,rarity:r3(r.id,t),spriteId:n3(r.id,t),itemName:o3(r.id,t),isTracked:n.has(r.id)}))}function a3(e,t){const n=l1(e,t);return Za({columns:[{key:"icon",header:"",width:"40px",align:"center",sortable:false,render:i=>{const a=x("div",{className:"shop-item-icon"});if(i.spriteId){const s=me.toCanvas(i.spriteId);s?(s.style.maxWidth="32px",s.style.maxHeight="32px",s.style.width="auto",s.style.height="auto",s.style.imageRendering="auto",s.style.display="block",a.appendChild(s)):a.textContent=Bw[t];}else a.textContent=Bw[t];return a}},{key:"itemName",header:"Item",width:"1fr",align:"left",sortable:true,sortFn:(i,a)=>i.itemName.localeCompare(a.itemName,void 0,{numeric:true,sensitivity:"base"})},{key:"rarity",header:"Rarity",width:"120px",align:"left",sortable:true,sortFn:(i,a)=>{const s=i.rarity?jw[i.rarity.toLowerCase()]??999:999,l=a.rarity?jw[a.rarity.toLowerCase()]??999:999;return s-l},render:i=>{const a=x("div",{className:"shop-item-rarity"}),s=ts({variant:"rarity",rarity:i.rarity});return a.appendChild(s.root),a}},{key:"toggle",header:"Track",width:"60px",align:"center",sortable:false,render:i=>{const a=x("div",{className:"shop-item-toggle"}),s=ao({checked:i.isTracked,size:"sm",onChange:l=>{i.isTracked=l,l?Or.addTrackedItem(t,i.id):Or.removeTrackedItem(t,i.id);}});return a.appendChild(s.root),a}}],data:n,maxHeight:360,stickyHeader:true,zebra:true,compact:true,getRowId:i=>i.id})}function s3(e){const{shopType:t}=e,n=$o(),r=n.getShop(t);let o=null,i=null,a=null;function s(){return i=a3(r,t),o=dt({id:`shop-card-${t}`,title:t3[t],expandable:true,defaultExpanded:true,stateKey:`shop-${t}`,variant:"soft",padding:"none",divider:false},i.root),o.classList.add(`shop-card--${t}`),o}function l(){if(!i)return;const d=n.getShop(t),u=l1(d,t);i.setData(u);}function c(){a&&(a(),a=null),i&&(i.destroy(),i=null),o=null;}return a=n.subscribeStable(d=>{const u=d.byType[t];u&&JSON.stringify(r.items)!==JSON.stringify(u.items)&&(Object.assign(r,u),l());}),{root:s(),refresh:l,destroy:c}}const l3=["seed","tool","egg","decor"];class c3 extends pr{constructor(){super({id:"tab-shop-notifier",label:"Shop Alerts"});de(this,"sectionElement",null);de(this,"shopCards",new Map);}async build(n){await e3();const r=n.getRootNode();wt(r,ZU,"shop-notifier-styles");const o=this.createGrid("12px");o.id="shop-notifier-section",this.sectionElement=o;const{MGData:i}=await $n(async()=>{const{MGData:a}=await Promise.resolve().then(()=>Mp);return {MGData:a}},void 0);await Promise.all([i.waitFor("plants").catch(()=>{}),i.waitFor("items").catch(()=>{}),i.waitFor("eggs").catch(()=>{}),i.waitFor("decor").catch(()=>{})]),this.buildParts(),n.appendChild(o);}render(n){super.render(n);}buildParts(){if(this.sectionElement)for(const n of l3){const r=s3({shopType:n});this.shopCards.set(n,r),this.sectionElement.appendChild(r.root);}}async destroy(){for(const n of this.shopCards.values())n.destroy?.();this.shopCards.clear(),this.sectionElement=null;}}const d3=`
  #shop-restock-section {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
    width: 100%;
  }

  /* --- Global Card Style --- */
  .restock-card {
    background: var(--bg);
    backdrop-filter: blur(var(--glass-blur));
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
    transition: border-color 0.2s ease;
  }
  .restock-card:hover {
    border-color: color-mix(in oklab, var(--border) 80%, var(--accent));
  }

  .restock-wrapper .lg-table .lg-tr-body,
  .restock-wrapper .lg-table .lg-td {
    min-height: 44px;
  }

  /* --- Global Status Bar --- */
  .restock-status-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 var(--spacing-xs);
    min-height: 32px;
    font-size: var(--font-size-sm);
    color: var(--fg);
    opacity: 0.9;
  }
  .restock-status-left {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
  }
  .restock-status-right {
    opacity: 0.7;
    font-variant-numeric: tabular-nums;
  }

  /* --- Filter Bar (History/Inventory) --- */
  .restock-filter-bar {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-md);
    padding-bottom: 0;
    margin-bottom: 12px;
    flex-wrap: wrap;
  }
  .restock-filter-bar .sg-root {
    flex: 0 0 auto;
  }
  .restock-filter-bar .search-bar {
    flex: 1;
    min-width: 140px;
  }

  /* Stacked variant: chips on top, search below */
  .restock-filter-bar--stacked {
    flex-direction: column;
    align-items: stretch;
    gap: 8px;
  }
  .restock-filter-bar--stacked .search-bar {
    flex: none;
    min-width: 0;
    width: 100%;
  }

  /* --- History Shop-Type Chips --- */
  .restock-history-chips {
    display: flex;
    gap: 4px;
    flex-wrap: wrap;
  }

  .restock-history-chip {
    padding: 3px 10px;
    border-radius: 99px;
    font-size: 12px;
    font-weight: 500;
    line-height: 1.5;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--fg);
    cursor: pointer;
    white-space: nowrap;
    transition: background 0.15s ease, border-color 0.15s ease, color 0.15s ease;
    opacity: 0.75;
  }
  .restock-history-chip:hover {
    background: var(--soft);
    border-color: color-mix(in oklab, var(--border) 50%, var(--accent));
    opacity: 1;
  }
  .restock-history-chip.is-active {
    background: color-mix(in oklab, var(--accent) 15%, transparent);
    border-color: var(--accent);
    color: var(--accent);
    opacity: 1;
  }

  /* --- Table / List Rows --- */
  .restock-row-hover,
  .restock-history-table .lg-tr-body {
    transition: transform 0.15s cubic-bezier(0.34, 1.56, 0.64, 1), background-color 0.15s ease;
    cursor: pointer;
    border-radius: var(--radius-sm);
    position: relative; /* Context for z-index */
    min-height: 44px;
  }
  .restock-row-hover:hover,
  .restock-history-table .lg-tr-body:hover {
    transform: scale(1.01);
    background-color: var(--soft);
    z-index: 2;
    box-shadow: 0 4px 12px var(--shadow);
  }
  
  /* Fix table row styles when not using compact mode */
  .lg-table .lg-tr-body.restock-row-hover,
  .restock-history-table .lg-tr-body {
    margin-bottom: 2px; /* Slight gap between scaled rows */
  }
  .lg-table .lg-tr-body.restock-row-hover .lg-td,
  .restock-history-table .lg-td {
    border-bottom: none !important; /* Remove borders for cleaner look */
  }

  /* --- Item Cell Styling --- */
  .restock-item-cell {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 4px 0;
  }

  .restock-icon-wrap {
    position: relative;
    width: 42px;
    height: 42px;
    border-radius: 10px;
    background: var(--soft);
    border: 2px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
  }

  /* Rarity Borders */
  .restock-icon-wrap.rarity-common    { border-color: var(--rarity-common); }
  .restock-icon-wrap.rarity-uncommon  { border-color: var(--rarity-uncommon); }
  .restock-icon-wrap.rarity-rare      { border-color: var(--rarity-rare); }
  .restock-icon-wrap.rarity-legendary { border-color: var(--rarity-legendary); box-shadow: 0 0 8px color-mix(in oklab, var(--rarity-legendary) 30%, transparent); }
  .restock-icon-wrap.rarity-mythical  { border-color: var(--rarity-mythical); box-shadow: 0 0 10px color-mix(in oklab, var(--rarity-mythical) 40%, transparent); }
  .restock-icon-wrap.rarity-divine    { border-color: var(--rarity-divine); box-shadow: 0 0 12px color-mix(in oklab, var(--rarity-divine) 50%, transparent); }
  
  /* Celestial Rarity */
  .restock-icon-wrap.rarity-celestial { 
    border-color: var(--rarity-celestial); 
    box-shadow: 0 0 12px color-mix(in oklab, var(--rarity-celestial) 50%, transparent); 
  }

  /* Rainbow Rarity (Backup) */
  .restock-icon-wrap.rarity-rainbow {
    border: 2px solid transparent; /* Hide actual border property */
    background: 
      linear-gradient(
        color-mix(in oklab, var(--bg) 70%, transparent),
        color-mix(in oklab, var(--bg) 70%, transparent)
      ), /* Content bg (overlay on item) */
      var(--rainbow-text-gradient); /* Border gradient */
    background-origin: border-box;
    background-clip: padding-box, border-box;
    box-shadow: 0 0 12px color-mix(in oklab, var(--rarity-celestial) 40%, transparent);
  }
  
  .restock-item-sprite {
    width: 32px;
    height: 32px;
    object-fit: contain;
    position: relative; 
    z-index: 1; /* Ensure sprite is above background */
  }

  /* Source Pip Removed */
  
  .restock-item-info {
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 3px;
    min-width: 0;
  }
  .restock-item-name {
    font-weight: 700;
    font-size: 14px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.2;
    color: var(--fg);
  }
  /* Rarity Text Colors */
  .restock-text-common    { color: var(--fg); }
  .restock-text-uncommon  { color: var(--rarity-uncommon); }
  .restock-text-rare      { color: var(--rarity-rare); }
  .restock-text-legendary { color: var(--rarity-legendary); }
  .restock-text-mythical  { color: var(--rarity-mythical); }
  .restock-text-divine    { color: var(--rarity-divine); }
  .restock-text-celestial { color: var(--rarity-celestial); }
  .restock-text-rainbow { 
    background-image: var(--rainbow-text-gradient);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
  }

  .restock-item-sub {
    font-size: 12px;
    opacity: 0.9;
    display: flex;
    align-items: center;
    gap: 6px;
    line-height: 1;
  }
  
  .restock-tracked-icon {
    color: var(--rarity-legendary);
    font-size: 12px;
    filter: drop-shadow(0 0 2px color-mix(in oklab, var(--rarity-legendary) 50%, transparent));
  }

  .restock-price-wrap {
    display: flex;
    align-items: center;
    gap: 3px;
    color: var(--rarity-legendary); /* Gold-ish via theme */
    font-weight: 700;
  }

  .restock-coin-icon {
    width: 14px;
    height: 14px;
    object-fit: contain;
    display: block;
  }

  /* Heat Meter Removed */
  
  .restock-time-cell {
    font-variant-numeric: tabular-nums;
    font-weight: 600;
    opacity: 0.9;
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    line-height: 1.1;
    white-space: nowrap;
  }

  /* --- Prediction Row Specifics --- */
  .restock-pred-list {
    display: flex;
    flex-direction: column;
    gap: 2px;
    padding: var(--spacing-sm);
  }

  .restock-pred-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 12px;
    gap: 12px;
    border-radius: var(--radius-sm);
    background: color-mix(in oklab, var(--bg) 50%, transparent);
    border: 1px solid transparent;
    min-height: 52px;
  }
  .restock-pred-row:hover {
    background: var(--soft);
    border-color: var(--border);
  }

  .restock-pred-left {
    display: flex;
    align-items: center;
    gap: 12px;
    min-width: 0;
    flex: 1;
    /* Align with history table item column - total metrics width ~200px */
    max-width: calc(100% - 200px);
  }

  .restock-pred-text {
    display: flex;
    flex-direction: column;
    gap: 3px;
    min-width: 0;
  }

  .restock-pred-line1 {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .restock-pred-line2 {
    font-size: 12px;
    opacity: 0.7;
    font-variant-numeric: tabular-nums;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.2;
  }

  /* Hero metrics section (dual: ETA + Rate) */
  .restock-pred-metrics {
    display: flex;
    gap: 40px;
    align-items: center;
    flex-shrink: 0;
  }

  .restock-pred-metric-wrap {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    min-width: 52px;
    width: 52px;
    cursor: help;
  }

  /* Rate tooltip */
  .restock-pred-metric-wrap[data-tooltip]:hover::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 100%;
    right: 0;
    margin-bottom: 10px;
    padding: 10px 14px;
    background: color-mix(in oklab, var(--bg) 95%, var(--fg));
    backdrop-filter: blur(8px);
    border: 1px solid color-mix(in oklab, var(--border) 60%, transparent);
    border-radius: 8px;
    color: var(--fg);
    font-size: 13px;
    font-weight: 500;
    line-height: 1.5;
    white-space: pre-line;
    z-index: 100;
    box-shadow: 0 4px 16px color-mix(in oklab, var(--shadow) 40%, transparent);
    pointer-events: none;
    animation: tooltip-fade-in 0.15s ease-out;
  }

  @keyframes tooltip-fade-in {
    from {
      opacity: 0;
      transform: translateY(4px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .restock-pred-metric-wrap[data-tooltip]:hover::before {
    content: "";
    position: absolute;
    bottom: 100%;
    right: 22px;
    margin-bottom: 4px;
    border: 5px solid transparent;
    border-top-color: color-mix(in oklab, var(--bg) 95%, var(--fg));
    z-index: 101;
    filter: drop-shadow(0 2px 4px color-mix(in oklab, var(--shadow) 20%, transparent));
    pointer-events: none;
    animation: tooltip-fade-in 0.15s ease-out;
  }

  .restock-pred-metric-value {
    font-size: 20px;
    font-weight: 700;
    font-variant-numeric: tabular-nums;
    letter-spacing: -0.5px;
    line-height: 1.2;
    color: var(--fg);
  }

  .restock-pred-metric-label {
    font-size: 10px;
    opacity: 0.5;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  /* ETA color gradient (green=soon, red=far) */
  .restock-eta-now        { color: #10b981 !important; } /* Bright green - ready now */
  .restock-eta-imminent   { color: #22c55e !important; } /* Green - < 1h */
  .restock-eta-soon       { color: #84cc16 !important; } /* Yellow-green - 1-6h */
  .restock-eta-today      { color: #eab308 !important; } /* Yellow - 6-24h */
  .restock-eta-week       { color: #f97316 !important; } /* Orange - 1-7d */
  .restock-eta-fortnight  { color: #f87171 !important; } /* Light red - 7-14d */
  .restock-eta-far        { color: #ef4444 !important; } /* Red - > 14d */

  .restock-eta-value {
    color: var(--fg);
  }

  .restock-rate-high { color: #4ade80; }
  .restock-rate-mid  { color: #fbbf24; }
  .restock-rate-low  { color: #f87171; }
  .restock-rate-weather { color: var(--accent); }

  /* --- Responsive --- */
  @media (max-width: 520px) {
    .restock-filter-bar {
      flex-direction: column;
      align-items: stretch;
      gap: 10px;
    }
    .restock-filter-bar .search-bar {
      width: 100%;
    }
    .restock-pred-metrics {
      gap: 12px;
    }
    .restock-pred-metric-wrap {
      min-width: 48px;
      width: 48px;
    }
    .restock-pred-left {
      max-width: calc(100% - 120px);
    }
    .restock-pred-line2 {
      max-width: 200px;
    }

    /* History table mobile adjustments - make columns more compact */
    .restock-history-table .lg-th[data-col="qty"],
    .restock-history-table .lg-td[data-col="qty"] {
      width: 50px !important;
      min-width: 50px !important;
      max-width: 50px !important;
    }
    .restock-history-table .lg-th[data-col="last"],
    .restock-history-table .lg-td[data-col="last"] {
      width: 70px !important;
      min-width: 70px !important;
      max-width: 70px !important;
      font-size: 11px;
    }
    .restock-icon-wrap {
      width: 36px;
      height: 36px;
    }
    .restock-item-sprite {
      width: 28px;
      height: 28px;
    }
    .restock-item-name {
      font-size: 13px;
    }
    .restock-item-sub {
      font-size: 11px;
    }
    .restock-coin-icon {
      width: 12px;
      height: 12px;
    }
  }
`,u3={expandedCards:{predictions:true,history:false,inventory:true},historySortOrder:"newest",activeInventoryTab:"seed"};let Gw=null;async function p3(){Gw||(Gw=await co("tab-shop-restock",{version:2,defaults:u3}));}const f3={seed:"plants",egg:"eggs",decor:"decor",weather:"weather"},h3={seed:"seed",egg:null,decor:null,weather:null};function g3(e){const t=ue.get("weather");return !t||typeof t!="object"||t[e]?e:e==="Snow"&&t.Frost?"Frost":e==="Frost"&&t.Snow?"Snow":e}function Pi(e,t,n){const r=f3[t],o=ue.get(r);if(!o||typeof o!="object")return null;const i=t==="weather"?g3(e):e,a=o[i];if(!a||typeof a!="object")return null;const s=h3[t],l=s?a[s]:a;return !l||typeof l!="object"?null:l[n]??null}function c1(e,t){return Pi(e,t,"name")??e}function d1(e,t){if(t==="weather")return Pi(e,t,"spriteId")??null;const n=Pi(e,t,"spriteId")??Pi(e,t,"sprite");if(n)return n;if(t==="seed"){const o=ue.get("plants")?.[e];return o?.seed?.spriteId??o?.seed?.sprite??o?.plant?.spriteId??o?.plant?.sprite??o?.crop?.spriteId??o?.crop?.sprite??null}return null}function um(e,t){if(t==="weather")return null;const n=Pi(e,t,"rarity");return n?String(n).toLowerCase():null}function m3(e,t){return t==="weather"?0:t==="seed"||t==="egg"?Pi(e,t,"coinPrice")??0:ue.get("decor")?.[e]?.coinPrice??0}function b3(e,t){if(t==="weather")return null;const n=Pi(e,t,"expiryDate");if(!n)return null;if(typeof n=="number"&&Number.isFinite(n))return n;if(n instanceof Date)return n.getTime();if(typeof n=="string"){const r=Date.parse(n);return Number.isFinite(r)?r:null}if(typeof n=="object"&&"valueOf"in n){const r=n.valueOf();return Number.isFinite(r)?r:null}return null}function v3(e){if(!e)return "-";const t=Date.now()-e;if(t<0)return "just now";const n=Math.floor(t/6e4);if(n<1)return "just now";if(n<60)return `${n}m ago`;const r=Math.floor(n/60);return r<24?`${r}h ago`:`${Math.floor(r/24)}d ago`}function y3(e,t){if(e===null||e<=0)return "-";if(t==="weather"){const s=Math.round(1440/e);return s<60?`Every ~${s}m`:`Every ~${Math.round(s/60)}h`}const r=Mx[t]/e;if(e>=.95)return "Every restock";const o=Math.round(r/6e4);if(o<60)return `Every ~${o}m`;const i=Math.round(o/60);return i<24?`Every ~${i}h`:`Every ~${Math.round(i/24)}d`}function w3(e){if(!e)return "-";const t=e-Date.now();if(t<=0)return "now";const n=Math.ceil(t/6e4);if(n<60)return `~${n}m`;const r=Math.ceil(n/60);return r<24?`~${r}h`:`~${Math.ceil(r/24)}d`}function x3(e){return e===null||e<=0?"":e>=100?`~${Math.round(e)} avg`:e>=10?`~${Math.round(e)} avg`:Number.isInteger(e)?`~${e} avg`:`~${e.toFixed(1)} avg`}function C3(e,t){if(e===null)return "-";if(t==="weather")return !Number.isFinite(e)||e<=0?"-":`${e>=10?Math.round(e):e.toFixed(1)}/day`;const n=e*100;let r;n>=80?r=0:n>=40?r=1:n>=10?r=2:n>=1?r=3:r=4;const o=n.toFixed(r);return `${parseFloat(o)}%`}function S3(e,t){if(t==="weather")return "restock-rate-weather";if(e===null)return "restock-rate-low";const n=e*100;return n>=80?"restock-rate-high":n>=40?"restock-rate-mid":"restock-rate-low"}function _3(e){const t=[];if(e.shopType!=="weather"){const n=x3(e.averageQuantity);n&&t.push(n);}return t.push(y3(e.appearanceRate,e.shopType)),t.join(`
`)}function k3(e){if(!e)return "";const t=e-Date.now();if(t<=0)return "restock-eta-now";const n=t/(3600*1e3);if(n<1)return "restock-eta-imminent";if(n<6)return "restock-eta-soon";if(n<24)return "restock-eta-today";const r=t/(1440*60*1e3);return r<7?"restock-eta-week":r<14?"restock-eta-fortnight":"restock-eta-far"}function E3(e,t){const n=x("div",{className:"restock-pred-row restock-row-hover"}),r=x("div",{className:"restock-pred-left"}),o=x("div",{className:`restock-icon-wrap rarity-${um(e.itemId,e.shopType)??"common"}`}),i=d1(e.itemId,e.shopType);if(i)try{const f=me.toCanvas(i);f&&(f.className="restock-item-sprite",o.appendChild(f));}catch{}const a=x("div",{className:"restock-pred-text"}),s=x("div",{className:"restock-pred-line1"}),l=x("span",{className:`restock-item-name restock-text-${um(e.itemId,e.shopType)??"common"}`},c1(e.itemId,e.shopType));s.appendChild(l);const c=x("div",{className:"restock-pred-line2"});e.isEmpty?(c.textContent="Not enough data",c.style.opacity="0.5"):c.textContent=`Seen ${v3(e.lastSeen)}`,a.append(s,c),r.append(o,a);const d=x("div",{className:"restock-pred-metrics"}),u=e.shopType==="weather"&&t!==null&&u1(e.itemId)===t;if(e.isEmpty){const f=x("div",{className:"restock-pred-rate restock-rate-low"},"--");d.appendChild(f);}else {const f=x("div",{className:"restock-pred-metric-wrap"}),g=x("div",{className:`restock-pred-metric-value restock-eta-value ${u?"restock-eta-now":k3(e.estimatedNextTimestamp)}`},u?"Active Now":w3(e.estimatedNextTimestamp)),h=x("div",{className:"restock-pred-metric-label"},"next");f.append(g,h);const y=x("div",{className:"restock-pred-metric-wrap"});y.dataset.tooltip=_3(e);const S=x("div",{className:`restock-pred-metric-value ${S3(e.appearanceRate,e.shopType)}`},C3(e.appearanceRate,e.shopType)),C=x("div",{className:"restock-pred-metric-label"},"rate");y.append(S,C),d.append(f,y);}return n.append(r,d),n.addEventListener("click",f=>{f.stopPropagation(),Kn.toggleTrackedItem(e.shopType,e.itemId);}),n}function A3(){let e=null;const t=x("div",{className:"restock-pred-list"}),n=Do();let r=null;function o(){const c=n.get();if(!c.isActive){r=null;return}r=u1(c.id);}function i(){t.innerHTML="";const c=Kn.getTrackedItems(),u=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||"ontouchstart"in window||navigator.maxTouchPoints>0?"Tap":"Click";if(!c.length){const h=x("div",{style:"padding: 20px; text-align: center; opacity: 0.6; font-size: 13px; line-height: 1.5;"}),y=x("div",{},`${u} an item in the History to show the next restock estimation`);h.appendChild(y),t.appendChild(h);return}const f=c.map(h=>{const y=Kn.predictItem(h.shopType,h.itemId);return y||{itemId:h.itemId,shopType:h.shopType,estimatedNextTimestamp:null,averageIntervalMs:null,totalDataPoints:0,lastSeen:null,appearanceRate:null,averageQuantity:null,isEmpty:true}});f.sort((h,y)=>{if(h.isEmpty&&!y.isEmpty)return 1;if(!h.isEmpty&&y.isEmpty)return  -1;const S=h.appearanceRate??-1;return (y.appearanceRate??-1)-S});for(const h of f)t.appendChild(E3(h,r));const g=x("div",{style:"padding: 8px 12px; font-size: 11px; opacity: 0.5; text-align: left;"},`${u} to deselect the item in the Active Predictions`);t.appendChild(g);}o(),i(),e=window.setInterval(i,3e4),window.addEventListener(Me.SHOP_RESTOCK_TRACKED_CHANGED,i),window.addEventListener(Me.SHOP_RESTOCK_TRACKED,i),window.addEventListener(Me.SHOP_RESTOCK_HISTORY_UPDATED,i);const a=n.subscribeStable(()=>{o(),i();}),s=c=>{c.detail?.key===lt.SHOP_RESTOCK&&i();};window.addEventListener(Me.STORAGE_CHANGE,s);const l=dt({id:"restock-predictions",title:"Active Predictions",variant:"soft",padding:"none",expandable:true,defaultExpanded:true,stateKey:"predictions"},t);return l.classList.add("restock-card"),{root:l,destroy(){e!==null&&window.clearInterval(e),e=null,window.removeEventListener(Me.SHOP_RESTOCK_TRACKED_CHANGED,i),window.removeEventListener(Me.SHOP_RESTOCK_TRACKED,i),window.removeEventListener(Me.SHOP_RESTOCK_HISTORY_UPDATED,i),window.removeEventListener(Me.STORAGE_CHANGE,s),a();}}}function u1(e){return e==="Frost"?"Snow":e}function zw(e){if(!e||e<1e3)return `${e}`;const t=["K","M","B","T","Q"];let n=e,r=-1;for(;n>=1e3&&r<t.length-1;)n/=1e3,r++;return `${n>=10?Math.round(n):Math.round(n*10)/10}${t[r]}`}function T3(e){return e?new Date(e).toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit",hour12:true}):"-"}function I3(e){const t=new Date;t.setHours(0,0,0,0);const r=Math.floor((t.getTime()-new Date(e).setHours(0,0,0,0))/864e5);return !Number.isFinite(r)||r<=0?null:new Intl.RelativeTimeFormat(void 0,{numeric:"always"}).format(-r,"day")}function P3(e){if(!e)return {primary:"-",secondary:null,title:"-"};const t=new Date(e),n=T3(e),o=I3(e)??null,i=t.toLocaleString(void 0,{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:"short"});return {primary:n,secondary:o,title:i}}const Uw=[{label:"All",value:null},{label:"Seeds",value:"seed"},{label:"Eggs",value:"egg"},{label:"Decor",value:"decor"},{label:"Weather",value:"weather"}];function R3(){let e="",t=null,n=null,r=1;const o=$o();let i=null;const a=()=>Date.now(),s=es({placeholder:"Search...",value:"",debounceMs:150,withClear:true,size:"sm",blockGameKeys:true,onChange:_=>{e=_.trim().toLowerCase(),u();}});s.root.classList.add("search-bar");const l=[{key:"item",header:"ITEM",width:"2.7fr",align:"left",sortable:false,render:_=>{const E=x("div",{className:"restock-item-cell"}),P=_.rarity||"common",O=x("div",{className:`restock-icon-wrap rarity-${P}`});if(_.spriteId)try{const L=me.toCanvas(_.spriteId);L&&(L.className="restock-item-sprite",O.appendChild(L));}catch{}const k=x("div",{className:"restock-item-info"}),I=`restock-text-${P}`,R=x("div",{className:`restock-item-name ${I}`},_.itemName),A=x("div",{className:"restock-item-sub"});if(_.tracked){const L=x("span",{className:"restock-tracked-icon"},"★");A.appendChild(L);}if(_.shopType!=="weather"){const L=x("span",{className:"restock-price-wrap"});try{const G=me.toCanvas("ui","Coin");G&&(G.className="restock-coin-icon",L.appendChild(G));}catch{}const F=x("span",{},zw(_.price));L.appendChild(F),A.appendChild(L);}return k.append(R,A),E.append(O,k),E}},{key:"qty",header:"QUANTITY",width:"90px",align:"center",sortable:false,render:_=>x("div",{style:"font-variant-numeric: tabular-nums; font-weight: 600; opacity: 0.9;"},_.shopType==="weather"?String(_.totalOccurrences??0):_.totalQuantity!=null?zw(_.totalQuantity):"-")},{key:"last",header:"SEEN",width:"96px",align:"right",sortable:false,render:_=>{const E=x("div",{className:"restock-time-cell"}),P=P3(_.lastSeen);E.title=P.title;const O=x("div",{style:"font-weight: 600;"},P.primary);if(E.appendChild(O),P.secondary){const k=x("div",{style:"opacity: 0.7; font-size: 11px;"},P.secondary);E.appendChild(k);}return E}}];function c(){const _=t?[t]:["seed","egg","decor","weather"],E=new Map;for(const k of _)for(const I of Kn.getHistoryForShop(k))E.set(`${I.shopType}:${I.itemId}`,I);let P=Array.from(E.values()).map(k=>{const I=m3(k.itemId,k.shopType),R=um(k.itemId,k.shopType),A=b3(k.itemId,k.shopType);return {itemId:k.itemId,itemName:c1(k.itemId,k.shopType),shopType:k.shopType,spriteId:d1(k.itemId,k.shopType),rarity:R,price:I,expiryMs:A,totalOccurrences:k.totalOccurrences,totalQuantity:k.totalQuantity??null,lastSeen:k.lastSeen,tracked:Kn.isTracked(k.shopType,k.itemId),heatPct:0}}).filter(k=>!!k).filter(k=>!k.expiryMs||k.expiryMs>a()).filter(k=>!k.tracked);e&&(P=P.filter(k=>k.itemId.toLowerCase().includes(e)||k.itemName.toLowerCase().includes(e))),r=P.reduce((k,I)=>Math.max(k,I.totalOccurrences),1);for(const k of P)k.heatPct=k.totalOccurrences/r*100;const O={common:0,uncommon:1,rare:2,legendary:3,mythic:4,mythical:4,divine:5,celestial:6};return P.sort((k,I)=>{const R={seed:0,egg:1,decor:2,weather:3},A=R[k.shopType]??99,L=R[I.shopType]??99;if(A!==L)return A-L;const F=O[k.rarity||"common"]??99,G=O[I.rarity||"common"]??99;return F!==G?F-G:k.price!==I.price?k.price-I.price:k.itemName.localeCompare(I.itemName,void 0,{sensitivity:"base"})}),P}let d=null;function u(){if(!n||d!==null)return;const _=n;d=requestAnimationFrame(()=>{d=null;const E=_.getScrollTop();_.setData(c()),_.setScrollTop(E);});}n=Za({columns:l,data:c(),maxHeight:400,stickyHeader:true,zebra:false,compact:false,animations:false,getRowId:_=>`${_.shopType}:${_.itemId}:${_.tracked?"1":"0"}`,onRowClick:(_,E,P)=>{Kn.setTrackedItem(_.shopType,_.itemId,true);const O=Kn.getTrackedItems();Da(Me.SHOP_RESTOCK_TRACKED_CHANGED),Da(Me.SHOP_RESTOCK_TRACKED,{items:O}),u();}}),n.root.classList.add("restock-history-table"),window.addEventListener(Me.SHOP_RESTOCK_HISTORY_UPDATED,u),window.addEventListener(Me.SHOP_RESTOCK_TRACKED_CHANGED,u),window.addEventListener(Me.SHOP_RESTOCK_TRACKED,u);const f=_=>{_.detail?.key===lt.SHOP_RESTOCK&&u();};window.addEventListener(Me.STORAGE_CHANGE,f),i=o.subscribeStable(()=>u());const g=x("div",{className:"restock-history-chips"}),h=[];function y(){h.forEach((_,E)=>{_.classList.toggle("is-active",Uw[E].value===t);});}for(const _ of Uw){const E=document.createElement("button");E.type="button",E.className="restock-history-chip",E.textContent=_.label,E.addEventListener("click",()=>{t=_.value,y(),u();}),h.push(E),g.appendChild(E);}y();const S=x("div",{className:"restock-filter-bar restock-filter-bar--stacked"});S.append(g,s.root);const C=dt({id:"restock-history",title:"History",variant:"soft",padding:"none",expandable:true,defaultExpanded:false,stateKey:"history"},S,n.root);return C.classList.add("restock-card"),{root:C,destroy(){window.removeEventListener(Me.SHOP_RESTOCK_HISTORY_UPDATED,u),window.removeEventListener(Me.SHOP_RESTOCK_TRACKED_CHANGED,u),window.removeEventListener(Me.SHOP_RESTOCK_TRACKED,u),window.removeEventListener(Me.STORAGE_CHANGE,f),i&&i(),i=null,n?.destroy(),n=null;}}}const Hw=6e4;function M3(e){const t=Date.now()-e;if(t<6e4)return "just now";const n=Math.floor(t/6e4);return n<60?`${n}m ago`:`${Math.floor(n/60)}h ago`}function L3(){const e=x("div",{className:"restock-status-bar"}),t=x("div",{className:"restock-status-left"}),n=Ct({label:"Refresh",size:"sm",variant:"default",onClick:()=>{l();}});t.append(n);const r=x("div",{className:"restock-status-right"});let o=null,i=null,a=0;function s(){const f=Date.now(),g=Math.max(0,a+Hw-f);if(g<=0){n.setDisabled(false),n.setLabel("Refresh");return}n.setDisabled(true);const h=Math.ceil(g/1e3);n.setLabel(`Refresh (${h}s)`);}async function l(){const f=Date.now();if(!(f-a<Hw)){a=f,n.setLoading(true),n.setDisabled(true),s();try{await Kn.syncCommunityData(!0);}finally{n.setLoading(false),s();}}}function c(){d();}function d(){if(!i){r.textContent="Last active: -",r.title="Not synced yet";return}const f=new Date(i);r.textContent=`Last active: ${f.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`,r.title=`Synced ${M3(i)}`;}const u=f=>{const g=f.detail;g?.lastUpdated&&(i=g.lastUpdated,c());};return window.addEventListener(Me.SHOP_RESTOCK_META_UPDATED,u),c(),s(),o=window.setInterval(()=>{c(),s();},5e3),e.append(t,r),{root:e,destroy(){o&&window.clearInterval(o),window.removeEventListener(Me.SHOP_RESTOCK_META_UPDATED,u);}}}class O3 extends pr{constructor(){super({id:"tab-shop-restock",label:"Restock"});de(this,"sectionElement",null);de(this,"statusBar",null);de(this,"predictionsCard",null);de(this,"historyCard",null);}async build(n){await p3();const r=n.getRootNode();wt(r,d3,"shop-restock-styles");const o=this.createGrid("12px");o.id="shop-restock-section",this.sectionElement=o,await Promise.all([ue.waitFor("plants").catch(()=>{}),ue.waitFor("items").catch(()=>{}),ue.waitFor("eggs").catch(()=>{}),ue.waitFor("decor").catch(()=>{}),ue.waitFor("weather").catch(()=>{})]),me.isReady()||await me.init().catch(()=>{}),ZN(),VS(),this.buildParts(),n.appendChild(o);}buildParts(){this.sectionElement&&(this.statusBar=L3(),this.sectionElement.appendChild(this.statusBar.root),this.predictionsCard=A3(),this.sectionElement.appendChild(this.predictionsCard.root),this.historyCard=R3(),this.sectionElement.appendChild(this.historyCard.root));}destroy(){this.statusBar?.destroy(),this.predictionsCard?.destroy(),this.historyCard?.destroy(),this.statusBar=null,this.predictionsCard=null,this.historyCard=null,this.sectionElement=null;}}const N3=`
  #alerts-section {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  /* Shops card filters */
  .shops-card-filters {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    flex-wrap: nowrap;
  }

  .shops-card-filters .select {
    flex: 0 0 auto;
    min-width: 0;
    width: auto;
  }

  .shops-card-filters .search {
    flex: 1 1 auto;
    min-width: 0;
  }

  .shops-card-filters .search-input {
    padding-right: 40px;
  }

  .shops-card-filters .search-ico--right {
    right: 12px;
  }

  .shops-card-hint {
    padding: 8px 12px 12px;
    font-size: 12px;
    color: color-mix(in oklab, var(--fg) 60%, transparent);
    font-style: italic;
  }

  .shops-card-hint-mobile {
    display: none;
  }

  .weather-card-hint {
    padding: 8px 12px 12px;
    font-size: 12px;
    color: color-mix(in oklab, var(--fg) 60%, transparent);
    font-style: italic;
  }

  .weather-card-hint-mobile {
    display: none;
  }

  @media (hover: none) and (pointer: coarse) {
    .shops-card-hint-desktop,
    .weather-card-hint-desktop {
      display: none;
    }

    .shops-card-hint-mobile,
    .weather-card-hint-mobile {
      display: inline;
    }
  }

  /* Item cell with icon + name */
  .shop-item-cell {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .shop-item-icon {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* Sprite styling in icon container */
  .shop-item-sprite {
    max-width: 32px;
    max-height: 32px;
    width: auto;
    height: auto;
    image-rendering: auto;
    display: block;
  }

  .shop-item-name {
    flex: 1;
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  /* Rarity badge container in table */
  .shop-item-rarity {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
  }

  /* Toggle switch container in table */
  .shop-item-notify {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
  }

  /* Center headers for all columns */
  #shops-card .lg-tr-head .lg-th {
    justify-content: center;
  }

  /* Clickable rows with custom sound indicator */
  #shops-card .lg-tr-body {
    cursor: pointer;
    transition: background 0.15s ease, border-color 0.15s ease;
  }

  #shops-card .lg-tr-body:hover {
    background: color-mix(in oklab, var(--soft) 95%, transparent);
  }

  #shops-card .lg-tr-body.has-custom-sound .lg-td:first-child {
    border-left: 3px solid color-mix(in oklab, var(--accent) 70%, transparent);
  }

  #shops-card .lg-tr-body.has-custom-sound:hover .lg-td:first-child {
    border-left-color: var(--accent);
  }

  /* Weather card items */
  .weather-item-cell {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .weather-item-icon {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    font-size: 20px;
  }

  .weather-item-sprite {
    max-width: 32px;
    max-height: 32px;
    width: auto;
    height: auto;
    image-rendering: auto;
    display: block;
  }

  .weather-item-name {
    flex: 1;
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .weather-item-effects {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
  }

  .weather-item-notify {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
  }

  /* Center headers for weather card columns */
  #weather-card .lg-tr-head .lg-th {
    justify-content: center;
  }

  /* Clickable rows with custom sound indicator */
  #weather-card .lg-tr-body {
    cursor: pointer;
    transition: background 0.15s ease, border-color 0.15s ease;
  }

  #weather-card .lg-tr-body:hover {
    background: color-mix(in oklab, var(--soft) 95%, transparent);
  }

  #weather-card .lg-tr-body.has-custom-sound .lg-td:first-child {
    border-left: 3px solid color-mix(in oklab, var(--accent) 70%, transparent);
  }

  #weather-card .lg-tr-body.has-custom-sound:hover .lg-td:first-child {
    border-left-color: var(--accent);
  }

  /* Pet card styles */
  .pet-card-body {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .pet-card-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 16px;
  }

  /* Settings card styles */
  .alerts-settings-body {
    display: flex;
    flex-direction: column;
  }

  .alerts-settings-divider {
    height: 1px;
    background: var(--border);
    margin: 16px 0;
  }

  .notification-settings {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .notification-settings-title {
    font-size: 13px;
    font-weight: 600;
    color: var(--fg);
    margin-bottom: 4px;
  }

  .notification-item {
    display: flex;
    flex-direction: column;
    gap: 8px;
    padding: 12px;
    background: color-mix(in oklab, var(--soft) 85%, transparent);
    border: 1px solid color-mix(in oklab, var(--border) 70%, transparent);
    border-radius: 12px;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
  }

  .notification-item.is-playing {
    border-color: color-mix(in oklab, var(--accent) 45%, var(--border));
    box-shadow: 0 10px 22px color-mix(in oklab, var(--shadow) 18%, transparent);
  }

  .notification-item-label {
    font-size: 13px;
    font-weight: 500;
    color: var(--fg);
  }

  .notification-item-description {
    font-size: 12px;
    color: color-mix(in oklab, var(--fg) 60%, transparent);
  }

  .notification-item-controls {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .notification-item-controls .select {
    flex: 1 1 auto;
    min-width: 120px;
  }

  .notification-item-play {
    appearance: none;
    border: 1px solid color-mix(in oklab, var(--border) 70%, transparent);
    background: color-mix(in oklab, var(--soft) 78%, transparent);
    color: var(--fg);
    border-radius: 10px;
    min-height: 32px;
    min-width: 52px;
    padding: 0 8px;
    font-size: 11.5px;
    font-weight: 600;
    cursor: pointer;
    text-align: center;
    flex-shrink: 0;
    transition: border-color 0.2s ease, background 0.2s ease, transform 0.05s ease;
  }

  .notification-item-play:hover {
    border-color: color-mix(in oklab, var(--accent) 45%, var(--border));
  }

  .notification-item-play:active {
    transform: translateY(1px);
  }

  .notification-item .slider {
    width: 100%;
  }

  .notification-mode-row {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: nowrap;
  }

  .notification-mode-row .select {
    flex: 0 0 auto;
    min-width: 0;
    width: auto;
  }

  .notification-mode-description {
    flex: 1 1 auto;
    min-width: 0;
    font-size: 12px;
    color: color-mix(in oklab, var(--fg) 65%, transparent);
    font-style: italic;
  }
`,Ww={ui:{expandedCards:{settings:true,shops:false,weather:false,pet:false}}};async function $3(){const e=await co("tab-alerts",{version:1,defaults:Ww,sanitize:o=>({ui:{expandedCards:$a(Ww.ui.expandedCards,o.ui?.expandedCards)}})});function t(o){const i=e.get();e.update({ui:{...i.ui,...o,expandedCards:$a(i.ui.expandedCards,o.expandedCards)}});}function n(o,i){const a=e.get();e.update({ui:{...a.ui,expandedCards:{...a.ui.expandedCards,[o]:!!i}}});}function r(o){const i=e.get();n(o,!i.ui.expandedCards[o]);}return {get:e.get,set:e.set,save:e.save,setUI:t,setCardExpanded:n,toggleCard:r}}const D3={seed:"Seeds",tool:"Tools",egg:"Eggs",decor:"Decor"},Vw={seed:"🌱",tool:"🔧",egg:"🥚",decor:"🎨"},F3={seed:"plants",tool:"items",egg:"eggs",decor:"decor"},B3={seed:"seed",tool:null,egg:null,decor:null},qw={common:0,uncommon:1,rare:2,legendary:3,mythical:4,divine:5,celestial:6};function gv(e,t,n){try{const r=F3[t],o=ue.get(r);if(!o||typeof o!="object")return null;const i=o[e];if(!i||typeof i!="object")return null;const a=B3[t],s=a?i[a]:i;return !s||typeof s!="object"?null:s[n]??null}catch(r){return console.warn(`[Alerts] Failed to get ${n} for ${e}:`,r),null}}function j3(e,t){return gv(e,t,"spriteId")}function G3(e,t){const n=gv(e,t,"rarity");return n?String(n).toLowerCase():null}function z3(e,t){return gv(e,t,"name")??e}function U3(){const e=Or.getTrackedItems();return new Set(e.map(t=>`${t.shopType}:${t.itemId}`))}function Kw(e){const t=U3(),n=[],r=["seed","tool","egg","decor"];for(const o of r){const i=e.byType[o];if(i)for(const a of i.items){const s=`${o}:${a.id}`;n.push({...a,shopType:o,rarity:G3(a.id,o),spriteId:j3(a.id,o),itemName:z3(a.id,o),isTracked:t.has(s),hasCustomSound:Ue.hasItemCustomSound("shop",a.id,o)});}}return n}function mv(e={}){const{id:t,min:n=0,max:r=100,step:o=1,value:i=n,label:a,showValue:s=true,disabled:l=false,onInput:c,onChange:d}=e,u=x("div",{className:"slider"}),f=x("div",{className:"slider-row"}),g=x("div",{className:"slider-track"}),h=x("div",{className:"slider-range"});g.appendChild(h);const y=x("input",{id:t,type:"range",min:String(n),max:String(r),step:String(o),value:String(i),disabled:l});y.addEventListener("input",I=>{C(),c?.(E(),I);}),y.addEventListener("change",I=>d?.(E(),I));function S(){const I=r-n;return I===0?0:(E()-n)/I}function C(){const I=Math.max(0,Math.min(1,S()));h.style.width=`${I*100}%`,k&&(k.textContent=String(E()));}function _(I){y.value=String(I),C();}function E(){return Number(y.value)}function P(I){y.disabled=!!I;}let O=null,k=null;return a&&(O=x("span",{className:"slider-label"},a),f.appendChild(O)),g.appendChild(y),f.appendChild(g),s&&(k=x("span",{className:"slider-value"},String(i)),f.appendChild(k)),u.append(f),C(),{root:u,input:y,setValue:_,getValue:E,setDisabled:P}}const Xw=`
  .custom-sound-modal .modal-backdrop {
    --safe-pad-y: max(16px, var(--inset-t, 0px), var(--inset-b, 0px));
    --safe-pad-x: max(16px, var(--inset-l, 0px), var(--inset-r, 0px));
    padding: var(--safe-pad-y) var(--safe-pad-x);
  }

  .custom-sound-modal .modal-dialog {
    width: 100%;
    max-width: min(92vw, 420px);
    max-height: min(80vh, 560px);
    height: auto;
    border-radius: 12px;
    background: var(--paper, var(--bg));
    overflow: visible;
    isolation: isolate;
  }

  .custom-sound-modal .modal-header {
    padding: 14px 16px;
  }

  .custom-sound-modal .modal-title {
    font-size: 15px;
    font-weight: 600;
  }

  .custom-sound-modal-title {
    display: inline-flex;
    align-items: center;
    gap: 10px;
  }

  .custom-sound-modal-title-icon {
    width: 32px;
    height: 32px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    font-size: 20px;
  }

  .custom-sound-modal-title-sprite {
    width: 28px;
    height: 28px;
    image-rendering: auto;
  }

  .custom-sound-modal-title-text {
    color: var(--fg);
  }

  .custom-sound-modal .modal-body {
    overflow: visible;
    flex: 0 0 auto;
  }

  .custom-sound-modal .slider-value {
    color: var(--fg);
  }

  @media (max-width: 640px) {
    .custom-sound-modal .modal-backdrop {
      align-items: center;
      justify-content: center;
      min-height: 100dvh;
      height: 100dvh;
    }

    .custom-sound-modal .modal-dialog {
      max-width: min(92vw, 360px);
      max-height: min(78vh, 520px);
      border-radius: 12px;
      height: auto;
    }

    .custom-sound-modal .modal-body {
      overflow: visible;
    }
  }

  /* Header */
  .custom-sound-modal-header {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    padding-bottom: 20px;
    border-bottom: 1px solid color-mix(in oklab, var(--border) 60%, transparent);
    margin-bottom: 20px;
  }

  .custom-sound-modal-visual {
    width: 64px;
    height: 64px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: color-mix(in oklab, var(--soft) 85%, transparent);
    border-radius: 8px;
    font-size: 32px;
  }

  .custom-sound-modal-sprite {
    width: 48px;
    height: 48px;
    image-rendering: pixelated;
  }

  .custom-sound-modal-name {
    font-size: 16px;
    font-weight: 600;
    color: var(--fg);
    text-align: center;
    font-family: var(--font-ui, system-ui);
  }

  /* Body */
  .custom-sound-modal-body {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .custom-sound-modal-row {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .custom-sound-modal-label {
    font-size: 13px;
    font-weight: 600;
    color: var(--fg);
    font-family: var(--font-ui, system-ui);
  }

  .custom-sound-modal-controls {
    display: flex;
    gap: 8px;
    align-items: center;
  }

  .custom-sound-modal-controls > *:first-child {
    flex: 1;
  }

  /* Mode */
  .custom-sound-modal-mode-controls {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .custom-sound-modal-mode-description {
    font-size: 12px;
    color: color-mix(in oklab, var(--fg) 65%, transparent);
    font-style: italic;
    font-family: var(--font-ui, system-ui);
  }

  /* Footer */
  .custom-sound-modal .modal-footer {
    justify-content: flex-start;
  }

  .custom-sound-modal-footer {
    width: 100%;
    display: flex;
    gap: 8px;
    align-items: center;
  }
`,H3={title:"Custom Sound",size:"md",closeOnBackdrop:true,closeOnEscape:true},Yw={"one-shot":"Play sound once when event occurs",loop:"Loop sound while event is active"},W3=220;function V3(){return (document.querySelector("#gemini-hud-root")||document.querySelector("#gemini-root")||document.querySelector("#gemini-hud-container"))?.shadowRoot??null}function q3(e){const t=V3();if(t){wt(t,Xw,"customSoundModal");return}const n=x("style");n.textContent=Xw,e.appendChild(n);}function p1(e){const t={...H3,...e};let n=null,r=null,o=null,i=null,a=null,s=null,l=null,c=null,d=null,u=false,f=false,g=null;function h(){d?.(),d=null,c&&(c.pause(),c.currentTime=0),c=null,o?.setLabel("Play");}async function y(){if(c){h();return}if(!l)return;const G=Ue.getById(l.soundId);if(!G){console.error(`[CustomSoundModal] Sound not found: ${l.soundId}`);return}const q=new Audio(G.source);q.volume=l.volume/100,c=q;const H=()=>{h();},ce=()=>{h(),console.error(`[CustomSoundModal] Failed to play sound: ${G.name}`);};q.addEventListener("ended",H),q.addEventListener("error",ce),d=()=>{q.removeEventListener("ended",H),q.removeEventListener("error",ce);};try{await q.play(),o?.setLabel("Stop");}catch(W){h(),console.error("[CustomSoundModal] Failed to play sound:",W);}}function S(){s&&l&&(s.textContent=Yw[l.mode]);}function C(){u||g!==null||(g=window.setTimeout(()=>{P();},W3));}function _(){u||f||(f=true,h(),t.onClose?.(),C());}function E(){u||(n?.close(),_());}function P(){u||(u=true,f=true,g!==null&&(window.clearTimeout(g),g=null),h(),r&&(r.destroy(),r=null),a&&(a.destroy(),a=null),i=null,o=null,s=null,l=null,n&&(n.destroy(),n=null));}function O(){const G=x("span",{className:"custom-sound-modal-title"});let q=false;if(e.spriteId)try{const ce=me.toCanvas(e.spriteId);if(ce){const W=x("span",{className:"custom-sound-modal-title-icon"});ce.className="custom-sound-modal-title-sprite",W.appendChild(ce),G.appendChild(W),q=!0;}}catch{}if(!q&&e.icon){const ce=x("span",{className:"custom-sound-modal-title-icon"},e.icon);G.appendChild(ce);}const H=x("span",{className:"custom-sound-modal-title-text"},e.entityName);return G.appendChild(H),G}function k(){const G=x("div",{className:"custom-sound-modal-body"}),q=Ue.getItemCustomSound(e.entityType,e.entityId,e.shopType),H=Ue.getNotificationConfig(e.entityType);l=q?{soundId:q.soundId,volume:q.volume,mode:q.mode}:{soundId:H.soundId,volume:H.volume,mode:H.mode};const ce=Ue.getAll().map(j=>({value:j.id,label:j.name})),W=x("div",{className:"custom-sound-modal-row"}),te=x("label",{className:"custom-sound-modal-label"},"Sound");W.appendChild(te);const ne=x("div",{className:"custom-sound-modal-controls"});r=Ri({value:l.soundId,options:ce,size:"sm",onChange:j=>{l&&(l.soundId=j),h();}}),ne.appendChild(r.root),o=Ct({label:"Play",variant:"default",size:"sm",onClick:()=>y()}),ne.appendChild(o),W.appendChild(ne),G.appendChild(W);const ie=x("div",{className:"custom-sound-modal-row"}),ee=x("label",{className:"custom-sound-modal-label"},"Volume");ie.appendChild(ee),i=mv({min:0,max:100,step:1,value:l.volume,showValue:true,onChange:j=>{l&&(l.volume=j),c&&(c.volume=j/100);}}),ie.appendChild(i.root),G.appendChild(ie);const U=x("div",{className:"custom-sound-modal-row"}),X=x("label",{className:"custom-sound-modal-label"},"Mode");U.appendChild(X);const D=x("div",{className:"custom-sound-modal-mode-controls"});return a=Ri({value:l.mode,options:[{value:"one-shot",label:"One-shot"},{value:"loop",label:"Loop"}],size:"sm",onChange:j=>{l&&(l.mode=j),S();}}),D.appendChild(a.root),s=x("div",{className:"custom-sound-modal-mode-description"},Yw[l.mode]),D.appendChild(s),U.appendChild(D),G.appendChild(U),G}function I(){const G=x("div",{className:"custom-sound-modal-footer"}),q=Ct({label:"Reset",variant:"danger",size:"sm",onClick:()=>{e.onSave(null),E();}});G.appendChild(q);const H=x("div",{style:"flex: 1"});G.appendChild(H);const ce=Ct({label:"Cancel",variant:"default",size:"sm",onClick:()=>E()});G.appendChild(ce);const W=Ct({label:"Save",variant:"primary",size:"sm",onClick:()=>{l&&e.onSave({...l}),E();}});return G.appendChild(W),G}const R=k(),A=I(),L=x("div");q3(L),L.appendChild(R),n=df({title:e.entityName||t.title,content:L,footer:A,size:t.size,closeOnBackdrop:t.closeOnBackdrop,closeOnEscape:t.closeOnEscape,onClose:_}),n.root.classList.add("custom-sound-modal");const F=n.root.querySelector(".modal-title");return F&&F.replaceChildren(O()),{root:n.root,close:E,destroy:P}}const K3=["seed","tool","egg","decor"],X3=new Set(K3);function Ph(e){const[t,...n]=e.split(":");return !t||n.length===0||!X3.has(t)?null:{shopType:t,itemId:n.join(":")}}const Y3=500,Jw=10,J3=800;function Q3(e){const{rows:t}=e,n=new Map;let r=null,o=false;const i=new Map;let a=null,s=null,l=null,c=null,d=null,u=false;function f(D,j){j?D.classList.add("has-custom-sound"):D.classList.remove("has-custom-sound");}function g(D){const j=Ph(D);return j?Ue.hasItemCustomSound("shop",j.itemId,j.shopType):false}function h(D){if(!r)return null;const j=r.root.querySelectorAll(".lg-tr-body");for(const Q of j)if(Q.dataset.id===D)return Q;return null}function y(D,j){const Q=h(D);if(!Q)return;const ae=j??g(D);f(Q,ae);}function S(){if(!r)return;r.root.querySelectorAll(".lg-tr-body").forEach(j=>{const Q=j.dataset.id;Q&&f(j,g(Q));});}function C(){o||(o=true,requestAnimationFrame(()=>{o=false,S();}));}function _(D){i.clear();for(const j of D)i.set(`${j.shopType}:${j.id}`,j);}function E(D){const j=Ph(D);return j?Ue.hasItemCustomSound("shop",j.itemId,j.shopType):false}function P(D){const j=Ph(D);if(!j||!Ue.hasItemCustomSound("shop",j.itemId,j.shopType))return;Ue.removeItemCustomSound("shop",j.itemId,j.shopType);const Q=i.get(D);Q&&(Q.hasCustomSound=false),y(D,false),C();}function O(){s!==null&&(window.clearTimeout(s),s=null),a=null;}function k(D){a=D,s!==null&&window.clearTimeout(s),s=window.setTimeout(()=>{s=null,a=null;},J3);}function I(){l!==null&&(window.clearTimeout(l),l=null),c=null,d=null,u=false;}if(r=Za({columns:[{key:"item",header:"Item",width:"1fr",align:"left",sortable:true,sortFn:(D,j)=>D.itemName.localeCompare(j.itemName,void 0,{numeric:true,sensitivity:"base"}),render:D=>{const j=x("div",{className:"shop-item-cell"}),Q=x("div",{className:"shop-item-icon"});if(D.spriteId){const le=me.toCanvas(D.spriteId);le?(le.className="shop-item-sprite",Q.appendChild(le)):Q.textContent=Vw[D.shopType];}else Q.textContent=Vw[D.shopType];const ae=x("div",{className:"shop-item-name"});return ae.textContent=D.itemName,j.appendChild(Q),j.appendChild(ae),j}},{key:"rarity",header:"Rarity",width:"120px",align:"center",sortable:true,sortFn:(D,j)=>{const Q=D.rarity?qw[D.rarity.toLowerCase()]??999:999,ae=j.rarity?qw[j.rarity.toLowerCase()]??999:999;return Q-ae},render:D=>{const j=x("div",{className:"shop-item-rarity"}),Q=ts({variant:"rarity",rarity:D.rarity});return j.appendChild(Q.root),j}},{key:"notify",header:"Notify",width:"60px",align:"center",sortable:false,render:D=>{const j=x("div",{className:"shop-item-notify"}),Q=dw(D.id,D.shopType),ae=ao({checked:D.isTracked,disabled:Q,size:"sm",onChange:we=>{D.isTracked=we,we?Or.addTrackedItem(D.shopType,D.id):Or.removeTrackedItem(D.shopType,D.id);}}),le=`${D.shopType}:${D.id}`;return n.set(le,ae),j.appendChild(ae.root),j}}],data:t,maxHeight:400,stickyHeader:true,zebra:true,compact:true,getRowId:D=>`${D.shopType}:${D.id}`,onSortChange:()=>{C();},onRowClick:(D,j,Q)=>{const ae=`${D.shopType}:${D.id}`;if(a){if(a===ae){O();return}O();}Q.target.closest(".shop-item-notify")||p1({entityType:"shop",entityId:D.id,entityName:D.itemName,spriteId:D.spriteId,shopType:D.shopType,onSave:we=>{we===null?(Ue.removeItemCustomSound("shop",D.id,D.shopType),D.hasCustomSound=false,y(ae,false)):(Ue.setItemCustomSound("shop",D.id,we,D.shopType),D.hasCustomSound=true,y(ae,true));}});}}),!r)throw new Error("[ShopsCard] Failed to create items table");_(t);const A=r.root,L=D=>{const j=D.target;if(j.closest(".shop-item-notify"))return;const ae=j.closest(".lg-tr-body")?.dataset.id;!ae||!E(ae)||(D.preventDefault(),D.stopPropagation(),k(ae),P(ae));},F=D=>{if(D.pointerType==="mouse"||D.button!==0)return;const j=D.target;if(j.closest(".shop-item-notify"))return;const ae=j.closest(".lg-tr-body")?.dataset.id;!ae||!E(ae)||(I(),c=ae,d={x:D.clientX,y:D.clientY},l=window.setTimeout(()=>{l=null,c&&(u=true,k(c),P(c));},Y3));},G=D=>{if(!d||!c||u)return;const j=D.clientX-d.x,Q=D.clientY-d.y;j*j+Q*Q>Jw*Jw&&I();},q=()=>{I();},H=()=>{I();};A.addEventListener("contextmenu",L),A.addEventListener("pointerdown",F),A.addEventListener("pointermove",G),A.addEventListener("pointerup",q),A.addEventListener("pointercancel",H);const ce=r.setData.bind(r);r.setData=D=>{_(D),ce(D),C();},C();const W=D=>{for(const[j,Q]of n.entries()){const[ae,le]=j.split(":");if(D&&ae!==D)continue;const we=dw(le,ae);Q.setDisabled(we);}},ne=En().subscribeStable(()=>{W();}),ie=gr(),ee=ie.subscribeDecorPlaced(()=>{W("decor");}),U=ie.subscribeDecorRemoved(()=>{W("decor");}),X=r.destroy.bind(r);return r.destroy=()=>{ne(),ee(),U(),A.removeEventListener("contextmenu",L),A.removeEventListener("pointerdown",F),A.removeEventListener("pointermove",G),A.removeEventListener("pointerup",q),A.removeEventListener("pointercancel",H),I(),O(),n.clear(),i.clear(),X();},r}function Z3(e){let t="";for(const n of e)n.length>t.length&&(t=n);return t}function eH(e,t){const n=e.getRootNode(),r=n instanceof ShadowRoot?n:document.body||document.documentElement;if(!r)return 0;const o=x("div",{className:"select"});for(const d of Array.from(e.classList))d.startsWith("select--")&&o.classList.add(d);o.style.position="absolute",o.style.visibility="hidden",o.style.pointerEvents="none",o.style.left="-9999px",o.style.top="-9999px",o.style.minWidth="0";const i=x("button",{className:"select-trigger",type:"button"});i.style.width="auto",i.style.minWidth="0",i.style.whiteSpace="nowrap";const a=e.querySelector(".select-caret")?.textContent||"v",s=x("span",{className:"select-value"},t),l=x("span",{className:"select-caret"},a);i.append(s,l),o.appendChild(i),r.appendChild(o);const c=Math.ceil(i.getBoundingClientRect().width);return o.remove(),c}function tH(e,t){const n=Z3(t);if(!n)return;let r=0;const o=6,i=()=>{if(r+=1,!e.isConnected){r<o&&requestAnimationFrame(i);return}const a=eH(e,n);a>0&&(e.style.width=`${a}px`,e.style.minWidth=`${a}px`);};requestAnimationFrame(i);}function nH(e){const t=$o(),n=t.get();let r=null,o=[],i=[];const a={selectedShopType:"all",searchQuery:""},s={shopTypeSelect:null,searchInput:null,tableHandle:null};let l=0,c=new Set;function d(S,C){if(S.size!==C.size)return  false;for(const _ of S)if(!C.has(_))return  false;return  true}function u(){if(!s.tableHandle)return;const S=o.filter(C=>!(a.selectedShopType!=="all"&&C.shopType!==a.selectedShopType||a.searchQuery&&!C.itemName.toLowerCase().includes(a.searchQuery.toLowerCase())));i=S,s.tableHandle.setData(S);}function f(){const S=x("div",{className:"shops-card-filters"}),_=[{value:"all",label:"All Shops"},...["seed","tool","egg","decor"].map(P=>({value:P,label:D3[P]}))];s.shopTypeSelect=Ri({value:"all",options:_,size:"sm",onChange:P=>{a.selectedShopType=P,u();}});const E=s.shopTypeSelect.root;return E.style.minWidth="0",E.style.width="auto",tH(E,_.map(P=>P.label)),s.searchInput=es({placeholder:"Search items...",size:"sm",debounceMs:150,autoSearch:true,withClear:true,blockGameKeys:true,focusKey:"",onSearch:P=>{a.searchQuery=P.trim(),u();}}),S.appendChild(s.shopTypeSelect.root),S.appendChild(s.searchInput.root),S}function g(){o=Kw(n),i=[...o],l=o.length,c=new Set(o.map(O=>O.shopType));const S=x("div");s.tableHandle=Q3({rows:i});const C=f();S.appendChild(C),S.appendChild(s.tableHandle.root);const _=x("div",{className:"shops-card-hint"}),E=x("span",{className:"shops-card-hint-desktop"},"Click an item to set a custom sound alert. Right-click to reset"),P=x("span",{className:"shops-card-hint-mobile"},"Tap an item to set a custom sound alert. Long-press to reset");return _.append(E,P),S.appendChild(_),r=dt({id:"shops-card",title:"Shops restock",subtitle:"Get notified when tracked items restock",expandable:true,defaultExpanded:e?.defaultExpanded??true,stateKey:"shops",variant:"soft",padding:"none",divider:false,onExpandChange:e?.onExpandChange},S),r}function h(){const S=t.get(),C=Kw(S),_=C.length,E=new Set(C.map(O=>O.shopType));(_!==l||!d(E,c))&&(l=_,c=E,o=C,u());}function y(){if(s.tableHandle&&(s.tableHandle.destroy(),s.tableHandle=null),s.shopTypeSelect&&(s.shopTypeSelect.destroy(),s.shopTypeSelect=null),s.searchInput){const S=s.searchInput.root.__cleanup;S&&S(),s.searchInput=null;}r=null;}return {root:g(),refresh:h,destroy:y}}const rH=".mp3,.wav,.ogg,audio/*",oH=250*1024,iH=3;function aH(){return typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():`sound-${Date.now().toString(16)}-${Math.random().toString(16).slice(2)}`}function sH(e){const t=e.name||"Untitled",n=t.lastIndexOf(".");return n<=0?t:t.slice(0,n)||t}function lH(e){if(!Number.isFinite(e))return "0 B";if(e<1024)return `${e} B`;const t=e/1024;return t<1024?`${Math.round(t)} KB`:`${(t/1024).toFixed(1)} MB`}function f1(e){return e.split(",").map(t=>t.trim()).filter(Boolean)}function cH(e,t){const n=f1(t);if(!n.length)return  true;const r=e.name.toLowerCase(),o=e.type.toLowerCase();return n.some(i=>{const a=i.toLowerCase();if(a.startsWith("."))return r.endsWith(a);if(a.endsWith("/*")){const s=a.slice(0,-1);return o.startsWith(s)}return o===a})}function dH(e){const n=f1(e).map(r=>r.startsWith(".")?r.slice(1).toUpperCase():r.endsWith("/*")?"Audio":r.includes("/")&&r.split("/")[1]?.toUpperCase()||r.toUpperCase()).filter(Boolean);return n.length?n.join(", "):"Audio"}function uH(e={}){const{id:t,className:n,label:r="Add sounds",hint:o,accept:i=rH,multiple:a=true,disabled:s=false,maxSizeBytes:l=oH,maxItems:c,emptyLabel:d="No sounds added yet",onItemsChange:u,onFilesAdded:f,onError:g}=e;let h=[],y=0,S=null,C=false,_=!!s,E=null,P=null,O=null;const k=new Map,I=new Map,R=Number.isFinite(c)?Math.max(1,Number(c)):a?Number.POSITIVE_INFINITY:1,A=x("div",{className:"sound-picker",id:t});n&&A.classList.add(...n.split(" ").filter(Boolean)),_&&A.classList.add("is-disabled");const L=x("div",{className:"sound-picker__header"}),F=x("div",{className:"sound-picker__label"},r),G=o??`${dH(i)} - Max ${lH(l)}`,q=x("div",{className:"sound-picker__hint"},G);L.append(F,q);const H=x("div",{className:"sound-picker__zone",role:"button",tabIndex:_?-1:0,"aria-disabled":String(_)}),ce=x("div",{className:"sound-picker__zone-text"}),W=x("div",{className:"sound-picker__zone-title"},"Drop audio files here"),te=x("div",{className:"sound-picker__zone-subtitle"},"or click to browse");ce.append(W,te);const ne=Ct({label:a?"Choose files":"Choose file",size:"sm",onClick:v=>{v.preventDefault(),_||ie.click();},disabled:_});ne.classList.add("sound-picker__pick");const ie=x("input",{className:"sound-picker__input",type:"file",accept:i,multiple:a?true:void 0,disabled:_,tabIndex:-1});H.append(ce,ne,ie);const ee=x("div",{className:"sound-picker__status",role:"status","aria-live":"polite"}),U=x("div",{className:"sound-picker__list",role:"list"});A.append(L,H,ee,U);function X(v,N="info"){const z=v??"";ee.textContent=z,ee.classList.toggle("is-error",N==="error");}function D(v){g?.(v),X(v.message,"error");}function j(){for(const v of k.values())try{v.destroy();}catch{}k.clear();}function Q(v){const N=I.get(v.id);if(N)return N;const z=v.file.__sourceUrl;if(z)return I.set(v.id,z),z;const V=URL.createObjectURL(v.file);return I.set(v.id,V),V}function ae(v){const N=I.get(v);N&&(N.startsWith("blob:")&&URL.revokeObjectURL(N),I.delete(v));}function le(){O?.(),O=null,E&&(E.pause(),E.currentTime=0),E=null,P=null;}function we(){U.querySelectorAll(".sound-picker__item").forEach(N=>{const z=N.dataset.id,V=N.querySelector(".sound-picker__item-btn--play");if(!z||!V)return;const Z=!!E&&P===z&&!E.paused;V.textContent=Z?"Stop":"Play",N.classList.toggle("is-playing",Z);});}function Ie(v){if(_)return;if(P===v.id){le(),we();return}le();const N=Q(v),z=new Audio(N);E=z,P=v.id;const V=()=>{P===v.id&&(le(),we());},Z=()=>{P===v.id&&(le(),we(),D({code:"type",file:v.file,message:`Unable to play ${v.name}`}));};z.addEventListener("ended",V),z.addEventListener("error",Z),O=()=>{z.removeEventListener("ended",V),z.removeEventListener("error",Z);},z.play().then(()=>{we();}).catch(()=>{le(),we(),D({code:"type",file:v.file,message:`Unable to play ${v.name}`});});}function Ve(){if(j(),U.classList.toggle("is-scrollable",h.length>iH),!h.length){const N=x("div",{className:"sound-picker__empty"});N.append(typeof d=="string"?document.createTextNode(d):d),U.replaceChildren(N);return}const v=h.map(N=>kt(N));if(U.replaceChildren(...v),S){const N=k.get(S);N&&requestAnimationFrame(()=>N.focus());}we();}function kt(v){const N=S===v.id,z=x("div",{className:"sound-picker__item",role:"listitem","data-id":v.id}),V=x("div",{className:"sound-picker__item-top"});x("div",{className:"sound-picker__item-bottom"});const Z=x("div",{className:"sound-picker__item-name"});if(N&&!_){const Ce=ic({value:v.name,blockGameKeys:true,onEnter:ye=>{nn(v.id,ye);}});Ce.root.classList.add("sound-picker__rename"),Ce.input.classList.add("input--sm"),Ce.input.setAttribute("aria-label","Rename sound"),Ce.input.addEventListener("keydown",ye=>{ye.key==="Escape"&&(ye.preventDefault(),xn());}),Ce.input.addEventListener("blur",()=>{if(C){C=false;return}nn(v.id,Ce.getValue());}),k.set(v.id,Ce),Z.appendChild(Ce.root);}else {const Ce=x("div",{className:"sound-picker__item-label",title:v.name},v.name);Z.appendChild(Ce);}const pe=x("div",{className:"sound-picker__item-actions","aria-label":"Sound actions"});if(N&&!_){const Ce=x("button",{className:"sound-picker__item-btn",type:"button",disabled:_},"Save");Ce.addEventListener("click",()=>{const Se=k.get(v.id);nn(v.id,Se?.getValue()??v.name);});const ye=x("button",{className:"sound-picker__item-btn",type:"button",disabled:_},"Cancel");ye.addEventListener("pointerdown",()=>{C=true;}),ye.addEventListener("click",()=>xn()),pe.append(Ce,ye);}else {const Ce=x("button",{className:"sound-picker__item-btn sound-picker__item-btn--play",type:"button",disabled:_},P===v.id?"Stop":"Play");Ce.addEventListener("click",()=>Ie(v));const ye=x("button",{className:"sound-picker__item-btn",type:"button",disabled:_},"Rename");ye.addEventListener("click",()=>{_||(S=v.id,Ve());});const Se=x("button",{className:"sound-picker__item-btn sound-picker__item-btn--danger",type:"button",disabled:_},"Remove");Se.addEventListener("click",()=>ft(v.id)),pe.append(Ce,ye,Se);}return V.append(Z,pe),z.append(V),z}function mn(){return h.slice()}function St(v){const N=v.slice(),z=new Set(N.map(V=>V.id));for(const V of Array.from(I.keys()))z.has(V)||ae(V);P&&!z.has(P)&&le(),h=N,S=null,Ve(),u?.(mn());}function qt(v){if(_)return;const N=Array.from(v??[]);if(!N.length)return;const z=[],V=[];for(const Se of N){if(i&&!cH(Se,i)){V.push({code:"type",file:Se,message:`Unsupported file type: ${Se.name}`});continue}if(Number.isFinite(l)&&Se.size>l){V.push({code:"size",file:Se,maxSizeBytes:l,message:`File too large: ${Se.name}`});continue}z.push({id:aH(),file:Se,name:sH(Se),size:Se.size,type:Se.type});}if(!z.length){V.length&&D(V[0]);return}const Z=a?h.slice():[],pe=Number.isFinite(R)?Math.max(0,R-Z.length):z.length;if(pe<=0){D({code:"limit",message:`Maximum of ${Math.max(1,R)} files reached`});return}const Ce=z.slice(0,pe),ye=a?Z.concat(Ce):Ce.slice(0,1);St(ye),X(null),f?.(Ce.slice()),V.length&&D(V[0]);}function wn(v,N){const z=N.trim();if(!z){D({code:"name",message:"Name cannot be empty"});return}const V=h.map(Z=>Z.id===v?{...Z,name:z}:Z);St(V),X(null);}function nn(v,N){const z=N.trim();if(!z){D({code:"name",message:"Name cannot be empty"});return}wn(v,z);}function xn(){S=null,X(null),Ve();}function ft(v){const N=h.filter(z=>z.id!==v);St(N),X(null);}function qe(){le(),St([]),X(null);}function Qn(v){_=!!v,A.classList.toggle("is-disabled",_),H.setAttribute("aria-disabled",String(_)),H.tabIndex=_?-1:0,ie.disabled=_,ne.setDisabled(_),_&&le(),Ve();}function Zn(){_||ie.click();}const Et=v=>{if(_)return;const N=v.target;N&&N.closest(".sound-picker__pick")||ie.click();},Ft=v=>{_||(v.key==="Enter"||v.key===" ")&&(v.preventDefault(),ie.click());},Cn=v=>{_||!v.dataTransfer||!v.dataTransfer.types.includes("Files")||(v.preventDefault(),y+=1,H.classList.add("is-dragover"));},br=v=>{_||!v.dataTransfer||!v.dataTransfer.types.includes("Files")||(v.preventDefault(),v.dataTransfer.dropEffect="copy");},Dn=v=>{_||H.classList.contains("is-dragover")&&(v.preventDefault(),y=Math.max(0,y-1),y<=0&&(y=0,H.classList.remove("is-dragover")));},M=v=>{_||!v.dataTransfer||!v.dataTransfer.files.length||(v.preventDefault(),y=0,H.classList.remove("is-dragover"),qt(v.dataTransfer.files));},b=()=>{if(_){ie.value="";return}ie.files&&qt(ie.files),ie.value="";};return H.addEventListener("click",Et),H.addEventListener("keydown",Ft),H.addEventListener("dragenter",Cn),H.addEventListener("dragover",br),H.addEventListener("dragleave",Dn),H.addEventListener("drop",M),ie.addEventListener("change",b),Ve(),{root:A,getItems:mn,setItems:St,addFiles:qt,renameItem:wn,removeItem:ft,clear:qe,setDisabled:Qn,openPicker:Zn,setStatus:X,destroy(){j(),le();for(const v of Array.from(I.keys()))ae(v);H.removeEventListener("click",Et),H.removeEventListener("keydown",Ft),H.removeEventListener("dragenter",Cn),H.removeEventListener("dragover",br),H.removeEventListener("dragleave",Dn),H.removeEventListener("drop",M),ie.removeEventListener("change",b),A.remove();}}}const Qw={shop:{"one-shot":"Play sound once when item appears",loop:"Loop sound while item is available in shop"},pet:{"one-shot":"Play sound once when pet event occurs",loop:"Loop sound while pet event is active"},weather:{"one-shot":"Play sound once when weather occurs",loop:"Loop sound while weather is active"}};function pH(e){let t="";for(const n of e)n.length>t.length&&(t=n);return t}function fH(e,t){const n=e.getRootNode(),r=n instanceof ShadowRoot?n:document.body||document.documentElement;if(!r)return 0;const o=x("div",{className:"select"});for(const d of Array.from(e.classList))d.startsWith("select--")&&o.classList.add(d);o.style.position="absolute",o.style.visibility="hidden",o.style.pointerEvents="none",o.style.left="-9999px",o.style.top="-9999px",o.style.minWidth="0";const i=x("button",{className:"select-trigger",type:"button"});i.style.width="auto",i.style.minWidth="0",i.style.whiteSpace="nowrap";const a=e.querySelector(".select-caret")?.textContent||"v",s=x("span",{className:"select-value"},t),l=x("span",{className:"select-caret"},a);i.append(s,l),o.appendChild(i),r.appendChild(o);const c=Math.ceil(i.getBoundingClientRect().width);return o.remove(),c}function hH(e,t){const n=pH(t);if(!n)return;let r=0;const o=6,i=()=>{if(r+=1,!e.isConnected){r<o&&requestAnimationFrame(i);return}const a=fH(e,n);a>0&&(e.style.width=`${a}px`,e.style.minWidth=`${a}px`);};requestAnimationFrame(i);}function gH(e){let t=null,n=null,r=null;const o=new Map,i=new Map,a=new Map;let s=null,l=null,c=null;function d(){c?.(),c=null,s&&(s.pause(),s.currentTime=0),s=null,l=null;}function u(){if(!r)return;r.querySelectorAll(".notification-item").forEach(k=>{const I=k.dataset.type,R=k.querySelector(".notification-item-play");if(!I||!R)return;const A=!!s&&l===I&&!s.paused;R.textContent=A?"Stop":"Play",k.classList.toggle("is-playing",A);});}async function f(O){if(l===O){d(),u();return}d();const k=Ue.getNotificationConfig(O),I=Ue.getById(k.soundId);if(!I){console.error(`[SettingCard] Sound not found: ${k.soundId}`);return}const R=new Audio(I.source);R.volume=k.volume/100,s=R,l=O;const A=()=>{l===O&&(d(),u());},L=()=>{l===O&&(d(),u(),console.error(`[SettingCard] Failed to play sound: ${I.name}`));};R.addEventListener("ended",A),R.addEventListener("error",L),c=()=>{R.removeEventListener("ended",A),R.removeEventListener("error",L);};try{await R.play(),u();}catch(F){d(),u(),console.error("[SettingCard] Failed to play sound:",F);}}function g(O,k){if(O.startsWith("data:"))try{const I=O.split(","),R=I[0].match(/:(.*?);/)?.[1]||"audio/mpeg",A=atob(I[1]),L=A.length,F=new Uint8Array(L);for(let G=0;G<L;G++)F[G]=A.charCodeAt(G);return new File([F],k,{type:R})}catch(I){return console.error("[SettingCard] Failed to convert data URL to File:",I),new File([],k,{type:"audio/mpeg"})}return new File([],k,{type:"audio/mpeg"})}function h(){const k=Ue.getAll().map(I=>({value:I.id,label:I.name}));for(const[I,R]of o){const A=Ue.getNotificationConfig(I);R.setOptions(k),R.setValue(A.soundId);}}function y(O,k,I){const R=x("div",{className:"notification-item","data-type":O}),A=x("div",{className:"notification-item-label"},k);R.appendChild(A);const L=x("div",{className:"notification-item-description"},I);R.appendChild(L);const F=x("div",{className:"notification-item-controls"}),G=Ue.getNotificationConfig(O),H=Ue.getAll().map(X=>({value:X.id,label:X.name})),ce=Ri({value:G.soundId,options:H,size:"sm",onChange:X=>{const D=Ue.getNotificationConfig(O);Ue.setNotificationConfig(O,{soundId:X,volume:D.volume,mode:D.mode});}});o.set(O,ce);const W=x("button",{className:"notification-item-play",type:"button",title:"Test sound"},"Play");W.addEventListener("click",()=>{f(O);}),F.appendChild(ce.root),F.appendChild(W),R.appendChild(F);const te=mv({min:0,max:100,step:1,value:G.volume,showValue:true,onChange:X=>{const D=Ue.getNotificationConfig(O);Ue.setNotificationConfig(O,{soundId:D.soundId,volume:X,mode:D.mode});}});a.set(O,te),R.appendChild(te.root);const ne=x("div",{className:"notification-mode-row"}),ie=[{value:"one-shot",label:"One-shot"},{value:"loop",label:"Loop"}],ee=Ri({value:G.mode,options:ie,size:"sm",onChange:X=>{const D=Ue.getNotificationConfig(O);Ue.setNotificationConfig(O,{soundId:D.soundId,volume:D.volume,mode:X}),S(O);}});i.set(O,ee),ee.root.classList.add("shrink"),hH(ee.root,ie.map(X=>X.label)),ne.appendChild(ee.root);const U=x("div",{className:"notification-mode-description"},Qw[O][G.mode]);return ne.appendChild(U),R.appendChild(ne),R}function S(O){if(!r)return;const k=r.querySelector(`[data-type="${O}"]`);if(!k)return;const I=Ue.getNotificationConfig(O),R=k.querySelector(".notification-mode-description");R&&(R.textContent=Qw[O][I.mode]);}function C(){const O=x("div",{className:"alerts-settings-body"});Ue.init(),r=x("div",{className:"notification-settings"}),r.appendChild(y("shop","Shops restock","Default sound for shop restock alerts")),r.appendChild(y("pet","Pet events","Default sound for pet event alerts")),r.appendChild(y("weather","Weather events","Default sound for weather event alerts")),O.appendChild(r);const k=x("div",{className:"alerts-settings-divider"});O.appendChild(k);const I=Ue.getAll().map(R=>{const A=g(R.source,R.name);return A.__sourceUrl=R.source,{id:R.id,file:A,name:R.name,size:0,type:R.type}});return n=uH({label:"Notification sounds",hint:"Upload or drop audio files for alerts",maxItems:Ga.MAX_SOUNDS,maxSizeBytes:Ga.MAX_SIZE_BYTES,multiple:true,onItemsChange:R=>{_(R),h();},onFilesAdded:R=>{E(R),setTimeout(()=>{h();},100);}}),n.setItems(I),O.appendChild(n.root),t=dt({id:"alerts-settings-card",title:"Settings",subtitle:"Manage notification sounds",expandable:true,defaultExpanded:e?.defaultExpanded??true,stateKey:"settings",variant:"soft",padding:"none",divider:false,onExpandChange:e?.onExpandChange},O),t}function _(O){const k=new Set(Ue.getAll().map(A=>A.id)),I=new Set(O.map(A=>A.id)),R=[];for(const A of k)if(!I.has(A)){R.push(A);try{Ue.remove(A);}catch(L){console.error(`[SettingCard] Failed to remove sound ${A}:`,L);}}if(R.length>0){const A=["shop","pet","weather"];for(const L of A){const F=Ue.getNotificationConfig(L);if(R.includes(F.soundId)){Ue.setNotificationConfig(L,{soundId:"default-notification",volume:F.volume,mode:F.mode});const G=a.get(L);G&&G.setValue(F.volume);}}}for(const A of O)if(k.has(A.id)){const L=Ue.getById(A.id);if(L&&L.name!==A.name)try{Ue.update(A.id,{name:A.name});}catch(F){console.error(`[SettingCard] Failed to rename sound ${A.id}:`,F);}}}function E(O){for(const k of O)if(!Ue.getById(k.id)){const I=new FileReader;I.onload=R=>{const A=R.target?.result;try{const L=Ue.add(k.name,A,"upload");if(n&&L.id!==k.id){const F=n.getItems().map(G=>G.id===k.id?{...G,id:L.id}:G);n.setItems(F);}}catch(L){console.error(`[SettingCard] Failed to add sound ${k.name}:`,L);}},I.onerror=()=>{console.error(`[SettingCard] Failed to read file ${k.name}`);},I.readAsDataURL(k.file);}}function P(){d(),n&&(n.destroy(),n=null);for(const O of o.values())O.destroy();o.clear();for(const O of i.values())O.destroy();i.clear(),a.clear(),t=null;}return {root:C(),destroy:P}}function mH(e){try{const t=ue.get("weather");if(!t||typeof t!="object")return e;const n=t[e];return !n||typeof n!="object"?e:n.name||e}catch{return e}}function bH(e){try{const t=ue.get("weather");if(!t||typeof t!="object")return null;const n=t[e];return !n||typeof n!="object"?null:n.spriteId||null}catch{return null}}function vH(e){try{const t=ue.get("weather");if(!t||typeof t!="object")return "No effects";const n=t[e];if(!n||typeof n!="object")return "No effects";const r=n.mutator;if(!r||typeof r!="object")return "No effects";const o=r.mutation;if(!o)return "No effects";const i=ue.get("mutations");if(!i||typeof i!="object")return o;const a=i[o];return !a||typeof a!="object"?o:a.name||o}catch{return "No effects"}}function Zw(){const e=ue.get("weather");if(!e||typeof e!="object")return [];const t=qa.getTrackedWeathers(),n=new Set(t),r=[];for(const o of Object.keys(e)){if(o==="Sunny")continue;const i={weatherId:o,weatherName:mH(o),spriteId:bH(o),effects:vH(o),isTracked:n.has(o),hasCustomSound:Ue.hasItemCustomSound("weather",o)};r.push(i);}return r.sort((o,i)=>o.weatherName.localeCompare(i.weatherName)),r}const yH=500,ex=10,wH=800;function xH(e){const{rows:t}=e;let n=null,r=false;const o=new Map;let i=null,a=null,s=null,l=null,c=null,d=false;function u(W,te){te?W.classList.add("has-custom-sound"):W.classList.remove("has-custom-sound");}function f(W){return Ue.hasItemCustomSound("weather",W)}function g(W){if(!n)return null;const te=n.root.querySelectorAll(".lg-tr-body");for(const ne of te)if(ne.dataset.id===W)return ne;return null}function h(W,te){const ne=g(W);if(!ne)return;const ie=te??f(W);u(ne,ie);}function y(){if(!n)return;n.root.querySelectorAll(".lg-tr-body").forEach(te=>{const ne=te.dataset.id;ne&&u(te,f(ne));});}function S(){r||(r=true,requestAnimationFrame(()=>{r=false,y();}));}function C(W){o.clear();for(const te of W)o.set(te.weatherId,te);}function _(W){return Ue.hasItemCustomSound("weather",W)}function E(W){if(!Ue.hasItemCustomSound("weather",W))return;Ue.removeItemCustomSound("weather",W);const te=o.get(W);te&&(te.hasCustomSound=false),h(W,false),S();}function P(){a!==null&&(window.clearTimeout(a),a=null),i=null;}function O(W){i=W,a!==null&&window.clearTimeout(a),a=window.setTimeout(()=>{a=null,i=null;},wH);}function k(){s!==null&&(window.clearTimeout(s),s=null),l=null,c=null,d=false;}if(n=Za({columns:[{key:"weather",header:"Weather",width:"1fr",align:"left",sortable:true,sortFn:(W,te)=>W.weatherName.localeCompare(te.weatherName,void 0,{numeric:true,sensitivity:"base"}),render:W=>{const te=x("div",{className:"weather-item-cell"}),ne=x("div",{className:"weather-item-icon"});if(W.spriteId){const ee=me.toCanvas(W.spriteId);ee?(ee.className="weather-item-sprite",ne.appendChild(ee)):ne.textContent=tx(W.weatherId);}else ne.textContent=tx(W.weatherId);const ie=x("div",{className:"weather-item-name"});return ie.textContent=W.weatherName,te.appendChild(ne),te.appendChild(ie),te}},{key:"effects",header:"Effects",width:"120px",align:"center",sortable:false,render:W=>{const te=x("div",{className:"weather-item-effects"});return te.textContent=W.effects,te}},{key:"notify",header:"Notify",width:"60px",align:"center",sortable:false,render:W=>{const te=x("div",{className:"weather-item-notify"}),ne=ao({checked:W.isTracked,disabled:false,size:"sm",onChange:ie=>{W.isTracked=ie,ie?qa.addTrackedWeather(W.weatherId):qa.removeTrackedWeather(W.weatherId);}});return te.appendChild(ne.root),te}}],data:t,maxHeight:280,stickyHeader:true,zebra:true,compact:true,getRowId:W=>W.weatherId,onSortChange:()=>{S();},onRowClick:(W,te,ne)=>{const ie=W.weatherId;if(i){if(i===ie){P();return}P();}ne.target.closest(".weather-item-notify")||p1({entityType:"weather",entityId:W.weatherId,entityName:W.weatherName,spriteId:W.spriteId,onSave:U=>{U===null?(Ue.removeItemCustomSound("weather",W.weatherId),W.hasCustomSound=false,h(ie,false)):(Ue.setItemCustomSound("weather",W.weatherId,U),W.hasCustomSound=true,h(ie,true));}});}}),!n)throw new Error("[WeatherCard] Failed to create weather table");C(t);const R=n.root,A=W=>{const te=W.target;if(te.closest(".weather-item-notify"))return;const ie=te.closest(".lg-tr-body")?.dataset.id;!ie||!_(ie)||(W.preventDefault(),W.stopPropagation(),O(ie),E(ie));},L=W=>{if(W.pointerType==="mouse"||W.button!==0)return;const te=W.target;if(te.closest(".weather-item-notify"))return;const ie=te.closest(".lg-tr-body")?.dataset.id;!ie||!_(ie)||(k(),l=ie,c={x:W.clientX,y:W.clientY},s=window.setTimeout(()=>{s=null,l&&(d=true,O(l),E(l));},yH));},F=W=>{if(!c||!l||d)return;const te=W.clientX-c.x,ne=W.clientY-c.y;te*te+ne*ne>ex*ex&&k();},G=()=>{k();},q=()=>{k();};R.addEventListener("contextmenu",A),R.addEventListener("pointerdown",L),R.addEventListener("pointermove",F),R.addEventListener("pointerup",G),R.addEventListener("pointercancel",q);const H=n.setData.bind(n);n.setData=W=>{C(W),H(W),S();},S();const ce=n.destroy.bind(n);return n.destroy=()=>{R.removeEventListener("contextmenu",A),R.removeEventListener("pointerdown",L),R.removeEventListener("pointermove",F),R.removeEventListener("pointerup",G),R.removeEventListener("pointercancel",q),k(),P(),o.clear(),ce();},n}function tx(e){return {Sunny:"☀️",Rain:"🌧️",Frost:"❄️",Dawn:"🌅",AmberMoon:"🌕"}[e]||"🌤️"}function CH(e){let t=null,n=[];const r={tableHandle:null};let o=0;function i(){n=Zw(),o=n.length;const l=x("div");r.tableHandle=xH({rows:n}),l.appendChild(r.tableHandle.root);const c=x("div",{className:"weather-card-hint"}),d=x("span",{className:"weather-card-hint-desktop"},"Click a weather to set a custom sound alert. Right-click to reset"),u=x("span",{className:"weather-card-hint-mobile"},"Tap a weather to set a custom sound alert. Long-press to reset");return c.append(d,u),l.appendChild(c),t=dt({id:"weather-card",title:"Weather events",subtitle:"Get notified when specific weather appears",expandable:true,defaultExpanded:e?.defaultExpanded??true,stateKey:"weather",variant:"soft",padding:"none",divider:false,onExpandChange:e?.onExpandChange},l),t}function a(){const l=Zw(),c=l.length;c!==o&&(o=c,n=l,r.tableHandle?.setData(l));}function s(){r.tableHandle&&(r.tableHandle.destroy(),r.tableHandle=null),t=null;}return {root:i(),refresh:a,destroy:s}}function SH(e){let t=null,n=null;function r(){const i=x("div",{className:"pet-card-body"}),a=x("div",{className:"pet-card-row"}),s=km({text:"Hunger alert",hint:"Notifies when active pets drop below 5% hunger",variant:"text"});return n=ao({checked:rc.isEnabled(),onChange:l=>{rc.setEnabled(l);}}),a.appendChild(s.root),a.appendChild(n.root),i.appendChild(a),t=dt({id:"pet-hunger-card",title:"Pet events",subtitle:"Get notified about pet-related events",expandable:true,defaultExpanded:e?.defaultExpanded??true,stateKey:"pet",variant:"soft",padding:"sm",divider:false,onExpandChange:e?.onExpandChange},i),t}function o(){n&&(n.destroy(),n=null),t=null;}return {root:r(),destroy:o}}class _H extends pr{constructor(){super({id:"tab-alerts",label:"Alerts"});de(this,"sectionElement",null);de(this,"state",null);de(this,"settingCard",null);de(this,"shopsCard",null);de(this,"weatherCard",null);de(this,"petCard",null);}async build(n){this.state=await $3();const r=n.getRootNode();wt(r,N3,"alerts-styles");const o=this.createGrid("12px");o.id="alerts-section",this.sectionElement=o;const{MGData:i}=await $n(async()=>{const{MGData:c}=await Promise.resolve().then(()=>Mp);return {MGData:c}},void 0),a=["plants","items","eggs","decor","weather","mutations"],s=await Promise.allSettled(a.map(c=>i.waitFor(c))),l=a.filter((c,d)=>s[d]?.status==="rejected");l.length>0&&console.warn("[AlertsSection] MGData incomplete, building with empty tables:",l.join(", ")),this.buildParts(),n.appendChild(o);}render(n){const r=this.shopsCard,o=this.weatherCard,i=this.petCard,a=this.settingCard;this.settingCard=null,this.shopsCard=null,this.weatherCard=null,this.petCard=null,super.render(n),this.shopsCard=r,this.weatherCard=o,this.petCard=i,this.settingCard=a;}buildParts(){if(!this.sectionElement||!this.state)return;const n=this.state.get();this.shopsCard=nH({defaultExpanded:n.ui.expandedCards.shops,onExpandChange:r=>this.state.setCardExpanded("shops",r)}),this.sectionElement.appendChild(this.shopsCard.root),this.petCard=SH({defaultExpanded:n.ui.expandedCards.pet,onExpandChange:r=>this.state.setCardExpanded("pet",r)}),this.sectionElement.appendChild(this.petCard.root),this.weatherCard=CH({defaultExpanded:n.ui.expandedCards.weather,onExpandChange:r=>this.state.setCardExpanded("weather",r)}),this.sectionElement.appendChild(this.weatherCard.root),this.settingCard=gH({defaultExpanded:n.ui.expandedCards.settings,onExpandChange:r=>this.state.setCardExpanded("settings",r)}),this.sectionElement.appendChild(this.settingCard.root);}async destroy(){this.settingCard&&(this.settingCard.destroy(),this.settingCard=null),this.shopsCard&&(this.shopsCard.destroy(),this.shopsCard=null),this.petCard&&(this.petCard.destroy(),this.petCard=null),this.weatherCard&&(this.weatherCard.destroy(),this.weatherCard=null),this.sectionElement=null;}}const kH={Store:{select:rt.select.bind(rt),set:rt.set.bind(rt),subscribe:rt.subscribe.bind(rt),subscribeImmediate:rt.subscribeImmediate.bind(rt)},Globals:De,Modules:{Version:Nm,Assets:Bi,Manifest:Zr,Data:ue,Environment:Vt,CustomModal:eo,Sprite:me,Tile:so,Pixi:xp,RiveLoader:ja,Audio:Dt,Cosmetic:hb,Calculators:FS,ShopActions:fi},Features:{AutoFavorite:l_,Journal:Lt,BulkFavorite:zg,Achievements:F4,Tracker:nU,AntiAfk:Aa,Pets:rU,PetTeam:je,XPTracker:Hg,CropValueIndicator:lu,CropSizeIndicator:uu,ShopNotifier:Or,ShopRestock:Kn,WeatherNotifier:qa,PetHungerNotifier:rc,AriesAPI:ip,HarvestLocker:yn,EggLocker:Ro,DecorLocker:Mo},WebSocket:{chat:IL,emote:PL,wish:RL,kickPlayer:ML,setPlayerData:Ep,usurpHost:LL,reportSpeakingStart:OL,setSelectedGame:NL,voteForGame:$L,requestGame:DL,restartGame:FL,ping:BL,checkWeatherStatus:zL,move:jL,playerPosition:ES,teleport:GL,moveInventoryItem:UL,dropObject:HL,pickupObject:WL,toggleFavoriteItem:Ap,putItemInStorage:sb,retrieveItemFromStorage:lb,moveStorageItem:VL,logItems:qL,plantSeed:KL,waterPlant:XL,harvestCrop:YL,sellAllCrops:JL,purchaseDecor:cb,purchaseEgg:db,purchaseTool:ub,purchaseSeed:pb,plantEgg:QL,hatchEgg:ZL,plantGardenPlant:eO,potPlant:tO,mutationPotion:nO,pickupDecor:rO,placeDecor:oO,removeGardenObject:iO,placePet:AS,feedPet:aO,petPositions:sO,swapPet:TS,storePet:IS,namePet:lO,sellPet:cO},_internal:{getGlobals:Hr,initGlobals:zS,destroyGlobals:UN}};function EH(){const e=ge;e.Gemini=kH,e.MGSprite=me,e.MGData=ue,e.MGPixi=xp,e.MGRiveLoader=ja,e.MGAssets=Bi,e.MGEnvironment=Vt;}const AH=`
    /* === Container === */
    .avatar-builder {
        display: flex;
        flex-direction: column;
        gap: 12px;
        width: 100%;
        font-family: inherit;
    }

    /* === Preview Area === */
    .avatar-builder-preview-area {
        position: relative;
        background: color-mix(in oklab, var(--soft) 80%, transparent);
        border: 1px solid var(--border);
        border-radius: 16px;
        overflow: visible;
        padding: 8px 20px 12px;
        cursor: grab;
        user-select: none;
        -webkit-user-select: none;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
    }

    .avatar-builder-preview-area:active {
        cursor: grabbing;
    }

    /* === Avatar Wrapper (holds preview container + arrows) === */
    .avatar-builder-avatar-wrapper {
        position: relative;
        width: 260px;
        height: 260px;
        flex-shrink: 0;
    }

    /* === Preview Container (Layers) === */
    .avatar-builder-preview-container {
        width: 260px;
        height: 260px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.15s cubic-bezier(0.4, 0, 0.2, 1),
                    opacity 0.15s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* === Avatar Layers === */
    .avatar-builder-layer {
        position: absolute;
        width: 100%;
        height: 100%;
        object-fit: contain;
        pointer-events: none;
    }

    /* === Rive Canvas === */
    .avatar-builder-rive-canvas {
        position: absolute;
        width: 100%;
        height: 100%;
        pointer-events: none;
    }

    /* === Arrow Buttons === */
    .avatar-builder-arrow {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 36px;
        height: 36px;
        border: none;
        background: color-mix(in oklab, var(--fg) 8%, transparent);
        color: var(--fg);
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.15s ease, transform 0.15s ease;
        z-index: 100;
    }

    .avatar-builder-arrow:hover {
        background: color-mix(in oklab, var(--fg) 18%, transparent);
        transform: translateY(-50%) scale(1.1);
    }

    .avatar-builder-arrow:active {
        transform: translateY(-50%) scale(0.92);
    }

    .avatar-builder-arrow-left {
        left: 4px;
    }

    .avatar-builder-arrow-right {
        right: 4px;
    }

    /* === Item Name === */
    .avatar-builder-item-name {
        margin-top: 6px;
        background: color-mix(in oklab, var(--soft) 80%, transparent);
        color: var(--fg);
        padding: 6px 12px;
        border-radius: 999px;
        font-size: 13px;
        font-weight: 600;
        white-space: nowrap;
        max-width: 80%;
        overflow: hidden;
        text-overflow: ellipsis;
        box-shadow: 0 2px 8px color-mix(in oklab, var(--shadow) 40%, transparent);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
    }

    /* === Dots Indicator === */
    .avatar-builder-dots-indicator {
        margin-top: 4px;
        margin-bottom: 4px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
    }

    .dots-text {
        font-size: 12px;
        color: color-mix(in oklab, var(--fg) 70%, transparent);
        font-weight: 500;
    }

    .dots-container {
        display: flex;
        gap: 6px;
        align-items: center;
    }

    .dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: var(--border);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .dot.active {
        background: var(--accent);
        transform: scale(1.5);
        box-shadow: 0 0 8px var(--accent);
    }

    /* === Category Row === */
    .avatar-builder-category-row {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
        width: 100%;
    }

    .avatar-builder-category-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 16px;
        background: color-mix(in oklab, var(--soft) 80%, transparent);
        border: 2px solid var(--border);
        border-radius: 20px;
        color: var(--fg);
        cursor: pointer;
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        min-height: 72px;
        position: relative;
        overflow: hidden;
    }

    .avatar-builder-category-btn::before {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(135deg, color-mix(in oklab, var(--accent) 15%, transparent), transparent);
        opacity: 0;
        transition: opacity 0.3s ease;
        border-radius: 18px;
    }

    .avatar-builder-category-btn:hover {
        background: color-mix(in oklab, var(--muted) 100%, transparent);
        transform: translateY(-2px) scale(1.02);
        box-shadow: 0 4px 16px color-mix(in oklab, var(--shadow) 40%, transparent);
        border-color: color-mix(in oklab, var(--accent) 40%, var(--border));
    }

    .avatar-builder-category-btn:hover::before {
        opacity: 1;
    }

    .avatar-builder-category-btn.active {
        background: color-mix(in oklab, var(--accent) 12%, transparent);
        border-color: var(--accent);
        box-shadow: 0 0 20px color-mix(in oklab, var(--accent) 35%, transparent),
                    0 4px 16px color-mix(in oklab, var(--shadow) 40%, transparent);
        transform: scale(1.03);
    }

    .avatar-builder-category-btn.active::before {
        opacity: 1;
    }

    .category-icon {
        width: 48px;
        height: 48px;
        object-fit: contain;
        opacity: 0.7;
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .avatar-builder-category-btn:hover .category-icon {
        opacity: 0.9;
        transform: scale(1.1);
    }

    .avatar-builder-category-btn.active .category-icon {
        opacity: 1;
        filter: drop-shadow(0 2px 6px color-mix(in oklab, var(--accent) 50%, transparent));
        transform: scale(1.12);
    }

    /* === Responsive (Mobile) === */
    @media (max-width: 640px) {
        .avatar-builder-preview-area {
            padding: 8px 14px 12px;
        }

        .avatar-builder-avatar-wrapper {
            width: 240px;
            height: 240px;
        }

        .avatar-builder-preview-container {
            width: 240px;
            height: 240px;
        }

        .avatar-builder-item-name {
            font-size: 11px;
            padding: 4px 8px;
        }

        .avatar-builder-category-row {
            grid-template-columns: repeat(2, 1fr);
        }

        .avatar-builder-category-btn {
            min-height: 64px;
            padding: 12px;
            border-radius: 16px;
        }

        .category-icon {
            width: 40px;
            height: 40px;
        }
    }

    /* === Responsive (Tablet) === */
    @media (min-width: 641px) and (max-width: 1024px) {
        .avatar-builder-avatar-wrapper,
        .avatar-builder-preview-container {
            width: 260px;
            height: 260px;
        }

        .avatar-builder-category-row {
            grid-template-columns: repeat(4, 1fr);
        }
    }

    /* === Touch-friendly === */
    @media (hover: none) and (pointer: coarse) {
        .avatar-builder-arrow {
            width: 32px;
            height: 80px;
        }

        .avatar-builder-category-btn {
            min-height: 56px;
        }
    }

    /* === Focus states (accessibility) === */
    .avatar-builder-arrow:focus-visible,
    .avatar-builder-category-btn:focus-visible {
        outline: 2px solid var(--accent);
        outline-offset: 2px;
    }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
        .avatar-builder-layer,
        .avatar-builder-arrow,
        .avatar-builder-category-btn,
        .dot {
            transition: none !important;
            animation: none !important;
        }

        .avatar-builder-preview-container {
            transition: opacity 0.15s ease !important;
        }
    }
`,TH="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEEAAAA2CAYAAACY0PQ8AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAKnSURBVHgB7ZuPddMwEMY/9zFAmAAxAWUCzASwAWGDbsDrBs0EJBMAE9SdAHeCqBOQDcQdkuu8Ngk6ubbPcn7v3VP0LCe5zyfJ+ldgBJxzC0oWh64VRWExMAVeiOCYIbsM6Rt4Rw1ahw1k7ILZkOf0IaRsNYm2Q0eSRSCn2dmS7ANax8eARajJ7sgqEqVC35DzhuzW6WVLZiQ+iSOBfwTjPfVYLEXE29jCFxBAApTQLwDD0XoZW1gkAnz9mwqL2IKi6uB8D/AH0+B1bM8hioTwpRb6sZKuU1odmDvo515SOEWEGvqpJIVTRLDQTyUpnPKeYCjZQjHUHoj8EkdCGOBo7iorCEmpDoxmEUSNIpMqgubGUfzfUkV4gF4shKSKYKGXwSLBQidJkyy5iZDUYOfWO4h7BiZJhDEmQyOxSCA1EpJ/sGcsEugigkYGbRMYC30MLoJGziKkNti5RUISZxGQmQhhNlxMbpEwuAgGmXCOBOLVfiasNZYha+GXuu2Rew30cVKEMElchiwPu+unBb4dWer+TbZ8UnbhdLI84HjpvG/bA+WvuEyxp9D/ptEt2ZpsE/Iap92/0tNdO99LLMk+oX3yx3jfiPA93BSDDVZCHxze/OpcCu5ZNSLwSnNSo5IBu8JNa7m9F7iLnGsEPMIiTGn3SS9chCnqKSy390XdvDH+wnzZNL0Dtwvc78+tfbBkH/9FQqgS15gf1zwseBxAUeaGkhXmw4rfLvnDsx0dVDX4whfkzYYEWDaZZ0PpcDHniFjtC3ASHmHx67TLB/blClKc39G+dtPnhxPufM9JjFvnJ4pOIt3bbCj5DN9wRu8iH5gKftftTeyGjS4nXwz8uJ0nLsY++VLBO/4zZRXqJc9AGbRnoN6Fz411Zf8sFNs92jNQFh35C3Y0hc/7VYYmAAAAAElFTkSuQmCC",IH="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADoAAAA/CAYAAACxdtubAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAKfSURBVHgB7ZuPdZswEMY//DqAuwGdwM4EJRPUG9TdoCM0G7QT1NkgmSB0gngDkwnKBvQ+W+LJBJCUxnnoyO89/hgL0McdJ50sZxigaZpcNgekRy3LpyzLavfgYuSEr0iTpSzb7sFsqLRYlNbMkSZ7seiVe6DXoiJyi3RFkrVoKNwDQ66bqtu6bNwPz1w34SDU5Swo9Vl0Cx0wKLVW7ROqwW0tn+3OmeuK265l8wg91OK6H7nTtWgBXSxt9O0K/QJ9HN/TVqgo58tbQB8rrlyLrqETdh6WrtANdEJPzV2hK+ilmIPrktVRqGk/l9DL2lpUs0jSBiPNbkvaYJRDOVao5oh7ZIGZMDvX1R51T/motKMNlDO7d1Q9sxNaQTnvFtWGFfoE5Vihe+hmPxehT3MRWh6Fml+cSuildJuXP9BJJYbcu0JL6KTkqhUqqkvoFHvP1aLvoCLotnfc6Qrd4fSTuBZKu3Mm1ETfX9DDjd3pm6zBYRVO1kh9eOVeDDc8h0GRVb+7H4bStJ9IO6PZicEq98DYFLlCNg9ID3rkVVfoYOJt2tUUXfimK5JkvrPEsrRqgTSgy37r+yJEKKMv5x7lmDYVTi7b2w/wjhmZE68x/eB0OySSBA2OGZ+fenYzmlPHjAJOPTmvxr70vqOWqc8TFK8b1RJsUSavmG6Hv/QViB3Anmoa561XrNAdpsmdr0CUUNNbqhBHFViuNmVjg17Z1xPq8gHxMMf7HVi2kuWaFTEdjxzP0z+WsU2YndP/iPA08RaXgt3CJowfeAE8L/D6l20F+NRl+eupxIv/aUHrU4Tn+rx/jksjN9k0w2IP/1sJ8zAPI0K3eCsGKvPwWk/aXH/XY8noucXBPSNPhdhrymFGxfHKmAfHpTb3iO64/AONOretDlUMVwAAAABJRU5ErkJggg==",PH="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEEAAAA8CAYAAAA5S9daAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAKgSURBVHgB7ZvvdYIwEMBPXr/XTtBs0I5gJ+kI7QbtCI7QTXSD4gTiBLJBmoMEA1wC+CSpF37vReEAIZfL/ckTAA9Syg/VzvL+Oar25ernyqMAob6OwIun1WpVdoWZ54I18ENQQp8SSuAH2adFCeDxCQh6FGCE8gdkf7OB6zhZg7MvixJgWAlJsPgE8FiC6v8rMEMngD1SS5bIgc2mXnDnCEqYTb3gzhGU0KeEZ+CHoISpWcILJUxNCaSzJ5WgQskaeEaHNRUmXZbAMTIYeoObjT2REb0BTtESRFfgUsIL8KUX+pfpAItjrOiVljo8noE3raV3yhIE8EfYO4sSYFFCRapKaKUA2dAJTHmydyglcM4RDK2BpkIkqxVmF/bKc8sSOK4wu7BL6u50SGEqGJoBz1wHEqAZ8K4SBKSD0xI4rjC7eDQb/8ES3nQLTWMJrRCpPCZWj6Gdo0lcQleupYqS1b0bS4i0wpxjSavL2gLC0qw829MhRmQ4Wds5hKca9KwrCIzd8QOEpxr42JaQO7ZDIfDDVkKM6rGwtmMooUoJYk4HdIhNx9V2AeH/KBZ9OlAjX0BYojvGw0jZnAj8qJQQqYQuCFlwv4C5grGE2OHRJ5ubV6OE2OHRJ5ubdSxLyKmXLyKlz40lhM4RTp5joa3hMZoleI75FDQH0XxCfuWxOWiiwx7CUniO7SEsF6WreLlRbSfnZ3DxRIZ5DXGn2sb1AEK1b1m/SzjLzUco4VfOw1HWfRvvA2WtkE9Za+1Wo7Mdcd8feRvwmXey7oNw3e/B9zC6stvqZtLrDdQ5N4ZV3J8aWYoR5+A8fYdpmBwDr8UaZG9XqT4eYAL6R1s/LGvTQmUI3XD/WX93Gz7ofvhOrXuUcCmxC2v/BJdOl3rAruIPOjGfbeyq8HcAAAAASUVORK5CYII=",RH="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABACAYAAACNx/A2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEh0lEQVR42u3cX2iVdRzH8bPV2tIJGhYzU4iCpJssUsLQpASVyqALLS0M0lC7qFTIBL0ISugmmERFKlZKClLeLIqlTU2kWOKfUmeaEzd109zcdua2s3NeQZybDu6fZ+fsOTvPG763Pz7PGx5+z++c7+8bmf32c5FsFgowGjOwAhuwDVWowWW0Ig7oRgsu4k9UYhPW4zU8ijuT62e9siVtBKZhNb5CFY7gLC7iGqKI651utOEKLuA0fkclPsEyPIjCnBeIIkzFamzBPlxADPFkJUjWwEggWeLJiuIvfI+P8ToeyDmBGIvpWIVKNCOWrITMkkAM3ajDDryBx1AaaIEoxSNYh1PoQMzQkUAnojiE5OutJHACcRfW4BSiiAsWMbSiGotREgiBKMQi7EUj4oJNN+qxG7OGTCAKcT8+wh/ollt04RDexZisCkQxZuEbROUucTTiU0xHUcYFohjP4iC6DA/asRdzUZwxgSjGfJw0/IjjBF7CiEEXiBIsxt+GN7VYhlGDJhC3YQFq5AdnsAQjB0vgbFTLL05gIe5ISyAex0/yk2rMvWWBGI8v5TcVmHyrAtehTX4Tx+coG5BAzMNpIdCElf0WiLHYLQQAjmBGfwWuQqOQVLaiqFeBuBf7hdyM81jSl8D30SykJypQfFOBGIvfhPRGA1b0JPBNXBHSF1UouZnAPcH/RVkQqMOL/xOIh1ArpD+0Y3uqwHdwVRr0eKJJgwDnOYl7/hOIAnyHG+kGzUTogGZqxKtJgcbgbLpBgyIyS3mi2J4U6ClcHw4Cs5znJEojWInraYTNSOjg59GEKRFsRHSgYUOBmrA0ggp05KvANDK1YUMER9Ad8LB95hmCTB34NoLzSIQCB0wMhyO4FvzXRRAzJVAXQWfwwwrqV0FbBLEcChy0PIkIrufIh2sQ88QjOId4pgOnc9hPY91MC4xGUIVOSEdiph4yE+sbHBI438tJJH2RAJkWmEamdOjCvggWoEUGyJrAoaEd5RGMQx0gFNh/mjE/GcB2tAFySqKhow5lyRCeQQNSCaxMQ0sHdqX+K1clIKTKEjwa8HSqwPm4JKQvurCrp9aOLegQ0hvH8URPAifhgJCeuIzVfbW3zcujjvyB0IqNGN2fDtWlqBcC0IkdmDSQHum3wk0FdGI3pgy0yfx2LMcZJOQnHdiKSbd6T2QkFuBAnnVuJXAJH+K+dG8qFWMGtuRJ73QC+7EMZYN5W3Mc1uJgjt8T7o0abMY0FGbivnABJmMbatEu94nhIvbgZZRm48p/EWZiJ+rRkmMbTQJRNOBnvIJRWR06gUKU4UmsxzE040ZAN5w4bqAV51COOZiI4qEee3I3pmEpPsNRtKILsSESGkcMXWjFcWzCcszEhKBOLhqP57EWm1GJGrQgnubYp1RSxz91I45/cBw/4Au8hxcwMbCTi3oZFTAZS1COCvyKYziLelxDG7oQ7+dop3Y04TJqcQqH8Qt24QMsxMO4I6dmZ/U9PsAEzMEKbMDX+BHVOIeraEUsZWLbVdTiKPZhJ8qxBoswFaNRkM1n+he4a3+KgaBGGQAAAABJRU5ErkJggg==",nx={expression:{label:"Expression",type:"Expression",icon:RH},top:{label:"Top",type:"Top",icon:TH},mid:{label:"Mid",type:"Mid",icon:IH},bottom:{label:"Bottom",type:"Bottom",icon:PH}},MH={expression:"Expression_Default.png",top:"Top_DefaultGray.png",mid:"Mid_DefaultGray.png",bottom:"Bottom_DefaultGray.png"};function LH(e={}){const{initialOutfit:t={},onChange:n,width:r="100%",useRiveAnimation:o=false}=e;let i={...MH,...t},a="bottom",s={expression:[],top:[],mid:[],bottom:[]},l={expression:0,top:0,mid:0,bottom:0},c,d,u,f={},g=false,h=0,y=0,S=null,C=null;const _=[],E=x("div",{className:"avatar-builder"});E.style.width=r;const P=x("style");P.textContent=AH,E.appendChild(P);const O=x("div",{className:"avatar-builder-preview-area"});E.appendChild(O);const k=x("div",{className:"avatar-builder-avatar-wrapper"});O.appendChild(k),c=x("div",{className:"avatar-builder-preview-container"}),k.appendChild(c);const I=x("button",{className:"avatar-builder-arrow avatar-builder-arrow-left",onclick:()=>W(-1)});I.innerHTML='<svg width="18" height="18" viewBox="0 0 14 14" fill="none"><path d="M9 2L4 7L9 12" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>',k.appendChild(I);const R=x("button",{className:"avatar-builder-arrow avatar-builder-arrow-right",onclick:()=>W(1)});R.innerHTML='<svg width="18" height="18" viewBox="0 0 14 14" fill="none"><path d="M5 2L10 7L5 12" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>',k.appendChild(R),c.addEventListener("mousedown",ne),c.addEventListener("touchstart",ne,{passive:true}),_.push(()=>{c.removeEventListener("mousedown",ne),c.removeEventListener("touchstart",ne);}),d=x("div",{className:"avatar-builder-item-name"},"Loading..."),O.appendChild(d),u=x("div",{className:"avatar-builder-dots-indicator"}),O.appendChild(u);const A=x("div",{className:"avatar-builder-category-row"});E.appendChild(A),Object.entries(nx).forEach(([D,j])=>{const Q=D,ae=x("button",{className:`avatar-builder-category-btn ${Q===a?"active":""}`,onclick:()=>ce(Q),title:j.label}),le=x("img",{src:j.icon,alt:j.label,className:"category-icon"});ae.appendChild(le),f[Q]=ae,A.appendChild(ae);}),L().then(()=>{F(),q(),H();});async function L(){const D=["expression","top","mid","bottom"];await Promise.all(D.map(async j=>{const Q=await aS({type:nx[j].type});s[j]=Q;const ae=i[j],le=Q.findIndex(we=>we.filename===ae);l[j]=le>=0?le:0;}));}function F(){if(o)S?ja.updateOutfit(S,i).catch(D=>{console.error("[AvatarBuilder] Failed to update Rive outfit:",D);}):G();else {c.innerHTML="";const D=zi();[{slot:"bottom",zIndex:1},{slot:"mid",zIndex:2},{slot:"top",zIndex:3},{slot:"expression",zIndex:4}].forEach(({slot:Q,zIndex:ae})=>{const le=i[Q];if(!le)return;const we=le===oS;if(le.includes("_Blank.png")||we)return;const Ve=x("img",{src:`${D}${le}`,className:`avatar-builder-layer ${Q===a?"active":""}`,style:{zIndex:String(ae)},onerror:()=>Ve.style.display="none"});c.appendChild(Ve);});}}async function G(){if(!(!o||S))try{c.innerHTML="",C=x("canvas",{className:"avatar-builder-rive-canvas",width:260,height:260}),c.appendChild(C),S=await ja.createInstance({canvas:C,outfit:i,autoplay:!0}),console.log("[AvatarBuilder] Rive animation initialized");}catch(D){console.error("[AvatarBuilder] Failed to initialize Rive:",D),console.warn("[AvatarBuilder] Falling back to static images"),C&&(C.remove(),C=null),S=null,F();}}function q(){const D=s[a],j=l[a];if(!D||D.length===0){d.textContent="Loading...";return}const Q=D[j];d.textContent=Q?.displayName||"Unknown";}function H(){const D=s[a],j=l[a],Q=D.length;if(Q===0){u.innerHTML="";return}u.innerHTML=`<span class="dots-text">${j+1} / ${Q}</span>`;const ae=Math.min(Q,10),le=x("div",{className:"dots-container"}),we=Q>1?Math.round(j/(Q-1)*(ae-1)):0;for(let Ie=0;Ie<ae;Ie++){const Ve=x("span",{className:`dot ${Ie===we?"active":""}`});le.appendChild(Ve);}u.appendChild(le);}function ce(D){a=D,Object.entries(f).forEach(([j,Q])=>{Q.classList.toggle("active",j===D);}),F(),q(),H();}function W(D){const j=s[a];if(!j||j.length===0)return;let Q=l[a]+D;Q<0&&(Q=j.length-1),Q>=j.length&&(Q=0),l[a]=Q;const ae=j[Q];i[a]=ae.filename,n&&n({slot:a,item:ae}),te(D>0?"left":"right"),F(),q(),H();}function te(D){const j=D==="left"?-20:20;c.style.transform=`translateX(${j}px)`,c.style.opacity="0.5",setTimeout(()=>{c.style.transform="translateX(0)",c.style.opacity="1";},150);}function ne(D){g=true,h="touches"in D?D.touches[0].clientX:D.clientX,y=0;const j=ae=>{if(!g)return;y=("touches"in ae?ae.touches[0].clientX:ae.clientX)-h,c.style.transform=`translateX(${y*.3}px)`;},Q=()=>{if(g){if(g=false,c.style.transform="translateX(0)",Math.abs(y)>50){const ae=y>0?-1:1;W(ae);}document.removeEventListener("mousemove",j),document.removeEventListener("mouseup",Q),document.removeEventListener("touchmove",j),document.removeEventListener("touchend",Q);}};document.addEventListener("mousemove",j),document.addEventListener("mouseup",Q),document.addEventListener("touchmove",j),document.addEventListener("touchend",Q);}function ie(){return {...i}}function ee(D){i={...i,...D},Object.entries(D).forEach(([j,Q])=>{const ae=j;if(!Q||!s[ae])return;const le=s[ae].findIndex(we=>we.filename===Q);le>=0&&(l[ae]=le);}),F(),q(),H();}function U(D){ce(D);}function X(){S&&(S.destroy(),S=null),C&&(C.remove(),C=null),_.forEach(D=>D()),_.length=0,E.remove();}return {root:E,getOutfit:ie,setOutfit:ee,setCategory:U,destroy:X}}const OH={lastSelectedSlot:"bottom",builderExpanded:true,outfitsExpanded:true,loadoutsExpanded:true};async function NH(){const e=await co("tab-avatar-ui",{version:1,defaults:OH}),t=[];return {get:()=>e.get(),update:n=>{e.update(n);const r=e.get();t.forEach(o=>o(r));},subscribe:n=>(t.push(n),()=>{const r=t.indexOf(n);r!==-1&&t.splice(r,1);})}}const $H=`
.outfits-loadout-empty {
    padding: 4px 0 2px;
    text-align: center;
    font-size: 13px;
    color: color-mix(in oklab, var(--fg) 50%, transparent);
}

/* Horizontal carousel (used inside builder) */
.outfits-loadout-carousel {
    display: flex;
    gap: 8px;
    overflow-x: auto;
    padding: 2px 2px 8px;
    cursor: grab;
    user-select: none;
    -webkit-user-select: none;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
}
.outfits-loadout-carousel:active {
    cursor: grabbing;
}
.outfits-loadout-carousel::-webkit-scrollbar {
    height: 6px;
}
.outfits-loadout-carousel::-webkit-scrollbar-track {
    background: transparent;
}
.outfits-loadout-carousel::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 3px;
}
.outfits-loadout-carousel::-webkit-scrollbar-thumb:hover {
    background: color-mix(in oklab, var(--border) 70%, var(--fg) 30%);
}

/* Vertical grid (used in standalone loadouts card) */
.outfits-loadout-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, 72px);
    gap: 8px;
    max-height: 232px; /* 3 rows × 72px + 2 gaps × 8px */
    overflow-y: auto;
    padding: 2px 2px 4px;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
}
.outfits-loadout-grid::-webkit-scrollbar {
    width: 6px;
}
.outfits-loadout-grid::-webkit-scrollbar-track {
    background: transparent;
}
.outfits-loadout-grid::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 3px;
}
.outfits-loadout-grid::-webkit-scrollbar-thumb:hover {
    background: color-mix(in oklab, var(--border) 70%, var(--fg) 30%);
}

.outfits-loadout-hint {
    margin-top: 8px;
    padding-top: 8px;
    border-top: 1px solid color-mix(in oklab, var(--border) 50%, transparent);
    font-size: 11px;
    color: color-mix(in oklab, var(--fg) 40%, transparent);
    text-align: center;
    line-height: 1.6;
}
.outfits-loadout-hint__mobile {
    display: none;
}
@media (hover: none) and (pointer: coarse) {
    .outfits-loadout-hint__desktop {
        display: none;
    }
    .outfits-loadout-hint__mobile {
        display: block;
    }
}

.outfits-loadout-card {
    position: relative;
    flex-shrink: 0;
    width: 72px;
    height: 72px;
    border-radius: 10px;
    background: color-mix(in oklab, var(--soft) 80%, transparent);
    border: 2px solid transparent;
    cursor: pointer;
    transition: border-color 0.15s ease, background 0.15s ease;
    overflow: hidden;
}
.outfits-loadout-card:hover {
    border-color: color-mix(in oklab, var(--accent) 40%, transparent);
    background: color-mix(in oklab, var(--muted) 100%, transparent);
}
.outfits-loadout-card:active {
    opacity: 0.7;
}

.outfits-loadout-preview {
    position: relative;
    width: 100%;
    height: 100%;
    pointer-events: none;
}
.outfits-loadout-layer {
    position: absolute;
    width: 100%;
    height: 100%;
    object-fit: contain;
}
`,DH=500,rx=10,FH=800;function h1(e={}){const{onApply:t,layout:n="carousel"}=e;let r=null;function o(){if(!r)return;r.innerHTML="";const d=ki.get();if(d.length===0){r.appendChild(x("div",{className:"outfits-loadout-empty"},"No saved outfits yet."));return}const u=zi();if(n==="grid"){const f=x("div",{className:"outfits-loadout-grid"});d.forEach(g=>{f.appendChild(i(g,u));}),r.appendChild(f);}else {const f=x("div",{className:"outfits-loadout-carousel"});d.forEach(g=>{f.appendChild(i(g,u));}),a(f),r.appendChild(f);}}function i(d,u){const f=x("div",{className:"outfits-loadout-card"});let g=false,h=null;const y=()=>{g=true,h&&clearTimeout(h),h=setTimeout(()=>{g=false;},FH),ki.delete(d.id);};f.addEventListener("click",()=>{g||(t?t(d):MS.set({top:d.top,mid:d.mid,bottom:d.bottom,expression:d.expression}));}),f.addEventListener("contextmenu",k=>{k.preventDefault(),k.stopPropagation(),y();});let S=null,C=null,_=false;const E=()=>{S&&(clearTimeout(S),S=null),C=null,_=false;};f.addEventListener("pointerdown",k=>{k.pointerType!=="mouse"&&k.button===0&&(E(),C={x:k.clientX,y:k.clientY},S=setTimeout(()=>{S=null,C&&(_=true,y());},DH));}),f.addEventListener("pointermove",k=>{if(!C||_)return;const I=k.clientX-C.x,R=k.clientY-C.y;I*I+R*R>rx*rx&&E();}),f.addEventListener("pointerup",E),f.addEventListener("pointercancel",E);const P=x("div",{className:"outfits-loadout-preview"});return [d.bottom,d.mid,d.top,d.expression].forEach((k,I)=>{if(!k||k.includes("_Blank"))return;const R=x("img",{className:"outfits-loadout-layer",style:{zIndex:String(I+1)}});R.src=`${u}${k}`,R.onerror=()=>R.remove(),P.appendChild(R);}),f.appendChild(P),f}function a(d){let u=false,f=0,g=0;const h=C=>{u=true,f=("touches"in C?C.touches[0].clientX:C.clientX)-d.offsetLeft,g=d.scrollLeft;},y=C=>{if(!u)return;C.preventDefault();const _=("touches"in C?C.touches[0].clientX:C.clientX)-d.offsetLeft;d.scrollLeft=g-(_-f);},S=()=>{u=false;};d.addEventListener("mousedown",h),d.addEventListener("touchstart",h,{passive:true}),d.addEventListener("mousemove",y),d.addEventListener("touchmove",y,{passive:false}),d.addEventListener("mouseup",S),d.addEventListener("mouseleave",S),d.addEventListener("touchend",S);}const s=x("style");s.textContent=$H,r=x("div"),o();const l=x("div");l.appendChild(s),l.appendChild(r);const c=ki.subscribe(()=>o());return {root:l,destroy(){c(),r=null;}}}function BH(e={}){const{title:t="Outfits",defaultExpanded:n=true,onExpandChange:r,onApply:o,layout:i,showHint:a=false}=e,s=h1({onApply:o,layout:i}),l=dt({title:t,variant:"soft",expandable:true,defaultExpanded:n,onExpandChange:r}),c=l.querySelector(".card-body");if(c&&(c.appendChild(s.root),a)){const d=x("div",{className:"outfits-loadout-hint"});d.innerHTML=`
                <span class="outfits-loadout-hint__desktop">Click to apply · Right-click to delete</span>
                <span class="outfits-loadout-hint__mobile">Tap to apply · Hold to delete</span>
            `,c.appendChild(d);}return {root:l,destroy:()=>s.destroy()}}const jH=`
    .avatar-outfits-divider {
        margin: 10px 0 8px;
        border: none;
        border-top: 1px solid var(--border);
    }

    .avatar-save-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        width: 100%;
        padding: 10px 16px;
        border-radius: 10px;
        border: 1px solid color-mix(in oklab, var(--accent) 30%, transparent);
        background: color-mix(in oklab, var(--accent) 10%, transparent);
        color: var(--accent);
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.15s ease, border-color 0.15s ease;
        margin: 10px 0 0;
    }
    .avatar-save-btn:hover {
        background: color-mix(in oklab, var(--accent) 18%, transparent);
        border-color: color-mix(in oklab, var(--accent) 50%, transparent);
    }
    .avatar-save-btn:active {
        background: color-mix(in oklab, var(--accent) 26%, transparent);
    }
`;class GH extends pr{constructor(){super({id:"tab-avatar",label:"Avatar"});de(this,"avatarBuilder",null);de(this,"uiState",null);}async build(n){ki.init(),this.uiState=await NH();const r=await Cp().catch(()=>({top:"Top_DefaultGray.png",mid:"Mid_DefaultGray.png",bottom:"Bottom_DefaultGray.png",expression:"Expression_Default.png",color:"Red"})),o={top:r.top,mid:r.mid,bottom:r.bottom,expression:r.expression},i=this.createContainer("avatar-section");n.appendChild(i);const a=x("style");a.textContent=jH,i.appendChild(a);const s=dt({title:"Avatar editor",variant:"glass",expandable:true,defaultExpanded:this.uiState.get().builderExpanded,onExpandChange:d=>{this.uiState?.update({builderExpanded:d});}});this.avatarBuilder=LH({initialOutfit:o,useRiveAnimation:true});const l=s.querySelector(".card-body");if(l){l.appendChild(this.avatarBuilder.root);const d=x("button",{className:"avatar-save-btn"});d.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg> Save this outfit',d.addEventListener("click",()=>this.handleSave()),l.appendChild(d),l.appendChild(x("hr",{className:"avatar-outfits-divider"}));const u=h1({onApply:f=>this.avatarBuilder?.setOutfit(f)});l.appendChild(u.root),this.addCleanup(()=>u.destroy());}i.appendChild(s);const c=BH({title:"Outfits loadout",defaultExpanded:this.uiState.get().loadoutsExpanded,onExpandChange:d=>{this.uiState?.update({loadoutsExpanded:d});},layout:"grid",showHint:true});c.root.style.marginTop="12px",i.appendChild(c.root),this.addCleanup(()=>c.destroy());}async handleSave(){if(!this.avatarBuilder)return;const n=this.avatarBuilder.getOutfit(),o=`Outfit ${ki.get().length+1}`;await ki.save(o,n);}async destroy(){this.avatarBuilder&&(this.avatarBuilder.destroy(),this.avatarBuilder=null),super.destroy();}}const pm={ui:{expandedCards:{public:true}}};async function zH(){const e=await co("tab-room",{version:1,defaults:pm,sanitize:o=>({ui:{expandedCards:$a(pm.ui.expandedCards,o.ui?.expandedCards)}})});function t(o){const i=e.get();e.update({ui:{...i.ui,...o,expandedCards:$a(i.ui.expandedCards,o.expandedCards)}});}function n(o,i){const a=e.get();e.update({ui:{...a.ui,expandedCards:{...a.ui.expandedCards,[o]:!!i}}});}function r(o){const i=e.get();n(o,!i.ui.expandedCards[o]);}return {get:e.get,set:e.set,save:e.save,setUI:t,setCardExpanded:n,toggleCard:r}}const UH=`
/* Container */
.rooms-list {
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

/* Header Bar (Filter + Refresh) */
.rooms-list__header-bar {
  display: flex;
  align-items: center;
  gap: 12px;
  padding-bottom: 8px;
}

.rooms-list__header-bar > * {
  flex: 1;
  min-width: 0;
}

/* Scrollable Container (max 4 items visible) */
.rooms-list__container {
  display: flex;
  flex-direction: column;
  gap: 10px;
  max-height: 360px;
  overflow-y: auto;
  overflow-x: hidden;
  padding-right: 4px;
  position: relative;
}

/* Loading Overlay */
.rooms-list__loading-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: color-mix(in srgb, var(--bg) 80%, transparent);
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
  border-radius: 6px;
  z-index: 10;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.rooms-list__loading-overlay svg {
  color: var(--accent);
  filter: drop-shadow(0 2px 4px color-mix(in srgb, var(--shadow) 20%, transparent));
}

/* Custom scrollbar */
.rooms-list__container::-webkit-scrollbar {
  width: 6px;
}

.rooms-list__container::-webkit-scrollbar-track {
  background: color-mix(in srgb, var(--muted) 20%, transparent);
  border-radius: 3px;
}

.rooms-list__container::-webkit-scrollbar-thumb {
  background: var(--accent);
  border-radius: 3px;
  opacity: 0.7;
}

.rooms-list__container::-webkit-scrollbar-thumb:hover {
  background: var(--accent);
  opacity: 1;
}

/* Room Item (Compact Vertical Layout) */
.rooms-list__item {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 12px 14px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  transition: all 0.2s ease;
}

.rooms-list__item:hover {
  border-color: var(--accent);
  box-shadow: 0 2px 6px color-mix(in srgb, var(--shadow) 15%, transparent);
}

/* Top Row (Badge + ID + Copy) */
.rooms-list__top-row {
  display: flex;
  align-items: center;
  gap: 10px;
}

/* Platform Badge (uses theme accent color) */
.rooms-list__badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 3px 8px;
  border-radius: 4px;
  font-size: 10px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.3px;
  border: 1px solid;
  flex-shrink: 0;
  background: color-mix(in srgb, var(--accent) 15%, transparent);
  color: var(--accent);
  border-color: color-mix(in srgb, var(--accent) 30%, transparent);
}

/* Room ID */
.rooms-list__id {
  font-family: 'Courier New', monospace;
  font-size: 12px;
  color: var(--fg);
  opacity: 0.75;
  font-weight: 500;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  flex: 1;
  min-width: 0;
}

.rooms-list__copy-btn {
  background: transparent;
  border: none;
  padding: 6px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 4px;
  transition: all 0.15s ease;
  color: var(--fg);
  opacity: 0.6;
  flex-shrink: 0;
}

.rooms-list__copy-btn:hover {
  background: color-mix(in srgb, var(--accent) 15%, transparent);
  color: var(--accent);
  opacity: 1;
}

.rooms-list__copy-btn:active {
  transform: scale(0.9);
}

/* Bottom Row (Avatars + Count + Join) */
.rooms-list__bottom-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}

/* Left section (Avatars + Count) */
.rooms-list__bottom-left {
  display: flex;
  align-items: center;
  gap: 10px;
}

/* Avatars */
.rooms-list__avatars {
  display: flex;
  gap: 4px;
  align-items: center;
}

.rooms-list__avatar {
  width: 26px;
  height: 26px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 11px;
  transition: all 0.2s ease;
  flex-shrink: 0;
  overflow: hidden;
}

.rooms-list__avatar--filled {
  background: linear-gradient(135deg,
    color-mix(in srgb, var(--accent) 40%, transparent),
    color-mix(in srgb, var(--accent) 20%, transparent)
  );
  border: 1.5px solid var(--accent);
  color: var(--fg);
}

.rooms-list__avatar--empty {
  background: color-mix(in srgb, var(--shadow) 25%, transparent);
  border: 1.5px dashed color-mix(in srgb, var(--border) 50%, transparent);
  opacity: 0.4;
}

/* Player Count (Next to Avatars) */
.rooms-list__count {
  font-size: 13px;
  font-weight: 600;
  color: var(--fg);
  opacity: 0.8;
  white-space: nowrap;
  flex-shrink: 0;
}

/* Empty State */
.rooms-list__empty {
  padding: 24px 16px;
  text-align: center;
  color: var(--fg);
  opacity: 0.6;
  font-size: 13px;
  font-style: italic;
}

/* Footer (Powered by Aries + Timestamp) */
.rooms-list__footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 4px 0 4px;
  gap: 12px;
}

.rooms-list__aries-badge {
  font-size: 10px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--accent);
  opacity: 0.7;
  white-space: nowrap;
}

.rooms-list__timestamp {
  font-size: 11px;
  color: var(--fg);
  opacity: 0.6;
  font-style: italic;
  white-space: nowrap;
}

/* Responsive */
@media (max-width: 640px) {
  .rooms-list__item {
    padding: 10px 12px;
    gap: 8px;
  }

  .rooms-list__badge {
    font-size: 9px;
    padding: 2px 8px;
    min-width: 60px;
  }

  .rooms-list__id {
    font-size: 11px;
  }

  .rooms-list__avatar {
    width: 24px;
    height: 24px;
    font-size: 11px;
  }

  .rooms-list__count {
    font-size: 12px;
  }

  .rooms-list__container {
    max-height: 260px;
  }
}

/* Touch Targets */
.rooms-list__copy-btn {
  min-height: 32px;
  min-width: 32px;
}

@media (hover: hover) {
  .rooms-list__avatar--filled:hover {
    transform: scale(1.15);
    box-shadow: 0 2px 6px color-mix(in srgb, var(--accent) 35%, transparent);
  }
}
`;function HH(e){return /^I-\d+-GC-\d+-\d+$/.test(e)?"discord":"web"}function WH(e){const t=x("span",{className:`rooms-list__badge rooms-list__badge--${e}`});return t.textContent=e==="discord"?"Discord":"Web",t}function VH(e,t=16){return e.length<=t?e:`${e.slice(0,t)}...`}function qH(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");return e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("width","14"),e.setAttribute("height","14"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2"),e.setAttribute("stroke-linecap","round"),e.setAttribute("stroke-linejoin","round"),e.innerHTML=`
    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
  `,e}function KH(e,t){const n=t==="all"?e:e.filter(r=>r.playerCount<r.maxPlayers);switch(t){case "5-6":return n.filter(r=>r.playerCount>=5);case "4":return n.filter(r=>r.playerCount===4);case "1-3":return n.filter(r=>r.playerCount>=1&&r.playerCount<=3);default:return n}}function XH(e){const t=l=>l.toString().padStart(2,"0"),n=t(e.getHours()),r=t(e.getMinutes()),o=t(e.getSeconds()),i=t(e.getDate()),a=t(e.getMonth()+1),s=e.getFullYear();return `${i}/${a}/${s} ${n}:${r}:${o}`}function YH(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");return e.setAttribute("viewBox","0 0 50 50"),e.setAttribute("width","50"),e.setAttribute("height","50"),e.innerHTML=`
    <circle cx="25" cy="25" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-dasharray="31.4 31.4">
      <animateTransform attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="1s" repeatCount="indefinite"/>
    </circle>
  `,e}function JH(e={}){const{rooms:t=[],onJoinRoom:n,onCopyRoomId:r,onRefresh:o,emptyMessage:i="No rooms available",joinEnabled:a=false,initialFilter:s="5-6",onFilterChange:l}=e;let c=s,d=t;const u=x("div",{className:"rooms-list"}),f=x("style");f.textContent=UH,u.appendChild(f);const g=x("div",{className:"rooms-list__header-bar"}),y=Ri({options:[{value:"5-6",label:"5-6 players"},{value:"4",label:"4 players"},{value:"1-3",label:"1-3 players"},{value:"all",label:"All"}],value:s,onChange:q=>{c=q,l?.(c),F(d);}});g.appendChild(y.root);const S=Ct({label:"Refresh rooms",variant:"default",size:"sm",iconLeft:"",onClick:()=>{o?.();}});g.appendChild(S),u.appendChild(g);const C=x("div",{style:"position: relative;"}),_=x("div",{className:"rooms-list__container"});C.appendChild(_);const E=x("div",{className:"rooms-list__loading-overlay"});E.style.display="none";const P=YH();E.appendChild(P),C.appendChild(E),u.appendChild(C);const O=x("div",{className:"rooms-list__footer"}),k=x("div",{className:"rooms-list__aries-badge"});k.textContent="Powered by Aries",O.appendChild(k);const I=x("div",{className:"rooms-list__timestamp"});I.style.display="none",O.appendChild(I),u.appendChild(O);const R=[y,{remove:()=>S.remove()}],A=[];function L(q){const H=HH(q.id),ce=x("div",{className:"rooms-list__item"}),W=x("div",{className:"rooms-list__top-row"}),te=WH(H);W.appendChild(te);const ne=x("span",{className:"rooms-list__id"});ne.textContent=VH(q.id,20),ne.title=q.id,W.appendChild(ne);const ie=qH(),ee=x("button",{className:"rooms-list__copy-btn"});ee.type="button",ee.title="Copy room ID",ee.appendChild(ie),ee.addEventListener("click",le=>{le.stopPropagation(),r?.(q.id);}),W.appendChild(ee),ce.appendChild(W);const U=x("div",{className:"rooms-list__bottom-row"}),X=x("div",{className:"rooms-list__bottom-left"}),D=x("div",{className:"rooms-list__avatars"});for(let le=0;le<q.maxPlayers;le++){const we=x("div",{className:`rooms-list__avatar ${le<q.playerCount?"rooms-list__avatar--filled":"rooms-list__avatar--empty"}`});if(q.playerAvatars&&q.playerAvatars[le]){const Ie=q.playerAvatars[le];if(Ie.avatarUrl){const Ve=x("img",{src:Ie.avatarUrl,alt:Ie.name});Ve.style.width="100%",Ve.style.height="100%",Ve.style.objectFit="cover",we.appendChild(Ve);}else we.textContent="👤";we.title=Ie.name;}else le<q.playerCount&&(we.textContent="👤");D.appendChild(we);}X.appendChild(D);const j=x("span",{className:"rooms-list__count"});j.textContent=`${q.playerCount}/${q.maxPlayers}`,X.appendChild(j),U.appendChild(X);const Q=q.playerCount>=q.maxPlayers,ae=Ct({label:"Join",variant:"primary",size:"sm",disabled:!a||Q,onClick:()=>{n?.(q.id);}});return A.push(ae),U.appendChild(ae),ce.appendChild(U),ce}function F(q){_.innerHTML="",A.forEach(ce=>{ce.destroy?ce.destroy():ce.remove&&ce.remove();}),A.length=0;const H=KH(q,c);if(H.length===0){const ce=x("div",{className:"rooms-list__empty"});ce.textContent=i,_.appendChild(ce);}else H.forEach(ce=>{const W=L(ce);_.appendChild(W);});}return F(t),{root:u,setRooms(q){d=q,F(q);},setFilter(q){c=q,y.setValue(q),F(d);},setLastUpdated(q){I.textContent=XH(q),I.style.display="block";},setLoading(q){q?(E.style.display="flex",E.style.opacity="0",E.offsetWidth,E.style.opacity="1"):(E.style.opacity="0",setTimeout(()=>{E.style.display="none";},300));},destroy(){A.forEach(q=>{q.destroy?q.destroy():q.remove&&q.remove();}),A.length=0,R.forEach(q=>{q.destroy?q.destroy():q.remove&&q.remove();}),R.length=0,u.remove();}}}async function QH(e){const{state:t,defaultExpanded:n=true,onExpandChange:r}=e;let o=null,i=false;const a=!Vt.isDiscord(),s=Vt.isDiscord(),c=Vt.detect().origin;async function d(){try{return (await ip.fetchRooms(1e3)).map(y=>({id:y.id,playerCount:y.playersCount,maxPlayers:6,playerAvatars:y.userSlots?.map(S=>({name:S.name,avatarUrl:S.avatarUrl}))}))}catch(h){return console.error("[Room] Failed to fetch rooms:",h),[]}}async function u(){if(!(i||!o)){i=true,o.setLoading(true);try{const h=await d(),y=new Date;o.setRooms(h),o.setLastUpdated(y),console.log(`[Room] Fetched ${h.length} rooms from Aries API`);}catch(h){console.error("[Room] Failed to refresh rooms:",h);}finally{i=false,o.setLoading(false);}}}const f=x("div",{style:"display: flex; flex-direction: column; gap: 12px;"});o=JH({rooms:[],joinEnabled:a,onJoinRoom:h=>{const y=`${c}/r/${h}`;window.open(y,"_blank"),console.log(`[Room] Opening room: ${y}`);},onCopyRoomId:h=>{navigator.clipboard.writeText(h).then(()=>{console.log(`[Room] Room ID copied to clipboard: ${h}`);}).catch(y=>{console.error("[Room] Failed to copy room ID:",y);});},onRefresh:()=>{u();},emptyMessage:"No public rooms available",initialFilter:"5-6"}),f.appendChild(o.root);const g=dt({title:"Public",subtitle:s?"List of available public rooms (view only on Discord)":"List of available public rooms",padding:"lg",expandable:true,defaultExpanded:n,onExpandChange:h=>{r?.(h),t.setCardExpanded("public",h),h&&!i&&u();}},f);return n&&u(),{root:g,destroy(){o&&(o.destroy(),o=null);}}}class ZH extends pr{constructor(n){super({id:"tab-room",label:"Room"});de(this,"publicCardHandle",null);this.deps=n;}destroy(){this.publicCardHandle&&(this.publicCardHandle.destroy(),this.publicCardHandle=null);}async build(n){const r=this.createGrid("12px");r.id="room",n.appendChild(r);let o;try{o=await zH();}catch{o={get:()=>pm,set:()=>{},save:()=>{},setUI:()=>{},setCardExpanded:()=>{},toggleCard:()=>{}};}const i=o.get();this.publicCardHandle=await QH({state:o,defaultExpanded:!!i.ui.expandedCards.public}),r.appendChild(this.publicCardHandle.root);}}const eW=10,tW=16;function nW(e){const{selectedSpecies:t,onChange:n,placeholder:r="Search plants...",speciesRuleCount:o={},onSearchChange:i}=e;let a=t??null,s=[],l=[];const c=[],d=new Map;let u=null;const f=x("div",{className:"plant-selector"}),g=es({placeholder:r,blockGameKeys:true,withClear:true,debounceMs:150,onChange:A=>E(A)});f.appendChild(g.root),c.push(()=>{const A=g.root.__cleanup;A&&A();});const h=x("div",{className:"plant-selector__grid"});f.appendChild(h),c.push(()=>{u!==null&&(cancelAnimationFrame(u),u=null),d.clear();});function y(A,L){if(me.isReady())try{const F=me.toCanvas(A,{boundsMode:"padded"});F&&(F.style.maxWidth="40px",F.style.maxHeight="40px",F.style.width="auto",F.style.height="auto",F.style.display="block",L.replaceChildren(F));}catch(F){console.warn("[PlantSelector] Failed to load sprite:",F);}}function S(){if(d.size===0){u=null;return}const A=[],L=d.entries();for(let F=0;F<eW;F++){const G=L.next();if(G.done)break;A.push(G.value);}for(const[F,G]of A)y(G,F),d.delete(F);d.size>0?u=requestAnimationFrame(()=>{setTimeout(S,tW);}):u=null;}function C(){u===null&&(u=requestAnimationFrame(()=>{S();}));}function _(){try{const A=ue.get("plants");if(!A){console.warn("[PlantSelector] No plants data available");return}s=Object.entries(A).filter(([,L])=>L&&typeof L=="object"&&"crop"in L).map(([L,F])=>({name:L,spriteId:F.crop?.spriteId||null})),l=[...s],P();}catch(A){console.error("[PlantSelector] Failed to load plants:",A);}}function E(A){if(!A.trim())l=[...s];else {const L=A.toLowerCase();l=s.filter(F=>F.name.toLowerCase().includes(L));}i?.(A),P();}function P(){const A=h.scrollTop;if(u!==null&&(cancelAnimationFrame(u),u=null),d.clear(),h.replaceChildren(),l.length===0){const F=x("div",{className:"plant-selector__empty"},"No plants found");h.appendChild(F);return}const L=document.createDocumentFragment();l.forEach(F=>{const G=O(F);L.appendChild(G);}),h.appendChild(L),h.scrollTop=A,d.size>0&&C();}function O(A){const L=o[A.name]??0,F=x("div",{className:`plant-selector__item ${a===A.name?"plant-selector__item--selected":""}`});if(L>0){const ce=x("div",{className:"plant-selector__badge"},String(L));F.appendChild(ce);}F.addEventListener("click",()=>{a=A.name,n(A.name),P();});const G=x("div",{className:"plant-selector__sprite"}),q=x("div",{style:"width: 40px; height: 40px; background: color-mix(in oklab, var(--fg) 8%, transparent); border-radius: 4px;"});G.appendChild(q),A.spriteId&&me.isReady()&&d.set(G,A.spriteId),F.appendChild(G);const H=x("div",{className:"plant-selector__name"},A.name);return F.appendChild(H),F}_();function k(){return a}function I(A){a=A,P();}function R(){c.forEach(A=>A()),c.length=0;}return {root:f,getSelected:k,setSelected:I,destroy:R}}function uf(e,t,n){const{size:r,mutations:o}=n;if(!me.isReady()){t.appendChild(tl(r));return}try{const s=ue.get("plants")?.[e]?.crop?.spriteId;if(!s){t.appendChild(tl(r));return}const l=me.toCanvas(s,{mutations:o&&o.length>0?o:void 0,boundsMode:"padded"});l?(g1(l,r),t.appendChild(l)):t.appendChild(tl(r));}catch(i){console.warn(`[SpriteRenderer] Failed to render plant sprite for ${e}:`,i),t.appendChild(tl(r));}}function rW(e,t,n){if(!me.isReady()){t.appendChild(Md(e,n));return}try{const i=ue.get("mutations")?.[e]?.spriteId;if(!i){t.appendChild(Md(e,n));return}const a=me.toCanvas(i,{boundsMode:"padded"});a?(g1(a,n),t.appendChild(a)):t.appendChild(Md(e,n));}catch(r){console.warn(`[SpriteRenderer] Failed to render mutation sprite for ${e}:`,r),t.appendChild(Md(e,n));}}function tl(e){return x("div",{style:`
            width: ${e}px;
            height: ${e}px;
            background: color-mix(in oklab, var(--accent) 20%, transparent);
            border-radius: 4px;
        `})}function oW(e){return x("div",{style:`
            width: ${e}px;
            height: ${e}px;
            background: linear-gradient(135deg, color-mix(in oklab, var(--fg) 8%, transparent) 0%, color-mix(in oklab, var(--fg) 15%, transparent) 100%);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: ${Math.round(e*.56)}px;
            font-weight: 300;
            color: color-mix(in oklab, var(--fg) 40%, transparent);
        `},"—")}function Md(e,t){return e==="Gold"?x("div",{style:`
                width: ${t}px;
                height: ${t}px;
                background: #FFD700;
                border-radius: 4px;
            `}):e==="Rainbow"?x("div",{style:`
                width: ${t}px;
                height: ${t}px;
                background: linear-gradient(135deg, #ff0000 0%, #ff7700 16%, #ffff00 33%, #00ff00 50%, #0099ff 66%, #9966ff 83%, #ff0088 100%);
                border-radius: 4px;
            `}):tl(t)}function g1(e,t){e.style.maxWidth=`${t}px`,e.style.maxHeight=`${t}px`,e.style.width="auto",e.style.height="auto",e.style.display="block";}const So=["none","Gold","Rainbow"],up={wet:["Wet","Chilled","Frozen"],lunar:["Dawnlit","Ambershine","Dawncharged","Ambercharged"]};function m1(){if(!me.isReady())return console.warn("[MutationData] MGSprite not ready yet"),[];try{return me.getMutationNames().filter(t=>t!=="Gold"&&t!=="Rainbow")}catch(e){return console.error("[MutationData] Failed to get mutation names:",e),[]}}function b1(e){if(e==="none")return "Normal";try{return ue.get("mutations")?.[e]?.name||e}catch{return e}}function iW(e){return e.map(t=>t==="none"?"none":b1(t).toLowerCase()).join(", ")}function aW(){return m1()}function oa(e){const n=aW().indexOf(e);return n===-1?1/0:n}function fm(e){return up.wet.includes(e)}function hm(e){return up.lunar.includes(e)}function sW(e){const t=e.filter(o=>fm(o)),n=e.filter(o=>hm(o)),r=[];return t.length>0&&r.push(t[0]),n.length>0&&r.length<2&&r.push(n[0]),r}function Ld(e){const t=[e.mode];if(e.sizeCondition?.enabled&&t.push(`size:${e.sizeCondition.minPercentage}`),e.mutationCondition?.enabled){const n=[...e.mutationCondition.mutations].sort();t.push(`mut:${e.mutationCondition.matchMode}:${n.join(",")}`);}return t.join("|")}const lW=32;function v1(e){const{mutationId:t,isSelected:n,onToggle:r,size:o=lW}=e;let i=n,a=false;const s=x("div",{style:`
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.15s ease;
        `});u(),s.addEventListener("click",r),s.addEventListener("mouseenter",()=>{!i&&!a&&(s.style.background="color-mix(in oklab, var(--fg) 10%, transparent)");}),s.addEventListener("mouseleave",()=>{!i&&!a&&(s.style.background="color-mix(in oklab, var(--fg) 5%, transparent)");});const l=x("div",{style:"display: flex; align-items: center; justify-content: center;"});t==="none"?l.appendChild(oW(o)):rW(t,l,o),s.appendChild(l);const c=e.label??b1(t),d=x("div",{style:`
            font-size: 10px;
            color: var(--fg);
            text-align: center;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        `},c);s.appendChild(d);function u(){i?(s.style.background="color-mix(in oklab, var(--accent) 20%, transparent)",s.style.border="1px solid var(--accent)"):(s.style.background="color-mix(in oklab, var(--fg) 5%, transparent)",s.style.border="1px solid color-mix(in oklab, var(--fg) 10%, transparent)");}function f(h){i=h,u();}function g(h){a=h,s.style.opacity=a?"0.35":"1",s.style.pointerEvents=a?"none":"",s.style.cursor=a?"default":"pointer";}return {root:s,setSelected:f,setDisabled:g}}function cW(e){const{enabled:t,percentage:n,sizeMode:r,ruleMode:o,onEnabledChange:i,onPercentageChange:a,onSizeModeChange:s,expanded:l=false,onExpandChange:c}=e;let d=t,u=n,f=r,g=o,h=null,y=null,S=null;const C=x("div",{style:"display: flex; flex-direction: column; gap: 12px;"}),_=x("div",{style:`
            font-size: 10px;
            font-weight: 600;
            color: var(--accent);
            background: color-mix(in oklab, var(--accent) 12%, transparent);
            border: 1px solid color-mix(in oklab, var(--accent) 30%, transparent);
            border-radius: 10px;
            padding: 1px 6px;
            display: none;
        `},"Enabled");P();const E=dt({title:"Size",subtitle:"Growth size threshold",actions:[_],variant:"soft",padding:"md",expandable:true,defaultExpanded:l,onExpandChange:c},C);function P(){C.replaceChildren(),_.style.display=d?"":"none";const R=x("div",{style:"display: flex; align-items: center; gap: 12px;"}),A=af({checked:d,label:"Enable",size:"md",onChange:W=>{d=W,i(W),P();}});R.appendChild(A.root),d&&(h=x("div",{style:"font-size: 12px; color: color-mix(in oklab, var(--fg) 70%, transparent); line-height: 1.4;"},O()),R.appendChild(h)),C.appendChild(R);const L=x("div",{style:d?"":"opacity: 0.4; pointer-events: none; transition: opacity 0.2s ease;"}),F=x("div",{style:"display: flex; justify-content: center;"}),G=Ui({segments:[{id:"min",label:"Minimum"},{id:"max",label:"Maximum"}],selected:f,onChange:W=>{f=W,s(f),P();}});F.appendChild(G),L.appendChild(F),S=x("div",{style:"display: flex; flex-direction: column; gap: 4px;"});const q=x("div",{style:"display: flex; justify-content: space-between; align-items: center;"}),H=x("div",{style:"font-size: 12px; color: var(--fg); font-weight: 500;"},"Size Threshold");y=x("span",{style:"font-size: 12px; font-weight: 600; color: var(--accent);"},`${u}%`),q.appendChild(H),q.appendChild(y),S.appendChild(q);const ce=mv({min:50,max:100,step:1,value:u,showValue:false,onInput:W=>{u=W,y&&(y.textContent=`${W}%`),h&&(h.textContent=O());},onChange:W=>{u=W,a(W);}});S.appendChild(ce.root),L.appendChild(S),C.appendChild(L);}function O(){const R=f==="min"?"at most":"at least";return g==="lock"?`Lock plants ${R} ${u}% grown`:`Allow plants ${R} ${u}% grown`}function k(R){g=R,h&&(h.textContent=O());}function I(){h=null,y=null,S=null;}return {root:E,setRuleMode:k,destroy:I}}function dW(e){const{enabled:t,selected:n,ruleMode:r,onEnabledChange:o,onSelectionChange:i,expanded:a=false,onExpandChange:s}=e;let l=t,c=[...n],d=r,u=null;const f=[],g=x("div",{style:"display: flex; flex-direction: column; gap: 12px;"}),h=x("div",{style:`
            font-size: 10px;
            font-weight: 600;
            color: var(--accent);
            background: color-mix(in oklab, var(--accent) 12%, transparent);
            border: 1px solid color-mix(in oklab, var(--accent) 30%, transparent);
            border-radius: 10px;
            padding: 1px 6px;
            display: none;
        `},"Enabled");S();const y=dt({title:"Color Mutation",subtitle:"Gold / Rainbow color variants",actions:[h],variant:"soft",padding:"md",expandable:true,defaultExpanded:a,onExpandChange:s},g);function S(){g.replaceChildren(),f.length=0,h.style.display=l?"":"none";const R=x("div",{style:"display: flex; align-items: center; gap: 12px;"}),A=af({checked:l,label:"Enable",size:"md",onChange:G=>{l=G,o(G),S();}});R.appendChild(A.root),l&&(u=x("div",{style:"font-size: 12px; color: color-mix(in oklab, var(--fg) 70%, transparent); line-height: 1.4;"},P()),R.appendChild(u)),g.appendChild(R);const L=x("div",{style:l?"":"opacity: 0.4; pointer-events: none; transition: opacity 0.2s ease;"}),F=x("div",{style:`
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
                gap: 8px;
            `});So.forEach(G=>{const q=c.includes(G),H=v1({mutationId:G,isSelected:q,onToggle:()=>C(G)});f.push(H),F.appendChild(H.root);}),L.appendChild(F),g.appendChild(L);}function C(R){if(c.includes(R)){const L=c.filter(F=>F!==R);if(L.length===0)return;c=L;}else {if(c.length>=3)return;c=[...c,R];}i(c),_(),E();}function _(){u&&(u.textContent=P());}function E(){So.forEach((R,A)=>{const L=f[A];L&&L.setSelected(c.includes(R));});}function P(){const R=c.map(A=>A==="none"?"normal":A.toLowerCase()).join(", ");return d==="lock"?`Lock ${R} plants`:`Allow ${R} plants`}function O(R){d=R,_();}function k(){return [...c]}function I(){u=null,f.length=0;}return {root:y,setRuleMode:O,getSelection:k,destroy:I}}function uW(e){const{enabled:t,selected:n,matchMode:r,ruleMode:o,onEnabledChange:i,onSelectionChange:a,onMatchModeChange:s,expanded:l=false,onExpandChange:c}=e;let d=t,u=[...n],f=r,g=o,h=null;const y=new Map,S=x("div",{style:"display: flex; flex-direction: column; gap: 12px;"}),C=x("div",{style:`
            font-size: 10px;
            font-weight: 600;
            color: var(--accent);
            background: color-mix(in oklab, var(--accent) 12%, transparent);
            border: 1px solid color-mix(in oklab, var(--accent) 30%, transparent);
            border-radius: 10px;
            padding: 1px 6px;
            display: none;
        `},"Enabled");E();const _=dt({title:"Weather Mutation",subtitle:"Weather-based mutation variants",actions:[C],variant:"soft",padding:"md",expandable:true,defaultExpanded:l,onExpandChange:c},S);function E(){S.replaceChildren(),y.clear(),C.style.display=d?"":"none";const G=x("div",{style:"display: flex; align-items: center; gap: 12px;"}),q=af({checked:d,label:"Enable",size:"md",onChange:ee=>{d=ee,i(ee),E();}});G.appendChild(q.root),d&&(h=x("div",{style:"font-size: 12px; color: color-mix(in oklab, var(--fg) 70%, transparent); line-height: 1.4;"}),u.length>0&&(h.textContent=I()),G.appendChild(h)),S.appendChild(G);const H=x("div",{style:(d?"":"opacity: 0.4; pointer-events: none;")+" display: flex; flex-direction: column; gap: 12px; transition: opacity 0.2s ease;"}),ce=x("div",{style:"display: flex; justify-content: center;"}),W=Ui({segments:[{id:"any",label:"Any"},{id:"all",label:"All"}],selected:f,onChange:ee=>{f=ee,ee==="all"&&(u=sW(u),a(u)),s(f),E();}});ce.appendChild(W),H.appendChild(ce);const ne=["none",...m1()],ie=x("div",{style:`
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(85px, 1fr));
                gap: 8px;
                max-height: 300px;
                overflow-y: auto;
            `});ne.forEach(ee=>{const U=u.includes(ee),X=v1({mutationId:ee,isSelected:U,onToggle:()=>P(ee),label:ee==="none"?"None":void 0});y.set(ee,X),ie.appendChild(X.root);}),H.appendChild(ie),S.appendChild(H);}function P(G){if(f==="all")if(G==="none")u.length===1&&u[0]==="none"?u=[]:u=["none"];else {if(u.includes("none"))return;u.includes(G)?u=u.filter(q=>q!==G):(fm(G)?u=u.filter(q=>!fm(q)):hm(G)&&(u=u.filter(q=>!hm(q))),u=[...u,G]);}else u.includes(G)?u=u.filter(q=>q!==G):u=[...u,G];a(u),O(),k();}function O(){h&&(h.textContent=u.length>0?I():"");}function k(){const G=f==="all"&&u.includes("none");y.forEach((q,H)=>{q.setSelected(u.includes(H)),q.setDisabled(G&&H!=="none");});}function I(){const G=iW(u),q=f==="all"?"AND":"OR";return g==="lock"?`Lock ${G} plants (${q})`:`Allow ${G} plants (${q})`}function R(G){g=G,O();}function A(){return [...u]}function L(){return f}function F(){h=null,y.clear();}return {root:_,setRuleMode:R,getSelection:A,getMatchMode:L,destroy:F}}const pW=60;function fW(e){let t={...e},n=null,r=null;const o=x("div",{style:"display: flex; flex-direction: column; gap: 8px;"}),i=x("div",{style:"display: flex; justify-content: center;"}),a=x("div",{className:"harvest-locker-preview-grid"});o.appendChild(i),o.appendChild(a);const s=x("div",{style:`
            font-size: 10px;
            font-weight: 600;
            color: var(--accent);
            background: color-mix(in oklab, var(--accent) 12%, transparent);
            border: 1px solid color-mix(in oklab, var(--accent) 30%, transparent);
            border-radius: 10px;
            padding: 1px 6px;
            display: none;
        `});t.sizeEnabled&&t.sizePercentage!==void 0&&(s.textContent=`size ${(t.sizeMode??"max")==="max"?"≥":"≤"} ${t.sizePercentage}%`,s.style.display="");const l=dt({title:"Preview",subtitle:d(),actions:[s],variant:"soft",padding:"md",expandable:true,defaultExpanded:true},o),c=l.querySelector(".card-subtitle");u();function d(){return t.ruleMode==="lock"?"Preview of plants that will be blocked from harvesting":"Preview of plants that will be harvestable"}function u(){n!==null&&(cancelAnimationFrame(n),n=null),c&&(c.textContent=d()),t.sizeEnabled&&t.sizePercentage!==void 0?(s.textContent=`size ${(t.sizeMode??"max")==="max"?"≥":"≤"} ${t.sizePercentage}%`,s.style.display=""):s.style.display="none";const C=t.colorEnabled?So.filter(_=>t.colorMutations.includes(_)):[];if(C.length>=2){r&&!C.includes(r)&&(r=C[0]),r||(r=C[0]),i.replaceChildren();const _=Ui({segments:C.map(E=>({id:E,label:E==="none"?"Normal":E})),selected:r,onChange:E=>{r=E,u();}});i.appendChild(_);}else r=null,i.replaceChildren();a.replaceChildren(),n=requestAnimationFrame(()=>{f().forEach(E=>{a.appendChild(E);});});}function f(){const C=[],_=t.species||"Starweaver";if(!(t.sizeEnabled||t.colorEnabled||t.weatherEnabled))return C.push(h(_,[])),C;const P=g();if(P.sort((k,I)=>{const R=Math.max(0,...k.map(G=>So.indexOf(G))),A=Math.max(0,...I.map(G=>So.indexOf(G)));if(R!==A)return R-A;const L=k.filter(G=>!So.includes(G)).sort((G,q)=>oa(G)-oa(q)),F=I.filter(G=>!So.includes(G)).sort((G,q)=>oa(G)-oa(q));if(L.length!==F.length)return L.length-F.length;for(let G=0;G<L.length;G++){const q=oa(L[G])-oa(F[G]);if(q!==0)return q}return 0}),P.length===0){const k=x("div",{style:"padding: 12px; text-align: center; color: #ef4444; font-size: 12px;"},"Invalid mutation combination");return C.push(k),C}return (r?P.filter(k=>{const I=k.filter(R=>So.includes(R)&&R!=="none");return r==="none"?I.length===0:I.includes(r)}):P).forEach(k=>{C.push(h(_,k));}),C}function g(){const C=[],_=t.weatherEnabled?t.weatherMutations.filter(G=>G!=="none"):[],E=t.colorEnabled?t.colorMutations.filter(G=>G!=="none"):[],P=t.weatherEnabled&&t.weatherMutations.includes("none"),O=t.colorEnabled&&t.colorMutations.includes("none");if(_.length===0&&E.length===0||!t.weatherEnabled&&!t.colorEnabled)return C.push([]),C;const k=_.filter(G=>up.wet.includes(G)),I=_.filter(G=>up.lunar.includes(G)),R=(G,q)=>{G.length===0&&q.length===0?C.push([]):G.length===0?q.forEach(H=>{C.push([...H]);}):q.length===0?G.forEach(H=>{C.push([...H]);}):G.forEach(H=>{q.forEach(ce=>{C.push([...H,...ce]);});});},A=[];if(P&&A.push([]),t.weatherMatchMode==="all"&&_.length>0){const G=k.length>1,q=I.length>1;if(G||q)return [];A.push(_);}else t.weatherMatchMode==="any"&&_.length>0&&(_.forEach(G=>{A.push([G]);}),k.forEach(G=>{I.forEach(q=>{A.push([G,q]);});}));const L=[];return O&&L.push([]),E.forEach(G=>{L.push([G]);}),R(A,L),Array.from(new Set(C.map(G=>G.sort().join(",")))).map(G=>G.split(",").filter(Boolean))}function h(C,_){const E=x("div",{style:"flex-shrink: 0;"});return uf(C,E,{size:pW,mutations:_}),E}function y(C){t={...t,...C},u();}function S(){n!==null&&(cancelAnimationFrame(n),n=null),a.replaceChildren();}return {root:l,update:y,destroy:S}}function ox(e){const{mode:t,species:n,ruleId:r,initialData:o,onSave:i,onDelete:a,onCancel:s}=e;let l=o?.name??"",c=o?.ruleMode??"lock",d=o?.sizeCondition?.enabled??false,u=o?.sizeCondition?.minPercentage??75,f=o?.sizeCondition?.sizeMode??"max";const g=o?.mutationCondition?.mutations??[],h=g.filter(D=>["none","Gold","Rainbow"].includes(D));let y=h.length>0,S=h.length>0?h:["none"];const C=g.filter(D=>!["none","Gold","Rainbow"].includes(D));let _=C.length>0,E=C.length>0?C:["none"],P=o?.mutationCondition?.matchMode??"any",O=null,k=null,I=null,R=null,A=null,L=null,F=null;const G=ce(),q=te();F=df({title:H(),content:G,footer:q,size:"lg",closeOnBackdrop:true,closeOnEscape:true,onClose:()=>{s?.();}});function H(){if(t!=="species"||!n)return r?"Edit Overall Rule":"Create Overall Rule";const D=x("div",{style:"display: flex; align-items: center; gap: 10px;"}),j=x("div",{style:"width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;"});uf(n,j,{size:24}),D.appendChild(j);const Q=x("span",{},`${n} — Override Rule`);return D.appendChild(Q),D}function ce(){const D=x("div",{style:"display: flex; flex-direction: column; gap: 16px;"});if(t==="species"){const j=x("div",{style:"font-size: 12px; color: color-mix(in oklab, var(--fg) 60%, transparent); padding: 8px 10px; background: color-mix(in oklab, var(--accent) 8%, transparent); border-radius: 6px; border-left: 3px solid var(--accent);"},"Global rules still apply. This override takes priority for this species only.");D.appendChild(j);}return D.appendChild(W()),O=cW({enabled:d,percentage:u,sizeMode:f,ruleMode:c,onEnabledChange:j=>{d=j,ie(),ee();},onPercentageChange:j=>{u=j,ee();},onSizeModeChange:j=>{f=j,ee();}}),D.appendChild(O.root),k=dW({enabled:y,selected:S,ruleMode:c,onEnabledChange:j=>{y=j,ie(),ee();},onSelectionChange:j=>{S=j,ee();}}),D.appendChild(k.root),I=uW({enabled:_,selected:E,matchMode:P,ruleMode:c,onEnabledChange:j=>{_=j,ie(),ee();},onSelectionChange:j=>{E=j,ee();},onMatchModeChange:j=>{P=j,ee();}}),D.appendChild(I.root),R=fW({species:t==="overall"?"Carrot":n,ruleMode:c,sizeEnabled:d,sizePercentage:u,sizeMode:f,colorEnabled:y,colorMutations:S,weatherEnabled:_,weatherMutations:E,weatherMatchMode:P}),D.appendChild(R.root),D}function W(){const D=x("div",{style:"display: flex; flex-direction: column; gap: 12px;"}),j=x("div",{style:"display: flex; gap: 12px; align-items: flex-start;"}),Q=x("div",{style:"flex: 1; display: flex; flex-direction: column; gap: 6px;"}),ae=x("label",{style:"font-size: 12px; font-weight: 500; color: var(--fg);"},"Rule Name");Q.appendChild(ae),A=ic({placeholder:"e.g., Lock Large Frozen",value:l,maxLength:30,blockGameKeys:true,onChange:Ve=>{l=Ve,ie();}}),Q.appendChild(A.root),j.appendChild(Q);const le=x("div",{style:"display: flex; flex-direction: column; gap: 6px;"}),we=x("label",{style:"font-size: 12px; font-weight: 500; color: var(--fg);"},"Mode");le.appendChild(we);const Ie=Ui({segments:[{id:"lock",label:"Lock"},{id:"allow",label:"Allow"}],selected:c,onChange:Ve=>{c=Ve,O?.setRuleMode(c),k?.setRuleMode(c),I?.setRuleMode(c),ee();}});return le.appendChild(Ie),j.appendChild(le),D.appendChild(j),D}function te(){const D=x("div",{style:"display: flex; gap: 8px; justify-content: space-between; width: 100%;"}),j=x("div",{style:"display: flex; gap: 8px;"});if(r&&a){const we=Ct({label:"Delete Rule",variant:"danger",onClick:()=>{a(),X();}});j.appendChild(we);}D.appendChild(j);const Q=x("div",{style:"display: flex; gap: 8px;"}),ae=Ct({label:"Cancel",variant:"default",onClick:()=>{s?.(),X();}});Q.appendChild(ae);const le=Ct({label:"Save",variant:"primary",disabled:!ne(),onClick:U});return L=le,Q.appendChild(le),D.appendChild(Q),D}function ne(){return !(!l.trim()||!d&&!y&&!_)}function ie(){L&&(L.disabled=!ne());}function ee(){R?.update({ruleMode:c,sizeEnabled:d,sizePercentage:u,sizeMode:f,colorEnabled:y,colorMutations:S,weatherEnabled:_,weatherMutations:E,weatherMatchMode:P});}function U(){if(!ne())return;const D={name:l.trim(),ruleMode:c};d&&(D.sizeCondition={enabled:true,minPercentage:u,sizeMode:f});const j=[];_&&j.push(...E),y&&j.push(...S),j.length>0&&(D.mutationCondition={enabled:true,mutations:j,matchMode:P}),i(D),X();}function X(){O?.destroy(),k?.destroy(),I?.destroy(),R?.destroy(),A?.destroy(),F?.destroy(),O=null,k=null,I=null,R=null,A=null,L=null,F=null;}return {root:F.root,destroy:X}}function hW(e){const{species:t,existingRules:n,onSelect:r}=e;let o=null;const i=l(),a=c();o=df({title:s(),subtitle:"Select a rule to assign to this species",content:i,footer:a,size:"md",closeOnBackdrop:true,closeOnEscape:true,onClose:()=>{}});function s(){const h=x("div",{style:"display: flex; align-items: center; gap: 10px;"}),y=x("div",{style:"width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;"});return uf(t,y,{size:24}),h.appendChild(y),h.appendChild(x("span",{},`${t} — Assign Rule`)),h}function l(){const h=x("div",{style:"display: flex; flex-direction: column; gap: 8px;"});if(n.length===0){const y=x("div",{style:"padding: 20px; text-align: center; color: var(--muted); font-size: 14px;"},"No overall rules available");h.appendChild(y);}else n.forEach(y=>{h.appendChild(d(y));});return h}function c(){const h=x("div",{style:"display: flex; gap: 8px; justify-content: flex-end;"}),y=Ct({label:"Cancel",variant:"default",onClick:()=>{g();}});return h.appendChild(y),h}function d(h){const y=x("div",{className:"harvest-locker-rule-item",style:"flex-direction: column; align-items: flex-start; gap: 8px;"});y.addEventListener("click",()=>{yn.cloneRuleToSpecies(h.id,t),r(h.id),g();});const S=x("div",{style:"display: flex; align-items: center; justify-content: space-between; width: 100%;"});S.appendChild(x("div",{className:"harvest-locker-rule-item__name"},h.name)),S.appendChild(x("div",{className:"harvest-locker-rule-item__badge"},h.mode)),y.appendChild(S);const C=u(h);return C.childNodes.length>0&&y.appendChild(C),y}function u(h){const y=x("div",{style:"display: flex; flex-wrap: wrap; gap: 4px;"});return h.sizeCondition?.enabled&&y.appendChild(f(`Size ≥ ${h.sizeCondition.minPercentage}%`)),h.mutationCondition?.enabled&&h.mutationCondition.mutations.forEach(S=>{y.appendChild(f(S==="none"?"Normal":S));}),y}function f(h){return x("div",{style:`
                padding: 2px 8px;
                border-radius: 10px;
                font-size: 11px;
                font-weight: 500;
                color: color-mix(in oklab, var(--fg) 75%, transparent);
                background: color-mix(in oklab, var(--fg) 8%, transparent);
                border: 1px solid color-mix(in oklab, var(--border) 60%, transparent);
            `},h)}function g(){o?.destroy(),o=null;}return {root:o.root,destroy:g}}const gW={ui:{harvestLockerMode:"overall",selectedSpecies:null,searchQuery:"",harvestLockerExpanded:true,eggLockerExpanded:true,decorLockerExpanded:true}};let va=null,Rh=null;async function mW(){return va||(Rh||(Rh=co("tab-locker",{version:1,defaults:gW,sanitize:e=>({ui:{harvestLockerMode:e.ui?.harvestLockerMode==="bySpecies"?"bySpecies":"overall",selectedSpecies:typeof e.ui?.selectedSpecies=="string"?e.ui.selectedSpecies:null,searchQuery:typeof e.ui?.searchQuery=="string"?e.ui.searchQuery:"",harvestLockerExpanded:typeof e.ui?.harvestLockerExpanded=="boolean"?e.ui.harvestLockerExpanded:true,eggLockerExpanded:typeof e.ui?.eggLockerExpanded=="boolean"?e.ui.eggLockerExpanded:true,decorLockerExpanded:typeof e.ui?.decorLockerExpanded=="boolean"?e.ui.decorLockerExpanded:true}})})),va=await Rh,va)}function ro(){if(!va)throw new Error("[LockerState] State not initialized. Call initLockerState() first.");return va}function bW(e){const t=ro();t.update({ui:{...t.get().ui,harvestLockerMode:e}});}function vW(e){const t=ro();t.update({ui:{...t.get().ui,selectedSpecies:e}});}function yW(e){const t=ro();t.update({ui:{...t.get().ui,searchQuery:e}});}function wW(e){const t=ro();t.update({ui:{...t.get().ui,harvestLockerExpanded:e}});}function xW(e){const t=ro();t.update({ui:{...t.get().ui,eggLockerExpanded:e}});}function CW(e){const t=ro();t.update({ui:{...t.get().ui,decorLockerExpanded:e}});}function SW(e={}){let t=e.defaultMode??"overall",n=e.defaultSelectedSpecies??null,r=[],o=null,i=null,a=null,s=null,l=null,c=null;const d=[];o=u();function u(){const L=x("div",{className:"harvest-locker-card-wrapper"});i=x("div",{className:"harvest-locker-card__mode-container"}),L.appendChild(i),a=x("div",{className:"harvest-locker-card__content"}),L.appendChild(a);const F=dt({title:"Crop Harvest",subtitle:"Prevent harvesting specific crops",expandable:true,defaultExpanded:e.defaultExpanded??true,onExpandChange:e.onExpandChange},L);return f(),h(),g(),F}function f(){t==="overall"?r=yn.getOverallRules():r=n?yn.getSpeciesRules(n):[];}function g(){a&&(a.replaceChildren(),t==="bySpecies"&&(y(),n&&S()),C(),E());}function h(){if(i){if(!s){s=Ui({segments:[{id:"overall",label:"Overall"},{id:"bySpecies",label:"By Species"}],selected:t,onChange:L=>{t=L,bW(t),f(),g();}}),i.appendChild(s);return}s.getSelected()!==t&&s.select(t);}}function y(){if(!a)return;const L=ue.get("plants");if(!L||Object.keys(L).length===0){const H=x("div",{className:"harvest-locker-card__message harvest-locker-card__message--compact"},"No species available");a.appendChild(H);return}const F=yn.getConfig(),G={};Object.entries(F.speciesRules).forEach(([H,ce])=>{G[H]=ce.length;}),l=nW({selectedSpecies:n??void 0,placeholder:"Search plants...",speciesRuleCount:G,onChange:H=>{n=H,vW(H),f(),g();},onSearchChange:H=>{yW(H);}});const q=x("div",{className:"harvest-locker-card__control"});q.appendChild(l.root),a.appendChild(q);}function S(){if(!a||!n)return;const L=x("div",{className:"harvest-locker-card__species-section-header"}),F=x("div",{className:"harvest-locker-card__species-section-sprite"});uf(n,F,{size:36}),L.appendChild(F);const G=x("div",{className:"harvest-locker-card__species-section-text"}),q=x("div",{className:"harvest-locker-card__species-section-name"},n);G.appendChild(q);const H=x("div",{className:"harvest-locker-card__species-section-label"},"SELECTED");G.appendChild(H),L.appendChild(G),a.appendChild(L);}function C(){if(!a)return;if(t==="bySpecies"&&!n){const H=x("div",{className:"harvest-locker-card__message"},"Select a species to view and manage rules");a.appendChild(H);return}const L=x("div",{className:"harvest-locker-card__rules-section"}),F=x("div",{className:"harvest-locker-card__rules-section-label"},"Rules");if(L.appendChild(F),r.length===0){const H=x("div",{className:"harvest-locker-card__empty"},"No rules yet");L.appendChild(H),a.appendChild(L);return}const G=x("div",{className:"harvest-locker-card__list"});r.forEach(H=>{const ce=_(H);G.appendChild(ce);}),L.appendChild(G);const q=x("div",{className:"harvest-locker-card__rules-hint"});q.appendChild(x("span",{className:"harvest-locker-card__rules-hint--desktop"},"Click to edit · Right-click to delete")),q.appendChild(x("span",{className:"harvest-locker-card__rules-hint--mobile"},"Tap to edit · Long-press to delete")),L.appendChild(q),a.appendChild(L);}function _(L){const F=x("div",{className:"harvest-locker-rule-item"}),G=x("div",{className:"harvest-locker-rule-item__name"},L.name);F.appendChild(G);const q=x("div",{className:"harvest-locker-rule-item__badge"},L.mode);F.appendChild(q),F.addEventListener("contextmenu",W=>{W.preventDefault(),k(L.id);});let H=null,ce=false;return F.addEventListener("touchstart",()=>{ce=false,H=window.setTimeout(()=>{ce=true,k(L.id),navigator.vibrate&&navigator.vibrate(50);},500);}),F.addEventListener("touchend",()=>{H&&(clearTimeout(H),H=null),ce||O(L);}),F.addEventListener("touchmove",()=>{H&&(clearTimeout(H),H=null);}),F.addEventListener("click",()=>{O(L);}),F}function E(){if(!a||t==="bySpecies"&&!n)return;const L=x("div",{className:"harvest-locker-card__actions"});if(t==="bySpecies"&&n){const F=yn.getOverallRules();if(F.length>0){const G=yn.getSpeciesRules(n),q=new Set(G.map(W=>Ld(W))),H=F.filter(W=>!q.has(Ld(W))),ce=Ct({label:"Add Existing Rule",variant:"default",disabled:H.length===0,onClick:()=>I()});L.appendChild(ce);}}c=Ct({label:t==="bySpecies"?"Create Override Rule":"Create Rule",variant:"primary",onClick:()=>P()}),L.appendChild(c),a.appendChild(L);}function P(){ox({mode:t==="overall"?"overall":"species",species:n,onSave:L=>{t==="overall"?yn.addNewOverallRule(L.name,L.ruleMode,L.sizeCondition,L.mutationCondition):n&&yn.addNewSpeciesRule(n,L.name,L.ruleMode,L.sizeCondition,L.mutationCondition),f(),g();}});}function O(L){ox({mode:t==="overall"?"overall":"species",species:n,ruleId:L.id,initialData:{name:L.name,ruleMode:L.mode,sizeCondition:L.sizeCondition,mutationCondition:L.mutationCondition},onSave:F=>{yn.modifyRule(L.id,{name:F.name,mode:F.ruleMode,sizeCondition:F.sizeCondition,mutationCondition:F.mutationCondition}),f(),g();},onDelete:()=>{k(L.id);}});}function k(L){yn.removeRule(L),f(),g();}function I(){if(t!=="bySpecies"||!n)return;const L=yn.getOverallRules();if(L.length===0)return;const F=yn.getSpeciesRules(n),G=new Set(F.map(H=>Ld(H))),q=L.filter(H=>!G.has(Ld(H)));q.length!==0&&hW({species:n,existingRules:q,onSelect:()=>{f(),g();}});}function R(){f(),h(),g();}function A(){d.forEach(L=>L()),d.length=0,s?.destroy?.(),s=null,l?.destroy?.(),l=null,c=null,i=null,a=null,o=null;}return {root:o,render:R,destroy:A}}class _W{constructor(t={}){de(this,"handle",null);de(this,"options");this.options=t;}build(){return this.handle||(this.handle=SW(this.options)),this.handle.root}render(){this.handle?.render();}destroy(){this.handle?.destroy(),this.handle=null;}}const kW=`
.harvest-locker-card-wrapper {
    display: flex;
    flex-direction: column;
    gap: 12px;
    max-width: 100%;
    overflow: clip;
}

.harvest-locker-card__mode-container {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
}

.harvest-locker-card__content {
    display: flex;
    flex-direction: column;
    gap: 12px;
    width: 100%;
}

.harvest-locker-card__message,
.harvest-locker-card__empty {
    padding: 24px;
    text-align: center;
    font-size: 14px;
}

.harvest-locker-card__message {
    color: var(--muted);
}

.harvest-locker-card__empty {
    color: var(--fg);
}

.harvest-locker-card__message--compact {
    padding: 12px;
}

.harvest-locker-card__control {
    margin-bottom: 16px;
}

/* ═══════════════════════════════════════════════════════════════════════════
   SPECIES SECTION HEADER (Title with divider)
   ═══════════════════════════════════════════════════════════════════════════ */

.harvest-locker-card__species-section-header {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 0;
    margin-bottom: 16px;
    border-top: 1px solid var(--border);
}

.harvest-locker-card__species-section-sprite {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    background: var(--soft);
    border-radius: 4px;
}

.harvest-locker-card__species-section-text {
    flex: 1;
    display: flex;
    align-items: baseline;
    gap: 8px;
}

.harvest-locker-card__species-section-name {
    font-size: 14px;
    font-weight: 600;
    color: var(--fg);
}

.harvest-locker-card__species-section-label {
    font-size: 10px;
    font-weight: 700;
    color: var(--accent);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* ═══════════════════════════════════════════════════════════════════════════
   RULES SECTION FRAME (cadran)
   ═══════════════════════════════════════════════════════════════════════════ */

.harvest-locker-card__rules-section {
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
    background: color-mix(in oklab, var(--bg) 60%, transparent);
}

.harvest-locker-card__rules-section-label {
    padding: 8px 12px;
    font-size: 11px;
    font-weight: 600;
    color: var(--accent);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-bottom: 1px solid var(--border);
    background: color-mix(in oklab, var(--fg) 4%, transparent);
}

.harvest-locker-card__rules-section .harvest-locker-card__empty {
    padding: 16px;
}

.harvest-locker-card__list {
    display: flex;
    flex-direction: column;
    gap: 8px;
    padding: 8px;
    max-height: 272px; /* ~4 items visible, scrollable après */
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
}

.harvest-locker-card__list::-webkit-scrollbar {
    width: 6px;
}

.harvest-locker-card__list::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 3px;
}

.harvest-locker-card__list::-webkit-scrollbar-track {
    background: transparent;
}

.harvest-locker-card__rules-hint {
    padding: 6px 8px 4px;
    text-align: center;
}

.harvest-locker-card__rules-hint--desktop,
.harvest-locker-card__rules-hint--mobile {
    font-size: 11px;
    color: color-mix(in oklab, var(--fg) 40%, transparent);
    font-style: italic;
}

.harvest-locker-card__rules-hint--mobile {
    display: none;
}

@media (hover: none) and (pointer: coarse) {
    .harvest-locker-card__rules-hint--desktop {
        display: none;
    }
    .harvest-locker-card__rules-hint--mobile {
        display: inline;
    }
}

.harvest-locker-card__actions {
    display: flex;
    gap: 8px;
    justify-content: center;
    width: 100%;
}

/* ═══════════════════════════════════════════════════════════════════════════
   RULE ITEM
   ═══════════════════════════════════════════════════════════════════════════ */

.harvest-locker-rule-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.harvest-locker-rule-item:hover {
    background: var(--soft);
    border-color: var(--accent);
}

.harvest-locker-rule-item__name {
    flex: 1;
    font-size: 14px;
    font-weight: 500;
    color: var(--fg);
}

.harvest-locker-rule-item__badge {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    background: color-mix(in oklab, var(--accent) 20%, transparent);
    color: var(--accent);
    border: 1px solid color-mix(in oklab, var(--accent) 30%, transparent);
}

/* ═══════════════════════════════════════════════════════════════════════════
   RULE EDITOR MODAL
   ═══════════════════════════════════════════════════════════════════════════ */

.harvest-locker-modal {
    scrollbar-gutter: stable;
}

.harvest-locker-modal::-webkit-scrollbar {
    width: 10px;
}

.harvest-locker-modal::-webkit-scrollbar-thumb {
    background: var(--muted);
    border-radius: 8px;
}

.harvest-locker-modal::-webkit-scrollbar-track {
    background: transparent;
}

/* ═══════════════════════════════════════════════════════════════════════════
   PREVIEW GRID
   ═══════════════════════════════════════════════════════════════════════════ */

.harvest-locker-preview-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    width: 100%;
    justify-content: flex-start;
    align-items: flex-start;
}

@media (max-width: 768px) {
    .harvest-locker-rule-item {
        padding: 10px;
    }

    .harvest-locker-rule-item__name {
        font-size: 13px;
    }
}

@media (max-width: 480px) {
    .harvest-locker-rule-item {
        gap: 8px;
        padding: 8px;
    }

    .harvest-locker-card__list {
        max-height: 300px;
    }
}
`;function EW(e){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.setAttribute("stroke","currentColor"),t.setAttribute("stroke-width","2"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-linejoin","round"),t.innerHTML=e?'<rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/>':'<rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 9.9-1"/>',t}function AW(e,t,n){if(!me.isReady()){t.appendChild(Od(n));return}try{const o=ue.get("eggs")?.[e]?.spriteId;if(!o){t.appendChild(Od(n));return}const i=me.toCanvas(o,{boundsMode:"padded"});i?(i.style.maxWidth=`${n}px`,i.style.maxHeight=`${n}px`,i.style.width="auto",i.style.height="auto",i.style.display="block",t.appendChild(i)):t.appendChild(Od(n));}catch{t.appendChild(Od(n));}}function Od(e){return x("div",{style:`width:${e}px;height:${e}px;background:color-mix(in oklab, var(--accent) 20%, transparent);border-radius:6px;`})}function TW(e={}){let t=null,n=null;n=r();function r(){return t=x("div",{className:"egg-locker-card__wrapper"}),o(),dt({title:"Egg Hatching",subtitle:"Prevent hatching specific eggs",expandable:true,defaultExpanded:e.defaultExpanded??true,onExpandChange:e.onExpandChange},t)}function o(){if(!t)return;t.replaceChildren();const l=Ro.getAvailableEggs();if(l.length===0){t.appendChild(x("div",{className:"egg-locker-card__empty"},"No eggs available"));return}const c=new Set(Ro.getBlockedEggs()),d=ue.get("eggs"),u=x("div",{className:"egg-locker-card__grid"});for(const f of l){const g=d?.[f]?.name??f;u.appendChild(i(f,c.has(f),g));}t.appendChild(u);}function i(l,c,d){const u=x("div",{className:"egg-locker-item"+(c?" egg-locker-item--locked":"")}),f=x("div",{className:"egg-locker-item__sprite"});AW(l,f,48),u.appendChild(f),u.appendChild(x("div",{className:"egg-locker-item__name"},d));const g=x("div",{className:"egg-locker-item__lock"+(c?" egg-locker-item__lock--locked":"")});return g.appendChild(EW(c)),u.appendChild(g),u.addEventListener("click",()=>{c?Ro.unblockEgg(l):Ro.blockEgg(l),o();}),u}function a(){o();}function s(){t=null,n=null;}return {root:n,render:a,destroy:s}}class IW{constructor(t={}){de(this,"handle",null);de(this,"options");this.options=t;}build(){return this.handle||(this.handle=TW(this.options)),this.handle.root}render(){this.handle?.render();}destroy(){this.handle?.destroy(),this.handle=null;}}const PW=`
/* ═══════════════════════════════════════════════════════════════════════════
   GRID
   ═══════════════════════════════════════════════════════════════════════════ */

.egg-locker-card__wrapper {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.egg-locker-card__empty {
    padding: 24px;
    text-align: center;
    color: color-mix(in oklab, var(--fg) 50%, #9ca3af);
    font-size: 14px;
}

.egg-locker-card__grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(96px, 1fr));
    gap: 10px;
}

/* ═══════════════════════════════════════════════════════════════════════════
   EGG ITEM
   ═══════════════════════════════════════════════════════════════════════════ */

.egg-locker-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    padding: 14px 8px 12px;
    background: var(--bg);
    border: 1.5px solid var(--border);
    border-radius: 12px;
    cursor: pointer;
    -webkit-tap-highlight-color: transparent;
    transition: border-color 0.2s ease, background 0.2s ease, box-shadow 0.2s ease;
}

.egg-locker-item:hover {
    border-color: color-mix(in oklab, var(--fg) 30%, var(--border));
    background: color-mix(in oklab, var(--fg) 4%, var(--bg));
}

.egg-locker-item--locked {
    border-color: var(--accent);
    background: color-mix(in oklab, var(--accent) 8%, var(--bg));
    box-shadow: 0 0 6px color-mix(in oklab, var(--accent) 20%, transparent);
}

.egg-locker-item--locked:hover {
    box-shadow: 0 0 10px color-mix(in oklab, var(--accent) 30%, transparent);
}

/* ═══════════════════════════════════════════════════════════════════════════
   SPRITE + LABEL
   ═══════════════════════════════════════════════════════════════════════════ */

.egg-locker-item__sprite {
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.egg-locker-item__name {
    font-size: 12px;
    font-weight: 500;
    color: var(--fg);
    text-align: center;
    line-height: 1.3;
    max-width: 88px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

/* ═══════════════════════════════════════════════════════════════════════════
   LOCK ICON
   ═══════════════════════════════════════════════════════════════════════════ */

.egg-locker-item__lock {
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.egg-locker-item__lock svg {
    width: 18px;
    height: 18px;
    color: color-mix(in oklab, var(--fg) 50%, transparent);
    transition: color 0.2s ease;
}

.egg-locker-item__lock--locked svg {
    color: var(--accent);
}

/* ═══════════════════════════════════════════════════════════════════════════
   RESPONSIVE
   ═══════════════════════════════════════════════════════════════════════════ */

@media (max-width: 480px) {
    .egg-locker-card__grid {
        grid-template-columns: repeat(auto-fill, minmax(78px, 1fr));
        gap: 8px;
    }

    .egg-locker-item {
        padding: 10px 6px;
    }

    .egg-locker-item__sprite {
        width: 40px;
        height: 40px;
    }

    .egg-locker-item__name {
        font-size: 11px;
        max-width: 72px;
    }
}
`;function RW(e={}){let t=null,n=null,r=null,o=null;const i=[];n=a();function a(){t=x("div",{className:"decor-locker-card__wrapper",style:"display: flex; flex-direction: column; gap: 16px;"}),s();const d=dt({title:"Decor Pickup",subtitle:"Prevent decor pickups",expandable:true,defaultExpanded:e.defaultExpanded??true,onExpandChange:e.onExpandChange},t),u=()=>l();return window.addEventListener(Me.DECOR_LOCKER_LOCKS_UPDATED,u),i.push(()=>window.removeEventListener(Me.DECOR_LOCKER_LOCKS_UPDATED,u)),d}function s(){if(!t)return;const d=Mo.getAvailableDecors().length,f=Mo.getBlockedDecors().length===d&&d>0;if(r)r.setChecked(f,true),o&&(o.textContent=f?"Decors Unpickable":"Decors Pickable");else {t.replaceChildren();const g=x("div",{style:`
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                    padding: 12px;
                    background: color-mix(in oklab, var(--accent) 10%, transparent);
                    border-radius: 8px;
                `});o=x("div",{style:"font-size: 14px; font-weight: 500;"},f?"Decors Unpickable":"Decors Pickable"),r=ao({checked:f,size:"md",onChange:h=>{h?Mo.blockAllDecors():Mo.unblockAllDecors();}}),i.push(()=>r?.destroy()),g.appendChild(o),g.appendChild(r.root),t.appendChild(g);}}function l(){s();}function c(){i.forEach(d=>d()),i.length=0,t=null,n=null;}return {root:n,render:l,destroy:c}}class MW{constructor(t={}){de(this,"handle",null);de(this,"options");this.options=t;}build(){return this.handle||(this.handle=RW(this.options)),this.handle.root}render(){this.handle?.render();}destroy(){this.handle?.destroy(),this.handle=null;}}const LW=`
.plant-selector {
    display: flex;
    flex-direction: column;
    gap: 8px;
    width: 100%;
}

.plant-selector__grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
    gap: 8px;
    max-height: 240px;
    overflow-y: auto;
    padding: 4px;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
}

.plant-selector__grid::-webkit-scrollbar {
    width: 6px;
}

.plant-selector__grid::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 3px;
}

.plant-selector__grid::-webkit-scrollbar-track {
    background: transparent;
}

.plant-selector__empty {
    grid-column: 1 / -1;
    padding: 24px;
    text-align: center;
    color: var(--fg);
    font-size: 14px;
}

.plant-selector__item {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    padding: 8px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.plant-selector__item:hover {
    background: var(--soft);
    border-color: var(--accent);
}

.plant-selector__item--selected {
    background: color-mix(in oklab, var(--accent) 15%, transparent);
    border-color: var(--accent);
}

.plant-selector__badge {
    position: absolute;
    top: -4px;
    right: -4px;
    min-width: 14px;
    height: 14px;
    border-radius: 7px;
    background-color: var(--accent);
    color: white;
    font-size: 9px;
    font-weight: 700;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 2px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    z-index: 1;
}

.plant-selector__sprite {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.plant-selector__name {
    font-size: 10px;
    color: var(--fg);
    text-align: center;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
    font-weight: 500;
}

/* Responsive */
@media (max-width: 768px) {
    .plant-selector__item {
        padding: 6px;
    }

    .plant-selector__name {
        font-size: 9px;
    }
}

@media (max-width: 480px) {
    .plant-selector__grid {
        grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
        gap: 6px;
        max-height: 250px;
    }

    .plant-selector__item {
        gap: 2px;
        padding: 4px;
    }

    .plant-selector__sprite {
        width: 36px;
        height: 36px;
    }

    .plant-selector__name {
        font-size: 8px;
    }
}
`;class OW extends pr{constructor(){super({id:"tab-locker",label:"Locker"});de(this,"harvestLockerCardPart",null);de(this,"eggLockerCardPart",null);de(this,"decorLockerCardPart",null);}async preload(){await mW();}build(n){const r=n.getRootNode();wt(r,kW,"harvest-locker-card-styles"),wt(r,LW,"plant-selector-styles"),wt(r,PW,"egg-locker-card-styles");const o=this.createGrid("12px");o.id="locker",n.appendChild(o),this.initializeHarvestLockerCardPart(o),this.initializeEggLockerCardPart(o),this.initializeDecorLockerCardPart(o);}render(n){const r=this.harvestLockerCardPart,o=this.eggLockerCardPart,i=this.decorLockerCardPart;this.harvestLockerCardPart=null,this.eggLockerCardPart=null,this.decorLockerCardPart=null,super.render(n),this.harvestLockerCardPart=r,this.eggLockerCardPart=o,this.decorLockerCardPart=i;}destroy(){this.harvestLockerCardPart&&(this.harvestLockerCardPart.destroy(),this.harvestLockerCardPart=null),this.eggLockerCardPart&&(this.eggLockerCardPart.destroy(),this.eggLockerCardPart=null),this.decorLockerCardPart&&(this.decorLockerCardPart.destroy(),this.decorLockerCardPart=null);}initializeHarvestLockerCardPart(n){if(!this.harvestLockerCardPart){const o=ro();this.harvestLockerCardPart=new _W({defaultExpanded:o.get().ui.harvestLockerExpanded,defaultMode:o.get().ui.harvestLockerMode,defaultSelectedSpecies:o.get().ui.selectedSpecies,defaultSearchQuery:o.get().ui.searchQuery,onExpandChange:wW});}const r=this.harvestLockerCardPart.build();n.appendChild(r),this.harvestLockerCardPart.render();}initializeEggLockerCardPart(n){if(!this.eggLockerCardPart){const o=ro();this.eggLockerCardPart=new IW({defaultExpanded:o.get().ui.eggLockerExpanded,onExpandChange:xW});}const r=this.eggLockerCardPart.build();n.appendChild(r),this.eggLockerCardPart.render();}initializeDecorLockerCardPart(n){if(!this.decorLockerCardPart){const o=ro();this.decorLockerCardPart=new MW({defaultExpanded:o.get().ui.decorLockerExpanded,onExpandChange:CW});}const r=this.decorLockerCardPart.build();n.appendChild(r),this.decorLockerCardPart.render();}}let Mh=null,Lh=null,Oh=null,Nh=null,$h=null;function NW(){return Mh||(Mh=new W$),Mh}function y1(){return Lh||(Lh=new _H),Lh}function w1(){return Oh||(Oh=new c3),Oh}function x1(){return $h||($h=new OW),$h}function C1(){return Nh||(Nh=new O3),Nh}function $W(e){return [new L$(e),new iU,y1(),w1(),C1(),new vU(e),new QU(e),new GH,new ZH(e),x1()]}async function DW(){const e=y1(),t=w1(),n=C1(),r=x1(),o=NW();await Promise.all([e.preload(),t.preload(),n.preload(),r.preload(),o.preload()]);}function FW(e){const{shadow:t,initialOpen:n}=e,r=x("div",{className:"gemini-panel",id:"panel",ariaHidden:String(!n)}),o=x("div",{className:"gemini-tabbar"}),i=x("div",{className:"gemini-content",id:"content"}),a=x("div",{className:"gemini-resizer",title:"Resize"}),s=x("button",{className:"gemini-close",title:"Fermer",ariaLabel:"Fermer"},"✕");r.append(o,i,a);const l=x("div",{className:"gemini-wrapper"},r);return t.append(l),{panel:r,tabbar:o,content:i,resizer:a,closeButton:s,wrapper:l}}function BW(e){const{resizer:t,host:n,shadow:r,onWidthChange:o,initialWidth:i,minWidth:a,maxWidth:s}=e;let l=a,c=s;function d(){const P=Vt.detect(),O=Math.round(ge.visualViewport?.width??ge.innerWidth??0);if(P.platform==="mobile"||P.os==="ios"||P.os==="android"){const k=getComputedStyle(r.host),I=parseFloat(k.getPropertyValue("--inset-l"))||0,R=parseFloat(k.getPropertyValue("--inset-r"))||0,A=Math.max(280,O-Math.round(I+R));l=280,c=A;}else l=a,c=s;return {min:l,max:c}}function u(P){return Math.max(l,Math.min(c,Number(P)||i))}function f(P){const O=u(P);n.style.setProperty("--w",`${O}px`),o(O);}d();const g=Vt.detect(),h=!(g.platform==="mobile"||g.os==="ios"||g.os==="android");let y=false;const S=P=>{if(!y)return;P.preventDefault();const O=Math.round(ge.innerWidth-P.clientX);f(O);},C=()=>{y&&(y=false,document.body.style.cursor="",ge.removeEventListener("mousemove",S),ge.removeEventListener("mouseup",C));},_=P=>{h&&(P.preventDefault(),y=true,document.body.style.cursor="ew-resize",ge.addEventListener("mousemove",S),ge.addEventListener("mouseup",C));};t.addEventListener("mousedown",_);function E(){t.removeEventListener("mousedown",_),ge.removeEventListener("mousemove",S),ge.removeEventListener("mouseup",C);}return {calculateResponsiveBounds:d,constrainWidthToLimits:u,setHudWidth:f,destroy:E}}function jW(e){const{panel:t,onToggle:n,onClose:r,toggleCombo:o=l=>l.ctrlKey&&l.shiftKey&&l.key.toLowerCase()==="u",closeOnEscape:i=true}=e;function a(l){const c=t.classList.contains("open");if(i&&l.key==="Escape"&&c){r();return}o(l)&&(l.preventDefault(),l.stopPropagation(),n());}document.addEventListener("keydown",a,{capture:true});function s(){document.removeEventListener("keydown",a,{capture:true});}return {destroy:s}}const GW=`
@layer hud {
  /* Root container */
  .gemini-wrapper {
    position: relative;
    pointer-events: auto;
  }

  /* ---- HUD panel ---- */
  .gemini-panel {
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    width: var(--w);
    max-width: 100vw;
    height: 100dvh;
    display: flex;
    flex-direction: column;
    background-color: var(--bg);
    color: var(--fg);
    border-left: 1px solid var(--border);
    box-shadow: -20px 0 60px var(--shadow);
    transform: translateX(100%);
    transition: transform .28s cubic-bezier(.2,.8,.2,1),
                background-color .28s ease, color .28s ease,
                border-color .28s ease, box-shadow .28s ease;
    overflow: hidden;
    pointer-events: auto;
    backdrop-filter: blur(var(--glass-blur));
    -webkit-backdrop-filter: blur(var(--glass-blur));
  }
  .gemini-panel.open {
    transform: translateX(0);
  }

  /* ---- Resizer (desktop only) ---- */
  .gemini-resizer {
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 8px;
    cursor: ew-resize;
    background: transparent;
  }
  .gemini-resizer:hover {
    background: color-mix(in oklab, var(--accent) 15%, transparent);
  }

  /* ---- TABBAR (grid: tabs that stretch + close button) ---- */
  .gemini-tabbar {
    position: relative;
    height: var(--tab-h);
    display: grid;
    grid-template-columns: minmax(0,1fr) auto;
    align-items: center;
    gap: 14px;
    padding: 12px max(12px, var(--inset-l)) 12px max(12px, var(--inset-r));
    background-color: color-mix(in oklab, var(--bg) 92%, transparent);
    transition: background-color .28s ease, border-color .28s ease;
  }

  /* ---- CLOSE BUTTON (in tabbar, auto column) ---- */
  .gemini-close {
    position: static;
    inline-size: 34px;
    block-size: 34px;
    border-radius: 999px;
    border: 1px solid color-mix(in oklab, var(--border) 70%, transparent);
    background: linear-gradient(
      180deg,
      color-mix(in oklab, var(--soft) 85%, transparent) 0%,
      color-mix(in oklab, var(--soft) 60%, transparent) 100%
    );
    color: var(--fg);
    font: 16px/1 ui-monospace, SFMono-Regular, Menlo, Consolas;
    display: grid;
    place-items: center;
    cursor: pointer;
    box-shadow: 0 6px 18px color-mix(in oklab, var(--shadow) 35%, transparent);
    transition: transform .05s, border-color .2s, background .2s, color .2s, opacity .2s;
  }
  .gemini-close:hover {
    border-color: color-mix(in oklab, var(--accent) 40%, var(--border));
  }
  .gemini-close:active {
    transform: scale(.98);
  }

  /* Responsive tweaks for tabbar and close button */
  @media (max-width: 720px) {
    .gemini-tabbar {
      gap: 12px;
      padding: 10px max(10px, var(--inset-l)) 10px max(10px, var(--inset-r));
    }
    .gemini-close {
      inline-size: 30px;
      block-size: 30px;
      font-size: 15px;
    }
  }
  @media (max-width: 480px) {
    .gemini-tabbar {
      gap: 10px;
      padding: 10px max(8px, var(--inset-l)) 10px max(8px, var(--inset-r));
    }
    .gemini-close {
      inline-size: 28px;
      block-size: 28px;
      font-size: 14px;
    }
  }

  /* ---- Content area ---- */
  .gemini-content {
    padding: calc(var(--pad) + var(--inset-t)) var(--pad) calc(var(--pad) + var(--inset-b));
    overflow: auto;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    height: calc(100dvh - var(--tab-h));
    scrollbar-gutter: stable;
  }
  .gemini-content::-webkit-scrollbar {
    width: 10px;
  }
  .gemini-content::-webkit-scrollbar-thumb {
    background: var(--muted);
    border-radius: 8px;
  }
}
`,zW=`
@layer tokens {
  /* --- Animatable properties --- */
  @property --bg{        syntax:'<color>';inherits:true;initial-value:rgba(10,12,18,.6)}
  @property --fg{        syntax:'<color>';inherits:true;initial-value:#e5e7eb}
  @property --muted{     syntax:'<color>';inherits:true;initial-value:rgba(229,231,235,.08)}
  @property --soft{      syntax:'<color>';inherits:true;initial-value:rgba(229,231,235,.05)}
  @property --accent{    syntax:'<color>';inherits:true;initial-value:#60a5fa}
  @property --border{    syntax:'<color>';inherits:true;initial-value:rgba(148,163,184,.2)}
  @property --tab-bg{    syntax:'<color>';inherits:true;initial-value:#fff}
  @property --tab-fg{    syntax:'<color>';inherits:true;initial-value:#0f172a}
  @property --pill-from{ syntax:'<color>';inherits:true;initial-value:#6366f1}
  @property --pill-to{   syntax:'<color>';inherits:true;initial-value:#06b6d4}
  @property --divider{   syntax:'<color>';inherits:true;initial-value:color-mix(in oklab, var(--accent) 55%, var(--border))}

  :host{
    all: initial;

    /* Default theme */
    --bg:rgba(10,12,18,.6);
    --fg:#e5e7eb;
    --muted:rgba(229,231,235,.08);
    --soft:rgba(229,231,235,.05);
    --accent:#60a5fa;
    --border:rgba(148,163,184,.2);
    --shadow:rgba(0,0,0,.45);
    --tab-bg:#fff;
    --tab-fg:#0f172a;
    --pill-from:#6366f1;
    --pill-to:#06b6d4;
    --divider: color-mix(in oklab, var(--accent) 55%, var(--border));

    /* Layout tokens */
    --w:480px;
    --radius:18px;
    --pad:14px;
    --tab-h:64px;
    --glass-blur:14px;

    /* Safe areas */
    --inset-t: env(safe-area-inset-top, 0px);
    --inset-r: env(safe-area-inset-right, 0px);
    --inset-b: env(safe-area-inset-bottom, 0px);
    --inset-l: env(safe-area-inset-left, 0px);

    /* Badges */
    --badge-py:6px;
    --badge-px:12px;
    --badge-fs:13px;
    --badge-radius:12px;

    /* Cards */
    --card-accent-w: 3px;

    /* Buttons (tokens only, not the component style) */
    --btn-py: 10px;
    --btn-px: 14px;
    --btn-minh: 40px;
    --btn-radius: 12px;
    --btn-fg: var(--fg);
    --btn-border: color-mix(in oklab, var(--border) 70%, transparent);
    --btn-border-hover: color-mix(in oklab, var(--accent) 40%, var(--border));
    --btn-shadow: 0 6px 18px color-mix(in oklab, var(--shadow) 35%, transparent);
    --btn-bg-start: color-mix(in oklab, var(--soft) 85%, transparent);
    --btn-bg-end:   color-mix(in oklab, var(--soft) 60%, transparent);
    --btn-primary-fg: var(--fg);
    --btn-primary-border: color-mix(in oklab, var(--accent) 55%, var(--border));
    --btn-primary-bg-start: color-mix(in oklab, var(--accent) 30%, transparent);
    --btn-primary-bg-end:   color-mix(in oklab, var(--accent) 45%, transparent);

    /* Table tokens */
    --lg-cols: 1fr;
    --lg-row-min-h: 36px;
    --lg-row-h: 70px;
    --tbl-max-h: auto;

    /* Font */
    --font-ui: system-ui, -apple-system, "Segoe UI", Roboto, Inter,
               "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
    font-family: var(--font-ui);
  }

  :host *, :host *::before, :host *::after { font-family: inherit; }

  /* Theme transitions */
  :host(.theme-anim){
    transition:
      --bg .28s ease, --fg .28s ease, --muted .28s ease, --soft .28s ease,
      --accent .28s ease, --border .28s ease, --divider .28s ease,
      --tab-bg .28s ease, --tab-fg .28s ease,
      --pill-from .28s ease, --pill-to .28s ease;
  }
  @supports not (property: --bg) {
    :host(.theme-anim){ transition:filter .22s ease; filter:saturate(108%) brightness(1.02); }
  }

  /* Global smooth font rendering */
  :host, * { -webkit-font-smoothing: antialiased; }

  /* Responsive tweaks via tokens (no structural changes here) */
  @media (max-width: 1024px){
    :host{ --w: min(92vw, 560px); }
  }
  @media (max-width: 720px){
    :host{ --w: 100vw; --tab-h:56px; }
  }
  @media (max-width: 480px){
    :host{ --w: 100vw; --tab-h:52px; --pad:12px; }
  }
  @media (max-width: 360px){
    :host{ --tab-h:48px; }
  }
}
`,UW=`
@layer primitives {
  /* Section container */
  .gemini-section { display: block; }

  /* ---- Key-value grid ---- */
  .kv > * { min-width: 0; }
  .kv {
    display: grid;
    grid-template-columns: minmax(110px, 160px) 1fr;
    gap: 10px 14px;
    align-items: center;
  }

  /* ---- Input wrapper ---- */
  .gemini-input-wrap {
    display: flex;
    align-items: center;
    gap: 10px;
    width: 100%;
  }
  .gemini-input-label {
    min-width: 160px;
    opacity: 0.85;
    font-weight: 600;
  }

  /* ---- Basic input ---- */
  .input {
    all: unset;
    display: inline-flex;
    align-items: center;
    width: 100%;
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 10px 12px;
    box-sizing: border-box;
    background-color: color-mix(in oklab, var(--soft) 80%, transparent);
    color: var(--fg);
    font-size: 13px;
    min-height: 36px;
    line-height: 1.2;
    transition: background-color 0.28s ease, border-color 0.28s ease, color 0.28s ease;
  }
  .input:focus {
    outline: 2px solid color-mix(in oklab, var(--accent) 45%, transparent);
  }
  .input:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  /* ---- Labels ---- */
  .gemini-label-wrap {
    display: flex;
    flex-direction: column;
    gap: 6px;
    min-width: 0;
  }
  .gemini-label {
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--fg);
    font-weight: 600;
    line-height: 1.2;
    white-space: nowrap;
  }
  .gemini-label-icon {
    opacity: 0.9;
    font-size: 1em;
    line-height: 1;
  }
  .gemini-label-text {
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* ---- Responsive ---- */
  @media (max-width: 480px) {
    .kv {
      grid-template-columns: 1fr;
    }
    .kv.kv--inline-mobile {
      grid-template-columns: minmax(110px, 160px) 1fr;
      align-items: center;
    }
    .gemini-input-wrap {
      flex-direction: column;
      align-items: stretch;
      gap: 6px;
    }
    .gemini-input-label {
      min-width: 0;
    }
  }
}
`,HW=`
@layer utilities {
  /* Generic utilities, without component styling */

  /* Accessibility */
  .sr-only{
    position:absolute !important;
    width:1px;height:1px;
    padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;
  }

  /* Quick layout helpers */
  .u-flex{ display:flex !important; }
  .u-grid{ display:grid !important; }
  .u-center{ display:flex !important; align-items:center !important; justify-content:center !important; }
  .u-grid-center{ display:grid !important; place-items:center !important; }
  .u-col{ display:flex !important; flex-direction:column !important; }
  .u-flex-1{ flex:1 1 auto !important; }
  .u-row{ display:flex !important; flex-direction:row !important; }
  .u-align-center{ align-items:center !important; }
  .u-justify-between{ justify-content:space-between !important; }
  .u-justify-start{ justify-content:flex-start !important; }
  .u-justify-center{ justify-content:center !important; }
  .u-full{ width:100% !important; }
  .u-h-full{ height:100% !important; }
  .u-minh-0{ min-height:0 !important; }
  .u-nowrap{ white-space:nowrap !important; }
  .u-ellipsis{ overflow:hidden !important; text-overflow:ellipsis !important; white-space:nowrap !important; }
  .u-gap-6{ gap:6px !important; }
  .u-gap-8{ gap:8px !important; }
  .u-gap-12{ gap:12px !important; }
  .u-gap-10{ gap:10px !important; }
  .u-mb-8{ margin-bottom:8px !important; }
  .u-mt-12{ margin-top:12px !important; }

  /* Behaviors */
  .u-scroll-y{ overflow-y:auto !important; }
  .u-no-select{ user-select:none !important; }
  .u-pointer{ cursor:pointer !important; }

  /* Small grouped action areas (e.g., to the right of a read-only value) */
  .kv-actions{ display:inline-flex; gap:6px; }

  /* Compact read-only values (shared primitive) */
  .ro{
    display:inline-flex; align-items:center; width:100%;
    border:1px solid var(--border); border-radius:12px; padding:8px 10px; box-sizing:border-box;
    background-color:color-mix(in oklab, var(--soft) 80%, transparent);
    color:var(--fg); font: 12.5px/1.35 var(--font-ui);
    white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  }

  /* Small circular help icon */
  .u-help-ico{
    display:inline-flex; align-items:center; justify-content:center;
    width:20px; height:20px; border:1px solid var(--border); border-radius:999px;
    font: 12px/1 ui-monospace, SFMono-Regular, Menlo, Consolas;
    opacity:.9; cursor:help; user-select:none;
    background: linear-gradient(
      180deg,
      color-mix(in oklab, var(--soft) 85%, transparent) 0%,
      color-mix(in oklab, var(--soft) 60%, transparent) 100%
    );
  }
}
`,WW=`
@layer components {
  /* ===== Card (base) ===== */
  .card{
    border:1px solid var(--border);
    border-radius:16px;
    padding:12px;
    background-color: color-mix(in oklab, var(--bg) 88%, transparent);
    box-shadow:0 10px 24px color-mix(in oklab, var(--shadow) 40%, transparent);
    transition:
      background-color .28s ease,
      border-color .28s ease,
      box-shadow .28s ease,
      color .28s ease;
    border-left-color: var(--border);
  }

  .card--expandable{
    overflow:hidden;
  }
  .card--expandable.card--expanded{
    overflow:visible;
  }

  .card-collapse{
    display:block;
    overflow:hidden;
    transition:
      height .24s cubic-bezier(.2,.8,.2,1),
      opacity .2s ease;
  }
  .card-collapse--animating{
    pointer-events:none;
    will-change: height, opacity;
    overflow:hidden !important;
  }
  .card--expanded .card-collapse{
    overflow:visible;
  }

  /* —— Sous-structure —— */
  .card-header{
    margin-bottom:8px;
    display:flex;
    align-items:center;
    gap:12px;
    justify-content:space-between;
  }
  .card-body{ display:block; }
  .card-footer{
    margin-top:10px;
    display:flex;
    gap:8px;
    align-items:center;
    justify-content:flex-end;
  }

  .card--collapsed .card-header{
    margin-bottom:0;
  }
  .card--collapsed .card-header--expandable{
    margin:-6px -8px 0;
  }

  .card-header--expandable{
    cursor:pointer;
    user-select:none;
    border-radius:12px;
    padding:6px 8px;
    margin:-6px -8px 8px;
    transition: background-color .2s ease, color .2s ease;
  }
  .card-header--expandable:hover{
    background: color-mix(in oklab, var(--soft) 82%, transparent);
  }
  .card-header--expandable:active{
    background: color-mix(in oklab, var(--soft) 72%, transparent);
  }

  .card-toggle{
    appearance:none;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    padding:2px 4px;
    border:none;
    background:transparent;
    color: var(--fg);
    font: 700 14px/1 var(--font-ui, system-ui);
    cursor:pointer;
    transition: color .2s ease, transform .12s ease;
  }
  .card-toggle:hover{
    color: color-mix(in oklab, var(--accent) 45%, var(--fg));
  }
  .card-toggle:active{
    transform: translateY(1px);
  }

  /* Media block flowing inside the card */
  .card-media img,
  .card-media video,
  .card-media canvas{
    display:block;
    width:100%;
    border-radius:12px;
  }

  /* Divider tinted by the theme */
  .card-divider{
    height:1px;
    margin:8px -2px;
    border-radius:1px;
    background: linear-gradient(
      90deg,
      color-mix(in oklab, var(--pill-from) 52%, var(--border)),
      color-mix(in oklab, var(--pill-to) 48%, var(--border))
    );
    box-shadow: 0 0 0 1px color-mix(in oklab, var(--border) 55%, transparent) inset;
  }

  /* ===== Appearance variants ===== */
  .card--soft {
    background: color-mix(in oklab, var(--bg) 82%, transparent);
  }
  .card--glass {
    background: color-mix(in oklab, var(--bg) 70%, transparent);
    backdrop-filter: blur(var(--glass-blur));
    -webkit-backdrop-filter: blur(var(--glass-blur));
  }
  .card--outline {
    background: transparent;
    border-style: dashed;
  }

  /* Padding variants (control body padding) */
  .card--p-none .card-body { padding: 0; }
  .card--p-sm   .card-body { padding: 8px; }
  .card--p-md   .card-body { padding: 12px; }
  .card--p-lg   .card-body { padding: 16px; }

  /* Lateral accent on hover (if interactive) */
  .card--interactive {
    transition: transform .04s, box-shadow .2s;
    cursor: pointer;
  }
  .card--interactive:hover {
    box-shadow: 0 12px 28px color-mix(in oklab, var(--shadow) 45%, transparent);
    border-left-color: var(--divider);
  }

  /* Optional explicit accent bar */
  .card-accent { display:none; }

  /* Explicit tones (force the accent color) */
  .card--tone-info{
    border-left-width: var(--card-accent-w, 4px);
    border-left-color: var(--info);
  }
  .card--tone-success{
    border-left-width: var(--card-accent-w, 4px);
    border-left-color: var(--high);
  }
  .card--tone-warning{
    border-left-width: var(--card-accent-w, 4px);
    border-left-color: var(--medium);
  }
  .card--tone-danger{
    border-left-width: var(--card-accent-w, 4px);
    border-left-color: var(--low);
  }
}
  
`,VW=`
.btn{
  appearance:none;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:8px;

  padding: var(--btn-py, 10px) var(--btn-px, 14px);
  min-height: var(--btn-minh, 40px);
  border-radius: var(--btn-radius, 12px);

  border:1px solid var(--btn-border, color-mix(in oklab, var(--border) 70%, transparent));
  background: linear-gradient(
    180deg,
    var(--btn-bg-start, color-mix(in oklab, var(--soft) 85%, transparent)) 0%,
    var(--btn-bg-end,   color-mix(in oklab, var(--soft) 60%, transparent)) 100%
  );

  color: var(--btn-fg, var(--fg));
  font: 500 13px/1 var(--font-ui, system-ui);
  letter-spacing:.2px;
  cursor:pointer;

  transition:
    transform .05s,
    box-shadow .2s,
    background .2s,
    border-color .28s ease,
    color .28s ease;

  box-shadow: var(--btn-shadow, 0 6px 18px color-mix(in oklab, var(--shadow) 35%, transparent));
  position: relative;
  isolation: isolate;
  -webkit-tap-highlight-color: transparent;
}

.btn:hover{
  border-color: var(--btn-border-hover, color-mix(in oklab, var(--accent) 40%, var(--border)));
}

.btn:active{
  transform: translateY(1px);
}

.btn:focus-visible{
  outline: none;
  box-shadow:
    0 0 0 2px color-mix(in oklab, var(--accent) 45%, transparent),
    var(--btn-shadow, 0 6px 18px color-mix(in oklab, var(--shadow) 35%, transparent));
}

.btn:disabled,
.btn[disabled],
.btn[aria-busy="true"]{
  opacity:.6;
  cursor:not-allowed;
  filter:saturate(92%);
}

/* Inner content */
.btn .btn-label{
  display:inline-flex;
  align-items:center;
  line-height:1;
}

.btn-ico{
  display:inline-flex;
  align-items:center;
  line-height:0;
}
.btn-ico--left{ margin-right:2px; }
.btn-ico--right{ margin-left:2px; }

/* Variants */
.btn.primary{
  background: linear-gradient(
    180deg,
    var(--btn-primary-bg-start, color-mix(in oklab, var(--accent) 30%, transparent)) 0%,
    var(--btn-primary-bg-end,   color-mix(in oklab, var(--accent) 45%, transparent)) 100%
  );
  border-color: var(--btn-primary-border, color-mix(in oklab, var(--accent) 55%, var(--border)));
  color: var(--btn-primary-fg, var(--fg));
}
.btn.primary:hover{
  border-color: color-mix(in oklab, var(--accent) 65%, var(--border));
  filter: brightness(1.02);
}
.btn.primary:active{
  transform: translateY(1px);
  filter: brightness(.98);
}

/* Sizes */
.btn--sm{
  padding:6px 10px;
  min-height:32px;
  border-radius:10px;
  font-size:12px;
}
.btn--lg{
  padding:12px 16px;
  min-height:44px;
  border-radius:14px;
  font-size:14px;
}

/* Icon-only */
.btn.btn--icon{
  padding:8px;
  min-width:36px;
  min-height:36px;
}
.btn.btn--icon.btn--sm{
  min-width:32px;
  min-height:32px;
  padding:6px;
}

/* Full width */
.btn--full{ width:100%; }

/* Busy: external spinner controls visibility,
   but ensure hidden icons can still be revealed */
.btn[aria-busy="true"] svg[aria-hidden="true"]{
  display:inline-block !important;
}

/* In a .kv container (aligned with your inputs) */
.kv .btn--full{ width:100%; }
`,qW=`
/* Optional wrapper for labels + field */
.lg-input-wrap{
  display:flex;
  align-items:center;
  gap:10px;
  width:100%;
  min-width:0; /* autorise le shrink */
}

/* Label on the left (uses a token for min width) */
.lg-input-label{
  min-width: var(--input-label-minw, 160px);
  opacity:.85;
  font-weight:600;
  color: var(--fg);
  white-space: nowrap;
}

/* Champ */
.input{
  all:unset;
  display:inline-flex;
  align-items:center;
  width:100%;
  min-width:0;

  box-sizing:border-box;
  padding: var(--input-py, 10px) var(--input-px, 12px);
  min-height: var(--input-minh, 36px);
  line-height:1.2;
  font-size: var(--input-fs, 13px);

  border:1px solid var(--border);
  border-radius: var(--input-radius, 12px);

  background-color: color-mix(in oklab, var(--soft) 80%, transparent);
  color: var(--fg);

  transition:
    background-color .28s ease,
    border-color .28s ease,
    color .28s ease,
    box-shadow .2s ease;
  -webkit-tap-highlight-color: transparent;
}

/* Placeholder lisible sans hurler */
.input::placeholder{
  color: color-mix(in oklab, var(--fg) 70%, #9ca3af);
  opacity:.9;
}

/* Focus accessible */
.input:focus,
.input:focus-visible{
  outline: 2px solid color-mix(in oklab, var(--accent) 45%, transparent);
  outline-offset: 0; /* le contour remplace la box-shadow */
}

/* Disabled */
.input:disabled,
.input[disabled]{
  opacity:.6;
  cursor:not-allowed;
}

/* Tailles */
.input--sm{
  --input-py: 8px;
  --input-px: 10px;
  --input-minh: 32px;
  --input-radius: 10px;
  --input-fs: 12px;
}

.input--lg{
  --input-py: 12px;
  --input-px: 14px;
  --input-minh: 44px;
  --input-radius: 14px;
  --input-fs: 14px;
}

/* Pleine largeur utilitaire */
.input--full{ width:100%; }

/* Automatic label shrinking on small screens */
@media (max-width: 720px){
  .lg-input-label{ min-width: var(--input-label-minw-sm, 120px); }
}

/* Vertical stack for very small screens (when used with .kv elsewhere) */
@media (max-width: 480px){
  .lg-input-wrap{
    flex-direction:column;
    align-items:stretch;
    gap:6px;
  }
  .lg-input-label{
    min-width:0;
  }
}
`,KW=`
.lg-label-wrap{
  display:flex;
  flex-direction:column;
  gap:6px;
  min-width:0;
}

/* Ligne principale du label */
.lg-label{
  display:flex;
  align-items:center;
  gap:8px;
  color: var(--fg);
  font-weight:600;
  line-height:1.2;
  white-space:nowrap;
  transition: color .28s ease, opacity .2s ease;
}

/* Optional icon on the left */
.lg-label-ico{
  opacity:.9;
  font-size:1em;
  line-height:1;
}

/* Label text, neatly truncated */
.lg-label-text{
  overflow:hidden;
  text-overflow:ellipsis;
}

/* Required asterisk */
.lg-label-req{
  color: color-mix(in oklab, #ef4444 70%, var(--fg));
  font-weight:700;
}

/* Suffix slot on the right (badge, help, actions) */
.lg-label-suffix{
  margin-left:auto;
  display:inline-flex;
  align-items:center;
  gap:6px;
}

/* Hint sous le label */
.lg-label-hint{
  font-size:12px;
  opacity:.8;
  color: color-mix(in oklab, var(--fg) 80%, #9ca3af);
  line-height:1.25;
  white-space:normal;
}

/* Tones (couleurs de texte) */
.lg-label--default .lg-label{ color: var(--fg); }
.lg-label--muted   .lg-label{ color: color-mix(in oklab, var(--fg) 72%, #9ca3af); }
.lg-label--info    .lg-label{ color: color-mix(in oklab, #38bdf8 72%, var(--fg)); }
.lg-label--success .lg-label{ color: color-mix(in oklab, #22c55e 72%, var(--fg)); }
.lg-label--warning .lg-label{ color: color-mix(in oklab, #f59e0b 80%, var(--fg)); }
.lg-label--danger  .lg-label{ color: color-mix(in oklab, #ef4444 80%, var(--fg)); }

/* Disabled (sur un conteneur parent) */
.is-disabled .lg-label{ opacity:.6; cursor:not-allowed; }

/* Tailles */
.lg-label--sm .lg-label{ font-size:12px; }
.lg-label--md .lg-label{ font-size:13px; }
.lg-label--lg .lg-label{ font-size:14px; }

/* “Stacked” variant (forces title no-wrap) */
.lg-label--stacked .lg-label{ white-space:nowrap; }

/* Variant: title (plus gros, comme un titre compact) */
.lg-label--title .lg-label{
  font-size:16px;
  font-weight:700;
  line-height:1.25;
}

/* Small screens: give the suffix some room if needed */
@media (max-width: 480px){
  .lg-label{ gap:6px; }
  .lg-label-suffix{ gap:4px; }
}
`,XW=`
/* Bar container (provided by the HUD, also useful when NavTabs is standalone) */
.lg-tabbar{
  position: relative;
  height: var(--tab-h);
  display: grid;
  grid-template-columns: minmax(0, 1fr) auto; /* tabs that stretch + action slot on the right */
  align-items: center;
  gap: 20px;
  padding: 12px 12px;
  background-color: color-mix(in oklab, var(--bg) 92%, transparent);
  transition: background-color .28s ease, border-color .28s ease;
}

/* Wrapper containing arrows + tabs container */
.lg-tabs-wrapper{
  position: relative;
  display: flex;
  align-items: center;
  gap: 8px;
  min-width: 0;
  width: 100%;
}

/* Ribbon containing the tabs */
.lg-tabs{
  position: relative;
  display: flex;
  align-items: center;
  gap: 2px;

  min-width: 0;       /* allow shrink */
  flex: 1 1 auto;
  max-width: none;

  background-color: var(--tab-bg);
  color: var(--tab-fg);
  border-radius: 999px;
  padding: 6px;

  box-shadow: 0 4px 12px color-mix(in oklab, var(--shadow) 32%, transparent);

  overflow: hidden;
  scrollbar-width: none;
  transition: background-color .28s ease, color .28s ease;
  scroll-behavior: smooth;
}
.lg-tabs::-webkit-scrollbar{ display:none; }

/* Scroll arrow buttons */
.lg-tabs-arrow{
  position: relative;
  flex: 0 0 32px;
  height: 32px;
  border-radius: 8px;
  border: 1px solid color-mix(in oklab, var(--border) 60%, transparent);
  background: linear-gradient(180deg,
    color-mix(in oklab, var(--soft) 75%, transparent) 0%,
    color-mix(in oklab, var(--soft) 65%, transparent) 100%
  );
  color: var(--fg);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;

  transition: all .2s cubic-bezier(.2,.8,.2,1);
  opacity: 1;
  box-shadow: 0 2px 6px color-mix(in oklab, var(--shadow) 12%, transparent);
}

.lg-tabs-arrow svg{
  width: 16px;
  height: 16px;
  stroke: currentColor;
}

.lg-tabs-arrow:hover:not(.disabled){
  background: linear-gradient(180deg,
    color-mix(in oklab, var(--soft) 88%, transparent) 0%,
    color-mix(in oklab, var(--soft) 78%, transparent) 100%
  );
  border-color: color-mix(in oklab, var(--accent) 50%, var(--border));
  box-shadow: 0 4px 12px color-mix(in oklab, var(--accent) 25%, transparent);
  transform: translateY(-2px);
}

.lg-tabs-arrow:active:not(.disabled){
  transform: scale(.96) translateY(0);
  box-shadow: 0 1px 3px color-mix(in oklab, var(--shadow) 20%, transparent);
}

.lg-tabs-arrow.disabled{
  opacity: .35;
  cursor: not-allowed;
  box-shadow: none;
}

/* Tab button */
.lg-tab{
  position: relative;
  z-index: 1;
  flex: 0 0 auto;
  padding: 10px 18px;
  border-radius: 999px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;

  background: transparent;
  border: none;
  color: inherit;
  opacity: .85;

  white-space: nowrap;
  transition: opacity .15s, transform .05s;
}
.lg-tab:hover{ opacity: 1; }
.lg-tab:active{ transform: translateY(1px); }

/* Animated pill behind the active tab (managed in JS) */
.lg-pill{
  position: absolute;
  z-index: 0;
  top: 6px;
  left: 0;
  height: calc(100% - 12px);
  width: 0;
  border-radius: 999px;

  background: linear-gradient(135deg, var(--pill-from), var(--pill-to));
  box-shadow: 0 8px 22px rgba(0,0,0,.18);

  transition: transform .25s cubic-bezier(.2,.8,.2,1), width .25s cubic-bezier(.2,.8,.2,1);
  will-change: transform, width;
}

/* Density and responsive */
@media (max-width: 720px){
  .lg-tabbar{
    padding: 8px max(8px, var(--inset-l)) 8px max(8px, var(--inset-r));
    gap: 12px;
  }
  .lg-tabs-wrapper{ gap: 6px; }
  .lg-tabs-arrow{
    flex: 0 0 28px;
    height: 28px;
    border-radius: 7px;
  }
  .lg-tabs-arrow svg{ width: 15px; height: 15px; }
  .lg-tabs{ padding: 5px; }
  .lg-tab{ padding: 9px 14px; font-size: 13.5px; }
  .lg-pill{ top: 5px; height: calc(100% - 10px); }
}

/* Mobile: hide arrows, enable swipe with better feedback */
@media (max-width: 480px){
  .lg-tabbar{
    padding: 12px max(10px, var(--inset-l)) 12px max(10px, var(--inset-r));
    gap: 12px;
  }
  .lg-tabs-wrapper{
    gap: 0;
  }
  /* Hide arrow buttons on mobile completely */
  .lg-tabs-arrow{
    display: none !important;
  }
  .lg-tabs{
    border-radius: 14px;
    padding: 4px;
    /* Enable native touch scrolling behavior with momentum */
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
    /* Improve touch responsiveness */
    touch-action: pan-x;
  }
  .lg-tab{
    padding: 8px 12px;
    font-size: 13px;
    /* Slightly larger touch target on mobile */
    min-width: 60px;
  }
  .lg-pill{
    top: 4px;
    height: calc(100% - 8px);
  }
}

@media (max-width: 360px){
  .lg-tab{
    padding: 6px 10px;
    font-size: 12px;
    min-width: 50px;
  }
}
`,YW=`
/* ==================== SearchBar ==================== */
.search{
  display:flex;
  align-items:stretch;
  gap:8px;
  width:100%;
}

.search-field{
  position:relative;
  flex:1 1 auto;
  display:flex;
  align-items:center;
  min-width:0;
}

/* Inherits global .input styles for visual consistency */
.search-input{
  all:unset;
  display:inline-flex;
  align-items:center;
  width:100%;
  border:1px solid var(--border);
  border-radius:12px;
  padding:10px 12px;
  box-sizing:border-box;
  background-color: color-mix(in oklab, var(--soft) 80%, transparent);
  color: var(--fg);
  font-size:13px;
  min-height:40px;
  line-height:1.2;
  transition: background-color .28s ease, border-color .28s ease, color .28s ease;

  /* Space for left icon + actions on the right */
  padding-left:36px;
  padding-right:82px;
}

.search-input:focus{
  outline:2px solid color-mix(in oklab, var(--accent) 45%, transparent);
}

/* Sizes */
.search--sm .search-input{ min-height:36px; font-size:12.5px; }
.search--lg .search-input{ min-height:44px; font-size:14px; }

/* Icons */
.search-ico{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  display:inline-flex;
  align-items:center;
  justify-content:center;
  color: color-mix(in oklab, var(--fg) 82%, #9ca3af);
  opacity:.95;
  pointer-events:none;
  user-select:none;
  font: 12px/1 ui-monospace, SFMono-Regular, Menlo, Consolas;
}

.search-ico--left{ left: 10px; }
.search-ico--right{ right: 46px; }

.search--sm .search-ico,
.search--sm .search-clear,
.search--sm .search-spinner{ transform: translateY(-50%) scale(.95); }

.search--lg .search-ico,
.search--lg .search-clear,
.search--lg .search-spinner{ transform: translateY(-50%) scale(1.05); }

/* Spinner on the right */
.search-spinner{
  position:absolute;
  top:50%;
  right:24px;
  transform:translateY(-50%);
  opacity:.9;
}
.search.is-loading .search-ico--right{ opacity:.35; }

/* Clear button */
.search-clear{
  position:absolute;
  top:50%;
  right:6px;
  transform:translateY(-50%);
  width:28px;
  height:28px;
  border-radius:999px;
  display:inline-grid;
  place-items:center;

  border:1px solid color-mix(in oklab, var(--border) 70%, transparent);
  background: linear-gradient(
    180deg,
    color-mix(in oklab, var(--soft) 85%, transparent) 0%,
    color-mix(in oklab, var(--soft) 62%, transparent) 100%
  );
  color: color-mix(in oklab, var(--fg) 86%, #a3a3a3);

  font: 14px/1 var(--font-ui);
  cursor:pointer;
  box-shadow:0 6px 16px color-mix(in oklab, var(--shadow) 35%, transparent);
  transition: border-color .2s ease, background .2s ease, transform .05s, color .2s ease;
}
.search-clear:hover{
  border-color: color-mix(in oklab, var(--accent) 40%, var(--border));
  color: var(--fg);
}
.search-clear:active{ transform: translateY(-50%) scale(.98); }

/* Slot bouton submit (optionnel) */
.search-submit{ flex: 0 0 auto; }

/* Disabled */
.search.disabled .search-input{ opacity:.6; cursor:not-allowed; }
.search.disabled .search-clear{ opacity:.6; pointer-events:none; }

/* KV grid integration */
.kv .search{ width:100%; }
.kv.kv-tight{ grid-template-columns: minmax(110px,160px) 1fr; }
.kv.kv-tight .lg-label-wrap{ margin-right:0; }
.kv.kv-tight .search-field .search-input{
  border-top-left-radius: 0;
  border-bottom-left-radius: 0;
}
.kv.kv-tight .lg-label-wrap .lg-label{
  border:1px solid var(--border);
  border-right:none;
  padding:10px 12px;
  border-top-left-radius:12px;
  border-bottom-left-radius:12px;
  background: color-mix(in oklab, var(--soft) 82%, transparent);
}

/* Final responsive tweak */
@media (max-width: 480px){
  .search-input{ min-height:44px; }
}
`,JW=`
/* ==================== Select ==================== */
.select{
  position:relative;
  display:inline-block;
  min-width:180px;
}

.select.sm { min-width: 160px; }
.select.md { min-width: 180px; } /* default value */
.select.lg { min-width: 220px; }

.select.shrink { min-width: 0; }

.select.disabled{
  opacity:.6;
  pointer-events:none;
}

/* Trigger */
.select-trigger{
  appearance:none;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;

  width:100%;
  padding:10px 12px;
  min-height:40px;
  line-height:1;

  border-radius:12px;
  border:1px solid color-mix(in oklab, var(--border) 70%, transparent);
  background:linear-gradient(
    180deg,
    color-mix(in oklab, var(--soft) 85%, transparent) 0%,
    color-mix(in oklab, var(--soft) 60%, transparent) 100%
  );
  color:var(--fg);
  font-size:13px;
  font-weight:550;
  letter-spacing:.2px;

  cursor:pointer;
  transition:transform .05s, box-shadow .2s, background .2s,
             border-color .28s ease, color .28s ease;
  box-shadow:0 6px 18px color-mix(in oklab, var(--shadow) 35%, transparent);
}
.select-trigger:hover{
  border-color:color-mix(in oklab, var(--accent) 40%, var(--border));
}
.select-trigger:active{
  transform:translateY(1px);
}
.select-caret{
  opacity:.8;
  font:12px/1 ui-monospace,SFMono-Regular,Menlo,Consolas;
}

/* Sizes */
.select--sm .select-trigger{
  padding:6px 10px;
  min-height:36px;
  border-radius:10px;
  font-size:12px;
}
.select--lg .select-trigger{
  padding:12px 14px;
  min-height:44px;
  font-size:14px;
}

/* Menu */
.select-menu{
  position:absolute;
  left:0;
  top:calc(100% + 6px);
  z-index:20;

  display:none;
  max-height:240px;
  overflow:auto;

  padding:6px;
  border-radius:12px;
  border:1px solid var(--border);
  background-color:color-mix(in oklab, var(--bg) 88%, transparent);
  box-shadow:0 10px 24px color-mix(in oklab, var(--shadow) 40%, transparent);
  backdrop-filter:blur(var(--glass-blur));
  -webkit-backdrop-filter:blur(var(--glass-blur));

  transition:background-color .28s ease, border-color .28s ease,
             color .28s ease, box-shadow .28s ease;
}
.select.open .select-menu{ display:block; }

/* Options */
.select-option{
  width:100%;
  text-align:left;

  padding:8px 10px;
  border-radius:10px;
  border:1px solid transparent;

  background:transparent;
  color:var(--fg);
  font-size:13px;
  font-weight:550;
  line-height:1.15;

  cursor:pointer;
  transition:background-color .15s, border-color .15s, color .15s;
}
.select-option:hover,
.select-option.active{
  background:color-mix(in oklab, var(--soft) 85%, transparent);
  border-color:color-mix(in oklab, var(--border) 60%, transparent);
}
.select-option.selected{
  background:color-mix(in oklab, var(--accent) 22%, transparent);
  border-color:color-mix(in oklab, var(--accent) 50%, var(--border));
}
.select-option.disabled{
  opacity:.5;
  cursor:not-allowed;
}

/* KV integration */
.kv .select{ width:100%; }

/* Mobile tweaks */
@media (max-width: 480px){
  .select{ min-width:0; width:100%; }
  .select-menu{
    left:0;
    right:0;
    min-width:100%;
    max-height:min(50dvh, 360px);
  }
}
`,QW=`
/* ==================== Switch ==================== */

.lg-switch-wrap{
  display:inline-flex;
  align-items:center;
  gap:10px;
}

/* Track */
.lg-switch{
  --sw-w: 44px;
  --sw-h: 24px;
  --sw-gap: 2px;

  --sw-border: var(--border);
  --sw-off: color-mix(in oklab, var(--soft) 82%, transparent);
  --sw-on:  color-mix(in oklab, var(--accent) 38%, transparent);
  --thumb: var(--switch-thumb);

  position:relative;
  width: var(--sw-w);
  height: var(--sw-h);
  border-radius: 999px;
  border:1px solid var(--sw-border);
  background: var(--sw-off);
  cursor:pointer;
  transition: background .18s ease, border-color .18s ease, box-shadow .18s ease;
  box-shadow: 0 4px 14px color-mix(in oklab, var(--shadow) 30%, transparent);
}

/* On state */
.lg-switch.on{
  background: var(--sw-on);
  border-color: color-mix(in oklab, var(--accent) 55%, var(--border));
}

/* Thumb */
.lg-switch-thumb{
  position:absolute;
  top:50%;
  left: var(--sw-gap);
  width: calc(var(--sw-h) - 2*var(--sw-gap));
  height: calc(var(--sw-h) - 2*var(--sw-gap));
  border-radius: 999px;
  background: var(--thumb);
  transform: translate(0, -50%);
  transition: left .18s ease, background .18s ease, box-shadow .18s ease;
  box-shadow: 0 2px 8px color-mix(in oklab, var(--shadow) 40%, transparent);
}

.lg-switch.on .lg-switch-thumb{
  left: calc(100% - var(--sw-gap) - (var(--sw-h) - 2*var(--sw-gap)));
}

/* Sizes */
.lg-switch--sm{
  --sw-w: 36px;
  --sw-h: 20px;
  --sw-gap: 2px;
}
.lg-switch--md{
  --sw-w: 44px;
  --sw-h: 24px;
  --sw-gap: 2px;
}
.lg-switch--lg{
  --sw-w: 56px;
  --sw-h: 30px;
  --sw-gap: 3px;
}

/* Disabled (if you manage a state) */
.lg-switch[aria-disabled="true"],
.lg-switch.disabled{
  opacity:.6;
  cursor:not-allowed;
  filter:saturate(92%);
}
`,ZW=`
/* ==================== Checkbox ==================== */

.lg-checkbox-wrap {
  display: inline-flex;
  align-items: center;
  gap: 10px;
  position: relative;
}

.lg-checkbox {
  --cb-size: 20px;
  --cb-border: var(--border);
  --cb-bg: var(--soft);
  --cb-checked-bg: var(--accent);
  --cb-checked-border: var(--accent);
  --cb-checkmark: #fff;

  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  width: var(--cb-size);
  height: var(--cb-size);
  border-radius: 4px;
  border: 1px solid var(--cb-border);
  background: var(--cb-bg);
  cursor: pointer;
  transition: background 0.18s ease, border-color 0.18s ease, box-shadow 0.18s ease;
  box-shadow: 0 2px 8px color-mix(in oklab, var(--shadow) 20%, transparent);
  flex-shrink: 0;
  padding: 0;
  margin: 0;
  position: relative;
}

.lg-checkbox:hover:not(:disabled) {
  border-color: color-mix(in oklab, var(--accent) 40%, var(--border));
  box-shadow: 0 2px 8px color-mix(in oklab, var(--shadow) 30%, transparent);
}

.lg-checkbox:focus-visible {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}

.lg-checkbox:checked {
  background: var(--cb-checked-bg);
  border-color: var(--cb-checked-border);
}

.lg-checkbox:checked::after {
  content: '';
  position: absolute;
  top: 45%;
  left: 50%;
  transform: translate(-40%, -50%) rotate(45deg);
  width: 5px;
  height: 9px;
  border: solid var(--cb-checkmark);
  border-width: 0 2px 2px 0;
  opacity: 1;
}

.lg-checkbox:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  filter: saturate(92%);
}

.lg-checkbox-label {
  font-size: 14px;
  color: var(--fg);
  user-select: none;
  cursor: pointer;
}

.lg-checkbox:disabled ~ .lg-checkbox-label {
  opacity: 0.6;
  cursor: not-allowed;
}

/* Sizes */
.lg-checkbox--sm {
  --cb-size: 16px;
}

.lg-checkbox--md {
  --cb-size: 20px;
}

.lg-checkbox--lg {
  --cb-size: 24px;
}

.lg-checkbox--sm:checked::after {
  width: 3px;
  height: 7px;
  border-width: 0 1.5px 1.5px 0;
}

.lg-checkbox--lg:checked::after {
  width: 7px;
  height: 11px;
  border-width: 0 2.5px 2.5px 0;
}
`,eV=`
/* ==================== Table ==================== */

.lg-table-wrap{
  border:1px solid var(--border);
  border-radius:16px;
  background: color-mix(in oklab, var(--bg) 88%, transparent);
  box-shadow:0 10px 24px color-mix(in oklab, var(--shadow) 40%, transparent);
  overflow:hidden;
  display:grid;
}

/* Structure principale: header / body scrollable / footer */
.lg-table{
  display:grid;
  grid-template-rows:auto 1fr auto;
  min-width:0;
  min-height:0; /* autorise le scroll interne */
}

/* Head & Body strictly share the same column grid */
.lg-thead,
.lg-tbody{
  display:grid;
  grid-template-columns: var(--lg-cols);
  min-width:0;
}

/* Sticky header optionnel (activer via .lg-table-wrap.sticky) */
.lg-table-wrap.sticky .lg-thead{
  position:sticky;
  top:0;
  z-index:1;
  background: color-mix(in oklab, var(--bg) 92%, transparent);
}

/* Les <tr> ne doivent pas casser la grille */
.lg-tr{ display:contents; }

/* Cellules (header + body) */
.lg-th, .lg-td{
  min-width:0;
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
  padding:10px 12px;
  display:flex;
  align-items:center;
  align-self:stretch;
  box-sizing:border-box;
  gap:8px;
  min-height: var(--lg-row-min-h, 36px);
  justify-content: var(--col-justify, flex-start);
  text-align: center; /* Fallback for text-only cells */
  border-bottom:1px solid color-mix(in oklab, var(--border) 80%, transparent);
}

/* Header: reset + chevrons de tri */
.lg-th{
  appearance:none;
  border:0;
  background: color-mix(in oklab, var(--bg) 92%, transparent);
  font: inherit;
  font-weight:700;
  color:var(--fg);
  position:relative;
  cursor:default;
  border-bottom:1px solid var(--border);
}
.lg-th:focus{ outline:none; }
.lg-th::-moz-focus-inner{ border:0; padding:0; }
.lg-th.sortable{ cursor:pointer; }

/* Sort icons (CSS triangles) */
.lg-th::after{
  content:"";
  position:absolute;
  right:8px;
  top:50%;
  transform:translateY(-50%);
  opacity:0;
  border:5px solid transparent;
  transition:opacity .15s, transform .15s;
}
.lg-th[data-sort="asc"]::after{
  opacity:.95;
  border-bottom-color: currentColor;
  transform:translateY(-40%);
}
.lg-th[data-sort="desc"]::after{
  opacity:.95;
  border-top-color: currentColor;
  transform:translateY(-60%);
}

/* Body: scroll interne fiable */
.lg-tbody{
  grid-auto-rows: var(--lg-row-h, 44px);
  max-height: var(--tbl-max-h, auto);
  overflow:auto;
  overflow-y:auto;
  overflow-x:auto;
  scrollbar-gutter:stable;
  min-height:0; /* key so scrolling does not jump */
}
.lg-tbody::-webkit-scrollbar {
  width: 10px;
}
.lg-tbody::-webkit-scrollbar-track {
  background: transparent;
}
.lg-tbody::-webkit-scrollbar-thumb {
  background: var(--muted);
  border-radius: 8px;
}
.lg-tbody::-webkit-scrollbar-thumb:hover {
  background: color-mix(in oklab, var(--muted) 150%, transparent);
}

/* Hover & clickable rows */
.lg-tr-body.clickable{ cursor:pointer; }
.lg-tr-body:hover .lg-td{
  background: color-mix(in oklab, var(--soft) 85%, transparent);
}

/* Zebra */
.lg-table-wrap.zebra .lg-tbody .lg-tr-body:nth-child(even) .lg-td{
  background: color-mix(in oklab, var(--soft) 80%, transparent);
}

/* Mode compact */
.lg-table-wrap.compact .lg-td,
.lg-table-wrap.compact .lg-th{
  padding:8px 10px;
}

/* Selection column (checkbox) */
.lg-table-wrap.selectable .lg-th-check,
.lg-table-wrap.selectable .lg-td-check{
  width: var(--check-w, 36px);
  min-width: var(--check-w, 36px);
  display:flex;
  justify-content:center;
  align-items:center;
  grid-column:1;
}

/* Normalisation du contenu interne des cellules */
.lg-th > *, .lg-td > *{ margin:0; }
.lg-td input, .lg-td button, .lg-td select{ margin:0; line-height:1; }
.lg-td .select-trigger, .lg-td .switch{ align-self:center; line-height:1; }

/* Footer (pager) */
.lg-tfoot{
  padding:8px 10px;
  border-top:1px solid var(--border);
  background: color-mix(in oklab, var(--bg) 92%, transparent);
}
.lg-pager{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:10px;
}
.lg-pager .btn{ padding:6px 10px; border-radius:10px; font-size:12px; }
.lg-pager-info{ opacity:.9; font-weight:600; }

/* Responsive arrondis et paddings plus doux */
@media (max-width:520px){
  .lg-table-wrap{ border-radius:12px; }
  .lg-td, .lg-th{ padding:8px 10px; }
  .lg-pager .btn{ padding:5px 8px; }
}

/* Animatable rows (when you insert/delete) */
.lg-tr-body.is-animating .lg-td {
  will-change: transform, opacity;
  transition: transform .18s ease, opacity .18s ease;
}
@media (prefers-reduced-motion: reduce) {
  .lg-tr-body.is-animating .lg-td { transition: none !important; }
}
`,tV=`
@keyframes teamClick {
  0% {
    transform: scale(1);
  }
  50% {
    transform: scale(0.98);
  }
  100% {
    transform: scale(1);
  }
}

.team-list-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  background-color: var(--soft);
  border: 1px solid var(--border);
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.15s ease, transform 0.2s ease;
  position: relative;
}

.team-list-item--clicked {
  animation: teamClick 0.3s ease;
}

/* In manage mode, disable drag cursor */
.team-list-item.team-list-item--manage {
  cursor: auto;
}

.team-list-item:not(:last-child) {
  margin-bottom: 4px;
}

.team-list-item:hover {
  background-color: var(--tab-bg);
}

.team-list-item--dragging {
  opacity: 0.5;
  cursor: grabbing;
  transform: scale(1.02);
  box-shadow: 0 4px 12px color-mix(in oklab, var(--shadow) 30%, transparent);
}

.team-list-item--drag-over {
  border-color: var(--accent);
  background-color: color-mix(in oklab, var(--accent) 10%, var(--soft));
}

.team-list-item--grabbing {
  cursor: grabbing;
}

.team-list-item__indicator {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
  transition: background-color 0.2s ease, opacity 0.2s ease;
}

.team-list-item__indicator--active {
  background-color: var(--complete);
  opacity: 1;
}

.team-list-item__indicator--inactive {
  background-color: var(--muted);
  opacity: 0.5;
}

.team-list-item__name {
  flex: 1;
  font-size: 14px;
  color: var(--fg);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  min-width: 0;
}

.team-list-item__name--active {
  font-weight: 600;
}

.team-list-item__name--inactive {
  font-weight: 400;
}

/* Input in manage mode */
.team-list-item__name-input {
  flex: 1;
  min-width: 0;
}

.team-list-item__name-input .input {
  font-size: 14px;
  color: var(--fg);
  padding: 4px 8px;
  width: 100%;
}

.team-list-item__sprites {
  display: flex;
  gap: 4px;
  align-items: center;
  flex-shrink: 0;
}

.team-list-item__sprite-slot {
  width: 32px;
  height: 32px;
  border-radius: 8px;
  background: linear-gradient(
    135deg,
    color-mix(in oklab, var(--bg) 50%, transparent) 0%,
    color-mix(in oklab, var(--bg) 80%, transparent) 100%
  );
  border: 1px solid color-mix(in oklab, var(--border) 40%, transparent);
  box-shadow:
    inset 0 2px 4px color-mix(in oklab, var(--shadow) 25%, transparent),
    inset 0 -1px 2px color-mix(in oklab, var(--bg) 20%, transparent);
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  flex-shrink: 0;
  position: relative;
  transition: all 0.2s ease;
}

/* Manage mode - empty slot (accent color for addition) */
.team-list-item__sprite-slot--empty {
  border: 1.5px solid var(--accent);
  background: color-mix(in oklab, var(--accent) 8%, var(--bg));
  box-shadow: inset 0 2px 4px color-mix(in oklab, var(--accent) 10%, transparent);
}

.team-list-item__sprite-slot--empty svg {
  width: 18px;
  height: 18px;
  flex-shrink: 0;
}

/* Manage mode - filled slot (danger color for removal) */
.team-list-item__sprite-slot.team-list-item__sprite-slot--filled {
  border: 1.5px solid var(--low) !important;
  box-shadow: inset 0 2px 4px color-mix(in oklab, var(--low) 15%, transparent);
}

.team-list-item__sprite-slot-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: color-mix(in oklab, var(--low) 25%, transparent);
  border-radius: 6px;
  pointer-events: none;
  z-index: 1;
}

.team-list-item__sprite-placeholder {
  font-size: 16px;
  opacity: 0.5;
}

.team-list-item__drag-handle {
  font-size: 16px;
  color: var(--fg);
  opacity: 0.6;
  cursor: grab;
  user-select: none;
  line-height: 1;
  padding: 0 4px;
  flex-shrink: 0;
  transition: opacity 0.2s ease;
}

.team-list-item:hover .team-list-item__drag-handle {
  opacity: 1;
}

.team-list-item__drag-handle:active,
.team-list-item--grabbing .team-list-item__drag-handle {
  cursor: grabbing;
}

.team-list-item--placeholder {
  border-style: dashed !important;
  border-color: color-mix(in oklab, var(--accent) 58%, var(--border)) !important;
  background: color-mix(in oklab, var(--accent) 22%, transparent) !important;
  box-shadow: none !important;
  opacity: 1;
  pointer-events: none;
  visibility: visible !important;
}

.team-list-item--placeholder * {
  visibility: hidden;
}
`,nV=`
/* ==================== TimeRangePicker ==================== */

.time-range{
  display: grid;
  grid-template-columns: 1fr;
  row-gap: 10px;
  color: var(--fg);
  width: 100%;
}

/* Inline variant: do not stretch to full width */

.time-range.time-range--inline{
  display: grid;
  width: 100%;             /* always occupy the available width */
  justify-items: stretch;  /* stretch inner elements */
  align-items: start;
}

/* Inline wrapper for picker + summary (composed variant) */
.trp-inline{ display:flex; align-items:center; gap:10px; width:100%; }
.trp-inline > .time-range{ flex:1 1 auto; min-width:0; }
.trp-summary{ display:flex; flex-direction:column; align-items:center; gap:6px; flex:0 0 auto; }
.trp-clock{ display:flex; align-items:center; justify-content:center; width:72px; min-width:72px; aspect-ratio:1; color:var(--accent); }
.trp-clock-svg{ width:100%; height:auto; display:block; }
.trp-clock-face{ fill: color-mix(in oklab, var(--soft) 80%, transparent); stroke: color-mix(in oklab, var(--border) 90%, transparent); stroke-width: 1.5; }
.trp-clock-ticks{ pointer-events:none; }
.trp-clock-tick{ stroke: color-mix(in oklab, var(--fg) 35%, transparent); stroke-width: 1.3; stroke-linecap:round; opacity:.65; }
.trp-clock-tick--major{ stroke-width: 1.8; opacity:.8; }
.trp-clock-arcs{ pointer-events:none; }
.trp-clock-arc{
  fill:none;
  stroke: color-mix(in oklab, var(--accent) 85%, white 15%);
  stroke-width:6;
  stroke-linecap:round;
  opacity:.62;
  mix-blend-mode:multiply;
  transition: stroke .28s ease, opacity .28s ease;
}
.trp-clock-arc[data-pass="1"]{
  opacity:.82;
  stroke: color-mix(in oklab, var(--accent) 70%, black 30%);
}
.trp-clock-arc[data-pass="2"]{
  opacity:.94;
  stroke: color-mix(in oklab, var(--accent) 55%, black 45%);
}
.trp-clock-arc[data-pass="3"]{
  opacity:1;
  stroke: color-mix(in oklab, var(--accent) 40%, black 60%);
}
.trp-clock-arc--full{ stroke-linecap:butt; }
.trp-clock-center{ fill: color-mix(in oklab, var(--fg) 70%, transparent); }
.trp-clock-duration{ font-weight:600; font-size:13px; letter-spacing:.01em; color: color-mix(in oklab, var(--fg) 92%, transparent); }
.trp-clock-pointers{ pointer-events:none; }
.trp-clock-pointer{ transform-origin:50px 50px; transition: transform .25s ease; }
.trp-clock-pointer-line{
  stroke: currentColor;
  stroke-width: 2.8;
  stroke-linecap: round;
  opacity:.88;
}
.trp-clock-pointer-tip{
  fill: currentColor;
  stroke: color-mix(in oklab, currentColor 75%, black 25%);
  stroke-width: .6;
  opacity:.96;
}
.trp-clock-pointer--start{ color: color-mix(in oklab, var(--accent) 70%, white 30%); }
.trp-clock-pointer--end{ color: color-mix(in oklab, var(--fg) 75%, var(--accent) 25%); }
@media (hover: hover) and (pointer: fine){
  .trp-clock-arc{
    stroke: color-mix(in oklab, var(--accent) 88%, white 12%);
    opacity:.7;
  }
  .trp-clock-arc[data-pass="1"]{
    stroke: color-mix(in oklab, var(--accent) 68%, black 32%);
    opacity:.88;
  }
  .trp-clock-arc[data-pass="2"]{
    stroke: color-mix(in oklab, var(--accent) 50%, black 50%);
    opacity:1;
  }
  .trp-clock-arc[data-pass="3"]{
    stroke: color-mix(in oklab, var(--accent) 35%, black 65%);
  }
  .trp-clock-pointer--start{ color: color-mix(in oklab, var(--accent) 65%, white 35%); }
  .trp-clock-pointer--end{ color: color-mix(in oklab, var(--fg) 82%, var(--accent) 18%); }
}
@media (hover: none) and (pointer: coarse){
  .trp-clock-arc{
    stroke: color-mix(in oklab, var(--accent) 82%, white 18%);
    opacity:.78;
    mix-blend-mode:normal;
  }
  .trp-clock-arc[data-pass="1"]{
    stroke: color-mix(in oklab, var(--accent) 60%, black 40%);
    opacity:.95;
  }
  .trp-clock-arc[data-pass="2"]{
    stroke: color-mix(in oklab, var(--accent) 45%, black 55%);
    opacity:1;
  }
  .trp-clock-arc[data-pass="3"]{
    stroke: color-mix(in oklab, var(--accent) 30%, black 70%);
  }
  .trp-clock-pointer--start{ color: color-mix(in oklab, var(--accent) 68%, white 32%); }
  .trp-clock-pointer--end{ color: color-mix(in oklab, var(--fg) 80%, var(--accent) 20%); }
}
@media (max-width: 480px){
  .trp-inline{ gap:12px; }
  .trp-summary{
    flex:0 0 auto;
    flex-direction:column;
    align-items:center;
    justify-content:flex-start;
    gap:6px;
  }
  .trp-clock{ width:60px; min-width:60px; }
  .trp-clock-duration{ font-size:12px; }
}
.time-range.time-range--inline .time-range-field{ width: 100%; }
.time-range.time-range--inline .time-picker{ width: 100%; }
.time-range.time-range--inline .time-range-input{ width: 100%; }
.time-range.time-range--inline .time-range-field .time-picker,
.time-range.time-range--inline .time-range-field .time-range-input{
  flex: 1 1 auto;
}
.time-range.time-range--inline .time-picker .select-trigger{
  width: 100%;
  inline-size: 100%;
}

/* Row: label on the left, control on the right */
.time-range-field{
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 10px;
  width: 100%;
}

/* Label on the left, stable width for alignment */
.time-range-label{
  min-width: var(--trp-label-w, 35px);
  width: var(--trp-label-w, 35px);
  text-align: right;
  white-space: nowrap;
  font-weight: 600;
  opacity: .9;
}

/* The control takes all remaining space */
.time-range-field .time-picker,
.time-range-field .time-range-input{
  flex: 1 1 auto;
  min-width: 0; /* avoid overflows in grids/flex */
}

/* ---------- Custom picker (HH, MM, AM/PM) ---------- */

.time-picker{
  display: inline-flex;
  align-items: center;
  gap: 16px; /* visual space for ":" */
  width: 100%;
}

/* Inner selects remain fluid */
.time-picker .select{
  min-width: 0;
  flex: 1 1 0;
  width: auto;
}
.time-picker .select-trigger{
  width: 100%;
  inline-size: 100%;
  border-color: var(--border);
  background: linear-gradient(
    180deg,
    color-mix(in oklab, var(--soft) 85%, transparent) 0%,
    color-mix(in oklab, var(--soft) 60%, transparent) 100%
  );
  color: var(--fg);
}
.time-picker .select.open .select-menu{
  min-width: auto;
  background-color: color-mix(in oklab, var(--bg) 88%, transparent);
  border: 1px solid var(--border);
}

/* Compact variant */
.time-picker-compact .select-trigger{
  padding: 4px 8px;
  min-height: 32px;
}
.time-picker-compact .select-value{
  min-width: calc(var(--min-ch, 2) * 1ch);
  text-align: center;
}

/* HH and MM stretch, AM/PM stays compact */
.time-picker .select:nth-child(1),
.time-picker .select:nth-child(2){
  flex: 1 1 0;
}
.time-picker .select:last-child{
  flex: 0 0 auto;
}

/* ":" separator between HH and MM */
.time-picker > .select:first-child{ position: relative; }
.time-picker > .select:first-child::after{
  content: ":";
  position: absolute;
  right: -10px;
  top: 50%;
  transform: translateY(-50%);
  opacity: .9;
  pointer-events: none;
}

/* ---------- Natif <input type="time"> ---------- */

.time-range-input{
  width: 100%;
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 10px 12px;
  background-color: color-mix(in oklab, var(--soft) 80%, transparent);
  color: var(--fg);
  font-size: 13px;
  min-height: 36px;
  line-height: 1.2;
  transition: background-color .28s ease, border-color .28s ease, color .28s ease;
}
.time-range-input:focus{
  outline: 2px solid color-mix(in oklab, var(--accent) 45%, transparent);
}

/* Disabled */
.time-range.is-disabled,
.time-picker .is-disabled{
  opacity: .6;
  pointer-events: none;
}

/* Integration in .kv: fluid control */
.kv .time-range .time-picker,
.kv .time-range .time-range-input{
  flex: 1 1 auto;
  min-width: 0;
}

/* ---------- Responsive ---------- */
@media (max-width: 420px){
  /* Mobile: keep the label on the left (not above) */
  .time-range-field{
    flex-direction: row;
    align-items: center;
    gap: 8px;
  }
  .time-range-label{
    /* shrink the label and align it left */
    --trp-label-w: 64px;
    width: var(--trp-label-w);
    min-width: var(--trp-label-w);
    text-align: left;
  }
}
`,rV=`
.lg-tip{
  position: fixed; /* positioned via JS (viewport rect) */
  z-index: 2147483647; /* above the HUD */
  max-width: 320px;
  padding: 8px 10px;
  border-radius: 10px;

  background-color: color-mix(in oklab, var(--bg) 96%, transparent);
  color: var(--fg);
  border: 1px solid var(--border);
  box-shadow: 0 10px 30px color-mix(in oklab, var(--shadow) 45%, transparent);
  backdrop-filter: blur(var(--glass-blur));
  -webkit-backdrop-filter: blur(var(--glass-blur));

  font: 12.5px/1.25 var(--font-ui);
  pointer-events: none; /* non-interactive by default */
  opacity: 0;
  transform: translateY(2px);
  transition: opacity .16s ease, transform .16s ease,
              background-color .28s ease, color .28s ease, border-color .28s ease;
}

.lg-tip.is-open{ opacity: 1; transform: translateY(0); }

/* Arrow (small rotated square) */
.lg-tip::after{
  content: "";
  position: absolute;
  width: 9px; height: 9px;
  background: inherit;
  border: inherit;
  border-left: none; border-top: none;
  transform: rotate(45deg);
  box-shadow: 3px 3px 12px color-mix(in oklab, var(--shadow) 35%, transparent);
}

/* Placements (also handled in TS for coords) */
.lg-tip.is-top::after{
  bottom: -5px; left: 16px;
}
.lg-tip.is-bottom::after{
  top: -5px; left: 16px;
}
.lg-tip.is-left::after{
  right: -5px; top: 12px;
}
.lg-tip.is-right::after{
  left: -5px; top: 12px;
}

/* Accented variant (optional) */
.lg-tip--accent{
  border-color: color-mix(in oklab, var(--accent) 55%, var(--border));
}

@media (max-width: 480px){
  .lg-tip{ max-width: min(86vw, 320px); }
}
`,oV=`
.slider{ display:flex; flex-direction:column; gap:8px; width:100%; }
.slider-row{ display:flex; align-items:center; gap:10px; width:100%; }

/* Passive track */
.slider-track{
  position: relative;
  width: 100%;
  height: 6px;
  border-radius: 999px;
  background: color-mix(in oklab, var(--soft) 80%, transparent);
  border: 1px solid var(--border);
  box-shadow: inset 0 1px 2px color-mix(in oklab, var(--shadow) 30%, transparent);
  overflow: visible;          /* no thumb clipping */
  pointer-events: none;       /* never events on the track */
  z-index: 0;
}

/* Fill (passive) */
.slider-range{
  position: absolute; left: 0; top: 0; height: 100%;
  background: linear-gradient(90deg, var(--pill-from), var(--pill-to));
  pointer-events: none;
  z-index: 0;
  will-change: left, width;
}

/* Input range: only interactive element */
.slider input[type="range"]{
  -webkit-appearance: none; appearance: none;
  width: 100%;
  height: 16px;
  background: transparent; outline: none; margin: 0; padding: 0;
  cursor: pointer;
  position: absolute;
  left: 0; right: 0; top: 50%;
  transform: translateY(-50%);
  pointer-events: auto;
  z-index: 2;                  /* above track/fill */
  touch-action: none;          /* avoid scrolling during drag */
}

/* If handles are visually close, keep a bring-to-front */
.slider input[type="range"].is-active,
.slider:focus-within input[type="range"]:focus{
  z-index: 4;
}

/* WebKit thumb */
.slider input[type="range"]::-webkit-slider-thumb{
  -webkit-appearance: none;
  width: 18px; height: 18px; border-radius: 50%;
  background: var(--fg);
  box-shadow: 0 1px 3px color-mix(in oklab, var(--shadow) 40%, transparent);
  border: 2px solid var(--bg);
  margin-top: -6px;            /* center vs track (18 vs 6) */
  position: relative;
  z-index: 3;
  cursor: pointer;
}

/* Visual WebKit track (transparent) */
.slider input[type="range"]::-webkit-slider-runnable-track{
  height: 6px; background: transparent;
}

/* Firefox */
.slider input[type="range"]::-moz-range-thumb{
  width: 18px; height: 18px; border-radius: 50%;
  background: var(--fg);
  box-shadow: 0 1px 3px color-mix(in oklab, var(--shadow) 40%, transparent);
  border: 2px solid var(--bg);
  margin-top: -6px;
  position: relative;
  z-index: 3;
  cursor: pointer;
}
.slider input[type="range"]::-moz-range-track{
  height: 6px; background: transparent;
}

/* Labels/values */
.slider-label{ font-weight: 600; font-size: 13px; color: var(--text); }
.slider-value{ font-variant-numeric: tabular-nums; font-size: 14px; color: var(--text-dim); }
.slider-value-range{ display:flex; align-items:center; gap:6px; white-space:nowrap; }

.slider--range{ position:relative; }
.slider--range .slider-range{ pointer-events:none; }
.slider--range input[type="range"]{
  pointer-events:none;
}
.slider--range input[type="range"]::-webkit-slider-thumb{
  pointer-events:all;
}
.slider--range input[type="range"]::-moz-range-thumb{
  pointer-events:all;
}
.slider--range input[type="range"][data-handle="min"]{ z-index:3; }
.slider--range input[type="range"][data-handle="max"]{ z-index:4; }
.slider--range.is-disabled{ opacity:.55; }

@media (max-width: 480px){
  .slider{ gap:6px; }
  .slider-label{ font-size:12px; }
  .slider-value{ font-size:13px; }
  .slider input[type="range"]::-webkit-slider-thumb{ width:14px; height:14px; margin-top:-4px; }
  .slider input[type="range"]::-moz-range-thumb{ width:14px; height:14px; margin-top:-4px; }
}
`,iV=`
.reorderable-list{
  --rl-gap: 12px;
  --rl-item-radius: 14px;
  --rl-item-pad-y: 12px;
  --rl-item-pad-x: 16px;
  --rl-item-bg: color-mix(in oklab, var(--soft) 88%, transparent);
  --rl-item-border: color-mix(in oklab, var(--border) 78%, transparent);
  --rl-item-shadow: 0 6px 18px color-mix(in oklab, var(--shadow) 18%, transparent);
  --rl-tone-w: var(--card-accent-w, 3px);
  display:flex;
  flex-direction:column;
  gap: var(--rl-gap);
  min-width:0;
}

.reorderable-list[data-density="compact"]{
  --rl-gap: 8px;
  --rl-item-pad-y: 8px;
  --rl-item-pad-x: 14px;
  --rl-item-radius: 12px;
}

.reorderable-list[data-density="loose"]{
  --rl-gap: 16px;
  --rl-item-pad-y: 16px;
  --rl-item-pad-x: 20px;
  --rl-item-radius: 16px;
}

.reorderable-list[data-variant="surface"]{
  --rl-item-bg: color-mix(in oklab, var(--bg) 86%, transparent);
  --rl-item-border: color-mix(in oklab, var(--border) 70%, transparent);
}

.reorderable-list[data-variant="ghost"]{
  --rl-item-bg: color-mix(in oklab, var(--soft) 55%, transparent);
  --rl-item-border: color-mix(in oklab, var(--border) 60%, transparent);
  --rl-item-shadow: none;
}

.reorderable-track{
  display:flex;
  flex-direction:column;
  gap: var(--rl-gap);
  position:relative;
}

.reorderable-list.is-empty .reorderable-track{
  gap: 0;
}

.rl-empty{
  padding: var(--rl-item-pad-y) var(--rl-item-pad-x);
  border-radius: var(--rl-item-radius);
  border: 1px dashed color-mix(in oklab, var(--border) 80%, transparent);
  background: color-mix(in oklab, var(--soft) 70%, transparent);
  color: color-mix(in oklab, var(--fg) 70%, #94a3b8);
  font-size: 12px;
  text-align:center;
}

.rl-item{
  position:relative;
  display:flex;
  align-items:center;
  gap: 12px;
  padding: var(--rl-item-pad-y) var(--rl-item-pad-x);
  border-radius: var(--rl-item-radius);
  background: var(--rl-item-bg);
  border: 1px solid var(--rl-item-border);
  box-shadow: var(--rl-item-shadow);
  transition:
    transform .16s ease,
    box-shadow .2s ease,
    background .2s ease,
    border-color .2s ease,
    opacity .2s ease,
    filter .2s ease;
}

.reorderable-list:not(.is-reordering) .rl-item:hover{
  border-color: color-mix(in oklab, var(--accent) 35%, var(--rl-item-border));
  filter: brightness(1.03);
}

.reorderable-list[data-grab="item"] .rl-item{
  cursor: grab;
}

.rl-item.is-disabled{
  opacity: .55;
  cursor: default;
  box-shadow: none;
}

.rl-item.is-dragging{
  box-shadow:
    0 18px 32px color-mix(in oklab, var(--shadow) 38%, transparent),
    0 0 0 1px color-mix(in oklab, var(--accent) 32%, transparent);
  filter: brightness(1.05);
}

.reorderable-list.is-reordering .rl-item:not(.is-dragging){
  transition: transform .14s ease;
}

.rl-item::before{
  content:"";
  position:absolute;
  inset: 8px auto 8px 0;
  width: var(--rl-tone-w);
  border-radius: 999px;
  opacity: 0;
  transition: opacity .2s ease;
  background: transparent;
}

.rl-item[data-tone="accent"]::before{
  opacity: 1;
  background: color-mix(in oklab, var(--accent) 75%, transparent);
}

.rl-item[data-tone="info"]::before{
  opacity: 1;
  background: color-mix(in oklab, #38bdf8 70%, transparent);
}

.rl-item[data-tone="success"]::before{
  opacity: 1;
  background: color-mix(in oklab, #34d399 72%, transparent);
}

.rl-item[data-tone="warning"]::before{
  opacity: 1;
  background: color-mix(in oklab, #fbbf24 72%, transparent);
}

.rl-item[data-tone="danger"]::before{
  opacity: 1;
  background: color-mix(in oklab, #f87171 72%, transparent);
}

.rl-handle{
  inline-size: 32px;
  block-size: 32px;
  border-radius: 10px;
  border: 1px solid color-mix(in oklab, var(--border) 80%, transparent);
  background: color-mix(in oklab, var(--soft) 75%, transparent);
  color: var(--fg);
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:0;
  cursor: grab;
  transition:
    background .2s ease,
    border-color .2s ease,
    transform .16s ease,
    box-shadow .2s ease;
}

.rl-handle:focus-visible{
  outline: none;
  box-shadow:
    0 0 0 2px color-mix(in oklab, var(--accent) 45%, transparent),
    0 6px 16px color-mix(in oklab, var(--shadow) 26%, transparent);
}

.rl-handle:hover{
  border-color: color-mix(in oklab, var(--accent) 55%, var(--border));
}

.rl-handle:active{
  cursor: grabbing;
  transform: translateY(1px);
}

.rl-handle svg{
  width: 12px;
  height: 12px;
  fill: currentColor;
  opacity: .82;
}

.rl-body{
  display:flex;
  align-items:center;
  flex:1 1 auto;
  gap: 12px;
  min-width:0;
}

.rl-leading{
  width: 32px;
  height: 32px;
  border-radius: 10px;
  background: color-mix(in oklab, var(--soft) 58%, transparent);
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
  color: var(--fg);
  flex:0 0 auto;
}

.rl-leading img,
.rl-leading svg{
  max-width: 100%;
  max-height: 100%;
}

.rl-text{
  display:flex;
  flex-direction:column;
  gap:4px;
  min-width:0;
  flex:1 1 auto;
}

.rl-title{
  font-size: 14px;
  font-weight: 600;
  color: var(--fg);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.rl-subtitle{
  font-size: 12px;
  color: color-mix(in oklab, var(--fg) 70%, #94a3b8);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.rl-meta{
  margin-left: auto;
  font-size: 12px;
  color: color-mix(in oklab, var(--fg) 72%, #94a3b8);
  display:flex;
  align-items:center;
  gap:6px;
}

.rl-trailing{
  flex:0 0 auto;
  display:flex;
  align-items:center;
  gap:6px;
}

.rl-index{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  min-width: 24px;
  padding: 2px 6px;
  border-radius: 999px;
  font-size: 12px;
  font-weight: 600;
  color: color-mix(in oklab, var(--fg) 82%, #e2e8f0);
  background: color-mix(in oklab, var(--soft) 66%, transparent);
  flex:0 0 auto;
}

.rl-placeholder{
  border-style: dashed;
  border-width: 1px;
  border-color: color-mix(in oklab, var(--accent) 58%, var(--border));
  background: color-mix(in oklab, var(--accent) 22%, transparent);
  box-shadow: none;
  opacity: .65;
}

.reorderable-list[data-grab="item"] .rl-handle[aria-hidden="true"]{
  pointer-events:none;
  border-style: dotted;
  opacity:.65;
}

.reorderable-list[data-grab="item"] .rl-item:active{
  cursor: grabbing;
}
`,aV=`
@layer components {
  .color-picker{
    --cp-checkerboard: repeating-conic-gradient(#ebeef5 0 25%, transparent 0 50%) 0 0 / 12px 12px;
  }

  .color-picker__header{
    align-items:center;
    gap:12px;
  }

  .color-picker__preview{
    position:relative;
    inline-size:32px;
    block-size:32px;
    border-radius:10px;
    border:1px solid color-mix(in oklab, var(--border) 80%, transparent);
    background: color-mix(in oklab, var(--soft) 92%, transparent);
    padding:0;
    cursor:pointer;
    outline:none;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    transition:border-color .2s ease, box-shadow .2s ease, transform .12s ease;
  }
  .color-picker__preview::after{
    content:"";
    position:absolute;
    inset:0;
    border-radius:inherit;
    background: var(--cp-preview-color, transparent);
    box-shadow: inset 0 1px 2px color-mix(in oklab, #ffffff 70%, transparent);
  }
  .color-picker__preview:focus-visible{
    box-shadow:0 0 0 2px color-mix(in oklab, var(--accent) 45%, transparent);
  }
  .color-picker__preview:active{
    transform:scale(.97);
  }

  .color-picker__body{
    display:flex;
    flex-direction:column;
    gap:14px;
    padding:0;
  }

  .color-picker__main{
    display:flex;
    gap:12px;
    align-items:stretch;
  }

  .color-picker__palette{
    position:relative;
    flex:1 1 auto;
    min-inline-size:0;
    border-radius:12px;
    background:
      linear-gradient(0deg, rgba(0,0,0,1) 0%, rgba(0,0,0,0) 100%),
      linear-gradient(90deg, #fff 0%, var(--cp-palette-hue, #ff0000) 100%);
    box-shadow:inset 0 1px 3px color-mix(in oklab, #000 12%, transparent);
    cursor:crosshair;
    aspect-ratio: 4 / 3;
    overflow:hidden;
    touch-action:none;
  }

  .color-picker__palette-cursor{
    position:absolute;
    width:12px;
    height:12px;
    border-radius:999px;
    border:2px solid #fff;
    box-shadow:0 1px 4px #0004, inset 0 0 2px #0002;
    pointer-events:none;
    transform:translate(-50%, -50%);
  }

  .color-picker__alpha{
    position:relative;
    flex:0 0 18px;
    border-radius:12px;
    background: color-mix(in oklab, var(--soft) 92%, transparent);
    overflow:hidden;
    cursor:pointer;
    touch-action:none;
  }
  .color-picker__alpha::after{
    content:"";
    position:absolute;
    inset:0;
    background: var(--cp-alpha-gradient, linear-gradient(180deg, rgba(255,0,0,1) 0%, rgba(255,0,0,0) 100%));
    z-index:0;
  }
  .color-picker__alpha-thumb{
    position:absolute;
    left:2px;
    right:2px;
    height:6px;
    border-radius:6px;
    border:1px solid color-mix(in oklab, #000 18%, transparent);
    box-shadow:0 1px 3px #0004;
    transform:translateY(-50%);
    background:#fff;
    opacity:1;
    pointer-events:none;
    z-index:1;
  }

  .color-picker__hue{
    position:relative;
    block-size:16px;
    border-radius:999px;
    background: linear-gradient(
      90deg,
      #ff0000 0%,
      #ffff00 16.6%,
      #00ff00 33.3%,
      #00ffff 50%,
      #0000ff 66.6%,
      #ff00ff 83.3%,
      #ff0000 100%
    );
    box-shadow:inset 0 1px 3px color-mix(in oklab, #000 12%, transparent);
    cursor:pointer;
    touch-action:none;
  }
  .color-picker__hue-thumb{
    position:absolute;
    top:2px;
    bottom:2px;
    width:6px;
    border-radius:6px;
    border:1px solid color-mix(in oklab, #000 16%, transparent);
    box-shadow:0 1px 3px #0003;
    transform:translateX(-50%);
    pointer-events:none;
    background: color-mix(in oklab, #ffffff 88%, transparent);
    z-index:1;
  }

  .color-picker__hex-row{
    display:flex;
    align-items:center;
    gap:8px;
    justify-content:flex-start;
  }

  .color-picker__hex-wrap{
    flex:1 1 auto;
    min-inline-size:0;
    gap:6px;
  }

  .color-picker__hex-wrap .input{
    flex:1 1 auto;
    min-inline-size:0;
  }

  .color-picker__mode-btn{
    flex:0 0 auto;
    border:1px solid var(--border);
    border-radius:10px;
    padding:8px 12px;
    min-width:62px;
    background: color-mix(in oklab, var(--soft) 90%, transparent);
    color:var(--fg);
    font:600 11px/1 var(--font-ui, system-ui);
    letter-spacing:.6px;
    text-transform:uppercase;
    cursor:pointer;
    transition:border-color .2s ease, background .2s ease, box-shadow .2s ease, color .2s ease;
  }
  .color-picker__mode-btn:hover{
    border-color: color-mix(in oklab, var(--accent) 40%, var(--border));
    background: color-mix(in oklab, var(--soft) 70%, transparent);
  }
  .color-picker__mode-btn:focus-visible{
    outline:none;
    box-shadow:0 0 0 2px color-mix(in oklab, var(--accent) 45%, transparent);
  }
  .color-picker__mode-btn.is-alt{
    background: color-mix(in oklab, var(--accent) 24%, transparent);
    color: color-mix(in oklab, var(--fg) 96%, var(--accent));
    border-color: color-mix(in oklab, var(--accent) 45%, var(--border));
  }

  .color-picker__hex-input{
    flex:1 1 auto;
    min-inline-size:0;
    border:1px solid var(--border);
    border-radius:12px;
    padding:10px 12px;
    background: color-mix(in oklab, var(--soft) 82%, transparent);
    color:var(--fg);
    font:600 13px/1.2 var(--font-ui, system-ui);
    letter-spacing:.4px;
    text-transform:uppercase;
    outline:none;
    transition:border-color .2s ease, box-shadow .2s ease;
  }
  .color-picker__hex-input:focus{
    border-color: color-mix(in oklab, var(--accent) 55%, var(--border));
    box-shadow:0 0 0 2px color-mix(in oklab, var(--accent) 40%, transparent);
  }

  .color-picker__native{
    display:none;
  }

  .color-picker--mobile .card{
    padding:12px;
  }
  .color-picker--mobile .card-collapse{
    display:none !important;
  }
  .color-picker--mobile .color-picker__preview{
    pointer-events:auto;
  }
}
`,sV=`
@layer components {
  .log{
    display:block;
    border:1px solid var(--border);
    border-radius:12px;
    background: color-mix(in oklab, var(--soft) 80%, transparent);
    color: var(--fg);
    box-shadow: 0 8px 20px color-mix(in oklab, var(--shadow) 35%, transparent);
    transition: background-color .28s ease, color .28s ease, border-color .28s ease, box-shadow .28s ease;
    overflow: hidden;
    min-height: 120px;
  }

  .log-viewport{
    block-size: 100%;
    max-block-size: 100%;
    overflow: auto;
    padding: 10px 12px 14px; /* extra bottom padding to avoid last-line clipping */
    background: color-mix(in oklab, var(--bg) 88%, transparent);
    scrollbar-gutter: stable;
  }
  .log-viewport::-webkit-scrollbar{ width:10px; height:10px; }
  .log-viewport::-webkit-scrollbar-thumb{ background:var(--muted); border-radius:8px; }

  .log-lines{ display:block; font: 12px/1.45 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; white-space: pre; }
  .log--wrap .log-lines{ white-space: pre-wrap; word-break: break-word; }
  .log-lines::after{ content: ""; display:block; height: 6px; }

  /* Groups */
  .log-group{ border:1px solid color-mix(in oklab, var(--border) 70%, transparent); border-radius:10px; margin:8px 0; overflow:hidden; background: color-mix(in oklab, var(--soft) 80%, transparent); }
  .log-group-header{
    display:flex; align-items:center; gap:8px;
    padding:6px 10px; cursor:pointer; user-select:none;
    background: color-mix(in oklab, var(--soft) 85%, transparent);
    color: var(--fg);
    position:relative;
  }
  .log-group-header::before{
    content: '▾';
    display:inline-block; width:1em; text-align:center; opacity:.9;
    transform-origin:center; transition: transform .18s ease;
  }
  .log-group.is-collapsed .log-group-header::before{ transform: rotate(-90deg); }
  .log-group-body{ padding:6px 8px; }
  .log-group.is-collapsed .log-group-body{ display:none; }

  .log-line{
    display:grid;
    grid-template-columns: auto 1fr;
    gap: 10px;
    align-items: start;
    padding-block: 2px;
    border-left: 3px solid transparent;
  }

  .log-time{
    opacity:.7;
    color: color-mix(in oklab, var(--fg) 75%, #9ca3af);
    font-variant-numeric: tabular-nums; 
    user-select: none;
    min-inline-size: 64px;
  }

  .log-text{ color: var(--fg); }

  /* Level accents */
  .log-level--debug{ border-left-color: color-mix(in oklab, #64748b 70%, var(--border)); }
  .log-level--info { border-left-color: color-mix(in oklab, #3b82f6 70%, var(--border)); }
  .log-level--warn { border-left-color: color-mix(in oklab, #f59e0b 80%, var(--border)); }
  .log-level--error{ border-left-color: color-mix(in oklab, #ef4444 80%, var(--border)); }

  /* Syntax tokens */
  .tok{ font: inherit; }
  .tok-kw{   color: color-mix(in oklab, var(--accent) 75%, var(--fg)); font-weight: 600; }
  .tok-str{  color: color-mix(in oklab, #22c55e 78%, var(--fg)); }
  .tok-num{  color: color-mix(in oklab, #a78bfa 78%, var(--fg)); }
  .tok-comm{ color: color-mix(in oklab, var(--fg) 65%, #9ca3af); font-style: italic; }
  .tok-lit{  color: color-mix(in oklab, #f472b6 78%, var(--fg)); }
}
`,lV=`
.sg-root {
  display: inline-flex;
  align-items: center;
  width: auto;
}

.sg-container {
  position: relative;
  display: flex;
  align-items: center;
  gap: 0;

  padding: 4px;
  background-color: var(--soft);
  border: 1px solid var(--border);
  border-radius: 10px;

  transition: background-color 0.15s ease, border-color 0.15s ease;
}

/* Animated indicator background */
.sg-indicator {
  position: absolute;
  top: 4px;
  left: 0;
  height: calc(100% - 8px);
  border-radius: 8px;
  width: 70px;

  background: linear-gradient(
    135deg,
    color-mix(in oklab, var(--accent) 35%, transparent) 0%,
    color-mix(in oklab, var(--accent) 50%, transparent) 100%
  );

  box-shadow: inset 0 1px 2px color-mix(in oklab, var(--accent) 20%, transparent);

  transition: transform 0.25s cubic-bezier(0.2, 0.8, 0.2, 1),
              width 0.25s cubic-bezier(0.2, 0.8, 0.2, 1);

  pointer-events: none;
  z-index: 0;
  will-change: transform, width;
}

/* Individual segment buttons */
.sg-btn {
  position: relative;
  z-index: 1;

  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;

  padding: 7px 16px;
  min-height: 32px;
  min-width: 70px;

  background: transparent;
  border: none;
  border-radius: 7px;
  cursor: pointer;

  color: var(--fg);
  font-size: 13px;
  font-weight: 500;
  letter-spacing: 0px;
  line-height: 1.2;
  white-space: nowrap;

  transition: color 0.15s ease;
  appearance: none;
  -webkit-tap-highlight-color: transparent;
}

.sg-btn:hover:not(:disabled):not(.active) {
  color: var(--accent);
}

.sg-btn.active {
  color: var(--tab-fg);
  font-weight: 600;
}

.sg-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  color: var(--muted);
}

.sg-btn:focus-visible {
  outline: none;
  box-shadow: inset 0 0 0 2px color-mix(in oklab, var(--accent) 45%, transparent);
}

/* Icon styling */
.sg-icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  line-height: 0;
  font-size: 16px;
}

/* Label styling */
.sg-label {
  display: inline-flex;
  align-items: center;
  line-height: 1;
}

/* Size variations */
.sg--sm .sg-btn {
  padding: 5px 12px;
  min-height: 28px;
  font-size: 12px;
  min-width: 60px;
}

.sg--sm .sg-container {
  padding: 3px;
}

.sg--sm .sg-indicator {
  top: 3px;
  height: calc(100% - 6px);
}

.sg--lg .sg-btn {
  padding: 9px 18px;
  min-height: 36px;
  font-size: 14px;
  gap: 8px;
  min-width: 80px;
}

.sg--lg .sg-container {
  padding: 4px;
}

.sg--lg .sg-indicator {
  top: 4px;
  height: calc(100% - 8px);
}

/* Full width mode */
.sg-root[style*="width: 100%"] .sg-btn {
  flex: 1;
  min-width: 0;
}

/* Icon-only mode (when label is hidden via CSS class) */
.sg-btn.sg--icon-only {
  min-width: 40px;
  padding: 8px;
}

.sg--sm .sg-btn.sg--icon-only {
  min-width: 36px;
  padding: 6px;
}

.sg--lg .sg-btn.sg--icon-only {
  min-width: 44px;
  padding: 10px;
}

/* Hover state on container */
.sg-container:hover {
  border-color: color-mix(in oklab, var(--accent) 25%, var(--border));
}

/* Responsive: stack on very small screens if needed */
@media (max-width: 360px) {
  .sg-btn {
    padding: 6px 10px;
    min-height: 32px;
    font-size: 12px;
  }

  .sg-container {
    padding: 3px;
  }

  .sg-icon {
    font-size: 14px;
  }
}
`,cV=`
.sound-picker{
  display:flex;
  flex-direction:column;
  gap:0px;
  min-width:0;
}

.sound-picker__header{
  display:flex;
  flex-direction:column;
  gap:4px;
}

.sound-picker__label{
  font-size:13px;
  font-weight:600;
  color: var(--fg);
}

.sound-picker__hint{
  font-size:12px;
  color: color-mix(in oklab, var(--fg) 70%, #9ca3af);
}

.sound-picker__zone{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  margin-top:12px;
  padding:16px;
  min-height:72px;
  border-radius:16px;
  border:1px dashed color-mix(in oklab, var(--border) 80%, transparent);
  background: color-mix(in oklab, var(--soft) 70%, transparent);
  transition: border-color .2s ease, background .2s ease, box-shadow .2s ease, transform .08s ease;
  cursor:pointer;
}

.sound-picker__zone:focus-visible{
  outline: none;
  box-shadow:
    0 0 0 2px color-mix(in oklab, var(--accent) 40%, transparent),
    0 8px 20px color-mix(in oklab, var(--shadow) 22%, transparent);
}

.sound-picker__zone:hover{
  border-color: color-mix(in oklab, var(--accent) 45%, var(--border));
}

.sound-picker__zone.is-dragover{
  border-color: color-mix(in oklab, var(--accent) 70%, var(--border));
  background: color-mix(in oklab, var(--accent) 10%, var(--soft));
  box-shadow: 0 12px 26px color-mix(in oklab, var(--shadow) 25%, transparent);
  transform: translateY(-1px);
}

.sound-picker.is-disabled .sound-picker__zone{
  opacity:.6;
  cursor:not-allowed;
}

.sound-picker__zone-text{
  display:flex;
  flex-direction:column;
  gap:4px;
  min-width:0;
}

.sound-picker__zone-title{
  font-size:13px;
  font-weight:600;
  color: var(--fg);
}

.sound-picker__zone-subtitle{
  font-size:12px;
  color: color-mix(in oklab, var(--fg) 70%, #9ca3af);
}

.sound-picker__pick{
  flex:0 0 auto;
  min-height:44px;
}

.sound-picker__input{
  display:none;
}

.sound-picker__status{
  min-height:16px;
  font-size:12px;
  color: color-mix(in oklab, var(--fg) 70%, #9ca3af);
}

.sound-picker__status.is-error{
  color: color-mix(in oklab, #f87171 75%, var(--fg));
}

.sound-picker__list{
  --sp-gap: 8px;
  --sp-row-h: 44px;
  display:flex;
  flex-direction:column;
  gap: var(--sp-gap);
}

.sound-picker__list.is-scrollable{
  max-height: calc((var(--sp-row-h) * 3) + (var(--sp-gap) * 2));
  overflow-y: auto;
  padding-right: 4px;
  scrollbar-gutter: stable;
}

.sound-picker__list.is-scrollable::-webkit-scrollbar {
  width: 10px;
}
.sound-picker__list.is-scrollable::-webkit-scrollbar-track {
  background: transparent;
}
.sound-picker__list.is-scrollable::-webkit-scrollbar-thumb {
  background: var(--muted);
  border-radius: 8px;
}
.sound-picker__list.is-scrollable::-webkit-scrollbar-thumb:hover {
  background: color-mix(in oklab, var(--muted) 150%, transparent);
}

.sound-picker__empty{
  padding:10px 12px;
  border-radius:12px;
  border:1px dashed color-mix(in oklab, var(--border) 80%, transparent);
  background: color-mix(in oklab, var(--soft) 70%, transparent);
  color: color-mix(in oklab, var(--fg) 70%, #94a3b8);
  font-size:12px;
  text-align:center;
}

.sound-picker__item{
  display:flex;
  flex-direction:column;
  align-items:stretch;
  justify-content:center;
  gap:6px;
  padding:6px 10px;
  border-radius:12px;
  border:1px solid color-mix(in oklab, var(--border) 75%, transparent);
  background: color-mix(in oklab, var(--soft) 72%, transparent);
  min-height: var(--sp-row-h);
  min-width:0;
}

.sound-picker__item-top{
  display:grid;
  grid-template-columns: minmax(0, 1fr) auto;
  align-items:center;
  column-gap:10px;
  min-width:0;
  width:100%;
}

.sound-picker__item.is-playing{
  border-color: color-mix(in oklab, var(--accent) 45%, var(--border));
  box-shadow: 0 10px 22px color-mix(in oklab, var(--shadow) 18%, transparent);
}

.sound-picker__item-name{
  display:block;
  min-width:0;
  overflow:hidden;
}

.sound-picker__item-label{
  font-size:13px;
  font-weight:600;
  color: var(--fg);
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
  line-height:1.2;
  display:block;
}

.sound-picker__rename{
  flex:1 1 auto;
  min-width:0;
}

.sound-picker__item-actions{
  display:flex;
  align-items:center;
  gap:6px;
  flex-wrap: nowrap;
  flex:0 0 auto;
  white-space:nowrap;
  justify-self:end;
}

.sound-picker__item-btn{
  appearance:none;
  border:1px solid color-mix(in oklab, var(--border) 70%, transparent);
  background: color-mix(in oklab, var(--soft) 78%, transparent);
  color: var(--fg);
  border-radius:10px;
  min-height:32px;
  padding:0 8px;
  font-size:11.5px;
  font-weight:600;
  cursor:pointer;
  transition: border-color .2s ease, background .2s ease, transform .05s ease;
}

.sound-picker__item-btn--play{
  min-width:48px;
  text-align:center;
}

.sound-picker__item-btn:hover{
  border-color: color-mix(in oklab, var(--accent) 45%, var(--border));
}

.sound-picker__item-btn:active{
  transform: translateY(1px);
}

.sound-picker__item-btn:disabled{
  opacity:.6;
  cursor:not-allowed;
}

.sound-picker__item-btn--danger{
  border-color: color-mix(in oklab, #f87171 45%, var(--border));
  background: color-mix(in oklab, #f87171 18%, var(--soft));
}

.sound-picker__item-btn--danger:hover{
  border-color: color-mix(in oklab, #f87171 70%, var(--border));
}

@media (max-width: 560px){
  .sound-picker__zone{
    flex-direction:column;
    align-items:stretch;
  }
  .sound-picker__pick{
    width:100%;
  }
  .sound-picker__item-btn{
    min-height:44px;
    padding:0 12px;
    font-size:12px;
  }
}
`,dV=`
@layer settings-section {
  /* Theme color picker grid */
  .settings-theme-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 16px;
  }

  @media (max-width: 640px) {
    .settings-theme-grid {
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
    }
  }

  @media (max-width: 480px) {
    .settings-theme-grid {
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
    }
  }

  .settings-theme-row {
    margin-bottom: 16px;
  }

  .settings-color-row {
    display: flex;
    flex-direction: column;
    width: 100%;
  }

  .settings-color-block {
    display: flex;
    flex-direction: column;
    gap: 8px;
    align-items: stretch;
    width: 100%;
  }
}
`,uV={all:"initial",position:"fixed",top:"0",right:"0",zIndex:"2147483647",pointerEvents:"auto",fontFamily:'system-ui, -apple-system, "Segoe UI", Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif',fontSize:"13px",lineHeight:"1.35"};function pV(e="gemini-root"){const t=document.createElement("div");t.id=e,Object.assign(t.style,uV),(document.body||document.documentElement).appendChild(t);const n=t.attachShadow({mode:"open"});return {host:t,shadow:n}}function fV(){return new Promise(e=>{typeof requestIdleCallback<"u"?requestIdleCallback(()=>e(),{timeout:16}):setTimeout(e,0);})}async function hV(e){const{hostId:t="gemini-hud-root",initialWidth:n,initialOpen:r,onWidthChange:o,onOpenChange:i,themes:a,initialTheme:s,onThemeChange:l,buildSections:c,initialTab:d,onTabChange:u,toggleCombo:f=ae=>ae.ctrlKey&&ae.shiftKey&&ae.key.toLowerCase()==="u",closeOnEscape:g=true,minWidth:h=420,maxWidth:y=720}=e,{host:S,shadow:C}=pV(t),_=[[zW,"variables"],[UW,"primitives"],[HW,"utilities"],[GW,"hud"],[WW,"card"],[cv,"badge"],[VW,"button"],[ZW,"checkbox"],[qW,"input"],[KW,"label"],[XW,"navTabs"],[YW,"searchBar"],[JW,"select"],[QW,"switch"],[eV,"table"],[tV,"teamListItem"],[nV,"timeRangePicker"],[rV,"tooltip"],[oV,"slider"],[iV,"reorderableList"],[aV,"colorPicker"],[sV,"log"],[lV,"segmentedControl"],[cV,"soundPicker"],[dV,"settings"],[ZE,"teamCard"],[r_,"autoFavoriteSettings"]];for(let ae=0;ae<_.length;ae++){const[le,we]=_[ae];wt(C,le,we),ae%5===4&&await fV();}const{panel:E,tabbar:P,content:O,resizer:k,closeButton:I,wrapper:R}=FW({shadow:C,initialOpen:r});function A(ae){E.dispatchEvent(new CustomEvent("gemini:hud-open-change",{detail:{isOpen:ae},bubbles:true})),i?.(ae);}function L(ae){const le=E.classList.contains("open");E.classList.toggle("open",ae),E.setAttribute("aria-hidden",ae?"false":"true"),ae!==le&&A(ae);}L(r),I.addEventListener("click",ae=>{ae.preventDefault(),ae.stopPropagation(),L(false);});const F=wT({host:S,themes:a,initialTheme:s,onThemeChange:l}),G=BW({resizer:k,host:S,shadow:C,onWidthChange:o||(()=>{}),initialWidth:n,minWidth:h,maxWidth:y});G.setHudWidth(n);const q=c({applyTheme:F.applyTheme,initialTheme:s,getCurrentTheme:F.getCurrentTheme,setHUDWidth:G.setHudWidth,setHUDOpen:L}),H=new CA(q,O,{applyTheme:F.applyTheme,getCurrentTheme:F.getCurrentTheme}),ce=q.map(ae=>({id:ae.id,label:ae.label})),W=d&&q.some(ae=>ae.id===d)?d:ce[0]?.id||"",te=xA(ce,W,ae=>{H.activate(ae),u?.(ae);});te.root.style.flex="1 1 auto",te.root.style.minWidth="0",P.append(te.root,I);const ne={"tab-auto-favorite":"autoFavorite","tab-pets":"pets","tab-shop-restock":"shopRestock","tab-locker":"locker","tab-trackers":"trackers","tab-alerts":"alerts","tab-avatar":"avatar","tab-room":"room"};function ie(){const ae=Xe(lt.CONFIG,{autoFavorite:{enabled:true},pets:{enabled:true},shopRestock:{enabled:true},locker:{enabled:true},trackers:{enabled:true},alerts:{enabled:true},avatar:{enabled:true},room:{enabled:true}});for(const[le,we]of Object.entries(ne))ae[we]?.enabled??true?te.showTab(le):te.hideTab(le);}function ee(ae){const{key:le}=ae.detail;(le===lt.CONFIG||le==="feature:config")&&ie();}window.addEventListener(Me.STORAGE_CHANGE,ee),ie();let U=W;if(!te.isTabVisible(W)){const ae=te.getVisibleTabs();ae.length>0&&(U=ae[0]);}U&&H.activate(U);const X=jW({panel:E,onToggle:()=>L(!E.classList.contains("open")),onClose:()=>L(false),toggleCombo:f,closeOnEscape:g}),D=()=>{te.recalc();const ae=parseInt(getComputedStyle(S).getPropertyValue("--w"))||n;G.calculateResponsiveBounds(),G.setHudWidth(ae);};ge.addEventListener("resize",D);const j=ae=>{const le=ae.detail?.width;le?G.setHudWidth(le):G.setHudWidth(n),te.recalc();};S.addEventListener("gemini:layout-resize",j);function Q(){window.removeEventListener(Me.STORAGE_CHANGE,ee),X.destroy(),G.destroy(),ge.removeEventListener("resize",D),S.removeEventListener("gemini:layout-resize",j);}return {host:S,shadow:C,wrapper:R,panel:E,content:O,setOpen:L,setWidth:G.setHudWidth,sections:q,manager:H,nav:te,destroy:Q}}const ya={isOpen:"gemini.hud.isOpen",width:"gemini.hud.width",theme:"gemini.hud.theme",activeTab:"gemini.hud.activeTab"},nl={isOpen:false,width:480,theme:"dark",activeTab:"tab-settings"};function gV(){return {isOpen:Xe(ya.isOpen,nl.isOpen),width:Xe(ya.width,nl.width),theme:Xe(ya.theme,nl.theme),activeTab:Xe(ya.activeTab,nl.activeTab)}}function Nd(e,t){Ye(ya[e],t);}function mV(e,t){return Xe(ya[e],t)}const bV="https://i.imgur.com/IMkhMur.png",vV="Stats";function yV(e){let t=e.iconUrl||bV;const n=e.ariaLabel||"Open MGH";let r=null,o=null,i=null,a=false,s=null,l=null;const c=["Chat","Leaderboard","Stats","Open Activity Log"],d=O=>{try{return typeof CSS<"u"&&CSS&&typeof CSS.escape=="function"?CSS.escape(O):O.replace(/"/g,'\\"')}catch{return O}};function u(){const O=document.querySelector(c.map(I=>`button[aria-label="${d(I)}"]`).join(","));if(!O)return null;let k=O.parentElement;for(;k&&k!==document.body;){if(c.reduce((R,A)=>R+k.querySelectorAll(`button[aria-label="${d(A)}"]`).length,0)>=2)return k;k=k.parentElement;}return null}function g(O){const k=Array.from(O.querySelectorAll("button[aria-label]"));if(!k.length)return {refBtn:null,refWrapper:null};const I=k.filter(H=>H.dataset.mghBtn!=="true"&&(H.getAttribute("aria-label")||"")!==(e.ariaLabel||"Open MGH")),R=I.length?I:k,A=R.find(H=>(H.getAttribute("aria-label")||"").toLowerCase()===vV.toLowerCase())||null,L=R.length>=2?R.length-2:R.length-1,F=A||R[L],G=F.parentElement,q=G&&G.parentElement===O&&G.tagName==="DIV"?G:null;return {refBtn:F,refWrapper:q}}function h(O,k,I){const R=O.cloneNode(false);R.type="button",R.setAttribute("aria-label",k),R.title=k,R.dataset.mghBtn="true",R.style.pointerEvents="auto",R.removeAttribute("id");const A=document.createElement("img");return A.src=I,A.alt="MGH",A.style.pointerEvents="none",A.style.userSelect="none",A.style.width="76%",A.style.height="76%",A.style.objectFit="contain",A.style.display="block",A.style.margin="auto",R.appendChild(A),R.addEventListener("click",L=>{L.preventDefault(),L.stopPropagation();try{e.onClick?.();}catch{}}),R}function y(){if(a)return  false;a=true;let O=false;try{const k=u();if(!k)return !1;s!==k&&(s=k);const{refBtn:I,refWrapper:R}=g(k);if(!I)return !1;o=k.querySelector('div[data-mgh-wrapper="true"]'),!o&&R&&(o=R.cloneNode(!1),o.dataset.mghWrapper="true",o.removeAttribute("id"),O=!0);const A=o?.querySelector('button[data-mgh-btn="true"]')||null;r||(r=A),r||(r=h(I,n,t),o?o.appendChild(r):r.parentElement!==k&&k.appendChild(r),O=!0),o&&o.parentElement!==k&&(k.appendChild(o),O=!0);const L=k;if(L&&L!==l){try{E.disconnect();}catch{}l=L,E.observe(l,{childList:!0,subtree:!0});}return O}finally{a=false;}}const S=document.getElementById("App")||document.body;let C=null,_=false;const E=new MutationObserver(()=>{_&&r&&document.contains(r)||(r&&!document.contains(r)&&(console.warn("[ToolbarButton] Button was removed from DOM, will retry"),_=false,r=null,o=null),C===null&&(C=window.setTimeout(()=>{if(C=null,y()&&r&&document.contains(r)&&(_=true,console.log("[ToolbarButton] Successfully mounted (via observer)"),o)){const k=o.parentElement;k&&k.lastElementChild!==o&&k.appendChild(o);}},100)));});return y()&&r&&document.contains(r)?(_=true,console.log("[ToolbarButton] Successfully mounted (initial)")):console.log("[ToolbarButton] Initial mount failed, will retry via observer"),E.observe(S,{childList:true,subtree:true}),i=()=>E.disconnect(),()=>{try{i?.();}catch{}try{o?.remove();}catch{}}}const S1=[];function wV(){return S1.slice()}function ix(e){S1.push(e);}function xV(e){if(e!=null){if(typeof e=="object"){const t=e;if(typeof t.type=="string")return t.type;if(typeof t.Type=="string")return t.Type;if(typeof t.kind=="string")return t.kind;if(typeof t.messageType=="string")return t.messageType}if(Array.isArray(e)&&typeof e[0]=="string")return e[0]}}function CV(e){if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}const Dh=Symbol.for("ariesmod.ws.handlers.patched");function tn(e,t){if(typeof e=="string"){const o=e,i={match:a=>a.kind==="message"&&a.type===o,handle:t};return ix(i),i}const n=e,r={match:o=>o.kind==="close"&&o.code===n,handle:t};return ix(r),r}function SV(e,t=wV(),n={}){const r=n.pageWindow??window,o=!!n.debug;if(e[Dh])return ()=>{};e[Dh]=true;const i={ws:e,pageWindow:r,debug:o},a=u=>{for(const f of t)try{if(!f.match(u))continue;if(f.handle(u,i)===!0)return}catch(g){o&&console.error("[WS] handler error",g,u);}},s=u=>{const f=CV(u.data),g=xV(f);a({kind:"message",raw:u.data,data:f,type:g});},l=u=>{a({kind:"close",code:u.code,reason:u.reason,wasClean:u.wasClean,event:u});},c=u=>a({kind:"open",event:u}),d=u=>a({kind:"error",event:u});return e.addEventListener("message",s),e.addEventListener("close",l),e.addEventListener("open",c),e.addEventListener("error",d),()=>{try{e.removeEventListener("message",s);}catch{}try{e.removeEventListener("close",l);}catch{}try{e.removeEventListener("open",c);}catch{}try{e.removeEventListener("error",d);}catch{}try{delete e[Dh];}catch{}}}(function(){try{const t=({ url: (_documentCurrentScript && _documentCurrentScript.tagName.toUpperCase() === 'SCRIPT' && _documentCurrentScript.src || new URL('__entry.js', document.baseURI).href) }),n=t.glob?.("./**/*.ts",{eager:!0})??t.glob?.("./**/*.js",{eager:!0});if(!n)return}catch{}})();tn(hr.AuthenticationFailure,(e,t)=>{t.debug&&console.log("[WS][Close] Auth failure",e.code,e.reason);});tn(hr.ConnectionSuperseded,(e,t)=>{t.debug&&console.log("[WS][Close] Superseded",e.code,e.reason);});tn(hr.HeartbeatExpired,(e,t)=>{t.debug&&console.log("[WS][Close] Heartbeat expired",e.code,e.reason);});tn(hr.PlayerKicked,(e,t)=>{t.debug&&console.log("[WS][Close] Player kicked",e.code,e.reason);});tn(hr.PlayerLeftVoluntarily,(e,t)=>{t.debug&&console.log("[WS][Close] Player left voluntarily",e.code,e.reason);});tn(hr.ReconnectInitiated,(e,t)=>{t.debug&&console.log("[WS][Close] Reconnect initiated",e.code,e.reason);});tn(hr.ServerDisposed,(e,t)=>{t.debug&&console.log("[WS][Close] Server disposed",e.code,e.reason);});tn(hr.UserSessionSuperseded,(e,t)=>{t.debug&&console.log("[WS][Close] User session superseded",e.code,e.reason);});tn(hr.VersionExpired,(e,t)=>{t.debug&&console.log("[WS][Close] Version expired",e.code,e.reason);});tn(hr.VersionMismatch,(e,t)=>{t.debug&&console.log("[WS][Close] Version mismatch",e.code,e.reason);});tn(uo.Config,(e,t)=>{t.debug&&console.log("[WS][STC] Config",e.data);});tn(uo.CurrencyTransaction,(e,t)=>{t.debug&&console.log("[WS][STC] CurrencyTransaction",e.data);});tn(uo.Emote,(e,t)=>{t.debug&&console.log("[WS][STC] Emote",e.data);});tn(uo.InappropriateContentRejected,(e,t)=>{t.debug&&console.log("[WS][STC] InappropriateContentRejected",e.data);});tn(uo.PartialState,(e,t)=>{t.debug&&console.log("[WS][STC] PartialState",e.data);});tn(uo.Pong,(e,t)=>{t.debug&&console.log("[WS][STC] Pong",e.data);});tn(uo.ServerErrorMessage,(e,t)=>{t.debug&&console.log("[WS][STC] ServerErrorMessage",e.data);});tn(uo.Welcome,(e,t)=>{t.debug&&console.log("[WS][STC] Welcome",e.data);});Fe(be.PlantSeed,(e,t)=>(t.debug&&console.log("[MW][Garden] PlantSeed"),true));Fe(be.WaterPlant,(e,t)=>(t.debug&&console.log("[MW][Garden] WaterPlant"),true));Fe(be.HarvestCrop,(e,t)=>(t.debug&&console.log("[MW][Garden] HarvestCrop"),true));Fe(be.SellAllCrops,(e,t)=>(t.debug&&console.log("[MW][Garden] SellAllCrops"),true));Fe(be.PurchaseSeed,(e,t)=>(t.debug&&console.log("[MW][Garden] PurchaseSeed"),true));Fe(be.PurchaseEgg,(e,t)=>(t.debug&&console.log("[MW][Garden] PurchaseEgg"),true));Fe(be.PurchaseTool,(e,t)=>(t.debug&&console.log("[MW][Garden] PurchaseTool"),true));Fe(be.PurchaseDecor,(e,t)=>(t.debug&&console.log("[MW][Garden] PurchaseDecor"),true));Fe(be.PlantEgg,(e,t)=>(t.debug&&console.log("[MW][Garden] PlantEgg"),true));Fe(be.HatchEgg,(e,t)=>(t.debug&&console.log("[MW][Garden] HatchEgg"),true));Fe(be.PlantGardenPlant,(e,t)=>(t.debug&&console.log("[MW][Garden] PlantGardenPlant"),true));Fe(be.PotPlant,(e,t)=>(t.debug&&console.log("[MW][Garden] PotPlant"),true));Fe(be.MutationPotion,(e,t)=>(t.debug&&console.log("[MW][Garden] MutationPotion"),true));Fe(be.PickupDecor,(e,t)=>(t.debug&&console.log("[MW][Garden] PickupDecor"),true));Fe(be.PlaceDecor,(e,t)=>(t.debug&&console.log("[MW][Garden] PlaceDecor"),true));Fe(be.RemoveGardenObject,(e,t)=>(t.debug&&console.log("[MW][Garden] RemoveGardenObject"),true));Fe(be.MoveInventoryItem,(e,t)=>(t.debug&&console.log("[MW][Inventory] MoveInventoryItem"),true));Fe(be.DropObject,(e,t)=>(t.debug&&console.log("[MW][Inventory] DropObject"),true));Fe(be.PickupObject,(e,t)=>(t.debug&&console.log("[MW][Inventory] PickupObject"),true));Fe(be.ToggleFavoriteItem,(e,t)=>(t.debug&&console.log("[MW][Inventory] ToggleFavoriteItem"),true));Fe(be.PutItemInStorage,(e,t)=>(t.debug&&console.log("[MW][Inventory] PutItemInStorage"),true));Fe(be.RetrieveItemFromStorage,(e,t)=>(t.debug&&console.log("[MW][Inventory] RetrieveItemFromStorage"),true));Fe(be.MoveStorageItem,(e,t)=>(t.debug&&console.log("[MW][Inventory] MoveStorageItem"),true));Fe(be.LogItems,(e,t)=>(t.debug&&console.log("[MW][Inventory] LogItems"),true));Fe(be.PlacePet,(e,t)=>(t.debug&&console.log("[MW][Pets] PlacePet"),true));Fe(be.FeedPet,(e,t)=>(t.debug&&console.log("[MW][Pets] FeedPet"),true));Fe(be.PetPositions,(e,t)=>(t.debug&&console.log("[MW][Pets] PetPositions"),true));Fe(be.SwapPet,(e,t)=>(t.debug&&console.log("[MW][Pets] SwapPet"),true));Fe(be.StorePet,(e,t)=>(t.debug&&console.log("[MW][Pets] StorePet"),true));Fe(be.NamePet,(e,t)=>(t.debug&&console.log("[MW][Pets] NamePet"),true));Fe(be.SellPet,(e,t)=>(t.debug&&console.log("[MW][Pets] SellPet"),true));console.log("[WS] TESTTEST");Fe(be.SetSelectedGame,(e,t)=>(t.debug&&console.log("[MW][Session] SetSelectedGame"),true));Fe(be.VoteForGame,(e,t)=>(t.debug&&console.log("[MW][Session] VoteForGame"),true));Fe(be.RequestGame,(e,t)=>(t.debug&&console.log("[MW][Session] RequestGame"),true));Fe(be.RestartGame,(e,t)=>(t.debug&&console.log("[MW][Session] RestartGame"),true));Fe(be.Ping,(e,t)=>(t.debug&&console.log("[MW][Session] Ping"),true));Fe(be.PlayerPosition,(e,t)=>(t.debug&&console.log("[MW][Session] PlayerPosition"),true));Fe(be.Teleport,(e,t)=>(t.debug&&console.log("[MW][Session] Teleport"),true));Fe(be.CheckWeatherStatus,(e,t)=>(t.debug&&console.log("[MW][Session] CheckWeatherStatus"),true));Fe(be.Chat,(e,t)=>(t.debug&&console.log("[MW][Social] Chat"),true));Fe(be.Dev,(e,t)=>(t.debug&&console.log("[MW][Social] Dev"),true));Fe(be.Emote,(e,t)=>(t.debug&&console.log("[MW][Social] Emote"),true));Fe(be.Wish,(e,t)=>(t.debug&&console.log("[MW][Social] Wish"),true));Fe(be.KickPlayer,(e,t)=>(t.debug&&console.log("[MW][Social] KickPlayer"),true));Fe(be.ReportSpeakingStart,(e,t)=>(t.debug&&console.log("[MW][Voice] ReportSpeakingStart"),true));Fe(be.SetPlayerData,(e,t)=>(t.debug&&console.log("[MW][Social] SetPlayerData"),true));Fe(be.UsurpHost,(e,t)=>(t.debug&&console.log("[MW][Social] UsurpHost"),true));function _V(e={}){const t=e.pageWindow??ge,n=e.pollMs??500,r=!!e.debug,o=[];o.push(CL(t,{debug:r})),o.push(Qz({pageWindow:t,middlewares:e.middlewares,debug:r}));let i=null;const a=s=>{if(i){try{i();}catch{}i=null;}s&&(i=SV(s,e.handlers,{debug:r,pageWindow:t}));};return a(Nu(t).ws),o.push(kS(s=>a(s.ws),{intervalMs:n,debug:r,pageWindow:t})),{getWs:()=>Nu(t).ws,dispose:()=>{for(let s=o.length-1;s>=0;s--)try{o[s]();}catch{}if(i){try{i();}catch{}i=null;}}}}let $d=null;function kV(e={}){return $d||($d=_V(e),$d)}const _1=768,ax=6,Fh=62,Bh=50,EV=.5,AV=.4,Dd=36,Fd=28,TV=6,gm=4,IV=8,PV=100,RV=200,sx=14,lx=3,MV=40,LV=50,cx=2147483646,rl="gemini-bulk-favorite-sidebar",OV="gemini-bulk-favorite-top-row",NV="gemini-bulk-favorite-bottom-row",mm="gemini-qol-bulkFavorite-styles",$V=`
/* Desktop: vertical scrollable list next to inventory */
#${rl} {
  display: flex;
  flex-direction: column;
  gap: ${TV}px;
  pointer-events: auto;
  padding: 4px;
  border-radius: 8px;
  background: rgba(0, 0, 0, 0.6);
  z-index: ${cx};
  overflow-y: auto;
}

/* Mobile: horizontal scrollable rows */
.gemini-qol-bulkFavorite-row {
  display: flex;
  flex-direction: row;
  gap: ${gm}px;
  pointer-events: auto;
  padding: 4px;
  position: fixed;
  z-index: ${cx};
  overflow-x: auto;
  overflow-y: hidden;
  max-width: 100vw;
}

.gemini-qol-bulkFavorite-row::-webkit-scrollbar {
  height: 3px;
}

.gemini-qol-bulkFavorite-row::-webkit-scrollbar-track {
  background: rgba(0, 0, 0, 0.2);
  border-radius: 2px;
}

.gemini-qol-bulkFavorite-row::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.3);
  border-radius: 2px;
}

#${rl}::-webkit-scrollbar {
  width: 4px;
}

#${rl}::-webkit-scrollbar-track {
  background: rgba(0, 0, 0, 0.2);
  border-radius: 2px;
}

#${rl}::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.3);
  border-radius: 2px;
}

/* Individual species button */
.gemini-qol-bulkFavorite-btn {
  position: relative;
  width: ${Fh}px;
  height: ${Fh}px;
  min-width: ${Fh}px;
  background: rgba(0, 0, 0, 0.85);
  border-radius: 6px;
  border: none;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
  padding: 4px;
  gap: 2px;
}

/* Mobile: smaller buttons */
.gemini-qol-bulkFavorite-btn.mobile {
  width: ${Bh}px;
  height: ${Bh}px;
  min-width: ${Bh}px;
}

.gemini-qol-bulkFavorite-btn:hover {
  transform: scale(1.08);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
}

.gemini-qol-bulkFavorite-btn:active {
  transform: scale(0.96);
}

/* Sprite image */
.gemini-qol-bulkFavorite-sprite {
  width: ${Dd}px;
  height: ${Dd}px;
  object-fit: contain;
  image-rendering: pixelated;
}

.gemini-qol-bulkFavorite-btn.mobile .gemini-qol-bulkFavorite-sprite {
  width: ${Fd}px;
  height: ${Fd}px;
}

/* Heart indicator */
.gemini-qol-bulkFavorite-heart {
  position: absolute;
  top: ${lx}px;
  right: ${lx}px;
  width: ${sx}px;
  height: ${sx}px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
  line-height: 1;
}

.gemini-qol-bulkFavorite-heart.filled {
  color: #ff4d4d;
}

.gemini-qol-bulkFavorite-heart.outline {
  color: #ffffff;
  opacity: 0.85;
}

/* Species label */
.gemini-qol-bulkFavorite-label {
  color: #ffffff;
  font-size: 9px;
  font-weight: 600;
  text-align: center;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.9);
  max-width: 100%;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  line-height: 1.1;
}

.gemini-qol-bulkFavorite-btn.mobile .gemini-qol-bulkFavorite-label {
  font-size: 8px;
}

/* Fallback sprite (letter) */
.gemini-qol-bulkFavorite-fallback {
  width: ${Dd}px;
  height: ${Dd}px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  color: #fff;
  background: rgba(255, 255, 255, 0.15);
  border-radius: 4px;
}

.gemini-qol-bulkFavorite-btn.mobile .gemini-qol-bulkFavorite-fallback {
  width: ${Fd}px;
  height: ${Fd}px;
  font-size: 14px;
}
`,DV='<svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>',FV='<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>';function BV(e){const{species:t,itemCount:n,isFavorited:r,isMobile:o,onClick:i}=e,a=x("button",{className:`gemini-qol-bulkFavorite-btn${o?" mobile":""}`,title:`${r?"Unfavorite":"Favorite"} all ${n} ${t}`});return a.dataset.species=t,a.appendChild(jV(t,o)),a.appendChild(GV(r)),a.appendChild(zV(t)),a.addEventListener("click",async s=>{s.preventDefault(),s.stopPropagation(),i();}),a}function jV(e,t){try{if(!me.isReady()||!me.has("plant",e))return dx(e);const n=t?AV:EV,r=me.toCanvas("plant",e,{scale:n});return r.className="gemini-qol-bulkFavorite-sprite",r}catch(n){return console.warn(`[BulkFavorite] Failed to load sprite for ${e}:`,n),dx(e)}}function dx(e){return x("div",{className:"gemini-qol-bulkFavorite-fallback"},e.charAt(0).toUpperCase())}function GV(e){const t=x("span",{className:`gemini-qol-bulkFavorite-heart ${e?"filled":"outline"}`});return t.innerHTML=e?DV:FV,t}function zV(e){return x("span",{className:"gemini-qol-bulkFavorite-label"},e)}let Er=null,Ar=null,kr=null,wu=false,Sl=null,ol=false,Oa=null;const bm=[];function Bd(e){bm.push(e);}function UV(){for(const e of bm)try{e();}catch(t){console.warn("[BulkFavorite] Cleanup error:",t);}bm.length=0;}function k1(){return window.innerWidth<=_1}function HV(e){return new Promise(t=>setTimeout(t,e))}function E1(){if(wu)return;if(document.getElementById(mm)){wu=true;return}const e=document.createElement("style");e.id=mm,e.textContent=$V,document.head.appendChild(e),wu=true;}function WV(){document.getElementById(mm)?.remove(),wu=false;}function VV(){const e=En().get();if(!e?.items)return [];const t=new Set(e.favoritedItemIds??[]),n=new Map;for(const o of e.items){const i=o;if(i.itemType!=="Produce")continue;const a=i.species,s=i.id;if(!a||!s)continue;const l=n.get(a);l?l.push(s):n.set(a,[s]);}const r=[];for(const[o,i]of n){const a=i.length>0&&i.every(s=>t.has(s));r.push({species:o,itemIds:i,allFavorited:a});}return r.sort((o,i)=>o.species.localeCompare(i.species)),r}async function qV(e){const t=En().get();if(!t?.items)return;const n=new Set(t.favoritedItemIds??[]),r=[];for(const a of t.items){const s=a;if(s.itemType!=="Produce"||s.species!==e)continue;const l=s.id;l&&r.push({id:l,favorited:n.has(l)});}if(r.length===0)return;const o=r.every(a=>a.favorited),i=o?r.filter(a=>a.favorited):r.filter(a=>!a.favorited);console.log(`🔄 [BulkFavorite] ${o?"Unfavoriting":"Favoriting"} ${i.length}/${r.length} ${e}`);for(const a of i)Ap(a.id),await HV(MV);}function vm(e,t){const{species:n,itemIds:r,allFavorited:o}=e;return BV({species:n,itemCount:r.length,isFavorited:o,isMobile:t,onClick:()=>qV(n)})}function KV(e){const t=x("div",{id:rl}),n=e.getBoundingClientRect(),r=Math.max(window.innerHeight-PV,RV);return t.style.maxHeight=`${r}px`,t.style.position="fixed",t.style.left=`${n.right+IV}px`,t.style.top=`${n.top}px`,t}function ux(e,t,n){const r=x("div",{id:e,className:"gemini-qol-bulkFavorite-row"}),o=t.getBoundingClientRect();return n==="top"?r.style.bottom=`${window.innerHeight-o.top+gm}px`:r.style.top=`${o.bottom+gm}px`,r.style.left=`${o.left}px`,r.style.maxWidth=`${o.width}px`,r}function px(){const e=VV();k1()?YV(e):XV(e);}function XV(e){if(Er){if(Er.innerHTML="",e.length===0){Er.style.display="none";return}Er.style.display="flex";for(const t of e)Er.appendChild(vm(t,false));console.log(`🎯 [BulkFavorite] Desktop: Rendered ${e.length} produce types`);}}function YV(e){if(!Ar||!kr)return;if(Ar.innerHTML="",kr.innerHTML="",e.length===0){Ar.style.display="none",kr.style.display="none";return}Ar.style.display="flex";const t=e.slice(0,ax),n=e.slice(ax);for(const r of t)Ar.appendChild(vm(r,true));if(n.length>0){kr.style.display="flex";for(const r of n)kr.appendChild(vm(r,true));}else kr.style.display="none";console.log(`🎯 [BulkFavorite] Mobile: Rendered ${e.length} types`);}function JV(){const e=document.querySelector(".McGrid");if(!e)return console.log("⚠️ [BulkFavorite] No .McGrid found"),null;const t=e.getBoundingClientRect();if(window.innerWidth<=_1)return console.log(`🎯 [BulkFavorite] Mobile mode - using McGrid: ${Math.round(t.width)}x${Math.round(t.height)}`),e;const r=window.innerWidth/2;let o=null,i=0;const a=e.querySelectorAll(".McFlex, .McGrid");for(const s of a){const l=s.getBoundingClientRect();if(l.width<200||l.height<200||l.width>window.innerWidth-100)continue;const c=l.left+l.width/2,d=1-Math.abs(c-r)/r,f=l.width*l.height*d;f>i&&(o=s,i=f);}if(o){const s=o.getBoundingClientRect();return console.log(`🎯 [BulkFavorite] Found desktop container: ${Math.round(s.width)}x${Math.round(s.height)} @ (${Math.round(s.left)}, ${Math.round(s.top)})`),o}return console.log(`🎯 [BulkFavorite] Fallback to McGrid: ${Math.round(t.width)}x${Math.round(t.height)}`),e}let Na=null;function ym(){Na&&clearTimeout(Na),Na=setTimeout(()=>{QV();},LV);}function QV(){const e=JV();if(!e)return;console.log("🎯 [BulkFavorite] Found inventory modal container"),_l(),E1(),Sl=e,k1()?(Ar=ux(OV,e,"top"),kr=ux(NV,e,"bottom"),document.body.appendChild(Ar),document.body.appendChild(kr)):(Er=KV(e),document.body.appendChild(Er)),px(),Oa&&Oa(),Oa=En().subscribeFavorites(()=>{ol&&px();});}function _l(){Na&&(clearTimeout(Na),Na=null),Oa&&(Oa(),Oa=null),Er?.remove(),Er=null,Ar?.remove(),Ar=null,kr?.remove(),kr=null,Sl=null;}function ZV(){_l();}async function wm(){if(!yc().enabled){console.log("⚠️ [BulkFavorite] Feature disabled");return}E1();const t=await bp.onChangeNow(o=>{const i=o==="inventory";i!==ol&&(ol=i,i?ym():_l());}),n=nf(".McGrid",()=>{ol&&(Er||Ar||ym());}),r=rf(".McGrid",o=>{Sl&&Sl===o&&_l();});Bd(()=>t()),Bd(()=>n.disconnect()),Bd(()=>r.disconnect()),Bd(()=>{_l(),ol=false,Sl=null;}),console.log("✅ [BulkFavorite] Started (State-driven + DOM observation)");}function xm(){UV(),WV(),console.log("🛑 [BulkFavorite] Stopped");}function eq(e){const t=yc();t.enabled=e,e?wm():xm();}let jd=false;const tq={init(){jd||(wm(),jd=true);},destroy(){jd&&(xm(),jd=false);},isEnabled(){return uk()},renderButton:ym,removeButton:ZV,startWatching:wm,stopWatching:xm,setEnabled:eq},nq=`
  <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
    <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
  </svg>
`,rq=`
@keyframes bellRing {
  0%, 100% { transform: rotate(0deg); }
  10%, 30% { transform: rotate(-10deg); }
  20%, 40% { transform: rotate(10deg); }
  50% { transform: rotate(-5deg); }
  60% { transform: rotate(5deg); }
  70% { transform: rotate(0deg); }
}

.alert-btn-ringing {
  animation: bellRing 0.6s ease-in-out;
}
`;let fx=false;function oq(){if(fx)return;fx=true;const e=document.createElement("style");e.textContent=rq,document.head.appendChild(e);}const hx=["Chat","Leaderboard","Stats","Open Activity Log","Open MGH"],gx=e=>{try{return typeof CSS<"u"&&CSS&&typeof CSS.escape=="function"?CSS.escape(e):e.replace(/"/g,'\\"')}catch{return e}};function iq(){const e=document.querySelector(hx.map(n=>`button[aria-label="${gx(n)}"]`).join(","));if(!e)return null;let t=e.parentElement;for(;t&&t!==document.body;){if(hx.reduce((r,o)=>r+t.querySelectorAll(`button[aria-label="${gx(o)}"]`).length,0)>=2)return t;t=t.parentElement;}return null}function aq(e){const t=Array.from(e.querySelectorAll("button[aria-label]"));if(!t.length)return {refBtn:null,refWrapper:null};const n=t.filter(s=>s.dataset.alertBtn!=="true"&&(s.getAttribute("aria-label")||"")!=="Alerts"),r=n.length?n:t,o=r[r.length-1]||null,i=o?.parentElement,a=i&&i.parentElement===e&&i.tagName==="DIV"?i:null;return {refBtn:o,refWrapper:a}}function sq(e,t,n){const r=e.cloneNode(false);r.type="button",r.setAttribute("aria-label",t),r.title=t,r.dataset.alertBtn="true",r.style.pointerEvents="auto",r.style.position="relative",r.removeAttribute("id");const o=document.createElement("div");return o.innerHTML=n,o.dataset.alertIcon="true",o.style.pointerEvents="none",o.style.userSelect="none",o.style.width="76%",o.style.height="76%",o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",o.style.margin="auto",r.appendChild(o),r}function lq(){const e=document.createElement("span");return e.className="alert-badge",e.style.position="absolute",e.style.top="-4px",e.style.right="-4px",e.style.minWidth="18px",e.style.height="18px",e.style.borderRadius="9px",e.style.backgroundColor="#EF4444",e.style.color="white",e.style.fontSize="10px",e.style.fontWeight="700",e.style.display="none",e.style.alignItems="center",e.style.justifyContent="center",e.style.padding="0 4px",e.style.pointerEvents="none",e.style.boxShadow="0 2px 4px rgba(0,0,0,0.2)",e.style.zIndex="1",e.textContent="0",e}function cq(e){oq();const t=e.iconUrl?`<img src="${e.iconUrl}" alt="Alert" style="width:100%;height:100%;object-fit:contain;"/>`:nq,n=e.ariaLabel||"Alerts";let r=null,o=null,i=null,a=null,s=false,l=null,c=null,d=null;function u(){if(s)return  false;s=true;let C=false;try{const _=iq();if(!_)return !1;l!==_&&(l=_);const{refBtn:E,refWrapper:P}=aq(_);if(!E)return !1;o=_.querySelector('div[data-alert-wrapper="true"]'),!o&&P&&(o=P.cloneNode(!1),o.dataset.alertWrapper="true",o.removeAttribute("id"),C=!0);const O=o?.querySelector('button[data-alert-btn="true"]')||null;r||(r=O),r||(r=sq(E,n,t),r.addEventListener("click",I=>{I.preventDefault(),I.stopPropagation();try{e.onClick?.();}catch{}}),i=lq(),r.appendChild(i),o?o.appendChild(r):r.parentElement!==_&&_.appendChild(r),C=!0),o&&o.parentElement!==_&&(_.appendChild(o),C=!0);const k=_;if(k&&k!==c){try{y.disconnect();}catch{}c=k,y.observe(c,{childList:!0,subtree:!0});}return C}finally{s=false;}}const f=document.getElementById("App")||document.body;let g=null,h=false;const y=new MutationObserver(()=>{h&&r&&document.contains(r)||(r&&!document.contains(r)&&(h=false,r=null,i=null,o=null),g===null&&(g=window.setTimeout(()=>{if(g=null,u()&&r&&document.contains(r)&&(h=true,o)){const _=o.parentElement;_&&_.lastElementChild!==o&&_.appendChild(o);}},100)));});return u()&&r&&document.contains(r)&&(h=true),y.observe(f,{childList:true,subtree:true}),a=()=>y.disconnect(),{get root(){return r},updateBadge(C){i&&(C>0?(i.textContent=String(C),i.style.display="flex"):i.style.display="none");},ring(){if(!r)return;const C=r.querySelector('[data-alert-icon="true"]');C&&(C.classList.add("alert-btn-ringing"),setTimeout(()=>{C?.classList.remove("alert-btn-ringing");},600));},startRinging(){r&&(d!==null&&clearInterval(d),this.ring(),d=window.setInterval(()=>{this.ring();},3e3));},stopRinging(){if(d!==null&&(clearInterval(d),d=null),r){const C=r.querySelector('[data-alert-icon="true"]');C&&C.classList.remove("alert-btn-ringing");}},destroy(){this.stopRinging();try{a?.();}catch{}try{o?.remove();}catch{}}}}const dq=`
  /* ============================================
     Alert Overlay Container
     ============================================ */
  .alert-overlay {
    position: fixed;
    width: 340px;
    max-width: calc(100vw - 16px);
    max-height: min(480px, calc(100vh - 100px));
    background: var(--bg, rgba(10, 12, 18, 0.95));
    border: 1px solid var(--border, rgba(148, 163, 184, 0.3));
    border-radius: 12px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    z-index: 10000;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    font-family: var(--font-ui, system-ui, -apple-system, "Segoe UI", Roboto, sans-serif);
    color: var(--fg, #e5e7eb);
    isolation: isolate;
  }

  /* ============================================
     Header
     ============================================ */
  .alert-overlay-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 14px 16px;
    border-bottom: 1px solid var(--border, rgba(148, 163, 184, 0.2));
    flex-shrink: 0;
  }

  .alert-overlay-title {
    font-size: 15px;
    font-weight: 700;
    color: var(--fg, #e5e7eb);
    user-select: none;
  }

  .alert-overlay-close {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
    background: transparent;
    color: var(--fg, rgba(229, 231, 235, 0.7));
    font-size: 18px;
    cursor: pointer;
    border-radius: 6px;
    transition: all 0.15s ease;
    padding: 0;
    flex-shrink: 0;
  }

  .alert-overlay-close:hover {
    background: var(--soft, rgba(229, 231, 235, 0.1));
    color: var(--fg, #e5e7eb);
  }

  .alert-overlay-close:active {
    background: var(--muted, rgba(229, 231, 235, 0.15));
  }

  /* ============================================
     Items List
     ============================================ */
  .alert-overlay-list {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: thin;
    scrollbar-color: rgba(148, 163, 184, 0.3) transparent;
  }

  .alert-overlay-list::-webkit-scrollbar {
    width: 8px;
  }

  .alert-overlay-list::-webkit-scrollbar-track {
    background: transparent;
  }

  .alert-overlay-list::-webkit-scrollbar-thumb {
    background: var(--border, rgba(148, 163, 184, 0.3));
    border-radius: 4px;
  }

  .alert-overlay-list::-webkit-scrollbar-thumb:hover {
    background: var(--border, rgba(148, 163, 184, 0.5));
  }

  /* ============================================
     Item Row
     ============================================ */
  .alert-item-row {
    display: grid;
    grid-template-columns: 56px 1fr auto;
    gap: 12px;
    align-items: center;
    padding: 12px 16px;
    border-bottom: 1px solid var(--border, rgba(148, 163, 184, 0.1));
    transition: background 0.15s ease;
  }

  .alert-item-row:hover {
    background: var(--soft, rgba(229, 231, 235, 0.05));
  }

  .alert-item-row:last-child {
    border-bottom: none;
  }

  /* ============================================
     Sprite Column
     ============================================ */
  .alert-item-sprite {
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--soft, rgba(229, 231, 235, 0.05));
    border-radius: 8px;
    flex-shrink: 0;
  }

  .alert-item-sprite canvas {
    max-width: 100%;
    max-height: 100%;
    image-rendering: pixelated;
    image-rendering: crisp-edges;
  }

  /* ============================================
     Info Column
     ============================================ */
  .alert-item-info {
    display: flex;
    flex-direction: column;
    gap: 4px;
    min-width: 0;
  }

  .alert-item-name {
    font-size: 14px;
    font-weight: 600;
    color: var(--fg, #e5e7eb);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .alert-item-remaining {
    font-size: 12px;
    color: var(--fg, rgba(229, 231, 235, 0.7));
    opacity: 0.7;
  }

  /* ============================================
     Actions Column
     ============================================ */
  .alert-item-actions {
    display: flex;
    gap: 6px;
    flex-shrink: 0;
  }

  .alert-item-btn {
    padding: 8px 12px;
    font-size: 12px;
    font-weight: 600;
    border-radius: 6px;
    border: 1px solid var(--border, rgba(148, 163, 184, 0.3));
    background: var(--soft, rgba(229, 231, 235, 0.08));
    color: var(--fg, #e5e7eb);
    cursor: pointer;
    transition: all 0.15s ease;
    min-height: 32px;
    white-space: nowrap;
  }

  .alert-item-btn:hover:not(:disabled) {
    background: var(--muted, rgba(229, 231, 235, 0.12));
    border-color: var(--accent, rgba(96, 165, 250, 0.4));
  }

  .alert-item-btn:active:not(:disabled) {
    background: var(--muted, rgba(229, 231, 235, 0.16));
  }

  .alert-item-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }

  .alert-item-btn--buy {
    /* Specific styles for Buy button (optional) */
  }

  .alert-item-btn--buy-all {
    /* Specific styles for Buy All button (optional) */
  }

  /* ============================================
     Empty State
     ============================================ */
  .alert-overlay-empty {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 48px 24px;
    text-align: center;
    color: var(--fg, rgba(229, 231, 235, 0.6));
    opacity: 0.6;
  }

  .alert-overlay-empty-icon {
    font-size: 48px;
    margin-bottom: 12px;
    opacity: 0.5;
  }

  .alert-overlay-empty-text {
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 6px;
  }

  .alert-overlay-empty-subtext {
    font-size: 12px;
    opacity: 0.8;
  }

  /* ============================================
     Responsive - Mobile
     ============================================ */
  @media (max-width: 480px) {
    .alert-overlay {
      width: calc(100vw - 16px);
      max-height: calc(100vh - 80px);
    }

    .alert-item-row {
      grid-template-columns: 44px 1fr auto;
      gap: 8px;
      padding: 10px 12px;
    }

    .alert-item-actions {
      grid-column: auto;
      justify-content: flex-end;
    }

    .alert-item-btn {
      flex: 0 0 auto;
      min-height: 36px;
    }

    .alert-overlay-header {
      padding: 12px 14px;
    }

    .alert-item-sprite {
      width: 40px;
      height: 40px;
    }
  }

  /* ============================================
     Touch-friendly targets (minimum 44px)
     ============================================ */
  @media (pointer: coarse) {
    .alert-overlay-close {
      min-width: 44px;
      min-height: 44px;
    }

    .alert-item-btn {
      min-height: 44px;
      padding: 10px 14px;
    }
  }

  /* ============================================
     Accessibility - Focus states
     ============================================ */
  .alert-item-btn:focus-visible {
    outline: 2px solid var(--accent, #60a5fa);
    outline-offset: 2px;
  }

  /* ============================================
     Animation - Fade in
     ============================================ */
  @keyframes alertOverlayFadeIn {
    from {
      opacity: 0;
      transform: translateY(-8px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .alert-overlay {
    animation: alertOverlayFadeIn 0.2s ease-out;
  }
`;function uq(e,t){const n=x("div",{className:"alert-item-row"}),r=x("div",{className:"alert-item-sprite"});if(e.spriteId)try{const c=me.toCanvas(e.spriteId,{scale:.35});c?r.appendChild(c):r.textContent="?";}catch{r.textContent="?";}else r.textContent="?";const o=x("div",{className:"alert-item-info"}),i=x("div",{className:"alert-item-name"},e.itemName),a=x("div",{className:"alert-item-remaining"},`${e.remaining} remaining`);o.appendChild(i),o.appendChild(a);const s=x("div",{className:"alert-item-actions"}),l=x("button",{className:"alert-item-btn alert-item-btn--buy-all",type:"button",title:`Buy all ${e.remaining} available`},"Buy All");return l.addEventListener("click",c=>{c.stopPropagation(),t?.(e);}),s.appendChild(l),n.appendChild(r),n.appendChild(o),n.appendChild(s),n}function pq(){const e=x("div",{className:"alert-overlay-empty"}),t=x("div",{className:"alert-overlay-empty-icon"},"🔔"),n=x("div",{className:"alert-overlay-empty-text"},"No items available"),r=x("div",{className:"alert-overlay-empty-subtext"},"Tracked items will appear here when in stock");return e.appendChild(t),e.appendChild(n),e.appendChild(r),e}function mx(e,t){const n=t.getBoundingClientRect(),r=340,o=8;e.style.position="fixed",e.style.top="",e.style.bottom="",e.style.left="",e.style.right="";let i=n.bottom+o,a=window.innerWidth-n.right;const s=i+480>window.innerHeight,l=n.right-r<o;s?(e.style.bottom=`${window.innerHeight-n.top+o}px`,e.style.top="auto"):e.style.top=`${i}px`,e.style.right=`${a}px`,l&&(e.style.right="auto",e.style.left=`${o}px`);}function fq(e){const{items:t,anchorElement:n,onClose:r,onBuyAll:o}=e,i=x("div",{className:"alert-overlay"}),a=mV("theme",nl.theme),s=wa[a];let l="";s&&(l=`.alert-overlay {
    ${Object.entries(s).map(([_,E])=>`${_}: ${E};`).join(`
    `)}
  }

`);const c=document.createElement("style");c.textContent=l+dq,i.appendChild(c);const d=x("div",{className:"alert-overlay-header"}),u=x("div",{className:"alert-overlay-title"},"Available Items"),f=x("button",{className:"alert-overlay-close",type:"button",title:"Close"},"✕");f.addEventListener("click",C=>{C.stopPropagation(),r?.();}),d.appendChild(u),d.appendChild(f);const g=x("div",{className:"alert-overlay-list"});i.appendChild(d),i.appendChild(g);const h=C=>{if(g.replaceChildren(),C.length===0)g.appendChild(pq());else for(const _ of C){const E=uq(_,o);g.appendChild(E);}};h(t),mx(i,n);const y=()=>{mx(i,n);};window.addEventListener("resize",y);const S=C=>{const _=C.target;!i.contains(_)&&!n.contains(_)&&r?.();};return document.addEventListener("click",S,{capture:true}),{root:i,updateItems:h,destroy(){window.removeEventListener("resize",y),document.removeEventListener("click",S,{capture:true}),i.remove();}}}const hq={seed:"plants",tool:"items",egg:"eggs",decor:"decor"},gq={seed:"seed",tool:null,egg:null,decor:null};function A1(e,t,n){try{const r=hq[t],o=ue.get(r);if(!o||typeof o!="object")return null;const i=o[e];if(!i||typeof i!="object")return null;const a=gq[t],s=a?i[a]:i;return !s||typeof s!="object"?null:s[n]??null}catch{return null}}function mq(e,t){return A1(e,t,"spriteId")}function bq(e,t){return A1(e,t,"name")??e}function vq(e,t){const n=Or.getTrackedItems(),r=new Set(n.filter(i=>i.shopType===e).map(i=>i.itemId));return r.size===0?[]:t.items.filter(i=>{const a=r.has(i.id),s=i.isAvailable;return a&&s}).map(i=>({shopType:e,itemId:i.id,itemName:bq(i.id,e),spriteId:mq(i.id,e),remaining:i.remaining,price:i.price}))}function il(){const t=$o().get(),n=["seed","tool","egg","decor"],r=[];for(const o of n){const i=t.byType[o];if(i){const a=vq(o,i);r.push(...a);}}return r}function yq(e){return $o().subscribeStable(()=>{const r=il();e(r);})}function wq(){let e=null,t=null,n=null,r=false,o=[],i=[],a="",s=0,l=0,c=false,d=null,u=[],f=0,g=false;const h=()=>{try{return Dt.CustomSounds.getNotificationConfig("shop")}catch{return null}},y=(U,X)=>{try{const D=Ue.getItemCustomSound("shop",U,X);return D?{soundId:D.soundId,volume:D.volume,mode:D.mode}:null}catch{return null}},S=U=>`${U.soundId}:${U.volume}`,C=(U,X,D,j)=>{X.has(D)||(U.push({soundId:D,volume:j}),X.add(D));},_=(U,X)=>{const D=[],j=new Set;let Q=false;const ae=[];for(const le of U){const we=y(le.itemId,le.shopType);we?we.mode==="one-shot"&&ae.push({soundId:we.soundId,volume:we.volume}):X?.mode==="one-shot"&&(Q=true);}Q&&X&&C(D,j,X.soundId,X.volume);for(const le of ae)C(D,j,le.soundId,le.volume);return D},E=(U,X)=>{const D=[],j=new Set;let Q=false;const ae=[];for(const le of U){const we=y(le.itemId,le.shopType);we?we.mode==="loop"&&ae.push({soundId:we.soundId,volume:we.volume}):X?.mode==="loop"&&(Q=true);}Q&&X&&C(D,j,X.soundId,X.volume);for(const le of ae)C(D,j,le.soundId,le.volume);return D},P=(U,X,D,j=false)=>{if(!D())return;const Q=Ue.getById(U.soundId);if(!Q){X();return}j&&(d=Q.source),Dt.playCustom(Q.source,{volume:U.volume/100}).then(ae=>{if(!D())return;const le=ae.audio,we=()=>{D()&&X();};le.addEventListener("ended",we,{once:true});}).catch(()=>{D()&&X();});},O=()=>{if(!c||i.length===0)return;const U=i[s];s=(s+1)%i.length;const X=l,D=()=>c&&l===X;P(U,()=>{D()&&O();},D,true);},k=()=>{c||i.length===0||(c=true,s>=i.length&&(s=0),O());},I=()=>{if(c){l+=1,c=false;try{const U=Dt.getCustomHandle();(!d||U&&U.url===d)&&Dt.CustomSounds.stop();}catch{}d=null;}},R=()=>{I(),i=[],a="",s=0,d=null;},A=()=>{if(u.length===0){g=false,k();return}g=true;const U=u.shift(),X=f,D=()=>g&&f===X;P(U,()=>{D()&&A();},D);},L=(U,X)=>{const D=X??h(),j=_(U,D);if(j.length===0)return;const Q=new Set(u.map(ae=>ae.soundId));for(const ae of j)Q.has(ae.soundId)||(u.push(ae),Q.add(ae.soundId));g||(f+=1,I(),A());},F=(U,X)=>{const D=X??h(),j=E(U,D);if(j.length===0){R();return}const Q=j.map(S).join("|"),ae=Q!==a;i=j,a=Q,ae&&(s=0,c&&I()),!g&&(c||k());},G=U=>{const X=o.length>0,D=U.length>0;o=U,e?.updateBadge(U.length),D?X||e?.startRinging():X&&e?.stopRinging();},q=()=>{if(r||!e?.root)return;const U=il();t=fq({items:U,anchorElement:e.root,onClose:H,onBuyAll:X=>{switch(X.shopType){case "seed":fi.seed.buyAll(X.itemId);break;case "egg":fi.egg.buyAll(X.itemId);break;case "decor":fi.decor.buyAll(X.itemId);break;case "tool":fi.tool.buyAll(X.itemId);break}}}),document.body.appendChild(t.root),r=true;},H=()=>{!r||!t||(t.destroy(),t=null,r=false);},ce=()=>{r?H():q();},W=U=>{if(G(U),r&&t&&t.updateItems(U),F(U),U.length>0){const X=new CustomEvent("gemini:alert-available",{detail:{items:U}});window.dispatchEvent(X);}},te=()=>{const U=il(),X=new Set(o.map(ae=>`${ae.shopType}:${ae.itemId}`)),D=U.filter(ae=>!X.has(`${ae.shopType}:${ae.itemId}`)),j=D.length>0;G(U),r&&t&&t.updateItems(U);const Q=h();F(U,Q),j&&L(D,Q);};e=cq({onClick:ce,ariaLabel:"Alerts"}),n=yq(W),window.addEventListener("gemini:tracked-items-changed",te);const ne=U=>{const X=U,{shopType:D,items:j}=X.detail;if(!j||j.length===0)return;const Q=j.map(ae=>({itemId:ae.itemId,shopType:D}));L(Q,h());};window.addEventListener(Me.SHOP_RESTOCK_TRACKED,ne);const ie=U=>{if(U.detail?.entityType!=="shop")return;const D=il();F(D,h());};window.addEventListener(Me.CUSTOM_SOUND_CHANGE,ie);const ee=(U=1,X=10)=>{if($o().get().all.some(ae=>ae.items.length>0)||U>=X){const ae=il();G(ae);const le=h();F(ae,le),ae.length>0&&L(ae,le);}else setTimeout(()=>ee(U+1,X),500);};return ee(),{destroy(){H(),n?.(),n=null,window.removeEventListener("gemini:tracked-items-changed",te),window.removeEventListener(Me.SHOP_RESTOCK_TRACKED,ne),window.removeEventListener(Me.CUSTOM_SOUND_CHANGE,ie),e?.destroy(),e=null,u=[],f+=1,g=false,R();}}}const xq=`
  .gemini-qol-storageValue {
    display: inline-flex;
    align-items: center;
    justify-content: flex-start;
    gap: 6px;
    padding-left: 2px;
  }

  .gemini-qol-storageValue-sprite {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    flex-shrink: 0;
  }

  .gemini-qol-storageValue-text {
    font-size: 14px;
    color: var(--accent);
    font-weight: 700;
    white-space: nowrap;
  }

  @media (max-width: 768px) {
    .gemini-qol-storageValue {
      gap: 4px;
    }

    .gemini-qol-storageValue-sprite {
      width: 16px;
      height: 16px;
    }

    .gemini-qol-storageValue-text {
      font-size: 12px;
    }
  }
`,jh={seed:"SeedSilo",pet:"PetHutch",decor:"DecorShed"};function bx(e){return Array.isArray(e)?e.filter(t=>typeof t=="object"&&t!==null&&"items"in t):[]}function Cq(e){if(typeof e=="string")return e;if(e&&typeof e=="object"&&"decorId"in e){const t=e.decorId;return typeof t=="string"?t:null}return null}function Gh(e,t){return e.filter(r=>Cq(r.decorId)===t).flatMap(r=>r.items??[])}function vx(e){if(!e.length)return 0;const t=ue.get("plants");return t?e.reduce((n,r)=>{const i=t[r.species]?.seed?.coinPrice??0;return n+i*(r.quantity??0)},0):0}function yx(e){if(!e.length)return 0;const t=ue.get("decor");return t?e.reduce((n,r)=>{const i=t[r.decorId]?.coinPrice??0;return n+i*(r.quantity??0)},0):0}function Sq(e){const t=ue.get("pets");if(!t)return 0;const n=t[e.petSpecies],r=n?.maturitySellPrice??n?.sellPrice??0,o=dc(e.petSpecies,e.targetScale),i=uc(e.petSpecies,e.xp,o),s=$S(i,o)*e.targetScale,l=gb(e.mutations??[]);return Math.round(r*s*l)}function wx(e){return e.length?e.reduce((t,n)=>t+Sq(n),0):0}function _q(){return {async start(e){const t=[],n=(l,c)=>{const d=Gh(l,jh.seed).filter(h=>h.itemType==="Seed"),u=vx(d),f=c.filter(h=>h.itemType==="Seed"),g=vx(f);e({kind:"seed",storageValue:u,inventoryValue:g,totalValue:u+g});},r=(l,c)=>{const d=Gh(l,jh.decor).filter(h=>h.itemType==="Decor"),u=yx(d),f=c.filter(h=>h.itemType==="Decor"),g=yx(f);e({kind:"decor",storageValue:u,inventoryValue:g,totalValue:u+g});},o=(l,c)=>{const d=Gh(l,jh.pet).filter(h=>h.itemType==="Pet"),u=wx(d),f=c.filter(h=>h.itemType==="Pet"),g=wx(f);e({kind:"pet",storageValue:u,inventoryValue:g,totalValue:u+g});},i=l=>{const c=bx(l?.storages??[]),d=l?.items??[];n(c,d),r(c,d),o(c,d);},a=l=>{const c=bx(l);n(c,[]),r(c,[]),o(c,[]);};let s=null;try{s=await rt.subscribeImmediate("myInventoryAtom",i);}catch(l){console.warn("[StorageValueIndicator] Failed to subscribe myInventoryAtom",l);try{s=await rt.subscribeImmediate("myItemStoragesAtom",a);}catch(c){console.warn("[StorageValueIndicator] Failed to subscribe myItemStoragesAtom",c);}}return s&&t.push(s),()=>{for(const l of t)try{l();}catch{}t.length=0;}}}}const kq={seed:"Seeds in Silo",pet:"Pets in Hutch",decor:"Decor in Shed"},xx="gemini-qol-storageValue-styles",Eq="gemini-qol-storageValue",T1="gemini-qol-storageValue-text",Aq={seedSilo:"seed",petHutch:"pet",decorShed:"decor"};let oo=Tt(),oc=false,xu=false,Fi=null,Cm=null,Xn=null,kl="",Gd=null,io={seed:{storage:0,inventory:0,total:0},pet:{storage:0,inventory:0,total:0},decor:{storage:0,inventory:0,total:0}},Si=null;function I1(){if(xu)return;if(document.getElementById(xx)){xu=true;return}const e=document.createElement("style");e.id=xx,e.textContent=xq,document.head.appendChild(e),oo.add(()=>e.remove()),xu=true;}function bv(){Xn?.remove(),Xn=null,Cm=null,kl="";}function Sm(e){if(!Xn)return;const t=Xn.querySelector(`.${T1}`);t&&(t.textContent=R1(e),Xn.dataset.rawValue=String(Math.round(e)),Xn.title=`${e.toLocaleString()} coins`);}function Cu(){if(!Xn||!Fi)return;const e=io[Fi];Xn.dataset.rawValue=String(Math.round(e.total)),Xn.title=`${e.storage.toLocaleString()} + ${e.inventory.toLocaleString()}`;}function P1(){const e=io.seed,t=io.pet,n=io.decor;return `${e.storage}|${e.inventory}|${e.total}|${t.storage}|${t.inventory}|${t.total}|${n.storage}|${n.inventory}|${n.total}`}function Tq(e){const t=document.createElement("div");t.className=Eq,t.dataset.rawValue=String(Math.round(e)),t.title=`${e.toLocaleString()} coins`;const n=document.createElement("div");n.className="gemini-qol-storageValue-sprite";const r=document.createElement("canvas");r.width=20,r.height=20,n.appendChild(r);const o=document.createElement("div");o.className=T1,o.textContent=R1(e),t.appendChild(n),t.appendChild(o);try{const i=me.toCanvas("ui","Coin");if(i){const a=r.getContext("2d");if(a){const s=Math.min(r.width/i.width,r.height/i.height),l=i.width*s,c=i.height*s,d=(r.width-l)/2,u=(r.height-c)/2;a.drawImage(i,d,u,l,c);}}}catch(i){console.warn("[StorageValueIndicator] Failed to render coin sprite:",i);}return t}function R1(e){const t=Math.round(e);if(t>=1e15)return `${(t/1e15).toFixed(2)}Q`;if(t>=1e12)return `${(t/1e12).toFixed(2)}T`;if(t>=1e9)return `${(t/1e9).toFixed(2)}B`;if(t>=1e6)return `${(t/1e6).toFixed(2)}M`;if(t>=1e3){const n=t/1e3;return n>=100?`${Math.round(n)}K`:`${n.toFixed(1)}K`}return String(t)}function Su(e){const t=kq[e],n=document.querySelectorAll(".chakra-text, p, span");for(const r of n){if(r.textContent?.trim()!==t||!r.offsetParent)continue;const i=r.closest(".McGrid");if(!(!i||!i.querySelector(".McFlex")))return i}return null}function M1(){return Su("seed")?"seed":Su("pet")?"pet":Su("decor")?"decor":null}function Iq(e){const t=Su(e);if(!t)return;const n=P1();if(t===Cm&&Xn?.isConnected){n!==kl&&(kl=n,Sm(io[e].total),Cu()),Sm(io[e].total),Cu();return}bv(),Cm=t;const r=Tq(io[e].total);Xn=r,kl=n,Cu();const o=document.createElement("div");o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="flex-start",o.style.position="relative",o.style.minHeight="20px",o.appendChild(r),t.insertBefore(o,t.firstChild),oo.add(()=>o.remove());}function _m(e){if(e!==Fi){if(Fi=e,!e){bv();return}I1(),Iq(e);}}async function Pq(){if(Gd)return;Gd=await _q().start(({kind:t,storageValue:n,inventoryValue:r,totalValue:o})=>{io[t]={storage:n,inventory:r,total:o},Fi===t&&Xn&&(kl=P1(),Sm(o),Cu());}),oo.add(()=>{Gd?.(),Gd=null;});}function _u(){const e=Fi??M1();_m(e);}function Rq(){Si!==null&&clearTimeout(Si),Si=window.setTimeout(()=>{Si=null,Bo()||gn(()=>_u());},200);}function Mq(){setTimeout(_u,100),setTimeout(_u,400),setTimeout(_u,800);const e=new MutationObserver(()=>{Bo()||Rq();});e.observe(document.body,{childList:true,subtree:true}),Fo(oo,e),oo.add(()=>{Si!==null&&(clearTimeout(Si),Si=null);});}function Lq(){oc||(oc=true,I1(),Pq(),bp.onChangeNow(e=>{const t=e?Aq[String(e)]??null:null;if(t){_m(t);return}const n=M1();_m(n);}).then(e=>{oo.add(()=>e());}),Mq());}function Oq(){oc&&(oc=false,bv(),oo.run(),oo.clear(),oo=Tt(),xu=false,Fi=null,io={seed:{storage:0,inventory:0,total:0},pet:{storage:0,inventory:0,total:0},decor:{storage:0,inventory:0,total:0}});}function Nq(){return oc}const $q={init:Lq,destroy:Oq,isEnabled:Nq};function Dq(e){e.logStep("WebSocket","Capturing WebSocket...");let t=null;return t=kS(n=>{n.ws&&(e.logStep("WebSocket","WebSocket captured","success"),t?.(),t=null);},{intervalMs:250}),kV({debug:false}),()=>{t?.(),t=null;}}async function Fq(e){e.logStep("Atoms","Prewarming Jotai store...");try{await PC(),await zm({timeoutMs:8e3,intervalMs:50}),e.logStep("Atoms","Jotai store ready","success");}catch(t){e.logStep("Atoms","Jotai store not captured yet","error"),console.warn("[Bootstrap] Jotai store wait failed",t);}}function Bq(e){e.logStep("Globals","Initializing global variables...");try{zS(),e.logStep("Globals","Global variables ready","success");}catch(t){e.logStep("Globals","Failed to initialize global variables","error"),console.warn("[Bootstrap] Global variables init failed",t);}}function jq(e){e.logStep("API","Exposing Gemini API...");try{EH(),e.logStep("API","Gemini API ready","success");}catch(t){e.logStep("API","Failed to expose API","error"),console.warn("[Bootstrap] API init failed",t);}}function zh(){return new Promise(e=>{typeof requestIdleCallback<"u"?requestIdleCallback(()=>e(),{timeout:50}):setTimeout(e,0);})}async function Gq(e){e.logStep("HUD","Loading HUD preferences..."),await zh();const t=gV();await zh();const n=await hV({hostId:"gemini-hud-root",initialWidth:t.width,initialOpen:t.isOpen,onWidthChange:r=>Nd("width",r),onOpenChange:r=>Nd("isOpen",r),themes:wa,initialTheme:t.theme,onThemeChange:r=>Nd("theme",r),buildSections:r=>$W({applyTheme:r.applyTheme,initialTheme:r.initialTheme,getCurrentTheme:r.getCurrentTheme,setHUDWidth:r.setHUDWidth,setHUDOpen:r.setHUDOpen}),initialTab:t.activeTab,onTabChange:r=>Nd("activeTab",r)});return await zh(),e.logStep("HUD","HUD ready","success"),n}async function zq(e){e.setSubtitle("Activating Gemini modules...");let t=0,n=0;await US(r=>{r.status==="start"?n++:r.status==="success"?(t++,e.logStep("Modules",`Loading modules... (${t}/${n})`)):r.status==="error"&&e.logStep("Modules",`Loading modules... (${t}/${n}) - ${r.name} failed`,"error");}),e.logStep("Modules",`All modules loaded (${n}/${n})`,"success");}async function Uq(e){try{me.isReady()||await me.init(),ue.resolveSprites();const t=[],n=ue.get("plants");if(n)for(const l of Object.values(n))l?.seed?.spriteId&&t.push(l.seed.spriteId),l?.plant?.spriteId&&t.push(l.plant.spriteId),l?.crop?.spriteId&&t.push(l.crop.spriteId);const r=ue.get("pets");if(r)for(const l of Object.values(r))l?.spriteId&&t.push(l.spriteId);const o=ue.get("items");if(o)for(const l of Object.values(o))l?.spriteId&&t.push(l.spriteId);const i=ue.get("eggs");if(i)for(const l of Object.values(i))l?.spriteId&&t.push(l.spriteId);const a=ue.get("decor");if(a)for(const l of Object.values(a))l?.spriteId&&t.push(l.spriteId);const s=[...new Set(t)];s.length>0&&await me.warmup(s,()=>{},5);}catch(t){console.warn("[Bootstrap] Sprite warmup failed",t);}}async function Hq(e){e.logStep("Sections","Preloading UI sections...");try{await DW(),e.logStep("Sections","Sections preloaded","success");}catch(t){e.logStep("Sections","Sections preload failed","error"),console.warn("[Bootstrap] Sections preload failed",t);}}function Wq(e){e.logStep("Features","Initializing features...");const t=[{name:"AntiAfk",init:Aa.init.bind(Aa)},{name:"PetTeam",init:je.init.bind(je)},{name:"BulkFavorite",init:zg.init.bind(zg)},{name:"XPTracker",init:Hg.init.bind(Hg)},{name:"CropValueIndicator",init:lu.init.bind(lu)},{name:"CropSizeIndicator",init:uu.init.bind(uu)},{name:"ShopNotifier",init:Or.init.bind(Or)},{name:"ShopRestock",init:Kn.init.bind(Kn)},{name:"WeatherNotifier",init:qa.init.bind(qa)},{name:"PetHungerNotifier",init:rc.init.bind(rc)},{name:"AriesAPI",init:ip.init.bind(ip)},{name:"HarvestLocker",init:yn.init.bind(yn)},{name:"EggLocker",init:Ro.init.bind(Ro)},{name:"DecorLocker",init:Mo.init.bind(Mo)},{name:"MissingVariantsIndicator",init:Ch.init.bind(Ch)},{name:"Journal",init:Lt.init.bind(Lt)}];let n=0;for(const r of t)try{r.init(),n++,e.logStep("Features",`Initializing features... (${n}/${t.length})`,"info");}catch(o){e.logStep("Features",`Initializing features... (${n}/${t.length}) - ${r.name} failed`,"error"),console.warn(`[Bootstrap] Feature ${r.name} init failed`,o);}e.logStep("Features",`All features initialized (${t.length}/${t.length})`,"success"),e.logStep("Injections","Initializing QOL injections...");try{const r=Fu();r.register({id:"bulkFavoriteInject",name:"Bulk Favorite Inject",description:"Quick favorite/unfavorite multiple mutations",injection:tq,storageKey:lt.BULK_FAVORITE,defaultEnabled:!1}),r.register({id:"cropValueIndicator",name:"Crop Price",description:"Shows coin value in crop tooltips",injection:lu.render,storageKey:lt.CROP_VALUE_INDICATOR,defaultEnabled:!1}),r.register({id:"cropSizeIndicator",name:"Crop Size",description:"Shows size percentage in crop tooltips",injection:uu.render,storageKey:lt.CROP_SIZE_INDICATOR,defaultEnabled:!1}),r.register({id:"missingVariantsIndicator",name:"Missing Variants",description:"Shows colored letters for unlogged crop variants",injection:Ch.render,storageKey:lt.MISSING_VARIANTS_INDICATOR,defaultEnabled:!1}),r.register({id:"storageValueIndicator",name:"Storage Value",description:"Shows total coin value for storage modals",injection:$q,storageKey:pn.STORAGE_VALUE_INDICATOR,defaultEnabled:!0}),r.initAll(),e.logStep("Injections","QOL injections registered and initialized","success");}catch(r){e.logStep("Injections","QOL injections initialization failed","error"),console.warn("[Bootstrap] Injections init failed",r);}}Kx();fR();(async function(){PA();const e=yA({title:"Gemini is loading",subtitle:"Connecting and preparing modules..."});let t=null;try{t=Dq(e),await Fq(e),Bq(e),jq(e),await zq(e),await Promise.all([(async()=>{Wq(e);})(),(async()=>{await Uq(e);})()]),await Hq(e),e.succeed("Gemini is ready!");}catch(r){e.fail("Failed to initialize the mod.",r);}finally{t?.();}const n=await Gq(e);yV({onClick:()=>n.setOpen(true)}),wq();})();

})();